(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{99178:function(e,t,n){Promise.resolve().then(n.bind(n,63250))},63250:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var r=n(757),o=n(12218);let a=o.env.NEXT_PUBLIC_API_URL?o.env.NEXT_PUBLIC_API_URL:window.location.origin;var i=n(27869);function getNeighborSet(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=new Set,o={},dfs=(e,n)=>{if(n<0||void 0!==o[e]&&o[e]>=n)return;o[e]=n;let a=t(e);for(let e of a)dfs(e,n-1);r.add(e)};for(let t of e)dfs(t,n);return r}function buildDefaultLineageGraphSets(e,t){function buildAllLineageGraph(e,t){let n={},r={},buildNode=(e,t)=>({id:e,name:e,data:{},from:t,parents:{},children:{}});for(let[t,r]of Object.entries(e.parent_map)){n[t]=buildNode(t,"base");let r=e.nodes&&e.nodes[t];r&&(n[t].data.base=r,n[t].name=null==r?void 0:r.name,n[t].resourceType=null==r?void 0:r.resource_type,n[t].packageName=null==r?void 0:r.package_name)}for(let[e,r]of Object.entries(t.parent_map)){n[e]?n[e].from="both":n[e]=buildNode(e,"current");let r=t.nodes&&t.nodes[e];r&&(n[e].data.current=t.nodes&&t.nodes[e],n[e].name=null==r?void 0:r.name,n[e].resourceType=null==r?void 0:r.resource_type,n[e].packageName=null==r?void 0:r.package_name)}for(let[t,o]of Object.entries(e.parent_map))for(let e of o){let o=n[t],a=n[e],i="".concat(e,"_").concat(t);r[i]={id:i,from:"base",parent:a,child:o};let l=r[i];o.parents[e]=l,a.children[t]=l}for(let[e,o]of Object.entries(t.parent_map))for(let t of o){let o=n[e],a=n[t],i="".concat(t,"_").concat(e);r[i]?r[i].from="both":r[i]={id:i,from:"current",parent:a,child:o};let l=r[i];o.parents[t]=l,a.children[e]=l}return{edges:r,nodes:n}}function buildChangedOnlyLineageGraph(e,t){let n={},r={};function union(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=new Set;return t.forEach(e=>{e.forEach(e=>{r.add(e)})}),r}let o=selectDownstream(e,t),a=selectUpstream(e,t,1),i=union(o,a);return Object.entries(e.nodes).forEach(e=>{let[t,r]=e;i.has(t)&&(n[t]=r)}),Object.entries(e.edges).forEach(e=>{let[t,n]=e;i.has(n.parent.id)&&i.has(n.child.id)&&(r[t]=n)}),{nodes:n,edges:r}}let{nodes:n,edges:r}=buildAllLineageGraph(e,t),o=[];for(let[e,t]of Object.entries(n))if("base"===t.from)t.changeStatus="removed",o.push(t.id);else if("current"===t.from)t.changeStatus="added",o.push(t.id);else{var a,i,l,s,c,d;let e=null==t?void 0:null===(l=t.data)||void 0===l?void 0:null===(i=l.base)||void 0===i?void 0:null===(a=i.checksum)||void 0===a?void 0:a.checksum,n=null==t?void 0:null===(d=t.data)||void 0===d?void 0:null===(c=d.current)||void 0===c?void 0:null===(s=c.checksum)||void 0===s?void 0:s.checksum;e&&n&&e!==n&&(t.changeStatus="modified",o.push(t.id))}for(let[e,t]of Object.entries(r))"base"===t.from?t.changeStatus="removed":"current"===t.from&&(t.changeStatus="added");return{all:{nodes:n,edges:r},changed:buildChangedOnlyLineageGraph({nodes:n,edges:r},o),modifiedSet:o}}function selectUpstream(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(t,t=>void 0===e.nodes[t]?[]:Object.keys(e.nodes[t].parents),n)}function selectDownstream(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(t,t=>void 0===e.nodes[t]?[]:Object.keys(e.nodes[t].children),n)}function toReactflow(e,t){let n=[],r=[];for(let[t,r]of Object.entries(e.nodes))n.push({id:r.id,position:{x:0,y:0},data:r,type:"customNode",targetPosition:i.Ly.Left,sourcePosition:i.Ly.Right});for(let[t,n]of Object.entries(e.edges))r.push({id:n.id,type:"customEdge",source:n.parent.id,target:n.child.id,data:n});return highlightPath(e,t,n,r,null)}function highlightPath(e,t,n,r,o){function union(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=new Set;return t.forEach(e=>{e.forEach(e=>{r.add(e)})}),r}let a=null!==o?union(selectUpstream(e,[o]),selectDownstream(e,[o])):getNeighborSet(t,t=>void 0===e.nodes[t]?[]:Object.keys(e.nodes[t].children)),i=new Set(r.filter(e=>a.has(e.source)&&a.has(e.target)).map(e=>e.id)),l=n.map(e=>({...e,data:{...e.data,isHighlighted:a.has(e.id)}})),s=r.map(e=>({...e,data:{...e.data,isHighlighted:i.has(e.id)}}));return[l,s]}var l=n(10126),s=n(83172),c=n(55528),d=n(29330),u=n(17714),h=n(15550),m=n(46543),x=n(43093),f=n(7752),g=n(94410),p=n(62209),y=n(29985),j=n(42524),v=n(10929),C=n(99691),b=n(27726),k=n(26187),S=n(23704),w=n(33710),_=n(93864),E=n.n(_);n(94570);var L=n(11180),O=n(63240),I=n(54057);let N=L.Nbv,z=L.sFB,D=L.UGs,IconChanged=e=>(0,r.jsxs)("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 16 16",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 11 a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}),(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:""})]});function getIconForChangeStatus(e){return"added"===e?{color:"#1dce00",icon:N}:"removed"===e?{color:"#ff4444",icon:z}:"modified"===e?{color:"#ffa502",icon:D}:{color:"inherit",icon:void 0}}function getIconForResourceType(e){return"model"===e?{color:"#c0eafd",icon:O.Fn3}:"metric"===e?{color:"#ffe6ee",icon:I._MV}:"source"===e?{color:"#a6dda6",icon:O.i1q}:"exposure"===e?{color:"#ffe6ee",icon:I.n8P}:"semantic_model"===e?{color:"#fb8caf",icon:I.R1C}:"seed"===e?{color:"#a6dda6",icon:O.tWi}:{color:"inherit",icon:void 0}}function GraphNode(e){var t,n;let o,{data:a}=e,{isHighlighted:u,resourceType:h,changeStatus:m}=a,x=(0,i.oR)(e=>e.transform[2]>.3),{icon:f}=getIconForResourceType(h),g="gray.400",p="solid";m&&(o=getIconForChangeStatus(m).icon,g=getIconForChangeStatus(m).color);let y=g,j=null==a?void 0:a.name;return(0,r.jsx)(s.u,{label:"model"===h?j:"".concat(j," (").concat(h,")"),placement:"top",children:(0,r.jsxs)(c.k,{width:"300px",_hover:{backgroundColor:x?"gray.100":g},borderColor:y,borderWidth:1,borderStyle:p,backgroundColor:x?"white":g,borderRadius:3,boxShadow:"unset",padding:0,className:!0===u?"node-highlight":!1===u?"node-unhighlight":void 0,children:[(0,r.jsx)(c.k,{backgroundColor:g,padding:2,borderRightWidth:1,borderColor:y,borderStyle:p,alignItems:"top",visibility:x?"inherit":"hidden",children:(0,r.jsx)(d.J,{as:f})}),(0,r.jsx)(c.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:(0,r.jsxs)(c.k,{width:"100%",textAlign:"left",flex:"1",p:1,alignItems:"center",visibility:x?"inherit":"hidden",children:[(0,r.jsx)(l.xu,{flex:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:j}),o&&(0,r.jsx)(c.k,{children:(0,r.jsx)(d.J,{color:g,as:o,flex:"0 0 20px"})})]})}),Object.keys(null!==(t=null==a?void 0:a.parents)&&void 0!==t?t:{}).length>0&&(0,r.jsx)(i.HH,{type:"target",position:i.Ly.Left,isConnectable:!1}),Object.keys(null!==(n=null==a?void 0:a.children)&&void 0!==n?n:{}).length>0&&(0,r.jsx)(i.HH,{type:"source",position:i.Ly.Right,isConnectable:!1})]})})}function GraphEdge(e){let{sourceX:t,sourceY:n,targetX:o,targetY:a,sourcePosition:l,targetPosition:s,style:c={},markerEnd:d,data:u}=e,h={...c};(null==u?void 0:u.changeStatus)&&(h.stroke=getIconForChangeStatus(null==u?void 0:u.changeStatus).color,h.strokeDasharray="5"),(null==u?void 0:u.isHighlighted)===!1&&(h.filter="opacity(0.2) grayscale(50%)");let[m]=(0,i.OQ)({sourceX:t,sourceY:n,sourcePosition:l,targetX:o,targetY:a,targetPosition:s});return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(i.u5,{path:m,markerEnd:d,style:{...h,...c}})})}n(88727);var P=n(89042),R=n(74796),T=n(62648),F=n(79315),q=n(90593),K=n(62130),M=n(58909),H=n(2593),G=n(55344),A=n(1726),V=n(83622),Q=n(21801),W=n(29731),B=n(49981);function mergeKeys(e,t){let n=[...e],r=[...t],o=[];for(;n.length>0&&r.length>0;)if(o.includes(n[0]))n.shift();else if(o.includes(r[0]))r.shift();else if(n[0]===r[0])o.push(n[0]),n.shift(),r.shift();else if(r.includes(n[0])){let e=r.indexOf(n[0]);for(let t=0;t<e;t++)o.includes(r[t])||o.push(r[t]);o.push(n[0]),n.shift(),r.splice(0,e+1)}else o.push(n[0]),n.shift();return n.forEach(e=>{o.includes(e)||o.push(e)}),r.forEach(e=>{o.includes(e)||o.push(e)}),o}function mergeKeysWithStatus(e,t){let n=mergeKeys(e,t),r={};for(let o of n)e.includes(o)?t.includes(o)?r[o]=void 0:r[o]="removed":r[o]="added";let o={};e.forEach((e,t)=>{o[e]=t});let a=-1;for(let e of n){let t=o[e];void 0!==t&&(t>a?a=t:r[e]="reordered")}return r}function mergeColumns(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},r=mergeKeysWithStatus(Object.keys(e),Object.keys(t));return Object.entries(r).forEach(e=>{let[t,r]=e;n[t]={name:t,reordered:"reordered"===r}}),Object.entries(e).map((e,t)=>{let[r,o]=e;n[r].baseIndex=t+1,n[r].baseType=o.type}),Object.entries(t).map((e,t)=>{let[r,o]=e;n[r].currentIndex=t+1,n[r].currentType=o.type}),n}function toDataGrid(e){function columnIndexCellClass(e){return void 0===e.baseIndex?"column-index-added":void 0===e.currentIndex?"column-index-removed":!0===e.reordered?"column-index-reordered":"column-index-normal"}function columnNameCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":!0===e.reordered?"column-body-reordered":"column-body-normal"}function columnTypeCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":e.baseType!==e.currentType?"column-body-type-changed":!0===e.reordered?"column-body-reordered":"column-body-normal"}let t=Object.values(e);return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"currentIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"name",name:"Name",resizable:!0,cellClass:columnNameCellClass},{key:"baseType",name:"Base Type",resizable:!0,cellClass:columnTypeCellClass},{key:"currentType",name:"Current Type",resizable:!0,cellClass:columnTypeCellClass}],rows:t}}n(75165),n(91702);var U=n(52116),J=n(93683),X=n(7873);function SchemaView(e){let t,{base:n,current:o}=e,{columns:a,rows:i}=(0,b.useMemo)(()=>toDataGrid(mergeColumns(null==n?void 0:n.columns,null==o?void 0:o.columns)),[n,o]),l=n&&void 0===n.columns,s=o&&void 0===o.columns;return l&&s?t="catalog.json is missing on both current and base environments.":l?t="catalog.json is missing on base environment.":s&&(t="catalog.json is missing on current environment."),(0,r.jsxs)(c.k,{direction:"column",children:[t&&(0,r.jsxs)(J.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,r.jsx)(X.z,{}),t]}),i.length>0&&(0,r.jsx)(U.ZP,{style:{height:"100%",fontSize:"10pt",borderWidth:1,overflowY:"auto"},columns:a,rows:i,className:"rdg-light"})]})}let Z='select * from {{ ref("mymodel") }}',Y=(0,b.createContext)({sqlQuery:Z,setSqlQuery:()=>{}});function RecceQueryContextProvider(e){let{children:t}=e,[n,o]=b.useState(Z);return(0,r.jsx)(Y.Provider,{value:{setSqlQuery:o,sqlQuery:n},children:t})}let useRecceQueryContext=()=>(0,b.useContext)(Y);var $=n(29357);function SqlDiffView(e){let{base:t,current:n}=e;return(0,r.jsx)($.SV,{height:"500px",language:"sql",theme:"vs",original:null==t?void 0:t.raw_code,modified:null==n?void 0:n.raw_code,options:{readOnly:!0,fontSize:14,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same"}})}var ee=n(90068),et=n(41171),en=n(53930),er=n(68665),eo=n(17180),ea=n(84680),ei=n(27471);let el=v.default.create({baseURL:a}),es=new ei.S;function extractColumnNames(e){function getNames(e){return e&&e.columns?Object.values(e.columns).map(e=>e.name):[]}let t=getNames(e.data.base),n=getNames(e.data.current),r=[];return t.forEach(e=>{r.includes(e)||r.push(e)}),n.forEach(e=>{r.includes(e)||r.push(e)}),r}async function fetchColumnValuesComparison(e,t){try{let n=await el.post("/api/runs",{type:"value_diff",params:{model:e,primary_key:t}});return n.data.result}catch(e){console.error("Error fetching column values comparison:",e)}}var MismatchSummary=function(){let{isOpen:e,onOpen:t,onClose:n}=(0,u.q)(),[o,a]=(0,b.useState)(!1),[i,s]=(0,b.useState)(null);return{MismatchSummaryModal:c=>{let{node:d}=c,u="model"===d.resourceType||"seed"===d.resourceType||"source"===d.resourceType,h=extractColumnNames(d),[m,x]=(0,b.useState)(""),handleExecute=async()=>{if(!o&&""!==m){a(!0);try{let e=await fetchColumnValuesComparison(d.name,m),t=e.data.schema.fields.map(e=>({name:e.name,key:e.name}));s({columns:t,data:e.data.data,summary:e.summary,model:d.name})}catch(e){console.error("Error fetching column values comparison:",e)}finally{a(!1)}}};return((0,b.useEffect)(()=>{(null==i?void 0:i.model)!=d.name&&s(null)},[d.name]),u)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(f.u_,{isOpen:e,onClose:n,size:"6xl",children:[(0,r.jsx)(g.Z,{}),(0,r.jsxs)(p.h,{overflowY:"auto",height:"75%",children:[(0,r.jsx)(M.x,{children:"Value Diff Summary"}),(0,r.jsx)(y.o,{}),(0,r.jsx)(j.f,{children:o?(0,r.jsx)(ee.E,{size:"xs",isIndeterminate:!0}):i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.xu,{mb:1,children:[i.summary.total," rows (",i.summary.added," added, ",i.summary.removed," removed)"]}),(0,r.jsx)(eo.i,{mb:1,mt:1}),(0,r.jsx)(U.ZP,{style:{height:"100%",width:"100%"},columns:i.columns.map(e=>({...e,width:void 0,resizable:!0,flexGrow:1})),rows:i.data,defaultColumnOptions:{resizable:!0},className:"rdg-light"})]}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(et.NI,{children:[(0,r.jsx)(en.l,{children:"Pick a primary key"}),(0,r.jsx)(er.P,{placeholder:"Select primary key",value:m,onChange:e=>x(e.target.value),children:h.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]})})}),(0,r.jsxs)(ea.m,{children:[i&&(0,r.jsx)(K.z,{mr:3,colorScheme:"blue",onClick:()=>{s(null)},children:"Clear"}),(0,r.jsx)(K.z,{colorScheme:"blue",onClick:handleExecute,children:"Execute"})]})]})]}),(0,r.jsx)(K.z,{colorScheme:"blue",size:"sm",onClick:t,children:"Value Diff Summary"})]}):(0,r.jsx)(r.Fragment,{})}}};function NodeView(e){let{node:t,onCloseNode:n}=e,o=(0,B.useRouter)(),{setSqlQuery:a}=useRecceQueryContext(),i="model"===t.resourceType||"seed"===t.resourceType||"source"===t.resourceType,{isOpen:s,onOpen:d,onClose:h}=(0,u.q)(),{MismatchSummaryModal:m}=MismatchSummary();return(0,r.jsxs)(R.r,{height:"100%",templateRows:"auto 1fr",children:[(0,r.jsxs)(T.U,{children:[(0,r.jsxs)(l.xu,{flex:"0 1 20%",p:"16px",children:[(0,r.jsx)(F.X,{size:"sm",children:t.name}),(0,r.jsx)(l.xu,{color:"gray",children:t.resourceType})]}),(0,r.jsx)(q.L,{}),"modified"===t.changeStatus&&(0,r.jsxs)(l.xu,{children:[(0,r.jsx)(K.z,{onClick:d,leftIcon:(0,r.jsx)(O.tvD,{}),colorScheme:"orange",variant:"solid",children:"Diff"}),(0,r.jsxs)(f.u_,{isOpen:s,onClose:h,size:"6xl",children:[(0,r.jsx)(g.Z,{}),(0,r.jsxs)(p.h,{overflowY:"auto",height:"75%",children:[(0,r.jsx)(M.x,{children:"Model Raw Code Diff"}),(0,r.jsx)(y.o,{}),(0,r.jsx)(j.f,{children:(0,r.jsx)(SqlDiffView,{base:t.data.base,current:t.data.current})})]})]})]}),(0,r.jsx)(l.xu,{flex:"0 1 1%",p:"16px",children:(0,r.jsx)(H.P,{onClick:n})})]}),i&&(0,r.jsxs)(G.m,{overflow:"auto",as:c.k,children:[(0,r.jsx)(A.t,{children:(0,r.jsx)(V.O,{children:"Columns"})}),(0,r.jsx)(Q.n,{overflow:"auto",height:"calc(100% - 42px)",children:(0,r.jsx)(W.x,{p:0,overflowY:"auto",height:"100%",children:(0,r.jsx)(SchemaView,{base:t.data.base,current:t.data.current})})})]}),"model"===t.resourceType&&"modified"===t.changeStatus&&(0,r.jsxs)(T.U,{p:"16px",children:[(0,r.jsx)(q.L,{}),(0,r.jsx)(m,{node:t}),(0,r.jsx)(K.z,{colorScheme:"blue",size:"sm",onClick:()=>{a('select * from {{ ref("'.concat(t.name,'") }}')),o.push("#query")},children:"Query"})]})]})}var ec=n(43898),ed=n(21123),eu=n.n(ed);let eh=(0,b.createContext)({setLineageGraphSets:()=>{}});function LineageGraphsContextProvider(e){let{children:t}=e,[n,o]=b.useState();return(0,r.jsx)(eh.Provider,{value:{setLineageGraphSets:o,lineageGraphSets:n},children:t})}let useLineageGraphsContext=()=>(0,b.useContext)(eh);var em=n(39668);let ex={added:["Model Added","Added resource"],removed:["Model Removed","Removed resource"],modified:["Model Modified","Modified resource"],col_added:["Column Added","Added column"],col_removed:["Column Removed","Removed column"],col_changed:["Column Modified","Modified column"],folder_changed:["Modified","Modified folder"]};function ChangeSummary_getIconForChangeStatus(e){if("added"===e)return{color:"#1dce00",icon:N};if("removed"===e)return{color:"#ff067e",icon:z};if("modified"===e)return{color:"#ffa502",icon:D};if("col_added"===e)return{color:"#1dce00",icon:N};if("col_removed"===e)return{color:"#ff067e",icon:z};if("col_changed"===e)return{color:"#ffa502",icon:D};if("folder_changed"===e)return{color:"#ffa502",icon:IconChanged};return{color:"inherit",icon:void 0}}function SummaryText(e){let{name:t,value:n,tip:o}=e;return(0,r.jsxs)(em.g,{alignItems:"stretch",children:[(0,r.jsxs)(x.x,{fontSize:"sm",color:"gray",children:[t,o&&(0,r.jsx)(s.u,{label:o,children:(0,r.jsx)(l.xu,{display:"inline-block",children:(0,r.jsx)(d.J,{mx:"2px",as:P.H33,boxSize:3})})})]}),n]})}function ChangeStatusCountLabel(e){let{changeStatus:t,value:n}=e,[o]=t?ex[t]:[""],{icon:a,color:i}=ChangeSummary_getIconForChangeStatus(t);return(0,r.jsxs)(em.g,{alignItems:"stretch",children:[(0,r.jsxs)(c.k,{alignItems:"center",fontSize:"sm",color:"gray",children:[(0,r.jsx)(d.J,{mr:"5px",as:a,color:i}),o]}),(0,r.jsx)(x.x,{fontSize:"sm",children:n})]})}function calculateColumnChange(e,t){let n=0,r=0,o=0;return(e||t)&&(t&&Object.keys(t.columns||{}).forEach(t=>{(!e||!e.columns||!e.columns[t])&&n++}),e&&Object.keys(e.columns||{}).forEach(e=>{(!t||!t.columns||!t.columns[e])&&r++}),t&&e&&Object.keys(t.columns||{}).forEach(n=>{e.columns&&t.columns&&e.columns[n]&&e.columns[n].type!==t.columns[n].type&&o++})),{adds:n,removes:r,modifies:o}}function calculateChangeSummary(e,t){let n=0,r=0,o=0,a=0,i=0,l=0;return t.forEach(t=>{"added"===e.nodes[t].changeStatus?n++:"removed"===e.nodes[t].changeStatus?r++:"modified"===e.nodes[t].changeStatus&&o++;let s=e.nodes[t].data.base,c=e.nodes[t].data.current,d=calculateColumnChange(s,c);a+=d.adds,i+=d.removes,l+=d.modifies}),{adds:n,removes:r,modifies:o,col_added:a,col_removed:i,col_changed:l}}function ChangeSummary(e){let{lineageGraphSets:t}=e,{adds:n,removes:o,modifies:a,col_added:i,col_removed:s,col_changed:c}=calculateChangeSummary(t.all,t.modifiedSet);return(0,r.jsxs)(R.r,{templateColumns:"1fr 1fr",mb:"10px",borderTop:"1px solid lightgray",padding:"2.5vw",children:[(0,r.jsx)(l.xu,{borderColor:"lightgray",children:(0,r.jsx)(SummaryText,{name:"Code Changes",value:(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(R.r,{templateColumns:"1fr 1fr 1fr",width:"100%",children:[(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"added",value:n}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"removed",value:o}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"modified",value:a})]})})})}),(0,r.jsx)(l.xu,{borderLeft:"1px",paddingLeft:"12px",borderColor:"lightgray",children:(0,r.jsx)(SummaryText,{name:"Column Changes",value:(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(R.r,{templateColumns:"1fr 1fr 1fr",width:"100%",children:[(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"col_added",value:i}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"col_removed",value:s}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"col_changed",value:c})]})})})})]})}var ef=n(76353),eg=n(53248),ep=n(9763),ey=n(95853);function SchemaDiffCard(e){let{node:t,...n}=e;return(0,r.jsxs)(ef.Z,{maxWidth:"500px",children:[(0,r.jsxs)(eg.O,{children:[(0,r.jsx)(F.X,{fontSize:18,children:n.title}),(0,r.jsx)(x.x,{fontSize:14,color:"gray",children:t.resourceType})]}),(0,r.jsx)(ep.e,{children:(0,r.jsx)(c.k,{children:(0,r.jsx)(SchemaView,{base:t.data.base,current:t.data.current})})})]})}function listChangedNodes(e){let t=[],n=e.all.nodes;return e.modifiedSet.forEach(e=>{var r,o;let a=n[e],i=mergeKeysWithStatus(Object.keys((null===(r=a.data.base)||void 0===r?void 0:r.columns)||{}),Object.keys((null===(o=a.data.current)||void 0===o?void 0:o.columns)||{})),l=!Object.values(i).every(e=>void 0===e);l&&t.push(a)}),t}function SchemaSummary(e){let{lineageGraphSets:t}=e,[n,o]=(0,b.useState)([]);return(0,b.useEffect)(()=>{o(listChangedNodes(t))},[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",marginTop:"20px",children:(0,r.jsx)(F.X,{fontSize:24,children:"Schema Summary"})}),(0,r.jsx)(c.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",children:0===n.length?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(x.x,{fontSize:18,color:"gray",children:"No schema changes detected."})}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(ey.M,{minChildWidth:"500px",spacing:"2vw",padding:"2.5vw",width:"100%",backgroundColor:"lightgray",children:n.map(e=>(0,r.jsx)(SchemaDiffCard,{title:e.name,node:e},e.id))})})})]})}function SummaryView(){let{lineageGraphSets:e}=useLineageGraphsContext();return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(c.k,{direction:"column",w:"100%",minHeight:"650px",children:[(0,r.jsx)(c.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",children:(0,r.jsx)(F.X,{fontSize:24,children:"Change Summary"})}),e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ChangeSummary,{lineageGraphSets:e}),(0,r.jsx)(eo.i,{}),(0,r.jsx)(SchemaSummary,{lineageGraphSets:e})]})]})})}let layout=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR",r=new(E()).graphlib.Graph;r.setDefaultEdgeLabel(()=>({})),r.setGraph({rankdir:n}),e.forEach(e=>{r.setNode(e.id,{width:300,height:36})}),t.forEach(e=>{r.setEdge(e.source,e.target)}),E().layout(r),e.forEach(e=>{let t=r.node(e.id);return e.position={x:t.x-150,y:t.y-18},e})},ej={customNode:GraphNode},ev={customEdge:GraphEdge},nodeColor=e=>{var t,n;return(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.changeStatus)?getIconForChangeStatus(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.changeStatus).color:"lightgray"},eC={all:"All",changed_models:"Changed Models"};function ChangeStatusLegend(){return(0,r.jsx)(l.xu,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[t,[n,o]]=e,{icon:a,color:i}=getIconForChangeStatus(t);return(0,r.jsx)(s.u,{label:o,children:(0,r.jsxs)(c.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,r.jsx)(d.J,{color:i,as:a})," ",n]})},t)})})}function _LineageView(){let[e,t]=(0,b.useState)(),[n,o,s]=(0,i.Rr)([]),[_,E,L]=(0,i.ll)([]),[O,I]=(0,b.useState)(),[N,z]=(0,b.useState)(),{setLineageGraphSets:D}=useLineageGraphsContext(),{isOpen:R,onOpen:T,onClose:F}=(0,u.q)(),[q,K]=(0,b.useState)(!1),[M,H]=(0,b.useState)(),[G,A]=(0,b.useState)(),[V,Q]=(0,b.useState)(),[W,B]=(0,b.useState)("changed_models"),{getViewport:U}=(0,i._K)(),J=(0,h.p)(),X=(0,b.useCallback)(async()=>{let e="current";try{K(!0);let t=await v.default.get("".concat(a,"/api/lineage?base=0"));if(200!==t.status)throw Error("error");e="base";let n=await v.default.get("".concat(a,"/api/lineage?base=1"));if(200!==n.status)throw Error("error");let r=buildDefaultLineageGraphSets(n.data,t.data);D(r);let i="changed_models"===W?r.changed:r.all,l=r.modifiedSet,[s,c]=toReactflow(i,r.modifiedSet);layout(s,c),I(i),z(l),o(s),E(c),H(void 0),A(void 0)}catch(r){if(r instanceof C.d7){var t,n;let e=null==r?void 0:null===(n=r.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.detail;e?H(e):H(null==r?void 0:r.message)}else H(null==r?void 0:r.message);A(e)}finally{K(!1)}},[o,E,W,D]);return((0,b.useEffect)(()=>{X()},[X]),(0,b.useEffect)(()=>{function httpUrlToWebSocketUrl(e){return e.replace(/(http)(s)?\:\/\//,"ws$2://")}let e=new WebSocket("".concat(httpUrlToWebSocketUrl(a),"/api/ws"));return t(e),e.onopen=()=>{e.send("ping")},e.onmessage=e=>{if("pong"!==e.data)try{let t=JSON.parse(e.data);if("refresh"===t.command){let{eventType:e,srcPath:n}=t.event,[r,o]=n.split("/").slice(-2),a=eu().parse(o).name;J({description:"Detected ".concat(r," ").concat(a," ").concat(e),status:"info",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0}),X()}}catch(e){console.error(e)}},()=>{e&&e.close()}},[J,X]),q)?(0,r.jsx)(c.k,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:(0,r.jsx)(m.$,{size:"xl"})}):M?(0,r.jsxs)(r.Fragment,{children:["Fail to load lineage data: ",M]}):(0,r.jsxs)(c.k,{width:"100%",height:"100%",children:[(0,r.jsx)(l.xu,{flex:"1 0 0px",children:(0,r.jsxs)(i.x$,{nodeTypes:ej,edgeTypes:ev,nodes:n,edges:_,onNodesChange:s,onEdgesChange:L,onNodeClick:(e,t)=>{Q(t.id)},onNodeMouseEnter:(e,t)=>{if(O&&void 0!==N){let[e,r]=highlightPath(O,N,n,_,t.id);o(e),E(r)}},onNodeMouseLeave:(e,t)=>{if(O&&void 0!==N){let[e,t]=highlightPath(O,N,n,_,null);o(e),E(t)}},maxZoom:1,minZoom:.1,fitView:!0,children:[(0,r.jsx)(k.A,{color:"#ccc"}),(0,r.jsxs)(S.Z,{showInteractive:!1,position:"top-right",children:[(0,r.jsx)(S.B,{title:"switch mode",onClick:()=>{B("all"===W?"changed_models":"all")},children:(0,r.jsx)(d.J,{as:P.Bw1})}),(0,r.jsx)(S.B,{title:"download image",onClick:()=>{let e=document.querySelector(".react-flow__viewport");(null==e?void 0:e.parentElement)&&(0,ec.YM)(null==e?void 0:e.parentElement,{backgroundColor:"#ffffff00",width:null==e?void 0:e.parentElement.clientWidth,height:null==e?void 0:e.parentElement.clientHeight,style:{width:"".concat(null==e?void 0:e.parentElement.clientWidth),height:"".concat(null==e?void 0:e.parentElement.clientHeight)}}).then(e=>{let t=document.createElement("a");t.setAttribute("download","recce-lineage.png"),t.setAttribute("target","_blank"),t.setAttribute("href",e),t.click()})},children:(0,r.jsx)(d.J,{as:P.wzc})}),(0,r.jsx)(S.B,{title:"summary",onClick:T,children:(0,r.jsx)(d.J,{as:P.SnF})})]}),(0,r.jsx)(i.s_,{position:"bottom-left",children:(0,r.jsx)(ChangeStatusLegend,{})}),(0,r.jsx)(i.s_,{position:"top-left",children:(0,r.jsx)(x.x,{fontSize:"xl",color:"grey",opacity:.5,children:eC[W]})}),(0,r.jsx)(w.a,{nodeColor:nodeColor,nodeStrokeWidth:3})]})}),(0,r.jsxs)(f.u_,{isOpen:R,onClose:F,size:"6xl",children:[(0,r.jsx)(g.Z,{}),(0,r.jsxs)(p.h,{overflowY:"auto",height:"80%",children:[(0,r.jsx)(y.o,{}),(0,r.jsx)(j.f,{children:(0,r.jsx)(SummaryView,{})})]})]}),V&&(null==O?void 0:O.nodes[V])&&(0,r.jsx)(l.xu,{flex:"0 0 500px",borderLeft:"solid 1px lightgray",height:"100%",children:(0,r.jsx)(NodeView,{node:null==O?void 0:O.nodes[V],onCloseNode:()=>{Q(void 0)}})})]})}function LineageView(){return(0,r.jsx)(i.tV,{children:(0,r.jsx)(_LineageView,{})})}var eb=n(69146),ek=n(98786),eS=n(35537);function RecceContextProvider(e){let{children:t}=e;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(RecceQueryContextProvider,{children:(0,r.jsx)(LineageGraphsContextProvider,{children:t})})})}function useVersionNumber(){let[e,t]=(0,b.useState)("");return(0,b.useEffect)(()=>{(async function(){try{let e=await el.get("/api/version");t(e.data)}catch(e){console.error("Error fetching version number:",e)}})()},[]),e}function getLocationHash(){return window.location.hash.replace("#","")}function setLocationHash(e){window.location.hash=e}async function createCheckByRun(e){let t=await el.post("/api/checks",{run_id:e}),n=t.data;return n}async function listChecks(){let e=await el.get("/api/checks");return e.data}async function checks_getCheck(e){let t=await el.get("/api/checks/".concat(e));return t.data}async function updateCheck(e,t){let n=await el.patch("/api/checks/".concat(e),t);return n.data}async function deleteCheck(e){let t=await el.delete("/api/checks/".concat(e));return t.data}var ew=n(51348),e_=n(76920),eE=n(36700),eL=n(18974),eO=n(95913),eI=n(10287),eN=n(24275),ez=n(69005),eD=n(14800),eP=n(2600),eR=n(68677),eT=n(83358),eF=n(33695),query_SqlEditor=e=>{let{value:t,onChange:n,onRun:o,...a}=e;return(0,r.jsx)($.ZP,{language:"sql",theme:"vs",value:t,onChange:e=>{void 0!==e&&n&&n(e)},onMount:(e,t)=>{o&&e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.Enter,o)},options:{tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent"}})},eq=n(83978),eK=n.n(eq);function _getPrimaryKeyValue(e,t){let n={};for(let r of t)n[r]=e[r];return JSON.stringify(n)}function DataFrameColumnGroupHeader(e){let{name:t,primaryKeys:n,onPrimaryKeyChange:o}=e;return"index"===t?(0,r.jsx)(r.Fragment,{}):n.includes(t)?(0,r.jsxs)(c.k,{alignItems:"center",children:[(0,r.jsx)(l.xu,{flex:1,children:t}),o&&(0,r.jsx)(d.J,{cursor:"pointer",as:L.ven,onClick:()=>{let e=n.filter(e=>e!==t);o(e)}})]}):(0,r.jsxs)(c.k,{alignItems:"center",children:[(0,r.jsx)(l.xu,{flex:1,children:t}),o&&(0,r.jsx)(d.J,{cursor:"pointer",as:L.MhP,onClick:()=>{let e=[...n.filter(e=>"index"!==e),t];o(e)}})]})}function query_toDataGrid(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0,a={schema:{fields:[],primaryKey:[]},data:[]};if(!e&&t)e=a,0===n.length&&(n=t.schema.primaryKey);else if(!t&&e)t=a,0===n.length&&(n=e.schema.primaryKey);else{if(!e||!t)return{rows:[],columns:[]};if(!eK().isEqual(e.schema.primaryKey,t.schema.primaryKey))throw Error("primary key mismatch! ".concat(e.schema.primaryKey," != ").concat(t.schema.primaryKey));0===n.length&&(n=e.schema.primaryKey)}let i=[],l=[],s={},c={};t.schema.fields.forEach(e=>{s[e.name]={},s[e.name].current=e}),e.schema.fields.forEach(e=>{s[e.name]||(s[e.name]={}),s[e.name].base=e}),Object.entries(s).forEach(e=>{let[t,{base:a,current:s}]=e;if(n.includes(t))l.push({key:"".concat(t),name:(0,r.jsx)(DataFrameColumnGroupHeader,{name:t,primaryKeys:n,onPrimaryKeyChange:o}),frozen:!0});else{if("index"===t)return;let cellClass=e=>{if(!eK().isEqual(e["base__".concat(t)],e["current__".concat(t)]))return"diff-cell"};i.push({name:(0,r.jsx)(DataFrameColumnGroupHeader,{name:t,primaryKeys:n,onPrimaryKeyChange:o}),children:[{key:"base__".concat(t),name:"Base",renderEditCell:U.Ug,cellClass},{key:"current__".concat(t),name:"Current",renderEditCell:U.Ug,cellClass}]})}}),t.data.forEach(e=>{let t=_getPrimaryKeyValue(e,n);c[t]={},c[t].current=e}),e.data.forEach(e=>{let t=_getPrimaryKeyValue(e,n);c[t]||(c[t]={}),c[t].base=e});let d=Object.entries(c).map(e=>{let[t,{base:r,current:o}]=e,a=JSON.parse(t);return r&&Object.keys(r).forEach(e=>{n.includes(e)||(a["base__".concat(e)]=r[e])}),o&&Object.keys(o).forEach(e=>{n.includes(e)||(a["current__".concat(e)]=o[e])}),a});return{columns:[...l,...i],rows:d}}n(7866);let QueryDiffDataGrid=e=>{let{isFetching:t,result:n,error:o,primaryKeys:a,setPrimaryKeys:i}=e,l=(0,b.useMemo)(()=>t?{rows:[],columns:[]}:query_toDataGrid(null==n?void 0:n.base,null==n?void 0:n.current,a,i),[n,t,a,i]),{base_error:s,current_error:c}=n||{};return t?(0,r.jsxs)(e_.M,{p:"16px",height:"100%",children:[(0,r.jsx)(m.$,{size:"sm",mr:"8px"}),"Loading..."]}):o||s&&c?(0,r.jsxs)(J.b,{status:"error",children:[(0,r.jsx)(X.z,{}),"Error: ",(null==o?void 0:o.message)||c]}):0===l.columns.length?(0,r.jsx)(e_.M,{height:"100%",children:"No data"}):(0,r.jsx)(U.ZP,{style:{blockSize:"100%"},columns:l.columns,rows:l.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,width:100},className:"rdg-light"})};var eM=n(44525),eH=n(234),eG=n(19547),eA=n(89271),eV=n(25535),eQ=n(36334);function CheckBreadcrumb(e){let{name:t,setName:n}=e,[o,a]=(0,b.useState)(!1),[i,s]=(0,b.useState)(t),c=(0,b.useRef)(null),d=(0,b.useCallback)(()=>{n(i),a(!1)},[n,a,i]);return(0,b.useEffect)(()=>{let handleClickOutside=e=>{c.current&&!c.current.contains(e.target)&&d()};return o&&document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}},[o,c,d]),(0,r.jsxs)(eH.a,{flex:"0 1",fontSize:"12pt",separator:(0,r.jsx)(eQ.X,{color:"gray.500"}),children:[(0,r.jsx)(eG.g,{children:(0,r.jsx)(eA.A,{children:"Checks"})}),(0,r.jsx)(eG.g,{flex:"0 1",children:(0,r.jsx)(eA.A,{href:"#",isCurrentPage:!0,children:o?(0,r.jsx)(eV.I,{ref:c,value:i,onChange:e=>{s(e.target.value)},onKeyDown:e=>{"Enter"===e.key?(n(i),a(!1)):"Escape"===e.key&&(s(t),a(!1))},size:"sm",w:"auto",minW:"100px",maxW:"600px"}):(0,r.jsx)(l.xu,{onClick:()=>{s(t),a(!0)},textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:t})})})]})}var eW=n(44903),eB=n(70556);let eU={checks:()=>["checks","list"],check:e=>["checks",e]},CheckDetail=e=>{var t;let{checkId:n}=e,o=(0,eS.NL)(),{isLoading:a,error:i,data:s}=(0,eW.a)({queryKey:eU.check(n),queryFn:()=>checks_getCheck(n)}),{mutate:u}=(0,eB.D)({mutationFn:e=>updateCheck(n,e),onSuccess:()=>{o.invalidateQueries({queryKey:eU.check(n)}),o.invalidateQueries({queryKey:eU.checks()})}}),{mutate:h}=(0,eB.D)({mutationFn:()=>deleteCheck(n),onSuccess:()=>{o.invalidateQueries({queryKey:eU.checks()})}});return a?(0,r.jsx)(e_.M,{h:"100%",children:"Loading"}):i?(0,r.jsxs)(e_.M,{h:"100%",children:["Error: ",i.message]}):(0,r.jsxs)(c.k,{height:"100%",width:"100%",maxHeight:"100%",direction:"column",children:[(0,r.jsxs)(c.k,{p:"8px 16px",alignItems:"center",children:[(0,r.jsx)(CheckBreadcrumb,{name:(null==s?void 0:s.name)||"",setName:e=>{u({name:e})}}),(0,r.jsxs)(eE.v,{children:[(0,r.jsx)(eL.j,{as:eO.h,icon:(0,r.jsx)(d.J,{as:L.D_A}),variant:"ghost"}),(0,r.jsx)(eI.q,{children:(0,r.jsx)(eN.s,{icon:(0,r.jsx)(eM.p,{}),onClick:()=>h(),children:"Delete"})})]}),(0,r.jsx)(q.L,{}),(0,r.jsx)(ew.X,{isChecked:null==s?void 0:s.is_checked,onChange:e=>{let t=e.target.checked;u({is_checked:t})},children:"Check"})]}),(0,r.jsxs)(ez.U,{defaultIndex:[],allowToggle:!0,children:[(0,r.jsxs)(eD.Q,{children:[(0,r.jsxs)(eP.K,{children:[(0,r.jsx)(l.xu,{as:"span",textAlign:"left",children:"description"}),(0,r.jsx)(eR.X,{})]}),(0,r.jsx)(eT.H,{pb:4,children:(0,r.jsx)(eF.g,{width:"100%",height:"400px"})})]}),(0,r.jsxs)(eD.Q,{children:[(0,r.jsxs)(eP.K,{children:["query",(0,r.jsx)(eR.X,{})]}),(0,r.jsx)(eT.H,{children:(0,r.jsx)(l.xu,{height:"400px",width:"100%",border:"lightgray 1px solid ",children:(0,r.jsx)(query_SqlEditor,{value:(null==s?void 0:s.params).sql_template})})})]})]}),(0,r.jsx)(l.xu,{flex:"1",style:{contain:"size"},children:(0,r.jsx)(QueryDiffDataGrid,{isFetching:!1,result:null==s?void 0:null===(t=s.last_run)||void 0===t?void 0:t.result,primaryKeys:(null==s?void 0:s.params).primary_keys||[]})})]})},ChecklistItem=e=>{let{check:t,selected:n,onSelect:o}=e,a=(0,eS.NL)(),i=t.check_id,{mutate:s}=(0,eB.D)({mutationFn:e=>updateCheck(i,e),onSuccess:()=>{a.invalidateQueries({queryKey:eU.check(i)}),a.invalidateQueries({queryKey:eU.checks()})}});return(0,r.jsxs)(c.k,{width:"100%",p:"10px 20px",cursor:"pointer",_hover:{bg:"gray.200"},bg:n?"gray.100":"inherit",onClick:()=>o(t.check_id),gap:"5px",children:[(0,r.jsx)(l.xu,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:t.name}),(0,r.jsx)(ew.X,{isChecked:t.is_checked,onChange:e=>{let t=e.target.checked;s({is_checked:t})}})]})},CheckPage=()=>{let[e,t]=(0,b.useState)(null),{isLoading:n,error:o,data:a}=(0,eW.a)({queryKey:eU.checks(),queryFn:listChecks,refetchOnMount:!0});if((0,b.useEffect)(()=>{if(!a)return;let n=eK().find(a,t=>t.check_id===e);n||t(a.length>0?a[0].check_id:null)},[e,t,a]),n)return(0,r.jsx)(r.Fragment,{children:"Loading"});if(o)return(0,r.jsxs)(r.Fragment,{children:["Error: ",o.message]});if(!(null==a?void 0:a.length))return(0,r.jsx)(e_.M,{h:"100%",children:"No checks"});let handleSelectItem=e=>{t(e)};return(0,r.jsxs)(c.k,{height:"100%",children:[(0,r.jsx)(l.xu,{flex:"0 0 400px",borderRight:"lightgray solid 1px",height:"100%",style:{contain:"size"},children:(0,r.jsx)(em.g,{spacing:0,children:a.map(t=>(0,r.jsx)(ChecklistItem,{check:t,selected:t.check_id===e,onSelect:handleSelectItem},t.check_id))})}),(0,r.jsx)(l.xu,{flex:"1",height:"100%",width:"calc(100% - 400px)",children:e&&(0,r.jsx)(CheckDetail,{checkId:e})})]})};async function submitRun(e){let t=e.type,n=e.params;if("query_diff"===t){let e=await el.post("/api/runs",{type:"query_diff",params:n}),t=e.data;return t}throw Error("Wrong run type ".concat(e.type))}async function submitQueryDiff(e){return await submitRun({type:"query_diff",params:e})}let QueryPage=()=>{let{sqlQuery:e,setSqlQuery:t}=useRecceQueryContext(),[n,o]=(0,b.useState)(),a=(0,B.useRouter)(),[i,s]=(0,b.useState)([]),d=(0,eS.NL)(),{data:u,mutate:h,error:m,isPending:x}=(0,eB.D)({mutationFn:()=>submitQueryDiff({sql_template:e}),onSuccess:t=>{s([]),o(e)}}),f=(0,b.useCallback)(async()=>{if(!(null==u?void 0:u.run_id))return;let e=await createCheckByRun(u.run_id);await updateCheck(e.check_id,{params:{...e.params,primary_keys:i}}),o(void 0),d.invalidateQueries({queryKey:eU.checks()}),a.push("#checks")},[null==u?void 0:u.run_id,a,i,d]);return(0,r.jsxs)(c.k,{direction:"column",height:"100%",children:[(0,r.jsxs)(c.k,{justifyContent:"right",padding:"5px",gap:"5px",children:[(0,r.jsx)(K.z,{colorScheme:"blue",onClick:f,isDisabled:x||!(null==u?void 0:u.run_id)||e!=n,size:"sm",children:"Add to Checklist"}),(0,r.jsx)(K.z,{colorScheme:"blue",onClick:()=>h(),isDisabled:x,size:"sm",children:"Run"})]}),(0,r.jsx)(l.xu,{flex:"1",border:"1px solid #CBD5E0",height:"200px",width:"100%",children:(0,r.jsx)(query_SqlEditor,{value:e,onChange:t,onRun:()=>h()})}),(0,r.jsx)(l.xu,{backgroundColor:"gray.100",height:"50vh",children:(0,r.jsx)(QueryDiffDataGrid,{isFetching:x,result:null==u?void 0:u.result,error:m,primaryKeys:i,setPrimaryKeys:s})})]})};var eJ=n(12218);function getCookie(e){var t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t?t.pop():""}let TabContainer=e=>{let{children:t,pageHeight:n}=e;return(0,r.jsx)(W.x,{p:0,h:n,maxH:n,overflow:"auto",children:t})};function Home(){let e=useVersionNumber(),t=(0,B.useParams)(),[n,o]=(0,b.useState)(getLocationHash()),[a,i]=(0,b.useState)(0);(0,b.useLayoutEffect)(()=>{let e=getCookie("recce_user_id");if(e&&eJ.env.AMPLITUDE_API_KEY)try{ek.S1(eJ.env.AMPLITUDE_API_KEY,e,{defaultTracking:!0})}catch(e){console.error(e)}},[]),(0,b.useEffect)(()=>{let e=getLocationHash();o(e),e===n&&("lineage"===e?i(0):"query"===e?i(1):"checks"===e?i(2):"summary"===e?i(3):i(0))},[t,n]);let s="calc(100vh - 42px)";return(0,r.jsx)(eb.x,{children:(0,r.jsx)(RecceContextProvider,{children:(0,r.jsx)(eS.aH,{client:es,children:(0,r.jsxs)(G.m,{index:a,onChange:e=>{0===e?setLocationHash("lineage"):1===e?setLocationHash("query"):2===e?setLocationHash("checks"):3===e&&setLocationHash("summary"),i(e)},children:[(0,r.jsxs)(A.t,{children:[(0,r.jsx)(V.O,{children:"Lineage"}),(0,r.jsx)(V.O,{children:"Query"}),(0,r.jsx)(V.O,{children:"Checklist"}),(0,r.jsx)(V.O,{children:"Summary"}),(0,r.jsx)(l.xu,{position:"absolute",right:"0",top:"0",p:"2",color:"gray.500",children:e})]}),(0,r.jsxs)(Q.n,{children:[(0,r.jsx)(TabContainer,{pageHeight:s,children:(0,r.jsx)(LineageView,{})}),(0,r.jsx)(TabContainer,{pageHeight:s,children:(0,r.jsx)(QueryPage,{})}),(0,r.jsx)(TabContainer,{pageHeight:s,children:(0,r.jsx)(CheckPage,{})}),(0,r.jsx)(TabContainer,{pageHeight:s,children:(0,r.jsx)(SummaryView,{})})]})]})})})})}},88727:function(){},7866:function(){},75165:function(){}},function(e){e.O(0,[145,170,182,710,495,644,297,62,744],function(){return e(e.s=99178)}),_N_E=e.O()}]);