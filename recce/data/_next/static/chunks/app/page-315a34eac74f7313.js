(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{99178:function(e,n,t){Promise.resolve().then(t.bind(t,12595))},12595:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Home}});var r=t(757),o=t(27869);function getNeighborSet(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=new Set,o={},dfs=(e,t)=>{if(t<0||void 0!==o[e]&&o[e]>=t)return;o[e]=t;let l=n(e);for(let e of l)dfs(e,t-1);r.add(e)};for(let n of e)dfs(n,t);return r}function buildDefaultLineageGraphSets(e,n){function buildAllLineageGraph(e,n){let t={},r={},buildNode=(e,n)=>({id:e,name:e,data:{},from:n,parents:{},children:{},isSelected:!1});for(let[n,r]of Object.entries(e.parent_map)){t[n]=buildNode(n,"base");let r=e.nodes&&e.nodes[n];r&&(t[n].data.base=r,t[n].name=null==r?void 0:r.name,t[n].resourceType=null==r?void 0:r.resource_type,t[n].packageName=null==r?void 0:r.package_name)}for(let[e,r]of Object.entries(n.parent_map)){t[e]?t[e].from="both":t[e]=buildNode(e,"current");let r=n.nodes&&n.nodes[e];r&&(t[e].data.current=n.nodes&&n.nodes[e],t[e].name=null==r?void 0:r.name,t[e].resourceType=null==r?void 0:r.resource_type,t[e].packageName=null==r?void 0:r.package_name)}for(let[n,o]of Object.entries(e.parent_map))for(let e of o){let o=t[n],l=t[e],i="".concat(e,"_").concat(n);r[i]={id:i,from:"base",parent:l,child:o};let a=r[i];o.parents[e]=a,l.children[n]=a}for(let[e,o]of Object.entries(n.parent_map))for(let n of o){let o=t[e],l=t[n],i="".concat(n,"_").concat(e);r[i]?r[i].from="both":r[i]={id:i,from:"current",parent:l,child:o};let a=r[i];o.parents[n]=a,l.children[e]=a}return{edges:r,nodes:t}}function buildChangedOnlyLineageGraph(e,n){let t={},r={};function union(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let r=new Set;return n.forEach(e=>{e.forEach(e=>{r.add(e)})}),r}let o=selectDownstream(e,n),l=selectUpstream(e,n,1),i=union(o,l);return Object.entries(e.nodes).forEach(e=>{let[n,r]=e;i.has(n)&&(t[n]=r)}),Object.entries(e.edges).forEach(e=>{let[n,t]=e;i.has(t.parent.id)&&i.has(t.child.id)&&(r[n]=t)}),{nodes:t,edges:r}}let{nodes:t,edges:r}=buildAllLineageGraph(e,n),o=[];for(let[e,n]of Object.entries(t))if("base"===n.from)n.changeStatus="removed",o.push(n.id);else if("current"===n.from)n.changeStatus="added",o.push(n.id);else{var l,i,a,s,c,d;let e=null==n?void 0:null===(a=n.data)||void 0===a?void 0:null===(i=a.base)||void 0===i?void 0:null===(l=i.checksum)||void 0===l?void 0:l.checksum,t=null==n?void 0:null===(d=n.data)||void 0===d?void 0:null===(c=d.current)||void 0===c?void 0:null===(s=c.checksum)||void 0===s?void 0:s.checksum;e&&t&&e!==t&&(n.changeStatus="modified",o.push(n.id))}for(let[e,n]of Object.entries(r))"base"===n.from?n.changeStatus="removed":"current"===n.from&&(n.changeStatus="added");return{all:{nodes:t,edges:r},changed:buildChangedOnlyLineageGraph({nodes:t,edges:r},o),modifiedSet:o}}function selectUpstream(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].parents),t)}function selectDownstream(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].children),t)}function toReactflow(e,n){let t=[],r=[];for(let[n,r]of Object.entries(e.nodes))t.push({id:r.id,position:{x:0,y:0},data:r,type:"customNode",targetPosition:o.Ly.Left,sourcePosition:o.Ly.Right});for(let[n,t]of Object.entries(e.edges))r.push({id:t.id,type:"customEdge",source:t.parent.id,target:t.child.id,data:t});return highlightPath(e,n,t,r,null)}function highlightPath(e,n,t,r,o){function union(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let r=new Set;return n.forEach(e=>{e.forEach(e=>{r.add(e)})}),r}let l=null!==o?union(selectUpstream(e,[o]),selectDownstream(e,[o])):getNeighborSet(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].children)),i=new Set(r.filter(e=>l.has(e.source)&&l.has(e.target)).map(e=>e.id)),a=t.map(e=>({...e,data:{...e.data,isHighlighted:l.has(e.id)}})),s=r.map(e=>({...e,data:{...e.data,isHighlighted:i.has(e.id)}}));return[a,s]}function selectSingleNode(e,n){let t=n.map(n=>{let t=n.id===e;return{...n,data:{...n.data,isSelected:t}}});return t}function selectNode(e,n){let t=n.map(n=>{let t=n.id===e;return{...n,data:{...n.data,isSelected:n.data.isSelected!==t}}});return t}function selectNodes(e,n){let t=n.map(n=>{let t=e.includes(n.id);return{...n,data:{...n.data,isSelected:n.data.isSelected||t}}});return t}function cleanUpSelectedNodes(e){let n=e.map(e=>({...e,data:{...e.data,isSelected:!1}}));return n}var l=t(10126),i=t(83172),a=t(55528),s=t(29330),c=t(15550),d=t(17714),u=t(46543),h=t(76920),m=t(39668),x=t(83179),f=t(62648),p=t(43093),g=t(7752),y=t(94410),j=t(13824),C=t(29985),v=t(42524),b=t(36700),k=t(10287),w=t(24275),S=t(27726),_=t(26187),R=t(23704),N=t(33710),E=t(93864),D=t.n(E);t(94570);var T=t(90593),O=t(11180),I=t(63240),L=t(54057);let z=O.Nbv,F=O.sFB,M=O.UGs,IconChanged=e=>(0,r.jsxs)("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 16 16",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 11 a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}),(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:""})]});function getIconForChangeStatus(e){return"added"===e?{color:"#1dce00",icon:z}:"removed"===e?{color:"#ff4444",icon:F}:"modified"===e?{color:"#ffa502",icon:M}:{color:"inherit",icon:void 0}}function getIconForResourceType(e){return"model"===e?{color:"#c0eafd",icon:I.Fn3}:"metric"===e?{color:"#ffe6ee",icon:L._MV}:"source"===e?{color:"#a6dda6",icon:I.i1q}:"exposure"===e?{color:"#ffe6ee",icon:L.n8P}:"semantic_model"===e?{color:"#fb8caf",icon:L.R1C}:"seed"===e?{color:"#a6dda6",icon:I.tWi}:{color:"inherit",icon:void 0}}t(88727);var q=t(19920),P=t(7467),V=t(95913),B=t(89042),A=t(80294),Q=t(35537),W=t(10929),H=t(12218);let K=H.env.NEXT_PUBLIC_API_URL?H.env.NEXT_PUBLIC_API_URL:window.location.origin;var U=t(27471);let G=W.default.create({baseURL:K}),J=new U.S;async function submitRun(e,n,t){let r=await G.post("/api/runs",{type:e,params:n,nowait:null==t?void 0:t.nowait}),o=r.data;return o}async function waitRun(e,n){let t=await G.get("/api/runs/".concat(e,"/wait"),{params:{timeout:n}}),r=t.data;return r}async function cancelRun(e){return await G.post("/api/runs/".concat(e,"/cancel"))}async function submitQuery(e,n){return await submitRun("query",e,n)}async function submitQueryDiff(e,n){return await submitRun("query_diff",e,n)}async function submitRowCountDiff(e,n){return await submitRun("row_count_diff",e,n)}let X={allRowCount:()=>["row_count"],rowCount:e=>["row_count",e],lineage:()=>["lineage"],checks:()=>["checks","list"],check:e=>["checks",e]},Z='select * from {{ ref("mymodel") }}',Y=(0,S.createContext)({sqlQuery:Z,setSqlQuery:()=>{}});function RecceQueryContextProvider(e){let{children:n}=e,[t,o]=S.useState(Z);return(0,r.jsx)(Y.Provider,{value:{setSqlQuery:o,sqlQuery:t},children:n})}let useRecceQueryContext=()=>(0,S.useContext)(Y),$=(0,S.createContext)({isNodesFetching:[],setIsNodesFetching:()=>{}});function RowCountStateContextProvider(e){let{children:n}=e,[t,o]=S.useState([]);return(0,r.jsx)($.Provider,{value:{isNodesFetching:t,setIsNodesFetching:o},children:n})}let useRowCountStateContext=()=>(0,S.useContext)($);async function models_queryModelRowCount(e){let{result:n}=await queryRowCount([e]);return n[e]}async function queryRowCount(e){if(0===e.length)throw Error("No model names provided");let{run_id:n}=await submitRowCountDiff({node_names:e},{nowait:!0}),t=await waitRun(n);return{runId:n,result:t.result}}function useRowCountQueries(e){let[n,t]=(0,S.useState)(!1),r=(0,Q.NL)(),{setIsNodesFetching:o}=useRowCountStateContext(),l=r.getQueriesData({queryKey:X.allRowCount()}).filter(n=>{let[t,r]=n,[o,l]=t;return e.includes(l)}).map(e=>{let[n,t]=e,[r,o]=n;return{modelName:o,data:t}}),i=[];return e.forEach(e=>{let{data:n}=l.find(n=>n.modelName===e)||{data:void 0,modelName:e};void 0===n&&i.push(e)}),{isLoading:n,fetchFn:async function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=n&&n.skipCache?e:i;t(!0),o(l);let{runId:a,result:s}=await queryRowCount(l);return Object.keys(s).forEach(e=>{let n=s[e];r.setQueryData(X.rowCount(e),{base:n.base,curr:n.curr})}),t(!1),o([]),a}}}var ee=t(44903);function ModelRowCount(e){let{rowCount:n}=e;if(!n)return(0,r.jsxs)(f.U,{children:[(0,r.jsx)(p.x,{children:"Failed to load"}),(0,r.jsx)(s.J,{as:B.KZt,color:"red.500"})]});let t=null===n.base?-1:n.base,o=null===n.curr?-1:n.curr,l=-1===t?"N/A":t,i=-1===o?"N/A":o;return t===o?(0,r.jsxs)(p.x,{children:[t," rows"]}):t<o?(0,r.jsxs)(f.U,{children:[(0,r.jsx)(p.x,{children:l}),(0,r.jsx)(s.J,{as:B.QqI,color:"green.500"}),(0,r.jsxs)(p.x,{children:[i," rows"]})]}):(0,r.jsxs)(f.U,{children:[(0,r.jsx)(p.x,{children:l}),(0,r.jsx)(s.J,{as:B.ZBs,color:"red.500"}),(0,r.jsxs)(p.x,{children:[i," rows"]}),"rows"]})}function ResourceTypeTag(e){let{node:n}=e,{icon:t}=getIconForResourceType(n.resourceType);return(0,r.jsx)(i.u,{hasArrow:!0,label:"Type of resource",children:(0,r.jsxs)(q.Vp,{children:[(0,r.jsx)(q.AD,{as:t}),(0,r.jsx)(q.Sn,{children:n.resourceType})]})})}function RowCountTag(e){let{node:n,isAutoFetching:t=!1,isInteractive:o=!0}=e,{isNodesFetching:l}=useRowCountStateContext(),{isLoading:a,data:c,refetch:d,isFetched:u,isFetching:h}=(0,ee.a)({queryKey:X.rowCount(n.name),queryFn:()=>models_queryModelRowCount(n.name),enabled:"model"===n.resourceType&&t}),m=h||l.includes(n.name),x=a||l.includes(n.name);function ProcessedRowCountTag(e){let{isLoading:n,rowCount:t}=e;return(0,r.jsx)(q.Sn,{children:(0,r.jsx)(P.N,{isLoaded:!n,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:(0,r.jsx)(ModelRowCount,{rowCount:t})})})}function UnprocessedRowCountTag(e){let{isInteractive:n,invokeFunction:t}=e;return n?(0,r.jsx)(V.h,{"aria-label":"Query Row Count",icon:(0,r.jsx)(A.j3i,{}),size:"xs",onClick:()=>{t()}}):(0,r.jsx)(s.J,{as:A.ebq})}return!1===o&&!1===u&&!1===m?null:(0,r.jsx)(i.u,{hasArrow:!0,label:u||m||!o?"Number of row":"Query the number of row",openDelay:500,closeDelay:200,children:(0,r.jsxs)(q.Vp,{children:[(0,r.jsx)(q.AD,{as:B.SwK}),u||m?(0,r.jsx)(ProcessedRowCountTag,{isLoading:x,rowCount:c}):(0,r.jsx)(UnprocessedRowCountTag,{isInteractive:o,invokeFunction:d})]})})}function FetchSelectedNodesRowCountButton(e){let{selectedNodes:n,onFinish:t}=e,{isLoading:o,fetchFn:l}=useRowCountQueries(n.map(e=>e.name));return(0,r.jsxs)(x.z,{size:"xs",variant:"outline",title:"Query Row Counts",onClick:async()=>{await l(),t&&t()},isDisabled:o||0===n.length,children:[(0,r.jsx)(s.J,{as:A.j3i,mr:1}),o?"Querying":"Query Row Counts"]})}function GraphNode(e){var n,t;let c,{data:d}=e,{isHighlighted:u,isSelected:h,resourceType:m,changeStatus:x}=d,p=(0,o.oR)(e=>e.transform[2]>.3),{icon:g}=getIconForResourceType(m),y="gray.400",j="solid";x&&(c=getIconForChangeStatus(x).icon,y=getIconForChangeStatus(x).color);let C=y,v=d.isSelected?"rgba(3, 102, 214, 0.5) 5px 5px 10px 3px":"unset",b=null==d?void 0:d.name;return(0,r.jsx)(i.u,{label:"model"===m?b:"".concat(b," (").concat(m,")"),placement:"top",children:(0,r.jsxs)(a.k,{width:"300px",_hover:{backgroundColor:p?"gray.100":y},borderColor:C,borderWidth:1,borderStyle:j,backgroundColor:p?"white":y,borderRadius:3,boxShadow:v,transition:"box-shadow 0.2s ease-in-out",padding:0,className:!0===u?"node-highlight":!0===h?"node-highlight":!1===u?"node-unhighlight":void 0,children:[(0,r.jsx)(a.k,{backgroundColor:y,padding:2,borderRightWidth:1,borderColor:C,borderStyle:j,alignItems:"top",visibility:p?"inherit":"hidden",children:(0,r.jsx)(s.J,{as:g})}),(0,r.jsxs)(a.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:[(0,r.jsxs)(a.k,{width:"100%",textAlign:"left",flex:"1",p:1,alignItems:"center",visibility:p?"inherit":"hidden",children:[(0,r.jsx)(l.xu,{flex:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:b}),c&&(0,r.jsx)(a.k,{children:(0,r.jsx)(s.J,{color:y,as:c,flex:"0 0 20px"})})]}),"model"===d.resourceType&&(0,r.jsx)(a.k,{flex:"1 0 auto",mx:"1",direction:"column",paddingBottom:"1",visibility:p?"inherit":"hidden",children:(0,r.jsxs)(f.U,{spacing:"8px",children:[(0,r.jsx)(T.L,{}),(0,r.jsx)(RowCountTag,{node:d,isInteractive:!1})]})})]}),Object.keys(null!==(n=null==d?void 0:d.parents)&&void 0!==n?n:{}).length>0&&(0,r.jsx)(o.HH,{type:"target",position:o.Ly.Left,isConnectable:!1}),Object.keys(null!==(t=null==d?void 0:d.children)&&void 0!==t?t:{}).length>0&&(0,r.jsx)(o.HH,{type:"source",position:o.Ly.Right,isConnectable:!1})]})})}function GraphEdge(e){let{sourceX:n,sourceY:t,targetX:l,targetY:i,sourcePosition:a,targetPosition:s,style:c={},markerEnd:d,data:u}=e,h={...c};(null==u?void 0:u.changeStatus)&&(h.stroke=getIconForChangeStatus(null==u?void 0:u.changeStatus).color,h.strokeDasharray="5"),(null==u?void 0:u.isHighlighted)===!1&&(h.filter="opacity(0.2) grayscale(50%)");let[m]=(0,o.OQ)({sourceX:n,sourceY:t,sourcePosition:a,targetX:l,targetY:i,targetPosition:s});return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(o.u5,{path:m,markerEnd:d,style:{...h,...c}})})}var en=t(67907),et=t(74796),er=t(79315),eo=t(58909),el=t(2593),ei=t(55344),ea=t(1726),es=t(83622),ec=t(21801),ed=t(29731),eu=t(18974);function mergeKeys(e,n){let t=[...e],r=[...n],o=[];for(;t.length>0&&r.length>0;)if(o.includes(t[0]))t.shift();else if(o.includes(r[0]))r.shift();else if(t[0]===r[0])o.push(t[0]),t.shift(),r.shift();else if(r.includes(t[0])){let e=r.indexOf(t[0]);for(let n=0;n<e;n++)o.includes(r[n])||o.push(r[n]);o.push(t[0]),t.shift(),r.splice(0,e+1)}else o.push(t[0]),t.shift();return t.forEach(e=>{o.includes(e)||o.push(e)}),r.forEach(e=>{o.includes(e)||o.push(e)}),o}function mergeKeysWithStatus(e,n){let t=mergeKeys(e,n),r={};for(let o of t)e.includes(o)?n.includes(o)?r[o]=void 0:r[o]="removed":r[o]="added";let o={};e.forEach((e,n)=>{o[e]=n});let l=-1;for(let e of t){let n=o[e];void 0!==n&&(n>l?l=n:r[e]="reordered")}return r}function mergeColumns(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={},r=mergeKeysWithStatus(Object.keys(e),Object.keys(n));return Object.entries(r).forEach(e=>{let[n,r]=e;t[n]={name:n,reordered:"reordered"===r}}),Object.entries(e).map((e,n)=>{let[r,o]=e;t[r].baseIndex=n+1,t[r].baseType=o.type}),Object.entries(n).map((e,n)=>{let[r,o]=e;t[r].currentIndex=n+1,t[r].currentType=o.type}),t}function toDataGrid(e){function columnIndexCellClass(e){return void 0===e.baseIndex?"column-index-added":void 0===e.currentIndex?"column-index-removed":!0===e.reordered?"column-index-reordered":"column-index-normal"}function columnNameCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":!0===e.reordered?"column-body-reordered":"column-body-normal"}function columnTypeCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":e.baseType!==e.currentType?"column-body-type-changed":!0===e.reordered?"column-body-reordered":"column-body-normal"}let n=Object.values(e);return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"currentIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"name",name:"Name",resizable:!0,cellClass:columnNameCellClass},{key:"baseType",name:"Base Type",resizable:!0,cellClass:columnTypeCellClass},{key:"currentType",name:"Current Type",resizable:!0,cellClass:columnTypeCellClass}],rows:n}}t(75165),t(91702);var eh=t(93683),em=t(7873),ex=t(52116),ef=t(47367),ep=t(55201),eg=t.n(ep);function useClipBoardToast(){let e=(0,c.p)();return{successToast:function(n){e({description:n,status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})},failToast:function(n,t){e({title:n,description:"".concat(t),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}}}let ey="ignore-screenshot";function useToBlob(e){let{imageType:n="png",backgroundColor:t=null,boardEffect:r=!0,shadowEffect:o=!1,borderStyle:l="solid 1px #ccc",borderRadius:i="10px",onSuccess:a,onError:s,ignoreElements:c}=e,[d,u]=(0,S.useState)("idle"),h=(0,S.useRef)(null),toImage=async()=>{if(!h.current){console.error("No node to use for screenshot"),u("error"),s&&s(Error("No node to use for screenshot"));return}let e=h.current.element||h.current,d=e.style.overflow,m=e.style.border,x=e.style.borderRadius,f=e.style.backgroundColor;function resetStyles(){e.style.overflow=d,e.style.border=m,e.style.borderRadius=x,e.style.backgroundColor=f}try{var p;e.style.overflow="hidden",e.style.border=r?l:"",e.style.borderRadius=r?i:"",e.style.backgroundColor=t||"";let d=document.createElement("style");document.head.appendChild(d),null===(p=d.sheet)||void 0===p||p.insertRule("body > div:last-child img { display: inline-block; }"),u("loading");let h=await eg()(e,{logging:!1,backgroundColor:null,ignoreElements:c});d.remove();let m=o?document.createElement("canvas"):h;if(o){m.width=h.width+80,m.height=h.height+80;let e=m.getContext("2d");if(e)e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=20,e.shadowOffsetX=10,e.shadowOffsetY=10,e.drawImage(h,40,40);else{console.error("Error getting canvas context"),u("error"),s&&s(Error("Error getting canvas context to add shadow effect"));return}}m.toBlob(async e=>{u("success"),a&&e&&await a(e)},"image/".concat(n))}catch(e){console.error("Error converting to image",e),u("error"),s&&s(e);return}finally{resetStyles()}};return{status:d,isLoading:"loading"===d,isErrored:"error"===d,isSuccess:"success"===d,toImage,ref:h}}async function copyBlobToClipboard(e){if(!e)throw Error("No blob to copy to clipboard");try{await navigator.clipboard.write([new ClipboardItem({[e.type]:e})])}catch(e){throw console.error("Error copying to clipboard",e),e}}function useCopyToClipboardButton(){let{successToast:e,failToast:n}=useClipBoardToast(),{isLoading:t,toImage:o,ref:l}=useToBlob({imageType:"png",shadowEffect:!0,onSuccess:async t=>{try{await copyBlobToClipboard(t),e("Copied the query result as an image to clipboard")}catch(e){n("Failed to copy image to clipboard",e)}},onError:e=>{console.error("Error taking screenshot",e),n("Failed to copy image to clipboard",e)}});function CopyToClipboardButton(e){let{imageType:n="png",...i}=e;return(0,r.jsx)(x.z,{size:"sm",leftIcon:(0,r.jsx)(ef.T,{}),style:{position:"absolute",bottom:"16px",right:"16px"},isLoading:t,onMouseEnter:()=>{if(l.current){let e=l.current.element||l.current;e.style.boxShadow="rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px",e.style.transition="box-shadow 0.5s ease-in-out"}},onMouseLeave:()=>{if(l.current){let e=l.current.element||l.current;e.style.boxShadow=""}},onClick:async()=>{l.current&&await o()},children:"Copy to Clipboard"})}return{ref:l,CopyToClipboardButton}}function ScreenshotDataGrid(e){let{enableScreenshot:n=!0,...t}=e,{ref:o,CopyToClipboardButton:l}=useCopyToClipboardButton();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ex.ZP,{ref:o,...t}),n&&(0,r.jsx)(l,{imageType:"png"})]})}function SchemaView(e){let n,{base:t,current:o,enableScreenshot:l=!1}=e,{columns:i,rows:s}=(0,S.useMemo)(()=>toDataGrid(mergeColumns(null==t?void 0:t.columns,null==o?void 0:o.columns)),[t,o]),c=t&&void 0===t.columns,d=o&&void 0===o.columns;return c&&d?n="catalog.json is missing on both current and base environments.":c?n="catalog.json is missing on base environment.":d&&(n="catalog.json is missing on current environment."),(0,r.jsxs)(a.k,{direction:"column",children:[n&&(0,r.jsxs)(eh.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,r.jsx)(em.z,{}),n]}),s.length>0&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:i,rows:s,className:"rdg-light",enableScreenshot:l})})]})}var ej=t(29357);function SqlDiffView(e){let{base:n,current:t}=e;return(0,r.jsx)(ej.SV,{height:"500px",language:"sql",theme:"vs",original:null==n?void 0:n.raw_code,modified:null==t?void 0:t.raw_code,options:{readOnly:!0,fontSize:14,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same"}})}var eC=t(32865);async function createSimpleCheck(){let e=await G.post("/api/checks",{type:"simple"}),n=e.data;return n}async function createCheckByNodeSchema(e){let n=await G.post("/api/checks",{type:"schema_diff",params:{node_id:e}}),t=n.data;return t}async function createCheckByRun(e,n){let t=await G.post("/api/checks",{run_id:e,view_options:n}),r=t.data;return r}async function listChecks(){let e=await G.get("/api/checks");return e.data}async function getCheck(e){let n=await G.get("/api/checks/".concat(e));return n.data}async function updateCheck(e,n){let t=await G.patch("/api/checks/".concat(e),n);return t.data}async function deleteCheck(e){let n=await G.delete("/api/checks/".concat(e));return n.data}async function reorderChecks(e){return await G.post("/api/checks/reorder",e)}var ev=t(84680),eb=t(70556),ek=t(46016);let RunView=e=>{var n,t;let{isPending:o,isAborting:i,progress:s,error:c,run:d,onCancel:u,viewOptions:f,onViewOptionsChanged:p,RunResultView:g,children:y}=e;if(y&&g)throw Error("RunView requires either a children or a RunResultView prop, but not both.");if(!y&&!g)throw Error("RunView requires at least one of children or RunResultView prop.");let j=(null==c?void 0:null===(t=c.response)||void 0===t?void 0:null===(n=t.data)||void 0===n?void 0:n.detail)||(null==d?void 0:d.error);if(j)return(0,r.jsxs)(eh.b,{status:"error",children:[(0,r.jsx)(em.z,{}),"Error: ",j]});if(o){let e=(null==s?void 0:s.message)?null==s?void 0:s.message:"Loading...";return(0,r.jsx)(h.M,{p:"16px",height:"100%",bg:"rgb(249,249,249)",children:(0,r.jsxs)(m.g,{children:[(0,r.jsxs)(a.k,{alignItems:"center",children:[(null==s?void 0:s.percentage)===void 0||(null==s?void 0:s.percentage)===null?(0,r.jsx)(ek.D,{isIndeterminate:!0,size:"20px",mr:"8px"}):(0,r.jsx)(ek.D,{size:"20px",value:100*s.percentage,mr:"8px"}),i?(0,r.jsx)(r.Fragment,{children:"Aborting..."}):(0,r.jsx)(r.Fragment,{children:e})]}),!i&&(0,r.jsx)(x.z,{onClick:u,colorScheme:"blue",size:"sm",children:"Cancel"})]})})}return d?(0,r.jsxs)(l.xu,{h:"100%",style:{contain:"size layout"},children:[g&&(0,r.jsx)(g,{run:d,viewOptions:f,onViewOptionsChanged:p}),y&&y({run:d,viewOptions:f,onViewOptionsChanged:p})]}):(0,r.jsx)(h.M,{bg:"rgb(249,249,249)",height:"100%",children:"No data"})},RunModal=e=>{let{type:n,title:t,params:o,RunEditView:i,RunResultView:s}=e,[,c]=(0,eC.TH)(),{isOpen:u,onOpen:h,onClose:m}=(0,d.q)(),[f,p]=(0,S.useState)(),[b,k]=(0,S.useState)(o),[w,_]=(0,S.useState)(!1),[R,N]=(0,S.useState)(),[E,D]=(0,S.useState)(),submitRunFn=async()=>{let{run_id:e}=await submitRun(n,b,{nowait:!0});for(p(e);;){let n=await waitRun(e,2);if(N(n.progress),n.result||n.error)return _(!1),N(void 0),n}},{data:T,mutate:O,reset:I,error:L,isPending:z}=(0,eb.D)({mutationFn:submitRunFn});(0,S.useEffect)(()=>{u&&void 0===i&&O()},[u]);let F=(0,Q.NL)(),M=(0,S.useCallback)(async()=>{if(_(!0),f)return await cancelRun(f)},[f]),q=(0,S.useCallback)(()=>{O()},[O]),P=(0,S.useCallback)(()=>{O()},[O]),handleReset=()=>{_(!1),k(o),N(void 0),I()},V=(0,S.useCallback)(async()=>{if(!(null==T?void 0:T.run_id))return;let e=await createCheckByRun(T.run_id,E);F.invalidateQueries({queryKey:X.checks()}),c("/checks/".concat(e.check_id))},[null==T?void 0:T.run_id,c,F,E]),handleClose=async()=>{m(),z&&f&&await cancelRun(f),handleReset()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(g.u_,{isOpen:u,onClose:handleClose,size:"6xl",children:[(0,r.jsx)(y.Z,{}),(0,r.jsxs)(j.h,{overflowY:"auto",height:"75%",children:[(0,r.jsx)(eo.x,{children:t}),(0,r.jsx)(C.o,{}),(0,r.jsx)(v.f,{p:"0px",h:"100%",overflow:"auto",borderY:"1px solid lightgray",children:z||T||L?(0,r.jsx)(RunView,{isPending:z,isAborting:w,run:T,error:L,progress:R,onCancel:M,viewOptions:E,onViewOptionsChanged:D,RunResultView:s}):(0,r.jsx)(l.xu,{style:{contain:"size layout"},children:i&&(0,r.jsx)(i,{params:b,onParamsChanged:k})})}),(0,r.jsx)(ev.m,{children:(0,r.jsxs)(a.k,{gap:"10px",children:[T&&i&&(0,r.jsx)(x.z,{colorScheme:"blue",onClick:handleReset,children:"Reset"}),(null==T?void 0:T.result)&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(x.z,{colorScheme:"blue",onClick:V,children:"Add to checklist"})}),z&&(0,r.jsx)(x.z,{onClick:M,isDisabled:w,colorScheme:"blue",children:"Cancel"}),!T&&!z&&(0,r.jsx)(x.z,{isDisabled:z,colorScheme:"blue",onClick:q,children:"Execute"}),T&&!i&&(0,r.jsx)(x.z,{colorScheme:"blue",onClick:P,children:"Rerun"})]})})]})]}),(0,r.jsx)(x.z,{colorScheme:"blue",size:"sm",onClick:h,children:t})]})};var ew=t(83978),eS=t.n(ew);function _getColumnMap(e,n){let t={},r=mergeKeysWithStatus(e.columns.map(e=>e.name),n.columns.map(e=>e.name));return Object.entries(r).map(r=>{let[o,l]=r;t[o]={status:l,baseColumnIndex:e.columns.findIndex(e=>e.name===o),currentColumnIndex:n.columns.findIndex(e=>e.name===o)}}),t}function _getPrimaryKeyIndexes(e,n){let t=[];for(let r of n){let n=e.findIndex(e=>e.name===r);if(n<0)throw Error("Column ".concat(r," not found"));t.push(n)}return t}function _getPrimaryKeyValue(e,n,t){let r={};if(0===n.length)return JSON.stringify({_index:t._index});for(let o of n){let n=e[o];r[n.name]=t[o]}return JSON.stringify(r)}function DataFrameColumnGroupHeader(e){let{name:n,columnStatus:t,onPrimaryKeyChange:o,onPinnedColumnsChange:i,...c}=e,d=c.primaryKeys||[],u=c.pinnedColumns||[],h=d.includes(n),m=u.includes(n);return"index"===n?(0,r.jsx)(r.Fragment,{}):(0,r.jsxs)(a.k,{alignItems:"center",gap:"10px",className:"grid-header",children:[(0,r.jsx)(l.xu,{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:n}),"added"!==t&&"removed"!==t&&o&&(0,r.jsx)(s.J,{className:h?"close-icon":"key-icon",display:h?"block":"none",cursor:"pointer",as:h?O.ven:O.MhP,onClick:h?()=>{let e=d.filter(e=>e!==n);o&&o(e)}:()=>{let e=[...d.filter(e=>"index"!==e),n];o&&o(e)}}),!h&&i&&(0,r.jsx)(s.J,{className:m?"unpin-icon":"pin-icon",display:m?"block":"none",cursor:"pointer",as:m?O.$kI:O.oJP,onClick:m?()=>{let e=u.filter(e=>e!==n);i&&i(e)}:()=>{let e=[...u,n];i&&i(e)}})]})}t(7866);let defaultRenderCell=e=>{let{row:n,column:t}=e,o=n[t.key];return(0,r.jsx)(r.Fragment,{children:"boolean"==typeof o?o.toString():o})};function toDataDiffGrid(e,n,t){let o=e||{columns:[],data:[]},l=n||{columns:[],data:[]},i=(null==t?void 0:t.primaryKeys)||[],a=(null==t?void 0:t.pinnedColumns)||[],s=(null==t?void 0:t.changedOnly)||!1,c=[],d=_getColumnMap(o,l),u={},h={};if(0===i.length)o.data.forEach((e,n)=>{e._index=n+1,u[JSON.stringify({_index:n+1})]=e}),l.data.forEach((e,n)=>{e._index=n+1,h[JSON.stringify({_index:n+1})]=e});else{let e=_getPrimaryKeyIndexes(o.columns,i);o.data.forEach((n,t)=>{let r=_getPrimaryKeyValue(o.columns,e,n);u[r]=n}),e=_getPrimaryKeyIndexes(l.columns,i),l.data.forEach((n,t)=>{let r=_getPrimaryKeyValue(l.columns,e,n);h[r]=n})}let m=mergeKeysWithStatus(Object.keys(u),Object.keys(h)),x=Object.entries(m).map(e=>{let[n,t]=e,r=u[n],a=h[n],s=JSON.parse(n);if(r&&o.columns.forEach((e,n)=>{i.includes(e.name)||(s["base__".concat(e.name)]=r[n])}),a&&l.columns.forEach((e,n)=>{i.includes(e.name)||(s["current__".concat(e.name)]=a[n])}),r){if(a)for(let[e,n]of Object.entries(d))"index"===e||i.includes(e)||n.baseColumnIndex<0||n.currentColumnIndex<0||eS().isEqual(r[n.baseColumnIndex],a[n.currentColumnIndex])||(s.status="modified",n.status="modified");else s.status="removed"}else s.status="added";return s});s&&(x=x.filter(e=>"added"===e.status||"removed"===e.status||"modified"===e.status));let toColumn=(e,n)=>{let o="added"===n?"diff-header-added":"removed"===n?"diff-header-removed":void 0,cellClass=t=>{let r=t.status;if("removed"===r)return"diff-cell-removed";if("added"===r)return"diff-cell-added";if("added"===n);else if("removed"===n);else if(!eS().isEqual(t["base__".concat(e)],t["current__".concat(e)]))return"diff-cell-modified"};return{headerCellClass:o,name:(0,r.jsx)(DataFrameColumnGroupHeader,{name:e,columnStatus:n,...t}),children:[{key:"base__".concat(e),name:"Base",renderEditCell:ex.Ug,headerCellClass:o,cellClass,renderCell:defaultRenderCell,size:"auto"},{key:"current__".concat(e),name:"Current",renderEditCell:ex.Ug,headerCellClass:o,cellClass,renderCell:defaultRenderCell,size:"auto"}]}};return 0===i.length?c.push({key:"_index",name:"",cellClass:"index-column"}):i.forEach(e=>{let n=d[e].status||"";c.push({key:"".concat(e),name:(0,r.jsx)(DataFrameColumnGroupHeader,{name:e,columnStatus:n,...t}),frozen:!0,cellClass:e=>{if(e.status)return"diff-header-".concat(e.status)}})}),a.forEach(e=>{let n=d[e].status||"";"index"===e||i.includes(e)||c.push(toColumn(e,n))}),Object.entries(d).forEach(e=>{let[n,t]=e,r=t.status||"";"index"===n||i.includes(n)||a.includes(n)||s&&"added"!==r&&"removed"!==r&&"modified"!==r||c.push(toColumn(n,r))}),{columns:c,rows:x}}function ProfileDiffResultView(e){var n;let{run:t,viewOptions:o,onViewOptionsChanged:l}=e,i=t.result;t.params;let a=(0,S.useMemo)(()=>(null==o?void 0:o.pinned_columns)||[],[o]),s=((null==i?void 0:null===(n=i.current)||void 0===n?void 0:n.columns)||[]).find(e=>"column_name"===e.name.toLowerCase()),c=(null==s?void 0:s.name)||"column_name",d=(0,S.useMemo)(()=>toDataDiffGrid(null==i?void 0:i.base,null==i?void 0:i.current,{primaryKeys:[c],pinnedColumns:a,onPinnedColumnsChange:e=>{l&&l({...o,pinned_columns:e})}}),[i,c,a,o,l]);return 0===d.columns.length?(0,r.jsx)(h.M,{height:"100%",children:"No data"}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:d.columns,rows:d.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})})}let ProfileDiffModal=e=>{let{node:n}=e;return(0,r.jsx)(RunModal,{title:"Profile Diff",type:"profile_diff",params:{model:n.name},RunResultView:ProfileDiffResultView})};function ValueDiffResultView(e){let{run:n}=e,t=n.result,o=n.params,cellClass=e=>{let n=e[2];return null!=n&&n<1?"diff-cell-modified":""};return(0,r.jsxs)(a.k,{direction:"column",gap:"5px",pt:"5px",height:"100%",children:[(0,r.jsxs)(l.xu,{px:"16px",children:["Model: ",o.model,", ",t.summary.total," total (",t.summary.total-t.summary.added-t.summary.removed," ","common, ",t.summary.added," added, ",t.summary.removed," removed)"]}),(0,r.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",borderBlock:"1px solid lightgray"},columns:[{key:"__is_pk__",name:"",maxWidth:30,renderCell:e=>{let{row:n}=e;return(0,r.jsx)(h.M,{height:"100%",children:n[0]===o.primary_key&&(0,r.jsx)(s.J,{as:O.MhP})})}},{key:"0",name:"Column",resizable:!0},{key:"1",name:"Matched",resizable:!0,cellClass},{key:"2",name:"Matched %",resizable:!0,renderCell:e=>{let{column:n,row:t}=e,o=t[n.key];return(0,r.jsx)(l.xu,{textAlign:"end",children:void 0!=o&&null!==o?"".concat((100*o).toFixed(2)," %"):"N/A"})},cellClass}],rows:t.data.data,defaultColumnOptions:{resizable:!0},className:"rdg-light",enableScreenshot:!0})]})}var e_=t(41171),eR=t(53930),eN=t(68665),eE=t(99691);async function getLineage(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=await G.get("/api/lineage?base=".concat(e));return n.data}async function getLineageWithError(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let n=await getLineage(e);return{data:n}}catch(e){if(!(e instanceof eE.d7))return{error:null==e?void 0:e.message};{var n,t;let r=null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(n=t.data)||void 0===n?void 0:n.detail;if(r)return{error:r};return{error:null==e?void 0:e.message}}}}async function getLineageDiff(){let[e,n]=await Promise.all([getLineageWithError(!0),getLineageWithError(!1)]);return{base:e.data,current:n.data,base_error:e.error,current_error:n.error}}var eD=t(21123),eT=t.n(eD);let eO=(0,S.createContext)({});function LineageWatcher(e){let{refetch:n}=e,t=(0,c.p)(),[o,l]=(0,S.useState)(),i=(0,Q.NL)();return(0,S.useEffect)(()=>{function httpUrlToWebSocketUrl(e){return e.replace(/(http)(s)?\:\/\//,"ws$2://")}let e=new WebSocket("".concat(httpUrlToWebSocketUrl(K),"/api/ws"));return l(e),e.onopen=()=>{e.send("ping")},e.onmessage=e=>{if("pong"!==e.data)try{let n=JSON.parse(e.data);if("refresh"===n.command){let{eventType:e,srcPath:r}=n.event,[o,l]=r.split("/").slice(-2),a=eT().parse(l).name;t({description:"Detected ".concat(o," ").concat(a," ").concat(e),status:"info",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0}),i.invalidateQueries({queryKey:X.lineage()})}}catch(e){console.error(e)}},()=>{e&&e.close()}},[t,i]),(0,r.jsx)(r.Fragment,{})}function LineageGraphsContextProvider(e){let{children:n}=e,{data:t,isLoading:o,error:l,refetch:i}=(0,ee.a)({queryKey:X.lineage(),queryFn:getLineageDiff}),a=(0,S.useMemo)(()=>{if(t)return buildDefaultLineageGraphSets(t.base,t.current)},[t]),s=(null==l?void 0:l.message)||(null==t?void 0:t.current_error)||(null==t?void 0:t.base_error);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(LineageWatcher,{refetch:i}),(0,r.jsx)(eO.Provider,{value:{lineageGraphSets:a,error:s,isLoading:o},children:n})]})}let useLineageGraphsContext=()=>(0,S.useContext)(eO);function extractColumnNames(e){function getNames(e){return e&&e.columns?Object.values(e.columns).map(e=>e.name):[]}let n=getNames(e.data.base),t=getNames(e.data.current),r=[];return n.forEach(e=>{r.includes(e)||r.push(e)}),t.forEach(e=>{r.includes(e)||r.push(e)}),r}function ValueDiffEditView(e){var n;let{params:t,onParamsChanged:o}=e,i=useLineageGraphsContext(),a=eS().find(null===(n=i.lineageGraphSets)||void 0===n?void 0:n.all.nodes,{name:null==t?void 0:t.model}),s=a?extractColumnNames(a):[];return(0,r.jsx)(l.xu,{m:"16px",children:(0,r.jsxs)(e_.NI,{children:[(0,r.jsx)(eR.l,{children:"Pick a primary key"}),(0,r.jsx)(eN.P,{placeholder:"Select primary key",value:null==t?void 0:t.primary_key,onChange:e=>{let n=e.target.value;o({...t,primary_key:n})},children:s.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]})})}let ValueDiffModal=e=>{let{node:n}=e;return(0,r.jsx)(RunModal,{title:"Value Diff",type:"value_diff",params:{model:n.name,primary_key:""},RunEditView:ValueDiffEditView,RunResultView:ValueDiffResultView})};function NodeView(e){let{node:n,onCloseNode:t}=e,[,o]=(0,eC.TH)(),{setSqlQuery:i}=useRecceQueryContext(),{fetchFn:s}=useRowCountQueries([n.name]),c="model"===n.resourceType||"seed"===n.resourceType||"source"===n.resourceType,{isOpen:u,onOpen:h,onClose:m}=(0,d.q)(),p=(0,S.useCallback)(async()=>{let e=n.id,t=await createCheckByNodeSchema(e);o("/checks/".concat(t.check_id))},[n,o]),_=(0,S.useCallback)(async()=>{let e=await s({skipCache:!0}),n=await createCheckByRun(e);o("/checks/".concat(n.check_id))},[o,s]);return(0,r.jsxs)(et.r,{height:"100%",templateRows:"auto auto 1fr",children:[(0,r.jsxs)(f.U,{children:[(0,r.jsx)(l.xu,{flex:"0 1 20%",p:"16px",children:(0,r.jsx)(er.X,{size:"sm",children:n.name})}),(0,r.jsx)(T.L,{}),"modified"===n.changeStatus&&(0,r.jsxs)(l.xu,{children:[(0,r.jsx)(x.z,{onClick:h,leftIcon:(0,r.jsx)(I.tvD,{}),colorScheme:"orange",variant:"solid",children:"Diff"}),(0,r.jsxs)(g.u_,{isOpen:u,onClose:m,size:"6xl",children:[(0,r.jsx)(y.Z,{}),(0,r.jsxs)(j.h,{overflowY:"auto",height:"75%",children:[(0,r.jsx)(eo.x,{children:"Model Raw Code Diff"}),(0,r.jsx)(C.o,{}),(0,r.jsx)(v.f,{children:(0,r.jsx)(SqlDiffView,{base:n.data.base,current:n.data.current})})]})]})]}),(0,r.jsx)(l.xu,{flex:"0 1 1%",p:"16px",children:(0,r.jsx)(el.P,{onClick:t})})]}),(0,r.jsx)(l.xu,{color:"gray",paddingLeft:"16px",children:(0,r.jsxs)(f.U,{spacing:"8px",children:[(0,r.jsx)(ResourceTypeTag,{node:n}),"model"===n.resourceType&&(0,r.jsx)(RowCountTag,{node:n})]})}),c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(ei.m,{overflow:"auto",as:a.k,children:[(0,r.jsx)(ea.t,{children:(0,r.jsx)(es.O,{children:"Columns"})}),(0,r.jsx)(ec.n,{overflow:"auto",height:"calc(100% - 42px)",children:(0,r.jsx)(ed.x,{p:0,overflowY:"auto",height:"100%",children:(0,r.jsx)(SchemaView,{base:n.data.base,current:n.data.current})})})]}),(0,r.jsxs)(f.U,{p:"16px",children:[(0,r.jsxs)(b.v,{children:[(0,r.jsx)(eu.j,{as:x.z,size:"sm",colorScheme:"blue",children:"Add check"}),(0,r.jsxs)(k.q,{children:[(0,r.jsx)(w.s,{onClick:p,children:"Schema Check"}),(0,r.jsx)(w.s,{onClick:_,children:"Row Count Check"})]})]}),(0,r.jsx)(T.L,{}),"model"===n.resourceType&&(0,r.jsxs)(r.Fragment,{children:["added"!==n.changeStatus&&"removed"!==n.changeStatus&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ProfileDiffModal,{node:n},"profile_diff_".concat(null==n?void 0:n.id)),(0,r.jsx)(ValueDiffModal,{node:n},"value_diff_".concat(null==n?void 0:n.id))]}),(0,r.jsx)(x.z,{colorScheme:"blue",size:"sm",onClick:()=>{i('select * from {{ ref("'.concat(n.name,'") }}')),o("/query")},children:"Query"})]})]})]})]})}var eI=t(17180);let eL={added:["Model Added","Added resource"],removed:["Model Removed","Removed resource"],modified:["Model Modified","Modified resource"],col_added:["Column Added","Added column"],col_removed:["Column Removed","Removed column"],col_changed:["Column Modified","Modified column"],folder_changed:["Modified","Modified folder"]};function ChangeSummary_getIconForChangeStatus(e){if("added"===e)return{color:"#1dce00",icon:z};if("removed"===e)return{color:"#ff067e",icon:F};if("modified"===e)return{color:"#ffa502",icon:M};if("col_added"===e)return{color:"#1dce00",icon:z};if("col_removed"===e)return{color:"#ff067e",icon:F};if("col_changed"===e)return{color:"#ffa502",icon:M};if("folder_changed"===e)return{color:"#ffa502",icon:IconChanged};return{color:"inherit",icon:void 0}}function SummaryText(e){let{name:n,value:t,tip:o}=e;return(0,r.jsxs)(m.g,{alignItems:"stretch",children:[(0,r.jsxs)(p.x,{fontSize:"sm",color:"gray",children:[n,o&&(0,r.jsx)(i.u,{label:o,children:(0,r.jsx)(l.xu,{display:"inline-block",children:(0,r.jsx)(s.J,{mx:"2px",as:B.H33,boxSize:3})})})]}),t]})}function ChangeStatusCountLabel(e){let{changeStatus:n,value:t}=e,[o]=n?eL[n]:[""],{icon:l,color:i}=ChangeSummary_getIconForChangeStatus(n);return(0,r.jsxs)(m.g,{alignItems:"stretch",children:[(0,r.jsxs)(a.k,{alignItems:"center",fontSize:"sm",color:"gray",children:[(0,r.jsx)(s.J,{mr:"5px",as:l,color:i}),o]}),(0,r.jsx)(p.x,{fontSize:"sm",children:t})]})}function calculateColumnChange(e,n){let t=0,r=0,o=0;return(e||n)&&(n&&Object.keys(n.columns||{}).forEach(n=>{(!e||!e.columns||!e.columns[n])&&t++}),e&&Object.keys(e.columns||{}).forEach(e=>{(!n||!n.columns||!n.columns[e])&&r++}),n&&e&&Object.keys(n.columns||{}).forEach(t=>{e.columns&&n.columns&&e.columns[t]&&e.columns[t].type!==n.columns[t].type&&o++})),{adds:t,removes:r,modifies:o}}function calculateChangeSummary(e,n){let t=0,r=0,o=0,l=0,i=0,a=0;return n.forEach(n=>{"added"===e.nodes[n].changeStatus?t++:"removed"===e.nodes[n].changeStatus?r++:"modified"===e.nodes[n].changeStatus&&o++;let s=e.nodes[n].data.base,c=e.nodes[n].data.current,d=calculateColumnChange(s,c);l+=d.adds,i+=d.removes,a+=d.modifies}),{adds:t,removes:r,modifies:o,col_added:l,col_removed:i,col_changed:a}}function ChangeSummary(e){let{lineageGraphSets:n}=e,{adds:t,removes:o,modifies:i,col_added:a,col_removed:s,col_changed:c}=calculateChangeSummary(n.all,n.modifiedSet);return(0,r.jsxs)(et.r,{templateColumns:"1fr 1fr",mb:"10px",borderTop:"1px solid lightgray",padding:"2.5vw",children:[(0,r.jsx)(l.xu,{borderColor:"lightgray",children:(0,r.jsx)(SummaryText,{name:"Code Changes",value:(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(et.r,{templateColumns:"1fr 1fr 1fr",width:"100%",children:[(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"added",value:t}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"removed",value:o}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"modified",value:i})]})})})}),(0,r.jsx)(l.xu,{borderLeft:"1px",paddingLeft:"12px",borderColor:"lightgray",children:(0,r.jsx)(SummaryText,{name:"Column Changes",value:(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(et.r,{templateColumns:"1fr 1fr 1fr",width:"100%",children:[(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"col_added",value:a}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"col_removed",value:s}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"col_changed",value:c})]})})})})]})}var ez=t(76353),eF=t(53248),eM=t(9763),eq=t(95853);function SchemaDiffCard(e){let{node:n,...t}=e;return(0,r.jsxs)(ez.Z,{maxWidth:"500px",children:[(0,r.jsxs)(eF.O,{children:[(0,r.jsx)(er.X,{fontSize:18,children:t.title}),(0,r.jsxs)(f.U,{spacing:"8px",p:"16px",children:[(0,r.jsx)(ResourceTypeTag,{node:n}),"model"===n.resourceType&&(0,r.jsx)(RowCountTag,{node:n,isAutoFetching:!0})]})]}),(0,r.jsx)(eM.e,{children:(0,r.jsx)(a.k,{children:(0,r.jsx)(SchemaView,{base:n.data.base,current:n.data.current})})})]})}function listChangedNodes(e){let n=[],t=e.all.nodes;return e.modifiedSet.forEach(e=>{var r,o;let l=t[e],i=mergeKeysWithStatus(Object.keys((null===(r=l.data.base)||void 0===r?void 0:r.columns)||{}),Object.keys((null===(o=l.data.current)||void 0===o?void 0:o.columns)||{})),a=!Object.values(i).every(e=>void 0===e);a&&l.data.base&&l.data.current&&n.push(l)}),n}function SchemaSummary(e){let{lineageGraphSets:n}=e,[t,o]=(0,S.useState)([]);return(0,S.useEffect)(()=>{o(listChangedNodes(n))},[n]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",marginTop:"20px",children:(0,r.jsx)(er.X,{fontSize:24,children:"Schema Summary"})}),(0,r.jsx)(a.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",children:0===t.length?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(p.x,{fontSize:18,color:"gray",children:"No schema changes detected."})}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(eq.M,{minChildWidth:"400px",spacing:"2vw",padding:"2.5vw",width:"100%",backgroundColor:"lightgray",children:t.map(e=>(0,r.jsx)(SchemaDiffCard,{title:e.name,node:e},e.id))})})})]})}function SummaryView(){let{lineageGraphSets:e}=useLineageGraphsContext();return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(a.k,{direction:"column",w:"100%",minHeight:"650px",children:[(0,r.jsx)(a.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",children:(0,r.jsx)(er.X,{fontSize:24,children:"Change Summary"})}),e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ChangeSummary,{lineageGraphSets:e}),(0,r.jsx)(eI.i,{}),(0,r.jsx)(SchemaSummary,{lineageGraphSets:e})]})]})})}var eP=t(45438),eV=t(40312),eB=t(52246),eA=t(25807);function AddSchemaChangesCheckButton(e){let{nodes:n,onFinish:t}=e,[,o]=(0,eC.TH)();return(0,r.jsxs)(x.z,{size:"xs",variant:"outline",isDisabled:0===n.length,onClick:async()=>{let e;1===n.length?e=await createCheckByNodeSchema(n[0].id):await Promise.all(n.map(async e=>{await createCheckByNodeSchema(e.id)})),t(),e?o("/checks/".concat(e.check_id)):o("/checks")},children:[(0,r.jsx)(s.J,{as:A.Edg}),"Add schema check"]})}function AddRowCountCheckButton(e){let{nodes:n,onFinish:t}=e,[,o]=(0,eC.TH)(),{isLoading:l,fetchFn:i}=useRowCountQueries(n.map(e=>e.name));return(0,r.jsxs)(x.z,{size:"xs",variant:"outline",isDisabled:l||0===n.length,onClick:async()=>{let e=await i({skipCache:!0}),n=await createCheckByRun(e);n?o("/checks/".concat(n.check_id)):o("/checks"),t()},children:[(0,r.jsx)(s.J,{as:B.SwK}),l?"Adding row count check":"Add row count check"]})}function NodeSelector(e){let{nodes:n,isOpen:t,onClose:o}=e;function countSelectedNodes(e){return e.filter(e=>e.isSelected).length}let i=n.filter(e=>e.isSelected);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(eV.R,{in:t,style:{zIndex:10},children:(0,r.jsx)(l.xu,{bg:"white",rounded:"md",shadow:"dark-lg",children:(0,r.jsxs)(f.U,{p:"5px 15px",mt:"4",divider:(0,r.jsx)(eB.c,{borderColor:"gray.200"}),spacing:4,children:[(0,r.jsxs)(eA.h,{size:"xs",isAttached:!0,variant:"outline",rounded:"xs",onClick:o,children:[(0,r.jsxs)(x.z,{children:[countSelectedNodes(n)," selected"]}),(0,r.jsx)(V.h,{"aria-label":"Exit select Mode",icon:(0,r.jsx)(eP.D,{})})]}),(0,r.jsxs)(f.U,{children:[(0,r.jsx)(FetchSelectedNodesRowCountButton,{selectedNodes:i.length>0?i:[],onFinish:o}),(0,r.jsx)(AddSchemaChangesCheckButton,{nodes:i.length>0?i:[],onFinish:o}),(0,r.jsx)(AddRowCountCheckButton,{nodes:i.length>0?i:[],onFinish:o})]})]})})})})}let layout=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR",r=new(D()).graphlib.Graph;r.setDefaultEdgeLabel(()=>({})),r.setGraph({rankdir:t}),e.forEach(e=>{r.setNode(e.id,{width:300,height:36})}),n.forEach(e=>{r.setEdge(e.source,e.target)}),D().layout(r),e.forEach(e=>{let n=r.node(e.id);return e.position={x:n.x-150,y:n.y-18},e})},eQ={customNode:GraphNode},eW={customEdge:GraphEdge},nodeColor=e=>{var n,t;return(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.changeStatus)?getIconForChangeStatus(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.changeStatus).color:"lightgray"},eH={all:"All",changed_models:"Changed Models"};function ChangeStatusLegend(){return(0,r.jsx)(l.xu,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[n,[t,o]]=e,{icon:l,color:c}=getIconForChangeStatus(n);return(0,r.jsx)(i.u,{label:o,children:(0,r.jsxs)(a.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,r.jsx)(s.J,{color:c,as:l})," ",t]})},n)})})}function _LineageView(){let{successToast:e,failToast:n}=useClipBoardToast(),{toImage:t,ref:i}=useToBlob({imageType:"png",shadowEffect:!0,backgroundColor:"white",ignoreElements:e=>{let n=e.className;return!!("string"==typeof n&&n.includes(ey))},onSuccess:async t=>{try{await copyBlobToClipboard(t),e("Copied the Lineage View as an image to clipboard")}catch(e){n("Failed to copy image to clipboard",e)}},onError:e=>{console.error("Error taking screenshot",e),n("Failed to copy image to clipboard",e)}});(0,c.p)();let[E,D,T]=(0,o.Rr)([]),[O,I,L]=(0,o.ll)([]),[z,F]=(0,S.useState)(),[M,q]=(0,S.useState)(),{lineageGraphSets:P,isLoading:V,error:A}=useLineageGraphsContext(),{isOpen:Q,onOpen:W,onClose:H}=(0,d.q)(),[K,U]=(0,S.useState)("detail"),[G,J]=(0,S.useState)(),[X,Z]=(0,S.useState)("changed_models"),[Y,$]=(0,S.useState)(!1),[ee,et]=(0,S.useState)({x:0,y:0});if((0,S.useEffect)(()=>{if(!P)return;let e="changed_models"===X?P.changed:P.all,n=P.modifiedSet,[t,r]=toReactflow(e,P.modifiedSet);layout(t,r),F(e),q(n),D(t),I(r)},[D,I,X,P]),V)return(0,r.jsx)(a.k,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:(0,r.jsx)(u.$,{size:"xl"})});let closeContextMenu=()=>{$(!1),et({x:0,y:0})};return A?(0,r.jsxs)(r.Fragment,{children:["Fail to load lineage data: ",A]}):"changed_models"===X&&(void 0===M||(null==M?void 0:M.length)===0)?(0,r.jsx)(h.M,{h:"100%",children:(0,r.jsxs)(m.g,{children:[(0,r.jsx)(r.Fragment,{children:"No change detected"}),(0,r.jsx)(x.z,{colorScheme:"blue",onClick:()=>{Z("all")},children:"Show all nodes"})]})}):(0,r.jsxs)(a.k,{width:"100%",height:"100%",children:[(0,r.jsx)(l.xu,{flex:"1 0 0px",children:(0,r.jsxs)(o.x$,{nodeTypes:eQ,edgeTypes:eW,nodes:E,edges:O,onNodesChange:T,onEdgesChange:L,onNodeClick:(e,n)=>{closeContextMenu(),"detail"===K?(J(n.id),D(selectSingleNode(n.id,E))):D(selectNode(n.id,E))},onNodeMouseEnter:(e,n)=>{if(z&&void 0!==M){let[e,t]=highlightPath(z,M,E,O,n.id);D(e),I(t)}},onNodeMouseLeave:(e,n)=>{if(z&&void 0!==M){let[e,n]=highlightPath(z,M,E,O,null);D(e),I(n)}},onNodeContextMenu:(e,n)=>{"action"===K&&(e.preventDefault(),et({x:e.clientX,y:e.clientY,selectedNode:n}),$(!0))},onClick:closeContextMenu,maxZoom:1,minZoom:.1,fitView:!0,ref:i,children:[(0,r.jsx)(_.A,{color:"#ccc"}),(0,r.jsxs)(R.Z,{showInteractive:!1,position:"top-right",className:ey,children:[(0,r.jsx)(R.B,{title:"switch mode",onClick:()=>{Z("all"===X?"changed_models":"all");let e=cleanUpSelectedNodes(E);D(e)},children:(0,r.jsx)(s.J,{as:B.Bw1})}),(0,r.jsx)(R.B,{title:"copy image",onClick:()=>{t()},children:(0,r.jsx)(s.J,{as:B.C3L})}),(0,r.jsx)(R.B,{title:"summary",onClick:W,children:(0,r.jsx)(s.J,{as:B.SnF})})]}),(0,r.jsx)(o.s_,{position:"bottom-left",children:(0,r.jsxs)(f.U,{children:[(0,r.jsx)(ChangeStatusLegend,{}),(0,r.jsxs)(l.xu,{p:2,flex:"0 1 160px",fontSize:"14px",className:ey,children:[(0,r.jsx)(p.x,{color:"gray",mb:"2px",children:"Actions"}),(0,r.jsx)(m.g,{spacing:1,align:"baseline",children:(0,r.jsx)(x.z,{size:"xs",variant:"outline",isDisabled:"action"===K,onClick:()=>{let e=cleanUpSelectedNodes(E);D(e),U("detail"===K?"action":"detail")},children:"Select Models"})})]})]})}),(0,r.jsx)(o.s_,{position:"top-left",children:(0,r.jsx)(p.x,{fontSize:"xl",color:"grey",opacity:.5,children:eH[X]})}),(0,r.jsx)(o.s_,{position:"bottom-center",className:ey,children:(0,r.jsx)(NodeSelector,{nodes:E.map(e=>e.data),isOpen:"action"===K,onClose:()=>{U("detail");let e=cleanUpSelectedNodes(E);D(e)}})}),(0,r.jsx)(N.a,{nodeColor:nodeColor,nodeStrokeWidth:3})]})}),(0,r.jsxs)(g.u_,{isOpen:Q,onClose:H,size:"6xl",children:[(0,r.jsx)(y.Z,{}),(0,r.jsxs)(j.h,{overflowY:"auto",height:"80%",children:[(0,r.jsx)(C.o,{}),(0,r.jsx)(v.f,{children:(0,r.jsx)(SummaryView,{})})]})]}),"detail"===K&&G&&(null==z?void 0:z.nodes[G])&&(0,r.jsx)(l.xu,{flex:"0 0 500px",borderLeft:"solid 1px lightgray",height:"100%",children:(0,r.jsx)(NodeView,{node:null==z?void 0:z.nodes[G],onCloseNode:()=>{J(void 0),D(cleanUpSelectedNodes(E))}})}),Y&&(0,r.jsx)(b.v,{isOpen:!0,onClose:closeContextMenu,children:(0,r.jsxs)(k.q,{style:{position:"absolute",left:"".concat(ee.x,"px"),top:"".concat(ee.y,"px")},children:[(0,r.jsx)(w.s,{icon:(0,r.jsx)(en.Cv2,{}),onClick:()=>{let e=ee.selectedNode;if("action"!==K||void 0===e||void 0===z)return;let n=e.id,t=selectUpstream(z,[n]),r=selectNodes([...t],E);D(r)},children:"Select parent nodes"}),(0,r.jsx)(w.s,{icon:(0,r.jsx)(en.IMj,{}),onClick:()=>{let e=ee.selectedNode;if("action"!==K||void 0===e||void 0===z)return;let n=e.id,t=selectDownstream(z,[n]),r=selectNodes([...t],E);D(r)},children:"Select child nodes"})]})})]})}function LineageView(){return(0,r.jsx)(o.tV,{children:(0,r.jsx)(_LineageView,{})})}var eK=t(12844),eU=t(98786);function RecceContextProvider(e){let{children:n}=e;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(RecceQueryContextProvider,{children:(0,r.jsx)(LineageGraphsContextProvider,{children:(0,r.jsx)(RowCountStateContextProvider,{children:n})})})})}function useVersionNumber(){let[e,n]=(0,S.useState)("");return(0,S.useEffect)(()=>{(async function(){try{let e=await G.get("/api/version");n(e.data)}catch(e){console.error("Error fetching version number:",e)}})()},[]),e}var eG=t(45489),eJ=t(51348),eX=t(69005),eZ=t(14800),eY=t(2600),e$=t(68677),e0=t(83358),e1=t(44525),e2=t(234),e5=t(96094),e3=t(25535),e4=t(36334);function CheckBreadcrumb(e){let{name:n,setName:t}=e,[o,i]=(0,S.useState)(!1),[a,s]=(0,S.useState)(n),c=(0,S.useRef)(null),d=(0,S.useCallback)(()=>{t(a),i(!1)},[t,i,a]);return(0,S.useEffect)(()=>{let handleClickOutside=e=>{c.current&&!c.current.contains(e.target)&&d()};return o&&document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}},[o,c,d]),(0,r.jsxs)(e2.a,{flex:"0 1",fontSize:"12pt",fontWeight:"500",separator:(0,r.jsx)(e4.X,{color:"gray.500"}),children:[(0,r.jsx)(e5.g,{children:(0,r.jsx)(l.xu,{children:"Checklist"})}),(0,r.jsx)(e5.g,{flex:"0 1",cursor:"pointer",children:o?(0,r.jsx)(e3.I,{ref:c,value:a,onChange:e=>{s(e.target.value)},onKeyDown:e=>{"Enter"===e.key?(t(a),i(!1)):"Escape"===e.key&&(s(n),i(!1))},size:"sm",w:"auto",minW:"200px",maxW:"600px"}):(0,r.jsx)(l.xu,{onClick:()=>{s(n),i(!0)},textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n})})]})}function SchemaDiffView(e){let{check:n}=e,{lineageGraphSets:t}=useLineageGraphsContext(),o=n.params,l=o.node_id,i=l?null==t?void 0:t.all.nodes[l]:void 0;return i?(0,r.jsx)(SchemaView,{base:i.data.base,current:i.data.current,enableScreenshot:!0}):(0,r.jsx)(r.Fragment,{})}var e6=t(33695),e9=t(34030);function CheckDescription(e){let{value:n,onChange:t}=e,[o,l]=(0,S.useState)(!1),[i,s]=(0,S.useState)(),c=(0,S.useRef)(null);return((0,S.useEffect)(()=>{if(o&&c.current){let e=c.current;e.focus(),e.setSelectionRange(e.value.length,e.value.length)}},[o]),o)?(0,r.jsxs)(a.k,{direction:"column",align:"flex-end",children:[(0,r.jsx)(e6.g,{h:"200px",value:i,onChange:e=>{s(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&l(!1)},ref:c}),(0,r.jsxs)(a.k,{gap:"12px",alignItems:"flex-end",children:[(0,r.jsx)(e9.r,{onClick:()=>{setTimeout(()=>{l(!1)},100)},colorScheme:"blue",children:"cancel"}),(0,r.jsx)(x.z,{mt:"8px",size:"sm",colorScheme:"blue",onClick:()=>{t&&(t(i),l(!1))},children:"Update"})]})]}):(0,r.jsx)(p.x,{maxHeight:"400px",overflow:"auto",fontSize:"11pt",onClick:()=>{s(n||""),l(!0)},whiteSpace:"pre-line",color:n?"inherit":"lightgray",children:n||"Add description here"})}function RowCountDiffView(e){var n,t;let{check:o}=e;function columnCellClass(e){if(e.base===e.current);else if(e.base<e.current||"N/A"===e.base)return"column-body-added";else if(e.base>e.current||"N/A"===e.current)return"column-body-removed";return"column-body-normal"}let l=Object.keys((null===(n=o.last_run)||void 0===n?void 0:n.result)||{}).map(e=>{var n;let t=null===(n=o.last_run)||void 0===n?void 0:n.result[e],r=(null==t?void 0:t.base)||null,l=(null==t?void 0:t.curr)||null;return{name:e,base:null===r?"N/A":Number(r),current:null===l?"N/A":Number(l)}});return(0,r.jsx)(a.k,{direction:"column",children:Object.keys(null===(t=o.last_run)||void 0===t?void 0:t.result).length>0&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:[{key:"name",name:"Name",cellClass:columnCellClass},{key:"base",name:"Base Rows",cellClass:columnCellClass},{key:"current",name:"Current Rows",cellClass:columnCellClass}],rows:l,className:"rdg-light",enableScreenshot:!0})})})}var e8=t(48742);function _templateObject(){let e=(0,eG._)(["\n    **SQL**\n    ```sql\n    ","\n    ```\n    "],["\n    **SQL**\n    \\`\\`\\`sql\n    ","\n    \\`\\`\\`\n    "]);return _templateObject=function(){return e},e}function buildTitle(e){return"".concat(e.is_checked?"✅ ":"").concat(e.name)}function buildDescription(e){return e.description?e.description:"_(no description)_"}function buildQuery(e){var n;return(0,e8.Pn)(_templateObject(),null===(n=e.params)||void 0===n?void 0:n.sql_template)}var query_SqlEditor=e=>{let{value:n,onChange:t,onRun:o,onRunDiff:l,options:i={},...a}=e;return(0,r.jsx)(ej.ZP,{language:"sql",theme:"vs",value:n,onChange:e=>{void 0!==e&&t&&t(e)},onMount:(e,n)=>{o&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.Enter,o),l&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.Enter,l)},options:{tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent",...i}})},e7=t(49294),ne=t(99986);function DataFrameColumnHeader(e){let{name:n,pinnedColumns:t=[],onPinnedColumnsChange:o=()=>{}}=e,i=t.includes(n);return(0,r.jsxs)(a.k,{className:"grid-header",alignItems:"center",children:[(0,r.jsx)(l.xu,{flex:1,children:n}),(0,r.jsx)(s.J,{className:i?"unpin-icon":"pin-icon",display:i?"block":"none",cursor:"pointer",as:i?O.$kI:O.oJP,onClick:i?()=>{let e=t.filter(e=>e!==n);o(e)}:()=>{let e=[...t,n];o(e)}})]})}function QueryResultView_toDataGrid(e,n){let t=[],o=n.pinnedColumns||[],toColumn=(e,t)=>({key:String(e),name:(0,r.jsx)(DataFrameColumnHeader,{name:t,...n}),width:"auto",renderCell:defaultRenderCell});return t.push({key:"_index",name:"",width:10,cellClass:"index-column"}),o.forEach(n=>{let r=eS().findIndex(e.columns,e=>e.name===n);r<0||t.push(toColumn(r,n))}),e.columns.forEach((e,n)=>{o.includes(e.name)||t.push(toColumn(n,e.name))}),e.data.forEach((e,n)=>{e._index=n+1}),{columns:t,rows:e.data}}let QueryResultView=e=>{let{run:n,viewOptions:t,onViewOptionsChanged:o,onAddToChecklist:s}=e,c=(0,S.useMemo)(()=>(null==t?void 0:t.pinned_columns)||[],[t]),d=null==n?void 0:n.result,u=(0,S.useMemo)(()=>d?QueryResultView_toDataGrid(d,{pinnedColumns:c,onPinnedColumnsChange:e=>{o&&o({...t,pinned_columns:e})}}):{rows:[],columns:[]},[d,c,t,o]);if(0===u.columns.length)return(0,r.jsx)(h.M,{height:"100%",children:"No data"});let m=(null==d?void 0:d.limit)||0,x=m>0&&(null==d?void 0:d.more)?"Warning: Displayed results are limited to ".concat(m.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null;return(0,r.jsxs)(a.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(s||x)&&(0,r.jsxs)(a.k,{borderBottom:"1px solid lightgray",alignItems:"center",gap:"5px",px:"10px",bg:x?"orange.100":"inherit",children:[x&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e7.a,{color:"orange.600",alignSelf:"center"})," ",(0,r.jsx)(l.xu,{children:x})]}),(0,r.jsx)(T.L,{minHeight:"32px"}),s&&(0,r.jsx)(i.u,{label:"Add to Checklist",children:(0,r.jsx)(V.h,{variant:"unstyled",size:"sm","aria-label":"Add",icon:(0,r.jsx)(ne.d,{}),onClick:()=>s(n)})})]}),(0,r.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:u.columns,rows:u.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})},QueryDiffResultView=e=>{var n,t,o,s,c,d;let{run:u,onAddToChecklist:m,viewOptions:x,onViewOptionsChanged:f}=e,p=(0,S.useMemo)(()=>(null==x?void 0:x.primary_keys)||[],[x]),g=(0,S.useMemo)(()=>(null==x?void 0:x.changed_only)||!1,[x]),y=(0,S.useMemo)(()=>(null==x?void 0:x.pinned_columns)||[],[x]),j=(0,S.useMemo)(()=>{var e,n;return toDataDiffGrid(null==u?void 0:null===(e=u.result)||void 0===e?void 0:e.base,null==u?void 0:null===(n=u.result)||void 0===n?void 0:n.current,{changedOnly:g,primaryKeys:p,onPrimaryKeyChange:e=>{f&&f({...x,primary_keys:e})},pinnedColumns:y,onPinnedColumnsChange:e=>{f&&f({...x,pinned_columns:e})}})},[u,x,g,p,y,f]);if(0===j.columns.length)return(0,r.jsx)(h.M,{height:"100%",children:"No data"});if(g&&0===j.rows.length)return(0,r.jsx)(h.M,{height:"100%",children:"No change"});let C=(null===(t=u.result)||void 0===t?void 0:null===(n=t.current)||void 0===n?void 0:n.limit)||0,v=C>0&&((null==u?void 0:null===(s=u.result)||void 0===s?void 0:null===(o=s.current)||void 0===o?void 0:o.more)||(null==u?void 0:null===(d=u.result)||void 0===d?void 0:null===(c=d.base)||void 0===c?void 0:c.more))?"Warning: Displayed results are limited to ".concat(C.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null;return(0,r.jsxs)(a.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,r.jsxs)(a.k,{borderBottom:"1px solid lightgray",justifyContent:"flex-end",gap:"5px",alignItems:"center",px:"10px",bg:v?"orange.100":"inherit",children:[v&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e7.a,{color:"orange.600"})," ",(0,r.jsx)(l.xu,{children:v})]}),(0,r.jsx)(T.L,{minHeight:"32px"}),(0,r.jsx)(eJ.X,{isChecked:null==x?void 0:x.changed_only,onChange:()=>{let e=!(null==x?void 0:x.changed_only);f&&f({...x,changed_only:e})},children:"Changed only"}),m&&(0,r.jsx)(i.u,{label:"Add to Checklist",children:(0,r.jsx)(V.h,{variant:"unstyled",size:"sm","aria-label":"Add",icon:(0,r.jsx)(ne.d,{}),onClick:()=>m(u)})})]}),(0,r.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:j.columns,rows:j.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})};function CheckDetail_templateObject(){let e=(0,eG._)(["\n  <details><summary>","</summary>\n\n  ","\n\n  </details>"]);return CheckDetail_templateObject=function(){return e},e}let CheckDetail=e=>{var n;let{checkId:t}=e,o=(0,Q.NL)(),[,i]=(0,eC.TH)(),{successToast:c,failToast:d}=useClipBoardToast(),{isLoading:u,error:m,data:x}=(0,ee.a)({queryKey:X.check(t),queryFn:async()=>getCheck(t),refetchOnMount:!1,staleTime:3e5}),{mutate:f}=(0,eb.D)({mutationFn:e=>updateCheck(t,e),onSuccess:()=>{o.invalidateQueries({queryKey:X.check(t)}),o.invalidateQueries({queryKey:X.checks()})}}),{mutate:p}=(0,eb.D)({mutationFn:()=>deleteCheck(t),onSuccess:()=>{o.invalidateQueries({queryKey:X.checks()}),i("/checks")}});if(u)return(0,r.jsx)(h.M,{h:"100%",children:"Loading"});if(m)return(0,r.jsxs)(h.M,{h:"100%",children:["Error: ",m.message]});let handleCopy=async()=>{if(!x)return;let e=buildMarkdown(x);if(!navigator.clipboard){d("Failed to copy the check to clipboard",Error("Copy to clipboard is available only in secure contexts (HTTPS)"));return}try{await navigator.clipboard.writeText(e),c("Copied the check to the clipboard")}catch(e){d("Failed to copy the check to clipboard",e)}},handelUpdateViewOptions=e=>{f({view_options:e})};return(0,r.jsxs)(a.k,{height:"100%",width:"100%",maxHeight:"100%",direction:"column",children:[(0,r.jsxs)(a.k,{p:"0px 16px",alignItems:"center",children:[(0,r.jsx)(CheckBreadcrumb,{name:(null==x?void 0:x.name)||"",setName:e=>{f({name:e})}}),(0,r.jsxs)(b.v,{children:[(0,r.jsx)(eu.j,{as:V.h,icon:(0,r.jsx)(s.J,{as:O.D_A}),variant:"ghost"}),(0,r.jsxs)(k.q,{children:[(0,r.jsx)(w.s,{icon:(0,r.jsx)(ef.T,{}),onClick:()=>handleCopy(),children:"Copy markdown"}),(0,r.jsx)(w.s,{icon:(0,r.jsx)(e1.p,{}),onClick:()=>p(),children:"Delete"})]})]}),(0,r.jsx)(T.L,{}),(0,r.jsx)(eJ.X,{isChecked:null==x?void 0:x.is_checked,onChange:e=>{let n=e.target.checked;f({is_checked:n})},children:"Check"})]}),(0,r.jsx)(l.xu,{p:"8px 16px",minHeight:"100px",children:(0,r.jsx)(CheckDescription,{value:null==x?void 0:x.description,onChange:e=>{f({description:e})}},null==x?void 0:x.check_id)}),((null==x?void 0:x.type)==="query"||(null==x?void 0:x.type)==="query_diff")&&(0,r.jsx)(eX.U,{defaultIndex:[],allowToggle:!0,children:(0,r.jsxs)(eZ.Q,{children:[(0,r.jsxs)(eY.K,{children:["query",(0,r.jsx)(e$.X,{})]}),(0,r.jsx)(e0.H,{children:(0,r.jsx)(l.xu,{height:"400px",width:"100%",border:"lightgray 1px solid ",children:(0,r.jsx)(query_SqlEditor,{value:(null===(n=null==x?void 0:x.params)||void 0===n?void 0:n.sql_template)||"",options:{readOnly:!0}})})})]})}),(0,r.jsxs)(l.xu,{style:{contain:"size"},flex:"1 1 0%",children:[x&&"query"===x.type&&(null==x?void 0:x.last_run)&&(0,r.jsx)(QueryResultView,{run:x.last_run,viewOptions:x.view_options,onViewOptionsChanged:handelUpdateViewOptions}),x&&"query_diff"===x.type&&(null==x?void 0:x.last_run)&&(0,r.jsx)(QueryDiffResultView,{run:x.last_run,viewOptions:x.view_options,onViewOptionsChanged:handelUpdateViewOptions}),x&&"value_diff"===x.type&&(null==x?void 0:x.last_run)&&(0,r.jsx)(ValueDiffResultView,{run:x.last_run}),x&&"profile_diff"===x.type&&(null==x?void 0:x.last_run)&&(0,r.jsx)(ProfileDiffResultView,{run:x.last_run,viewOptions:x.view_options,onViewOptionsChanged:handelUpdateViewOptions}),x&&"schema_diff"===x.type&&(0,r.jsx)(SchemaDiffView,{check:x}),x&&"row_count_diff"===x.type&&(0,r.jsx)(RowCountDiffView,{check:x})]})]})};function buildMarkdown(e){return(0,e8.Pn)(CheckDetail_templateObject(),buildTitle(e),buildBody(e))}function buildBody(e){return"query"===e.type||"query_diff"===e.type?"".concat(buildDescription(e),"\n\n").concat(buildQuery(e)):buildDescription(e)}var nn=t(15012),nt=t(38505);let ChecklistItem=e=>{let{check:n,selected:t,onSelect:o}=e,i=(0,Q.NL)(),c=n.check_id,{mutate:d}=(0,eb.D)({mutationFn:e=>updateCheck(c,e),onSuccess:()=>{i.invalidateQueries({queryKey:X.check(c)}),i.invalidateQueries({queryKey:X.checks()})}}),u=(e=>{switch(e){case"schema_diff":return nn.uhn;case"query":case"query_diff":return nn.r2i;case"value_diff":return nn.pRi;case"profile_diff":return nn.dku;case"row_count_diff":return B.SwK;default:return nn.WzH}})(n.type);return(0,r.jsxs)(a.k,{width:"100%",p:"10px 20px",cursor:"pointer",_hover:{bg:"gray.200"},bg:t?"gray.100":"inherit",onClick:()=>o(n.check_id),alignItems:"center",gap:"5px",children:[(0,r.jsx)(s.J,{as:u}),(0,r.jsx)(l.xu,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n.name}),n.is_checked&&(0,r.jsx)(s.J,{color:"green",as:I.FJM})]})},CheckList=e=>{let{checks:n,selectedItem:t,onCheckSelected:o,onChecksReordered:l}=e;return(0,r.jsx)(nt.Z5,{onDragEnd:e=>{e.destination&&l(e.source.index,e.destination.index)},children:(0,r.jsx)(nt.bK,{droppableId:"checklist",children:e=>(0,r.jsxs)(m.g,{...e.droppableProps,ref:e.innerRef,w:"full",spacing:"0",flex:"1",children:[n.map((e,n)=>(0,r.jsx)(nt._l,{draggableId:e.check_id,index:n,children:n=>(0,r.jsx)(a.k,{ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,w:"full",children:(0,r.jsx)(ChecklistItem,{check:e,selected:e.check_id===t,onSelect:o},e.check_id)})},e.check_id)),e.placeholder]})})})};function CheckPage_templateObject(){let e=(0,eG._)(["\n    <details><summary>","</summary>\n\n    ","\n\n    </details>"]);return CheckPage_templateObject=function(){return e},e}let CheckPage=()=>{let[,e]=(0,eC.TH)(),[,n]=(0,eC.yj)("/checks/:checkId"),t=(0,Q.NL)(),{successToast:o,failToast:s}=useClipBoardToast(),c=null==n?void 0:n.checkId,{isLoading:d,error:u,data:p,status:g}=(0,ee.a)({queryKey:X.checks(),queryFn:listChecks,refetchOnMount:!0}),y=(0,S.useCallback)(n=>{e("/checks/".concat(n))},[e]),[j,C]=(0,S.useState)(p||[]),{mutate:v}=(0,eb.D)({mutationFn:e=>reorderChecks(e),onSuccess:()=>{t.invalidateQueries({queryKey:X.checks()})}}),b=(0,S.useCallback)((e,n)=>{let t=[...j],[r]=t.splice(e,1);t.splice(n,0,r),v({source:e,destination:n}),C(t)},[j,C,v]),k=(0,S.useCallback)(async()=>{let e=await createSimpleCheck();t.invalidateQueries({queryKey:X.checks()}),y(e.check_id)},[t,y]);return((0,S.useEffect)(()=>{"success"===g&&(!c&&p.length>0&&e("/checks/".concat(p[0].check_id)),C(p))},[g,c,p,C,e]),d)?(0,r.jsx)(r.Fragment,{children:"Loading"}):u?(0,r.jsxs)(r.Fragment,{children:["Error: ",u.message]}):(null==p?void 0:p.length)?(0,r.jsxs)(a.k,{height:"100%",children:[(0,r.jsx)(l.xu,{flex:"0 0 400px",borderRight:"lightgray solid 1px",height:"100%",style:{contain:"size"},children:(0,r.jsxs)(m.g,{spacing:0,align:"flex-end",h:"100%",children:[(0,r.jsxs)(f.U,{children:[(0,r.jsx)(i.u,{label:"Create a simple check",children:(0,r.jsx)(V.h,{variant:"unstyled","aria-label":"Create a simple check",onClick:k,icon:(0,r.jsx)(ne.d,{})})}),(0,r.jsx)(i.u,{label:"Copy checklist to the clipboard",children:(0,r.jsx)(V.h,{variant:"unstyled","aria-label":"Copy checklist to the clipboard",mr:"10px",onClick:async()=>{let e=CheckPage_buildMarkdown(p);if(!navigator.clipboard){s("Failed to copy checklist to clipboard",Error("Copy to clipboard is available only in secure contexts (HTTPS)"));return}try{await navigator.clipboard.writeText(e),o("Copied ".concat(p.length," checks to the clipboard"))}catch(e){s("Failed to copy checklist to clipboard",e)}},icon:(0,r.jsx)(ef.T,{})})})]}),(0,r.jsx)(eI.i,{mb:"8px"}),(0,r.jsx)(CheckList,{checks:j,selectedItem:c,onCheckSelected:y,onChecksReordered:b})]})}),(0,r.jsx)(l.xu,{flex:"1",height:"100%",width:"calc(100% - 400px)",children:(0,r.jsx)(eC.rs,{children:(0,r.jsx)(eC.AW,{path:"/checks/:checkId",children:e=>(0,r.jsx)(CheckDetail,{checkId:e.checkId})})})})]}):(0,r.jsx)(h.M,{h:"100%",children:(0,r.jsxs)(m.g,{children:[(0,r.jsx)(l.xu,{children:"No checks"}),(0,r.jsx)(x.z,{colorScheme:"blue",onClick:k,children:"Create a simple check"})]})})};function CheckPage_buildMarkdown(e){let n=e.map(e=>(0,e8.Pn)(CheckPage_templateObject(),buildTitle(e),buildDescription(e)));return n.join("\n\n")}let QueryPage=()=>{let{sqlQuery:e,setSqlQuery:n}=useRecceQueryContext(),[t,o]=(0,S.useState)(),[i,s]=(0,S.useState)(),[c,d]=(0,S.useState)({}),u=(0,Q.NL)(),[,h]=(0,eC.TH)(),queryFn=async n=>{o(n);let{run_id:t}="query"===n?await submitQuery({sql_template:e},{nowait:!0}):await submitQueryDiff({sql_template:e},{nowait:!0});return s(t),await waitRun(t)},{data:m,mutate:f,error:p,isPending:g}=(0,eb.D)({mutationFn:queryFn,onSuccess:e=>{d({})}}),y=(0,S.useCallback)(async()=>{if(i)return await cancelRun(i)},[i]),j=(0,S.useCallback)(async e=>{if(!(null==e?void 0:e.run_id))return;let n=await createCheckByRun(e.run_id,c);u.invalidateQueries({queryKey:X.checks()}),h("/checks/".concat(n.check_id))},[h,c,u]);return!g&&(null==m?void 0:m.run_id)&&(null==m||m.error),(0,r.jsxs)(a.k,{direction:"column",height:"100%",children:[(0,r.jsxs)(a.k,{justifyContent:"right",padding:"5px",gap:"5px",children:[(0,r.jsx)(x.z,{colorScheme:"blue",onClick:()=>f("query_diff"),isDisabled:g,size:"sm",children:"Run Diff"}),(0,r.jsx)(x.z,{colorScheme:"blue",onClick:()=>f("query"),isDisabled:g,size:"sm",children:"Run"})]}),(0,r.jsx)(l.xu,{flex:"1",border:"1px solid #CBD5E0",height:"200px",width:"100%",children:(0,r.jsx)(query_SqlEditor,{value:e,onChange:n,onRun:()=>f("query"),onRunDiff:()=>f("query_diff")})}),(0,r.jsx)(a.k,{height:"50vh",direction:"column",children:"query"===t?(0,r.jsx)(RunView,{run:m,error:p,isPending:g,onCancel:y,children:e=>(0,r.jsx)(QueryResultView,{...e,onAddToChecklist:j})},i):(0,r.jsx)(RunView,{isPending:g,run:m,error:p,viewOptions:c,onViewOptionsChanged:d,onCancel:y,children:e=>(0,r.jsx)(QueryDiffResultView,{...e,onAddToChecklist:j})},i)})]})};var nr=t(72952);let hashNavigate=e=>(0,nr.c4)("#!"+e),useHashLocation=()=>{let e=(0,nr.LD)(()=>window.location.hash.replace(/^#!/,"")||"/",()=>"/ssr");return[e,hashNavigate]};var no=t(12218);function getCookie(e){var n=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return n?n.pop():""}function NavBar(){let[e,n]=(0,eC.TH)(),t=useVersionNumber(),o=[["Lineage","/lineage"],["Query","/query"],["Checklist","/checks"]],i=eS().findIndex(o,n=>{let[,t]=n;return e.startsWith(t)});return(0,r.jsx)(ei.m,{index:i,children:(0,r.jsxs)(ea.t,{children:[o.map(e=>{let[t,o]=e;return(0,r.jsx)(es.O,{onClick:()=>{n(o)},children:t},t)}),(0,r.jsx)(l.xu,{position:"absolute",right:"0",top:"0",p:"2",color:"gray.500",children:t})]})})}function Home(){(0,S.useLayoutEffect)(()=>{let e=getCookie("recce_user_id");if(e&&no.env.AMPLITUDE_API_KEY)try{eU.S1(no.env.AMPLITUDE_API_KEY,e,{defaultTracking:!0})}catch(e){console.error(e)}},[]);let e="calc(100vh - 42px)";return(0,r.jsx)(eK.x,{children:(0,r.jsx)(Q.aH,{client:J,children:(0,r.jsx)(RecceContextProvider,{children:(0,r.jsxs)(eC.F0,{hook:useHashLocation,children:[(0,r.jsx)(NavBar,{}),(0,r.jsx)(l.xu,{p:0,h:e,maxH:e,overflow:"auto",children:(0,r.jsxs)(eC.rs,{children:[(0,r.jsx)(eC.AW,{path:"/lineage",children:(0,r.jsx)(LineageView,{})}),(0,r.jsx)(eC.AW,{path:"/query",children:(0,r.jsx)(QueryPage,{})}),(0,r.jsx)(eC.AW,{path:"/checks/:slug*",children:(0,r.jsx)(CheckPage,{})}),(0,r.jsx)(eC.AW,{path:"/ssr",children:(0,r.jsx)(r.Fragment,{children:"Loading"})}),(0,r.jsx)(eC.AW,{children:(0,r.jsx)(eC.l_,{to:"/lineage"})})]})})]})})})})}},88727:function(){},7866:function(){},75165:function(){}},function(e){e.O(0,[145,170,521,531,182,710,971,495,599,512,450,297,62,744],function(){return e(e.s=99178)}),_N_E=e.O()}]);