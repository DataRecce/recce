(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{99178:function(e,n,t){Promise.resolve().then(t.bind(t,91047))},91047:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Home}});var r=t(757),i=t(27869);function getNeighborSet(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=new Set,i={},dfs=(e,t)=>{if(t<0||void 0!==i[e]&&i[e]>=t)return;i[e]=t;let l=n(e);for(let e of l)dfs(e,t-1);r.add(e)};for(let n of e)dfs(n,t);return r}function buildDefaultLineageGraphSets(e,n){function buildAllLineageGraph(e,n){let t={},r={},buildNode=(e,n)=>({id:e,name:e,data:{},from:n,parents:{},children:{},isSelected:!1});for(let[n,r]of Object.entries(e.parent_map)){t[n]=buildNode(n,"base");let r=e.nodes&&e.nodes[n];r&&(t[n].data.base=r,t[n].name=null==r?void 0:r.name,t[n].resourceType=null==r?void 0:r.resource_type,t[n].packageName=null==r?void 0:r.package_name)}for(let[e,r]of Object.entries(n.parent_map)){t[e]?t[e].from="both":t[e]=buildNode(e,"current");let r=n.nodes&&n.nodes[e];r&&(t[e].data.current=n.nodes&&n.nodes[e],t[e].name=null==r?void 0:r.name,t[e].resourceType=null==r?void 0:r.resource_type,t[e].packageName=null==r?void 0:r.package_name)}for(let[n,i]of Object.entries(e.parent_map))for(let e of i){let i=t[n],l=t[e],a="".concat(e,"_").concat(n);r[a]={id:a,from:"base",parent:l,child:i};let s=r[a];i.parents[e]=s,l.children[n]=s}for(let[e,i]of Object.entries(n.parent_map))for(let n of i){let i=t[e],l=t[n],a="".concat(n,"_").concat(e);r[a]?r[a].from="both":r[a]={id:a,from:"current",parent:l,child:i};let s=r[a];i.parents[n]=s,l.children[e]=s}return{edges:r,nodes:t}}function buildChangedOnlyLineageGraph(e,n){let t={},r={};function union(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let r=new Set;return n.forEach(e=>{e.forEach(e=>{r.add(e)})}),r}let i=selectDownstream(e,n),l=selectUpstream(e,n,1),a=union(i,l);return Object.entries(e.nodes).forEach(e=>{let[n,r]=e;a.has(n)&&(t[n]=r)}),Object.entries(e.edges).forEach(e=>{let[n,t]=e;a.has(t.parent.id)&&a.has(t.child.id)&&(r[n]=t)}),{nodes:t,edges:r}}let{nodes:t,edges:r}=buildAllLineageGraph(e,n),i=[];for(let[e,n]of Object.entries(t))if("base"===n.from)n.changeStatus="removed",i.push(n.id);else if("current"===n.from)n.changeStatus="added",i.push(n.id);else{var l,a,s,o,c,d;let e=null==n?void 0:null===(s=n.data)||void 0===s?void 0:null===(a=s.base)||void 0===a?void 0:null===(l=a.checksum)||void 0===l?void 0:l.checksum,t=null==n?void 0:null===(d=n.data)||void 0===d?void 0:null===(c=d.current)||void 0===c?void 0:null===(o=c.checksum)||void 0===o?void 0:o.checksum;e&&t&&e!==t&&(n.changeStatus="modified",i.push(n.id))}for(let[e,n]of Object.entries(r))"base"===n.from?n.changeStatus="removed":"current"===n.from&&(n.changeStatus="added");return{all:{nodes:t,edges:r},changed:buildChangedOnlyLineageGraph({nodes:t,edges:r},i),modifiedSet:i}}function selectUpstream(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].parents),t)}function selectDownstream(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].children),t)}function toReactflow(e,n){let t=[],r=[];for(let[n,r]of Object.entries(e.nodes))t.push({id:r.id,position:{x:0,y:0},data:r,type:"customNode",targetPosition:i.Ly.Left,sourcePosition:i.Ly.Right});for(let[n,t]of Object.entries(e.edges))r.push({id:t.id,type:"customEdge",source:t.parent.id,target:t.child.id,data:t});return highlightPath(e,n,t,r,null)}function highlightPath(e,n,t,r,i){function union(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let r=new Set;return n.forEach(e=>{e.forEach(e=>{r.add(e)})}),r}let l=null!==i?union(selectUpstream(e,[i]),selectDownstream(e,[i])):getNeighborSet(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].children)),a=new Set(r.filter(e=>l.has(e.source)&&l.has(e.target)).map(e=>e.id)),s=t.map(e=>({...e,data:{...e.data,isHighlighted:l.has(e.id)}})),o=r.map(e=>({...e,data:{...e.data,isHighlighted:a.has(e.id)}}));return[s,o]}function selectNode(e,n){let t=n.map(n=>{let t=n.id===e;return{...n,data:{...n.data,isSelected:n.data.isSelected!==t}}});return t}function selectNodes(e,n){let t=n.map(n=>{let t=e.includes(n.id);return{...n,data:{...n.data,isSelected:n.data.isSelected||t}}});return t}function cleanUpSelectedNodes(e){let n=e.map(e=>({...e,data:{...e.data,isSelected:!1}}));return n}var l=t(10126),a=t(83172),s=t(55528),o=t(29330),c=t(17714),d=t(46543),u=t(62648),h=t(43093),m=t(39668),x=t(83179),f=t(7752),g=t(94410),p=t(35337),j=t(29985),y=t(42524),v=t(36700),C=t(10287),b=t(24275),k=t(27726),S=t(26187),w=t(23704),_=t(33710),E=t(93864),D=t.n(E);t(94570);var N=t(90593),z=t(11180),L=t(63240),q=t(54057);let F=z.Nbv,T=z.sFB,O=z.UGs,IconChanged=e=>(0,r.jsxs)("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 16 16",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 11 a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}),(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:""})]});function getIconForChangeStatus(e){return"added"===e?{color:"#1dce00",icon:F}:"removed"===e?{color:"#ff4444",icon:T}:"modified"===e?{color:"#ffa502",icon:O}:{color:"inherit",icon:void 0}}function getIconForResourceType(e){return"model"===e?{color:"#c0eafd",icon:L.Fn3}:"metric"===e?{color:"#ffe6ee",icon:q._MV}:"source"===e?{color:"#a6dda6",icon:L.i1q}:"exposure"===e?{color:"#ffe6ee",icon:q.n8P}:"semantic_model"===e?{color:"#fb8caf",icon:q.R1C}:"seed"===e?{color:"#a6dda6",icon:L.tWi}:{color:"inherit",icon:void 0}}t(88727);var R=t(19920),I=t(7467),P=t(95913),M=t(89042),K=t(80294),A=t(10929),V=t(12218);let Q=V.env.NEXT_PUBLIC_API_URL?V.env.NEXT_PUBLIC_API_URL:window.location.origin;var G=t(27471);let W=A.default.create({baseURL:Q}),U=new G.S;async function fetchModelRowCount(e){let n=await W.get("/api/models/".concat(e,"/row_count"));return n.data}let H={rowCount:e=>["row_count",e],lineage:()=>["lineage"],checks:()=>["checks","list"],check:e=>["checks",e]};var B=t(44903);function ModelRowCount(e){let{rowCount:n}=e;if(!n)return(0,r.jsxs)(u.U,{children:[(0,r.jsx)(h.x,{children:"Failed to load"}),(0,r.jsx)(o.J,{as:M.KZt,color:"red.500"})]});let t=null===n.base?-1:n.base,i=null===n.curr?-1:n.curr,l=-1===t?"N/A":t,a=-1===i?"N/A":i;return t===i?(0,r.jsx)(h.x,{children:t}):t<i?(0,r.jsxs)(u.U,{children:[(0,r.jsx)(h.x,{children:l}),(0,r.jsx)(o.J,{as:M.QqI,color:"green.500"}),(0,r.jsx)(h.x,{children:a})]}):(0,r.jsxs)(u.U,{children:[(0,r.jsx)(h.x,{children:l}),(0,r.jsx)(o.J,{as:M.ZBs,color:"red.500"}),(0,r.jsx)(h.x,{children:a})]})}function ResourceTypeTag(e){let{node:n}=e,{icon:t}=getIconForResourceType(n.resourceType);return(0,r.jsx)(a.u,{hasArrow:!0,label:"Type of resource",children:(0,r.jsxs)(R.Vp,{children:[(0,r.jsx)(R.AD,{as:t}),(0,r.jsx)(R.Sn,{children:n.resourceType})]})})}function RowCountTag(e){let{node:n,isAutoFetching:t=!1,isInteractive:i=!0}=e,{isLoading:l,data:s,refetch:c,isFetched:d,isFetching:u}=(0,B.a)({queryKey:H.rowCount(n.name),queryFn:()=>fetchModelRowCount(n.name),enabled:"model"===n.resourceType&&t});function ProcessedRowCountTag(e){let{isLoading:n,rowCount:t}=e;return(0,r.jsx)(R.Sn,{children:(0,r.jsx)(I.N,{isLoaded:!n,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:(0,r.jsx)(ModelRowCount,{rowCount:t})})})}function UnprocessedRowCountTag(e){let{isInteractive:n,invokeFunction:t}=e;return n?(0,r.jsx)(P.h,{"aria-label":"Query Row Count",icon:(0,r.jsx)(K.j3i,{}),size:"xs",onClick:()=>{t()}}):(0,r.jsx)(o.J,{as:K.ebq})}return!1===i&&!1===d&&!1===u?null:(0,r.jsx)(a.u,{hasArrow:!0,label:d||u||!i?"Number of row":"Query the number of row",openDelay:500,closeDelay:200,children:(0,r.jsxs)(R.Vp,{children:[(0,r.jsx)(R.AD,{as:M.SwK}),d||u?(0,r.jsx)(ProcessedRowCountTag,{isLoading:l,rowCount:s}):(0,r.jsx)(UnprocessedRowCountTag,{isInteractive:i,invokeFunction:c})]})})}function FetchRowCountsButton(e){let{nodes:n,onFinish:t}=e,[i,l]=(0,k.useState)(!1),[a,s]=(0,k.useState)(0),c=a<n.length?n[a].name:"",{isLoading:d,isFetched:u}=(0,B.a)({queryKey:H.rowCount(c),queryFn:()=>fetchModelRowCount(c),enabled:i});return(0,k.useEffect)(()=>{u&&(a+1<n.length?s(a+1):(l(!1),t&&t()))},[u,a,n,t]),(0,r.jsxs)(x.z,{size:"xs",variant:"outline",title:"Query Row Counts",onClick:()=>{s(0),l(!0)},isDisabled:d||0===n.length,children:[(0,r.jsx)(o.J,{as:K.j3i,mr:1}),d?"Querying":"Query Row Counts"]})}function GraphNode(e){var n,t;let c,{data:d}=e,{isHighlighted:h,isSelected:m,resourceType:x,changeStatus:f}=d,g=(0,i.oR)(e=>e.transform[2]>.3),{icon:p}=getIconForResourceType(x),j="gray.400",y="solid";f&&(c=getIconForChangeStatus(f).icon,j=getIconForChangeStatus(f).color);let v=j,C=d.isSelected?"outline":"unset",b=null==d?void 0:d.name;return(0,r.jsx)(a.u,{label:"model"===x?b:"".concat(b," (").concat(x,")"),placement:"top",children:(0,r.jsxs)(s.k,{width:"300px",_hover:{backgroundColor:g?"gray.100":j},borderColor:v,borderWidth:1,borderStyle:y,backgroundColor:g?"white":j,borderRadius:3,boxShadow:C,padding:0,className:!0===h?"node-highlight":!0===m?"node-highlight":!1===h?"node-unhighlight":void 0,children:[(0,r.jsx)(s.k,{backgroundColor:j,padding:2,borderRightWidth:1,borderColor:v,borderStyle:y,alignItems:"top",visibility:g?"inherit":"hidden",children:(0,r.jsx)(o.J,{as:p})}),(0,r.jsxs)(s.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:[(0,r.jsxs)(s.k,{width:"100%",textAlign:"left",flex:"1",p:1,alignItems:"center",visibility:g?"inherit":"hidden",children:[(0,r.jsx)(l.xu,{flex:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:b}),c&&(0,r.jsx)(s.k,{children:(0,r.jsx)(o.J,{color:j,as:c,flex:"0 0 20px"})})]}),"model"===d.resourceType&&(0,r.jsx)(s.k,{flex:"1 0 auto",mx:"1",direction:"column",paddingBottom:"1",visibility:g?"inherit":"hidden",children:(0,r.jsxs)(u.U,{spacing:"8px",children:[(0,r.jsx)(N.L,{}),(0,r.jsx)(RowCountTag,{node:d,isInteractive:!1})]})})]}),Object.keys(null!==(n=null==d?void 0:d.parents)&&void 0!==n?n:{}).length>0&&(0,r.jsx)(i.HH,{type:"target",position:i.Ly.Left,isConnectable:!1}),Object.keys(null!==(t=null==d?void 0:d.children)&&void 0!==t?t:{}).length>0&&(0,r.jsx)(i.HH,{type:"source",position:i.Ly.Right,isConnectable:!1})]})})}function GraphEdge(e){let{sourceX:n,sourceY:t,targetX:l,targetY:a,sourcePosition:s,targetPosition:o,style:c={},markerEnd:d,data:u}=e,h={...c};(null==u?void 0:u.changeStatus)&&(h.stroke=getIconForChangeStatus(null==u?void 0:u.changeStatus).color,h.strokeDasharray="5"),(null==u?void 0:u.isHighlighted)===!1&&(h.filter="opacity(0.2) grayscale(50%)");let[m]=(0,i.OQ)({sourceX:n,sourceY:t,sourcePosition:s,targetX:l,targetY:a,targetPosition:o});return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(i.u5,{path:m,markerEnd:d,style:{...h,...c}})})}var J=t(67907),Z=t(74796),X=t(79315),Y=t(58909),$=t(2593),ee=t(55344),en=t(1726),et=t(83622),er=t(21801),ei=t(29731);function mergeKeys(e,n){let t=[...e],r=[...n],i=[];for(;t.length>0&&r.length>0;)if(i.includes(t[0]))t.shift();else if(i.includes(r[0]))r.shift();else if(t[0]===r[0])i.push(t[0]),t.shift(),r.shift();else if(r.includes(t[0])){let e=r.indexOf(t[0]);for(let n=0;n<e;n++)i.includes(r[n])||i.push(r[n]);i.push(t[0]),t.shift(),r.splice(0,e+1)}else i.push(t[0]),t.shift();return t.forEach(e=>{i.includes(e)||i.push(e)}),r.forEach(e=>{i.includes(e)||i.push(e)}),i}function mergeKeysWithStatus(e,n){let t=mergeKeys(e,n),r={};for(let i of t)e.includes(i)?n.includes(i)?r[i]=void 0:r[i]="removed":r[i]="added";let i={};e.forEach((e,n)=>{i[e]=n});let l=-1;for(let e of t){let n=i[e];void 0!==n&&(n>l?l=n:r[e]="reordered")}return r}function mergeColumns(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={},r=mergeKeysWithStatus(Object.keys(e),Object.keys(n));return Object.entries(r).forEach(e=>{let[n,r]=e;t[n]={name:n,reordered:"reordered"===r}}),Object.entries(e).map((e,n)=>{let[r,i]=e;t[r].baseIndex=n+1,t[r].baseType=i.type}),Object.entries(n).map((e,n)=>{let[r,i]=e;t[r].currentIndex=n+1,t[r].currentType=i.type}),t}function toDataGrid(e){function columnIndexCellClass(e){return void 0===e.baseIndex?"column-index-added":void 0===e.currentIndex?"column-index-removed":!0===e.reordered?"column-index-reordered":"column-index-normal"}function columnNameCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":!0===e.reordered?"column-body-reordered":"column-body-normal"}function columnTypeCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":e.baseType!==e.currentType?"column-body-type-changed":!0===e.reordered?"column-body-reordered":"column-body-normal"}let n=Object.values(e);return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"currentIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"name",name:"Name",resizable:!0,cellClass:columnNameCellClass},{key:"baseType",name:"Base Type",resizable:!0,cellClass:columnTypeCellClass},{key:"currentType",name:"Current Type",resizable:!0,cellClass:columnTypeCellClass}],rows:n}}t(75165),t(91702);var el=t(52116),ea=t(93683),es=t(7873);function SchemaView(e){let n,{base:t,current:i}=e,{columns:l,rows:a}=(0,k.useMemo)(()=>toDataGrid(mergeColumns(null==t?void 0:t.columns,null==i?void 0:i.columns)),[t,i]),o=t&&void 0===t.columns,c=i&&void 0===i.columns;return o&&c?n="catalog.json is missing on both current and base environments.":o?n="catalog.json is missing on base environment.":c&&(n="catalog.json is missing on current environment."),(0,r.jsxs)(s.k,{direction:"column",children:[n&&(0,r.jsxs)(ea.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,r.jsx)(es.z,{}),n]}),a.length>0&&(0,r.jsx)(el.ZP,{style:{height:"100%",fontSize:"10pt",borderWidth:1,overflowY:"auto"},columns:l,rows:a,className:"rdg-light"})]})}let eo='select * from {{ ref("mymodel") }}',ec=(0,k.createContext)({sqlQuery:eo,setSqlQuery:()=>{}});function RecceQueryContextProvider(e){let{children:n}=e,[t,i]=k.useState(eo);return(0,r.jsx)(ec.Provider,{value:{setSqlQuery:i,sqlQuery:t},children:n})}let useRecceQueryContext=()=>(0,k.useContext)(ec);var ed=t(29357);function SqlDiffView(e){let{base:n,current:t}=e;return(0,r.jsx)(ed.SV,{height:"500px",language:"sql",theme:"vs",original:null==n?void 0:n.raw_code,modified:null==t?void 0:t.raw_code,options:{readOnly:!0,fontSize:14,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same"}})}var eu=t(90068),eh=t(41171),em=t(53930),ex=t(68665),ef=t(84680),eg=t(82822),ep=t(84068),ej=t(14800),ey=t(2600),ev=t(68677),eC=t(83358),eb=t(64095),ek=t(69005);function ValueDiffErrorHints(e){let{errors:n}=e;if(!n)return(0,r.jsx)(r.Fragment,{});for(let e of n)console.log(e);let ErrorEntry=e=>{let{error:n}=e;return""===n.model&&""===n.column_name?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.xu,{flex:"1",textAlign:"left",children:(0,r.jsxs)(ea.b,{status:"error",rounded:5,flexDirection:"column",children:[(0,r.jsx)(es.z,{boxSize:"40px"}),(0,r.jsx)(eg.C,{fontSize:"lg",mr:2,children:"Can not execute value-diff"}),(0,r.jsx)(ep.X,{children:n.sql})]})})}):(0,r.jsxs)(ej.Q,{children:[(0,r.jsxs)(ey.K,{children:[(0,r.jsx)(l.xu,{flex:"1",textAlign:"left",children:(0,r.jsxs)(ea.b,{status:"error",rounded:5,children:[(0,r.jsx)(es.z,{}),(0,r.jsxs)(eg.C,{fontSize:"sm",mr:2,children:["Test column [",n.column_name,"] ",n.test," failed on ",n.base?"base":"current"]})]})}),(0,r.jsx)(ev.X,{})]}),(0,r.jsx)(eC.H,{pb:4,children:(0,r.jsxs)(l.xu,{children:[(0,r.jsx)(l.xu,{children:"There are invalid data. You can check it with this query:"}),(0,r.jsx)(eb.E,{m:2,p:1,children:n.sql})]})})]})};return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(ek.U,{allowToggle:!0,mt:5,mb:5,children:n.map(e=>(0,r.jsx)(ErrorEntry,{error:e},"".concat(e.base,"_").concat(e.test,"_").concat(e.column_name)))})})}function ValueDiffPanel(e){let{valueDiffSummary:n}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.xu,{mb:1,children:["Model: ",(0,r.jsx)("b",{children:n.params.model}),", Primary Key: ",(0,r.jsx)("b",{children:n.params.primary_key})]}),(0,r.jsxs)(l.xu,{mb:1,children:[n.summary.total," rows (",n.summary.added," added, ",n.summary.removed," removed)"]}),(0,r.jsx)(ValueDiffErrorHints,{errors:n.errors}),0===n.errors.length&&(0,r.jsx)(el.ZP,{style:{height:"100%",width:"100%"},columns:n.columns.map(e=>({...e,width:void 0,resizable:!0,flexGrow:1})),rows:n.data,defaultColumnOptions:{resizable:!0},className:"rdg-light"})]})}function ValueDiffView(e){var n;let{check:t}=e,i=null===(n=t.last_run)||void 0===n?void 0:n.result,a=t.params,s=null;if(i){let e=i.data.schema.fields.map(e=>({name:e.name,key:e.name}));s={columns:e,data:i.data.data,summary:i.summary,params:a,errors:i.errors}}return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.xu,{p:5,children:s&&(0,r.jsx)(ValueDiffPanel,{valueDiffSummary:s})})})}var eS=t(32865);async function createSimpleCheck(){let e=await W.post("/api/checks",{type:"simple"}),n=e.data;return n}async function createCheckByNodeSchema(e){let n=await W.post("/api/checks",{type:"schema_diff",params:{node_id:e}}),t=n.data;return t}async function createCheckByRun(e){let n=await W.post("/api/checks",{run_id:e}),t=n.data;return t}async function listChecks(){let e=await W.get("/api/checks");return e.data}async function getCheck(e){let n=await W.get("/api/checks/".concat(e));return n.data}async function updateCheck(e,n){let t=await W.patch("/api/checks/".concat(e),n);return t.data}async function deleteCheck(e){let n=await W.delete("/api/checks/".concat(e));return n.data}function extractColumnNames(e){function getNames(e){return e&&e.columns?Object.values(e.columns).map(e=>e.name):[]}let n=getNames(e.data.base),t=getNames(e.data.current),r=[];return n.forEach(e=>{r.includes(e)||r.push(e)}),t.forEach(e=>{r.includes(e)||r.push(e)}),r}async function fetchColumnValuesComparison(e,n){try{let t=await W.post("/api/runs",{type:"value_diff",params:{model:e,primary_key:n}});return t.data}catch(e){console.error("Error fetching column values comparison:",e)}}async function handleAddToCheck(e){if(!e.runId)return null;let n=await createCheckByRun(e.runId);return n.check_id}var MismatchSummary=function(){let{isOpen:e,onOpen:n,onClose:t}=(0,c.q)(),[i,l]=(0,k.useState)(!1),[a,s]=(0,k.useState)(null);return{MismatchSummaryModal:o=>{let{node:c}=o,d="model"===c.resourceType||"seed"===c.resourceType||"source"===c.resourceType,u=extractColumnNames(c),[h,m]=(0,k.useState)(""),[,v]=(0,eS.TH)(),handleExecute=async()=>{if(!i&&""!==h){l(!0);try{let e=await fetchColumnValuesComparison(c.name,h),n=e.result,t=n.data.schema.fields.map(e=>({name:e.name,key:e.name}));s({columns:t,data:n.data.data,summary:n.summary,params:{model:c.name,primary_key:h},runId:e.run_id,errors:n.errors})}catch(e){console.error("Error fetching column values comparison:",e)}finally{l(!1)}}};return((0,k.useEffect)(()=>{var e;(null==a?void 0:null===(e=a.params)||void 0===e?void 0:e.model)!=c.name&&s(null)},[c.name]),d)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(f.u_,{isOpen:e,onClose:t,size:"6xl",children:[(0,r.jsx)(g.Z,{}),(0,r.jsxs)(p.h,{overflowY:"auto",height:"75%",children:[(0,r.jsx)(Y.x,{children:"Value Diff Summary"}),(0,r.jsx)(j.o,{}),(0,r.jsx)(y.f,{children:i?(0,r.jsx)(eu.E,{size:"xs",isIndeterminate:!0}):a?(0,r.jsx)(ValueDiffPanel,{valueDiffSummary:a}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(eh.NI,{children:[(0,r.jsx)(em.l,{children:"Pick a primary key"}),(0,r.jsx)(ex.P,{placeholder:"Select primary key",value:h,onChange:e=>m(e.target.value),children:u.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]})})}),(0,r.jsxs)(ef.m,{children:[a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.z,{mr:3,colorScheme:"blue",onClick:()=>{s(null)},children:"Clear"}),(0,r.jsx)(x.z,{mr:3,colorScheme:"blue",onClick:async()=>{let e=await handleAddToCheck(a);e&&v("/checks/".concat(e))},children:"Add to check"})]}),(0,r.jsx)(x.z,{colorScheme:"blue",onClick:handleExecute,children:"Execute"})]})]})]}),(0,r.jsx)(x.z,{colorScheme:"blue",size:"sm",onClick:n,children:"Value Diff Summary"})]}):(0,r.jsx)(r.Fragment,{})}}},ew=t(35537),e_=t(70556);async function submitRun(e,n){let t=await W.post("/api/runs",{type:e,params:n}),r=t.data;return r}async function submitProfileDiff(e){return await submitRun("profile_diff",e)}var eE=t(76920),eD=t(83978),eN=t.n(eD);function _getPrimaryKeyValue(e,n){let t={};return t[n]=e[n],JSON.stringify(t)}function toDataDiffGrid(e,n){let t="column_name",r={schema:{fields:[],primaryKey:[]},data:[]};if(!e&&n)e=r;else if(!n&&e)n=r;else if(!e||!n)return{rows:[],columns:[]};let i=[],l={},a={};n.schema.fields.forEach(e=>{l[e.name]={},l[e.name].current=e}),e.schema.fields.forEach(e=>{l[e.name]||(l[e.name]={}),l[e.name].base=e}),Object.keys(l).forEach(e=>{if("index"===e||e===t||"profiled_at"===e)return;let cellClass=n=>{if(!eN().isEqual(n["base__".concat(e)],n["current__".concat(e)]))return"diff-cell"};i.push({name:e,children:[{key:"base__".concat(e),name:"Base",renderEditCell:el.Ug,cellClass},{key:"current__".concat(e),name:"Current",renderEditCell:el.Ug,cellClass}]})}),n.data.forEach(e=>{let n=_getPrimaryKeyValue(e,t);a[n]={},a[n].current=e}),e.data.forEach(e=>{let n=_getPrimaryKeyValue(e,t);a[n]||(a[n]={}),a[n].base=e});let s=Object.entries(a).map(e=>{let[n,{base:r,current:i}]=e,l=JSON.parse(n);return r&&Object.keys(r).forEach(e=>{e!==t&&(l["base__".concat(e)]=r[e])}),i&&Object.keys(i).forEach(e=>{e!==t&&(l["current__".concat(e)]=i[e])}),l});return{columns:[{key:t,name:t,frozen:!0,cellClass:"index-column"},...i],rows:s}}let ProfileDiffDataGrid=e=>{let{isFetching:n,result:t,error:i}=e,l=(0,k.useMemo)(()=>n?{rows:[],columns:[]}:toDataDiffGrid(null==t?void 0:t.base,null==t?void 0:t.current),[t,n]);return n?(0,r.jsxs)(eE.M,{p:"16px",height:"100%",children:[(0,r.jsx)(d.$,{size:"sm",mr:"8px"}),"Loading..."]}):i?(0,r.jsxs)(ea.b,{status:"error",children:[(0,r.jsx)(es.z,{}),"Error: ",null==i?void 0:i.message]}):0===l.columns.length?(0,r.jsx)(eE.M,{height:"100%",children:"No data"}):(0,r.jsx)(el.ZP,{style:{blockSize:"100%"},columns:l.columns,rows:l.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,width:100},className:"rdg-light"})},ProfileDiffModal=e=>{let{node:n}=e,t=(0,ew.NL)(),{isOpen:i,onOpen:l,onClose:a}=(0,c.q)(),[,s]=(0,eS.TH)(),{data:o,mutate:d,error:u,isPending:h}=(0,e_.D)({mutationFn:submitProfileDiff}),m=(0,k.useCallback)(async()=>{if(!(null==o?void 0:o.run_id))return;let e=await createCheckByRun(o.run_id);t.invalidateQueries({queryKey:H.checks()}),s("/checks/".concat(e.check_id))},[null==o?void 0:o.run_id,s,t]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(f.u_,{isOpen:i,onClose:a,size:"6xl",children:[(0,r.jsx)(g.Z,{}),(0,r.jsxs)(p.h,{overflowY:"auto",height:"75%",children:[(0,r.jsx)(Y.x,{children:"Model Profile Diff"}),(0,r.jsx)(j.o,{}),(0,r.jsx)(y.f,{children:(0,r.jsx)(ProfileDiffDataGrid,{isFetching:h,result:null==o?void 0:o.result,error:u})}),(0,r.jsx)(ef.m,{children:(0,r.jsx)(x.z,{mr:3,colorScheme:"blue",onClick:m,children:"Add to check"})})]})]}),(0,r.jsx)(x.z,{colorScheme:"blue",size:"sm",onClick:()=>{l(),d({model:n.name})},children:"Profile Diff"})]})};function NodeView(e){let{node:n,onCloseNode:t}=e,[,i]=(0,eS.TH)(),{setSqlQuery:a}=useRecceQueryContext(),o="model"===n.resourceType||"seed"===n.resourceType||"source"===n.resourceType,{isOpen:d,onOpen:h,onClose:m}=(0,c.q)(),{MismatchSummaryModal:v}=MismatchSummary(),C=(0,k.useCallback)(async()=>{let e=n.id,t=await createCheckByNodeSchema(e);i("/checks/".concat(t.check_id))},[n,i]);return(0,r.jsxs)(Z.r,{height:"100%",templateRows:"auto auto 1fr",children:[(0,r.jsxs)(u.U,{children:[(0,r.jsx)(l.xu,{flex:"0 1 20%",p:"16px",children:(0,r.jsx)(X.X,{size:"sm",children:n.name})}),(0,r.jsx)(N.L,{}),"modified"===n.changeStatus&&(0,r.jsxs)(l.xu,{children:[(0,r.jsx)(x.z,{onClick:h,leftIcon:(0,r.jsx)(L.tvD,{}),colorScheme:"orange",variant:"solid",children:"Diff"}),(0,r.jsxs)(f.u_,{isOpen:d,onClose:m,size:"6xl",children:[(0,r.jsx)(g.Z,{}),(0,r.jsxs)(p.h,{overflowY:"auto",height:"75%",children:[(0,r.jsx)(Y.x,{children:"Model Raw Code Diff"}),(0,r.jsx)(j.o,{}),(0,r.jsx)(y.f,{children:(0,r.jsx)(SqlDiffView,{base:n.data.base,current:n.data.current})})]})]})]}),(0,r.jsx)(l.xu,{flex:"0 1 1%",p:"16px",children:(0,r.jsx)($.P,{onClick:t})})]}),(0,r.jsx)(l.xu,{color:"gray",paddingLeft:"16px",children:(0,r.jsxs)(u.U,{spacing:"8px",children:[(0,r.jsx)(ResourceTypeTag,{node:n}),"model"===n.resourceType&&(0,r.jsx)(RowCountTag,{node:n})]})}),o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(ee.m,{overflow:"auto",as:s.k,children:[(0,r.jsx)(en.t,{children:(0,r.jsx)(et.O,{children:"Columns"})}),(0,r.jsx)(er.n,{overflow:"auto",height:"calc(100% - 42px)",children:(0,r.jsx)(ei.x,{p:0,overflowY:"auto",height:"100%",children:(0,r.jsx)(SchemaView,{base:n.data.base,current:n.data.current})})})]}),(0,r.jsxs)(u.U,{p:"16px",children:[(0,r.jsx)(x.z,{colorScheme:"blue",size:"sm",onClick:C,children:"Add schema check"}),"model"===n.resourceType&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ProfileDiffModal,{node:n}),"added"!==n.changeStatus&&"removed"!==n.changeStatus&&(0,r.jsx)(v,{node:n}),(0,r.jsx)(x.z,{colorScheme:"blue",size:"sm",onClick:()=>{a('select * from {{ ref("'.concat(n.name,'") }}')),i("/query")},children:"Query"})]})]})]})]})}var ez=t(43898),eL=t(99691);async function getLineage(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=await W.get("/api/lineage?base=".concat(e));return n.data}async function getLineageWithError(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let n=await getLineage(e);return{data:n}}catch(e){if(!(e instanceof eL.d7))return{error:null==e?void 0:e.message};{var n,t;let r=null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(n=t.data)||void 0===n?void 0:n.detail;if(r)return{error:r};return{error:null==e?void 0:e.message}}}}async function getLineageDiff(){let[e,n]=await Promise.all([getLineageWithError(!0),getLineageWithError(!1)]);return{base:e.data,current:n.data,base_error:e.error,current_error:n.error}}var eq=t(15550),eF=t(21123),eT=t.n(eF);let eO=(0,k.createContext)({});function LineageWatcher(e){let{refetch:n}=e,t=(0,eq.p)(),[i,l]=(0,k.useState)(),a=(0,ew.NL)();return(0,k.useEffect)(()=>{function httpUrlToWebSocketUrl(e){return e.replace(/(http)(s)?\:\/\//,"ws$2://")}let e=new WebSocket("".concat(httpUrlToWebSocketUrl(Q),"/api/ws"));return l(e),e.onopen=()=>{e.send("ping")},e.onmessage=e=>{if("pong"!==e.data)try{let n=JSON.parse(e.data);if("refresh"===n.command){let{eventType:e,srcPath:r}=n.event,[i,l]=r.split("/").slice(-2),s=eT().parse(l).name;t({description:"Detected ".concat(i," ").concat(s," ").concat(e),status:"info",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0}),a.invalidateQueries({queryKey:H.lineage()})}}catch(e){console.error(e)}},()=>{e&&e.close()}},[t,a]),(0,r.jsx)(r.Fragment,{})}function LineageGraphsContextProvider(e){let{children:n}=e,{data:t,isLoading:i,error:l,refetch:a}=(0,B.a)({queryKey:H.lineage(),queryFn:getLineageDiff}),s=(0,k.useMemo)(()=>{if(t)return buildDefaultLineageGraphSets(t.base,t.current)},[t]),o=(null==l?void 0:l.message)||(null==t?void 0:t.current_error)||(null==t?void 0:t.base_error);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(LineageWatcher,{refetch:a}),(0,r.jsx)(eO.Provider,{value:{lineageGraphSets:s,error:o,isLoading:i},children:n})]})}let useLineageGraphsContext=()=>(0,k.useContext)(eO);var eR=t(17180);let eI={added:["Model Added","Added resource"],removed:["Model Removed","Removed resource"],modified:["Model Modified","Modified resource"],col_added:["Column Added","Added column"],col_removed:["Column Removed","Removed column"],col_changed:["Column Modified","Modified column"],folder_changed:["Modified","Modified folder"]};function ChangeSummary_getIconForChangeStatus(e){if("added"===e)return{color:"#1dce00",icon:F};if("removed"===e)return{color:"#ff067e",icon:T};if("modified"===e)return{color:"#ffa502",icon:O};if("col_added"===e)return{color:"#1dce00",icon:F};if("col_removed"===e)return{color:"#ff067e",icon:T};if("col_changed"===e)return{color:"#ffa502",icon:O};if("folder_changed"===e)return{color:"#ffa502",icon:IconChanged};return{color:"inherit",icon:void 0}}function SummaryText(e){let{name:n,value:t,tip:i}=e;return(0,r.jsxs)(m.g,{alignItems:"stretch",children:[(0,r.jsxs)(h.x,{fontSize:"sm",color:"gray",children:[n,i&&(0,r.jsx)(a.u,{label:i,children:(0,r.jsx)(l.xu,{display:"inline-block",children:(0,r.jsx)(o.J,{mx:"2px",as:M.H33,boxSize:3})})})]}),t]})}function ChangeStatusCountLabel(e){let{changeStatus:n,value:t}=e,[i]=n?eI[n]:[""],{icon:l,color:a}=ChangeSummary_getIconForChangeStatus(n);return(0,r.jsxs)(m.g,{alignItems:"stretch",children:[(0,r.jsxs)(s.k,{alignItems:"center",fontSize:"sm",color:"gray",children:[(0,r.jsx)(o.J,{mr:"5px",as:l,color:a}),i]}),(0,r.jsx)(h.x,{fontSize:"sm",children:t})]})}function calculateColumnChange(e,n){let t=0,r=0,i=0;return(e||n)&&(n&&Object.keys(n.columns||{}).forEach(n=>{(!e||!e.columns||!e.columns[n])&&t++}),e&&Object.keys(e.columns||{}).forEach(e=>{(!n||!n.columns||!n.columns[e])&&r++}),n&&e&&Object.keys(n.columns||{}).forEach(t=>{e.columns&&n.columns&&e.columns[t]&&e.columns[t].type!==n.columns[t].type&&i++})),{adds:t,removes:r,modifies:i}}function calculateChangeSummary(e,n){let t=0,r=0,i=0,l=0,a=0,s=0;return n.forEach(n=>{"added"===e.nodes[n].changeStatus?t++:"removed"===e.nodes[n].changeStatus?r++:"modified"===e.nodes[n].changeStatus&&i++;let o=e.nodes[n].data.base,c=e.nodes[n].data.current,d=calculateColumnChange(o,c);l+=d.adds,a+=d.removes,s+=d.modifies}),{adds:t,removes:r,modifies:i,col_added:l,col_removed:a,col_changed:s}}function ChangeSummary(e){let{lineageGraphSets:n}=e,{adds:t,removes:i,modifies:a,col_added:s,col_removed:o,col_changed:c}=calculateChangeSummary(n.all,n.modifiedSet);return(0,r.jsxs)(Z.r,{templateColumns:"1fr 1fr",mb:"10px",borderTop:"1px solid lightgray",padding:"2.5vw",children:[(0,r.jsx)(l.xu,{borderColor:"lightgray",children:(0,r.jsx)(SummaryText,{name:"Code Changes",value:(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(Z.r,{templateColumns:"1fr 1fr 1fr",width:"100%",children:[(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"added",value:t}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"removed",value:i}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"modified",value:a})]})})})}),(0,r.jsx)(l.xu,{borderLeft:"1px",paddingLeft:"12px",borderColor:"lightgray",children:(0,r.jsx)(SummaryText,{name:"Column Changes",value:(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(Z.r,{templateColumns:"1fr 1fr 1fr",width:"100%",children:[(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"col_added",value:s}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"col_removed",value:o}),(0,r.jsx)(ChangeStatusCountLabel,{changeStatus:"col_changed",value:c})]})})})})]})}var eP=t(76353),eM=t(53248),eK=t(9763),eA=t(95853);function SchemaDiffCard(e){let{node:n,...t}=e;return(0,r.jsxs)(eP.Z,{maxWidth:"500px",children:[(0,r.jsxs)(eM.O,{children:[(0,r.jsx)(X.X,{fontSize:18,children:t.title}),(0,r.jsxs)(u.U,{spacing:"8px",p:"16px",children:[(0,r.jsx)(ResourceTypeTag,{node:n}),"model"===n.resourceType&&(0,r.jsx)(RowCountTag,{node:n,isAutoFetching:!0})]})]}),(0,r.jsx)(eK.e,{children:(0,r.jsx)(s.k,{children:(0,r.jsx)(SchemaView,{base:n.data.base,current:n.data.current})})})]})}function listChangedNodes(e){let n=[],t=e.all.nodes;return e.modifiedSet.forEach(e=>{var r,i;let l=t[e],a=mergeKeysWithStatus(Object.keys((null===(r=l.data.base)||void 0===r?void 0:r.columns)||{}),Object.keys((null===(i=l.data.current)||void 0===i?void 0:i.columns)||{})),s=!Object.values(a).every(e=>void 0===e);s&&l.data.base&&l.data.current&&n.push(l)}),n}function SchemaSummary(e){let{lineageGraphSets:n}=e,[t,i]=(0,k.useState)([]);return(0,k.useEffect)(()=>{i(listChangedNodes(n))},[n]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",marginTop:"20px",children:(0,r.jsx)(X.X,{fontSize:24,children:"Schema Summary"})}),(0,r.jsx)(s.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",children:0===t.length?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(h.x,{fontSize:18,color:"gray",children:"No schema changes detected."})}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(eA.M,{minChildWidth:"400px",spacing:"2vw",padding:"2.5vw",width:"100%",backgroundColor:"lightgray",children:t.map(e=>(0,r.jsx)(SchemaDiffCard,{title:e.name,node:e},e.id))})})})]})}function SummaryView(){let{lineageGraphSets:e}=useLineageGraphsContext();return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(s.k,{direction:"column",w:"100%",minHeight:"650px",children:[(0,r.jsx)(s.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",children:(0,r.jsx)(X.X,{fontSize:24,children:"Change Summary"})}),e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ChangeSummary,{lineageGraphSets:e}),(0,r.jsx)(eR.i,{}),(0,r.jsx)(SchemaSummary,{lineageGraphSets:e})]})]})})}var eV=t(45438),eQ=t(40312),eG=t(52246),eW=t(25807);function AddSchemaChangesCheckButton(e){let{nodes:n,onFinish:t}=e,[,i]=(0,eS.TH)();return(0,r.jsxs)(x.z,{size:"xs",variant:"outline",isDisabled:0===n.length,onClick:async()=>{let e;1===n.length?e=await createCheckByNodeSchema(n[0].id):await Promise.all(n.map(async e=>{await createCheckByNodeSchema(e.id)})),t(),e?i("/checks/".concat(e.check_id)):i("/checks")},children:[(0,r.jsx)(o.J,{as:K.Edg}),"Add schema check"]})}function NodeSelector(e){let{nodes:n,isOpen:t,onClose:i}=e;function countSelectedNodes(e){return e.filter(e=>e.isSelected).length}let a=n.filter(e=>e.isSelected);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(eQ.R,{in:t,style:{zIndex:10},children:(0,r.jsx)(l.xu,{bg:"white",rounded:"md",shadow:"dark-lg",children:(0,r.jsxs)(u.U,{p:"5px 15px",mt:"4",divider:(0,r.jsx)(eG.c,{borderColor:"gray.200"}),spacing:4,children:[(0,r.jsxs)(eW.h,{size:"xs",isAttached:!0,variant:"outline",rounded:"xs",onClick:i,children:[(0,r.jsxs)(x.z,{children:[countSelectedNodes(n)," selected"]}),(0,r.jsx)(P.h,{"aria-label":"Exit select Mode",icon:(0,r.jsx)(eV.D,{})})]}),(0,r.jsxs)(u.U,{children:[(0,r.jsx)(FetchRowCountsButton,{nodes:a.length>0?a:[],onFinish:i}),(0,r.jsx)(AddSchemaChangesCheckButton,{nodes:a.length>0?a:[],onFinish:i})]})]})})})})}let layout=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR",r=new(D()).graphlib.Graph;r.setDefaultEdgeLabel(()=>({})),r.setGraph({rankdir:t}),e.forEach(e=>{r.setNode(e.id,{width:300,height:36})}),n.forEach(e=>{r.setEdge(e.source,e.target)}),D().layout(r),e.forEach(e=>{let n=r.node(e.id);return e.position={x:n.x-150,y:n.y-18},e})},eU={customNode:GraphNode},eH={customEdge:GraphEdge},nodeColor=e=>{var n,t;return(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.changeStatus)?getIconForChangeStatus(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.changeStatus).color:"lightgray"},eB={all:"All",changed_models:"Changed Models"};function ChangeStatusLegend(){return(0,r.jsx)(l.xu,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[n,[t,i]]=e,{icon:l,color:c}=getIconForChangeStatus(n);return(0,r.jsx)(a.u,{label:i,children:(0,r.jsxs)(s.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,r.jsx)(o.J,{color:c,as:l})," ",t]})},n)})})}function _LineageView(){let[e,n,t]=(0,i.Rr)([]),[a,E,D]=(0,i.ll)([]),[N,z]=(0,k.useState)(),[L,q]=(0,k.useState)(),{lineageGraphSets:F,isLoading:T,error:O}=useLineageGraphsContext(),{isOpen:R,onOpen:I,onClose:P}=(0,c.q)(),[K,A]=(0,k.useState)("detail"),[V,Q]=(0,k.useState)(),[G,W]=(0,k.useState)("changed_models"),[U,H]=(0,k.useState)(!1),[B,Z]=(0,k.useState)({x:0,y:0});if((0,k.useEffect)(()=>{if(!F)return;let e="changed_models"===G?F.changed:F.all,t=F.modifiedSet,[r,i]=toReactflow(e,F.modifiedSet);layout(r,i),z(e),q(t),n(r),E(i)},[n,E,G,F]),T)return(0,r.jsx)(s.k,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:(0,r.jsx)(d.$,{size:"xl"})});let closeContextMenu=()=>{H(!1),Z({x:0,y:0})};return O?(0,r.jsxs)(r.Fragment,{children:["Fail to load lineage data: ",O]}):(0,r.jsxs)(s.k,{width:"100%",height:"100%",children:[(0,r.jsx)(l.xu,{flex:"1 0 0px",children:(0,r.jsxs)(i.x$,{nodeTypes:eU,edgeTypes:eH,nodes:e,edges:a,onNodesChange:t,onEdgesChange:D,onNodeClick:(t,r)=>{if(closeContextMenu(),"action"===K){let t=selectNode(r.id,e);n(t)}else Q(r.id)},onNodeMouseEnter:(t,r)=>{if(N&&void 0!==L){let[t,i]=highlightPath(N,L,e,a,r.id);n(t),E(i)}},onNodeMouseLeave:(t,r)=>{if(N&&void 0!==L){let[t,r]=highlightPath(N,L,e,a,null);n(t),E(r)}},onNodeContextMenu:(e,n)=>{"action"===K&&(e.preventDefault(),Z({x:e.clientX,y:e.clientY,selectedNode:n}),H(!0))},onClick:closeContextMenu,maxZoom:1,minZoom:.1,fitView:!0,children:[(0,r.jsx)(S.A,{color:"#ccc"}),(0,r.jsxs)(w.Z,{showInteractive:!1,position:"top-right",children:[(0,r.jsx)(w.B,{title:"switch mode",onClick:()=>{W("all"===G?"changed_models":"all");let t=cleanUpSelectedNodes(e);n(t)},children:(0,r.jsx)(o.J,{as:M.Bw1})}),(0,r.jsx)(w.B,{title:"download image",onClick:()=>{let e=document.querySelector(".react-flow__viewport");(null==e?void 0:e.parentElement)&&(0,ez.YM)(null==e?void 0:e.parentElement,{backgroundColor:"#ffffff00",width:null==e?void 0:e.parentElement.clientWidth,height:null==e?void 0:e.parentElement.clientHeight,style:{width:"".concat(null==e?void 0:e.parentElement.clientWidth),height:"".concat(null==e?void 0:e.parentElement.clientHeight)}}).then(e=>{let n=document.createElement("a");n.setAttribute("download","recce-lineage.png"),n.setAttribute("target","_blank"),n.setAttribute("href",e),n.click()})},children:(0,r.jsx)(o.J,{as:M.wzc})}),(0,r.jsx)(w.B,{title:"summary",onClick:I,children:(0,r.jsx)(o.J,{as:M.SnF})})]}),(0,r.jsx)(i.s_,{position:"bottom-left",children:(0,r.jsxs)(u.U,{children:[(0,r.jsx)(ChangeStatusLegend,{}),(0,r.jsxs)(l.xu,{p:2,flex:"0 1 160px",fontSize:"14px",children:[(0,r.jsx)(h.x,{color:"gray",mb:"2px",children:"Actions"}),(0,r.jsx)(m.g,{spacing:1,align:"baseline",children:(0,r.jsx)(x.z,{size:"xs",variant:"outline",isDisabled:"action"===K,onClick:()=>{let t=cleanUpSelectedNodes(e);n(t),A("detail"===K?"action":"detail")},children:"Select Models"})})]})]})}),(0,r.jsx)(i.s_,{position:"top-left",children:(0,r.jsx)(h.x,{fontSize:"xl",color:"grey",opacity:.5,children:eB[G]})}),(0,r.jsx)(i.s_,{position:"bottom-center",children:(0,r.jsx)(NodeSelector,{nodes:e.map(e=>e.data),isOpen:"action"===K,onClose:()=>{A("detail");let t=cleanUpSelectedNodes(e);n(t)}})}),(0,r.jsx)(_.a,{nodeColor:nodeColor,nodeStrokeWidth:3})]})}),(0,r.jsxs)(f.u_,{isOpen:R,onClose:P,size:"6xl",children:[(0,r.jsx)(g.Z,{}),(0,r.jsxs)(p.h,{overflowY:"auto",height:"80%",children:[(0,r.jsx)(j.o,{}),(0,r.jsx)(y.f,{children:(0,r.jsx)(SummaryView,{})})]})]}),"detail"===K&&V&&(null==N?void 0:N.nodes[V])&&(0,r.jsx)(l.xu,{flex:"0 0 500px",borderLeft:"solid 1px lightgray",height:"100%",children:(0,r.jsx)(NodeView,{node:null==N?void 0:N.nodes[V],onCloseNode:()=>{Q(void 0)}})}),U&&(0,r.jsx)(v.v,{isOpen:!0,onClose:closeContextMenu,children:(0,r.jsxs)(C.q,{style:{position:"absolute",left:"".concat(B.x,"px"),top:"".concat(B.y,"px")},children:[(0,r.jsx)(b.s,{icon:(0,r.jsx)(J.Cv2,{}),onClick:()=>{let t=B.selectedNode;if("action"!==K||void 0===t||void 0===N)return;let r=t.id,i=selectUpstream(N,[r]),l=selectNodes([...i],e);n(l)},children:"Select parent nodes"}),(0,r.jsx)(b.s,{icon:(0,r.jsx)(J.IMj,{}),onClick:()=>{let t=B.selectedNode;if("action"!==K||void 0===t||void 0===N)return;let r=t.id,i=selectDownstream(N,[r]),l=selectNodes([...i],e);n(l)},children:"Select child nodes"})]})})]})}function LineageView(){return(0,r.jsx)(i.tV,{children:(0,r.jsx)(_LineageView,{})})}var eJ=t(12844),eZ=t(98786);function RecceContextProvider(e){let{children:n}=e;return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(RecceQueryContextProvider,{children:(0,r.jsx)(LineageGraphsContextProvider,{children:n})})})}function useVersionNumber(){let[e,n]=(0,k.useState)("");return(0,k.useEffect)(()=>{(async function(){try{let e=await W.get("/api/version");n(e.data)}catch(e){console.error("Error fetching version number:",e)}})()},[]),e}var eX=t(18974),eY=t(51348),e$=t(44525),e0=t(234),e1=t(96094),e2=t(25535),e5=t(36334);function CheckBreadcrumb(e){let{name:n,setName:t}=e,[i,a]=(0,k.useState)(!1),[s,o]=(0,k.useState)(n),c=(0,k.useRef)(null),d=(0,k.useCallback)(()=>{t(s),a(!1)},[t,a,s]);return(0,k.useEffect)(()=>{let handleClickOutside=e=>{c.current&&!c.current.contains(e.target)&&d()};return i&&document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}},[i,c,d]),(0,r.jsxs)(e0.a,{flex:"0 1",fontSize:"12pt",fontWeight:"500",separator:(0,r.jsx)(e5.X,{color:"gray.500"}),children:[(0,r.jsx)(e1.g,{children:(0,r.jsx)(l.xu,{children:"Checklist"})}),(0,r.jsx)(e1.g,{flex:"0 1",cursor:"pointer",children:i?(0,r.jsx)(e2.I,{ref:c,value:s,onChange:e=>{o(e.target.value)},onKeyDown:e=>{"Enter"===e.key?(t(s),a(!1)):"Escape"===e.key&&(o(n),a(!1))},size:"sm",w:"auto",minW:"200px",maxW:"600px"}):(0,r.jsx)(l.xu,{onClick:()=>{o(n),a(!0)},textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n})})]})}var query_SqlEditor=e=>{let{value:n,onChange:t,onRun:i,onRunDiff:l,options:a={},...s}=e;return(0,r.jsx)(ed.ZP,{language:"sql",theme:"vs",value:n,onChange:e=>{void 0!==e&&t&&t(e)},onMount:(e,n)=>{i&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.Enter,i),l&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.Enter,l)},options:{tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent",...a}})};function querydiff_getPrimaryKeyValue(e,n){let t={};for(let r of n)t[r]=e[r];return JSON.stringify(t)}function DataFrameColumnGroupHeader(e){let{name:n,primaryKeys:t,onPrimaryKeyChange:i}=e;return"index"===n?(0,r.jsx)(r.Fragment,{}):t.includes(n)?(0,r.jsxs)(s.k,{alignItems:"center",children:[(0,r.jsx)(l.xu,{flex:1,children:n}),i&&(0,r.jsx)(o.J,{cursor:"pointer",as:z.ven,onClick:()=>{let e=t.filter(e=>e!==n);i(e)}})]}):(0,r.jsxs)(s.k,{alignItems:"center",children:[(0,r.jsx)(l.xu,{flex:1,children:n}),i&&(0,r.jsx)(o.J,{cursor:"pointer",as:z.MhP,onClick:()=>{let e=[...t.filter(e=>"index"!==e),n];i(e)}})]})}function querydiff_toDataDiffGrid(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0,l={schema:{fields:[],primaryKey:[]},data:[]};if(!e&&n)e=l,0===t.length&&(t=n.schema.primaryKey);else if(!n&&e)n=l,0===t.length&&(t=e.schema.primaryKey);else{if(!e||!n)return{rows:[],columns:[]};if(!eN().isEqual(e.schema.primaryKey,n.schema.primaryKey))throw Error("primary key mismatch! ".concat(e.schema.primaryKey," != ").concat(n.schema.primaryKey));0===t.length&&(t=e.schema.primaryKey)}let a=[],s=[],o={},c={};n.schema.fields.forEach(e=>{o[e.name]={},o[e.name].current=e}),e.schema.fields.forEach(e=>{o[e.name]||(o[e.name]={}),o[e.name].base=e}),Object.entries(o).forEach(e=>{let[n,{base:l,current:o}]=e;if(t.includes(n))s.push({key:"".concat(n),name:(0,r.jsx)(DataFrameColumnGroupHeader,{name:n,primaryKeys:t,onPrimaryKeyChange:i}),frozen:!0,cellClass:"index"===n?"index-column":void 0});else{if("index"===n)return;let cellClass=e=>{if(!eN().isEqual(e["base__".concat(n)],e["current__".concat(n)]))return"diff-cell"};a.push({name:(0,r.jsx)(DataFrameColumnGroupHeader,{name:n,primaryKeys:t,onPrimaryKeyChange:i}),children:[{key:"base__".concat(n),name:"Base",renderEditCell:el.Ug,cellClass},{key:"current__".concat(n),name:"Current",renderEditCell:el.Ug,cellClass}]})}}),n.data.forEach(e=>{let n=querydiff_getPrimaryKeyValue(e,t);c[n]={},c[n].current=e}),e.data.forEach(e=>{let n=querydiff_getPrimaryKeyValue(e,t);c[n]||(c[n]={}),c[n].base=e});let d=Object.entries(c).map(e=>{let[n,{base:r,current:i}]=e,l=JSON.parse(n);return r&&Object.keys(r).forEach(e=>{t.includes(e)||(l["base__".concat(e)]=r[e])}),i&&Object.keys(i).forEach(e=>{t.includes(e)||(l["current__".concat(e)]=i[e])}),l});return{columns:[...s,...a],rows:d}}t(7866);let QueryDiffDataGrid=e=>{let{isFetching:n,result:t,error:i,primaryKeys:l,setPrimaryKeys:a}=e,s=(0,k.useMemo)(()=>n?{rows:[],columns:[]}:querydiff_toDataDiffGrid(null==t?void 0:t.base,null==t?void 0:t.current,l,a),[t,n,l,a]),{base_error:o,current_error:c}=t||{};return n?(0,r.jsxs)(eE.M,{p:"16px",height:"100%",children:[(0,r.jsx)(d.$,{size:"sm",mr:"8px"}),"Loading..."]}):i||o&&c?(0,r.jsxs)(ea.b,{status:"error",children:[(0,r.jsx)(es.z,{}),"Error: ",(null==i?void 0:i.message)||c]}):0===s.columns.length?(0,r.jsx)(eE.M,{height:"100%",children:"No data"}):(0,r.jsx)(el.ZP,{style:{blockSize:"100%"},columns:s.columns,rows:s.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,width:100},className:"rdg-light"})};function QueryDiffView(e){var n,t,i;let{check:a}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ek.U,{defaultIndex:[],allowToggle:!0,children:(0,r.jsxs)(ej.Q,{children:[(0,r.jsxs)(ey.K,{children:["query",(0,r.jsx)(ev.X,{})]}),(0,r.jsx)(eC.H,{children:(0,r.jsx)(l.xu,{height:"400px",width:"100%",border:"lightgray 1px solid ",children:(0,r.jsx)(query_SqlEditor,{value:(null===(n=null==a?void 0:a.params)||void 0===n?void 0:n.sql_template)||"",options:{readOnly:!0}})})})]})}),(0,r.jsx)(l.xu,{flex:"1",style:{contain:"size"},children:(null==a?void 0:a.type)==="query_diff"&&(0,r.jsx)(QueryDiffDataGrid,{isFetching:!1,result:null==a?void 0:null===(t=a.last_run)||void 0===t?void 0:t.result,primaryKeys:(null===(i=null==a?void 0:a.params)||void 0===i?void 0:i.primary_keys)||[]})})]})}function SchemaDiffView(e){let{check:n}=e,{lineageGraphSets:t}=useLineageGraphsContext(),i=n.params,l=i.node_id,a=l?null==t?void 0:t.all.nodes[l]:void 0;return a?(0,r.jsx)(SchemaView,{base:a.data.base,current:a.data.current}):(0,r.jsx)(r.Fragment,{})}var e3=t(33695),e6=t(34030);function CheckDescription(e){let{value:n,onChange:t}=e,[i,l]=(0,k.useState)(!1),[a,o]=(0,k.useState)();return i?(0,r.jsxs)(s.k,{direction:"column",align:"flex-end",children:[(0,r.jsx)(e3.g,{h:"200px",value:a,onChange:e=>{o(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&l(!1)}}),(0,r.jsxs)(s.k,{gap:"12px",alignItems:"flex-end",children:[(0,r.jsx)(e6.r,{onClick:()=>{setTimeout(()=>{l(!1)},100)},colorScheme:"blue",children:"cancel"}),(0,r.jsx)(x.z,{mt:"8px",size:"sm",colorScheme:"blue",onClick:()=>{t&&(t(a),l(!1))},children:"Update"})]})]}):(0,r.jsx)(h.x,{maxHeight:"400px",overflow:"auto",fontSize:"11pt",onClick:()=>{o(n||""),l(!0)},whiteSpace:"pre-line",color:n?"inherit":"lightgray",children:n||"Add description here"})}function QueryDataGrid_toDataGrid(e){let n=e.schema.fields.map(e=>({key:e.name,name:"index"===e.name?"":e.name,width:"index"===e.name?10:"auto",cellClass:"index"===e.name?"index-column":void 0}));return{columns:n,rows:e.data}}let QueryDataGrid=e=>{let{isFetching:n,result:t,error:i}=e,l=null==t?void 0:t.result,a=(0,k.useMemo)(()=>n||!l?{rows:[],columns:[]}:QueryDataGrid_toDataGrid(l),[n,l]);return n?(0,r.jsxs)(eE.M,{p:"16px",height:"100%",children:[(0,r.jsx)(d.$,{size:"sm",mr:"8px"}),"Loading..."]}):i||(null==t?void 0:t.error)?(0,r.jsxs)(ea.b,{status:"error",children:[(0,r.jsx)(es.z,{}),"Error: ",(null==i?void 0:i.message)||(null==t?void 0:t.error)]}):0===a.columns.length?(0,r.jsx)(eE.M,{height:"100%",children:"No data"}):(0,r.jsx)(el.ZP,{style:{blockSize:"100%"},columns:a.columns,rows:a.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,width:100},className:"rdg-light"})};function QueryView(e){var n,t;let{check:i}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ek.U,{defaultIndex:[],allowToggle:!0,children:(0,r.jsxs)(ej.Q,{children:[(0,r.jsxs)(ey.K,{children:["query",(0,r.jsx)(ev.X,{})]}),(0,r.jsx)(eC.H,{children:(0,r.jsx)(l.xu,{height:"400px",width:"100%",border:"lightgray 1px solid ",children:(0,r.jsx)(query_SqlEditor,{value:(null===(n=null==i?void 0:i.params)||void 0===n?void 0:n.sql_template)||"",options:{readOnly:!0}})})})]})}),(0,r.jsx)(l.xu,{flex:"1",style:{contain:"size"},children:(null==i?void 0:i.type)==="query"&&(0,r.jsx)(QueryDataGrid,{isFetching:!1,result:null==i?void 0:null===(t=i.last_run)||void 0===t?void 0:t.result})})]})}function ProfileDiffView(e){var n;let{check:t}=e;return(0,r.jsx)(l.xu,{flex:"1",style:{contain:"size"},children:(0,r.jsx)(ProfileDiffDataGrid,{isFetching:!1,result:null==t?void 0:null===(n=t.last_run)||void 0===n?void 0:n.result})})}let CheckDetail=e=>{let{checkId:n}=e,t=(0,ew.NL)(),[,i]=(0,eS.TH)(),{isLoading:a,error:c,data:d}=(0,B.a)({queryKey:H.check(n),queryFn:()=>getCheck(n),refetchOnMount:!1,staleTime:3e5}),{mutate:u}=(0,e_.D)({mutationFn:e=>updateCheck(n,e),onSuccess:()=>{t.invalidateQueries({queryKey:H.check(n)}),t.invalidateQueries({queryKey:H.checks()})}}),{mutate:h}=(0,e_.D)({mutationFn:()=>deleteCheck(n),onSuccess:()=>{t.invalidateQueries({queryKey:H.checks()}),i("/checks")}});return a?(0,r.jsx)(eE.M,{h:"100%",children:"Loading"}):c?(0,r.jsxs)(eE.M,{h:"100%",children:["Error: ",c.message]}):(0,r.jsxs)(s.k,{height:"100%",width:"100%",maxHeight:"100%",direction:"column",children:[(0,r.jsxs)(s.k,{p:"0px 16px",alignItems:"center",children:[(0,r.jsx)(CheckBreadcrumb,{name:(null==d?void 0:d.name)||"",setName:e=>{u({name:e})}}),(0,r.jsxs)(v.v,{children:[(0,r.jsx)(eX.j,{as:P.h,icon:(0,r.jsx)(o.J,{as:z.D_A}),variant:"ghost"}),(0,r.jsx)(C.q,{children:(0,r.jsx)(b.s,{icon:(0,r.jsx)(e$.p,{}),onClick:()=>h(),children:"Delete"})})]}),(0,r.jsx)(N.L,{}),(0,r.jsx)(eY.X,{isChecked:null==d?void 0:d.is_checked,onChange:e=>{let n=e.target.checked;u({is_checked:n})},children:"Check"})]}),(0,r.jsx)(l.xu,{p:"8px 16px",minHeight:"100px",children:(0,r.jsx)(CheckDescription,{value:null==d?void 0:d.description,onChange:e=>{u({description:e})}},null==d?void 0:d.check_id)}),d&&"query"==d.type&&(0,r.jsx)(QueryView,{check:d}),d&&"query_diff"==d.type&&(0,r.jsx)(QueryDiffView,{check:d}),d&&"value_diff"==d.type&&(0,r.jsx)(ValueDiffView,{check:d}),d&&"schema_diff"==d.type&&(0,r.jsx)(SchemaDiffView,{check:d}),d&&"profile_diff"==d.type&&(0,r.jsx)(ProfileDiffView,{check:d})]})};var e8=t(15012),e4=t(99986);let ChecklistItem=e=>{let{check:n,selected:t,onSelect:i}=e,a=(0,ew.NL)(),c=n.check_id,{mutate:d}=(0,e_.D)({mutationFn:e=>updateCheck(c,e),onSuccess:()=>{a.invalidateQueries({queryKey:H.check(c)}),a.invalidateQueries({queryKey:H.checks()})}}),u=(e=>{switch(e){case"schema_diff":return e8.uhn;case"query":case"query_diff":return e8.r2i;case"value_diff":return e8.pRi;case"profile_diff":return e8.dku;default:return e8.WzH}})(n.type);return(0,r.jsxs)(s.k,{width:"100%",p:"10px 20px",cursor:"pointer",_hover:{bg:"gray.200"},bg:t?"gray.100":"inherit",onClick:()=>i(n.check_id),alignItems:"center",gap:"5px",children:[(0,r.jsx)(o.J,{as:u}),(0,r.jsx)(l.xu,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n.name}),n.is_checked&&(0,r.jsx)(o.J,{color:"green",as:L.FJM})]})},CheckPage=()=>{let[,e]=(0,eS.TH)(),[,n]=(0,eS.yj)("/checks/:checkId"),t=(0,ew.NL)(),i=null==n?void 0:n.checkId,{isLoading:o,error:c,data:d,status:u}=(0,B.a)({queryKey:H.checks(),queryFn:listChecks,refetchOnMount:!0}),h=(0,k.useCallback)(n=>{e("/checks/".concat(n))},[e]),f=(0,k.useCallback)(async()=>{let e=await createSimpleCheck();t.invalidateQueries({queryKey:H.checks()}),h(e.check_id)},[t,h]);return((0,k.useEffect)(()=>{"success"===u&&!i&&d.length>0&&e("/checks/".concat(d[0].check_id))},[u,i,d,e]),o)?(0,r.jsx)(r.Fragment,{children:"Loading"}):c?(0,r.jsxs)(r.Fragment,{children:["Error: ",c.message]}):(null==d?void 0:d.length)?(0,r.jsxs)(s.k,{height:"100%",children:[(0,r.jsx)(l.xu,{flex:"0 0 400px",borderRight:"lightgray solid 1px",height:"100%",style:{contain:"size"},children:(0,r.jsxs)(m.g,{spacing:0,align:"flex-end",children:[(0,r.jsx)(a.u,{label:"Create a simple check",children:(0,r.jsx)(P.h,{mr:"10px",variant:"unstyled","aria-label":"Create a simple check",onClick:f,icon:(0,r.jsx)(e4.d,{})})}),(0,r.jsx)(eR.i,{mb:"8px"}),d.map(e=>(0,r.jsx)(ChecklistItem,{check:e,selected:e.check_id===i,onSelect:h},e.check_id))]})}),(0,r.jsx)(l.xu,{flex:"1",height:"100%",width:"calc(100% - 400px)",children:(0,r.jsx)(eS.rs,{children:(0,r.jsx)(eS.AW,{path:"/checks/:checkId",children:e=>(0,r.jsx)(CheckDetail,{checkId:e.checkId})})})})]}):(0,r.jsx)(eE.M,{h:"100%",children:(0,r.jsxs)(m.g,{children:[(0,r.jsx)(l.xu,{children:"No checks"}),(0,r.jsx)(x.z,{colorScheme:"blue",onClick:f,children:"Create a simple check"})]})})};async function submitQuery(e){return await submitRun("query",e)}async function submitQueryDiff(e){return await submitRun("query_diff",e)}let QueryPage=()=>{let{sqlQuery:e,setSqlQuery:n}=useRecceQueryContext(),[t,i]=(0,k.useState)(),[a,o]=(0,k.useState)([]),c=(0,ew.NL)(),[,d]=(0,eS.TH)(),queryFn=async n=>"query"===n?submitQuery({sql_template:e}):submitQueryDiff({sql_template:e}),{data:u,mutate:h,error:m,isPending:f}=(0,e_.D)({mutationFn:queryFn,onSuccess:n=>{o([]),i(e)}}),g=(0,k.useCallback)(async()=>{if(!(null==u?void 0:u.run_id))return;let e=await createCheckByRun(u.run_id);"query_diff"===u.type&&await updateCheck(e.check_id,{params:{...e.params,primary_keys:a}}),i(void 0),c.invalidateQueries({queryKey:H.checks()}),d("/checks/".concat(e.check_id))},[null==u?void 0:u.run_id,null==u?void 0:u.type,d,a,c]);return(0,r.jsxs)(s.k,{direction:"column",height:"100%",children:[(0,r.jsxs)(s.k,{justifyContent:"right",padding:"5px",gap:"5px",children:[(0,r.jsx)(x.z,{colorScheme:"blue",onClick:g,isDisabled:f||!(null==u?void 0:u.run_id)||e!=t,size:"sm",children:"Add to Checklist"}),(0,r.jsx)(x.z,{colorScheme:"blue",onClick:()=>h("query_diff"),isDisabled:f,size:"sm",children:"Run Diff"}),(0,r.jsx)(x.z,{colorScheme:"blue",onClick:()=>h("query"),isDisabled:f,size:"sm",children:"Run"})]}),(0,r.jsx)(l.xu,{flex:"1",border:"1px solid #CBD5E0",height:"200px",width:"100%",children:(0,r.jsx)(query_SqlEditor,{value:e,onChange:n,onRun:()=>h("query"),onRunDiff:()=>h("query_diff")})}),(0,r.jsx)(l.xu,{backgroundColor:"gray.100",height:"50vh",children:(null==u?void 0:u.type)==="query"?(0,r.jsx)(QueryDataGrid,{isFetching:f,result:null==u?void 0:u.result,error:m}):(0,r.jsx)(QueryDiffDataGrid,{isFetching:f,result:null==u?void 0:u.result,error:m,primaryKeys:a,setPrimaryKeys:o})})]})};var e7=t(72952);let hashNavigate=e=>(0,e7.c4)("#!"+e),useHashLocation=()=>{let e=(0,e7.LD)(()=>window.location.hash.replace(/^#!/,"")||"/",()=>"/ssr");return[e,hashNavigate]};var e9=t(12218);function getCookie(e){var n=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return n?n.pop():""}function NavBar(){let[e,n]=(0,eS.TH)(),t=useVersionNumber(),i=[["Lineage","/lineage"],["Query","/query"],["Checklist","/checks"],["Summary","/summary"]],a=eN().findIndex(i,n=>{let[,t]=n;return e.startsWith(t)});return(0,r.jsx)(ee.m,{index:a,children:(0,r.jsxs)(en.t,{children:[i.map(e=>{let[t,i]=e;return(0,r.jsx)(et.O,{onClick:()=>{n(i)},children:t},t)}),(0,r.jsx)(l.xu,{position:"absolute",right:"0",top:"0",p:"2",color:"gray.500",children:t})]})})}function Home(){(0,k.useLayoutEffect)(()=>{let e=getCookie("recce_user_id");if(e&&e9.env.AMPLITUDE_API_KEY)try{eZ.S1(e9.env.AMPLITUDE_API_KEY,e,{defaultTracking:!0})}catch(e){console.error(e)}},[]);let e="calc(100vh - 42px)";return(0,r.jsx)(eJ.x,{children:(0,r.jsx)(ew.aH,{client:U,children:(0,r.jsx)(RecceContextProvider,{children:(0,r.jsxs)(eS.F0,{hook:useHashLocation,children:[(0,r.jsx)(NavBar,{}),(0,r.jsx)(l.xu,{p:0,h:e,maxH:e,overflow:"auto",children:(0,r.jsxs)(eS.rs,{children:[(0,r.jsx)(eS.AW,{path:"/lineage",children:(0,r.jsx)(LineageView,{})}),(0,r.jsx)(eS.AW,{path:"/query",children:(0,r.jsx)(QueryPage,{})}),(0,r.jsx)(eS.AW,{path:"/checks/:slug*",children:(0,r.jsx)(CheckPage,{})}),(0,r.jsx)(eS.AW,{path:"/summary",children:(0,r.jsx)(SummaryView,{})}),(0,r.jsx)(eS.AW,{path:"/ssr",children:(0,r.jsx)(r.Fragment,{children:"Loading"})}),(0,r.jsx)(eS.AW,{children:(0,r.jsx)(eS.l_,{to:"/lineage"})})]})})]})})})})}},88727:function(){},7866:function(){},75165:function(){}},function(e){e.O(0,[145,170,521,531,182,710,971,495,968,297,62,744],function(){return e(e.s=99178)}),_N_E=e.O()}]);