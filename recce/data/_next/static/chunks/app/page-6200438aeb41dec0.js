(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{99178:function(e,n,r){Promise.resolve().then(r.bind(r,32993))},32993:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return Home}});var t=r(757),o=r(27869);function getNeighborSet(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,t=new Set,o={},dfs=(e,r)=>{if(r<0||void 0!==o[e]&&o[e]>=r)return;o[e]=r;let i=n(e);for(let e of i)dfs(e,r-1);t.add(e)};for(let n of e)dfs(n,r);return t}function buildDefaultLineageGraphSets(e,n){function buildAllLineageGraph(e,n){let r={},t={},buildNode=(e,n)=>({id:e,name:e,data:{},from:n,parents:{},children:{},isSelected:!1});for(let[n,t]of Object.entries(e.parent_map)){r[n]=buildNode(n,"base");let t=e.nodes&&e.nodes[n];t&&(r[n].data.base=t,r[n].name=null==t?void 0:t.name,r[n].resourceType=null==t?void 0:t.resource_type,r[n].packageName=null==t?void 0:t.package_name)}for(let[e,t]of Object.entries(n.parent_map)){r[e]?r[e].from="both":r[e]=buildNode(e,"current");let t=n.nodes&&n.nodes[e];t&&(r[e].data.current=n.nodes&&n.nodes[e],r[e].name=null==t?void 0:t.name,r[e].resourceType=null==t?void 0:t.resource_type,r[e].packageName=null==t?void 0:t.package_name)}for(let[n,o]of Object.entries(e.parent_map))for(let e of o){let o=r[n],i=r[e],l="".concat(e,"_").concat(n);t[l]={id:l,from:"base",parent:i,child:o};let a=t[l];o.parents[e]=a,i.children[n]=a}for(let[e,o]of Object.entries(n.parent_map))for(let n of o){let o=r[e],i=r[n],l="".concat(n,"_").concat(e);t[l]?t[l].from="both":t[l]={id:l,from:"current",parent:i,child:o};let a=t[l];o.parents[n]=a,i.children[e]=a}return{edges:t,nodes:r}}function buildChangedOnlyLineageGraph(e,n){let r={},t={};function union(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];let t=new Set;return n.forEach(e=>{e.forEach(e=>{t.add(e)})}),t}let o=selectDownstream(e,n),i=selectUpstream(e,n,1),l=union(o,i);return Object.entries(e.nodes).forEach(e=>{let[n,t]=e;l.has(n)&&(r[n]=t)}),Object.entries(e.edges).forEach(e=>{let[n,r]=e;l.has(r.parent.id)&&l.has(r.child.id)&&(t[n]=r)}),{nodes:r,edges:t}}let{nodes:r,edges:t}=buildAllLineageGraph(e,n),o=[];for(let[e,n]of Object.entries(r))if("base"===n.from)n.changeStatus="removed",o.push(n.id);else if("current"===n.from)n.changeStatus="added",o.push(n.id);else{var i,l,a,s,c,d;let e=null==n?void 0:null===(a=n.data)||void 0===a?void 0:null===(l=a.base)||void 0===l?void 0:null===(i=l.checksum)||void 0===i?void 0:i.checksum,r=null==n?void 0:null===(d=n.data)||void 0===d?void 0:null===(c=d.current)||void 0===c?void 0:null===(s=c.checksum)||void 0===s?void 0:s.checksum;e&&r&&e!==r&&(n.changeStatus="modified",o.push(n.id))}for(let[e,n]of Object.entries(t))"base"===n.from?n.changeStatus="removed":"current"===n.from&&(n.changeStatus="added");return{all:{nodes:r,edges:t},changed:buildChangedOnlyLineageGraph({nodes:r,edges:t},o),modifiedSet:o}}function selectUpstream(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].parents),r)}function selectDownstream(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].children),r)}function toReactflow(e,n){let r=[],t=[];for(let[n,t]of Object.entries(e.nodes))r.push({id:t.id,position:{x:0,y:0},data:t,type:"customNode",targetPosition:o.Ly.Left,sourcePosition:o.Ly.Right});for(let[n,r]of Object.entries(e.edges))t.push({id:r.id,type:"customEdge",source:r.parent.id,target:r.child.id,data:r});return highlightPath(e,n,r,t,null)}function highlightPath(e,n,r,t,o){function union(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];let t=new Set;return n.forEach(e=>{e.forEach(e=>{t.add(e)})}),t}let i=null!==o?union(selectUpstream(e,[o]),selectDownstream(e,[o])):getNeighborSet(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].children)),l=new Set(t.filter(e=>i.has(e.source)&&i.has(e.target)).map(e=>e.id)),a=r.map(e=>({...e,data:{...e.data,isHighlighted:i.has(e.id)}})),s=t.map(e=>({...e,data:{...e.data,isHighlighted:l.has(e.id)}}));return[a,s]}function selectNode(e,n){let r=n.map(n=>{let r=n.id===e;return{...n,data:{...n.data,isSelected:n.data.isSelected!==r}}});return r}function selectNodes(e,n){let r=n.map(n=>{let r=e.includes(n.id);return{...n,data:{...n.data,isSelected:n.data.isSelected||r}}});return r}function cleanUpSelectedNodes(e){let n=e.map(e=>({...e,data:{...e.data,isSelected:!1}}));return n}var i=r(10126),l=r(83172),a=r(55528),s=r(29330),c=r(17714),d=r(46543),u=r(76920),h=r(39668),m=r(83179),x=r(62648),f=r(43093),g=r(7752),p=r(94410),y=r(35337),j=r(29985),v=r(42524),C=r(36700),b=r(10287),k=r(24275),w=r(27726),S=r(26187),_=r(23704),E=r(33710),D=r(93864),z=r.n(D);r(94570);var N=r(90593),T=r(11180),F=r(63240),R=r(54057);let q=T.Nbv,L=T.sFB,O=T.UGs,IconChanged=e=>(0,t.jsxs)("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"0 0 16 16",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 11 a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}),(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:""})]});function getIconForChangeStatus(e){return"added"===e?{color:"#1dce00",icon:q}:"removed"===e?{color:"#ff4444",icon:L}:"modified"===e?{color:"#ffa502",icon:O}:{color:"inherit",icon:void 0}}function getIconForResourceType(e){return"model"===e?{color:"#c0eafd",icon:F.Fn3}:"metric"===e?{color:"#ffe6ee",icon:R._MV}:"source"===e?{color:"#a6dda6",icon:F.i1q}:"exposure"===e?{color:"#ffe6ee",icon:R.n8P}:"semantic_model"===e?{color:"#fb8caf",icon:R.R1C}:"seed"===e?{color:"#a6dda6",icon:F.tWi}:{color:"inherit",icon:void 0}}r(88727);var I=r(19920),M=r(7467),K=r(95913),A=r(89042),P=r(80294),B=r(10929),G=r(12218);let V=G.env.NEXT_PUBLIC_API_URL?G.env.NEXT_PUBLIC_API_URL:window.location.origin;var W=r(27471);let Q=B.default.create({baseURL:V}),H=new W.S;async function fetchModelRowCount(e){let n=await Q.get("/api/models/".concat(e,"/row_count"));return n.data}let U={rowCount:e=>["row_count",e],lineage:()=>["lineage"],checks:()=>["checks","list"],check:e=>["checks",e]};var J=r(8200);function ModelRowCount(e){let{rowCount:n}=e;if(!n)return(0,t.jsxs)(x.U,{children:[(0,t.jsx)(f.x,{children:"Failed to load"}),(0,t.jsx)(s.J,{as:A.KZt,color:"red.500"})]});let r=null===n.base?-1:n.base,o=null===n.curr?-1:n.curr,i=-1===r?"N/A":r,l=-1===o?"N/A":o;return r===o?(0,t.jsxs)(f.x,{children:[r," rows"]}):r<o?(0,t.jsxs)(x.U,{children:[(0,t.jsx)(f.x,{children:i}),(0,t.jsx)(s.J,{as:A.QqI,color:"green.500"}),(0,t.jsxs)(f.x,{children:[l," rows"]})]}):(0,t.jsxs)(x.U,{children:[(0,t.jsx)(f.x,{children:i}),(0,t.jsx)(s.J,{as:A.ZBs,color:"red.500"}),(0,t.jsxs)(f.x,{children:[l," rows"]}),"rows"]})}function ResourceTypeTag(e){let{node:n}=e,{icon:r}=getIconForResourceType(n.resourceType);return(0,t.jsx)(l.u,{hasArrow:!0,label:"Type of resource",children:(0,t.jsxs)(I.Vp,{children:[(0,t.jsx)(I.AD,{as:r}),(0,t.jsx)(I.Sn,{children:n.resourceType})]})})}function RowCountTag(e){let{node:n,isAutoFetching:r=!1,isInteractive:o=!0}=e,{isLoading:i,data:a,refetch:c,isFetched:d,isFetching:u}=(0,J.a)({queryKey:U.rowCount(n.name),queryFn:()=>fetchModelRowCount(n.name),enabled:"model"===n.resourceType&&r});function ProcessedRowCountTag(e){let{isLoading:n,rowCount:r}=e;return(0,t.jsx)(I.Sn,{children:(0,t.jsx)(M.N,{isLoaded:!n,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:(0,t.jsx)(ModelRowCount,{rowCount:r})})})}function UnprocessedRowCountTag(e){let{isInteractive:n,invokeFunction:r}=e;return n?(0,t.jsx)(K.h,{"aria-label":"Query Row Count",icon:(0,t.jsx)(P.j3i,{}),size:"xs",onClick:()=>{r()}}):(0,t.jsx)(s.J,{as:P.ebq})}return!1===o&&!1===d&&!1===u?null:(0,t.jsx)(l.u,{hasArrow:!0,label:d||u||!o?"Number of row":"Query the number of row",openDelay:500,closeDelay:200,children:(0,t.jsxs)(I.Vp,{children:[(0,t.jsx)(I.AD,{as:A.SwK}),d||u?(0,t.jsx)(ProcessedRowCountTag,{isLoading:i,rowCount:a}):(0,t.jsx)(UnprocessedRowCountTag,{isInteractive:o,invokeFunction:c})]})})}function FetchRowCountsButton(e){let{nodes:n,onFinish:r}=e,[o,i]=(0,w.useState)(!1),[l,a]=(0,w.useState)(0),c=l<n.length?n[l].name:"",{isLoading:d,isFetched:u}=(0,J.a)({queryKey:U.rowCount(c),queryFn:()=>fetchModelRowCount(c),enabled:o});return(0,w.useEffect)(()=>{u&&(l+1<n.length?a(l+1):(i(!1),r&&r()))},[u,l,n,r]),(0,t.jsxs)(m.z,{size:"xs",variant:"outline",title:"Query Row Counts",onClick:()=>{a(0),i(!0)},isDisabled:d||0===n.length,children:[(0,t.jsx)(s.J,{as:P.j3i,mr:1}),d?"Querying":"Query Row Counts"]})}function GraphNode(e){var n,r;let c,{data:d}=e,{isHighlighted:u,isSelected:h,resourceType:m,changeStatus:f}=d,g=(0,o.oR)(e=>e.transform[2]>.3),{icon:p}=getIconForResourceType(m),y="gray.400",j="solid";f&&(c=getIconForChangeStatus(f).icon,y=getIconForChangeStatus(f).color);let v=y,C=d.isSelected?"outline":"unset",b=null==d?void 0:d.name;return(0,t.jsx)(l.u,{label:"model"===m?b:"".concat(b," (").concat(m,")"),placement:"top",children:(0,t.jsxs)(a.k,{width:"300px",_hover:{backgroundColor:g?"gray.100":y},borderColor:v,borderWidth:1,borderStyle:j,backgroundColor:g?"white":y,borderRadius:3,boxShadow:C,padding:0,className:!0===u?"node-highlight":!0===h?"node-highlight":!1===u?"node-unhighlight":void 0,children:[(0,t.jsx)(a.k,{backgroundColor:y,padding:2,borderRightWidth:1,borderColor:v,borderStyle:j,alignItems:"top",visibility:g?"inherit":"hidden",children:(0,t.jsx)(s.J,{as:p})}),(0,t.jsxs)(a.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:[(0,t.jsxs)(a.k,{width:"100%",textAlign:"left",flex:"1",p:1,alignItems:"center",visibility:g?"inherit":"hidden",children:[(0,t.jsx)(i.xu,{flex:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:b}),c&&(0,t.jsx)(a.k,{children:(0,t.jsx)(s.J,{color:y,as:c,flex:"0 0 20px"})})]}),"model"===d.resourceType&&(0,t.jsx)(a.k,{flex:"1 0 auto",mx:"1",direction:"column",paddingBottom:"1",visibility:g?"inherit":"hidden",children:(0,t.jsxs)(x.U,{spacing:"8px",children:[(0,t.jsx)(N.L,{}),(0,t.jsx)(RowCountTag,{node:d,isInteractive:!1})]})})]}),Object.keys(null!==(n=null==d?void 0:d.parents)&&void 0!==n?n:{}).length>0&&(0,t.jsx)(o.HH,{type:"target",position:o.Ly.Left,isConnectable:!1}),Object.keys(null!==(r=null==d?void 0:d.children)&&void 0!==r?r:{}).length>0&&(0,t.jsx)(o.HH,{type:"source",position:o.Ly.Right,isConnectable:!1})]})})}function GraphEdge(e){let{sourceX:n,sourceY:r,targetX:i,targetY:l,sourcePosition:a,targetPosition:s,style:c={},markerEnd:d,data:u}=e,h={...c};(null==u?void 0:u.changeStatus)&&(h.stroke=getIconForChangeStatus(null==u?void 0:u.changeStatus).color,h.strokeDasharray="5"),(null==u?void 0:u.isHighlighted)===!1&&(h.filter="opacity(0.2) grayscale(50%)");let[m]=(0,o.OQ)({sourceX:n,sourceY:r,sourcePosition:a,targetX:i,targetY:l,targetPosition:s});return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(o.u5,{path:m,markerEnd:d,style:{...h,...c}})})}var X=r(67907),Z=r(74796),Y=r(79315),$=r(58909),ee=r(2593),en=r(55344),er=r(1726),et=r(83622),eo=r(21801),ei=r(29731),el=r(18974);function mergeKeys(e,n){let r=[...e],t=[...n],o=[];for(;r.length>0&&t.length>0;)if(o.includes(r[0]))r.shift();else if(o.includes(t[0]))t.shift();else if(r[0]===t[0])o.push(r[0]),r.shift(),t.shift();else if(t.includes(r[0])){let e=t.indexOf(r[0]);for(let n=0;n<e;n++)o.includes(t[n])||o.push(t[n]);o.push(r[0]),r.shift(),t.splice(0,e+1)}else o.push(r[0]),r.shift();return r.forEach(e=>{o.includes(e)||o.push(e)}),t.forEach(e=>{o.includes(e)||o.push(e)}),o}function mergeKeysWithStatus(e,n){let r=mergeKeys(e,n),t={};for(let o of r)e.includes(o)?n.includes(o)?t[o]=void 0:t[o]="removed":t[o]="added";let o={};e.forEach((e,n)=>{o[e]=n});let i=-1;for(let e of r){let n=o[e];void 0!==n&&(n>i?i=n:t[e]="reordered")}return t}function mergeColumns(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={},t=mergeKeysWithStatus(Object.keys(e),Object.keys(n));return Object.entries(t).forEach(e=>{let[n,t]=e;r[n]={name:n,reordered:"reordered"===t}}),Object.entries(e).map((e,n)=>{let[t,o]=e;r[t].baseIndex=n+1,r[t].baseType=o.type}),Object.entries(n).map((e,n)=>{let[t,o]=e;r[t].currentIndex=n+1,r[t].currentType=o.type}),r}function toDataGrid(e){function columnIndexCellClass(e){return void 0===e.baseIndex?"column-index-added":void 0===e.currentIndex?"column-index-removed":!0===e.reordered?"column-index-reordered":"column-index-normal"}function columnNameCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":!0===e.reordered?"column-body-reordered":"column-body-normal"}function columnTypeCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":e.baseType!==e.currentType?"column-body-type-changed":!0===e.reordered?"column-body-reordered":"column-body-normal"}let n=Object.values(e);return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"currentIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"name",name:"Name",resizable:!0,cellClass:columnNameCellClass},{key:"baseType",name:"Base Type",resizable:!0,cellClass:columnTypeCellClass},{key:"currentType",name:"Current Type",resizable:!0,cellClass:columnTypeCellClass}],rows:n}}r(75165),r(91702);var ea=r(93683),es=r(7873),ec=r(52116),ed=r(47367),eu=r(15550),eh=r(55201),em=r.n(eh);function useToBlob(e){let{imageType:n="png",boardEffect:r=!0,shadowEffect:t=!1,borderStyle:o="solid 1px #ccc",borderRadius:i="10px",onSuccess:l,onError:a}=e,[s,c]=(0,w.useState)("idle"),d=(0,w.useRef)(null),toImage=async()=>{if(!d.current){console.error("No node to use for screenshot"),c("error"),a&&a(Error("No node to use for screenshot"));return}let e=d.current.element||d.current,s=e.style.overflow,u=e.style.border,h=e.style.borderRadius;function resetStyles(){e.style.overflow=s,e.style.border=u,e.style.borderRadius=h}try{e.style.overflow="hidden",e.style.border=r?o:"",e.style.borderRadius=r?i:"",c("loading");let s=await em()(e,{backgroundColor:null}),d=t?document.createElement("canvas"):s;if(t){d.width=s.width+80,d.height=s.height+80;let e=d.getContext("2d");if(e)e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=20,e.shadowOffsetX=10,e.shadowOffsetY=10,e.drawImage(s,40,40);else{console.error("Error getting canvas context"),c("error"),a&&a(Error("Error getting canvas context to add shadow effect"));return}}d.toBlob(async e=>{c("success"),l&&e&&await l(e)},"image/".concat(n))}catch(e){console.error("Error converting to image",e),c("error"),a&&a(e);return}finally{resetStyles()}};return{status:s,isLoading:"loading"===s,isErrored:"error"===s,isSuccess:"success"===s,toImage,ref:d}}function useClipBoardToast(){let e=(0,eu.p)();return{successToast:function(){e({description:"Copied the query result as an image to clipboard",status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})},failToast:function(n){e({title:"Failed to copy image to clipboard",description:"".concat(n),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}}}async function copyBlobToClipboard(e){if(!e)throw Error("No blob to copy to clipboard");try{await navigator.clipboard.write([new ClipboardItem({[e.type]:e})])}catch(e){throw console.error("Error copying to clipboard",e),e}}function useCopyToClipboardButton(){let{successToast:e,failToast:n}=useClipBoardToast(),{isLoading:r,toImage:o,ref:i}=useToBlob({imageType:"png",shadowEffect:!0,onSuccess:async r=>{try{copyBlobToClipboard(r),e()}catch(e){n(e)}},onError:e=>{console.error("Error taking screenshot",e),n(e)}});function CopyToClipboardButton(e){let{imageType:n="png",...l}=e;return(0,t.jsx)(m.z,{size:"sm",leftIcon:(0,t.jsx)(ed.T,{}),style:{position:"absolute",bottom:"16px",right:"16px"},isLoading:r,onMouseEnter:()=>{if(i.current){let e=i.current.element||i.current;e.style.boxShadow="rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px",e.style.transition="box-shadow 0.5s ease-in-out"}},onMouseLeave:()=>{if(i.current){let e=i.current.element||i.current;e.style.boxShadow=""}},onClick:async()=>{i.current&&await o()},children:"Copy to Clipboard"})}return{ref:i,CopyToClipboardButton}}function ScreenshotDataGrid(e){let{enableScreenshot:n=!0,...r}=e,{ref:o,CopyToClipboardButton:i}=useCopyToClipboardButton();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ec.ZP,{ref:o,...r}),n&&(0,t.jsx)(i,{imageType:"png"})]})}function SchemaView(e){let n,{base:r,current:o,enableScreenshot:i}=e,{columns:l,rows:s}=(0,w.useMemo)(()=>toDataGrid(mergeColumns(null==r?void 0:r.columns,null==o?void 0:o.columns)),[r,o]),c=r&&void 0===r.columns,d=o&&void 0===o.columns;return c&&d?n="catalog.json is missing on both current and base environments.":c?n="catalog.json is missing on base environment.":d&&(n="catalog.json is missing on current environment."),(0,t.jsxs)(a.k,{direction:"column",children:[n&&(0,t.jsxs)(ea.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,t.jsx)(es.z,{}),n]}),s.length>0&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:l,rows:s,className:"rdg-light"})})]})}let ex='select * from {{ ref("mymodel") }}',ef=(0,w.createContext)({sqlQuery:ex,setSqlQuery:()=>{}});function RecceQueryContextProvider(e){let{children:n}=e,[r,o]=w.useState(ex);return(0,t.jsx)(ef.Provider,{value:{setSqlQuery:o,sqlQuery:r},children:n})}let useRecceQueryContext=()=>(0,w.useContext)(ef);var eg=r(29357);function SqlDiffView(e){let{base:n,current:r}=e;return(0,t.jsx)(eg.SV,{height:"500px",language:"sql",theme:"vs",original:null==n?void 0:n.raw_code,modified:null==r?void 0:r.raw_code,options:{readOnly:!0,fontSize:14,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same"}})}var ep=r(90068),ey=r(41171),ej=r(53930),ev=r(68665),eC=r(84680),eb=r(82822),ek=r(84068),ew=r(14800),eS=r(2600),e_=r(68677),eE=r(83358),eD=r(64095),ez=r(69005);function ValueDiffErrorHints(e){let{errors:n}=e;if(!n)return(0,t.jsx)(t.Fragment,{});for(let e of n)console.log(e);let ErrorEntry=e=>{let{error:n}=e;return""===n.model&&""===n.column_name?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(i.xu,{flex:"1",textAlign:"left",children:(0,t.jsxs)(ea.b,{status:"error",rounded:5,flexDirection:"column",children:[(0,t.jsx)(es.z,{boxSize:"40px"}),(0,t.jsx)(eb.C,{fontSize:"lg",mr:2,children:"Can not execute value-diff"}),(0,t.jsx)(ek.X,{children:n.sql})]})})}):(0,t.jsxs)(ew.Q,{children:[(0,t.jsxs)(eS.K,{children:[(0,t.jsx)(i.xu,{flex:"1",textAlign:"left",children:(0,t.jsxs)(ea.b,{status:"error",rounded:5,children:[(0,t.jsx)(es.z,{}),(0,t.jsxs)(eb.C,{fontSize:"sm",mr:2,children:["Test column [",n.column_name,"] ",n.test," failed on ",n.base?"base":"current"]})]})}),(0,t.jsx)(e_.X,{})]}),(0,t.jsx)(eE.H,{pb:4,children:(0,t.jsxs)(i.xu,{children:[(0,t.jsx)(i.xu,{children:"There are invalid data. You can check it with this query:"}),(0,t.jsx)(eD.E,{m:2,p:1,children:n.sql})]})})]})};return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(ez.U,{allowToggle:!0,mt:5,mb:5,children:n.map(e=>(0,t.jsx)(ErrorEntry,{error:e},"".concat(e.base,"_").concat(e.test,"_").concat(e.column_name)))})})}function ValueDiffPanel(e){let{valueDiffSummary:n}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.xu,{mb:1,children:["Model: ",(0,t.jsx)("b",{children:n.params.model}),", Primary Key: ",(0,t.jsx)("b",{children:n.params.primary_key})]}),(0,t.jsxs)(i.xu,{mb:1,children:[n.summary.total," rows (",n.summary.added," added, ",n.summary.removed," removed)"]}),(0,t.jsx)(ValueDiffErrorHints,{errors:n.errors}),0===n.errors.length&&(0,t.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:n.columns.map(e=>({...e,width:void 0,resizable:!0,flexGrow:1})),rows:n.data,defaultColumnOptions:{resizable:!0},className:"rdg-light",enableScreenshot:!0})]})}function ValueDiffView(e){var n;let{check:r}=e,o=null===(n=r.last_run)||void 0===n?void 0:n.result,l=r.params,a=null;if(o){let e=o.data.schema.fields.map(e=>({name:e.name,key:e.name}));a={columns:e,data:o.data.data,summary:o.summary,params:l,errors:o.errors}}return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(i.xu,{p:5,children:a&&(0,t.jsx)(ValueDiffPanel,{valueDiffSummary:a})})})}var eN=r(32865);async function createSimpleCheck(){let e=await Q.post("/api/checks",{type:"simple"}),n=e.data;return n}async function createCheckByNodeSchema(e){let n=await Q.post("/api/checks",{type:"schema_diff",params:{node_id:e}}),r=n.data;return r}async function createCheckByRowCounts(e){let n=await Q.post("/api/checks",{type:"row_count_diff",params:{node_ids:e}}),r=n.data;return r}async function createCheckByRun(e){let n=await Q.post("/api/checks",{run_id:e}),r=n.data;return r}async function listChecks(){let e=await Q.get("/api/checks");return e.data}async function getCheck(e){let n=await Q.get("/api/checks/".concat(e));return n.data}async function updateCheck(e,n){let r=await Q.patch("/api/checks/".concat(e),n);return r.data}async function deleteCheck(e){let n=await Q.delete("/api/checks/".concat(e));return n.data}function extractColumnNames(e){function getNames(e){return e&&e.columns?Object.values(e.columns).map(e=>e.name):[]}let n=getNames(e.data.base),r=getNames(e.data.current),t=[];return n.forEach(e=>{t.includes(e)||t.push(e)}),r.forEach(e=>{t.includes(e)||t.push(e)}),t}async function fetchColumnValuesComparison(e,n){try{let r=await Q.post("/api/runs",{type:"value_diff",params:{model:e,primary_key:n}});return r.data}catch(e){console.error("Error fetching column values comparison:",e)}}async function handleAddToCheck(e){if(!e.runId)return null;let n=await createCheckByRun(e.runId);return n.check_id}var MismatchSummary=function(){let{isOpen:e,onOpen:n,onClose:r}=(0,c.q)(),[o,i]=(0,w.useState)(!1),[l,a]=(0,w.useState)(null);return{MismatchSummaryModal:s=>{let{node:c}=s,d="model"===c.resourceType||"seed"===c.resourceType||"source"===c.resourceType,u=extractColumnNames(c),[h,x]=(0,w.useState)(""),[,f]=(0,eN.TH)(),handleExecute=async()=>{if(!o&&""!==h){i(!0);try{let e=await fetchColumnValuesComparison(c.name,h),n=e.result,r=n.data.schema.fields.map(e=>({name:e.name,key:e.name}));a({columns:r,data:n.data.data,summary:n.summary,params:{model:c.name,primary_key:h},runId:e.run_id,errors:n.errors})}catch(e){console.error("Error fetching column values comparison:",e)}finally{i(!1)}}};return((0,w.useEffect)(()=>{var e;(null==l?void 0:null===(e=l.params)||void 0===e?void 0:e.model)!=c.name&&a(null)},[c.name]),d)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.u_,{isOpen:e,onClose:r,size:"6xl",children:[(0,t.jsx)(p.Z,{}),(0,t.jsxs)(y.h,{overflowY:"auto",height:"75%",children:[(0,t.jsx)($.x,{children:"Value Diff Summary"}),(0,t.jsx)(j.o,{}),(0,t.jsx)(v.f,{children:o?(0,t.jsx)(ep.E,{size:"xs",isIndeterminate:!0}):l?(0,t.jsx)(ValueDiffPanel,{valueDiffSummary:l}):(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(ey.NI,{children:[(0,t.jsx)(ej.l,{children:"Pick a primary key"}),(0,t.jsx)(ev.P,{placeholder:"Select primary key",value:h,onChange:e=>x(e.target.value),children:u.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]})})}),(0,t.jsxs)(eC.m,{children:[l&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.z,{mr:3,colorScheme:"blue",onClick:()=>{a(null)},children:"Clear"}),(0,t.jsx)(m.z,{mr:3,colorScheme:"blue",onClick:async()=>{let e=await handleAddToCheck(l);e&&f("/checks/".concat(e))},children:"Add to check"})]}),(0,t.jsx)(m.z,{colorScheme:"blue",onClick:handleExecute,children:"Execute"})]})]})]}),(0,t.jsx)(m.z,{colorScheme:"blue",size:"sm",onClick:n,children:"Value Diff Summary"})]}):(0,t.jsx)(t.Fragment,{})}}},eT=r(35537),eF=r(70556);async function submitRun(e,n,r){let t=await Q.post("/api/runs",{type:e,params:n,nowait:null==r?void 0:r.nowait}),o=t.data;return o}async function waitRun(e){let n=await Q.get("/api/runs/".concat(e,"/wait")),r=n.data;return r}async function cancelRun(e){return await Q.post("/api/runs/".concat(e,"/cancel"))}async function submitProfileDiff(e,n){return await submitRun("profile_diff",e,n)}var eR=r(41751),eq=r(83978),eL=r.n(eq);function _getPrimaryKeyValue(e,n){let r={};return r[n]=e[n],JSON.stringify(r)}function toDataDiffGrid(e,n){let r="column_name",t={schema:{fields:[],primaryKey:[]},data:[]};if(!e&&n)e=t;else if(!n&&e)n=t;else if(!e||!n)return{rows:[],columns:[]};let o=[],i={},l={};n.schema.fields.forEach(e=>{i[e.name]={},i[e.name].current=e}),e.schema.fields.forEach(e=>{i[e.name]||(i[e.name]={}),i[e.name].base=e}),Object.keys(i).forEach(e=>{if("index"===e||e===r||"profiled_at"===e)return;let cellClass=n=>{if(!eL().isEqual(n["base__".concat(e)],n["current__".concat(e)]))return"diff-cell"};o.push({name:e,children:[{key:"base__".concat(e),name:"Base",renderEditCell:ec.Ug,cellClass},{key:"current__".concat(e),name:"Current",renderEditCell:ec.Ug,cellClass}]})}),n.data.forEach(e=>{let n=_getPrimaryKeyValue(e,r);l[n]={},l[n].current=e}),e.data.forEach(e=>{let n=_getPrimaryKeyValue(e,r);l[n]||(l[n]={}),l[n].base=e});let a=Object.entries(l).map(e=>{let[n,{base:t,current:o}]=e,i=JSON.parse(n);return t&&Object.keys(t).forEach(e=>{e!==r&&(i["base__".concat(e)]="boolean"==typeof t[e]?t[e].toString():t[e])}),o&&Object.keys(o).forEach(e=>{e!==r&&(i["current__".concat(e)]="boolean"==typeof o[e]?o[e].toString():o[e])}),i});return{columns:[{key:r,name:r,frozen:!0},...o],rows:a}}let ProfileDiffDataGrid=e=>{let{isFetching:n,result:r,error:o,onCancel:i,enableScreenshot:l}=e,[a,s]=(0,w.useState)(!1),c=(0,w.useMemo)(()=>n?{rows:[],columns:[]}:toDataDiffGrid(null==r?void 0:r.base,null==r?void 0:r.current),[r,n]);if(n)return(0,t.jsx)(u.M,{p:"16px",height:"100%",children:(0,t.jsxs)(h.g,{children:[(0,t.jsx)(d.$,{size:"sm",mr:"8px"}),a?(0,t.jsx)(t.Fragment,{children:"Aborting..."}):(0,t.jsx)(t.Fragment,{children:"Loading..."}),!a&&i&&(0,t.jsx)(m.z,{onClick:()=>{s(!0),i&&i()},colorScheme:"blue",size:"sm",children:"Cancel"})]})});if((null==r?void 0:r.base_error)||(null==r?void 0:r.current_error)){if((null==r?void 0:r.base_error)===(null==r?void 0:r.current_error))return(0,t.jsxs)(ea.b,{status:"error",children:[(0,t.jsx)(es.z,{}),"Error: ",null==r?void 0:r.current_error]});{let renderAlert=(e,n)=>(0,t.jsxs)(ea.b,{status:"error",children:[(0,t.jsx)(es.z,{}),e," Environment Error: ",n]});return(0,t.jsxs)(eR.K,{spacing:3,children:[(null==r?void 0:r.base_error)&&renderAlert("Base",r.base_error),(null==r?void 0:r.current_error)&&renderAlert("Current",r.current_error)]})}}return o?(0,t.jsxs)(ea.b,{status:"error",children:[(0,t.jsx)(es.z,{}),"Error: ",null==o?void 0:o.message]}):0===c.columns.length?(0,t.jsx)(u.M,{height:"100%",children:"No data"}):(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:c.columns,rows:c.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:l})})},ProfileDiffModal=e=>{let{node:n}=e,r=(0,eT.NL)(),{isOpen:o,onOpen:i,onClose:l}=(0,c.q)(),[,a]=(0,eN.TH)(),[s,d]=(0,w.useState)(),profileDiffFn=async e=>{let{run_id:n}=await submitProfileDiff({model:e},{nowait:!0});return d(n),await waitRun(n)},{data:u,mutate:h,error:x,isPending:f}=(0,eF.D)({mutationFn:profileDiffFn}),C=(0,w.useCallback)(async()=>{if(s)return await cancelRun(s)},[s]),b=(0,w.useCallback)(async()=>{if(!(null==u?void 0:u.run_id))return;let e=await createCheckByRun(u.run_id);r.invalidateQueries({queryKey:U.checks()}),a("/checks/".concat(e.check_id))},[null==u?void 0:u.run_id,a,r]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.u_,{isOpen:o,onClose:l,size:"6xl",children:[(0,t.jsx)(p.Z,{}),(0,t.jsxs)(y.h,{overflowY:"auto",height:"75%",children:[(0,t.jsx)($.x,{children:"Model Profile Diff"}),(0,t.jsx)(j.o,{}),(0,t.jsx)(v.f,{children:(0,t.jsx)(ProfileDiffDataGrid,{isFetching:f,result:null==u?void 0:u.result,error:x,onCancel:C})}),(0,t.jsx)(eC.m,{children:(0,t.jsx)(m.z,{mr:3,colorScheme:"blue",onClick:b,isDisabled:(()=>{let e=null==u?void 0:u.result;return!!x||!e||!!e.base_error||!!e.current_error})(),children:"Add to check"})})]})]}),(0,t.jsx)(m.z,{colorScheme:"blue",size:"sm",onClick:()=>{i(),h(n.name)},children:"Profile Diff"})]})};function NodeView(e){let{node:n,onCloseNode:r}=e,[,o]=(0,eN.TH)(),{setSqlQuery:l}=useRecceQueryContext(),s="model"===n.resourceType||"seed"===n.resourceType||"source"===n.resourceType,{isOpen:d,onOpen:u,onClose:h}=(0,c.q)(),{MismatchSummaryModal:f}=MismatchSummary(),S=(0,w.useCallback)(async()=>{let e=n.id,r=await createCheckByNodeSchema(e);o("/checks/".concat(r.check_id))},[n,o]),_=(0,w.useCallback)(async()=>{let e=n.id,r=await createCheckByRowCounts([e]);o("/checks/".concat(r.check_id))},[n,o]);return(0,t.jsxs)(Z.r,{height:"100%",templateRows:"auto auto 1fr",children:[(0,t.jsxs)(x.U,{children:[(0,t.jsx)(i.xu,{flex:"0 1 20%",p:"16px",children:(0,t.jsx)(Y.X,{size:"sm",children:n.name})}),(0,t.jsx)(N.L,{}),"modified"===n.changeStatus&&(0,t.jsxs)(i.xu,{children:[(0,t.jsx)(m.z,{onClick:u,leftIcon:(0,t.jsx)(F.tvD,{}),colorScheme:"orange",variant:"solid",children:"Diff"}),(0,t.jsxs)(g.u_,{isOpen:d,onClose:h,size:"6xl",children:[(0,t.jsx)(p.Z,{}),(0,t.jsxs)(y.h,{overflowY:"auto",height:"75%",children:[(0,t.jsx)($.x,{children:"Model Raw Code Diff"}),(0,t.jsx)(j.o,{}),(0,t.jsx)(v.f,{children:(0,t.jsx)(SqlDiffView,{base:n.data.base,current:n.data.current})})]})]})]}),(0,t.jsx)(i.xu,{flex:"0 1 1%",p:"16px",children:(0,t.jsx)(ee.P,{onClick:r})})]}),(0,t.jsx)(i.xu,{color:"gray",paddingLeft:"16px",children:(0,t.jsxs)(x.U,{spacing:"8px",children:[(0,t.jsx)(ResourceTypeTag,{node:n}),"model"===n.resourceType&&(0,t.jsx)(RowCountTag,{node:n})]})}),s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(en.m,{overflow:"auto",as:a.k,children:[(0,t.jsx)(er.t,{children:(0,t.jsx)(et.O,{children:"Columns"})}),(0,t.jsx)(eo.n,{overflow:"auto",height:"calc(100% - 42px)",children:(0,t.jsx)(ei.x,{p:0,overflowY:"auto",height:"100%",children:(0,t.jsx)(SchemaView,{base:n.data.base,current:n.data.current})})})]}),(0,t.jsxs)(x.U,{p:"16px",children:[(0,t.jsxs)(C.v,{children:[(0,t.jsx)(el.j,{as:m.z,size:"sm",colorScheme:"blue",children:"Add check"}),(0,t.jsxs)(b.q,{children:[(0,t.jsx)(k.s,{onClick:S,children:"Schema Check"}),(0,t.jsx)(k.s,{onClick:_,children:"Row Count Check"})]})]}),(0,t.jsx)(N.L,{}),"model"===n.resourceType&&(0,t.jsxs)(t.Fragment,{children:["added"!==n.changeStatus&&"removed"!==n.changeStatus&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ProfileDiffModal,{node:n}),(0,t.jsx)(f,{node:n})]}),(0,t.jsx)(m.z,{colorScheme:"blue",size:"sm",onClick:()=>{l('select * from {{ ref("'.concat(n.name,'") }}')),o("/query")},children:"Query"})]})]})]})]})}var eO=r(43898),eI=r(99691);async function getLineage(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=await Q.get("/api/lineage?base=".concat(e));return n.data}async function getLineageWithError(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let n=await getLineage(e);return{data:n}}catch(e){if(!(e instanceof eI.d7))return{error:null==e?void 0:e.message};{var n,r;let t=null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:n.detail;if(t)return{error:t};return{error:null==e?void 0:e.message}}}}async function getLineageDiff(){let[e,n]=await Promise.all([getLineageWithError(!0),getLineageWithError(!1)]);return{base:e.data,current:n.data,base_error:e.error,current_error:n.error}}var eM=r(21123),eK=r.n(eM);let eA=(0,w.createContext)({});function LineageWatcher(e){let{refetch:n}=e,r=(0,eu.p)(),[o,i]=(0,w.useState)(),l=(0,eT.NL)();return(0,w.useEffect)(()=>{function httpUrlToWebSocketUrl(e){return e.replace(/(http)(s)?\:\/\//,"ws$2://")}let e=new WebSocket("".concat(httpUrlToWebSocketUrl(V),"/api/ws"));return i(e),e.onopen=()=>{e.send("ping")},e.onmessage=e=>{if("pong"!==e.data)try{let n=JSON.parse(e.data);if("refresh"===n.command){let{eventType:e,srcPath:t}=n.event,[o,i]=t.split("/").slice(-2),a=eK().parse(i).name;r({description:"Detected ".concat(o," ").concat(a," ").concat(e),status:"info",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0}),l.invalidateQueries({queryKey:U.lineage()})}}catch(e){console.error(e)}},()=>{e&&e.close()}},[r,l]),(0,t.jsx)(t.Fragment,{})}function LineageGraphsContextProvider(e){let{children:n}=e,{data:r,isLoading:o,error:i,refetch:l}=(0,J.a)({queryKey:U.lineage(),queryFn:getLineageDiff}),a=(0,w.useMemo)(()=>{if(r)return buildDefaultLineageGraphSets(r.base,r.current)},[r]),s=(null==i?void 0:i.message)||(null==r?void 0:r.current_error)||(null==r?void 0:r.base_error);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(LineageWatcher,{refetch:l}),(0,t.jsx)(eA.Provider,{value:{lineageGraphSets:a,error:s,isLoading:o},children:n})]})}let useLineageGraphsContext=()=>(0,w.useContext)(eA);var eP=r(17180);let eB={added:["Model Added","Added resource"],removed:["Model Removed","Removed resource"],modified:["Model Modified","Modified resource"],col_added:["Column Added","Added column"],col_removed:["Column Removed","Removed column"],col_changed:["Column Modified","Modified column"],folder_changed:["Modified","Modified folder"]};function ChangeSummary_getIconForChangeStatus(e){if("added"===e)return{color:"#1dce00",icon:q};if("removed"===e)return{color:"#ff067e",icon:L};if("modified"===e)return{color:"#ffa502",icon:O};if("col_added"===e)return{color:"#1dce00",icon:q};if("col_removed"===e)return{color:"#ff067e",icon:L};if("col_changed"===e)return{color:"#ffa502",icon:O};if("folder_changed"===e)return{color:"#ffa502",icon:IconChanged};return{color:"inherit",icon:void 0}}function SummaryText(e){let{name:n,value:r,tip:o}=e;return(0,t.jsxs)(h.g,{alignItems:"stretch",children:[(0,t.jsxs)(f.x,{fontSize:"sm",color:"gray",children:[n,o&&(0,t.jsx)(l.u,{label:o,children:(0,t.jsx)(i.xu,{display:"inline-block",children:(0,t.jsx)(s.J,{mx:"2px",as:A.H33,boxSize:3})})})]}),r]})}function ChangeStatusCountLabel(e){let{changeStatus:n,value:r}=e,[o]=n?eB[n]:[""],{icon:i,color:l}=ChangeSummary_getIconForChangeStatus(n);return(0,t.jsxs)(h.g,{alignItems:"stretch",children:[(0,t.jsxs)(a.k,{alignItems:"center",fontSize:"sm",color:"gray",children:[(0,t.jsx)(s.J,{mr:"5px",as:i,color:l}),o]}),(0,t.jsx)(f.x,{fontSize:"sm",children:r})]})}function calculateColumnChange(e,n){let r=0,t=0,o=0;return(e||n)&&(n&&Object.keys(n.columns||{}).forEach(n=>{(!e||!e.columns||!e.columns[n])&&r++}),e&&Object.keys(e.columns||{}).forEach(e=>{(!n||!n.columns||!n.columns[e])&&t++}),n&&e&&Object.keys(n.columns||{}).forEach(r=>{e.columns&&n.columns&&e.columns[r]&&e.columns[r].type!==n.columns[r].type&&o++})),{adds:r,removes:t,modifies:o}}function calculateChangeSummary(e,n){let r=0,t=0,o=0,i=0,l=0,a=0;return n.forEach(n=>{"added"===e.nodes[n].changeStatus?r++:"removed"===e.nodes[n].changeStatus?t++:"modified"===e.nodes[n].changeStatus&&o++;let s=e.nodes[n].data.base,c=e.nodes[n].data.current,d=calculateColumnChange(s,c);i+=d.adds,l+=d.removes,a+=d.modifies}),{adds:r,removes:t,modifies:o,col_added:i,col_removed:l,col_changed:a}}function ChangeSummary(e){let{lineageGraphSets:n}=e,{adds:r,removes:o,modifies:l,col_added:a,col_removed:s,col_changed:c}=calculateChangeSummary(n.all,n.modifiedSet);return(0,t.jsxs)(Z.r,{templateColumns:"1fr 1fr",mb:"10px",borderTop:"1px solid lightgray",padding:"2.5vw",children:[(0,t.jsx)(i.xu,{borderColor:"lightgray",children:(0,t.jsx)(SummaryText,{name:"Code Changes",value:(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(Z.r,{templateColumns:"1fr 1fr 1fr",width:"100%",children:[(0,t.jsx)(ChangeStatusCountLabel,{changeStatus:"added",value:r}),(0,t.jsx)(ChangeStatusCountLabel,{changeStatus:"removed",value:o}),(0,t.jsx)(ChangeStatusCountLabel,{changeStatus:"modified",value:l})]})})})}),(0,t.jsx)(i.xu,{borderLeft:"1px",paddingLeft:"12px",borderColor:"lightgray",children:(0,t.jsx)(SummaryText,{name:"Column Changes",value:(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(Z.r,{templateColumns:"1fr 1fr 1fr",width:"100%",children:[(0,t.jsx)(ChangeStatusCountLabel,{changeStatus:"col_added",value:a}),(0,t.jsx)(ChangeStatusCountLabel,{changeStatus:"col_removed",value:s}),(0,t.jsx)(ChangeStatusCountLabel,{changeStatus:"col_changed",value:c})]})})})})]})}var eG=r(76353),eV=r(53248),eW=r(9763),eQ=r(95853);function SchemaDiffCard(e){let{node:n,...r}=e;return(0,t.jsxs)(eG.Z,{maxWidth:"500px",children:[(0,t.jsxs)(eV.O,{children:[(0,t.jsx)(Y.X,{fontSize:18,children:r.title}),(0,t.jsxs)(x.U,{spacing:"8px",p:"16px",children:[(0,t.jsx)(ResourceTypeTag,{node:n}),"model"===n.resourceType&&(0,t.jsx)(RowCountTag,{node:n,isAutoFetching:!0})]})]}),(0,t.jsx)(eW.e,{children:(0,t.jsx)(a.k,{children:(0,t.jsx)(SchemaView,{base:n.data.base,current:n.data.current})})})]})}function listChangedNodes(e){let n=[],r=e.all.nodes;return e.modifiedSet.forEach(e=>{var t,o;let i=r[e],l=mergeKeysWithStatus(Object.keys((null===(t=i.data.base)||void 0===t?void 0:t.columns)||{}),Object.keys((null===(o=i.data.current)||void 0===o?void 0:o.columns)||{})),a=!Object.values(l).every(e=>void 0===e);a&&i.data.base&&i.data.current&&n.push(i)}),n}function SchemaSummary(e){let{lineageGraphSets:n}=e,[r,o]=(0,w.useState)([]);return(0,w.useEffect)(()=>{o(listChangedNodes(n))},[n]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",marginTop:"20px",children:(0,t.jsx)(Y.X,{fontSize:24,children:"Schema Summary"})}),(0,t.jsx)(a.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",children:0===r.length?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(f.x,{fontSize:18,color:"gray",children:"No schema changes detected."})}):(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(eQ.M,{minChildWidth:"400px",spacing:"2vw",padding:"2.5vw",width:"100%",backgroundColor:"lightgray",children:r.map(e=>(0,t.jsx)(SchemaDiffCard,{title:e.name,node:e},e.id))})})})]})}function SummaryView(){let{lineageGraphSets:e}=useLineageGraphsContext();return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(a.k,{direction:"column",w:"100%",minHeight:"650px",children:[(0,t.jsx)(a.k,{w:"100%",paddingBottom:"10px",marginBottom:"20px",children:(0,t.jsx)(Y.X,{fontSize:24,children:"Change Summary"})}),e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ChangeSummary,{lineageGraphSets:e}),(0,t.jsx)(eP.i,{}),(0,t.jsx)(SchemaSummary,{lineageGraphSets:e})]})]})})}var eH=r(45438),eU=r(40312),eJ=r(52246),eX=r(25807);function AddSchemaChangesCheckButton(e){let{nodes:n,onFinish:r}=e,[,o]=(0,eN.TH)();return(0,t.jsxs)(m.z,{size:"xs",variant:"outline",isDisabled:0===n.length,onClick:async()=>{let e;1===n.length?e=await createCheckByNodeSchema(n[0].id):await Promise.all(n.map(async e=>{await createCheckByNodeSchema(e.id)})),r(),e?o("/checks/".concat(e.check_id)):o("/checks")},children:[(0,t.jsx)(s.J,{as:P.Edg}),"Add schema check"]})}function AddRowCountCheckButton(e){let{nodes:n,onFinish:r}=e,[,o]=(0,eN.TH)();return(0,t.jsxs)(m.z,{size:"xs",variant:"outline",isDisabled:0===n.length,onClick:async()=>{let e=await createCheckByRowCounts(n.map(e=>e.id));r(),e?o("/checks/".concat(e.check_id)):o("/checks")},children:[(0,t.jsx)(s.J,{as:A.SwK}),"Add row count check"]})}function NodeSelector(e){let{nodes:n,isOpen:r,onClose:o}=e;function countSelectedNodes(e){return e.filter(e=>e.isSelected).length}let l=n.filter(e=>e.isSelected);return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(eU.R,{in:r,style:{zIndex:10},children:(0,t.jsx)(i.xu,{bg:"white",rounded:"md",shadow:"dark-lg",children:(0,t.jsxs)(x.U,{p:"5px 15px",mt:"4",divider:(0,t.jsx)(eJ.c,{borderColor:"gray.200"}),spacing:4,children:[(0,t.jsxs)(eX.h,{size:"xs",isAttached:!0,variant:"outline",rounded:"xs",onClick:o,children:[(0,t.jsxs)(m.z,{children:[countSelectedNodes(n)," selected"]}),(0,t.jsx)(K.h,{"aria-label":"Exit select Mode",icon:(0,t.jsx)(eH.D,{})})]}),(0,t.jsxs)(x.U,{children:[(0,t.jsx)(FetchRowCountsButton,{nodes:l.length>0?l:[],onFinish:o}),(0,t.jsx)(AddSchemaChangesCheckButton,{nodes:l.length>0?l:[],onFinish:o}),(0,t.jsx)(AddRowCountCheckButton,{nodes:l.length>0?l:[],onFinish:o})]})]})})})})}let layout=function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR",t=new(z()).graphlib.Graph;t.setDefaultEdgeLabel(()=>({})),t.setGraph({rankdir:r}),e.forEach(e=>{t.setNode(e.id,{width:300,height:36})}),n.forEach(e=>{t.setEdge(e.source,e.target)}),z().layout(t),e.forEach(e=>{let n=t.node(e.id);return e.position={x:n.x-150,y:n.y-18},e})},eZ={customNode:GraphNode},eY={customEdge:GraphEdge},nodeColor=e=>{var n,r;return(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.changeStatus)?getIconForChangeStatus(null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.changeStatus).color:"lightgray"},e$={all:"All",changed_models:"Changed Models"};function ChangeStatusLegend(){return(0,t.jsx)(i.xu,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[n,[r,o]]=e,{icon:i,color:c}=getIconForChangeStatus(n);return(0,t.jsx)(l.u,{label:o,children:(0,t.jsxs)(a.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,t.jsx)(s.J,{color:c,as:i})," ",r]})},n)})})}function _LineageView(){let[e,n,r]=(0,o.Rr)([]),[l,D,z]=(0,o.ll)([]),[N,T]=(0,w.useState)(),[F,R]=(0,w.useState)(),{lineageGraphSets:q,isLoading:L,error:O}=useLineageGraphsContext(),{isOpen:I,onOpen:M,onClose:K}=(0,c.q)(),[P,B]=(0,w.useState)("detail"),[G,V]=(0,w.useState)(),[W,Q]=(0,w.useState)("changed_models"),[H,U]=(0,w.useState)(!1),[J,Z]=(0,w.useState)({x:0,y:0});if((0,w.useEffect)(()=>{if(!q)return;let e="changed_models"===W?q.changed:q.all,r=q.modifiedSet,[t,o]=toReactflow(e,q.modifiedSet);layout(t,o),T(e),R(r),n(t),D(o)},[n,D,W,q]),L)return(0,t.jsx)(a.k,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:(0,t.jsx)(d.$,{size:"xl"})});let closeContextMenu=()=>{U(!1),Z({x:0,y:0})};return O?(0,t.jsxs)(t.Fragment,{children:["Fail to load lineage data: ",O]}):"changed_models"===W&&(void 0===F||(null==F?void 0:F.length)===0)?(0,t.jsx)(u.M,{h:"100%",children:(0,t.jsxs)(h.g,{children:[(0,t.jsx)(t.Fragment,{children:"No change detected"}),(0,t.jsx)(m.z,{colorScheme:"blue",onClick:()=>{Q("all")},children:"Show all nodes"})]})}):(0,t.jsxs)(a.k,{width:"100%",height:"100%",children:[(0,t.jsx)(i.xu,{flex:"1 0 0px",children:(0,t.jsxs)(o.x$,{nodeTypes:eZ,edgeTypes:eY,nodes:e,edges:l,onNodesChange:r,onEdgesChange:z,onNodeClick:(r,t)=>{if(closeContextMenu(),"action"===P){let r=selectNode(t.id,e);n(r)}else V(t.id)},onNodeMouseEnter:(r,t)=>{if(N&&void 0!==F){let[r,o]=highlightPath(N,F,e,l,t.id);n(r),D(o)}},onNodeMouseLeave:(r,t)=>{if(N&&void 0!==F){let[r,t]=highlightPath(N,F,e,l,null);n(r),D(t)}},onNodeContextMenu:(e,n)=>{"action"===P&&(e.preventDefault(),Z({x:e.clientX,y:e.clientY,selectedNode:n}),U(!0))},onClick:closeContextMenu,maxZoom:1,minZoom:.1,fitView:!0,children:[(0,t.jsx)(S.A,{color:"#ccc"}),(0,t.jsxs)(_.Z,{showInteractive:!1,position:"top-right",children:[(0,t.jsx)(_.B,{title:"switch mode",onClick:()=>{Q("all"===W?"changed_models":"all");let r=cleanUpSelectedNodes(e);n(r)},children:(0,t.jsx)(s.J,{as:A.Bw1})}),(0,t.jsx)(_.B,{title:"download image",onClick:()=>{let e=document.querySelector(".react-flow__viewport");(null==e?void 0:e.parentElement)&&(0,eO.YM)(null==e?void 0:e.parentElement,{backgroundColor:"#ffffff00",width:null==e?void 0:e.parentElement.clientWidth,height:null==e?void 0:e.parentElement.clientHeight,style:{width:"".concat(null==e?void 0:e.parentElement.clientWidth),height:"".concat(null==e?void 0:e.parentElement.clientHeight)}}).then(e=>{let n=document.createElement("a");n.setAttribute("download","recce-lineage.png"),n.setAttribute("target","_blank"),n.setAttribute("href",e),n.click()})},children:(0,t.jsx)(s.J,{as:A.wzc})}),(0,t.jsx)(_.B,{title:"summary",onClick:M,children:(0,t.jsx)(s.J,{as:A.SnF})})]}),(0,t.jsx)(o.s_,{position:"bottom-left",children:(0,t.jsxs)(x.U,{children:[(0,t.jsx)(ChangeStatusLegend,{}),(0,t.jsxs)(i.xu,{p:2,flex:"0 1 160px",fontSize:"14px",children:[(0,t.jsx)(f.x,{color:"gray",mb:"2px",children:"Actions"}),(0,t.jsx)(h.g,{spacing:1,align:"baseline",children:(0,t.jsx)(m.z,{size:"xs",variant:"outline",isDisabled:"action"===P,onClick:()=>{let r=cleanUpSelectedNodes(e);n(r),B("detail"===P?"action":"detail")},children:"Select Models"})})]})]})}),(0,t.jsx)(o.s_,{position:"top-left",children:(0,t.jsx)(f.x,{fontSize:"xl",color:"grey",opacity:.5,children:e$[W]})}),(0,t.jsx)(o.s_,{position:"bottom-center",children:(0,t.jsx)(NodeSelector,{nodes:e.map(e=>e.data),isOpen:"action"===P,onClose:()=>{B("detail");let r=cleanUpSelectedNodes(e);n(r)}})}),(0,t.jsx)(E.a,{nodeColor:nodeColor,nodeStrokeWidth:3})]})}),(0,t.jsxs)(g.u_,{isOpen:I,onClose:K,size:"6xl",children:[(0,t.jsx)(p.Z,{}),(0,t.jsxs)(y.h,{overflowY:"auto",height:"80%",children:[(0,t.jsx)(j.o,{}),(0,t.jsx)(v.f,{children:(0,t.jsx)(SummaryView,{})})]})]}),"detail"===P&&G&&(null==N?void 0:N.nodes[G])&&(0,t.jsx)(i.xu,{flex:"0 0 500px",borderLeft:"solid 1px lightgray",height:"100%",children:(0,t.jsx)(NodeView,{node:null==N?void 0:N.nodes[G],onCloseNode:()=>{V(void 0)}})}),H&&(0,t.jsx)(C.v,{isOpen:!0,onClose:closeContextMenu,children:(0,t.jsxs)(b.q,{style:{position:"absolute",left:"".concat(J.x,"px"),top:"".concat(J.y,"px")},children:[(0,t.jsx)(k.s,{icon:(0,t.jsx)(X.Cv2,{}),onClick:()=>{let r=J.selectedNode;if("action"!==P||void 0===r||void 0===N)return;let t=r.id,o=selectUpstream(N,[t]),i=selectNodes([...o],e);n(i)},children:"Select parent nodes"}),(0,t.jsx)(k.s,{icon:(0,t.jsx)(X.IMj,{}),onClick:()=>{let r=J.selectedNode;if("action"!==P||void 0===r||void 0===N)return;let t=r.id,o=selectDownstream(N,[t]),i=selectNodes([...o],e);n(i)},children:"Select child nodes"})]})})]})}function LineageView(){return(0,t.jsx)(o.tV,{children:(0,t.jsx)(_LineageView,{})})}var e0=r(12844),e1=r(98786);function RecceContextProvider(e){let{children:n}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(RecceQueryContextProvider,{children:(0,t.jsx)(LineageGraphsContextProvider,{children:n})})})}function useVersionNumber(){let[e,n]=(0,w.useState)("");return(0,w.useEffect)(()=>{(async function(){try{let e=await Q.get("/api/version");n(e.data)}catch(e){console.error("Error fetching version number:",e)}})()},[]),e}var e2=r(51348),e5=r(44525),e3=r(234),e6=r(96094),e8=r(25535),e4=r(36334);function CheckBreadcrumb(e){let{name:n,setName:r}=e,[o,l]=(0,w.useState)(!1),[a,s]=(0,w.useState)(n),c=(0,w.useRef)(null),d=(0,w.useCallback)(()=>{r(a),l(!1)},[r,l,a]);return(0,w.useEffect)(()=>{let handleClickOutside=e=>{c.current&&!c.current.contains(e.target)&&d()};return o&&document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}},[o,c,d]),(0,t.jsxs)(e3.a,{flex:"0 1",fontSize:"12pt",fontWeight:"500",separator:(0,t.jsx)(e4.X,{color:"gray.500"}),children:[(0,t.jsx)(e6.g,{children:(0,t.jsx)(i.xu,{children:"Checklist"})}),(0,t.jsx)(e6.g,{flex:"0 1",cursor:"pointer",children:o?(0,t.jsx)(e8.I,{ref:c,value:a,onChange:e=>{s(e.target.value)},onKeyDown:e=>{"Enter"===e.key?(r(a),l(!1)):"Escape"===e.key&&(s(n),l(!1))},size:"sm",w:"auto",minW:"200px",maxW:"600px"}):(0,t.jsx)(i.xu,{onClick:()=>{s(n),l(!0)},textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n})})]})}var query_SqlEditor=e=>{let{value:n,onChange:r,onRun:o,onRunDiff:i,options:l={},...a}=e;return(0,t.jsx)(eg.ZP,{language:"sql",theme:"vs",value:n,onChange:e=>{void 0!==e&&r&&r(e)},onMount:(e,n)=>{o&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.Enter,o),i&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.Enter,i)},options:{tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent",...l}})};function querydiff_getPrimaryKeyValue(e,n){let r={};for(let t of n)r[t]=e[t];return JSON.stringify(r)}function DataFrameColumnGroupHeader(e){let{name:n,primaryKeys:r,onPrimaryKeyChange:o}=e;return"index"===n?(0,t.jsx)(t.Fragment,{}):r.includes(n)?(0,t.jsxs)(a.k,{alignItems:"center",children:[(0,t.jsx)(i.xu,{flex:1,children:n}),o&&(0,t.jsx)(s.J,{cursor:"pointer",as:T.ven,onClick:()=>{let e=r.filter(e=>e!==n);o(e)}})]}):(0,t.jsxs)(a.k,{alignItems:"center",children:[(0,t.jsx)(i.xu,{flex:1,children:n}),o&&(0,t.jsx)(s.J,{cursor:"pointer",as:T.MhP,onClick:()=>{let e=[...r.filter(e=>"index"!==e),n];o(e)}})]})}function querydiff_toDataDiffGrid(e,n,r){let o=(null==r?void 0:r.primaryKeys)||[],i=(null==r?void 0:r.changedOnly)||!1,l={schema:{fields:[],primaryKey:[]},data:[]};if(!e&&n)e=l,0===o.length&&(o=n.schema.primaryKey);else if(!n&&e)n=l,0===o.length&&(o=e.schema.primaryKey);else{if(!e||!n)return{rows:[],columns:[]};if(!eL().isEqual(e.schema.primaryKey,n.schema.primaryKey))throw Error("primary key mismatch! ".concat(e.schema.primaryKey," != ").concat(n.schema.primaryKey));0===o.length&&(o=e.schema.primaryKey)}let a=[],s=[],c=mergeKeysWithStatus(e.schema.fields.map(e=>e.name),n.schema.fields.map(e=>e.name)),d={};e.data.forEach(e=>{d[querydiff_getPrimaryKeyValue(e,o)]=e});let u={};n.data.forEach(e=>{u[querydiff_getPrimaryKeyValue(e,o)]=e});let h=mergeKeysWithStatus(Object.keys(d),Object.keys(u)),m=Object.entries(h).map(e=>{let[n,r]=e,t=d[n],i=u[n],l=JSON.parse(n);if(t&&Object.keys(t).forEach(e=>{o.includes(e)||(l["base__".concat(e)]=t[e])}),i&&Object.keys(i).forEach(e=>{o.includes(e)||(l["current__".concat(e)]=i[e])}),t){if(i)for(let[e,n]of Object.entries(c))!("index"===e||o.includes(e))&&"added"!==n&&"removed"!==n&&(eL().isEqual(t[e],i[e])||(l.status="modified",c[e]="modified"));else l.status="removed"}else l.status="added";return l});return i&&(m=m.filter(e=>"added"===e.status||"removed"===e.status||"modified"===e.status)),Object.entries(c).forEach(e=>{let[n,l]=e;if(o.includes(n))s.push({key:"".concat(n),name:(0,t.jsx)(DataFrameColumnGroupHeader,{name:n,primaryKeys:o,onPrimaryKeyChange:null==r?void 0:r.onPrimaryKeyChange}),frozen:!0,cellClass:e=>"index"===n?"index-column":e.status?"diff-header-".concat(e.status):void 0});else{if("index"===n||i&&"added"!==l&&"removed"!==l&&"modified"!==l)return;let e="added"===l?"diff-header-added":"removed"===l?"diff-header-removed":void 0,cellClass=e=>{let r=e.status;if("removed"===r)return"diff-cell-removed";if("added"===r)return"diff-cell-added";if("added"===l);else if("removed"===l);else if(!eL().isEqual(e["base__".concat(n)],e["current__".concat(n)]))return"diff-cell-modified"};a.push({headerCellClass:e,name:(0,t.jsx)(DataFrameColumnGroupHeader,{name:n,primaryKeys:o,onPrimaryKeyChange:"added"!==l&&"removed"!==l?null==r?void 0:r.onPrimaryKeyChange:void 0}),children:[{key:"base__".concat(n),name:"Base",renderEditCell:ec.Ug,headerCellClass:e,cellClass},{key:"current__".concat(n),name:"Current",renderEditCell:ec.Ug,headerCellClass:e,cellClass}]})}}),{columns:[...s,...a],rows:m}}r(7866);let QueryDiffDataGrid=e=>{var n,r,o,l;let{isFetching:a,run:s,error:c,changedOnly:x,primaryKeys:f,setPrimaryKeys:g,onCancel:p,enableScreenshot:y}=e,[j,v]=(0,w.useState)(!1),C=(0,w.useMemo)(()=>{var e,n;return a?{rows:[],columns:[]}:querydiff_toDataDiffGrid(null==s?void 0:null===(e=s.result)||void 0===e?void 0:e.base,null==s?void 0:null===(n=s.result)||void 0===n?void 0:n.current,{changedOnly:x,primaryKeys:f,onPrimaryKeyChange:g})},[s,a,f,g,x]);if(a)return(0,t.jsx)(u.M,{p:"16px",height:"100%",children:(0,t.jsxs)(h.g,{children:[(0,t.jsxs)(i.xu,{children:[(0,t.jsx)(d.$,{size:"sm",mr:"8px"}),j?(0,t.jsx)(t.Fragment,{children:"Aborting..."}):(0,t.jsx)(t.Fragment,{children:"Loading..."})]}),!j&&p&&(0,t.jsx)(m.z,{onClick:()=>{v(!0),p&&p()},colorScheme:"blue",size:"sm",children:"Cancel"})]})});let b=(null==c?void 0:null===(r=c.response)||void 0===r?void 0:null===(n=r.data)||void 0===n?void 0:n.detail)||(null==c?void 0:c.message)||(null==s?void 0:s.error)||(null==s?void 0:null===(o=s.result)||void 0===o?void 0:o.current_error)||(null==s?void 0:null===(l=s.result)||void 0===l?void 0:l.base_error);return b?(0,t.jsxs)(ea.b,{status:"error",children:[(0,t.jsx)(es.z,{}),"Error: ",b]}):0===C.columns.length?(0,t.jsx)(u.M,{height:"100%",children:"No data"}):x&&0===C.rows.length?(0,t.jsx)(u.M,{height:"100%",children:"No change"}):(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:C.columns,rows:C.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:y})})};function QueryDiffView(e){var n,r,o;let{check:l}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ez.U,{defaultIndex:[],allowToggle:!0,children:(0,t.jsxs)(ew.Q,{children:[(0,t.jsxs)(eS.K,{children:["query",(0,t.jsx)(e_.X,{})]}),(0,t.jsx)(eE.H,{children:(0,t.jsx)(i.xu,{height:"400px",width:"100%",border:"lightgray 1px solid ",children:(0,t.jsx)(query_SqlEditor,{value:(null===(n=null==l?void 0:l.params)||void 0===n?void 0:n.sql_template)||"",options:{readOnly:!0}})})})]})}),(0,t.jsx)(i.xu,{flex:"1",style:{contain:"size"},children:(null==l?void 0:l.type)==="query_diff"&&(0,t.jsx)(QueryDiffDataGrid,{run:null==l?void 0:l.last_run,primaryKeys:(null===(r=null==l?void 0:l.params)||void 0===r?void 0:r.primary_keys)||[],changedOnly:(null===(o=null==l?void 0:l.params)||void 0===o?void 0:o.changed_only)||!1})})]})}function SchemaDiffView(e){let{check:n}=e,{lineageGraphSets:r}=useLineageGraphsContext(),o=n.params,i=o.node_id,l=i?null==r?void 0:r.all.nodes[i]:void 0;return l?(0,t.jsx)(SchemaView,{base:l.data.base,current:l.data.current,enableScreenshot:!0}):(0,t.jsx)(t.Fragment,{})}var e7=r(33695),e9=r(34030);function CheckDescription(e){let{value:n,onChange:r}=e,[o,i]=(0,w.useState)(!1),[l,s]=(0,w.useState)();return o?(0,t.jsxs)(a.k,{direction:"column",align:"flex-end",children:[(0,t.jsx)(e7.g,{h:"200px",value:l,onChange:e=>{s(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&i(!1)}}),(0,t.jsxs)(a.k,{gap:"12px",alignItems:"flex-end",children:[(0,t.jsx)(e9.r,{onClick:()=>{setTimeout(()=>{i(!1)},100)},colorScheme:"blue",children:"cancel"}),(0,t.jsx)(m.z,{mt:"8px",size:"sm",colorScheme:"blue",onClick:()=>{r&&(r(l),i(!1))},children:"Update"})]})]}):(0,t.jsx)(f.x,{maxHeight:"400px",overflow:"auto",fontSize:"11pt",onClick:()=>{s(n||""),i(!0)},whiteSpace:"pre-line",color:n?"inherit":"lightgray",children:n||"Add description here"})}function QueryDataGrid_toDataGrid(e){let n=e.schema.fields.map(e=>({key:e.name,name:"index"===e.name?"":e.name,width:"index"===e.name?10:"auto",cellClass:"index"===e.name?"index-column":void 0}));return{columns:n,rows:e.data}}let QueryDataGrid=e=>{var n,r,o,l;let{isFetching:a,run:s,error:c,onCancel:x,enableScreenshot:f}=e,[g,p]=(0,w.useState)(!1),y=null==s?void 0:null===(n=s.result)||void 0===n?void 0:n.result,j=(0,w.useMemo)(()=>a||!y?{rows:[],columns:[]}:QueryDataGrid_toDataGrid(y),[a,y]);if(a)return(0,t.jsx)(u.M,{p:"16px",height:"100%",children:(0,t.jsxs)(h.g,{children:[(0,t.jsxs)(i.xu,{children:[(0,t.jsx)(d.$,{size:"sm",mr:"8px"}),g?(0,t.jsx)(t.Fragment,{children:"Aborting..."}):(0,t.jsx)(t.Fragment,{children:"Loading..."})]}),!g&&x&&(0,t.jsx)(m.z,{onClick:()=>{p(!0),x&&x()},colorScheme:"blue",size:"sm",children:"Cancel"})]})});let v=(null==c?void 0:null===(o=c.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.detail)||(null==s?void 0:s.error)||(null==s?void 0:null===(l=s.result)||void 0===l?void 0:l.error);return v?(0,t.jsxs)(ea.b,{status:"error",children:[(0,t.jsx)(es.z,{}),"Error: ",v]}):0===j.columns.length?(0,t.jsx)(u.M,{height:"100%",children:"No data"}):(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:j.columns,rows:j.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:f})})};function QueryView(e){var n;let{check:r}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ez.U,{defaultIndex:[],allowToggle:!0,children:(0,t.jsxs)(ew.Q,{children:[(0,t.jsxs)(eS.K,{children:["query",(0,t.jsx)(e_.X,{})]}),(0,t.jsx)(eE.H,{children:(0,t.jsx)(i.xu,{height:"400px",width:"100%",border:"lightgray 1px solid ",children:(0,t.jsx)(query_SqlEditor,{value:(null===(n=null==r?void 0:r.params)||void 0===n?void 0:n.sql_template)||"",options:{readOnly:!0}})})})]})}),(0,t.jsx)(i.xu,{flex:"1",style:{contain:"size"},children:(null==r?void 0:r.type)==="query"&&(0,t.jsx)(QueryDataGrid,{run:null==r?void 0:r.last_run,enableScreenshot:!0})})]})}function ProfileDiffView(e){var n;let{check:r}=e;return(0,t.jsx)(i.xu,{flex:"1",style:{contain:"size"},children:(0,t.jsx)(ProfileDiffDataGrid,{isFetching:!1,result:null==r?void 0:null===(n=r.last_run)||void 0===n?void 0:n.result,enableScreenshot:!0})})}var ne=r(27598);function RowCountDiffView(e){let{check:n}=e,{lineageGraphSets:r}=useLineageGraphsContext(),o=n.params,i=o.node_ids,l=i.map(e=>null==r?void 0:r.all.nodes[e]),s=(0,ne.h)({queries:l.map(e=>({queryKey:U.rowCount(null==e?void 0:e.name),queryFn:()=>fetchModelRowCount(null==e?void 0:e.name)}))});function columnCellClass(e){return e.base<e.current||"N/A"===e.base?"column-body-added":e.base>e.current||"N/A"===e.current?"column-body-removed":"column-body-normal"}let c=s.map((e,n)=>{var r,t;let o=l[n],i=(null===(r=e.data)||void 0===r?void 0:r.base)||null,a=(null===(t=e.data)||void 0===t?void 0:t.curr)||null;return{name:(null==o?void 0:o.name)||"",base:null===i?"N/A":Number(i),current:null===a?"N/A":Number(a)}});return(0,t.jsx)(a.k,{direction:"column",children:s.length>0&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(ScreenshotDataGrid,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:[{key:"name",name:"Name",cellClass:columnCellClass},{key:"base",name:"Base Rows",cellClass:columnCellClass},{key:"current",name:"Current Rows",cellClass:columnCellClass}],rows:c,className:"rdg-light",enableScreenshot:!0})})})}let CheckDetail=e=>{let{checkId:n}=e,r=(0,eT.NL)(),[,o]=(0,eN.TH)(),{isLoading:l,error:c,data:d}=(0,J.a)({queryKey:U.check(n),queryFn:()=>getCheck(n),refetchOnMount:!1,staleTime:3e5}),{mutate:h}=(0,eF.D)({mutationFn:e=>updateCheck(n,e),onSuccess:()=>{r.invalidateQueries({queryKey:U.check(n)}),r.invalidateQueries({queryKey:U.checks()})}}),{mutate:m}=(0,eF.D)({mutationFn:()=>deleteCheck(n),onSuccess:()=>{r.invalidateQueries({queryKey:U.checks()}),o("/checks")}});return l?(0,t.jsx)(u.M,{h:"100%",children:"Loading"}):c?(0,t.jsxs)(u.M,{h:"100%",children:["Error: ",c.message]}):(0,t.jsxs)(a.k,{height:"100%",width:"100%",maxHeight:"100%",direction:"column",children:[(0,t.jsxs)(a.k,{p:"0px 16px",alignItems:"center",children:[(0,t.jsx)(CheckBreadcrumb,{name:(null==d?void 0:d.name)||"",setName:e=>{h({name:e})}}),(0,t.jsxs)(C.v,{children:[(0,t.jsx)(el.j,{as:K.h,icon:(0,t.jsx)(s.J,{as:T.D_A}),variant:"ghost"}),(0,t.jsx)(b.q,{children:(0,t.jsx)(k.s,{icon:(0,t.jsx)(e5.p,{}),onClick:()=>m(),children:"Delete"})})]}),(0,t.jsx)(N.L,{}),(0,t.jsx)(e2.X,{isChecked:null==d?void 0:d.is_checked,onChange:e=>{let n=e.target.checked;h({is_checked:n})},children:"Check"})]}),(0,t.jsx)(i.xu,{p:"8px 16px",minHeight:"100px",children:(0,t.jsx)(CheckDescription,{value:null==d?void 0:d.description,onChange:e=>{h({description:e})}},null==d?void 0:d.check_id)}),d&&"query"===d.type&&(0,t.jsx)(QueryView,{check:d}),d&&"query_diff"===d.type&&(0,t.jsx)(QueryDiffView,{check:d}),d&&"value_diff"===d.type&&(0,t.jsx)(ValueDiffView,{check:d}),d&&"schema_diff"===d.type&&(0,t.jsx)(SchemaDiffView,{check:d}),d&&"profile_diff"===d.type&&(0,t.jsx)(ProfileDiffView,{check:d}),d&&"row_count_diff"===d.type&&(0,t.jsx)(RowCountDiffView,{check:d})]})};var nn=r(15012),nr=r(99986);let ChecklistItem=e=>{let{check:n,selected:r,onSelect:o}=e,l=(0,eT.NL)(),c=n.check_id,{mutate:d}=(0,eF.D)({mutationFn:e=>updateCheck(c,e),onSuccess:()=>{l.invalidateQueries({queryKey:U.check(c)}),l.invalidateQueries({queryKey:U.checks()})}}),u=(e=>{switch(e){case"schema_diff":return nn.uhn;case"query":case"query_diff":return nn.r2i;case"value_diff":return nn.pRi;case"profile_diff":return nn.dku;case"row_count_diff":return A.SwK;default:return nn.WzH}})(n.type);return(0,t.jsxs)(a.k,{width:"100%",p:"10px 20px",cursor:"pointer",_hover:{bg:"gray.200"},bg:r?"gray.100":"inherit",onClick:()=>o(n.check_id),alignItems:"center",gap:"5px",children:[(0,t.jsx)(s.J,{as:u}),(0,t.jsx)(i.xu,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n.name}),n.is_checked&&(0,t.jsx)(s.J,{color:"green",as:F.FJM})]})},CheckPage=()=>{let[,e]=(0,eN.TH)(),[,n]=(0,eN.yj)("/checks/:checkId"),r=(0,eT.NL)(),o=(0,eu.p)(),s=null==n?void 0:n.checkId,{isLoading:c,error:d,data:f,status:g}=(0,J.a)({queryKey:U.checks(),queryFn:listChecks,refetchOnMount:!0}),p=(0,w.useCallback)(n=>{e("/checks/".concat(n))},[e]),y=(0,w.useCallback)(async()=>{let e=await createSimpleCheck();r.invalidateQueries({queryKey:U.checks()}),p(e.check_id)},[r,p]);return((0,w.useEffect)(()=>{"success"===g&&!s&&f.length>0&&e("/checks/".concat(f[0].check_id))},[g,s,f,e]),c)?(0,t.jsx)(t.Fragment,{children:"Loading"}):d?(0,t.jsxs)(t.Fragment,{children:["Error: ",d.message]}):(null==f?void 0:f.length)?(0,t.jsxs)(a.k,{height:"100%",children:[(0,t.jsx)(i.xu,{flex:"0 0 400px",borderRight:"lightgray solid 1px",height:"100%",style:{contain:"size"},children:(0,t.jsxs)(h.g,{spacing:0,align:"flex-end",children:[(0,t.jsxs)(x.U,{children:[(0,t.jsx)(l.u,{label:"Create a simple check",children:(0,t.jsx)(K.h,{variant:"unstyled","aria-label":"Create a simple check",onClick:y,icon:(0,t.jsx)(nr.d,{})})}),(0,t.jsx)(l.u,{label:"Copy checklist to the clipboard",children:(0,t.jsx)(K.h,{variant:"unstyled","aria-label":"Copy checklist to the clipboard",mr:"10px",onClick:()=>{let e=buildMarkdown(f);navigator.clipboard.writeText(e),o({description:"Copied ".concat(f.length," checks to the clipboard"),status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})},icon:(0,t.jsx)(ed.T,{})})})]}),(0,t.jsx)(eP.i,{mb:"8px"}),f.map(e=>(0,t.jsx)(ChecklistItem,{check:e,selected:e.check_id===s,onSelect:p},e.check_id))]})}),(0,t.jsx)(i.xu,{flex:"1",height:"100%",width:"calc(100% - 400px)",children:(0,t.jsx)(eN.rs,{children:(0,t.jsx)(eN.AW,{path:"/checks/:checkId",children:e=>(0,t.jsx)(CheckDetail,{checkId:e.checkId})})})})]}):(0,t.jsx)(u.M,{h:"100%",children:(0,t.jsxs)(h.g,{children:[(0,t.jsx)(i.xu,{children:"No checks"}),(0,t.jsx)(m.z,{colorScheme:"blue",onClick:y,children:"Create a simple check"})]})})};function buildMarkdown(e){let n=e.map(e=>"<details><summary>".concat(buildTitle(e),"</summary>\n\n").concat(buildDescription(e),"\n\n</details>"));return n.join("\n\n")}function buildTitle(e){return"".concat(e.is_checked?" ":"").concat(e.name)}function buildDescription(e){return e.description?e.description:"_(no description)_"}async function submitQuery(e,n){return await submitRun("query",e,n)}async function submitQueryDiff(e,n){return await submitRun("query_diff",e,n)}let QueryPage=()=>{let{sqlQuery:e,setSqlQuery:n}=useRecceQueryContext(),[r,o]=(0,w.useState)([]),[s,c]=(0,w.useState)(),[d,u]=(0,w.useState)(),[h,x]=(0,w.useState)(!1),f=(0,eT.NL)(),[,g]=(0,eN.TH)(),queryFn=async n=>{c(n);let{run_id:r}="query"===n?await submitQuery({sql_template:e},{nowait:!0}):await submitQueryDiff({sql_template:e},{nowait:!0});return u(r),await waitRun(r)},{data:p,mutate:y,error:j,isPending:v}=(0,eF.D)({mutationFn:queryFn,onSuccess:e=>{o([]),x(!1)}}),C=(0,w.useCallback)(async()=>{if(d)return await cancelRun(d)},[d]),b=(0,w.useCallback)(async()=>{if(!(null==p?void 0:p.run_id))return;let e=await createCheckByRun(p.run_id);"query_diff"===p.type&&await updateCheck(e.check_id,{params:{...e.params,primary_keys:r,changed_only:h}}),f.invalidateQueries({queryKey:U.checks()}),g("/checks/".concat(e.check_id))},[null==p?void 0:p.run_id,null==p?void 0:p.type,g,r,f,h]),k=!v&&(null==p?void 0:p.run_id)&&!(null==p?void 0:p.error);return(0,t.jsxs)(a.k,{direction:"column",height:"100%",children:[(0,t.jsxs)(a.k,{justifyContent:"right",padding:"5px",gap:"5px",children:[(0,t.jsx)(m.z,{colorScheme:"blue",onClick:()=>y("query_diff"),isDisabled:v,size:"sm",children:"Run Diff"}),(0,t.jsx)(m.z,{colorScheme:"blue",onClick:()=>y("query"),isDisabled:v,size:"sm",children:"Run"})]}),(0,t.jsx)(i.xu,{flex:"1",border:"1px solid #CBD5E0",height:"200px",width:"100%",children:(0,t.jsx)(query_SqlEditor,{value:e,onChange:n,onRun:()=>y("query"),onRunDiff:()=>y("query_diff")})}),(0,t.jsxs)(a.k,{backgroundColor:"rgb(249,249,249)",height:"50vh",direction:"column",children:[k&&(0,t.jsxs)(a.k,{borderBottom:"1px solid lightgray",justifyContent:"flex-end",gap:"5px",children:["query_diff"===s&&(0,t.jsx)(e2.X,{isChecked:h,onChange:()=>{x(!h)},children:"Changed only"}),(0,t.jsx)(l.u,{label:"Add to Checklist",children:(0,t.jsx)(K.h,{variant:"unstyled",size:"sm","aria-label":"Add",icon:(0,t.jsx)(nr.d,{}),onClick:b})})]}),"query"===s?(0,t.jsx)(QueryDataGrid,{isFetching:v,run:p,error:j,onCancel:C,enableScreenshot:!1},d):(0,t.jsx)(QueryDiffDataGrid,{isFetching:v,run:p,error:j,changedOnly:h,primaryKeys:r,setPrimaryKeys:o,onCancel:C,enableScreenshot:!1},d)]})]})};var nt=r(72952);let hashNavigate=e=>(0,nt.c4)("#!"+e),useHashLocation=()=>{let e=(0,nt.LD)(()=>window.location.hash.replace(/^#!/,"")||"/",()=>"/ssr");return[e,hashNavigate]};var no=r(12218);function getCookie(e){var n=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return n?n.pop():""}function NavBar(){let[e,n]=(0,eN.TH)(),r=useVersionNumber(),o=[["Lineage","/lineage"],["Query","/query"],["Checklist","/checks"],["Summary","/summary"]],l=eL().findIndex(o,n=>{let[,r]=n;return e.startsWith(r)});return(0,t.jsx)(en.m,{index:l,children:(0,t.jsxs)(er.t,{children:[o.map(e=>{let[r,o]=e;return(0,t.jsx)(et.O,{onClick:()=>{n(o)},children:r},r)}),(0,t.jsx)(i.xu,{position:"absolute",right:"0",top:"0",p:"2",color:"gray.500",children:r})]})})}function Home(){(0,w.useLayoutEffect)(()=>{let e=getCookie("recce_user_id");if(e&&no.env.AMPLITUDE_API_KEY)try{e1.S1(no.env.AMPLITUDE_API_KEY,e,{defaultTracking:!0})}catch(e){console.error(e)}},[]);let e="calc(100vh - 42px)";return(0,t.jsx)(e0.x,{children:(0,t.jsx)(eT.aH,{client:H,children:(0,t.jsx)(RecceContextProvider,{children:(0,t.jsxs)(eN.F0,{hook:useHashLocation,children:[(0,t.jsx)(NavBar,{}),(0,t.jsx)(i.xu,{p:0,h:e,maxH:e,overflow:"auto",children:(0,t.jsxs)(eN.rs,{children:[(0,t.jsx)(eN.AW,{path:"/lineage",children:(0,t.jsx)(LineageView,{})}),(0,t.jsx)(eN.AW,{path:"/query",children:(0,t.jsx)(QueryPage,{})}),(0,t.jsx)(eN.AW,{path:"/checks/:slug*",children:(0,t.jsx)(CheckPage,{})}),(0,t.jsx)(eN.AW,{path:"/summary",children:(0,t.jsx)(SummaryView,{})}),(0,t.jsx)(eN.AW,{path:"/ssr",children:(0,t.jsx)(t.Fragment,{children:"Loading"})}),(0,t.jsx)(eN.AW,{children:(0,t.jsx)(eN.l_,{to:"/lineage"})})]})})]})})})})}},88727:function(){},7866:function(){},75165:function(){}},function(e){e.O(0,[145,170,521,531,182,710,971,495,599,638,297,62,744],function(){return e(e.s=99178)}),_N_E=e.O()}]);