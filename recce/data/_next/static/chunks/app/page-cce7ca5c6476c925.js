(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{65490:function(e,n,t){Promise.resolve().then(t.bind(t,17024))},17024:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ob}});var i=t(20130),l=t(28561),r=t(90545),o=t(5845),s=t(55261),a=t(82772),d=t(80717),c=t(51895),u=t(8656),h=t(41450),x=t(55182),m=t(31198),p=t(69711),f=t(17200),g=t(94136),v=t(93457),j=t(31973),y=t(29354),b=t(66703),w=t(25290),k=t(20519);let C='select * from {{ ref("mymodel") }}',_=(0,b.createContext)({sqlQuery:C,setSqlQuery:()=>{},primaryKeys:void 0,setPrimaryKeys:()=>{},isCustomQueries:!1,setCustomQueries:()=>{},baseSqlQuery:C,setBaseSqlQuery:()=>{}});function S(e){let{children:n}=e,[t,l]=b.useState(C),[r,o]=b.useState(C),[s,a]=b.useState(!1),[d,c]=b.useState();return(0,i.jsx)(_.Provider,{value:{setSqlQuery:l,sqlQuery:t,setPrimaryKeys:c,primaryKeys:d,isCustomQueries:s,setCustomQueries:a,baseSqlQuery:r,setBaseSqlQuery:o},children:n})}let z=()=>(0,b.useContext)(_),R=(0,b.createContext)({isNodesFetching:[],setIsNodesFetching:()=>{}});function I(e){let{children:n}=e,[t,l]=b.useState([]);return(0,i.jsx)(R.Provider,{value:{isNodesFetching:t,setIsNodesFetching:l},children:n})}var E=t(25788);function L(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=new Set,l={},r=(e,t)=>{if(!(t<0)&&(null==l[e]||!(l[e]>=t))){for(let i of(l[e]=t,n(e)))r(i,t-1);i.add(e)}};for(let n of e)r(n,t);return i}function D(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let i=new Set;return n.forEach(e=>{e.forEach(e=>{i.add(e)})}),i}var T=t(32139),O=t.n(T);function M(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return L(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].parents),t)}function A(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return L(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].children),t)}function N(e,n){let t=[],i=[],{selectedNodes:l,columnLevelLineage:r,cll:o,breakingChangeEnabled:s}=null!=n?n:{},a=r&&null!=o?function(e,n,t){let i={},l={},r="".concat(e,"_").concat(n);for(let e of Object.values(t.current.nodes)){var o,s;let n=e.id;if(n)for(let t of Object.values(null!==(o=e.columns)&&void 0!==o?o:{})){let e="".concat(n,"_").concat(t.name);for(let n of(i[e]=[],null!==(s=t.depends_on)&&void 0!==s?s:[])){let t="".concat(n.node,"_").concat(n.column);i[e].push(t),t in l||(l[t]=[]),l[t].push(e)}}}return D(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return L(e,e=>e in l?l[e]:[],n)}([r]),function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return L(e,e=>e in i?i[e]:[],n)}([r]))}(r.node,r.column,o):new Set,d={};function c(e){return"base"===e?0:"current"===e?2:1}function u(e,n){let t=c(e.from),i=c(n.from);return t<i?-1:t>i?1:0}let h=void 0!==l?new Set(l):void 0;for(let n of Object.values(e.nodes).sort(u)){var x,m,p,f,g,v,j,y,b,w,k,C,_;if(h&&!h.has(n.id))continue;let e=new Set,l=0;if(r)for(let r of Object.values(null!==(f=null==o?void 0:null===(p=o.current)||void 0===p?void 0:null===(m=p.nodes)||void 0===m?void 0:null===(x=m[n.id])||void 0===x?void 0:x.columns)&&void 0!==f?f:{})){let o="".concat(n.id,"_").concat(r.name);if(a.has(o)){for(let e of(t.push({id:o,position:{x:10,y:70+15*l},parentId:n.id,extent:"parent",draggable:!1,data:{node:n,column:r.name,type:r.type,transformationType:r.transformation_type},style:{zIndex:9999},type:"customColumnNode",targetPosition:E.Ly.Left,sourcePosition:E.Ly.Right}),null!==(g=r.depends_on)&&void 0!==g?g:[])){let n="".concat(e.node,"_").concat(e.column);a.has(n)&&i.push({id:"".concat(n,"_").concat(o),source:n,target:o,style:{zIndex:9999}})}l++,e.add(r.name)}}else if(s&&n.change)for(let[i,r]of Object.entries(null!==(v=n.change.columns)&&void 0!==v?v:{})){let o="".concat(n.id,"_").concat(i),s=null!==(_=null===(b=n.data.current)||void 0===b?void 0:null===(y=b.columns)||void 0===y?void 0:null===(j=y[i])||void 0===j?void 0:j.type)&&void 0!==_?_:null===(C=n.data.base)||void 0===C?void 0:null===(k=C.columns)||void 0===k?void 0:null===(w=k[i])||void 0===w?void 0:w.type;t.push({id:o,position:{x:10,y:70+15*l},parentId:n.id,extent:"parent",draggable:!1,data:{node:n,column:i,type:s,changeStatus:r},style:{zIndex:9999},type:"customColumnNode",targetPosition:E.Ly.Left,sourcePosition:E.Ly.Right}),l++,e.add(i)}d[n.id]=e;let c=60;l>0&&(c+=20+15*l),t.push({id:n.id,position:{x:0,y:0},width:300,height:c,data:{...n},type:"customNode",targetPosition:E.Ly.Left,sourcePosition:E.Ly.Right})}for(let n of Object.values(e.edges).sort(u))(!h||h.has(n.parent.id)&&h.has(n.child.id))&&i.push({id:n.id,type:"customEdge",source:n.parent.id,target:n.child.id,data:n});return F(t,i),[t,i,d]}let F=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR",i=new(O()).graphlib.Graph;i.setDefaultEdgeLabel(()=>({})),i.setGraph({rankdir:t,ranksep:50,nodesep:30}),e.forEach(e=>{"customNode"===e.type&&i.setNode(e.id,{width:e.width,height:e.height})}),n.forEach(e=>{i.setEdge(e.source,e.target)}),O().layout(i),e.forEach(e=>{var n,t;if("customNode"!==e.type)return;let l=null!==(n=e.width)&&void 0!==n?n:300,r=null!==(t=e.height)&&void 0!==t?t:60,o=i.node(e.id);return e.position={x:o.x-l/2,y:o.y-r/2},e})},q={lineage:()=>["lineage"],checks:()=>["checks","list"],check:e=>["checks",e],runs:()=>["runs"],run:e=>["runs",e],runsAggregated:()=>["runs_aggregated"],flag:()=>["flag"],instanceInfo:()=>["instance_info"]};var H=t(46846),P=t(79294);let V=P.env.NEXT_PUBLIC_API_URL;null!=V||(V=window.location.origin);let W=V,K=P.env.NEXT_PUBLIC_CLOUD_WEB_URL;null!=K||(K="https://cloud.datarecce.io");let J=K;var B=t(82729);let U=H.default.create({baseURL:W}),Q=new B.S;async function Z(){return(await U.get("/api/info")).data}async function X(e){return(await U.get("/api/model/".concat(e))).data}var G=t(85071),Y=t(32850),$=t(36198),ee=t(44016),en=t(58407),et=t(38029),ei=t(55169),el=t(61608),er=t(19736),eo=t(51036),es=t.n(eo),ea=t(31886),ed=t(3938),ec=t(79294);function eu(e){ea.j("[Web] multi_nodes_action",e)}function eh(e){ea.j("[Web] history_action",e)}function ex(e){ea.j("[Experiment] preview_change",e)}function em(e){ea.j("[Experiment] preview_change",e)}function ep(e){ea.j("[Experiment] single_environment",e)}function ef(e){ea.j("[Experiment] recommend_preset_check",e)}let eg=!1;function ev(e){ea.j("Column level lineage",e)}function ej(e){ea.j("share_state",e)}function ey(e){ea.j("state_action",e)}function eb(e){ea.j("[Click] copy_to_clipboard",e)}async function ew(e,n,t){let i=eg?{breaking_change_analysis:!0}:{};return(await U.post("/api/runs",{type:e,params:n,nowait:null==t?void 0:t.nowait,track_props:i})).data}async function ek(e,n){return(await U.get("/api/runs/".concat(e,"/wait"),{params:{timeout:n}})).data}async function eC(e){return await U.post("/api/runs/".concat(e,"/cancel"))}async function e_(e,n){return(await U.post("/api/checks/".concat(e,"/run"),{nowait:null==n?void 0:n.nowait})).data}async function eS(e,n,t){return(await U.post("/api/runs/search",{type:e,params:n,limit:t})).data}async function ez(){return(await U.get("/api/runs")).data}async function eR(){return(await U.post("/api/runs/aggregate",{})).data}async function eI(){return(await U.get("/api/flag")).data}async function eE(){try{await U.post("/api/onboarding/completed")}catch(e){}}async function eL(){try{await U.post("/api/relaunch-hint/completed")}catch(e){}}let eD=()=>(0,w.a)({queryKey:q.flag(),queryFn:eI}),eT=(0,b.createContext)({isActionAvailable:()=>!0});function eO(e){var n,t;let{children:l}=e,r=(0,w.a)({queryKey:q.lineage(),queryFn:Z}),o=(0,w.a)({queryKey:q.runsAggregated(),queryFn:eR}),a=(0,b.useMemo)(()=>{var e;let n=null===(e=r.data)||void 0===e?void 0:e.lineage;if((null==n?void 0:n.base)&&n.current)return function(e,n,t){var i,l,r,o,s,a,d,c,u;let h={},x={},m=(e,n)=>({id:e,name:e,data:{},from:n,parents:{},children:{}});for(let[n,t]of Object.entries(e.nodes))h[n]=m(n,"base"),t&&(h[n].data.base=t,h[n].name=t.name,h[n].resourceType=t.resource_type,h[n].packageName=t.package_name);for(let[e,t]of Object.entries(n.nodes))h[e]?h[e].from="both":h[e]=m(e,"current"),t&&(h[e].data.current=n.nodes[e],h[e].name=t.name,h[e].resourceType=t.resource_type,h[e].packageName=t.package_name);for(let[n,t]of Object.entries(e.parent_map))for(let e of t){let t=h[n],i=h[e],l="".concat(e,"_").concat(n);if(!t||!i)continue;x[l]={id:l,from:"base",parent:i,child:t};let r=x[l];t.parents[e]=r,i.children[n]=r}for(let[e,t]of Object.entries(n.parent_map))for(let n of t){let t=h[e],i=h[n],l="".concat(n,"_").concat(e);if(!t||!i)continue;x[l]?x[l].from="both":x[l]={id:l,from:"current",parent:i,child:t};let r=x[l];t.parents[n]=r,i.children[e]=r}let p=[],f=[],g=[];for(let[e,n]of Object.entries(h))if(t){let l=t[e];l&&(n.changeStatus=l.change_status,l.change&&(n.change={category:l.change.category,columns:l.change.columns}),p.push(e),(null==l?void 0:null===(i=l.change)||void 0===i?void 0:i.category)==="non_breaking"?f.push(e):g.push(e))}else if("base"===n.from)n.changeStatus="removed",p.push(n.id);else if("current"===n.from)n.changeStatus="added",p.push(n.id);else{let t=null===(r=n.data.base)||void 0===r?void 0:null===(l=r.checksum)||void 0===l?void 0:l.checksum,i=null===(s=n.data.current)||void 0===s?void 0:null===(o=s.checksum)||void 0===o?void 0:o.checksum;t&&i&&t!==i&&(n.changeStatus="modified",p.push(n.id),g.push(e))}for(let[e,n]of Object.entries(x))"base"===n.from?n.changeStatus="removed":"current"===n.from&&(n.changeStatus="added");let v=D(new Set(p),L(g,e=>void 0===h[e]?[]:Object.keys(h[e].children)));return{nodes:h,edges:x,modifiedSet:p,nonBreakingSet:new Set(f),impactedSet:v,manifestMetadata:{base:null!==(a=e.manifest_metadata)&&void 0!==a?a:void 0,current:null!==(d=n.manifest_metadata)&&void 0!==d?d:void 0},catalogMetadata:{base:null!==(c=e.catalog_metadata)&&void 0!==c?c:void 0,current:null!==(u=n.catalog_metadata)&&void 0!==u?u:void 0}}}(n.base,n.current,n.diff)},[r.data]),d=null===(n=r.error)||void 0===n?void 0:n.message,{state_metadata:c,lineage:u,sqlmesh:h,demo:x,review_mode:m,cloud_mode:p,file_mode:f,filename:g,adapter_type:v,git:j,pull_request:y,support_tasks:C}=null!==(t=r.data)&&void 0!==t?t:{},_=null==u?void 0:u.base.manifest_metadata,S=null==u?void 0:u.current.manifest_metadata,{connectionStatus:z,connect:R,envStatus:I}=function(){let e=(0,s.p)(),n=(0,b.useRef)({ws:void 0,status:"pending"}),[t,i]=(0,b.useState)("pending"),[l,r]=(0,b.useState)(void 0);n.current.status=t;let o=(0,k.NL)(),a=()=>{o.invalidateQueries({queryKey:q.lineage()}),o.invalidateQueries({queryKey:q.checks()}),o.invalidateQueries({queryKey:q.runs()})},d=()=>{let t=new WebSocket("".concat(W.replace(/(http)(s)?:\/\//,"ws$2://"),"/api/ws"));n.current.ws=t,t.onopen=()=>{t.send("ping")},t.onmessage=t=>{if("pong"===t.data){"disconnected"===n.current.status&&a(),i("connected");return}try{let n=JSON.parse(t.data);if("refresh"===n.command){let{eventType:t,srcPath:i}=n.event,[l,r]=i.split("/").slice(-2),o=es().parse(r).name,s="".concat(l,"-").concat(o,"-").concat(t);e.isActive(s)||e({id:s,description:"Detected ".concat(l," ").concat(o," ").concat(t),status:"info",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0}),a()}else if("relaunch"===n.command)r("relaunch");else{let{id:t,title:i,description:l,status:r,position:o,duration:s}=n.event;e({id:t||"broadcast",title:i,description:l,status:null!=r?r:"info",variant:"left-accent",position:null!=o?o:"bottom-right",duration:null!=s?s:5e3,isClosable:!0})}}catch(e){console.error(e)}},t.onerror=e=>{console.error(e)},t.onclose=()=>{i(e=>"connected"===e?"disconnected":e),n.current.ws=void 0}};return(0,b.useEffect)(()=>{let e=n.current;return d(),()=>{e.ws&&e.ws.close()}},[]),{connectionStatus:t,connect:d,envStatus:l}}(),{data:E,isLoading:T}=eD(),{onClose:O}=(0,G.q)(),[M,A]=(0,b.useState)(!1),N=(0,k.NL)(),F=(0,b.useCallback)(e=>{if(C){var n;return null===(n=C[e])||void 0===n||n}return!0},[C]);return(0,b.useEffect)(()=>{T||("relaunch"===I&&(null==E?void 0:E.single_env_onboarding)&&E.show_relaunch_hint?(A(!0),ep({action:"target_base_added"})):A(!1))},[E,I,T]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eT.Provider,{value:{lineageGraph:a,retchLineageGraph:()=>{o.refetch()},envInfo:{stateMetadata:c,adapterType:v,git:j,pullRequest:y,dbt:{base:_,current:S},sqlmesh:h},reviewMode:m,cloudMode:p,fileMode:f,fileName:g,isDemoSite:x,error:d,supportTasks:C,isActionAvailable:F,isLoading:r.isLoading,runsAggregated:o.data,refetchRunsAggregated:()=>{o.refetch()}},children:l}),(0,i.jsxs)(Y.u_,{isOpen:"disconnected"===z,onClose:()=>{},isCentered:!0,children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{children:[(0,i.jsx)(en.x,{children:"Server Disconnected"}),(0,i.jsx)(et.f,{children:(0,i.jsx)(ei.x,{children:"The server connection has been lost. Please restart the Recce server and try again."})}),(0,i.jsx)(el.m,{children:(0,i.jsx)(er.z,{colorScheme:"blue",onClick:()=>{R()},children:"Retry"})})]})]}),(null==E?void 0:E.single_env_onboarding)&&(0,i.jsxs)(Y.u_,{isOpen:M,onClose:()=>{O(),eL(),N.invalidateQueries({queryKey:q.flag()})},isCentered:!0,children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{children:[(0,i.jsx)(en.x,{children:"Target-base Added"}),(0,i.jsx)(et.f,{children:(0,i.jsx)(ei.x,{children:"Please restart the Recce server."})}),(0,i.jsx)(el.m,{children:(0,i.jsx)(er.z,{colorScheme:"blue",onClick:()=>{O(),eL(),N.invalidateQueries({queryKey:q.flag()})},children:"Got it!"})})]})]})]})}let eM=()=>(0,b.useContext)(eT),eA=()=>{let{runsAggregated:e,refetchRunsAggregated:n}=eM();return[e,n]};var eN=t(60667);let eF=e=>{let{isOpen:n,onClose:t,onExecute:r,type:o,title:s,params:a,RunForm:d}=e,[u,h]=(0,b.useState)(a),[x,m]=(0,b.useState)(!1);return(0,i.jsxs)(Y.u_,{isOpen:n,onClose:t,size:"6xl",scrollBehavior:"inside",children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{overflowY:"auto",height:"75%",minHeight:"400px",children:[(0,i.jsx)(en.x,{children:s}),(0,i.jsx)(eN.o,{}),(0,i.jsx)(et.f,{p:"0px",h:"100%",overflow:"auto",borderY:"1px solid lightgray",children:(0,i.jsx)(l.x,{style:{contain:"layout"},children:d&&(0,i.jsx)(d,{params:u,onParamsChanged:h,setIsReadyToExecute:m})})}),(0,i.jsx)(el.m,{children:(0,i.jsx)(c.k,{gap:"10px",children:(0,i.jsx)(er.z,{isDisabled:!x,colorScheme:"blue",onClick:()=>{r(o,u)},children:"Execute"})})})]})]})};var eq=t(99201),eH=t(63646),eP=t(22488),eV=t(49151),eW=t(15615),eK=t(35813),eJ=t.n(eK);function eB(e,n){let t=[];return e.forEach(e=>{t.some(n=>n.name===e.name)||t.push(e)}),n.forEach(e=>{t.some(n=>n.name===e.name)||t.push(e)}),t}var eU=e=>{var n;let{lineageGraph:t}=eM(),[i,l]=(0,b.useState)([]),[r,o]=(0,b.useState)(),[s,a]=(0,b.useState)(!0),[d,c]=(0,b.useState)(null),u=eJ().find(null==t?void 0:t.nodes,{name:e}),h=(0,b.useMemo)(()=>u?function(e){function n(e){return(null==e?void 0:e.columns)?Object.values(e.columns):[]}return eB(n(e.data.base),n(e.data.current))}(u):[],[u]),x=u?null===(n=u.data.current)||void 0===n?void 0:n.primary_key:void 0,m=(0,b.useCallback)(async()=>{try{let e=(await X(null==u?void 0:u.id)).model;if(!e.base.columns||!e.current.columns){l([]);return}o(e.current.primary_key);let n=Object.values(e.base.columns),t=Object.values(e.current.columns);l(eB(n,t))}catch(e){c(e)}},[null==u?void 0:u.id]);return(0,b.useEffect)(()=>{h.length>0?(l(h),o(x)):(null==u?void 0:u.id)===void 0?l([]):m().catch(e=>{}),a(!1)},[m,null==u?void 0:u.id,h,x]),{columns:i,primaryKey:r,isLoading:s,error:d}};function eQ(e){let n=e.trim().toUpperCase();return!!["CHAR","VARCHAR","TINYTEXT","TEXT","MEDIUMTEXT","LONGTEXT","NCHAR","NVARCHAR","VARCHAR2","NVARCHAR2","CLOB","NCLOB","VARCHAR(MAX)","XML","JSON"].includes(n)||/^(VARCHAR|NVARCHAR|VARCHAR2|NVARCHAR2|CHAR|NCHAR)\(\d+\)$/.test(n)}function eZ(e){return["BOOLEAN","TINYINT(1)","BIT","NUMBER(1)","BOOL"].includes(e.toUpperCase())}function eX(e){return["DATE","DATETIME","TIMESTAMP","TIME","YEAR","DATETIME2","SMALLDATETIME","DATETIMEOFFSET","INTERVAL","TIMESTAMPTZ","TIMETZ","TIMESTAMP WITH TIME ZONE","TIMESTAMP WITH LOCAL TIME ZONE","TIMESTAMP_LTZ","TIMESTAMP_NTZ","TIMESTAMP_TZ"].includes(e.toUpperCase())}function eG(e){return!eQ(e)&&!eZ(e)&&!eX(e)}var eY=t(43906),e$=t(70458),e0=t(78352);function e1(e){let n=e>0&&e<=.001,t=e<1&&e>=.999,i=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US",t=arguments.length>2?arguments[2]:void 0;return"number"!=typeof e?e:new Intl.NumberFormat(n,t).format(e)}(n,"en-US",{style:"percent",minimumFractionDigits:1})};if(n){let e=i(.001);return"<".concat(e)}if(t){let e=i(.999);return">".concat(e)}return i()}function e5(e){if("number"!=typeof e)return e;{let n=Math.abs(e),t=n>=.01,i=n>=1e6,l=n>=1e9,r=n>=1e15;if(r||n>=1e12)return new Intl.NumberFormat("en-US",{style:"unit",unit:"liter",unitDisplay:"narrow",maximumFractionDigits:r?0:2}).format(e/1e12).replace("L","T");if(l||i||n>=1e3){let n={base:l?1e9:i?1e6:1e3,unit:l?"B":i?"M":"K"};return new Intl.NumberFormat("en-US",{style:"unit",unit:"liter",unitDisplay:"narrow",maximumFractionDigits:1}).format(e/n.base).replace("L",n.unit)}return n>=1?new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(e):new Intl.NumberFormat("en-US",{maximumFractionDigits:t?3:2,notation:t||0===n?"standard":"scientific"}).format(e)}}let e2="#63B3ED",e4="#F6AD55",e6="".concat(e2,"A5"),e3="".concat(e4,"A5");function e9(e){let{color:n}=e;return(0,i.jsx)(l.x,{display:"inline-block",w:"10px",h:"10px",bgColor:n,mr:"2",borderRadius:"sm"})}function e8(e){let{data:n,hideAxis:t=!1,animation:l=!1}=e;e$.kL.register(e$.ZL,e$.RM,e$.f$,e$.uw,e$.Dx,e$.De,e$.u);let r=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{...t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{title:i,datasets:l,type:r,samples:o=0,binEdges:s}=e,[a,d]=l,c="datetime"===r;return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{reverse:!0},title:{display:!0,text:i,font:{size:20}},tooltip:{mode:"index",intersect:!1,callbacks:{title(e){let[{dataIndex:n,datasetIndex:t}]=e,i=ne(s,n);return"".concat(c?"Date Range":"string"===r?"Text Length":"Value Range","\n").concat(i)},label(e){let{datasetIndex:n,dataIndex:t,dataset:{label:i}}=e,l=0===n?d.counts:a.counts,r=e1(l[t]/o),s=l[t];return"".concat(i,": ").concat(s," (").concat(r,")")}}}},scales:function(e){let{datasets:n,min:t=0,max:i=0,type:l,binEdges:r}=e,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],[s,a]=n,d=Math.max(...a.counts,...s.counts),c=r.map((e,n)=>ne(r,n)).slice(0,-1);return{x:"datetime"===l?{display:!o,type:"timeseries",min:t,max:i,adapters:{date:{}},time:{minUnit:"day"},grid:{display:!1},ticks:{minRotation:30,maxRotation:30,maxTicksLimit:8}}:{display:!o,type:"category",grid:{display:!1},ticks:{callback:(e,n)=>c[n]},stacked:!0},y:{display:!o,type:"linear",max:d,border:{dash:[2,2]},grid:{color:"lightgray"},ticks:{maxTicksLimit:8,callback:function(e,n){return e5(e)}},beginAtZero:!0}}}(e,n),...t}}(n,t,{animation:l}),o=function(e){let{datasets:n,type:t,binEdges:i}=e,[l,r]=n,o=e7(t,i,"Current",e6,r),s=e7(t,i,"Base",e3,l);return{labels:i.map((e,n)=>ne(i,n)).slice(0,-1),datasets:[o,s]}}(n);return(0,i.jsx)(e0.kL,{type:"bar",options:r,data:o,plugins:[]})}function e7(e,n,t,i,l){let{counts:r=[]}=l;return{label:t,data:"datetime"===e?r.map((e,t)=>({x:n[t],y:e})):r,backgroundColor:i,borderColor:i,hoverBackgroundColor:i,borderWidth:0,categoryPercentage:1,barPercentage:1,xAxisID:"x"}}function ne(e,n){let t=e[n],i=e[n+1],l=e5(t),r=e5(i);return"".concat(l," - ").concat(r)}let nn=(0,eY.G)((e,n)=>{let{backgroundColor:t="white",blockSize:r,children:o,...s}=e;return(0,i.jsx)(l.x,{ref:n,...s,overflowY:"auto",overflowX:"hidden",children:(0,i.jsx)(l.x,{backgroundColor:t,height:"100%",blockSize:r,children:o})})}),nt=(0,eY.G)(function(e,n){var t,r,o,s,a,d,u;let{run:h}=e,p=h.params,f=null===(t=h.result)||void 0===t?void 0:t.base,g=null===(r=h.result)||void 0===r?void 0:r.current,v=null===(o=h.result)||void 0===o?void 0:o.min,j=null===(s=h.result)||void 0===s?void 0:s.max,y=null===(a=h.result)||void 0===a?void 0:a.bin_edges;return f&&g?(0,i.jsx)(c.k,{direction:"column",height:"100%",children:(0,i.jsx)(nn,{ref:n,height:"100%",children:(0,i.jsxs)(x.U,{children:[(0,i.jsx)(m.L,{}),(0,i.jsx)(l.x,{w:"80%",h:"35vh",m:"4",children:(0,i.jsx)(e8,{data:{title:"Model ".concat(p.model,".").concat(p.column_name),type:null!==(u=null===(d=h.params)||void 0===d?void 0:d.column_type)&&void 0!==u?u:"",datasets:[f,g],min:v,max:j,samples:f.total,binEdges:y}})}),(0,i.jsx)(m.L,{})]})})}):(0,i.jsx)("div",{children:"Loading..."})});var ni=t(50537);t(7903);var nl=t(23113);let nr=(0,eY.G)((e,n)=>{let{...t}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(nl.ZP,{ref:n,...t})})});function no(e){let{emptyMessage:n}=e;return(0,i.jsx)(c.k,{h:"35px",alignItems:"center",justifyContent:"center",bg:"gray.100",style:{textAlign:"center",gridColumn:"1/-1"},children:(0,i.jsxs)(ei.x,{fontWeight:"600",children:[" ",null!=n?n:"No rows"]})})}t(26372);var ns=t(84924);function na(e,n){let t=function(e,n){let t=[...e],i=[...n],l=[];for(;t.length>0&&i.length>0;)if(l.includes(t[0]))t.shift();else if(l.includes(i[0]))i.shift();else if(t[0]===i[0])l.push(t[0]),t.shift(),i.shift();else if(i.includes(t[0])){let e=i.indexOf(t[0]);for(let n=0;n<e;n++)l.includes(i[n])||l.push(i[n]);l.push(t[0]),t.shift(),i.splice(0,e+1)}else l.push(t[0]),t.shift();return t.forEach(e=>{l.includes(e)||l.push(e)}),i.forEach(e=>{l.includes(e)||l.push(e)}),l}(e,n),i={};for(let l of t)e.includes(l)?n.includes(l)?i[l]=void 0:i[l]="removed":i[l]="added";let l={};e.forEach((e,n)=>{l[e]=n});let r=-1;for(let e of t){let n=l[e];null!=n&&(n>r?r=n:i[e]="reordered")}return i}var nd=t(93166),nc=t(64126),nu=t(71676);let nh=e=>{let{value:n,colorScheme:t,grayOut:r,noCopy:o,fontSize:s}=e,{onCopy:a,hasCopied:d}=(0,nc.V)(n),[u,h]=(0,b.useState)(!1);return(0,i.jsxs)(c.k,{p:"2px 5px",minWidth:"30px",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",color:"".concat(t,".800"),backgroundColor:"".concat(t,".100"),alignItems:"center",gap:"2px",rounded:"md",fontSize:s,flexShrink:o?"0":"inherit",onMouseEnter:()=>{h(!0)},onMouseLeave:()=>{h(!1)},children:[(0,i.jsx)(l.x,{overflow:"hidden",textOverflow:"ellipsis",color:r?"gray":"inherit",children:n}),(0,i.jsx)(()=>o||r?(0,i.jsx)(i.Fragment,{}):d?(0,i.jsx)(i.Fragment,{children:"Copied"}):u?(0,i.jsx)(nu.h,{"aria-label":"Copy",icon:(0,i.jsx)(nd.T,{boxSize:"10px"}),size:"xs",minW:"10px",h:"10px",variant:"unstyled",onClick:a,display:"flex",alignItems:"center",justifyContent:"center"}):(0,i.jsx)(i.Fragment,{}),{})]})};function nx(e,n){let t=[];for(let i of n){let n=e.findIndex(e=>e.name===i);if(n<0)throw Error("Column ".concat(i," not found"));t.push(n)}return t}function nm(e,n,t){let i={};if(0===n.length)return JSON.stringify({_index:t._index});for(let l of n)i[e[l].name]=t[l];return JSON.stringify(i)}function np(e){var n,t;let{name:r,columnStatus:s,onPrimaryKeyChange:a,onPinnedColumnsChange:d,...u}=e,h=null!==(n=u.primaryKeys)&&void 0!==n?n:[],x=null!==(t=u.pinnedColumns)&&void 0!==t?t:[],m=h.includes(r),p=x.includes(r);return"index"===r?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(c.k,{alignItems:"center",gap:"10px",className:"grid-header",children:[m&&(0,i.jsx)(o.J,{as:ns.MhP}),(0,i.jsx)(l.x,{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:r}),"added"!==s&&"removed"!==s&&a&&(0,i.jsx)(o.J,{className:m?"close-icon":"key-icon",display:m?"block":"none",cursor:"pointer",as:m?ns.ven:ns.MhP,onClick:m?()=>{let e=h.filter(e=>e!==r);a&&a(e)}:()=>{let e=[...h.filter(e=>"index"!==e),r];a&&a(e)}}),!m&&d&&(0,i.jsx)(o.J,{className:p?"unpin-icon":"pin-icon",display:p?"block":"none",cursor:"pointer",as:p?ns.$kI:ns.oJP,onClick:p?()=>{let e=x.filter(e=>e!==r);d&&d(e)}:()=>{let e=[...x,r];d&&d(e)}})]})}let nf=(e,n)=>{let t;if(!Object.hasOwn(e,n))return["-",!0];let i=e[n],l=!1;return"boolean"==typeof i?t=i.toString():""===i?(t="(empty)",l=!0):null==i?(t="(null)",l=!0):t=i,[t,l]},ng=e=>{let{row:n,column:t}=e,[l,r]=nf(n,t.key);return(0,i.jsx)(ei.x,{style:{color:r?"gray":"inherit"},children:l})},nv=e=>{let{row:n,column:t}=e,l="base__".concat(t.key),r="current__".concat(t.key);if(!Object.hasOwn(n,l)&&!Object.hasOwn(n,r))return"-";let o=Object.hasOwn(n,l),s=Object.hasOwn(n,r),[a,d]=nf(n,"base__".concat(t.key)),[u,h]=nf(n,"current__".concat(t.key));return n[l]===n[r]?(0,i.jsx)(ei.x,{style:{color:h?"gray":"inherit"},children:u}):(0,i.jsxs)(c.k,{gap:"5px",alignItems:"center",lineHeight:"normal",height:"100%",children:[o&&(0,i.jsx)(nh,{value:a,colorScheme:"red",grayOut:d}),s&&(0,i.jsx)(nh,{value:u,colorScheme:"green",grayOut:h})]})};function nj(e,n,t){var l,r,o,s;let a=null!=e?e:{columns:[],data:[]},d=null!=n?n:{columns:[],data:[]},c=null!==(l=null==t?void 0:t.primaryKeys)&&void 0!==l?l:[],u=null!==(r=null==t?void 0:t.pinnedColumns)&&void 0!==r?r:[],h=null!==(o=null==t?void 0:t.changedOnly)&&void 0!==o&&o,x=null!==(s=null==t?void 0:t.displayMode)&&void 0!==s?s:"side_by_side",m=[],p=function(e,n){let t={};return Object.entries(na(e.columns.map(e=>e.name),n.columns.map(e=>e.name))).map(i=>{let[l,r]=i;t[l]={status:r,baseColumnIndex:e.columns.findIndex(e=>e.name===l),currentColumnIndex:n.columns.findIndex(e=>e.name===l)}}),t}(a,d),f={},g={},v=!1,j=!1;if(0===c.length)a.data.forEach((e,n)=>{e._index=n+1,f[JSON.stringify({_index:n+1})]=e}),d.data.forEach((e,n)=>{e._index=n+1,g[JSON.stringify({_index:n+1})]=e});else{let e=nx(a.columns,c);a.data.forEach((n,t)=>{let i=nm(a.columns,e,n);i in f&&(v=!0),f[i]=n}),e=nx(d.columns,c),d.data.forEach((n,t)=>{let i=nm(d.columns,e,n);i in g&&(j=!0),g[i]=n})}let y=na(Object.keys(f),Object.keys(g)),b={added:0,removed:0,modified:0},w=Object.entries(y).map(e=>{let[n,t]=e,i=f[n],l=g[n],r=JSON.parse(n);if(i&&a.columns.forEach((e,n)=>{c.includes(e.name)||(r["base__".concat(e.name)]=i[n])}),l&&d.columns.forEach((e,n)=>{c.includes(e.name)||(r["current__".concat(e.name)]=l[n])}),i){if(l){for(let[e,n]of Object.entries(p))"index"===e||c.includes(e)||n.baseColumnIndex<0||n.currentColumnIndex<0||eJ().isEqual(i[n.baseColumnIndex],l[n.currentColumnIndex])||(r.__status="modified",n.status="modified");"modified"===r.__status&&b.modified++}else r.__status="removed",b.removed++}else r.__status="added",b.added++;return r});h&&(w=w.filter(e=>"added"===e.__status||"removed"===e.__status||"modified"===e.__status));let k=(e,n)=>{var l,r;let o="added"===n?"diff-header-added":"removed"===n?"diff-header-removed":void 0;return"inline"===x?{headerCellClass:o,name:(0,i.jsx)(np,{name:e,columnStatus:n,...t}),key:e,renderCell:nv,size:"auto"}:{headerCellClass:o,name:(0,i.jsx)(np,{name:e,columnStatus:n,...t}),children:[{key:"base__".concat(e),name:null!==(l=null==t?void 0:t.baseTitle)&&void 0!==l?l:"Base",renderEditCell:nl.Ug,headerCellClass:o,cellClass:t=>{let i=t.__status;if("removed"===i)return"diff-cell-removed";if("added"===i)return"diff-cell-added";if("added"===n);else if("removed"===n);else if(!eJ().isEqual(t["base__".concat(e)],t["current__".concat(e)]))return"diff-cell-removed"},renderCell:ng,size:"auto"},{key:"current__".concat(e),name:null!==(r=null==t?void 0:t.currentTitle)&&void 0!==r?r:"Current",renderEditCell:nl.Ug,headerCellClass:o,cellClass:t=>{let i=t.__status;if("removed"===i)return"diff-cell-removed";if("added"===i)return"diff-cell-added";if("added"===n);else if("removed"===n);else if(!eJ().isEqual(t["base__".concat(e)],t["current__".concat(e)]))return"diff-cell-added"},renderCell:ng,size:"auto"}]}};return 0===c.length?m.push({key:"_index",width:50,maxWidth:100,name:"",cellClass:"index-column"}):c.forEach(e=>{var n;let l=null!==(n=p[e].status)&&void 0!==n?n:"";m.push({key:e,name:(0,i.jsx)(np,{name:e,columnStatus:l,...t}),frozen:!0,cellClass:e=>{if(e.__status)return"diff-header-".concat(e.__status)},renderCell:ng})}),u.forEach(e=>{var n;let t=null!==(n=p[e].status)&&void 0!==n?n:"";"index"===e||c.includes(e)||m.push(k(e,t))}),Object.entries(p).forEach(e=>{var n;let[t,i]=e,l=null!==(n=i.status)&&void 0!==n?n:"";"index"===t||c.includes(t)||u.includes(t)||h&&b.modified>0&&"added"!==l&&"removed"!==l&&"modified"!==l||m.push(k(t,l))}),{columns:m,rows:w,invalidPKeyBase:v,invalidPKeyCurrent:j}}var ny=t(32165),nb=t(40613);let nw=e=>{let{warnings:n,children:t}=e;return(0,i.jsxs)(c.k,{borderBottom:"1px solid lightgray",justifyContent:"flex-end",gap:"5px",alignItems:"center",px:"10px",bg:n&&n.length>0?"orange.100":"inherit",children:[(0,i.jsx)(nb.g,{alignItems:"flex-start",spacing:0,children:null==n?void 0:n.map((e,n)=>(0,i.jsxs)(l.x,{children:[(0,i.jsx)(ny.a,{color:"orange.600"})," ",e]},n))}),(0,i.jsx)(m.L,{minHeight:"32px"}),t]})};var nk=t(30566);let nC=e=>{let{value:n,onChange:t,textOn:l,textOff:r}=e;return(0,i.jsxs)(nk.h,{isAttached:!0,variant:"outline",borderRadius:"full",size:"xs",children:[(0,i.jsx)(er.z,{onClick:()=>{t(!1)},color:n?"gray.400":"black",bg:n?"gray.50":"white",children:null!=r?r:"Off"}),(0,i.jsx)(er.z,{onClick:()=>{t(!0)},color:n?"black":"gray.400",bg:n?"white":"gray.50",children:null!=l?l:"On"})]})},n_=e=>{let{displayMode:n,onDisplayModeChanged:t}=e;return(0,i.jsxs)(i.Fragment,{children:["inline"===n&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nh,{value:"Base",colorScheme:"red",grayOut:!1,fontSize:"10pt",noCopy:!0}),(0,i.jsx)(nh,{value:"Current",colorScheme:"green",grayOut:!1,fontSize:"10pt",noCopy:!0})]}),(0,i.jsx)(nC,{value:"side_by_side"===n,onChange:e=>{t(e?"side_by_side":"inline")},textOff:"Inline",textOn:"Side by side"})]})};function nS(e){let{name:n,pinnedColumns:t=[],onPinnedColumnsChange:r=()=>{}}=e,s=t.includes(n);return(0,i.jsxs)(c.k,{className:"grid-header",alignItems:"center",children:[(0,i.jsx)(l.x,{flex:1,children:n}),(0,i.jsx)(o.J,{className:s?"unpin-icon":"pin-icon",display:s?"block":"none",cursor:"pointer",as:s?ns.$kI:ns.oJP,onClick:s?()=>{r(t.filter(e=>e!==n))}:()=>{r([...t,n])}})]})}function nz(e,n){var t,l;let r=[],o=null!==(t=n.primaryKeys)&&void 0!==t?t:[],s=null!==(l=n.pinnedColumns)&&void 0!==l?l:[],a=(e,t)=>({key:String(e),name:(0,i.jsx)(nS,{name:t,...n}),width:"auto",renderCell:ng}),d=(e,t)=>({key:String(e),name:(0,i.jsx)(np,{name:t,columnStatus:"",...n}),width:"auto",frozen:!0,renderCell:ng});return o.length>0?o.forEach(n=>{let t=eJ().findIndex(e.columns,e=>e.name===n);r.push(d(t,n))}):r.push({key:"_index",name:"",width:50,cellClass:"index-column"}),s.forEach(n=>{let t=eJ().findIndex(e.columns,e=>e.name===n);t<0||r.push(a(t,n))}),e.columns.forEach((e,n)=>{o.includes(e.name)||s.includes(e.name)||r.push(a(n,e.name))}),e.data.forEach((e,n)=>{e._index=n+1}),{columns:r,rows:e.data}}let nR=(0,eY.G)((e,n)=>{var t;let{run:r,viewOptions:o,onViewOptionsChanged:s,onAddToChecklist:a}=e,d=(0,b.useMemo)(()=>{var e;return null!==(e=null==o?void 0:o.pinned_columns)&&void 0!==e?e:[]},[o]),u=r.result,h=(0,b.useMemo)(()=>u?nz(u,{pinnedColumns:d,onPinnedColumnsChange:e=>{s&&s({...o,pinned_columns:e})}}):{rows:[],columns:[]},[u,d,o,s]);if(0===h.columns.length)return(0,i.jsx)(ni.M,{height:"100%",children:"No data"});let x=u&&null!==(t=u.limit)&&void 0!==t?t:0,p=x>0&&(null==u?void 0:u.more)?"Warning: Displayed results are limited to ".concat(x.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,f=null!=a?a:p;return(0,i.jsxs)(c.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[f&&(0,i.jsxs)(c.k,{borderBottom:"1px solid lightgray",alignItems:"center",gap:"5px",px:"10px",bg:p?"orange.100":"inherit",children:[p&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ny.a,{color:"orange.600",alignSelf:"center"})," ",(0,i.jsx)(l.x,{children:p})]}),(0,i.jsx)(m.L,{minHeight:"32px"}),a&&(0,i.jsx)(er.z,{marginBlock:"5px",size:"sm",colorScheme:"blue",onClick:()=>{a(r)},children:"Add to Checklist"})]}),(0,i.jsx)(nr,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:h.columns,rows:h.rows,renderers:{noRowsFallback:(0,i.jsx)(no,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})}),nI=(0,eY.G)((e,n)=>{var t,l,r;let{run:o,viewOptions:s,onViewOptionsChanged:a}=e,d=o.result,u=(0,b.useMemo)(()=>{var e;return null!==(e=null==s?void 0:s.pinned_columns)&&void 0!==e?e:[]},[s]),h=(0,b.useMemo)(()=>{var e;return null!==(e=null==s?void 0:s.display_mode)&&void 0!==e?e:"inline"},[s]),x=(null!==(l=null==d?void 0:null===(t=d.current)||void 0===t?void 0:t.columns)&&void 0!==l?l:[]).find(e=>"column_name"===e.name.toLowerCase()),m=null!==(r=null==x?void 0:x.name)&&void 0!==r?r:"column_name",p=(0,b.useMemo)(()=>nj(null==d?void 0:d.base,null==d?void 0:d.current,{primaryKeys:[m],pinnedColumns:u,onPinnedColumnsChange:e=>{a&&a({...s,pinned_columns:e})},displayMode:h}),[d,m,u,h,s,a]);return 0===p.columns.length?(0,i.jsx)(ni.M,{height:"100%",children:"No data"}):(0,i.jsxs)(c.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(nw,{run:o,children:(0,i.jsx)(n_,{displayMode:h,onDisplayModeChanged:e=>{a&&a({...s,display_mode:e})}})}),(0,i.jsx)(nr,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:p.columns,rows:p.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})}),nE=(0,eY.G)((e,n)=>{var t,l,r;let{run:o,viewOptions:s,onViewOptionsChanged:a}=e,d=o.result,u=null==d?void 0:d.current,h=(0,b.useMemo)(()=>{var e;return null!==(e=null==s?void 0:s.pinned_columns)&&void 0!==e?e:[]},[s]),x=(null!==(l=null==d?void 0:null===(t=d.current)||void 0===t?void 0:t.columns)&&void 0!==l?l:[]).find(e=>"column_name"===e.name.toLowerCase()),m=null!==(r=null==x?void 0:x.name)&&void 0!==r?r:"column_name",p=(0,b.useMemo)(()=>u?nz(u,{primaryKeys:[m],pinnedColumns:h,onPinnedColumnsChange:e=>{a&&a({...s,pinned_columns:e})}}):{columns:[],rows:[]},[u,h,m,s,a]);return 0===p.columns.length?(0,i.jsx)(ni.M,{height:"100%",children:"No data"}):(0,i.jsx)(c.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:(0,i.jsx)(nr,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:p.columns,rows:p.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})})});function nL(e){var n,t;let{name:r,columnStatus:s,onPrimaryKeyChange:a,onPinnedColumnsChange:d,...u}=e,h=null!==(n=u.primaryKeys)&&void 0!==n?n:[],x=null!==(t=u.pinnedColumns)&&void 0!==t?t:[],m=h.includes(r),p=x.includes(r);return"index"===r?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(c.k,{alignItems:"center",gap:"10px",className:"grid-header",children:[m&&(0,i.jsx)(o.J,{as:ns.MhP}),(0,i.jsx)(l.x,{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:r}),!m&&d&&(0,i.jsx)(o.J,{className:p?"unpin-icon":"pin-icon",display:p?"block":"none",cursor:"pointer",as:p?ns.$kI:ns.oJP,onClick:p?()=>{let e=x.filter(e=>e!==r);d&&d(e)}:()=>{let e=[...x,r];d&&d(e)}})]})}function nD(e,n,t){var l,r,o;let s=null!==(l=null==t?void 0:t.pinnedColumns)&&void 0!==l?l:[],a=null!==(r=null==t?void 0:t.changedOnly)&&void 0!==r&&r,d=null!==(o=null==t?void 0:t.displayMode)&&void 0!==o?o:"inline",c=[],u=function(e){let n={};return e.columns.map((e,t)=>{n[e.name]={index:t}}),n}(e),h={},x={};if(0===n.length)throw Error("Primary keys are required");let m=function(e,n){let t=[];for(let i of n){let n=e.findIndex(e=>e.name===i);if(n<0)throw Error("Column ".concat(i," not found"));t.push(n)}return t}(e.columns,n),p=(u.in_a||u.IN_A).index,f=(u.in_b||u.IN_B).index;e.data.forEach((n,t)=>{let i=function(e,n,t){let i={};if(0===n.length)return JSON.stringify({_index:t._index});for(let l of n)i[e[l].name]=t[l];return JSON.stringify(i)}(e.columns,m,n);n[p]&&(h[i]=n),n[f]&&(x[i]=n)});let g=na(Object.keys(h),Object.keys(x)),v={added:0,removed:0,modified:0},j=Object.entries(g).map(t=>{let[i,l]=t,r=h[i],o=x[i],s=JSON.parse(i);if(r&&e.columns.forEach((e,t)=>{n.includes(e.name)||(s["base__".concat(e.name)]=r[t])}),o&&e.columns.forEach((e,t)=>{n.includes(e.name)||(s["current__".concat(e.name)]=o[t])}),r){if(o)for(let[e,t]of Object.entries(u))!("index"===e||n.includes(e))&&(eJ().isEqual(r[t.index],o[t.index])||(s.__status="modified",t.status="modified"));else s.__status="removed",v.removed++}else s.__status="added",v.added++;return"modified"===s.__status&&v.modified++,s});a&&(j=j.filter(e=>"added"===e.__status||"removed"===e.__status||"modified"===e.__status));let y=(e,l)=>{var r,o;let s="added"===l?"diff-header-added":"removed"===l?"diff-header-removed":void 0;return"inline"===d?{headerCellClass:s,name:(0,i.jsx)(nL,{name:e,columnStatus:l,primaryKeys:n,...t}),key:e,renderCell:nv,size:"auto"}:{headerCellClass:s,name:(0,i.jsx)(nL,{name:e,columnStatus:l,primaryKeys:n,...t}),children:[{key:"base__".concat(e),name:null!==(r=null==t?void 0:t.baseTitle)&&void 0!==r?r:"Base",renderEditCell:nl.Ug,headerCellClass:s,cellClass:n=>{let t=n.__status;if("removed"===t)return"diff-cell-removed";if("added"===t)return"diff-cell-added";if("added"===l);else if("removed"===l);else if(!eJ().isEqual(n["base__".concat(e)],n["current__".concat(e)]))return"diff-cell-removed"},renderCell:ng,size:"auto"},{key:"current__".concat(e),name:null!==(o=null==t?void 0:t.currentTitle)&&void 0!==o?o:"Current",renderEditCell:nl.Ug,headerCellClass:s,cellClass:n=>{let t=n.__status;if("removed"===t)return"diff-cell-removed";if("added"===t)return"diff-cell-added";if("added"===l);else if("removed"===l);else if(!eJ().isEqual(n["base__".concat(e)],n["current__".concat(e)]))return"diff-cell-added"},renderCell:ng,size:"auto"}]}};return n.forEach(e=>{var l;let r=null!==(l=u[e].status)&&void 0!==l?l:"";c.push({key:e,name:(0,i.jsx)(nL,{name:e,columnStatus:r,primaryKeys:n,...t}),frozen:!0,cellClass:e=>{if(e.__status)return"diff-header-".concat(e.__status)},renderCell:ng})}),s.forEach(e=>{var t;let i=null!==(t=u[e].status)&&void 0!==t?t:"";n.includes(e)||c.push(y(e,i))}),Object.entries(u).forEach(e=>{var t;let[i,l]=e,r=null!==(t=l.status)&&void 0!==t?t:"";"in_a"===i||"in_b"===i||n.includes(i)||s.includes(i)||a&&v.modified>0&&"added"!==r&&"removed"!==r&&"modified"!==r||c.push(y(i,r))}),{columns:c,rows:j}}var nT=t(70549);let nO=e=>{let{changedOnly:n,onChange:t}=e;return(0,i.jsx)(nT.X,{size:"xs",isChecked:n,onChange:()=>{t()},children:"Changed only"})},nM=(e,n)=>{var t,l,r,o,s,a,d;let{run:u,onAddToChecklist:h,viewOptions:x,onViewOptionsChanged:m,baseTitle:p,currentTitle:f}=e,g=(0,b.useMemo)(()=>{var e;return null!==(e=null==x?void 0:x.primary_keys)&&void 0!==e?e:[]},[x]),v=(0,b.useMemo)(()=>{var e;return null!==(e=null==x?void 0:x.changed_only)&&void 0!==e&&e},[x]),j=(0,b.useMemo)(()=>{var e;return null!==(e=null==x?void 0:x.pinned_columns)&&void 0!==e?e:[]},[x]),y=(0,b.useMemo)(()=>{var e;return null!==(e=null==x?void 0:x.display_mode)&&void 0!==e?e:"inline"},[x]),w=(0,b.useMemo)(()=>{var e,n;return nj(null===(e=u.result)||void 0===e?void 0:e.base,null===(n=u.result)||void 0===n?void 0:n.current,{changedOnly:v,primaryKeys:g,onPrimaryKeyChange:e=>{m&&m({...x,primary_keys:e})},pinnedColumns:j,onPinnedColumnsChange:e=>{m&&m({...x,pinned_columns:e})},baseTitle:p,currentTitle:f,displayMode:y})},[u,x,v,g,j,y,m,p,f]),k=(0,b.useMemo)(()=>{let e=g.join(", ");return w.invalidPKeyBase&&w.invalidPKeyCurrent?"Warning: The primary key '".concat(e,"' is not unique in the base and current environments"):w.invalidPKeyBase?"Warning: The primary key '".concat(e,"' is not unique in the base environment"):w.invalidPKeyCurrent?"Warning: The primary key '".concat(e,"' is not unique in the current environment"):void 0},[w.invalidPKeyBase,w.invalidPKeyCurrent,g]),C=null!==(d=null===(l=u.result)||void 0===l?void 0:null===(t=l.current)||void 0===t?void 0:t.limit)&&void 0!==d?d:0,_=C>0&&((null===(o=u.result)||void 0===o?void 0:null===(r=o.current)||void 0===r?void 0:r.more)||(null===(a=u.result)||void 0===a?void 0:null===(s=a.base)||void 0===s?void 0:s.more))?"Warning: Displayed results are limited to ".concat(C.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,S=[];return(k&&S.push(k),_&&S.push(_),0===w.columns.length)?(0,i.jsx)(ni.M,{height:"100%",children:"No data"}):(0,i.jsxs)(c.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsxs)(nw,{run:u,viewOptions:x,onViewOptionsChanged:m,warnings:S,children:[(0,i.jsx)(n_,{displayMode:y,onDisplayModeChanged:e=>{m&&m({...x,display_mode:e})}}),(0,i.jsx)(nO,{changedOnly:null==x?void 0:x.changed_only,onChange:()=>{let e=!(null==x?void 0:x.changed_only);m&&m({...x,changed_only:e})}})]}),(0,i.jsx)(nr,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:w.columns,rows:w.rows,renderers:{noRowsFallback:(0,i.jsx)(no,{emptyMessage:"No mismatched rows"})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})},nA=(e,n)=>{var t,l,r,o,s;let{run:a,viewOptions:d,onViewOptionsChanged:u,baseTitle:h,currentTitle:x}=e,m=(0,b.useMemo)(()=>{var e;return null!==(e=null==d?void 0:d.changed_only)&&void 0!==e&&e},[d]),p=(0,b.useMemo)(()=>{var e;return null!==(e=null==d?void 0:d.pinned_columns)&&void 0!==e?e:[]},[d]),f=(0,b.useMemo)(()=>{var e;return null!==(e=null==d?void 0:d.display_mode)&&void 0!==e?e:"inline"},[d]),g=(0,b.useMemo)(()=>{var e,n;if(!(null===(e=a.result)||void 0===e?void 0:e.diff)||!(null===(n=a.params)||void 0===n?void 0:n.primary_keys))return{columns:[],rows:[]};let t=a.params.primary_keys;return nD(a.result.diff,t,{changedOnly:m,pinnedColumns:p,onPinnedColumnsChange:e=>{u&&u({...d,pinned_columns:e})},baseTitle:h,currentTitle:x,displayMode:f})},[a,d,m,p,f,u,h,x]),v=null!==(s=null===(l=a.result)||void 0===l?void 0:null===(t=l.diff)||void 0===t?void 0:t.limit)&&void 0!==s?s:0,j=v>0&&(null===(o=a.result)||void 0===o?void 0:null===(r=o.diff)||void 0===r?void 0:r.more)?"Warning: Displayed results are limited to ".concat(v.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,y=[];return(j&&y.push(j),0===g.columns.length)?(0,i.jsx)(ni.M,{height:"100%",children:"No data"}):m&&0===g.rows.length?(0,i.jsxs)(c.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(nw,{run:a,viewOptions:d,onViewOptionsChanged:u,warnings:y}),(0,i.jsx)(ni.M,{height:"100%",children:"No change"})]}):(0,i.jsxs)(c.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsxs)(nw,{run:a,viewOptions:d,onViewOptionsChanged:u,warnings:y,children:[(0,i.jsx)(n_,{displayMode:f,onDisplayModeChanged:e=>{u&&u({...d,display_mode:e})}}),(0,i.jsx)(nO,{changedOnly:null==d?void 0:d.changed_only,onChange:()=>{let e=!(null==d?void 0:d.changed_only);u&&u({...d,changed_only:e})}})]}),(0,i.jsx)(nr,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:g.columns,rows:g.rows,renderers:{noRowsFallback:(0,i.jsx)(no,{emptyMessage:"No mismatched rows"})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})},nN=(0,eY.G)((e,n)=>{var t;let l,r;if(e.run.params&&e.run.params.current_model&&(l="Original",r="Editor"),(null===(t=e.run.result)||void 0===t?void 0:t.diff)!=null){let t=(0,eY.G)(nA);return(0,i.jsx)(t,{...e,ref:n,baseTitle:l,currentTitle:r})}{let t=(0,eY.G)(nM);return(0,i.jsx)(t,{...e,ref:n,baseTitle:l,currentTitle:r})}});function nF(e,n){if(e<n){let t=(n-e)/e*100;return"+".concat(t>=.1?t.toFixed(1):" <0.1 ","%")}if(!(e>n))return"0 %";{let t=(e-n)/e*100;return"-".concat(t>=.1?t.toFixed(1):" <0.1 ","%")}}var nq=t(54483),nH=t.n(nq);let nP=(0,eY.G)(function(e,n){var t,l;let{run:r}=e;function o(e){if(e.base===e.current);else if(e.base<e.current||"N/A"===e.base)return"column-body-added";else if(e.base>e.current||"N/A"===e.current)return"column-body-removed";return"column-body-normal"}let s=null!==(t=r.result)&&void 0!==t?t:{},a=Object.keys(null!==(l=r.result)&&void 0!==l?l:{}).map(e=>{let n=s[e],t=nH()(n.base)?n.base:null,i=nH()(n.curr)?n.curr:null,l="=";return null!==t&&null!==i?l=t!==i?nF(t,i):"=":t===i?l="N/A":null===t?l="Added":null===i&&(l="Removed"),{name:e,base:null===t?"N/A":Number(t),current:null===i?"N/A":Number(i),delta:l}});return 0===a.length?(0,i.jsx)(ni.M,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"}):(0,i.jsx)(c.k,{direction:"column",children:Object.keys(s).length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(nr,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:[{key:"name",name:"Name",cellClass:o},{key:"base",name:"Base Rows",cellClass:o},{key:"current",name:"Current Rows",cellClass:o},{key:"delta",name:"Delta",cellClass:o}],rows:a,renderers:{noRowsFallback:(0,i.jsx)(no,{})},className:"rdg-light",enableScreenshot:!0})})})}),nV=(0,eY.G)(function(e,n){var t,l;let{run:r}=e,o=null!==(t=r.result)&&void 0!==t?t:{},s=Object.keys(null!==(l=r.result)&&void 0!==l?l:{}).map(e=>{let n=o[e],t=nH()(n.curr)?n.curr:null;return{name:e,current:null===t?"N/A":Number(t)}});return 0===s.length?(0,i.jsx)(ni.M,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"}):(0,i.jsx)(c.k,{direction:"column",children:Object.keys(o).length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(nr,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:[{key:"name",name:"Name"},{key:"current",name:"Row Count"}],rows:s,renderers:{noRowsFallback:(0,i.jsx)(no,{})},className:"rdg-light",enableScreenshot:!0})})})});var nW=t(81145),nK=t(38622);let nJ="#63B3ED";function nB(e,n){let t=n?10:e.counts.length,i=e.counts.slice(0,t),l=e.valids-i.reduce((e,n)=>e+n,0);return e.values.slice(0,t).concat([l]).map((n,t)=>{var r;let o;let s=t===i.length,a=s?l:i[t],d=!1;return s?(o="(others)",d=!0):null==n?(o="(null)",d=!0):"string"==typeof n&&0===n.length?(o="(empty)",d=!0):o=String(n),{isLastItemOthers:s,isSpecialLabel:d,label:o,count:a,displayCount:e5(a),displayRatio:null!==(r=e1(a/e.valids))&&void 0!==r?r:"N/A"}})}function nU(e){let{base:n,current:t,children:r}=e;return(0,i.jsx)(nW.u,{label:(0,i.jsxs)(l.x,{children:[(0,i.jsxs)(ei.x,{children:[(0,i.jsx)(e9,{color:e2}),"Current: ",t.count," (",t.displayRatio,")"]}),(0,i.jsxs)(ei.x,{children:[(0,i.jsx)(e9,{color:e4}),"Base: ",n.count," (",n.displayRatio,")"]})]}),placement:"auto",hasArrow:!0,children:r})}function nQ(e){let{topKDiff:n,isDisplayTopTen:t}=e,r=nB(n.current,t),o=nB(n.base,t);return(0,i.jsxs)(l.x,{w:"100%",px:20,py:4,children:[(0,i.jsxs)(c.k,{alignItems:"center",direction:"row",children:[(0,i.jsx)(m.L,{}),(0,i.jsxs)(ei.x,{as:"h3",size:"sm",p:"2",color:"gray",children:[(0,i.jsx)(e9,{color:e4})," Base"]}),(0,i.jsxs)(ei.x,{as:"h3",size:"sm",p:"2",color:"gray",children:[(0,i.jsx)(e9,{color:e2})," Current"]}),(0,i.jsx)(m.L,{})]}),r.map((e,t)=>{let l=o[t];return e.isLastItemOthers&&0===e.count&&0===l.count?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(b.Fragment,{children:[(0,i.jsx)(nU,{base:l,current:e,children:(0,i.jsxs)(c.k,{alignItems:"center",width:"100%",_hover:{bg:"blackAlpha.300"},px:4,children:[(0,i.jsx)(ei.x,{noOfLines:1,width:"10em",fontSize:"sm",color:e.isSpecialLabel?"gray.400":"inherit",children:e.label}),(0,i.jsxs)(c.k,{width:"70%",direction:"column",children:[(0,i.jsxs)(c.k,{height:"1em",children:[(0,i.jsx)(nZ,{topkCount:e.count,topkLabel:e.label,valids:n.current.valids,color:e2}),(0,i.jsx)(ei.x,{ml:5,mr:2,fontSize:"sm",width:"6em",children:e.displayCount}),(0,i.jsx)(ei.x,{color:"gray.400",fontSize:"sm",width:"4em",children:e.displayRatio})]}),(0,i.jsxs)(c.k,{height:"1em",children:[(0,i.jsx)(nZ,{topkCount:l.count,topkLabel:l.label,valids:n.base.valids,color:e4}),(0,i.jsx)(ei.x,{ml:5,mr:2,fontSize:"sm",width:"6em",children:l.displayCount}),(0,i.jsx)(ei.x,{color:"gray.400",fontSize:"sm",width:"4em",children:l.displayRatio})]})]})]})}),(0,i.jsx)(nK.i,{})]},t)})]})}function nZ(e){let{topkCount:n,topkLabel:t,valids:l,animation:r=!1,color:o=nJ}=e;e$.kL.register(e$.uw,e$.ZL,e$.f$);let s=function(e,n){let{...t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{display:!1,max:n,grid:{display:!1}},y:{display:!1}},plugins:{tooltip:{enabled:!1}},...t}}(n,l,{animation:r}),a=function(e){let{topkLabel:n,topkCount:t,color:i=nJ}=e;return{labels:[n],datasets:[{indexAxis:"y",data:[t],backgroundColor:i,hoverBackgroundColor:i,borderWidth:0,borderColor:i,barPercentage:1,categoryPercentage:.6}]}}({topkCount:n,topkLabel:t,color:o});return(0,i.jsx)(e0.$Q,{data:a,options:s,plugins:[]})}let nX=(0,eY.G)((e,n)=>{let{run:t}=e,[l,o]=(0,b.useState)(!0),s=t.result,a=t.params,d=s.base,u=s.current;return(0,i.jsxs)(c.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(nn,{ref:n,blockSize:"auto",children:[(0,i.jsxs)(h.X,{as:"h1",size:"md",paddingTop:4,textAlign:"center",color:"gray.600",children:["Model ",a.model,".",a.column_name]}),(0,i.jsxs)(x.U,{children:[(0,i.jsx)(m.L,{}),(0,i.jsx)(nQ,{topKDiff:s,valids:u.valids||0,isDisplayTopTen:l}),(0,i.jsx)(m.L,{})]})]}),(0,i.jsx)(m.L,{}),(d.values.length>10||u.values.length>10)&&(0,i.jsx)(c.k,{p:5,justify:"start",children:(0,i.jsx)(r.r,{onClick:()=>{o(e=>!e)},textColor:"blue.500",children:l?"View More Items":"View Only Top-10"})})]})}),nG=(0,eY.G)((e,n)=>{var t,l,r;let{run:o,onAddToChecklist:s,viewOptions:a,onViewOptionsChanged:d}=e,u=(0,b.useMemo)(()=>{var e;return null!==(e=null==a?void 0:a.changed_only)&&void 0!==e&&e},[a]),h=(0,b.useMemo)(()=>{var e;return null!==(e=null==a?void 0:a.pinned_columns)&&void 0!==e?e:[]},[a]),x=(0,b.useMemo)(()=>{var e;return null!==(e=null==a?void 0:a.display_mode)&&void 0!==e?e:"inline"},[a]),m=(0,b.useMemo)(()=>{var e;if(!o.result||!(null===(e=o.params)||void 0===e?void 0:e.primary_key))return{columns:[],rows:[]};let n=o.params.primary_key,t=Array.isArray(n)?n:[n];return nD(o.result,t,{changedOnly:u,pinnedColumns:h,onPinnedColumnsChange:e=>{d&&d({...a,pinned_columns:e})},displayMode:x})},[o,a,u,h,x,d]),p=null!==(r=null===(t=o.result)||void 0===t?void 0:t.limit)&&void 0!==r?r:0,f=p>0&&(null===(l=o.result)||void 0===l?void 0:l.more)?"Warning: Displayed results are limited to ".concat(p.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,g=[];return(f&&g.push(f),0===m.columns.length)?(0,i.jsx)(ni.M,{height:"100%",children:"No data"}):u&&0===m.rows.length?(0,i.jsxs)(c.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(nw,{run:o,viewOptions:a,onViewOptionsChanged:d,warnings:g}),(0,i.jsx)(ni.M,{height:"100%",children:"No change"}),";"]}):(0,i.jsxs)(c.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsxs)(nw,{run:o,viewOptions:a,onViewOptionsChanged:d,warnings:g,children:[(0,i.jsx)(n_,{displayMode:x,onDisplayModeChanged:e=>{d&&d({...a,display_mode:e})}}),(0,i.jsx)(nO,{changedOnly:null==a?void 0:a.changed_only,onChange:()=>{let e=!(null==a?void 0:a.changed_only);d&&d({...a,changed_only:e})}})]}),(0,i.jsx)(nr,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:m.columns,rows:m.rows,renderers:{noRowsFallback:(0,i.jsx)(no,{emptyMessage:"No mismatched rows"})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})});var nY=t(87452),n$=t(88605);function n0(e){var n;let{params:t,onParamsChanged:r,setIsReadyToExecute:o}=e,[s,a]=(0,b.useState)(!t.columns||0===t.columns.length),d=t.model,c=t.primary_key,{columns:u,primaryKey:h,isLoading:x,error:m}=eU(t.model);(0,b.useEffect)(()=>{!c&&h&&r({...t,primary_key:h})},[c,h,t,r]),(0,b.useEffect)(()=>{o(!!c&&!!d)},[c,d,o]);let p=u.map(e=>e.name),f=Array.isArray(c)?c:c?[c]:void 0;return x?(0,i.jsx)(l.x,{children:"Loading..."}):0===p.length||m?(0,i.jsx)(l.x,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsxs)(nb.g,{gap:5,m:"8px 24px",paddingBottom:"200px",children:[(0,i.jsxs)(eP.NI,{children:[(0,i.jsx)(eV.l,{children:"Model"}),(0,i.jsx)(nY.I,{isReadOnly:!0,value:t.model})]}),(0,i.jsxs)(eP.NI,{children:[(0,i.jsx)(eV.l,{children:"Primary key"}),(0,i.jsx)(n$.Ph,{placeholder:"Select primary key",isMulti:!0,closeMenuOnSelect:!1,options:p.map(e=>({label:e,value:e})),value:(null!=f?f:[]).map(e=>({label:e,value:e})),onChange:e=>{r({...t,primary_key:1==e.length?e[0].value:e.map(e=>e.value)})}})]}),(0,i.jsxs)(eP.NI,{children:[(0,i.jsx)(eV.l,{children:"Columns"}),(0,i.jsx)(nT.X,{marginBottom:"10px",isChecked:s,onChange:e=>{a(e.target.checked),r({...t,columns:void 0})},children:"All columns"}),!s&&(0,i.jsx)(n$.Ph,{isMulti:!0,closeMenuOnSelect:!1,options:p.map(e=>({label:e,value:e})),value:(null!==(n=t.columns)&&void 0!==n?n:[]).map(e=>({label:e,value:e})),onChange:e=>{let n;let i=e.map(e=>e.value);n=0===i.length?void 0:i,r({...t,columns:n})}})]})]})}var n1=t(91504),n5=t(76421),n2=t(72669),n4=t(12353),n6=t(64871),n3=t(31319);async function n9(){return(await U.get("/api/instance-info")).data}let n8=()=>(0,w.a)({queryKey:q.instanceInfo(),queryFn:n9}),n7=(0,b.createContext)({readOnly:!1,singleEnv:!1,authed:!1,lifetimeExpiredAt:void 0});function te(e){let{children:n}=e,{data:t,isLoading:l}=n8(),[r,o]=(0,b.useState)(!1),[s,a]=(0,b.useState)(!1),[d,c]=(0,b.useState)(!1),[u,h]=(0,b.useState)();return(0,b.useEffect)(()=>{!l&&t&&(o(t.read_only),a(t.single_env),c(t.authed),t.lifetime_expired_at&&(h(new Date(t.lifetime_expired_at)),console.log("lifetime expired at",t.lifetime_expired_at)))},[t,l]),(0,i.jsx)(n7.Provider,{value:{readOnly:r,singleEnv:s,authed:d,lifetimeExpiredAt:u},children:n})}let tn=()=>(0,b.useContext)(n7);function tt(e){let{params:n,column:t}=e,{runAction:r}=th(),{readOnly:s}=tn(),a=(e,t)=>{r("value_diff_detail",{...n,...e},t)};return(0,i.jsxs)(c.k,{children:[(0,i.jsx)(l.x,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t}),(0,i.jsx)(m.L,{}),(0,i.jsx)(n1.v,{isLazy:!0,children:e=>{let{isOpen:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n5.j,{className:"row-context-menu",visibility:n?"visible":"hidden",width:n?"auto":"0px",minWidth:n?"auto":"0px",as:nu.h,icon:(0,i.jsx)(o.J,{as:ns.D_A}),variant:"unstyled",size:"sm",isDisabled:s}),(0,i.jsx)(n2.h,{children:(0,i.jsx)(n4.q,{lineHeight:"20px",children:(0,i.jsxs)(n6.k,{title:"Action",as:l.x,fontSize:"8pt",children:[(0,i.jsx)(n3.s,{fontSize:"10pt",onClick:()=>{a({},{showForm:!0})},children:"Show mismatched values..."}),(0,i.jsxs)(n3.s,{fontSize:"10pt",onClick:()=>{a({columns:[t]},{showForm:!1})},children:["Show mismatched values for '",t,"'"]})]})})})]})}})]})}let ti=(0,eY.G)(function(e,n){let{run:t}=e,r=t.result,s=t.params,a=e=>{let n=e[2];return null!=n&&n<1?"diff-cell-modified":""},d=Array.isArray(s.primary_key)?s.primary_key:[s.primary_key],u=[{key:"__is_pk__",name:"",width:30,maxWidth:30,renderCell:e=>{let{row:n}=e;return(0,i.jsx)(ni.M,{height:"100%",children:d.includes(n[0])&&(0,i.jsx)(o.J,{as:ns.MhP})})}},{key:"0",name:"Column",resizable:!0,renderCell:e=>{let{row:n,column:t}=e;return(0,i.jsx)(tt,{column:n[t.key],params:s})},cellClass:"cell-show-context-menu"},{key:"1",name:"Matched",resizable:!0,cellClass:a},{key:"2",name:"Matched %",resizable:!0,renderCell:e=>{let{column:n,row:t}=e,r=t[n.key];return(0,i.jsx)(l.x,{textAlign:"end",children:null!=r?"".concat((100*r).toFixed(2)," %"):"N/A"})},cellClass:a}];return(0,i.jsxs)(c.k,{direction:"column",gap:"5px",pt:"5px",height:"100%",children:[(0,i.jsxs)(l.x,{px:"16px",children:["Model: ",s.model,", ",r.summary.total," total (",r.summary.total-r.summary.added-r.summary.removed," common,"," ",r.summary.added," added, ",r.summary.removed," removed)"]}),(0,i.jsx)(nr,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",borderBlock:"1px solid lightgray"},columns:u,rows:r.data.data,renderers:{noRowsFallback:(0,i.jsx)(no,{})},defaultColumnOptions:{resizable:!0},className:"rdg-light",enableScreenshot:!0})]})});var tl=t(23799),tr=t(68566);function to(e){var n;let{params:t,onParamsChanged:r,setIsReadyToExecute:o}=e,[s,a]=(0,b.useState)(!t.columns||0===t.columns.length),d=t.model,{columns:c,isLoading:u,error:h}=eU(t.model);(0,b.useEffect)(()=>{o(!!d)},[d,o]);let x=c.map(e=>e.name);return u?(0,i.jsx)(l.x,{children:"Loading..."}):0===x.length||h?(0,i.jsx)(l.x,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsxs)(nb.g,{gap:5,m:"8px 24px",paddingBottom:"200px",children:[(0,i.jsxs)(eP.NI,{children:[(0,i.jsx)(eV.l,{children:"Model"}),(0,i.jsx)(nY.I,{isReadOnly:!0,value:t.model})]}),(0,i.jsxs)(eP.NI,{children:[(0,i.jsx)(eV.l,{children:"Columns"}),(0,i.jsx)(nT.X,{marginBottom:"10px",isChecked:s,onChange:e=>{a(e.target.checked),r({...t,columns:void 0})},children:"All columns"}),!s&&(0,i.jsx)(n$.Ph,{isMulti:!0,closeMenuOnSelect:!1,options:x.map(e=>({label:e,value:e})),value:(null!==(n=t.columns)&&void 0!==n?n:[]).map(e=>({label:e,value:e})),onChange:e=>{let n;let i=e.map(e=>e.value);n=0===i.length?void 0:i,r({...t,columns:n})}})]})]})}let ts={lineage_diff:{title:"Lineage Diff",icon:eH.Ks7},schema_diff:{title:"Schema Diff",icon:tr.C8A},query:{title:"Query",icon:eH.r2i,RunResultView:nR},query_base:{title:"Query Base",icon:eH.r2i,RunResultView:nR},query_diff:{title:"Query Diff",icon:eH.r2i,RunResultView:nN},row_count:{title:"Row Count",icon:tr.QUK,RunResultView:nV},row_count_diff:{title:"Row Count Diff",icon:tr.QUK,RunResultView:nP},profile:{title:"Profile",icon:eH.KA6,RunResultView:nE,RunForm:to},profile_diff:{title:"Profile Diff",icon:eH.KA6,RunResultView:nI,RunForm:to},value_diff:{title:"Value Diff",icon:eH.pRi,RunResultView:ti,RunForm:n0},value_diff_detail:{title:"Value Diff Detail",icon:eH.pRi,RunResultView:nG,RunForm:n0},top_k_diff:{title:"Top-K Diff",icon:tl.Pkc,RunResultView:nX,RunForm:function(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:r}=e,{columns:o,isLoading:s,error:a}=eU(n.model),d=o.map(e=>e.name);return((0,b.useEffect)(()=>{r(!!n.column_name)},[n,r]),s)?(0,i.jsx)(l.x,{children:"Loading..."}):0===d.length||a?(0,i.jsx)(l.x,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsx)(l.x,{m:"16px",children:(0,i.jsxs)(eP.NI,{children:[(0,i.jsx)(eV.l,{children:"Pick a column to show top-k"}),(0,i.jsx)(eW.P,{placeholder:"Select column",value:n.column_name,onChange:e=>{let i=e.target.value;t({...n,column_name:i})},children:d.map(e=>(0,i.jsx)("option",{value:e,children:e},e))})]})})}},histogram_diff:{title:"Histogram Diff",icon:eH.dku,RunResultView:nt,RunForm:function(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:r}=e,{columns:o,isLoading:s,error:a}=eU(n.model),d=o.filter(e=>!eQ(e.type)&&!eZ(e.type)&&!eX(e.type));return s?(0,i.jsx)(l.x,{children:"Loading..."}):0===o.length||a?(0,i.jsx)(l.x,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsx)(l.x,{m:"16px",children:(0,i.jsxs)(eP.NI,{children:[(0,i.jsx)(eV.l,{children:"Pick a column to show Histogram Diff"}),(0,i.jsx)(eW.P,{placeholder:0!==d.length?"Select column":"No numeric column is available",isDisabled:0===d.length,value:n.column_name,onChange:e=>{var i,l;let o=e.target.value;r(!!o);let s=null!==(l=null===(i=d.find(e=>e.name===o))||void 0===i?void 0:i.type)&&void 0!==l?l:"";t({...n,column_name:o,column_type:s})},children:d.map(e=>(0,i.jsxs)("option",{value:e.name,children:[e.name," : ",e.type]},e.name))})]})})}},sandbox:{title:"Sandbox",icon:eH.iQd}},ta=e=>ts[e],td=(0,b.createContext)({runAction:()=>{},showRunId:e=>{},isRunResultOpen:!1,closeRunResult:()=>{},isHistoryOpen:!1,closeHistory:()=>{},showHistory:()=>{},clearRunResult:()=>{}}),tc=e=>{let[n]=(0,eq.TH)();(0,b.useEffect)(()=>{e()},[e,n])};function tu(e){var n;let{children:t}=e,[l,r]=(0,b.useState)(),{isOpen:o,onOpen:a,onClose:d}=(0,G.q)(),{isOpen:c,onOpen:u,onClose:h}=(0,G.q)(),{isOpen:x,onOpen:m,onClose:p}=(0,G.q)(),f=(0,s.p)(),[g,v]=(0,b.useState)(),[j,y]=(0,eq.TH)(),w=(0,k.NL)(),C=(0,b.useCallback)(async(e,n)=>{v(e),u(),!1!==n&&await w.invalidateQueries({queryKey:q.runs()})},[v,u,w]),_=(0,b.useCallback)(()=>{v(void 0),h()},[h,v]),S=(0,b.useCallback)(async(e,n,t)=>{try{let i;let l=new Date().getTime().toString();if(null==t?void 0:t.showLast){let t=await eS(e,n,1);1===t.length&&(i=t[0])}let o=ta(e);if(void 0===o)throw Error("Unknown run type: ".concat(e));let{title:s,RunResultView:d,RunForm:c}=o;if(void 0===d)throw Error("Run type ".concat(e," does not have a result view"));if(void 0!=c&&(null==t?void 0:t.showForm))r({session:l,title:s,type:e,params:n,lastRun:i,options:t,RunForm:c}),a();else{let{run_id:t}=await ew(e,n,{nowait:!0});await C(t),await w.invalidateQueries({queryKey:q.runs()}),j.startsWith("/lineage")&&y("/lineage")}}catch(e){f({title:"Failed to submit a run",description:null==e?void 0:e.message,position:"bottom-right",status:"error",duration:5e3,isClosable:!0})}},[r,a,C,f,j,y,w]);tc(d);let z=async(e,n)=>{try{d();let{run_id:t}=await ew(e,n,{nowait:!0});await C(t)}catch(e){f({title:"Failed to submit a run",description:null==e?void 0:e.message,position:"bottom-right",status:"error",duration:5e3,isClosable:!0})}};return(0,i.jsxs)(td.Provider,{value:{runAction:S,runId:g,showRunId:C,isRunResultOpen:c,closeRunResult:h,isHistoryOpen:x,closeHistory:p,showHistory:m,clearRunResult:_},children:[l&&(0,i.jsx)(eF,{isOpen:o,onClose:d,onExecute:z,title:l.title,type:l.type,params:l.params,initialRun:l.lastRun,RunForm:(null===(n=l.options)||void 0===n?void 0:n.showForm)&&l.RunForm?l.RunForm:void 0},l.session),t]})}let th=()=>(0,b.useContext)(td),tx=(0,b.createContext)({latestSelectedCheckId:"",setLatestSelectedCheckId:()=>{}});function tm(e){let{children:n}=e,[t,l]=b.useState("");return(0,i.jsx)(tx.Provider,{value:{setLatestSelectedCheckId:l,latestSelectedCheckId:t},children:n})}let tp=()=>(0,b.useContext)(tx);var tf=t(61683);async function tg(e){return(await U.post("/api/save-as",e)).data}async function tv(e){return(await U.post("/api/rename",e)).data}async function tj(){return(await U.post("/api/export")).data}async function ty(e,n){let t=new FormData;return t.append("file",e),t.append("checks_only",(!!n).toString()),(await U.post("/api/import",t)).data}async function tb(){return 208===(await U.get("/api/sync")).status}async function tw(e){try{let n=await U.post("/api/sync",e);if(202===n.status)return{status:"accepted"};if(208===n.status)return{status:"syncing"}}catch(e){if((0,tf.IZ)(e)&&e.response&&409===e.response.status)return{status:"conflict"}}throw Error("Failed to sync state")}async function tk(){return(await U.post("/api/share")).data}let tC=(0,b.createContext)(void 0);function t_(e){let{children:n}=e,[t,l]=(0,b.useState)(),[r,o]=(0,b.useState)(!1),[s,a]=(0,b.useState)(),d=async()=>{o(!0),a(void 0),l(void 0);try{let e=await tk();if("success"!==e.status){a(e.message);return}l(e.share_url)}catch(e){a(e.message)}finally{o(!1)}};return(0,i.jsx)(tC.Provider,{value:{shareUrl:t,isLoading:r,error:s,handleShareClick:d},children:n})}let tS=()=>{let e=(0,b.useContext)(tC);if(!e)throw Error("useRecceShareStateContext must be used within a RecceShareStateContextProvider");return e};function tz(e){let{children:n}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(te,{children:(0,i.jsx)(t_,{children:(0,i.jsx)(S,{children:(0,i.jsx)(eO,{children:(0,i.jsx)(I,{children:(0,i.jsx)(tu,{children:(0,i.jsx)(tm,{children:n})})})})})})})})}async function tR(e,n){let t=eg?{breaking_change_analysis:!0}:{};return(await U.post("/api/checks",{run_id:e,view_options:n,track_props:t})).data}async function tI(){return(await U.get("/api/checks")).data}async function tE(e){return(await U.get("/api/checks/".concat(e))).data}async function tL(e,n){return(await U.patch("/api/checks/".concat(e),n)).data}async function tD(e){return(await U.delete("/api/checks/".concat(e))).data}async function tT(e){return await U.post("/api/checks/reorder",e)}var tO=t(30220),tM=t(43400),tA=t(28469),tN=t(17658),tF=t(76569),tq=t(73463),tH=t(50056),tP=t(68156),tV=t(36387),tW=t(66197),tK=t(5210),tJ=t(98972),tB=t(48736),tU=t(82598);function tQ(e){let{name:n,setName:t}=e,[r,o]=(0,b.useState)(!1),[s,a]=(0,b.useState)(n),d=(0,b.useRef)(null),c=(0,b.useCallback)(()=>{t(s),o(!1)},[t,o,s]);return(0,b.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&c()};return r&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[r,d,c]),(0,i.jsx)(tJ.a,{flex:"0 1 auto",fontSize:"12pt",fontWeight:"500",separator:(0,i.jsx)(tU.X,{color:"gray.500"}),overflow:"hidden",children:(0,i.jsx)(tB.g,{cursor:"pointer",flex:"0 1 auto",overflow:"hidden",children:r?(0,i.jsx)(nY.I,{ref:d,value:s,onChange:e=>{a(e.target.value)},onKeyDown:e=>{"Enter"===e.key?(t(s),o(!1)):"Escape"===e.key&&(a(n),o(!1))},size:"sm",w:"100%"}):(0,i.jsx)(l.x,{flex:"0 1 auto",onClick:()=>{a(n),o(!0)},textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n})})})}var tZ=t(46842);t(90345);let tX=(0,b.createContext)(void 0),tG=()=>{let e=(0,b.useContext)(tX);if(!e)throw Error("useLineageViewContext must be used within a LineageViewProvider");return e},tY=()=>(0,b.useContext)(tX);function t$(e){let{model:n,name:t,baseType:r,currentType:s,singleEnv:a}=e,{runAction:d}=th(),{readOnly:u}=tn(),h=tY(),{isActionAvailable:x}=eM(),p=null!=s?s:r,[f,g]=(0,b.useState)(!1),v=()=>{d("profile_diff",{model:n.name,columns:[t]},{showForm:!1})},j=()=>{d("histogram_diff",{model:n.name,column_name:t,column_type:p},{showForm:!1})},y=()=>{d("top_k_diff",{model:n.name,column_name:t,k:50},{showForm:!1})},w=!r||!s,k=async()=>{ev({action:"view",source:"schema_column"}),g(!0),await (null==h?void 0:h.showColumnLevelLineage(n.id,t)),g(!1)};return(0,i.jsxs)(c.k,{alignItems:"center",gap:"3px",children:[(0,i.jsx)(l.x,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t}),(0,i.jsx)(m.L,{}),h&&(0,i.jsx)(nW.u,{label:"Show Lineage",children:(0,i.jsx)(nu.h,{icon:(0,i.jsx)(tl.Lr9,{}),"aria-label":"",className:"row-context-menu",visibility:"hidden",width:"0px",minWidth:"0px",variant:"unstyled",size:"sm",color:"gray",_hover:{color:"black"},onClick:k,isLoading:f})}),!a&&"source"!==n.resource_type&&(0,i.jsx)(n1.v,{children:e=>{let{isOpen:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n5.j,{className:"row-context-menu",visibility:n?"visible":"hidden",width:n?"auto":"0px",minWidth:n?"auto":"0px",as:nu.h,icon:(0,i.jsx)(o.J,{as:ns.D_A}),variant:"unstyled",size:"sm",color:"gray",_hover:{color:"black"},isDisabled:u}),(0,i.jsx)(n2.h,{children:(0,i.jsx)(n4.q,{lineHeight:"20px",children:(0,i.jsxs)(n6.k,{title:"Diff",m:"0",p:"4px 12px",children:[(0,i.jsx)(n3.s,{fontSize:"10pt",onClick:v,isDisabled:w||!x("profile_diff"),children:"Profile Diff"}),(0,i.jsx)(n3.s,{fontSize:"10pt",onClick:j,isDisabled:w||!p||!eG(p),children:"Histogram Diff"}),(0,i.jsx)(n3.s,{fontSize:"10pt",onClick:y,isDisabled:w,children:"Top-k Diff"})]})})})]})}})]})}function t0(e,n){function t(e){return void 0===e.baseIndex?"column-index-added":void 0===e.currentIndex?"column-index-removed":!0===e.reordered?"column-index-reordered":"column-index-normal"}function l(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":e.baseType!==e.currentType?"column-body-type-changed":!0===e.reordered?"column-body-reordered":"column-body-normal"}return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:t},{key:"currentIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:t},{key:"name",name:"Name",resizable:!0,renderCell:e=>{let{row:t,column:l}=e;return n?(0,i.jsx)(t$,{model:n,name:t.name,baseType:t.baseType,currentType:t.currentType}):t.name},cellClass:function(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":!0===e.reordered?"column-body-reordered":"column-body-normal"}},{key:"baseType",name:"Base Type",resizable:!0,cellClass:l},{key:"currentType",name:"Current Type",resizable:!0,cellClass:l}],rows:Object.values(e)}}var t1=t(18422),t5=t(49956);let t2=(0,b.forwardRef)(function(e,n){let t,l,{base:r,current:o,enableScreenshot:s=!1}=e,{columns:a,rows:d}=(0,b.useMemo)(()=>{var e;let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={};return Object.entries(na(Object.keys(e),Object.keys(n))).forEach(e=>{let[n,i]=e;t[n]={name:n,reordered:"reordered"===i}}),Object.entries(e).map((e,n)=>{let[i,l]=e;t[i].baseIndex=n+1,t[i].baseType=l.type}),Object.entries(n).map((e,n)=>{let[i,l]=e;t[i].currentIndex=n+1,t[i].currentType=l.type}),t}(null==r?void 0:r.columns,null==o?void 0:o.columns),t=null!==(e=null==o?void 0:o.resource_type)&&void 0!==e?e:null==r?void 0:r.resource_type;return t&&["model","seed","snapshot","source"].includes(t)?t0(n,null!=o?o:r):t0(n)},[r,o]),{lineageGraph:u}=eM(),h=!(null==u?void 0:u.catalogMetadata.base),x=!(null==u?void 0:u.catalogMetadata.current);h&&x?t="catalog.json is missing on both current and base environments.":h?t="catalog.json is missing on base environment.":x&&(t="catalog.json is missing on current environment.");let m=r&&void 0===r.columns,p=o&&void 0===o.columns;return m&&p?l="Schema information is missing on both current and base environments.":m?l="Schema information is missing on base environment.":p&&(l="Schema information is missing on current environment."),(0,i.jsxs)(c.k,{direction:"column",children:[t?(0,i.jsxs)(t1.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(t5.z,{}),t]}):l?(0,i.jsxs)(t1.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(t5.z,{}),l]}):(0,i.jsx)(i.Fragment,{}),d.length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(nr,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:a,rows:d,renderers:{noRowsFallback:(0,i.jsx)(no,{})},className:"rdg-light",enableScreenshot:s,ref:n})})]})}),t4=(0,b.forwardRef)(function(e,n){let t,l,{current:r}=e,{columns:o,rows:s}=(0,b.useMemo)(()=>(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return{columns:[{key:"index",name:"",resizable:!0,minWidth:35,width:35,cellClass:"column-index-normal"},{key:"name",name:"Name",resizable:!0,renderCell:e=>{let{row:t,column:l}=e;return n?(0,i.jsx)(t$,{model:n,name:t.name,singleEnv:!0}):t.name},cellClass:"column-body-normal"},{key:"type",name:"Type",resizable:!0,cellClass:"column-body-normal"}],rows:Object.entries(e).map((e,n)=>{let[t,i]=e;return{name:t,index:n+1,type:i.type}})}})(null==r?void 0:r.columns,r),[r]),{lineageGraph:a}=eM();return(null==a?void 0:a.catalogMetadata.current)||(t="catalog.json is missing."),r&&void 0===r.columns&&(l="Schema information is missing."),(0,i.jsxs)(c.k,{direction:"column",children:[t?(0,i.jsxs)(t1.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(t5.z,{}),t]}):l?(0,i.jsxs)(t1.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(t5.z,{}),l]}):(0,i.jsx)(i.Fragment,{}),s.length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(nr,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:o,rows:s,renderers:{noRowsFallback:(0,i.jsx)(no,{})},className:"rdg-light",enableScreenshot:!1,ref:n})})]})});async function t6(e){return(await U.post("/api/select",e)).data}var t3=t(27818);t(12613);let t9=e=>{let{style:n,children:t,gutterSize:l=5,...r}=e;return(0,i.jsx)(t3.Z,{style:{display:"flex",flexDirection:"row",...n},direction:"horizontal",gutterSize:l,...r,children:t})},t8=e=>{let{style:n,children:t,gutterSize:l=5,...r}=e;return(0,i.jsx)(t3.Z,{style:{display:"flex",flexDirection:"column",...n},gutterSize:l,direction:"vertical",...r,children:t})};var t7=t(29537),ie=t(98472),it=t(61327);let ii=ns.Nbv,il=ns.sFB,ir=ns.UGs;function io(e){return"added"===e?{color:"#1dce00",backgroundColor:"#e8fce5",icon:ii}:"removed"===e?{color:"#ff4444",backgroundColor:"#ffdbdb",icon:il}:"modified"===e?{color:"#ffa502",backgroundColor:"#fff2dd",icon:ir}:{color:"inherit",backgroundColor:"white",icon:void 0}}function is(e){if("model"===e)return{color:"#c0eafd",icon:ie.Fn3};if("metric"===e)return{color:"#ffe6ee",icon:it._MV};if("source"===e)return{color:"#a6dda6",icon:ie.i1q};if("exposure"===e)return{color:"#ffe6ee",icon:it.n8P};if("semantic_model"===e)return{color:"#fb8caf",icon:it.R1C};if("seed"===e)return{color:"#a6dda6",icon:ie.tWi};if("snapshot"===e)return{color:"#a6dda6",icon:ie.Dmm};else return{color:"inherit",icon:void 0}}function ia(e,n){if(!e||!n)return;let t=Object.keys(e),i=Object.keys(n);if(t.length!==i.length)return!0;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!0;for(let t of i)if(!e[t]||e[t].type!==n[t].type)return!0;return!1}let id=e=>{let n,t,{node:r,selected:s,onSelect:a,schemaChanged:d}=e,{icon:u}=is(r.resourceType),{base:h,current:x}=r.data;if(d){var m;n=null===(m=ta("schema_diff"))||void 0===m?void 0:m.icon,t=io("modified").color}else!h&&x?(n=io("added").icon,t=io("added").color):h&&!x&&(n=io("removed").icon,t=io("removed").color);return(0,i.jsxs)(c.k,{width:"100%",fontSize:"10pt",p:"5px 8px",cursor:"pointer",_hover:{bg:"gray.200"},bg:s?"gray.100":"inherit",onClick:()=>{a(r.id)},alignItems:"center",gap:"5px",children:[(0,i.jsx)(o.J,{as:u}),(0,i.jsx)(l.x,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:r.name}),n&&t&&(0,i.jsx)(o.J,{as:n,color:t})]})},ic=(0,b.forwardRef)(function(e,n){let{check:t}=e,{lineageGraph:l}=eM(),r=t.params,o=[...q.check(t.check_id),"select"],{isLoading:s,error:a,refetch:d,data:c}=(0,w.a)({queryKey:o,queryFn:async()=>t6({select:r.select,exclude:r.exclude,packages:r.packages,view_mode:r.view_mode}),refetchOnMount:!0,enabled:!r.node_id}),[u,h]=(0,b.useMemo)(()=>{var e,n,t;let i=[],o=[],s=[],a=[];if(r.node_id)for(let e of r.node_id instanceof Array?r.node_id:[r.node_id]){let n=null==l?void 0:l.nodes[e];n&&i.push(n)}else for(let n of null!==(e=null==c?void 0:c.nodes)&&void 0!==e?e:[]){let e=null==l?void 0:l.nodes[n];e&&i.push(e)}let d=i.filter(e=>"model"===e.resourceType||"seed"===e.resourceType||"source"===e.resourceType||"snapshot"===e.resourceType);for(let e of d)ia(null===(n=e.data.base)||void 0===n?void 0:n.columns,null===(t=e.data.current)||void 0===t?void 0:t.columns)?o.push(e.id):!e.data.base&&e.data.current?s.push(e.id):e.data.base&&!e.data.current&&a.push(e.id);function u(e){return o.includes(e.id)?3:s.includes(e.id)?2:a.includes(e.id)?1:0}return d.sort((e,n)=>{let t=u(e),i=u(n);return t!==i?i-t:e.name.localeCompare(n.name)}),[d,o]},[r.node_id,null==c?void 0:c.nodes,l]),[x,m]=(0,b.useState)(0);if(s)return(0,i.jsx)(ni.M,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(a)return(0,i.jsxs)(ni.M,{bg:"rgb(249,249,249)",height:"100%",children:["Error: ",a.message]});if(0==u.length)return(0,i.jsx)(ni.M,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"});if(x<u.length){let e=u[x];return(0,i.jsxs)(t9,{sizes:[80,20],minSize:30,style:{height:"100%"},children:[(0,i.jsx)(t2,{base:e.data.base,current:e.data.current,enableScreenshot:!0,ref:n}),(0,i.jsx)(t7.aV,{overflow:"auto",backgroundColor:"white",children:u.map((e,n)=>(0,i.jsx)(id,{node:e,schemaChanged:h.includes(e.id),selected:n===x,onSelect:()=>{m(n)}},n))})]})}return(0,i.jsx)(i.Fragment,{})});var iu=t(34367);function ih(e){let{value:n,onChange:t}=e,{readOnly:l}=tn(),[o,s]=(0,b.useState)(!1),[a,d]=(0,b.useState)(),u=(0,b.useRef)(null),h=()=>{t&&(t(a),s(!1))};return((0,b.useEffect)(()=>{if(o&&u.current){let e=u.current;e.focus(),e.setSelectionRange(e.value.length,e.value.length)}},[o]),o)?(0,i.jsxs)(c.k,{direction:"column",align:"flex-end",height:"100%",children:[(0,i.jsx)(iu.g,{value:a,onChange:e=>{d(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&s(!1),(e.metaKey||e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),h())},ref:u,flex:1}),(0,i.jsxs)(c.k,{gap:"12px",alignItems:"flex-end",children:[(0,i.jsx)(r.r,{onClick:()=>{setTimeout(()=>{s(!1)},100)},colorScheme:"blue",children:"cancel"}),(0,i.jsx)(er.z,{mt:"8px",size:"sm",colorScheme:"blue",onClick:h,children:"Update"})]})]}):(0,i.jsx)(ei.x,{height:"100%",overflow:"auto",fontSize:"11pt",onClick:l?void 0:()=>{d(null!=n?n:""),s(!0)},whiteSpace:"pre-wrap",wordBreak:"break-word",color:n?"inherit":"lightgray",children:n||"Add description here"})}var ix=t(35275);function im(){let e=(0,s.p)();return{successToast:function(n){e({description:n,status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})},failToast:function(n,t){e({title:n,description:"".concat(t),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}}}function ip(){let e=(0,tO._)(["\n    **SQL**\n    ```sql\n    ","\n    ```\n    "],["\n    **SQL**\n    \\`\\`\\`sql\n    ","\n    \\`\\`\\`\n    "]);return ip=function(){return e},e}function ig(e){return e.description?e.description:"_(no description)_"}var iv=t(17301),ij=t(18099);let iy=e=>{var n;let{value:t,onChange:l,onRun:r,onRunBase:s,onRunDiff:a,label:d,CustomEditor:u,options:h={},...x}=e,{readOnly:p}=tn();return(0,i.jsxs)(i.Fragment,{children:[(null!==(n=null!=d?d:r)&&void 0!==n?n:s)&&(0,i.jsxs)(c.k,{backgroundColor:"#EDF2F880",height:"40px",minH:"40px",fontSize:"14px",align:"center",margin:"0",padding:"0px 16px",flex:"0 0 40px",children:[(0,i.jsx)(ei.x,{as:"b",children:d?d.toUpperCase():""}),(0,i.jsx)(m.L,{}),(null!=r?r:s)&&(0,i.jsx)(er.z,{size:"sm",variant:"outline",onClick:null!=r?r:s,backgroundColor:"white",leftIcon:(0,i.jsx)(o.J,{as:it.gmG}),padding:"6px 12px",isDisabled:p,children:"Run Query"})]}),null!=u?u:(0,i.jsx)(ij.ML,{language:"sql",theme:"vs",value:t,onChange:e=>{void 0!==e&&l&&l(e)},onMount:(e,n)=>{r&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.Enter,r),s&&e.addCommand(n.KeyMod.Alt|n.KeyCode.Enter,s),a&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.Enter,a)},options:{tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent",...h}})]})},ib=e=>{let{value:n,baseValue:t,onChange:l,onChangeBase:r,onRun:o,onRunBase:s,onRunDiff:a,options:d={},labels:u,BaseEnvironmentSetupGuide:h,...x}=e,m=u?u[0]:"Base",p=u?u[1]:"Current";return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(c.k,{height:"100%",gap:0,children:[(0,i.jsx)(iv.K,{height:"100%",width:"50%",gap:0,borderRight:"1px",borderColor:"#D4DBE4",children:(0,i.jsx)(iy,{label:m,value:null!=t?t:"",onChange:r,onRunBase:s,options:d,CustomEditor:h,...x})}),(0,i.jsx)(iv.K,{height:"100%",width:"50%",gap:0,children:(0,i.jsx)(iy,{label:p,value:n,onChange:l,onRun:o,options:d,...x})})]})})};var iw=t(83722),ik=t(93790);let iC=(0,eY.G)((e,n)=>{var t,r,o,s,a;let{isRunning:d,isAborting:u,progress:h,error:x,run:m,onCancel:p,viewOptions:f,onViewOptionsChanged:g,RunResultView:v,children:j,onExecuteRun:y}=e,b=null!==(o=null==x?void 0:null===(r=x.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.detail)&&void 0!==o?o:null==m?void 0:m.error;if(b)return(0,i.jsxs)(t1.b,{status:"error",children:[(0,i.jsx)(t5.z,{}),"Error: ",b]});if(null!=d?d:(null==m?void 0:m.status)==="running"){let e="Loading...";return(null==h?void 0:h.message)?e=h.message:(null==m?void 0:null===(s=m.progress)||void 0===s?void 0:s.message)&&(e=m.progress.message),(0,i.jsx)(ni.M,{p:"16px",height:"100%",bg:"rgb(249,249,249)",children:(0,i.jsxs)(nb.g,{children:[(0,i.jsxs)(c.k,{alignItems:"center",children:[(null==h?void 0:h.percentage)==null?(0,i.jsx)(iw.D,{isIndeterminate:!0,size:"20px",mr:"8px"}):(0,i.jsx)(iw.D,{size:"20px",value:100*h.percentage,mr:"8px"}),u?(0,i.jsx)(i.Fragment,{children:"Aborting..."}):(0,i.jsx)(i.Fragment,{children:e})]}),!u&&(0,i.jsx)(er.z,{onClick:p,colorScheme:"blue",size:"sm",children:"Cancel"})]})})}if(!m)return(0,i.jsx)(ni.M,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(j&&v)throw Error("RunView requires either a children or a RunResultView prop, but not both.");if(!j&&!v)throw Error("RunView requires at least one of children or RunResultView prop.");return(0,i.jsxs)(l.x,{h:"100%",style:{contain:"size layout"},overflow:"auto",children:[v&&(null!==(a=m.error)&&void 0!==a?a:m.result)&&(0,i.jsx)(ik.SV,{children:(0,i.jsx)(v,{ref:n,run:m,viewOptions:f,onViewOptionsChanged:g})}),null==j?void 0:j({run:m,viewOptions:f,onViewOptionsChanged:g})]})});var i_=t(72229),iS=t(56756),iz=t(76096),iR=t(18648),iI=t(77873),iE=t(55180);t(98215),t(52997);var iL=t(55859),iD=t(48409),iT=t(91997),iO=t(76958);function iM(e){let{node:n}=e,{icon:t}=is(n.resourceType);return(0,i.jsx)(nW.u,{hasArrow:!0,label:"Type of resource",children:(0,i.jsxs)(tM.Vp,{children:[(0,i.jsx)(tM.AD,{as:t}),(0,i.jsx)(tM.Sn,{children:n.resourceType})]})})}function iA(e){let{rowCount:n}=e,t=n.base,l=n.curr,r=null===n.base?"N/A":"".concat(n.base," rows"),s=null===n.curr?"N/A":"".concat(n.curr," rows");return null===t&&null===l?(0,i.jsx)(i.Fragment,{children:" Failed to load"}):null===t||null===l?(0,i.jsxs)(x.U,{children:[(0,i.jsx)(ei.x,{children:r}),(0,i.jsx)(o.J,{as:iT.Rgz}),(0,i.jsx)(ei.x,{children:s})]}):t===l?(0,i.jsxs)(x.U,{children:[(0,i.jsx)(ei.x,{children:s}),(0,i.jsx)(o.J,{as:iO.lxc,color:"gray.500"}),(0,i.jsx)(ei.x,{color:"gray.500",children:"No Change"})]}):t<l?(0,i.jsxs)(x.U,{children:[(0,i.jsx)(ei.x,{children:s}),(0,i.jsx)(o.J,{as:iO.Tvk,color:"green.500"}),(0,i.jsx)(ei.x,{color:"green.500",children:nF(t,l)})]}):(0,i.jsxs)(x.U,{children:[(0,i.jsx)(ei.x,{children:s}),(0,i.jsx)(o.J,{as:iO.ebp,color:"red.500"}),(0,i.jsx)(ei.x,{color:"red.500",children:nF(t,l)})]})}function iN(e){var n,t,l,r;let o,{rowCount:s,node:a,onRefresh:d,isFetching:c}=e,{readOnly:u}=tn(),{runsAggregated:h}=eM(),x=null==h?void 0:null===(n=h[a.id])||void 0===n?void 0:n.row_count_diff.result,m=null===(t=ta("row_count_diff"))||void 0===t?void 0:t.icon,p=null!=s?s:x;if(p){let e=null!==(l=p.base)&&void 0!==l?l:"N/A",n=null!==(r=p.curr)&&void 0!==r?r:"N/A";o="".concat(e," -> ").concat(n," rows")}return(0,i.jsx)(nW.u,{label:o,children:(0,i.jsxs)(tM.Vp,{children:[(0,i.jsx)(tM.AD,{as:m}),(0,i.jsx)(tM.Sn,{children:p||c?(0,i.jsx)(iD.N,{isLoaded:!c,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:p?(0,i.jsx)(iA,{rowCount:p}):"row count"}):(0,i.jsx)(i.Fragment,{children:"row count"})}),d&&(0,i.jsx)(tM.bq,{as:nu.h,isLoading:c,"aria-label":"Query Row Count",icon:(0,i.jsx)(tV.n,{}),size:"xs",onClick:d,isDisabled:u})]})})}function iF(e){var n,t,l;let r,{rowCount:o,node:s,onRefresh:a,isFetching:d}=e,{runsAggregated:c,refetchRunsAggregated:u}=eM(),h=null==c?void 0:null===(n=c[s.id])||void 0===n?void 0:n.row_count.result,x=null===(t=ta("row_count"))||void 0===t?void 0:t.icon,m=null!=o?o:h;if(m){let e=null!==(l=m.curr)&&void 0!==l?l:"N/A";r="".concat(e," rows")}return(0,i.jsxs)(tM.Vp,{children:[(0,i.jsx)(tM.AD,{as:x}),(0,i.jsx)(tM.Sn,{children:m||d?(0,i.jsx)(iD.N,{isLoaded:!d,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:m?"".concat(r):"row count"}):(0,i.jsx)(i.Fragment,{children:"row count"})}),a&&(0,i.jsx)(tM.bq,{as:nu.h,isLoading:d,"aria-label":"Query Row Count",icon:(0,i.jsx)(tV.n,{}),size:"xs",onClick:a,disabled:"base"===s.from})]})}let iq=e=>{let{node:n,action:t}=e,{status:r,skipReason:o,run:s}=t;if("pending"===r)return(0,i.jsx)(iw.D,{size:"20px",value:0});if("skipped"===r)return(0,i.jsx)(tM.Vp,{backgroundColor:"gray.100",children:(0,i.jsxs)(c.k,{fontSize:"10pt",color:"gray.500",alignItems:"center",gap:"3px",children:[(0,i.jsx)(l.x,{children:"Skipped"}),o&&(0,i.jsx)(nW.u,{label:o,children:(0,i.jsx)(iL.s,{})})]})});if(!s)return(0,i.jsx)(iw.D,{isIndeterminate:!0,size:"20px"});let{error:a,result:d,run_id:u,progress:h}=s;if("running"===r)return(null==h?void 0:h.percentage)===void 0?(0,i.jsx)(iw.D,{isIndeterminate:!0,size:"20px"}):(0,i.jsx)(iw.D,{size:"20px",value:100*h.percentage});if(a)return(0,i.jsxs)(c.k,{fontSize:"10pt",color:"gray",children:[(0,i.jsx)(l.x,{children:"Error"}),o&&(0,i.jsx)(nW.u,{label:a,children:(0,i.jsx)(ny.a,{})})]});if("value_diff"===s.type){let e=0;for(let n of d.data.data)n[2]<1&&e++;return(0,i.jsx)(tM.Vp,{backgroundColor:e>0?"red.100":"green.100",children:(0,i.jsx)(tM.Sn,{children:(0,i.jsx)(c.k,{fontSize:"10pt",color:e>0?"red":"green",alignItems:"center",gap:"3px",children:e>0?"".concat(e," columns mismatched"):"All columns match"})})})}if("row_count_diff"===s.type){let e=s.result;return(0,i.jsx)(iN,{rowCount:e[n.name],node:n})}if("row_count"===s.type){let e=s.result;return(0,i.jsx)(iF,{rowCount:e[n.name],node:n})}return(0,i.jsx)(i.Fragment,{children:u})};function iH(e){var n;let t,l,{rowCount:r}=e,o=r.base,s=r.curr,a=null===r.base?"N/A":"".concat(r.base," Rows"),d=null===r.curr?"N/A":"".concat(r.curr," Rows");return null===o&&null===s?(t="Failed to load",l="gray"):null===o||null===s?(t="".concat(a," -> ").concat(d),l=null===o?"green":"red"):o===s?(t="=",l="gray"):o!==s&&(t="".concat(nF(o,s)," Rows"),l=o<s?"green":"red"),(0,i.jsxs)(tM.Vp,{colorScheme:l,children:[(0,i.jsx)(tM.AD,{as:null===(n=ta("row_count_diff"))||void 0===n?void 0:n.icon}),(0,i.jsx)(tM.Sn,{children:t})]})}let iP={breaking:"Breaking",non_breaking:"Non Breaking",partial_breaking:"Partial Breaking",unknown:"Unknown"},iV=e=>{var n;let t,r,{id:s,inverted:a}=e,{lineageGraph:d,runsAggregated:u}=eM(),h=null==u?void 0:u[s],x=null==d?void 0:d.nodes[s];if(!h&&!x)return(0,i.jsx)(i.Fragment,{});if((null==x?void 0:x.data.base)&&x.data.current&&(t=ia(x.data.base.columns,x.data.current.columns)),null==h?void 0:h.row_count_diff){let e=h.row_count_diff;r=e.result.curr!==e.result.base}let p=a?"white":io("modified").color;return(0,i.jsxs)(c.k,{flex:"1",children:[void 0!==t&&(0,i.jsx)(nW.u,{label:"Schema (".concat(t?"changed":"no change",")"),openDelay:500,children:(0,i.jsx)(l.x,{height:"16px",children:(0,i.jsx)(o.J,{as:null===(n=ta("schema_diff"))||void 0===n?void 0:n.icon,color:t?p:a?"gray":"lightgray"})})}),(0,i.jsx)(m.L,{}),(null==h?void 0:h.row_count_diff)&&void 0!==r&&(0,i.jsx)(nW.u,{label:"Row count (".concat(r?"changed":"=",")"),openDelay:500,children:(0,i.jsx)(l.x,{children:(0,i.jsx)(iH,{rowCount:h.row_count_diff.result})})})]})},iW=e=>{let{checked:n,onClick:t}=e;return(0,i.jsx)(c.k,{onClick:t,alignSelf:"center",alignItems:"center",cursor:"pointer",children:n?(0,i.jsx)(o.J,{boxSize:"20px",as:ie.xik}):(0,i.jsx)(o.J,{boxSize:"20px",as:ie.hGI})})},iK=e=>{let{name:n,color:t,resourceType:r}=e;return(0,i.jsx)(l.x,{flex:"1",color:t,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:(0,i.jsx)(nW.u,{label:"model"===r?n:"".concat(n," (").concat(r,")"),placement:"top",children:n})})};var iJ=t(72025),iB=t(10994);async function iU(e){return(await U.post("/api/checks",{type:"schema_diff",params:e})).data}let iQ={audit_helper:"Require the dbt package 'dbt-labs/audit_helper'. Please install it and re-run dbt to activate this feature.",dbt_profiler:"Require the dbt package 'data-mie/dbt_profiler'. Please install it and re-run dbt to activate this feature.",add_or_remove:"Unavailable for added or removed resources."},iZ=e=>{var n;let[t,i]=(0,b.useState)(!1),[l,r]=(0,b.useState)(!1),[,o]=eA(),{error:s,data:a}=(0,w.a)({queryKey:q.run(null!=e?e:""),queryFn:async()=>ek(null!=e?e:"",t?2:0),enabled:!!e,refetchInterval:!!t&&50,retry:!1});(0,b.useEffect)(()=>{(s||(null==a?void 0:a.result)||(null==a?void 0:a.error))&&(t&&i(!1),((null==a?void 0:a.type)==="row_count_diff"||(null==a?void 0:a.type)==="row_count")&&o()),(null==a?void 0:a.status)==="running"&&i(!0)},[a,s,t,o]);let d=(0,b.useCallback)(async()=>{r(!0),e&&await eC(e)},[e,r]),c=(null==a?void 0:a.type)?null===(n=ta(a.type))||void 0===n?void 0:n.RunResultView:void 0;return{run:a,isRunning:t,aborting:l,error:s,onCancel:d,RunResultView:c}};var iX=t(7749),iG=t(34885),iY=t(72682),i$=t(46706),i0=t(49990),i1=t(85041),i5=t(44550),i2=t(78129),i4=t(54388),i6=t.n(i4),i3=t(9508),i9=t(4),i8=t(83006),i7=t.n(i8);let le="ignore-screenshot";function ln(e){let{renderLibrary:n="html2canvas",imageType:t="png",backgroundColor:l=null,boardEffect:r=!0,shadowEffect:o=!1,borderStyle:s="solid 1px #ccc",borderRadius:a="10px",onSuccess:d,onError:h,ignoreElements:x}=e,[m,p]=(0,b.useState)("idle"),f=(0,b.useRef)(null),{onOpen:g,setImgBlob:v,ImageDownloadModal:j}=function(){let{isOpen:e,onOpen:n,onClose:t}=(0,G.q)(),[l,r]=(0,b.useState)();return{onOpen:n,setImgBlob:r,ImageDownloadModal:function(){let[n,r]=(0,b.useState)();return(0,b.useEffect)(()=>{if(!l)return;let e=new FileReader;e.readAsDataURL(l),e.onloadend=e=>{var n;(null===(n=e.target)||void 0===n?void 0:n.result)!=null&&r(e.target.result)}},[r]),(0,i.jsxs)(Y.u_,{size:"3xl",isOpen:e,onClose:t,children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{children:[(0,i.jsx)(en.x,{children:"Screenshot Preview"}),(0,i.jsx)(eN.o,{}),(0,i.jsxs)(et.f,{children:[(0,i.jsxs)(c.k,{px:"10px",gap:"10px",direction:"column",children:[(0,i.jsxs)(c.k,{alignItems:"center",gap:"5px",children:[(0,i.jsx)(iL.s,{color:"red.600"}),(0,i.jsx)(ei.x,{fontWeight:"500",display:"inline",children:"Copy to the Clipboard"})," ","is not supported in the current browser"]}),(0,i.jsx)(ei.x,{children:"Please download it directly"})]}),(0,i.jsx)(u.E,{src:n,alt:"screenshot"})]}),(0,i.jsxs)(el.m,{children:[(0,i.jsx)(er.z,{mr:3,onClick:t,children:"Close"}),(0,i.jsx)(er.z,{colorScheme:"blue",onClick:()=>{if(!l)return;let e=new Date,n="recce-screenshot-".concat((0,i9.WU)(e,"yyyy-MM-dd-HH-mm-ss"),".png");i7()(l,n),t()},children:"Download"})]})]})]})}}}(),y=async()=>{var e,t;if(!f.current)throw console.error("No node to use for screenshot"),Error("No node to use for screenshot");let i=null!==(e=f.current.element)&&void 0!==e?e:f.current,d=i.style.overflow,c=i.style.border,u=i.style.borderRadius,h=i.style.backgroundColor,m=i.style.height;try{i.style.overflow="hidden",i.style.border=r?s:"",i.style.borderRadius=r?a:"",i.style.backgroundColor=null!=l?l:"",i.style.height="".concat(String(i.offsetHeight),"px");let e=document.createElement("style");document.head.appendChild(e),null===(t=e.sheet)||void 0===t||t.insertRule("body > div:last-child img { display: inline-block; }"),p("loading");let d="html2canvas"===n?await i6()(i,{logging:!1,backgroundColor:null,ignoreElements:x}):await (0,i3.rT)(i,{filter:x?e=>!x(e):void 0});e.remove();let c=o?document.createElement("canvas"):d;if(o){c.width=d.width+80,c.height=d.height+80;let e=c.getContext("2d");if(e)e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=20,e.shadowOffsetX=10,e.shadowOffsetY=10,e.drawImage(d,40,40);else throw console.error("Error getting canvas context"),Error("Error getting canvas context to add shadow effect")}let u=await fetch(c.toDataURL());return await u.blob()}catch(e){throw console.error("Error converting to image",e),e}finally{i.style.overflow=d,i.style.border=c,i.style.borderRadius=u,i.style.backgroundColor=h,i.style.height=m}};return{status:m,isLoading:"loading"===m,isErrored:"error"===m,isSuccess:"success"===m,copyToClipboard:async()=>{try{await navigator.clipboard.write([new ClipboardItem({["image/".concat(t)]:y()})]),p("success"),d&&d()}catch(e){"ClipboardItem is not defined"===e.message?(v(await y()),g(),p("success")):(p("error"),console.error("Error copying to clipboard",e),h&&h(e))}},ImageDownloadModal:j,ref:f}}function lt(e){var n;let{successToast:t,failToast:l}=im(),{isLoading:r,copyToClipboard:o,ImageDownloadModal:s,ref:a}=ln({imageType:"png",shadowEffect:!0,backgroundColor:null!==(n=null==e?void 0:e.backgroundColor)&&void 0!==n?n:null,onSuccess:()=>{t("Copied the query result as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),l("Failed to copy image to clipboard",e)}}),d=(0,b.useCallback)(()=>{if(a.current){var e;let n=null!==(e=a.current.element)&&void 0!==e?e:a.current;n.style.boxShadow="rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px",n.style.transition="box-shadow 0.5s ease-in-out"}},[a]),c=(0,b.useCallback)(()=>{if(a.current){var e;(null!==(e=a.current.element)&&void 0!==e?e:a.current).style.boxShadow=""}},[a]),u=(0,b.useCallback)(async()=>{if(a.current){var e;await o(),(null!==(e=a.current.element)&&void 0!==e?e:a.current).style.boxShadow=""}else l("Failed to copy image to clipboard","No content to copy")},[a,o,l]);return{ref:a,CopyToClipboardButton:function(e){let{imageType:n="png",...t}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(er.z,{size:"sm",leftIcon:(0,i.jsx)(nd.T,{}),style:{position:"absolute",bottom:"16px",right:"16px"},isLoading:r,onMouseEnter:d,onMouseLeave:c,onClick:u,children:"Copy to Clipboard"}),(0,i.jsx)(s,{})]})},onMouseEnter:d,onMouseLeave:c,onCopyToClipboard:u}}function li(e){let n=new Date,t=new Date;return(t.setDate(n.getDate()-1),null==e)?null:n.toDateString()===e.toDateString()?"Today, "+(0,i9.WU)(e,"HH:mm"):t.toDateString()===e.toDateString()?"Yesterday, "+(0,i9.WU)(e,"HH:mm"):(0,i9.WU)(e,"MMM d, HH:mm")}let ll=e=>{let{run:n}=e,t="running"===n.status,l=n.status;!l&&(n.result?l="finished":n.error&&(l="failed"));let r="",o="";"successful"===l||"finished"===l?(r="green",o="Finished"):"failed"===l?(r="red",o="Failed"):"cancelled"===l?(r="gray",o="Cancelled"):"running"===l?(r="blue",o="Running"):(r="green",o="Finished");let s=n.run_at?li(new Date(n.run_at)):null;return(0,i.jsxs)(c.k,{justifyContent:"start",fontSize:"11pt",color:"gray.500",gap:"3px",alignItems:"center",overflow:"hidden",children:[t&&(0,i.jsx)(iS.$,{size:"xs",color:"".concat(r,".400")}),(0,i.jsx)(ei.x,{fontWeight:500,color:"".concat(r,".400"),children:o}),(0,i.jsx)(ei.x,{children:""}),(0,i.jsx)(ei.x,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:s})]})},lr=e=>{var n;return(0,i.jsxs)(c.k,{flex:"1",minH:"48px",m:"4px",px:"16px",py:"12px",bg:"blue.50",border:"1px",borderRadius:"4px",borderColor:"blue.400",align:null!==(n=e.align)&&void 0!==n?n:"center",gap:"12px",children:[(0,i.jsx)(o.J,{as:iT.H33,width:"20px",height:"20px",color:"blue.900"}),e.children,(0,i.jsx)(m.L,{}),(0,i.jsx)(iB.P,{onClick:e.onClose})]})},lo=()=>(0,i.jsx)(r.r,{href:"https://docs.datarecce.io/get-started/#prepare-dbt-artifacts",isExternal:!0,color:"rgba(49, 130, 206, 1)",fontWeight:"bold",textDecoration:"underline",children:"Learn how"}),ls=e=>{let n=i0.ZP.stringify(e,null,2);return(0,i.jsx)(ij.ML,{height:"100%",language:"yaml",theme:"vs",value:n,options:{readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})},la=e=>{let{runType:n}=e,{isOpen:t,onClose:l}=(0,G.q)({defaultIsOpen:!0});if(!t)return(0,i.jsx)(i.Fragment,{});switch(n){case"row_count":return(0,i.jsx)(lr,{onClose:l,children:(0,i.jsxs)(ei.x,{children:["Enable row count diffing, and other Recce features, by configuring a base dbt environment to compare against. ",(0,i.jsx)(lo,{})]})});case"profile":return(0,i.jsx)(lr,{onClose:l,children:(0,i.jsxs)(ei.x,{children:["Enable data-profile diffing, and other Recce features, by configuring a base dbt environment to compare against. ",(0,i.jsx)(lo,{})]})});default:return(0,i.jsx)(i.Fragment,{})}},ld=e=>{let{disableCopyToClipboard:n,onCopyToClipboard:t,onMouseEnter:l,onMouseLeave:o}=e,{authed:s}=tn(),{handleShareClick:a}=tS();return(0,i.jsxs)(n1.v,{children:[(0,i.jsx)(n5.j,{as:er.z,size:"sm",rightIcon:(0,i.jsx)(i1.v,{}),variant:"outline",children:"Share"}),(0,i.jsxs)(n4.q,{minW:"0",children:[(0,i.jsx)(n3.s,{fontSize:"14px",icon:(0,i.jsx)(nd.T,{}),onClick:t,onMouseEnter:l,onMouseLeave:o,isDisabled:n,children:"Copy to Clipboard"}),(0,i.jsx)(tA.R,{}),s?(0,i.jsx)(n3.s,{fontSize:"14px",icon:(0,i.jsx)(eH.eOs,{}),onClick:async()=>{await a(),ej({name:"create"})},children:"Share to Cloud"}):(0,i.jsxs)(iX.J,{trigger:"hover",placement:"bottom-start",closeOnBlur:!1,children:[(0,i.jsx)(iG.x,{children:(0,i.jsx)(n3.s,{fontSize:"14px",icon:(0,i.jsx)(i5.h,{}),onClick:()=>{window.open("".concat(J,"/settings#tokens"),"_blank")},children:"Enable sharing"})}),(0,i.jsx)(n2.h,{children:(0,i.jsx)(iY.y,{bg:"black",color:"white",sx:{width:"max-content"},children:(0,i.jsxs)(i$.b,{fontSize:"sm",children:["API token required."," ",(0,i.jsx)(r.r,{href:"https://docs.datarecce.io/recce-cloud/share-recce-session-securely",target:"_blank",textDecoration:"underline",children:"Learn more"}),"."]})})})]})]})]})},lc=e=>{var n,t,l,r;let{runId:o,onClose:s,isSingleEnvironment:a}=e,{readOnly:d}=tn(),{runAction:u}=th(),{error:h,run:v,onCancel:j,isRunning:y}=iZ(o),[w,C]=(0,b.useState)(),_=(0,k.NL)(),[,S]=(0,eq.TH)(),[z,R]=(0,b.useState)(0),I=!!a,E=(null==v?void 0:v.type)?null===(n=ta(v.type))||void 0===n?void 0:n.RunResultView:void 0,L=(0,b.useCallback)(()=>{var e;u(null!==(e=null==v?void 0:v.type)&&void 0!==e?e:"",null==v?void 0:v.params)},[v,u]),D=null==v?void 0:v.check_id,T=(0,b.useCallback)(()=>{D&&S("/checks/".concat(D))},[D,S]),O=(0,b.useCallback)(async()=>{if(!o)return;let e=await tR(o,w);await _.invalidateQueries({queryKey:q.checks()}),S("/checks/".concat(e.check_id))},[o,S,_,w]),M=(null==v?void 0:v.type)==="query"||(null==v?void 0:v.type)==="query_diff"||(null==v?void 0:v.type)==="query_base",{ref:A,onCopyToClipboard:N,onMouseEnter:F,onMouseLeave:H}=lt(),P=!o||!(null==v?void 0:v.result)||!!h||0!==z;return(0,i.jsxs)(c.k,{direction:"column",children:[!!a&&(0,i.jsx)(la,{runType:null==v?void 0:v.type}),(0,i.jsx)(p.m,{tabIndex:z,onChange:R,flexDirection:"column",mb:"1px",children:(0,i.jsxs)(f.t,{height:"50px",children:[(0,i.jsx)(g.O,{children:"Result"}),(0,i.jsx)(g.O,{children:"Params"}),M&&(0,i.jsx)(g.O,{children:"Query"}),(0,i.jsx)(m.L,{}),(0,i.jsxs)(x.U,{overflow:"hidden",children:[v&&(0,i.jsx)(ll,{run:v}),(0,i.jsx)(er.z,{leftIcon:(0,i.jsx)(tV.n,{}),variant:"outline",isDisabled:!o||y||d,size:"sm",onClick:L,children:"Rerun"}),a||d?(0,i.jsx)(er.z,{leftIcon:(0,i.jsx)(nd.T,{}),variant:"outline",isDisabled:!o||!(null==v?void 0:v.result)||!!h||0!==z,onMouseEnter:F,onMouseLeave:H,size:"sm",onClick:N,children:"Copy to Clipboard"}):(0,i.jsx)(ld,{disableCopyToClipboard:P,onCopyToClipboard:async()=>{var e;await N(),eb({type:null!==(e=null==v?void 0:v.type)&&void 0!==e?e:"unknown",from:"run"})},onMouseEnter:F,onMouseLeave:H}),(0,i.jsx)(function(){return I?(0,i.jsx)(i.Fragment,{}):(null==v?void 0:v.check_id)?(0,i.jsx)(er.z,{leftIcon:(0,i.jsx)(i2.n,{}),isDisabled:!o||!v.result||!!h,size:"sm",colorScheme:"blue",onClick:T,children:"Go to Check"}):(0,i.jsx)(er.z,{leftIcon:(0,i.jsx)(i2.n,{}),isDisabled:!o||!(null==v?void 0:v.result)||!!h,size:"sm",colorScheme:"blue",onClick:O,children:"Add to Checklist"})},{}),(0,i.jsx)(iB.P,{onClick:()=>{s&&s()}})]})]})}),0===z&&(0,i.jsx)(iC,{ref:A,error:h,run:v,onCancel:j,viewOptions:w,onViewOptionsChanged:C,RunResultView:E}),1===z&&v&&(0,i.jsx)(ls,{type:v.type,params:v.params}),2===z&&v&&((null===(t=v.params)||void 0===t?void 0:t.base_sql_template)?(0,i.jsx)(ib,{value:v.params.sql_template,baseValue:v.params.base_sql_template,options:{readOnly:!0}}):(0,i.jsx)(iy,{value:null!==(r=null===(l=v.params)||void 0===l?void 0:l.sql_template)&&void 0!==r?r:"",options:{readOnly:!0}}))]})},lu=e=>{let{onClose:n,isSingleEnvironment:t}=e,{runId:l}=th();return(0,i.jsx)(lc,{runId:l,onClose:n,isSingleEnvironment:t})};async function lh(e,n){return await ew("query",e,n)}async function lx(e,n){return await ew("query_base",e,n)}async function lm(e,n){return await ew("query_diff",e,n)}var lp=t(27951),lf=t(2097),lg=t(71381);let lv=e=>{var n;let{defaultValues:t,suggestionList:r,onValuesChange:s,isDisabled:a}=e,[d,c]=(0,b.useState)(null!=t?t:[]),[u,h]=(0,b.useState)(""),[x,m]=(0,b.useState)(!1),p=(0,b.useRef)(null),f=e=>{d.includes(e)||(h(""),c([...d,e]),s([...d,e]))};if(a)return(0,i.jsx)(nW.u,{label:iQ.audit_helper,children:(0,i.jsx)(nY.I,{size:"xs",disabled:!0,placeholder:"Unavailable"})});let g=null!==(n=null==r?void 0:r.filter(e=>""===u||e.includes(u)).filter(e=>!d.includes(e)))&&void 0!==n?n:[];return(0,i.jsxs)(lp.B,{size:e.size,width:e.width,children:[(0,i.jsxs)(n1.v,{isLazy:!0,closeOnSelect:!1,onOpen:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.focus()},children:[(0,i.jsxs)(n5.j,{width:"100%",children:[(0,i.jsx)(nY.I,{placeholder:e.placeholder,size:e.size,borderRadius:"4px",value:d.length>1?"".concat(d.length," ").concat(e.unitName,"s selected"):1===d.length?d[0]:"",onChange:()=>{},backgroundColor:"white"}),0===d.length&&(0,i.jsx)(lf.x,{children:(0,i.jsx)(o.J,{as:it.RiI,color:"blue.500",fontSize:e.size,mt:"1",mr:"6"})})]}),(0,i.jsx)(n2.h,{children:(0,i.jsxs)(n4.q,{zIndex:"popover",fontSize:e.size,width:e.width,children:[(0,i.jsx)(n6.k,{children:(0,i.jsxs)(lg.E,{border:"1px solid #e2e8f0",borderRadius:"4px",width:"calc(100% - 8px)",marginX:"4px",padding:"4px",children:[d.map((n,t)=>(0,i.jsx)(lg.U,{children:(0,i.jsxs)(tM.Vp,{size:e.size,children:[(0,i.jsx)(tM.Sn,{paddingLeft:"8px",children:n}),(0,i.jsx)(tM.SD,{paddingRight:"8px",onClick:()=>{c(d.filter(e=>e!==n)),s(d.filter(e=>e!==n))}})]},n)},"tag-".concat(t))),(0,i.jsx)(lg.U,{width:"100%",children:(0,i.jsx)(nY.I,{ref:p,placeholder:"Filter or add custom keys",variant:"unstyled",size:e.size,value:u,onChange:e=>{h(e.target.value),m(!0)},onKeyDown:e=>{let n=e.currentTarget.value.trim().replace(",","");switch(e.key){case",":case"Enter":f(n),h("");break;case"Backspace":""===e.currentTarget.value&&d.length>0&&(c(d.slice(0,-1)),s(d.slice(0,-1)))}},onBlur:()=>{p.current&&x&&p.current.focus()}})})]})}),(0,i.jsx)(tA.R,{}),(0,i.jsxs)(n6.k,{children:[""!==u&&!(null==r?void 0:r.includes(u))&&(0,i.jsxs)(n3.s,{onClick:()=>{f(u),m(!1)},children:["Add '",u,"' to the list"]},"custom-value-by-filter"),g.map((e,n)=>(0,i.jsx)(n3.s,{onClick:()=>{f(e)},children:e},"option-".concat(n))).slice(0,10),g.length>10&&(0,i.jsx)(nW.u,{label:"Please use filter to find more items",placement:"top",children:(0,i.jsxs)(l.x,{px:"12px",color:"gray",fontSize:"8pt",children:["and ",g.length-10," more items..."]})})]})]})})]}),d.length>0&&(0,i.jsx)(lf.x,{children:(0,i.jsx)(er.z,{variant:"link",color:"#3182CE",fontSize:e.size,paddingTop:"4px",paddingRight:"24px",onClick:()=>{h(""),c([]),s([])},children:"Clear"})})]})},lj=e=>{let{defaultPrimaryKeys:n,onPrimaryKeysChange:t,...l}=e,{lineageGraph:r,isActionAvailable:o}=eM(),s=(0,b.useMemo)(()=>{if(!r)return[];let e=new Set;for(let i in r.nodes){var n,t;let l=r.nodes[i],o=null===(n=l.data.base)||void 0===n?void 0:n.columns,s=null===(t=l.data.current)||void 0===t?void 0:t.columns;for(let n in o)e.add(n);for(let n in s)e.add(n)}return Array.from(e).sort()},[r]);return(0,i.jsx)(c.k,{...l,children:(0,i.jsxs)(eP.NI,{m:"4px 8px",children:[(0,i.jsxs)(eV.l,{fontSize:"8pt",margin:"0",children:["Diff with Primary Key(s) (suggested)"," ",(0,i.jsx)(nW.u,{label:"Provide a primary key to perform query diff in data warehouse and only return changed rows.",placement:"bottom-end",children:(0,i.jsx)(iL.s,{color:"gray.600",boxSize:"3"})})]}),(0,i.jsx)(lv,{unitName:"key",defaultValues:n,suggestionList:s,onValuesChange:t,size:"xs",width:"240px",placeholder:"Select or type to add keys",isDisabled:!o("query_diff_with_primary_key")})]})})};var ly=t(77639),lb=t(76902);function lw(e){let{description:n,onLike:t,onDislike:l,onClickLink:o,externalLink:s,externalLinkText:a}=e;return(0,i.jsxs)(c.k,{gap:4,justifyContent:"center",alignContent:"center",alignItems:"center",children:[n,(0,i.jsx)(nu.h,{"aria-label":"thumbs up",variant:"ghost",icon:(0,i.jsx)(u.E,{src:"/imgs/feedback/thumbs-up.png",alt:"like"}),width:"32px",height:"32px",onClick:t}),(0,i.jsx)(nu.h,{"aria-label":"thumbs down",variant:"ghost",icon:(0,i.jsx)(u.E,{src:"/imgs/feedback/thumbs-down.png",alt:"dislike"}),width:"32px",height:"32px",onClick:l}),s&&a&&(0,i.jsx)(r.r,{href:s,isExternal:!0,textDecoration:"underline",onClick:o,children:a})]})}let lk="recce-",lC={bypassSaveOverwrite:"".concat(lk,"-bypass-save-overwrite"),previewChangeFeedbackID:"".concat(lk,"-preview-change-feedback"),prepareEnvGuideID:"".concat(lk,"-prepare-env")};var l_=t(95869),lS=t(65610),lz=t(30874),lR=t(97020),lI=t(46321),lE=t(68100),lL=t(29313),lD=t(38192);let lT=e=>(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,i.jsx)("g",{clipPath:"url(#clip0_1479_25070)",children:(0,i.jsx)("path",{d:"M15.625 0.25H14.759C14.5484 0.25 14.3791 0.423375 14.3841 0.633937L14.4575 3.71441C13.0691 1.62634 10.6955 0.25 8 0.25C4.21291 0.25 1.06041 2.96638 0.38425 6.557C0.340875 6.78728 0.518875 7 0.753219 7H1.64622C1.82353 7 1.97566 6.87556 2.013 6.70222C2.60753 3.9415 5.05991 1.875 8 1.875C10.4858 1.875 12.6232 3.35256 13.5836 5.47819L9.63394 5.38416C9.42341 5.37916 9.25 5.54844 9.25 5.75906V6.625C9.25 6.83209 9.41791 7 9.625 7H15.625C15.8321 7 16 6.83209 16 6.625V0.625C16 0.417906 15.8321 0.25 15.625 0.25ZM15.2468 9H14.3538C14.1765 9 14.0243 9.12444 13.987 9.29778C13.3925 12.0585 10.9401 14.125 8 14.125C5.51419 14.125 3.37681 12.6474 2.41637 10.5218L6.36606 10.6158C6.57659 10.6208 6.75 10.4516 6.75 10.2409V9.375C6.75 9.16791 6.58209 9 6.375 9H0.375C0.167906 9 0 9.16791 0 9.375V15.375C0 15.5821 0.167906 15.75 0.375 15.75H1.24097C1.45156 15.75 1.62088 15.5766 1.61588 15.3661L1.54253 12.2856C2.93087 14.3737 5.3045 15.75 8 15.75C11.7871 15.75 14.9396 13.0336 15.6158 9.443C15.6591 9.21272 15.4811 9 15.2468 9Z",fill:"currentColor"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"clip0_1479_25070",children:(0,i.jsx)("rect",{width:"16",height:"16",fill:"white"})})})]}),lO=e=>(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,i.jsx)("g",{clipPath:"url(#clip0_1479_25102)",children:(0,i.jsx)("path",{d:"M-1.88399 8.72062L0.358816 6.46094C0.594752 6.22344 1.00006 6.39031 1.00006 6.725V8.2525H4.00005V4.12438C4.00005 3.7275 4.16161 3.34313 4.44286 3.06219L7.06441 0.440625C7.34566 0.159375 7.72691 0 8.12347 0H14.5003C15.3281 0.003125 16 0.675 16 1.50281V14.5003C16 15.3281 15.3281 16 14.5003 16H5.50223C4.67411 16 4.00005 15.3281 4.00005 14.5003V11.2522H5.50005V14.5003H14.5003V1.50281H9.50128V4.75219C9.50128 5.16781 9.1669 5.50187 8.75128 5.50187H5.50005V8.25219H10.625C10.8322 8.25219 11 8.42 11 8.62719V9.37719C11 9.58438 10.8322 9.75219 10.625 9.75219H1.00006V11.2797C1.00006 11.6144 0.594752 11.7813 0.358816 11.5438L-1.88399 9.28406C-2.03867 9.12813 -2.03867 8.87656 -1.88399 8.72062ZM8.0016 4.00219V1.62469L5.62379 4.00219H8.0016Z",fill:"currentColor"})}),(0,i.jsx)("g",{clipPath:"url(#clip1_1479_25102)",children:(0,i.jsx)("path",{d:"M0.103056 8.72062L2.09667 6.46094C2.30639 6.22344 2.66667 6.39031 2.66667 6.725V8.2525H5.33333V4.12438C5.33333 3.7275 5.47694 3.34313 5.72694 3.06219L8.05722 0.440625C8.30722 0.159375 8.64611 0 8.99861 0H14.6669C15.4028 0.003125 16 0.675 16 1.50281V14.5003C16 15.3281 15.4028 16 14.6669 16H6.66861C5.9325 16 5.33333 15.3281 5.33333 14.5003V11.2522H6.66667V14.5003H14.6669V1.50281H10.2233V4.75219C10.2233 5.16781 9.92611 5.50187 9.55667 5.50187H6.66667V8.25219H11.2222C11.4064 8.25219 11.5556 8.42 11.5556 8.62719V9.37719C11.5556 9.58438 11.4064 9.75219 11.2222 9.75219H2.66667V11.2797C2.66667 11.6144 2.30639 11.7813 2.09667 11.5438L0.103056 9.28406C-0.0344448 9.12813 -0.0344448 8.87656 0.103056 8.72062ZM8.89028 4.00219V1.62469L6.77666 4.00219H8.89028Z",fill:"currentColor"})}),(0,i.jsxs)("defs",{children:[(0,i.jsx)("clipPath",{id:"clip0_1479_25102",children:(0,i.jsx)("rect",{width:"13",height:"16",fill:"white",transform:"matrix(-1 0 0 1 16 0)"})}),(0,i.jsx)("clipPath",{id:"clip1_1479_25102",children:(0,i.jsx)("rect",{width:"3",height:"16",fill:"white"})})]})]}),lM=e=>(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,i.jsx)("g",{clipPath:"url(#clip0_1426_8619)",children:(0,i.jsx)("path",{d:"M15.5572 3.06188L12.9356 0.440625C12.6544 0.159375 12.2731 0 11.8766 0H5.49969C4.67188 0.003125 4 0.675 4 1.50281V8.25219H0.375C0.167812 8.25219 0 8.42 0 8.62719V9.37719C0 9.58438 0.167812 9.75219 0.375 9.75219H9V11.2797C9 11.6144 9.40531 11.7812 9.64125 11.5437L11.8841 9.28406C12.0388 9.12813 12.0388 8.87656 11.8841 8.72062L9.64125 6.46094C9.40531 6.22344 9 6.39031 9 6.725V8.2525H5.49969V1.50281H10.4987V4.75219C10.4987 5.16781 10.8331 5.50187 11.2487 5.50187H14.5V14.5003H5.49969V11.2522H4V14.5003C4 15.3281 4.67188 16 5.49969 16H14.4978C15.3259 16 16 15.3281 16 14.5003V4.12406C16 3.7275 15.8384 3.34313 15.5572 3.06188ZM11.9984 4.00219V1.62469L14.3763 4.00219H11.9984Z",fill:"black"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"clip0_1426_8619",children:(0,i.jsx)("rect",{width:"16",height:"16",fill:"white"})})})]}),lA=e=>(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,i.jsx)("path",{d:"M14.5607 4.06066L11.9393 1.43934C11.658 1.15804 11.2765 1 10.8787 1H2.5C1.67156 1 1 1.67156 1 2.5V13.5C1 14.3284 1.67156 15 2.5 15H13.5C14.3284 15 15 14.3284 15 13.5V5.12131C15 4.72349 14.842 4.34196 14.5607 4.06066ZM9.5 2.5V5H5.5V2.5H9.5ZM13.3125 13.5H2.6875C2.63777 13.5 2.59008 13.4802 2.55492 13.4451C2.51975 13.4099 2.5 13.3622 2.5 13.3125V2.6875C2.5 2.63777 2.51975 2.59008 2.55492 2.55492C2.59008 2.51975 2.63777 2.5 2.6875 2.5H4V5.75C4 6.16422 4.33578 6.5 4.75 6.5H10.25C10.6642 6.5 11 6.16422 11 5.75V2.62131L13.4451 5.06641C13.4625 5.08382 13.4763 5.10449 13.4857 5.12724C13.4952 5.14999 13.5 5.17438 13.5 5.199V13.3125C13.5 13.3622 13.4802 13.4099 13.4451 13.4451C13.4099 13.4802 13.3622 13.5 13.3125 13.5ZM8 7.25C6.48366 7.25 5.25 8.48366 5.25 10C5.25 11.5163 6.48366 12.75 8 12.75C9.51634 12.75 10.75 11.5163 10.75 10C10.75 8.48366 9.51634 7.25 8 7.25ZM8 11.25C7.31075 11.25 6.75 10.6892 6.75 10C6.75 9.31075 7.31075 8.75 8 8.75C8.68925 8.75 9.25 9.31075 9.25 10C9.25 10.6892 8.68925 11.25 8 11.25Z",fill:"currentColor"})}),lN=e=>(0,i.jsx)("svg",{width:"17",height:"16",viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,i.jsx)("path",{d:"M15.9143 1.75812L14.7422 0.585938C14.3515 0.195312 13.8397 0 13.3278 0C12.8159 0 12.304 0.195312 11.9137 0.585625L9.58593 2.91344L8.5 3.99938L0.901592 11.5975L0.504719 15.1669C0.454719 15.6163 0.80878 16 1.24847 16C1.27628 16 1.3044 15.9984 1.33253 15.9953L4.89939 15.6012L12.5006 8L13.5862 6.91437L15.914 4.58656C16.6953 3.80531 16.6953 2.53906 15.9143 1.75812ZM4.21095 14.1684L2.09909 14.4016L2.3344 12.2863L9.56062 5.06L10.53 4.09062L12.4094 5.97L11.44 6.93937L4.21095 14.1684ZM14.8534 3.52562L13.4697 4.90938L11.5906 3.03L12.9744 1.64625C13.1019 1.51875 13.2506 1.49969 13.3278 1.49969C13.405 1.49969 13.554 1.51875 13.6812 1.64625L14.8534 2.81844C15.0484 3.01375 15.0484 3.33094 14.8534 3.52562Z",fill:"currentColor"})}),lF=e=>(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,i.jsx)("path",{d:"M7.26326 6.5462H8.71794V12.3642H7.26326V6.5462ZM7.9906 3.1102C7.43278 3.1102 6.97888 3.5641 6.97888 4.12192C6.97888 4.67974 7.43278 5.13364 7.9906 5.13364C8.54842 5.13364 9.00232 4.67974 9.00232 4.12192C9.00232 3.5641 8.54842 3.1102 7.9906 3.1102ZM16 8C16 12.411 12.411 16 8 16C3.589 16 0 12.411 0 8C0 3.589 3.589 0 8 0C12.411 0 16 3.589 16 8ZM14.5453 8C14.5453 4.3906 11.6093 1.4546 7.99992 1.4546C4.39052 1.4546 1.45452 4.3914 1.45452 8.0006C1.45452 11.6098 4.39052 14.546 7.99992 14.546C11.6093 14.546 14.5453 11.6092 14.5453 8.0006V8Z",fill:"currentColor"})});var lq=t(94765),lH=t.n(lq);function lP(e){let n=(0,lD.D)(e);return(0,i9.WU)(n,"yyyy-MM-dd'T'HH:mm:ss")}function lV(e){return Object.values(e).every(e=>null===e)?[(0,i.jsx)(c.k,{ml:"10px",children:"No information"},"no info")]:Object.entries(e).filter(e=>{let[n,t]=e;return"url"!==n&&null!=t}).map(e=>{let[n,t]=e;return(0,i.jsxs)(t7.HC,{ml:"10px",children:[n,": ",t]},n)})}function lW(){var e,n,t,l,s,a;let{envInfo:d,reviewMode:u,lineageGraph:x}=eM(),{isOpen:m,onOpen:p,onClose:f}=(0,G.q)(),g=null==d?void 0:d.git,v=null==d?void 0:d.pullRequest,j={...g,...v},y=null==d?void 0:null===(e=d.dbt)||void 0===e?void 0:e.base,b=null==d?void 0:null===(n=d.dbt)||void 0===n?void 0:n.current,w=(null==y?void 0:y.generated_at)?lP(y.generated_at):"",k=(null==b?void 0:b.generated_at)?lP(b.generated_at):"",C=new Set,_=new Set;if(null==x?void 0:x.nodes)for(let e of Object.values(x.nodes))(null===(s=e.data.base)||void 0===s?void 0:s.schema)&&C.add(e.data.base.schema),(null===(a=e.data.current)||void 0===a?void 0:a.schema)&&_.add(e.data.current.schema);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nW.u,{label:"Environment Info",placement:"bottom-end",children:(0,i.jsx)(nu.h,{size:"sm",variant:"unstyled","aria-label":"Export state",onClick:p,icon:(0,i.jsx)(o.J,{verticalAlign:"middle",as:lF,boxSize:"16px"})})}),(0,i.jsxs)(Y.u_,{isOpen:m,onClose:f,size:"3xl",children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{children:[(0,i.jsx)(en.x,{children:"Environment Information"}),(0,i.jsx)(eN.o,{}),(0,i.jsx)(et.f,{children:(0,i.jsxs)(c.k,{direction:"column",gap:"5px",children:[u?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(c.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(h.X,{size:"sm",children:"Review Information"}),(0,i.jsxs)(t7.QI,{spacing:1,children:[j.url&&(0,i.jsxs)(t7.HC,{ml:"10px",children:["url:"," ",(0,i.jsx)(r.r,{href:j.url,color:"blue.500",isExternal:!0,children:j.url})]}),!lH()(j)&&lV(j)]})]})}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(c.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(h.X,{size:"sm",children:"Dev Information"}),(0,i.jsx)(t7.QI,{spacing:1,children:g&&lV(g)})]})}),(0,i.jsx)(nK.i,{}),(null==d?void 0:d.adapterType)==="dbt"&&(0,i.jsxs)(c.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(h.X,{size:"sm",children:"DBT"}),(0,i.jsx)(l_.x,{children:(0,i.jsxs)(lS.i,{variant:"simple",children:[(0,i.jsx)(lz.h,{children:(0,i.jsxs)(lR.Tr,{children:[(0,i.jsx)(lI.Th,{}),(0,i.jsx)(lI.Th,{children:"base"}),(0,i.jsx)(lI.Th,{children:"current"})]})}),(0,i.jsxs)(lE.p,{children:[(0,i.jsxs)(lR.Tr,{children:[(0,i.jsx)(lL.Td,{children:"schema"}),(0,i.jsx)(lL.Td,{children:JSON.stringify(Array.from(C))}),(0,i.jsx)(lL.Td,{children:JSON.stringify(Array.from(_))})]}),(0,i.jsxs)(lR.Tr,{children:[(0,i.jsx)(lL.Td,{children:"version"}),(0,i.jsx)(lL.Td,{children:null==y?void 0:y.dbt_version}),(0,i.jsx)(lL.Td,{children:null==b?void 0:b.dbt_version})]}),(0,i.jsxs)(lR.Tr,{children:[(0,i.jsx)(lL.Td,{children:"timestamp"}),(0,i.jsx)(lL.Td,{children:w}),(0,i.jsx)(lL.Td,{children:k})]})]})]})})]}),(null==d?void 0:d.adapterType)==="sqlmesh"&&(0,i.jsxs)(c.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(h.X,{size:"sm",children:"SQLMesh"}),(0,i.jsx)(l_.x,{children:(0,i.jsxs)(lS.i,{variant:"simple",children:[(0,i.jsx)(lz.h,{children:(0,i.jsxs)(lR.Tr,{children:[(0,i.jsx)(lI.Th,{}),(0,i.jsx)(lI.Th,{children:"base"}),(0,i.jsx)(lI.Th,{children:"current"})]})}),(0,i.jsx)(lE.p,{children:(0,i.jsxs)(lR.Tr,{children:[(0,i.jsx)(lL.Td,{children:"Environment"}),(0,i.jsx)(lL.Td,{children:null===(t=d.sqlmesh)||void 0===t?void 0:t.base_env}),(0,i.jsx)(lL.Td,{children:null===(l=d.sqlmesh)||void 0===l?void 0:l.current_env})]})})]})})]})]})}),(0,i.jsx)(el.m,{children:(0,i.jsx)(er.z,{colorScheme:"blue",mr:3,onClick:f,children:"Close"})})]})]})]})}function lK(e){let{current:n,primaryKeys:t,setPrimaryKeys:r,onRunResultOpen:s,runQuery:a,isPending:d}=e;return(0,i.jsxs)(c.k,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,i.jsxs)(l.x,{children:[(0,i.jsxs)(h.X,{as:"h2",size:"md",display:"flex",alignItems:"center",gap:"5px",children:[(0,i.jsx)(o.J,{as:ly.vc4,boxSize:"1.2em"}),"Sandbox"]}),(0,i.jsxs)(ei.x,{fontSize:"xs",color:"gray.500",children:["Compare the run results based on the modified SQL code of model ",(0,i.jsx)("b",{children:null==n?void 0:n.name})]})]}),(0,i.jsx)(m.L,{}),(0,i.jsx)(lj,{defaultPrimaryKeys:t,onPrimaryKeysChange:r}),(0,i.jsx)(nW.u,{label:"Run diff to see the changes",children:(0,i.jsx)(er.z,{size:"xs",marginTop:"16px",fontSize:"14px",onClick:()=>{s(),a()},colorScheme:"blue",isLoading:d,children:"Run Diff"})})]})}function lJ(e){var n,t,l,r;let{currentModelID:o,height:s="32px",flex:a="0 0 auto"}=e,{lineageGraph:d,envInfo:u}=eM(),h="0 16px",x=lP(null!==(l=null==u?void 0:null===(t=u.dbt)||void 0===t?void 0:null===(n=t.current)||void 0===n?void 0:n.generated_at)&&void 0!==l?l:""),m=(0,i_.Q)(x,{addSuffix:!0}),p="N/A";if(null==d?void 0:d.nodes[o]){let e=d.nodes[o];(null===(r=e.data.current)||void 0===r?void 0:r.schema)&&(p=e.data.current.schema)}return(0,i.jsxs)(c.k,{gap:0,height:s,flex:a,fontSize:"14px",align:"center",margin:"0",backgroundColor:"#EDF2F880",children:[(0,i.jsx)(iv.K,{width:"50%",children:(0,i.jsxs)(ei.x,{as:"b",margin:h,children:["ORIGINAL (Schema: ",p,", Last Updated: ",m,")"]})}),(0,i.jsx)(iv.K,{width:"50%",children:(0,i.jsx)(ei.x,{as:"b",margin:h,children:"SANDBOX EDITOR"})})]})}function lB(e){var n;let{current:t,onChange:r}=e,o=function(e,n){let t=(0,b.useRef)(null);return(0,b.useEffect)(()=>{t.current&&e!==t.current.getValue()&&t.current.setValue(e)},[e]),{onMount(e){let i=e.getModifiedEditor();t.current=i,i.onDidChangeModelContent(()=>{n(i.getValue())})}}}(null!==(n=null==t?void 0:t.raw_code)&&void 0!==n?n:"",r);return(0,i.jsx)(l.x,{flex:1,overflowY:"auto",children:(0,i.jsx)(ij.SV,{language:"sql",theme:"vs",original:null==t?void 0:t.raw_code,modified:null==t?void 0:t.raw_code,options:{readOnly:!1,fontSize:14,lineNumbers:"on",automaticLayout:!0,renderOverviewRuler:!1,minimap:{enabled:!0}},onMount:o.onMount})})}function lU(e){var n,t;let{isOpen:o,onClose:d,current:m}=e,{isOpen:p,onClose:f,onOpen:g}=(0,G.q)(),[v,j]=(0,b.useState)(null!==(n=null==m?void 0:m.raw_code)&&void 0!==n?n:""),{showRunId:y,clearRunResult:w}=th(),{primaryKeys:k,setPrimaryKeys:C}=z(),{data:_,isLoading:S}=eD(),R=async()=>{var e;let n={current_model:null!==(e=null==m?void 0:m.name)&&void 0!==e?e:"",primary_keys:k,sql_template:v},{run_id:t}=await lm(n,{nowait:!0});return y(t),await ek(t)},{mutate:I,isPending:E}=(0,tZ.D)({mutationFn:R,onSuccess(e,n){e.error?ex({action:"run",node:null==m?void 0:m.name,status:"failure"}):(ex({action:"run",node:null==m?void 0:m.name,status:"success"}),setTimeout(()=>{L()},1e3),!S&&(null==_?void 0:_.single_env_onboarding)&&setTimeout(()=>{T()},2e3))}}),{feedbackToast:L,closeToast:D}=function(e){let n=(0,s.p)(),{feedbackId:t,description:l,onFeedbackSubmit:r,externalLink:o,externalLinkText:a}=e;return{feedbackToast:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=localStorage.getItem(t);!n.isActive(t)&&("true"!==s||e)&&n({id:t,position:"bottom-right",duration:null,render:e=>{let{id:n,onClose:s}=e;return(0,i.jsx)(t1.b,{status:"success",variant:"subtle",zIndex:"toast",borderColor:"gray.200",borderWidth:3,borderRadius:"md",backgroundColor:"white",opacity:1,children:(0,i.jsx)(lb.X,{fontSize:"md",children:(0,i.jsxs)(x.U,{children:[(0,i.jsx)(lw,{description:l,onLike:()=>{r("like"),s(),localStorage.setItem(t,"true")},onDislike:()=>{r("dislike"),s(),localStorage.setItem(t,"true")},externalLink:o,externalLinkText:a,onClickLink:()=>{r("link")}}),(0,i.jsx)(iB.P,{onClick:()=>{s()}})]})})})}})},closeToast:()=>{n.closeAll()}}}({feedbackId:lC.previewChangeFeedbackID,description:"Enjoy preview change?",onFeedbackSubmit:e=>{switch(e){case"like":em({feedback:"like",node:null==m?void 0:m.name});break;case"dislike":em({feedback:"dislike",node:null==m?void 0:m.name});break;case"link":em({feedback:"form",node:null==m?void 0:m.name});break;default:console.log("Not support feedback type")}},externalLink:"https://docs.google.com/forms/d/e/1FAIpQLSd7Lei7Ijwo7MinWaI0K6rzZi_21gV1BKetmiNEX254kDziDA/viewform?usp=header",externalLinkText:"Give us feedback"}),{guideToast:T,closeGuideToast:O}=function(e){let n=(0,s.p)(),{guideId:t,description:l,externalLink:o,externalLinkText:a,onExternalLinkClick:d}=e;return{guideToast:function(){n.isActive(t)||n({id:t,position:"bottom-right",duration:3e3,description:"some text",render:e=>{let{id:n,onClose:t}=e;return(0,i.jsx)(t1.b,{status:"success",variant:"subtle",zIndex:"toast",borderColor:"gray.200",borderWidth:3,borderRadius:"md",backgroundColor:"white",opacity:1,children:(0,i.jsx)(lb.X,{fontSize:"md",children:(0,i.jsxs)(x.U,{children:[(0,i.jsxs)(ei.x,{children:[l," ",(0,i.jsx)(r.r,{textDecor:"underline",isExternal:!0,href:o,onClick:()=>{d&&d(),t()},children:a})]}),(0,i.jsx)(iB.P,{onClick:()=>{t()}})]})})})}})},closeGuideToast:()=>{n.closeAll()}}}({guideId:lC.prepareEnvGuideID,description:"Want to compare data changes with production data?",externalLink:"https://docs.datarecce.io/get-started/#prepare-dbt-artifacts",externalLinkText:"Learn how.",onExternalLinkClick:()=>{ep({action:"external_link",from:"preview_changes",node:null==m?void 0:m.name})}});return(0,b.useEffect)(()=>{if(o){var e;j(null!==(e=null==m?void 0:m.raw_code)&&void 0!==e?e:"")}},[o,m]),(0,i.jsx)(Y.u_,{isOpen:o,size:"full",onClose:()=>{d(),f(),w(),D(),O(),ex({action:"close",node:null==m?void 0:m.name})},children:(0,i.jsxs)(ee.h,{height:"100%",children:[(0,i.jsx)(en.x,{height:"40px",bg:"rgb(77, 209, 176)",px:0,py:4,children:(0,i.jsxs)(c.k,{alignItems:"center",height:"100%",gap:"10px",children:[(0,i.jsx)(u.E,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,i.jsx)(h.X,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,i.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:"Experiment"})]})}),(0,i.jsx)(eN.o,{}),(0,i.jsx)(et.f,{p:0,children:(0,i.jsxs)(t8,{sizes:p?[50,50]:[100,0],minSize:p?100:0,gutterSize:p?5:0,style:{flex:"1",contain:"size",height:"100%"},children:[(0,i.jsxs)(c.k,{direction:"column",height:"100%",m:0,p:0,children:[(0,i.jsx)(lK,{current:m,primaryKeys:null!=k?k:[],setPrimaryKeys:C,onRunResultOpen:g,runQuery:I,isPending:E}),(0,i.jsx)(lJ,{height:"32pxs",flex:"0 0 auto",currentModelID:null!==(t=null==m?void 0:m.id)&&void 0!==t?t:""}),(0,i.jsx)(lB,{current:m,onChange:j})]}),p?(0,i.jsx)(lu,{onClose:f,disableAddToChecklist:!0}):(0,i.jsx)(l.x,{})]})}),(0,i.jsx)(l.x,{position:"fixed",bottom:"4",right:"4",opacity:.5,children:(0,i.jsx)(nW.u,{label:"Give us feedback",children:(0,i.jsx)(nu.h,{"aria-label":"feedback",icon:(0,i.jsx)(ns.xJq,{}),variant:"ghost",size:"md",onClick:()=>{L(!0)}})})})]})})}let lQ=e=>{var n,t,r,o,s,a;let{node:d}=e,{isOpen:c,onOpen:u,onClose:x}=(0,G.q)(),[m,p]=(0,b.useState)(!1),{data:f,isLoading:g}=eD(),v=null==f?void 0:f.single_env_onboarding;if(g)return(0,i.jsx)(i.Fragment,{});if("model"!==d.resourceType&&"snapshot"!==d.resourceType)return"Not available";let j={readOnly:!0,lineNumbers:"on",automaticLayout:!0,renderOverviewRuler:!1,wordWrap:"off",minimap:{enabled:!1}},y={readOnly:!0,lineNumbers:"on",automaticLayout:!0,wordWrap:"off",minimap:{enabled:!1}},w=null===(n=d.data.base)||void 0===n?void 0:n.raw_code,k=null===(t=d.data.current)||void 0===t?void 0:t.raw_code,C=null!==(a=null!==(s=null===(r=d.data.base)||void 0===r?void 0:r.name)&&void 0!==s?s:null===(o=d.data.current)||void 0===o?void 0:o.name)&&void 0!==a?a:"";return(0,i.jsxs)(l.x,{style:{position:"relative"},height:"100%",onMouseEnter:()=>{p(!0)},onMouseLeave:()=>{p(!1)},children:[v?(0,i.jsx)(iy,{language:"sql",theme:"vs",value:null!=w?w:"",options:y}):(0,i.jsx)(ij.SV,{language:"sql",theme:"vs",original:w,modified:k,options:{...j,renderSideBySide:!1}}),(0,i.jsx)(nu.h,{icon:(0,i.jsx)(ie.Tlm,{}),onClick:u,size:"md","aria-label":"",variant:"ghost",style:{position:"absolute",top:"5px",right:"20px",opacity:m?.5:.1,transition:"opacity 0.3s ease-in-out"}}),(0,i.jsxs)(Y.u_,{isOpen:c,onClose:x,size:"6xl",children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{overflowY:"auto",height:"75%",children:[(0,i.jsx)(en.x,{children:v?(0,i.jsxs)(h.X,{as:"h1",size:"md",children:[(0,i.jsx)("code",{children:C})," Model Code"]}):(0,i.jsxs)(h.X,{as:"h1",size:"md",children:[(0,i.jsx)("code",{children:C})," Model Code Diff"]})}),(0,i.jsx)(eN.o,{}),(0,i.jsx)(et.f,{children:v?(0,i.jsx)(ij.ML,{language:"sql",theme:"vs",value:null!=w?w:"",options:{...y,fontSize:16}}):(0,i.jsx)(ij.SV,{language:"sql",theme:"vs",original:w,modified:k,options:{...j,fontSize:16}})})]})]})]})};function lZ(e){let{node:n,onCloseNode:t}=e,[,r]=(0,eq.TH)(),{setSqlQuery:s,setPrimaryKeys:a}=z(),d="model"===n.resourceType||"seed"===n.resourceType||"source"===n.resourceType||"snapshot"===n.resourceType,{isOpen:u,onOpen:v,onClose:j}=(0,G.q)(),{isOpen:y,onClose:w}=(0,G.q)({defaultIsOpen:!0}),{runAction:k}=th(),{envInfo:C,isActionAvailable:_}=eM(),{primaryKey:S}=eU(n.name),R=()=>{k("row_count",{node_names:[n.name]},{showForm:!1,showLast:!1})},I=()=>{k("row_count_diff",{node_names:[n.name]},{showForm:!1,showLast:!1})},{data:E}=eD(),L=null==E?void 0:E.single_env_onboarding,D=(0,b.useCallback)(async()=>{let e=n.id,t=await iU({node_id:e});r("/checks/".concat(t.check_id))},[n,r]),T=(e,n)=>e?iQ.add_or_remove:_(n)?"":"value_diff"===n?iQ.audit_helper:"profile_diff"===n||"profile"===n?iQ.dbt_profiler:"This action is not supported yet.",O="added"===n.changeStatus||"removed"===n.changeStatus;return(0,i.jsxs)(iJ.r,{height:"100%",templateRows:"auto auto 1fr",children:[(0,i.jsxs)(x.U,{children:[(0,i.jsx)(l.x,{flex:"0 1 20%",p:"16px",children:(0,i.jsx)(h.X,{size:"sm",children:n.name})}),(0,i.jsx)(m.L,{}),L?(0,i.jsx)(function(){var e,t,l;return"model"!==n.resourceType&&"seed"!==n.resourceType&&"snapshot"!==n.resourceType?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(n1.v,{children:[(0,i.jsx)(n5.j,{as:er.z,size:"xs",variant:"outline",rightIcon:(0,i.jsx)(i1.v,{}),children:"Explore"}),(0,i.jsxs)(n4.q,{children:[(0,i.jsx)(n3.s,{icon:(0,i.jsx)(o.J,{as:null===(e=ta("query"))||void 0===e?void 0:e.icon}),fontSize:"14px",onClick:()=>{(null==C?void 0:C.adapterType)==="dbt"?s('select * from {{ ref("'.concat(n.name,'") }}')):(null==C?void 0:C.adapterType)==="sqlmesh"&&s("select * from ".concat(n.name)),r("/query")},children:"Query"}),(0,i.jsx)(n3.s,{icon:(0,i.jsx)(o.J,{as:null===(t=ta("row_count"))||void 0===t?void 0:t.icon}),fontSize:"14px",onClick:()=>{R()},children:"Row Count"}),(0,i.jsx)(nW.u,{label:T(O,"profile"),placement:"left",children:(0,i.jsx)(n3.s,{icon:(0,i.jsx)(o.J,{as:null===(l=ta("profile"))||void 0===l?void 0:l.icon}),fontSize:"14px",isDisabled:O||!_("profile"),onClick:()=>{k("profile",{model:n.name},{showForm:!0,showLast:!1})},children:"Profile"})})]})]})},{}):(0,i.jsx)(function(){var e,t,l,d,c,u,h,x;let{readOnly:m}=tn();return"model"!==n.resourceType&&"seed"!==n.resourceType&&"snapshot"!==n.resourceType?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(n1.v,{children:[(0,i.jsx)(n5.j,{as:er.z,size:"xs",variant:"outline",rightIcon:(0,i.jsx)(i1.v,{}),isDisabled:m,children:"Explore"}),(0,i.jsxs)(n4.q,{children:[(0,i.jsx)(n3.s,{icon:(0,i.jsx)(o.J,{as:null===(e=ta("query_diff"))||void 0===e?void 0:e.icon}),fontSize:"14px",onClick:()=>{(null==C?void 0:C.adapterType)==="dbt"?s('select * from {{ ref("'.concat(n.name,'") }}')):(null==C?void 0:C.adapterType)==="sqlmesh"&&s("select * from ".concat(n.name)),_("query_diff_with_primary_key")&&a(void 0!==S?[S]:void 0),r("/query")},children:"Query"}),(0,i.jsx)(n3.s,{fontSize:"14px",icon:(0,i.jsx)(o.J,{as:null===(t=ta("sandbox"))||void 0===t?void 0:t.icon}),onClick:()=>{_("query_diff_with_primary_key")&&a(void 0!==S?[S]:void 0),v(),ex({action:"explore",node:n.name})},children:"Sandbox (Experiment)"}),(0,i.jsx)(tA.R,{}),(0,i.jsxs)(n6.k,{title:"Diff",m:"0",p:"4px 12px",children:[(0,i.jsx)(n3.s,{icon:(0,i.jsx)(o.J,{as:null===(l=ta("row_count_diff"))||void 0===l?void 0:l.icon}),fontSize:"14px",onClick:()=>{I()},children:"Row Count Diff"}),(0,i.jsx)(nW.u,{label:T(O,"profile_diff"),placement:"left",children:(0,i.jsx)(n3.s,{icon:(0,i.jsx)(o.J,{as:null===(d=ta("profile_diff"))||void 0===d?void 0:d.icon}),fontSize:"14px",isDisabled:O||!_("profile_diff"),onClick:()=>{k("profile_diff",{model:n.name},{showForm:!0,showLast:!1})},children:"Profile Diff"})}),(0,i.jsx)(nW.u,{label:T(O,"value_diff"),placement:"left",children:(0,i.jsx)(n3.s,{icon:(0,i.jsx)(o.J,{as:null===(c=ta("value_diff"))||void 0===c?void 0:c.icon}),fontSize:"14px",isDisabled:O||!_("value_diff"),onClick:()=>{k("value_diff",{model:n.name},{showForm:!0,showLast:!1})},children:"Value Diff"})}),(0,i.jsx)(nW.u,{label:T(O,"top_k_diff"),placement:"left",children:(0,i.jsx)(n3.s,{icon:(0,i.jsx)(o.J,{as:null===(u=ta("top_k_diff"))||void 0===u?void 0:u.icon}),fontSize:"14px",isDisabled:O,onClick:()=>{k("top_k_diff",{model:n.name,column_name:"",k:50},{showForm:!0})},children:"Top-K Diff"})}),(0,i.jsx)(nW.u,{label:T(O,"histogram_diff"),placement:"left",children:(0,i.jsx)(n3.s,{icon:(0,i.jsx)(o.J,{as:null===(h=ta("histogram_diff"))||void 0===h?void 0:h.icon}),fontSize:"14px",isDisabled:O,onClick:()=>{k("histogram_diff",{model:n.name,column_name:"",column_type:""},{showForm:!0})},children:"Histogram Diff"})})]}),(0,i.jsx)(tA.R,{}),(0,i.jsx)(n6.k,{title:"Add to Checklist",m:"0",p:"4px 12px",children:(0,i.jsx)(n3.s,{icon:(0,i.jsx)(o.J,{as:null===(x=ta("schema_diff"))||void 0===x?void 0:x.icon}),fontSize:"14px",onClick:()=>{D()},children:"Schema Diff"})})]})]})},{}),(0,i.jsx)(l.x,{flex:"0 1 1%",children:(0,i.jsx)(iB.P,{onClick:t})})]}),(0,i.jsx)(l.x,{color:"gray",paddingLeft:"16px",children:(0,i.jsxs)(x.U,{spacing:"8px",children:[(0,i.jsx)(iM,{node:n}),("model"===n.resourceType||"snapshot"===n.resourceType||"seed"===n.resourceType)&&(L?(0,i.jsx)(iF,{node:n,onRefresh:R}):(0,i.jsx)(iN,{node:n,onRefresh:I}))]})}),d&&(0,i.jsxs)(p.m,{overflow:"auto",as:c.k,children:[L&&y&&(0,i.jsx)(l.x,{p:"12px",children:(0,i.jsx)(lr,{onClose:w,align:"flex-start",children:(0,i.jsxs)(ei.x,{children:["Enable the Recce Checklist and start adding checks for better data validation and review.",(0,i.jsx)("br",{}),(0,i.jsx)(lo,{})]})})}),(0,i.jsxs)(f.t,{children:[(0,i.jsx)(g.O,{children:"Columns"}),(0,i.jsx)(g.O,{children:"Code"})]}),(0,i.jsxs)(tN.n,{overflow:"auto",height:"calc(100% - 42px)",children:[(0,i.jsx)(tF.x,{p:0,overflowY:"auto",height:"100%",children:L?(0,i.jsx)(t4,{current:n.data.current}):(0,i.jsx)(t2,{base:n.data.base,current:n.data.current})}),(0,i.jsx)(tF.x,{height:"100%",p:0,children:(0,i.jsx)(lQ,{node:n})})]})]}),(0,i.jsx)(lU,{isOpen:u,onClose:j,current:n.data.current})]})}function lX(e){var n,t;let{onClose:r}=e,{cancel:o,actionState:s}=tG();return(0,i.jsx)(l.x,{bg:"white",rounded:"md",shadow:"dark-lg",children:(0,i.jsxs)(x.U,{p:"5px 15px",mt:"4",divider:(0,i.jsx)(iz.c,{borderColor:"gray.200"}),spacing:4,children:[(0,i.jsxs)(l.x,{fontSize:"10pt",children:["Progress: ","per_node"===s.mode?"".concat(s.completed," / ").concat(s.total):(null===(t=s.currentRun)||void 0===t?void 0:null===(n=t.progress)||void 0===n?void 0:n.percentage)?"".concat(100*s.currentRun.progress.percentage,"%"):"completed"===s.status?"100%":"0%"," ","canceled"===s.status?" (canceled)":""]}),"running"===s.status||"canceling"===s.status?(0,i.jsx)(er.z,{size:"xs",variant:"outline",onClick:o,isLoading:"canceling"===s.status,loadingText:"Canceling",children:"Cancel"}):(0,i.jsx)(x.U,{children:(0,i.jsx)(er.z,{size:"xs",variant:"outline",onClick:r,children:"Close"})})]})})}let lG=()=>(0,i.jsxs)(nb.g,{align:"start",spacing:0,children:[(0,i.jsx)(ei.x,{fontSize:"10pt",color:"gray.500",pb:1,children:"Select nodes by dbt node selector syntax"}),(0,i.jsxs)(ei.x,{fontSize:"8pt",children:[(0,i.jsx)(d.E,{fontSize:"8pt",children:"model_name"})," Select a node"]}),(0,i.jsxs)(ei.x,{fontSize:"8pt",children:[(0,i.jsx)(d.E,{fontSize:"8pt",children:"model_name+"})," Select downstream nodes"]}),(0,i.jsxs)(ei.x,{fontSize:"8pt",children:[(0,i.jsx)(d.E,{fontSize:"8pt",children:"+model_name"})," Select upstream nodes"]}),(0,i.jsxs)(ei.x,{fontSize:"8pt",children:[(0,i.jsx)(d.E,{fontSize:"8pt",children:"model*"})," Select by wildcard"]})]}),lY=()=>{let{isHistoryOpen:e,showHistory:n,closeHistory:t}=th();return(0,i.jsx)(er.z,{leftIcon:(0,i.jsx)(o.J,{as:ns.M1Q}),size:"xs",variant:"outline",onClick:()=>{e?(eh({name:"hide"}),t()):(eh({name:"show"}),n())},children:e?"Hide":"Show"})},l$=e=>{var n;let{isDisabled:t}=e,{viewOptions:l,onViewOptionsChanged:r}=tG(),s=null!==(n=l.view_mode)&&void 0!==n?n:"changed_models",a=e=>{r({...l,view_mode:e})};return(0,i.jsxs)(n1.v,{children:[(0,i.jsx)(n5.j,{as:er.z,minWidth:"100px",leftIcon:(0,i.jsx)(o.J,{as:is("model").icon}),size:"xs",variant:"outline",isDisabled:t,rightIcon:(0,i.jsx)(i1.v,{}),children:"changed_models"===s?"Changed Models":"All"}),(0,i.jsxs)(n4.q,{title:"packages",children:[(0,i.jsx)(n3.s,{as:nT.X,size:"sm",isChecked:"changed_models"===s,onChange:()=>{a("changed_models")},children:"Changed Models"}),(0,i.jsx)(n3.s,{as:nT.X,size:"sm",isChecked:"all"===s,onChange:()=>{a("all")},children:"All"})]})]})},l0=e=>{var n,t;let{isDisabled:l}=e,{lineageGraph:r}=eM(),{viewOptions:s,onViewOptionsChanged:a}=tG(),d=new Set;for(let e of Object.values(null!==(t=null==r?void 0:r.nodes)&&void 0!==t?t:{}))e.packageName&&d.add(e.packageName);let c=null==r?void 0:null===(n=r.manifestMetadata.current)||void 0===n?void 0:n.project_name,u=s.packages?new Set(s.packages):c?new Set([c]):d,h=u.size===d.size,x=0===u.size,m=1===u.size?Array.from(u)[0]:h?"All Packages":x?"No Package":"".concat(u.size," Packages"),p=e=>{let n=new Set(u);n.has(e)?n.delete(e):n.add(e),a({...s,packages:Array.from(n)})};return(0,i.jsxs)(n1.v,{closeOnSelect:!1,children:[(0,i.jsx)(n5.j,{as:er.z,minWidth:"100px",leftIcon:(0,i.jsx)(o.J,{as:iT.zFh}),size:"xs",variant:"outline",isDisabled:l,rightIcon:(0,i.jsx)(i1.v,{}),children:m}),(0,i.jsx)(n4.q,{title:"packages",children:(0,i.jsxs)(n6.k,{title:"Select Packages",children:[(0,i.jsx)(n3.s,{as:nT.X,size:"sm",isIndeterminate:!h&&!x,isChecked:h,onChange:()=>{h?a({...s,packages:[]}):a({...s,packages:Array.from(d)})},children:"Select All"}),(0,i.jsx)(tA.R,{}),Array.from(d).map(e=>(0,i.jsx)(n3.s,{as:nT.X,size:"sm",isChecked:u.has(e),onChange:()=>{p(e)},children:e},e))]})})]})},l1=e=>{let[n,t]=(0,b.useState)(e.value),{data:l}=eD(),r=(0,b.useRef)(null);return(0,b.useEffect)(()=>{r.current&&(r.current.value=e.value)},[e.value]),(0,i.jsx)(nW.u,{width:"300px",padding:2,shadow:"md",borderWidth:1,rounded:"md",styleConfig:{zIndex:"dropdown"},label:e.tooltipComponent,placement:"bottom-start",color:"black",backgroundColor:"white",closeOnClick:!1,isDisabled:!(null==l?void 0:l.single_env_onboarding),children:(0,i.jsx)(nY.I,{ref:r,height:"24px",fontSize:"10pt",placeholder:"with selectors",isDisabled:e.isDisabled,value:n,onChange:e=>{t(e.target.value)},onKeyUp:i=>{"Enter"===i.key?e.onChange(n):"Escape"===i.key&&(i.preventDefault(),t(e.value),r.current&&r.current.blur())},onBlur:()=>{t(e.value)}})})},l5=e=>{var n;let{isDisabled:t}=e,{viewOptions:l,onViewOptionsChanged:r}=tG();return(0,i.jsx)(l1,{isDisabled:t,value:null!==(n=l.select)&&void 0!==n?n:"",onChange:e=>{r({...l,select:e||void 0})},tooltipComponent:(0,i.jsx)(lG,{})})},l2=e=>{var n;let{isDisabled:t}=e,{viewOptions:l,onViewOptionsChanged:r}=tG();return(0,i.jsx)(l1,{isDisabled:t,value:null!==(n=l.exclude)&&void 0!==n?n:"",onChange:e=>{r({...l,exclude:e||void 0})}})},l4=e=>(0,i.jsxs)(l.x,{style:e.style,maxWidth:"300px",children:[(0,i.jsx)(l.x,{fontSize:"8pt",children:e.label||(0,i.jsx)(i.Fragment,{children:"\xa0"})}),e.children]}),l6=()=>{var e,n,t,l,r;let{deselect:s,focusedNode:a,selectedNodes:d,...c}=tG(),{isActionAvailable:u}=eM(),{readOnly:h}=tn(),{data:p}=eD(),f=null==p?void 0:p.single_env_onboarding,g=!!a,v=d.length>0,j=!g&&!v;return(0,i.jsx)(x.U,{width:"100%",padding:"4pt 8pt",children:(0,i.jsxs)(x.U,{flex:"1",children:[(0,i.jsx)(l4,{label:"History",style:{flexShrink:"1"},children:(0,i.jsx)(lY,{})}),(0,i.jsx)(l4,{label:"Mode",style:{flexShrink:"1"},children:(0,i.jsx)(l$,{isDisabled:v})}),(0,i.jsx)(l4,{label:"Package",style:{flexShrink:"1"},children:(0,i.jsx)(l0,{isDisabled:v})}),(0,i.jsx)(l4,{label:"Select",style:{flex:"100 1 auto"},children:(0,i.jsx)(l5,{isDisabled:v})}),(0,i.jsx)(l4,{label:"Exclude",style:{flex:"100 1 auto"},children:(0,i.jsx)(l2,{isDisabled:v})}),(0,i.jsx)(m.L,{}),v&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l4,{label:"",style:{flexShrink:"0"},children:(0,i.jsx)(ei.x,{fontSize:"9pt",color:"gray.500",children:d.length>1?"".concat(d.length," nodes selected"):"".concat(d.length," node selected")})}),(0,i.jsx)(l4,{label:"",children:(0,i.jsx)(er.z,{variant:"outline",size:"xs",fontSize:"9pt",onClick:()=>{s()},children:"Deselect"})}),f&&(0,i.jsx)(l4,{label:"Explore",children:(0,i.jsx)(nk.h,{isAttached:!0,variant:"outline",children:(0,i.jsxs)(n1.v,{placement:"bottom-end",children:[(0,i.jsx)(n5.j,{as:er.z,size:"xs",rightIcon:(0,i.jsx)(i1.v,{}),children:"Actions"}),(0,i.jsx)(n4.q,{children:(0,i.jsx)(n3.s,{as:ei.x,size:"sm",fontSize:"10pt",isDisabled:!(j||g||v),icon:(0,i.jsx)(o.J,{as:null===(e=ta("row_count_diff"))||void 0===e?void 0:e.icon}),onClick:async()=>{await c.runRowCount()},children:"Row Count"})})]})})})]}),!f&&(0,i.jsx)(l4,{label:"Explore",children:(0,i.jsx)(nk.h,{isAttached:!0,variant:"outline",children:(0,i.jsxs)(n1.v,{placement:"bottom-end",children:[(0,i.jsx)(n5.j,{as:er.z,size:"xs",rightIcon:(0,i.jsx)(i1.v,{}),isDisabled:h,children:"Actions"}),(0,i.jsxs)(n4.q,{children:[(0,i.jsxs)(n6.k,{title:"Diff",m:"0",p:"4px 12px",children:[(0,i.jsx)(n3.s,{as:ei.x,size:"sm",fontSize:"10pt",isDisabled:!(j||g||v),icon:(0,i.jsx)(o.J,{as:null===(n=ta("row_count_diff"))||void 0===n?void 0:n.icon}),onClick:async()=>{await c.runRowCountDiff()},children:"Row Count Diff"}),(0,i.jsx)(nW.u,{label:u("value_diff")?null:iQ.audit_helper,placement:"left",children:(0,i.jsx)(n3.s,{as:ei.x,size:"sm",fontSize:"10pt",isDisabled:!(j||g||v)||!u("value_diff"),icon:(0,i.jsx)(o.J,{as:null===(t=ta("value_diff"))||void 0===t?void 0:t.icon}),onClick:async()=>{await c.runValueDiff()},children:"Value Diff"})})]}),(0,i.jsx)(tA.R,{}),(0,i.jsxs)(n6.k,{title:"Add to Checklist",m:"0",px:"12px",children:[(0,i.jsx)(n3.s,{as:ei.x,size:"sm",fontSize:"10pt",isDisabled:!(j||v&&d.length>1),icon:(0,i.jsx)(o.J,{as:null===(l=ta("lineage_diff"))||void 0===l?void 0:l.icon}),onClick:()=>{c.addLineageDiffCheck(c.viewOptions.view_mode)},children:"Lineage Diff"}),(0,i.jsx)(n3.s,{as:ei.x,size:"sm",fontSize:"10pt",isDisabled:!(j||g||v),icon:(0,i.jsx)(o.J,{as:null===(r=ta("schema_diff"))||void 0===r?void 0:r.icon}),onClick:()=>{c.addSchemaDiffCheck()},children:"Schema Diff"})]})]})]})})})]})})};async function l3(e){return(await U.post("/api/checks",{type:"lineage_diff",params:{},view_options:e})).data}function l9(){return(0,i.jsx)(l.x,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[n,[t,l]]=e,{icon:r,color:s}=io(n);return(0,i.jsx)(nW.u,{label:l,placement:"right",children:(0,i.jsxs)(c.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,i.jsx)(o.J,{color:s,as:r})," ",t]})},n)})})}let l8={mode:"per_node",status:"pending",completed:0,total:0,actions:{}},l7=(e,n)=>{let{onActionStarted:t,onActionNodeUpdated:i,onActionCompleted:l}=n,r=(0,b.useRef)({...l8}).current,{showRunId:o}=th(),s=async(n,s,a)=>{r.mode="multi_nodes",r.actions={};let d=r.mode,c=r.actions;t(),r.status="running";let u=[];for(let n of e){let e=s(n);e?(c[n.id]={mode:d,status:"skipped",skipReason:e},i(n)):(c[n.id]={mode:d,status:"pending"},u.push(n))}let h=a(u);try{let{run_id:e}=await ew(n,h,{nowait:!0});for(o(e),r.currentRun={run_id:e},r.total=1;;){let n=await ek(e,2);r.currentRun=n;let t=n.error?"failure":n.result?"success":"running";for(let e of u)c[e.id]={mode:d,status:t,run:n},i(e);if(n.error||n.result)break}}catch(e){}if(r.completed=1,"canceling"===r.status){r.status="canceled",l();return}r.status="completed",l()},a=async(n,o)=>{r.mode="per_node",r.actions={};let s=r.mode,a=r.actions;for(let n of(t(),r.status="running",e))a[n.id]={mode:s,status:"pending"},i(n);for(let t of(r.completed=0,r.total=e.length,e)){let{params:e,skipReason:d}=o(t);if(d)a[t.id]={mode:s,status:"skipped",skipReason:d},i(t);else try{let{run_id:l}=await ew(n,e,{nowait:!0});for(r.currentRun={run_id:l},a[t.id]={mode:s,status:"running"},i(t);;){let e=await ek(l,2);r.currentRun=e;let n=e.error?"failure":e.result?"success":"running";if(a[t.id]={mode:s,status:n,run:e},i(t),e.error||e.result)break}}catch(e){}finally{r.currentRun=void 0}if(r.completed++,"canceling"===r.status){r.status="canceled",l();return}}r.status="completed",l()},d=async()=>{let n=[];for(let t of e)"model"!==t.resourceType?(r.actions[t.id]={mode:"multi_nodes",status:"skipped",skipReason:"Not a model"},i(t)):n.push(t.name);await s("row_count",e=>{if("model"!==e.resourceType)return"Not a model"},e=>({node_names:e.map(e=>e.name)}))},c=async()=>{let n=[];for(let t of e)"model"!==t.resourceType?(r.actions[t.id]={mode:"multi_nodes",status:"skipped",skipReason:"Not a model"},i(t)):n.push(t.name);await s("row_count_diff",e=>{if("model"!==e.resourceType)return"Not a model"},e=>({node_names:e.map(e=>e.name)}))},u=async()=>{var e;r.status="canceling",(null===(e=r.currentRun)||void 0===e?void 0:e.run_id)&&await eC(r.currentRun.run_id)};return{actionState:r,runRowCount:d,runRowCountDiff:c,runValueDiff:async()=>{await a("value_diff",e=>{var n;let t=null===(n=e.data.current)||void 0===n?void 0:n.primary_key;return t?{params:{model:e.name,primary_key:t}}:{skipReason:"No primary key found. The first unique column is used as primary key."}})},addLineageDiffCheck:async()=>{let n=e.map(e=>e.id);return await l3({node_ids:n})},addSchemaDiffCheck:async()=>{let n;if(1===e.length)n=await iU({node_id:e[0].id});else{let t=e.map(e=>e.id);n=await iU({node_id:t})}return n},cancel:u,reset:()=>{Object.assign(r,l8)}}};var re=t(12276),rn=function(){let{isOpen:e,onOpen:n,onClose:t}=(0,G.q)(),[r,o]=(0,b.useState)(0),[s,a]=(0,b.useState)(),d=(0,b.useRef)(),u=(0,b.useCallback)(e=>(o(e),new Promise(e=>{a(()=>e),n()})),[n]),h=()=>{null==s||s(!1),t()};return{confirm:u,AlertDialog:(0,i.jsx)(re.aR,{size:"xl",isOpen:e,leastDestructiveRef:d,onClose:h,children:(0,i.jsx)($.Z,{children:(0,i.jsxs)(re._T,{children:[(0,i.jsxs)(en.x,{fontSize:"lg",fontWeight:"bold",children:["Value Diff on ",r," nodes"]}),(0,i.jsx)(et.f,{gap:"20px",as:c.k,direction:"column",children:(0,i.jsxs)(l.x,{children:["Value diff will be executed on ",r," nodes in the Lineage, which can add extra costs to your bill."]})}),(0,i.jsxs)(el.m,{children:[(0,i.jsx)(er.z,{ref:d,onClick:h,children:"Cancel"}),(0,i.jsx)(er.z,{colorScheme:"blue",onClick:()=>{null==s||s(!0),t()},ml:3,children:"Execute"})]})]})})})}},rt=t(77938),ri=t(54405);let rl="recce",rr={recommendationIgnored:"".concat(rl,"-recommendation-ignored"),recommendationShowed:"".concat(rl,"-recommendation-showed"),prevRefreshTimeStamp:"".concat(rl,"-prev-refresh-timestamp"),lineageNotificationDismissed:"".concat(rl,"-lineage-notification-dismissed")},ro=()=>{var e;let n=(0,w.a)({queryKey:q.checks(),queryFn:tI}),t=(0,b.useMemo)(()=>{if("success"===n.status&&n.data.length>0){let e=n.data.filter(e=>e.is_preset).findLast(e=>"row_count_diff"===e.type);if(e)return e}},[n]),i=(0,w.a)({queryKey:(null==t?void 0:t.check_id)?q.check(t.check_id):[],queryFn:async()=>{if(null==t?void 0:t.check_id)return tE(t.check_id)},enabled:!!(null==t?void 0:t.check_id)}),l=(0,w.a)({queryKey:(null==t?void 0:t.check_id)?[...q.check(t.check_id),"select"]:[],queryFn:async()=>{var e,n;return t6({select:null==t?void 0:null===(e=t.params)||void 0===e?void 0:e.select,exclude:null==t?void 0:null===(n=t.params)||void 0===n?void 0:n.exclude})},enabled:!!(null==t?void 0:null===(e=t.params)||void 0===e?void 0:e.select)}),r=(0,b.useMemo)(()=>{if(t){var e,n;if(null===(e=t.params)||void 0===e?void 0:e.node_names)return t.params.node_names;if(null===(n=t.params)||void 0===n?void 0:n.node_ids)return t.params.node_ids}if("success"===l.status&&l.data)return l.data.nodes},[t,l]);return{recommendedCheck:i.data,selectedNodes:r}},rs=()=>{let{readOnly:e}=tn(),{lineageGraph:n,envInfo:t}=eM(),{showRunId:l}=th(),{data:r}=eD(),o=(0,k.NL)(),{recommendedCheck:s,selectedNodes:a}=ro(),[d,u]=(0,b.useState)(),[h,p]=(0,b.useState)(!1),[f,g]=(0,b.useState)(!1),[v,j]=(0,b.useState)(!1),{isOpen:y,onOpen:w,onClose:C}=(0,G.q)(),_=rr.recommendationIgnored,S=rr.recommendationShowed,z=rr.prevRefreshTimeStamp;(0,b.useEffect)(()=>{sessionStorage.getItem(_)&&g(!0)},[_]),(0,b.useEffect)(()=>{var e,i,l,r,o,d,c,h,x,m;if(!s||!a)return;if(null===(e=s.last_run)||void 0===e?void 0:e.run_id){let e=new Date(s.last_run.run_at).getTime(),n=null==t?void 0:t.dbt,i=Math.max((null==n?void 0:null===(r=n.current)||void 0===r?void 0:r.generated_at)?new Date(n.current.generated_at).getTime():0,(null==n?void 0:null===(o=n.base)||void 0===o?void 0:o.generated_at)?new Date(n.base.generated_at).getTime():0);if(e>=i){p(!0);return}p(!1),j(!0);let l=sessionStorage.getItem(z);(null===l||parseInt(l)!==i)&&(sessionStorage.setItem(z,i.toString()),sessionStorage.removeItem(_),sessionStorage.removeItem(S),g(!1))}let f=e=>e.map(e=>{var t;return null==n?void 0:null===(t=n.nodes[e])||void 0===t?void 0:t.name}).join(", ");if(a.length>0&&a.length<=3){if(null===(d=s.params)||void 0===d?void 0:d.node_names){let e=null===(h=s.params)||void 0===h?void 0:h.node_names.join(", ");u("'".concat(e,"'"))}else if(null===(c=s.params)||void 0===c?void 0:c.node_ids){let e=f(null===(x=s.params)||void 0===x?void 0:x.node_ids);u("'".concat(e,"'"))}else if(a){let e=f(a);u("'".concat(e,"'"))}}else(null==n?void 0:n.modifiedSet.length)===a.length?u("modified and potentially impacted models"):(null===(i=s.params)||void 0===i?void 0:i.select)&&!(null===(l=s.params)||void 0===l?void 0:l.exclude)?u("'".concat(null===(m=s.params)||void 0===m?void 0:m.select,"'")):u("".concat(a.length," models"));if(!sessionStorage.getItem(S)){let e=sessionStorage.getItem(z);sessionStorage.setItem(S,"true"),ef({action:"recommend",from:null===e?"initial":"rerun"})}},[s,a,n,_,S,z,t]);let R=(0,b.useCallback)(async()=>{s&&(l((await e_(s.check_id,{nowait:!0})).run_id),await o.invalidateQueries({queryKey:q.check(s.check_id)}))},[s,l,o]);if(!s||!a||(null==r?void 0:r.single_env_onboarding))return(0,i.jsx)(i.Fragment,{});let I=a.length;return!f&&!h&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.U,{width:"100%",padding:"2pt 8pt",backgroundColor:"blue.50",children:(0,i.jsxs)(x.U,{flex:"1",fontSize:"10pt",color:"blue.600",children:[v?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ri.i,{}),(0,i.jsx)(ei.x,{children:"New dbt build detected - Re-run row count checks to maintain result accuracy"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(rt.h,{}),(0,i.jsxs)(ei.x,{children:["First Check: Perform a row count diff of ",d," for basic impact assessment"]})]}),(0,i.jsx)(m.L,{}),(0,i.jsx)(er.z,{size:"xs",onClick:()=>{g(!0),sessionStorage.setItem(_,"true"),ef({action:"ignore",from:v?"rerun":"initial",nodes:I})},children:"Ignore"}),(0,i.jsx)(er.z,{colorScheme:"blue",size:"xs",onClick:()=>{w(),ef({action:"perform",from:v?"rerun":"initial",nodes:I})},isDisabled:e,children:"Perform"})]})}),(0,i.jsxs)(Y.u_,{isOpen:y,onClose:()=>{C(),ef({action:"close",from:v?"rerun":"initial",nodes:I})},isCentered:!0,children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{children:[(0,i.jsx)(en.x,{children:"Row Count Check"}),(0,i.jsx)(et.f,{children:(0,i.jsxs)(iv.K,{spacing:"4",children:[(0,i.jsxs)(ei.x,{children:["Perform a row count check of the ",I," node(s) displayed in the lineage diff DAG."]}),(0,i.jsxs)(c.k,{bg:"blue.100",color:"blue.700",children:[(0,i.jsx)(rt.h,{mt:"10px",ml:"5px"}),(0,i.jsx)(ei.x,{margin:"5px",paddingX:"3px",children:"This is a recommended first check based on the preset checks defined in your recce.yml file."})]})]})}),(0,i.jsxs)(el.m,{gap:"5px",children:[(0,i.jsx)(er.z,{onClick:()=>{C(),ef({action:"close",from:v?"rerun":"initial",nodes:I})},children:"Cancel"}),(0,i.jsxs)(er.z,{colorScheme:"blue",onClick:()=>{C(),R(),p(!0),ef({action:"execute",from:v?"rerun":"initial",nodes:I})},children:["Execute on ",I," models"]})]})]})]})]})};var ra=t(64723);let rd=e=>{let{enabled:n,onChanged:t}=e,l=eD();return!l.data||l.data.single_env_onboarding?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(c.k,{direction:"row",alignItems:"center",gap:"5px",p:"5px 10px",borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:"white",alignSelf:"flex-start",children:[(0,i.jsx)(ra.r,{isChecked:n,onChange:e=>{t(e.target.checked)},alignItems:"center"}),(0,i.jsx)(c.k,{alignItems:"center",children:(0,i.jsx)(ei.x,{fontSize:"10pt",lineHeight:"1",children:"Breaking Change Analysis"})}),(0,i.jsxs)(iX.J,{trigger:"hover",placement:"top-start",children:[(0,i.jsx)(iG.x,{children:(0,i.jsx)(o.J,{boxSize:"10px",as:rt.h,color:"gray.500",cursor:"pointer"})}),(0,i.jsx)(iY.y,{bg:"black",color:"white",children:(0,i.jsxs)(i$.b,{fontSize:"sm",children:["Breaking changes are determined by analyzing SQL for changes that may impact downstream models."," ",(0,i.jsx)(r.r,{href:"https://docs.datarecce.io/features/breaking-change-analysis/",target:"_blank",textDecoration:"underline",children:"Learn more"}),"."]})})]})]})},rc=e=>{let{transformationType:n,legend:t}=e,l="U",r="red";return"passthrough"===n?(l="P",r="gray"):"renamed"===n?(l="R",r="orange"):"derived"===n?(l="D",r="orange"):"source"===n?(l="S",r="blue"):(l="U",r="red"),(0,i.jsx)(i.Fragment,{children:t?(0,i.jsx)(tM.Vp,{fontSize:"8pt",size:"xs",colorScheme:r,borderRadius:"full",paddingX:"4px",children:(0,i.jsx)(tM.Sn,{children:l})}):(0,i.jsx)(tM.Vp,{fontSize:"6pt",size:"xs",colorScheme:r,borderRadius:"full",paddingX:"2px",children:(0,i.jsx)(tM.Sn,{children:l})})})};var ru=t(82946);let rh=e=>{let{node:n,column:t,reset:l}=e,{lineageGraph:s}=eM();if(!s)return(0,i.jsx)(i.Fragment,{});let a=s.nodes[n].name;return(0,i.jsxs)(c.k,{direction:"row",alignItems:"center",gap:"5px",p:"5px 10px",borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:"white",fontSize:"10pt",children:[(0,i.jsx)(ei.x,{children:"Column Lineage for"}),(0,i.jsxs)(d.E,{children:[a,".",t]}),(0,i.jsxs)(iX.J,{trigger:"hover",placement:"top-start",children:[(0,i.jsx)(iG.x,{children:(0,i.jsx)(o.J,{boxSize:"10px",as:rt.h,color:"gray.500",cursor:"pointer"})}),(0,i.jsx)(iY.y,{bg:"black",color:"white",children:(0,i.jsxs)(i$.b,{fontSize:"sm",children:["Column-Level Lineage provides visibility into the upstream and downstream relationships of a column."," ",(0,i.jsx)(r.r,{href:"https://docs.datarecce.io/features/column-level-lineage/",target:"_blank",textDecoration:"underline",children:"Learn more"}),"."]})})]}),l&&(0,i.jsx)(nu.h,{icon:(0,i.jsx)(ru.T,{}),"aria-label":"",onClick:l,size:"xs"})]})};function rx(){return(0,i.jsx)(l.x,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({passthrough:["Pass Through","The column is directly selected from the upstream table."],renamed:["Renamed","The column is selected from the upstream table but with a different name."],derived:["Derived","The column is created through transformations applied to upstream columns, such as calculations, conditions, functions, or aggregations."],source:["Source","The column is not derived from any upstream data. It may originate from a seed/source node, literal value, or data generation function."],unknown:["Unknown","We have no information about the transformation type. This could be due to a parse error, or other unknown reason."]}).map(e=>{let[n,[t,l]]=e;return(0,i.jsx)(nW.u,{label:l,placement:"right",children:(0,i.jsxs)(c.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,i.jsx)(rc,{legend:!0,transformationType:n})," ",t]})},n)})})}function rm(e){let{notification:n,type:t}=e,l=rr.lineageNotificationDismissed,[r,o]=(0,b.useState)(!0);return((0,b.useEffect)(()=>{"true"===sessionStorage.getItem(l)&&o(!1)},[l]),null!==n&&r)?(0,i.jsxs)(c.k,{w:"100%",direction:"row",p:"5px 10px",gap:"5px",alignItems:"flex-start",borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:{info:"blue.50",success:"green.50",warning:"yellow.50",error:"red.50"}[t],children:[n,(0,i.jsx)(m.L,{}),(0,i.jsx)(iB.P,{onClick:()=>{sessionStorage.setItem(l,"true"),o(!1)}})]}):null}function rp(){return(0,i.jsx)(c.k,{flex:"1",h:"100%",minH:0,m:"2",p:"4",bg:"blue.50",borderRadius:"lg",boxShadow:"md",justifyContent:"center",children:(0,i.jsxs)(c.k,{w:"80%",direction:"column",overflowY:"auto",gap:6,px:8,pb:8,children:[(0,i.jsxs)(c.k,{direction:"column",alignItems:"center",gap:4,children:[(0,i.jsx)(c.k,{p:2,bg:"white",borderRadius:"full",alignItems:"center",justifyContent:"center",boxShadow:"md",children:(0,i.jsx)(o.J,{as:iO.NJc,boxSize:7,color:"blue.500"})}),(0,i.jsx)(h.X,{mt:"4",size:"lg",children:"Wait, there's more!"}),(0,i.jsxs)(ei.x,{fontSize:"md",textAlign:"center",children:["Recce is currently running in"," ",(0,i.jsx)(ei.x,{fontWeight:"bold",as:"span",children:"limited functionality mode"})," ","so you can run queries but"," ",(0,i.jsx)(ei.x,{fontWeight:"bold",as:"span",children:"can't diff the results yet!"})]})]}),(0,i.jsxs)(c.k,{direction:"column",gap:2,children:[(0,i.jsx)(ei.x,{fontSize:"md",children:"To unlock the full power of Recce, set up a base environment of dbt artifacts for comparison."}),(0,i.jsx)(ei.x,{children:"Once configured, you'll be able to:"}),(0,i.jsxs)(t7.QI,{children:[(0,i.jsx)(t7.HC,{children:(0,i.jsx)(ei.x,{children:"Run statistical data diffs"})}),(0,i.jsx)(t7.HC,{children:(0,i.jsx)(ei.x,{children:"Run query diffs"})}),(0,i.jsx)(t7.HC,{children:(0,i.jsx)(ei.x,{children:"Save checks to your Recce Checklist"})}),(0,i.jsx)(t7.HC,{children:(0,i.jsx)(ei.x,{children:"...and more!"})})]}),(0,i.jsx)(ei.x,{fontSize:"md",children:"Take the next step toward better data impact assessment."})]}),(0,i.jsx)(c.k,{w:"100%",direction:"column",mt:6,children:(0,i.jsx)(er.z,{colorScheme:"blue",size:"lg",onClick:()=>{window.open("https://docs.datarecce.io/get-started/#prepare-dbt-artifacts","_blank")},children:"Start Now"})})]})})}function rf(){return(0,i.jsxs)(c.k,{direction:"row",gap:"10px",alignItems:"flex-start",children:[(0,i.jsx)(o.J,{as:iO.LyC,color:"blue.500",boxSize:"5"}),(0,i.jsxs)(c.k,{direction:"column",gap:"5px",children:[(0,i.jsxs)(ei.x,{fontWeight:"bold",children:["Lineage Diff"," ",(0,i.jsx)(ei.x,{color:"red",as:"span",children:"Live Reload"})]}),(0,i.jsxs)(ei.x,{fontSize:"sm",children:["To view lineage diff in action, make a modeling change and rebuild your dbt project. Leave Recce running and"," ",(0,i.jsx)(ei.x,{fontWeight:"bold",as:"span",children:"model changes will be automatically detected"})," ","and displayed."]}),(0,i.jsx)(r.r,{color:"blue.500",fontSize:"sm",fontWeight:"medium",isExternal:!0,href:"https://docs.datarecce.io/get-started/#prepare-dbt-artifacts",children:"Learn how"})]})]})}async function rg(e,n){return(await U.post("/api/cll",{params:{node_id:e,column:n}})).data}var rv=t(77370);let rj=e=>{let{menuItems:n,isOpen:t,onClose:l,x:r,y:o}=e;return(0,i.jsx)(n1.v,{isOpen:t,onClose:l,children:(0,i.jsx)(n4.q,{fontSize:"10pt",position:"absolute",width:"250px",style:{left:"".concat(r,"px"),top:"".concat(o,"px")},children:0===n.length?(0,i.jsx)(n3.s,{isDisabled:!0,children:"No action available"},"no action"):n.map(e=>e.isSeparator?(0,i.jsx)(tA.R,{},e.label):(0,i.jsx)(n3.s,{icon:e.icon,isDisabled:e.isDisabled,onClick:()=>{e.action&&e.action(),l()},children:e.label},e.label))})})},ry=e=>{var n,t,l,r,s,a,d;let{isOpen:c,onClose:u,x:h,y:x,node:m}=e,p=[],{selectParentNodes:f,selectChildNodes:g,getNodeColumnSet:v,selectMode:j,viewOptions:y}=tG(),{runAction:b}=th(),{isActionAvailable:w}=eM(),{data:k}=eD(),C=null!==(t=null==k?void 0:k.single_env_onboarding)&&void 0!==t&&t,{primaryKey:_}=eU(null==m?void 0:null===(n=m.data)||void 0===n?void 0:n.name),{setSqlQuery:S,setPrimaryKeys:R}=z(),[,I]=(0,eq.TH)();if(!(null==m?void 0:m.data))return(0,i.jsx)(i.Fragment,{});let E=m.data,L=E.resourceType,D=Array.from(v(m.id));if(!j&&L&&["model","seed","snapshot"].includes(L)){let e=ta(C?"query":"query_diff");if(p.push({label:"Query",icon:(0,i.jsx)(o.J,{as:null==e?void 0:e.icon}),action:()=>{S('select * from {{ ref("'.concat(E.name,'") }}')),w("query_diff_with_primary_key")&&R(void 0!==_?[_]:void 0),I("/query")}}),D.length>0){if(void 0!==y.column_level_lineage){let n=new Set;_&&n.add(_),D.forEach(e=>{n.add(e)}),p.push({label:"Query Related Columns",icon:(0,i.jsx)(o.J,{as:null==e?void 0:e.icon}),action:()=>{S("select \n  ".concat(Array.from(n).join(",\n  "),'\nfrom {{ ref("').concat(E.name,'") }}')),w("query_diff_with_primary_key")&&R(void 0!==_?[_]:void 0),I("/query")}})}else{let n=Object.entries(null!==(r=null===(l=E.change)||void 0===l?void 0:l.columns)&&void 0!==r?r:{}).filter(e=>{let[,n]=e;return"modified"===n}).map(e=>{let[n]=e;return n});if(n.length>0){let t=new Set;_&&t.add(_),n.forEach(e=>{t.add(e)}),p.push({label:"Query Modified Columns",icon:(0,i.jsx)(o.J,{as:null==e?void 0:e.icon}),action:()=>{S("select \n  ".concat(Array.from(t).join(",\n  "),'\nfrom {{ ref("').concat(E.name,'") }}')),w("query_diff_with_primary_key")&&R(void 0!==_?[_]:void 0),I("/query")}})}}}e=ta(C?"row_count":"row_count_diff"),p.push({label:null!==(s=null==e?void 0:e.title)&&void 0!==s?s:"Row count",icon:(0,i.jsx)(o.J,{as:null==e?void 0:e.icon}),action:()=>{b(C?"row_count":"row_count_diff",{node_names:[E.name]},{showForm:!1})}}),e=ta(C?"profile":"profile_diff"),p.push({label:null!==(a=null==e?void 0:e.title)&&void 0!==a?a:"Profile",icon:(0,i.jsx)(o.J,{as:null==e?void 0:e.icon}),action:()=>{let e=Array.from(v(m.id));b(C?"profile":"profile_diff",{model:E.name,columns:e},{showForm:!0})}}),C||(e=ta("value_diff"),p.push({label:null!==(d=null==e?void 0:e.title)&&void 0!==d?d:"Value Diff",icon:(0,i.jsx)(o.J,{as:null==e?void 0:e.icon}),action:()=>{let e=Array.from(v(m.id));b("value_diff",{model:E.name,columns:e},{showForm:!0})}}))}return C||(p.length>0&&p.push({label:"select group",isSeparator:!0}),p.push({label:"Select Parent Nodes",icon:(0,i.jsx)(rv.Cv2,{}),action:()=>{f(m.id,1)}}),p.push({label:"Select Child Nodes",icon:(0,i.jsx)(rv.IMj,{}),action:()=>{g(m.id,1)}}),p.push({label:"Select All Upstream Nodes",icon:(0,i.jsx)(rv.Cv2,{}),action:()=>{f(m.id)}}),p.push({label:"Select All Downstream Nodes",icon:(0,i.jsx)(rv.IMj,{}),action:()=>{g(m.id)}})),(0,i.jsx)(rj,{x:h,y:x,menuItems:p,isOpen:c,onClose:u})},rb=e=>{var n,t,l,r,s,a,d,c;let{isOpen:u,onClose:h,x,y:m,node:p}=e,f=[],{runAction:g}=th(),{isActionAvailable:v}=eM(),{data:j}=eD(),y=null!==(s=null==j?void 0:j.single_env_onboarding)&&void 0!==s&&s;if((null==p?void 0:p.data)===void 0)return(0,i.jsx)(i.Fragment,{});let b=p.data,w=b.node,k=b.column,C=b.type,_=(null===(t=w.data.base)||void 0===t?void 0:null===(n=t.columns)||void 0===n?void 0:n[k])===void 0||(null===(r=w.data.current)||void 0===r?void 0:null===(l=r.columns)||void 0===l?void 0:l[k])===void 0,S=ta(y?"profile":"profile_diff");return f.push({label:null!==(a=null==S?void 0:S.title)&&void 0!==a?a:"Profile",icon:(0,i.jsx)(o.J,{as:null==S?void 0:S.icon}),action:()=>{g("profile_diff",{model:w.name,columns:[k]},{showForm:!1})},isDisabled:_||!v("profile_diff")}),y||(S=ta("histogram_diff"),f.push({label:null!==(d=null==S?void 0:S.title)&&void 0!==d?d:"Histogram Diff",icon:(0,i.jsx)(o.J,{as:null==S?void 0:S.icon}),action:()=>{g("histogram_diff",{model:w.name,column_name:k,column_type:C},{showForm:!1})},isDisabled:_||!C||!eG(C)}),S=ta("top_k_diff"),f.push({label:null!==(c=null==S?void 0:S.title)&&void 0!==c?c:"Top-K Diff",icon:(0,i.jsx)(o.J,{as:null==S?void 0:S.icon}),action:()=>{g("top_k_diff",{model:w.name,column_name:k,k:50},{showForm:!1})},isDisabled:_})),(0,i.jsx)(rj,{x:x,y:m,menuItems:f,isOpen:u,onClose:h})},rw=e=>{let{isOpen:n,onClose:t,x:l,y:r,node:o}=e,{readOnly:s}=tn();if(s);else if((null==o?void 0:o.type)==="customNode")return(0,i.jsx)(ry,{x:l,y:r,isOpen:n,onClose:t,node:o});else if((null==o?void 0:o.type)==="customColumnNode")return(0,i.jsx)(rb,{x:l,y:r,isOpen:n,onClose:t,node:o})},rk=()=>{let{isOpen:e,onClose:n,onOpen:t}=(0,G.q)(),[i,l]=(0,b.useState)({x:0,y:0}),[r,o]=(0,b.useState)();return{props:{x:i.x,y:i.y,node:r,isOpen:e,onClose:n},showContextMenu:(e,n,i)=>{l({x:e,y:n}),o(i),t()},closeContextMenu:()=>{l({x:0,y:0}),o(void 0),n()}}},rC={customNode:function(e){var n,t;let{data:r}=e,{id:s,resourceType:a,changeStatus:d,change:u}=r,h=null==u?void 0:u.category,p=(0,E.oR)(e=>e.transform[2]>.3),{icon:f}=is(a),[g,v]=(0,b.useState)(!1),{interactive:j,selectNode:y,selectMode:w,focusedNode:k,breakingChangeEnabled:C,getNodeAction:_,getNodeColumnSet:S,isNodeHighlighted:z,isNodeSelected:R,showContextMenu:I}=tG(),{lineageGraph:L}=eM(),D=C&&"modified"===d&&(null==L?void 0:L.nonBreakingSet.has(s)),T=z(s),O=R(s),M=(null==k?void 0:k.id)===s,{icon:A,color:N,backgroundColor:F}=d?io(d):{icon:void 0,color:"gray.400",backgroundColor:"gray.100"},q=D?"dashed":"solid",H=r.name,P=S(r.id),V=P.size>0,W="action_result"===w?_(r.id):void 0,K=p?"selecting"===w?O?N:"white":"action_result"!==w?M||O||g?F:"white":W?M||O||g?F:N:"white":M||O||g?N:F,J="selecting"===w?O?"white":"inherit":"action_result"===w&&W&&!O?"white":"inherit",B="selecting"===w?O?"white":"inherit":"action_result"===w&&W&&!O?"white":"inherit",U="selecting"===w?O?"white":N:"action_result"===w?W&&!O?"white":"inherit":N;return(0,i.jsxs)(c.k,{cursor:"selecting"===w?"pointer":"inherit",direction:"column",width:"300px",transition:"box-shadow 0.2s ease-in-out",padding:0,filter:"action_result"===w?W?"none":"opacity(0.2) grayscale(50%)":T||M||O||g?"none":"opacity(0.2) grayscale(50%)",onMouseEnter:()=>{v(!0)},onMouseLeave:()=>{v(!1)},children:[(0,i.jsxs)(c.k,{borderColor:N,borderWidth:"2px",borderStyle:q,borderTopRadius:8,borderBottomRadius:V?0:8,backgroundColor:K,height:"60px",children:[(0,i.jsx)(c.k,{bg:N,padding:j?"8px":"2px",borderRightWidth:"2px",borderColor:"selecting"===w?"#00000020":N,borderStyle:q,alignItems:"top",visibility:p?"inherit":"hidden",children:j&&(0,i.jsx)(iW,{checked:"selecting"===w&&O||"action_result"===w&&!!W,onClick:e=>{"action_result"!==w&&(e.stopPropagation(),y(r.id))}})}),(0,i.jsxs)(c.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:[(0,i.jsxs)(c.k,{width:"100%",textAlign:"left",fontWeight:"600",flex:"1",p:1,gap:"5px",alignItems:"center",visibility:p?"inherit":"hidden",children:[(0,i.jsx)(iK,{name:H,color:J,resourceType:a}),g?(0,i.jsx)(o.J,{as:ns.D_A,color:"gray",cursor:"pointer",_hover:{color:"black"},onClick:n=>{n.preventDefault(),n.stopPropagation(),I(n,e)}}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.J,{boxSize:"16px",color:B,as:f}),d&&(0,i.jsx)(o.J,{color:U,as:A})]})]}),(0,i.jsx)(c.k,{flex:"1 0 auto",mx:"1",direction:"column",paddingBottom:"1",visibility:p?"inherit":"hidden",children:(0,i.jsxs)(x.U,{spacing:"8px",children:[C&&"modified"===d?(0,i.jsx)(l.x,{height:"20px",color:"gray",fontSize:"9pt",margin:0,fontWeight:600,children:h?iP[h]:""}):"action_result"!==w&&"model"===r.resourceType?(0,i.jsx)(iV,{id:r.id,inverted:"selecting"===w&&!!O}):(0,i.jsx)(i.Fragment,{}),W?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(m.L,{}),(0,i.jsx)(iq,{node:r,action:W})]}):(0,i.jsx)(i.Fragment,{})]})})]})]}),V&&(0,i.jsx)(l.x,{p:"10px 10px",borderColor:N,borderWidth:"2px",borderTopWidth:0,borderStyle:q,borderBottomRadius:8,children:(0,i.jsx)(l.x,{height:"".concat(15*P.size,"px"),overflow:"auto"})}),Object.keys(null!==(n=r.parents)&&void 0!==n?n:{}).length>0&&(0,i.jsx)(E.HH,{type:"target",position:E.Ly.Left,isConnectable:!1}),Object.keys(null!==(t=r.children)&&void 0!==t?t:{}).length>0&&(0,i.jsx)(E.HH,{type:"source",position:E.Ly.Right,isConnectable:!1})]})},customColumnNode:function(e){var n,t;let{data:r}=e,{id:s}=r.node,{column:a,type:d,transformationType:u,changeStatus:h}=r,x=(0,E.oR)(e=>e.transform[2]>.3),{viewOptions:p,showContextMenu:f}=tG(),g=null===(n=p.column_level_lineage)||void 0===n?void 0:n.node,v=a===(null===(t=p.column_level_lineage)||void 0===t?void 0:t.column)&&s===g,{color:j,icon:y}=io(h),[w,k]=b.useState(!1);return x?(0,i.jsxs)(c.k,{width:"280px",height:"16px",padding:"0px 10px",border:"1px solid lightgray",backgroundColor:v?"#f0f0f0":"inherit",_hover:{backgroundColor:"#f0f0f0"},onMouseEnter:()=>{k(!0)},onMouseLeave:()=>{k(!1)},children:[(0,i.jsxs)(c.k,{fontSize:"10px",color:"gray",width:"100%",gap:"3px",alignItems:"center",children:[h&&(0,i.jsx)(o.J,{boxSize:"12px",display:"inline-flex",color:j,as:y}),u&&(0,i.jsx)(rc,{transformationType:u}),(0,i.jsx)(l.x,{height:"16px",children:a}),(0,i.jsx)(m.L,{}),w?(0,i.jsx)(o.J,{as:ns.D_A,boxSize:"14px",display:"inline-flex",cursor:"pointer",_hover:{color:"black"},onClick:n=>{n.preventDefault(),n.stopPropagation(),f(n,e)}}):(0,i.jsx)(l.x,{height:"16px",children:d})]}),(0,i.jsx)(E.HH,{type:"target",position:E.Ly.Left,isConnectable:!1,style:{left:0,visibility:"hidden"}}),(0,i.jsx)(E.HH,{type:"source",position:E.Ly.Right,isConnectable:!1,style:{right:0,visibility:"hidden"}})]}):(0,i.jsx)(i.Fragment,{})}},r_=[],rS={customEdge:function(e){let{source:n,target:t,sourceX:l,sourceY:r,targetX:o,targetY:s,sourcePosition:a,targetPosition:d,style:c={},markerEnd:u,data:h}=e,x={...c},{isEdgeHighlighted:m}=tG();(null==h?void 0:h.changeStatus)&&(x.stroke=io(h.changeStatus).color,x.strokeDasharray="5"),m(n,t)||(x.filter="opacity(0.2) grayscale(50%)");let[p]=(0,E.OQ)({sourceX:l,sourceY:r,sourcePosition:a,targetX:o,targetY:s,targetPosition:d});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(E.u5,{path:p,markerEnd:u,style:{...x,...c}})})}},rz=e=>e.data.changeStatus?io(e.data.changeStatus).color:"lightgray",rR=(e,n)=>{let t=e.current,i=(0,b.useRef)({width:0,height:0});(0,b.useEffect)(()=>{let e=new ResizeObserver(e=>{for(let t of e){let e=t.contentRect.width,l=t.contentRect.height;(Math.abs(l-i.current.height)>10||Math.abs(e-i.current.width)>10)&&i.current.height>0&&l>0&&i.current.width>0&&e>0&&n(),i.current={width:e,height:l}}});return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[t,i,n])},rI=()=>{let[,e]=(0,eq.TH)();return(0,b.useCallback)(n=>{n.check_id&&e("/checks/".concat(n.check_id))},[e])},rE=(0,b.forwardRef)(function(e,n){var t,r;let{interactive:a=!1,...d}=e,u=(0,E._K)(),h=(0,b.useRef)(null),{successToast:x,failToast:m}=im(),{copyToClipboard:p,ImageDownloadModal:f,ref:g}=ln({renderLibrary:"html-to-image",imageType:"png",shadowEffect:!0,backgroundColor:"white",ignoreElements:e=>{let n=e.className;return!!("string"==typeof n&&n.includes(le))},onSuccess:()=>{x("Copied the Lineage View as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),m("Failed to copy image to clipboard",e)}}),[v,j,y]=(0,E.Rr)(r_),[w,k,C]=(0,E.ll)([]),{lineageGraph:_,retchLineageGraph:S,isLoading:z,error:R,refetchRunsAggregated:I}=eM(),{data:L}=eD(),{runId:T,showRunId:O,closeRunResult:q,runAction:H,isRunResultOpen:P}=th(),{run:V}=iZ(T),[W,K]=(0,b.useState)({...d.viewOptions}),J=e=>v.find(n=>n.data.name===e);(0,b.useImperativeHandle)(n,()=>({copyToClipboard:p}));let B=(0,b.useMemo)(()=>!!_&&_.modifiedSet.length>0,[_]),U=null!==(t=W.view_mode)&&void 0!==t?t:"changed_models",Q=(0,b.useMemo)(()=>v.filter(e=>"customNode"===e.type).map(e=>e.id),[v]),Z=(0,b.useMemo)(()=>_?Q.map(e=>_.nodes[e]):[],[_,Q]),[X,G]=(0,b.useState)(),Y=X?null==_?void 0:_.nodes[X]:void 0,[$,ee]=(0,b.useState)(),[en,et]=(0,b.useState)(new Set),el=(0,b.useMemo)(()=>_?Array.from(en).map(e=>_.nodes[e]):[],[_,en]),eo=l7(el.length>0?el:Z,{onActionStarted:()=>{ee("action_result")},onActionNodeUpdated:e=>{j(n=>n.map(n=>n.id===e.id?{...n}:n))},onActionCompleted:()=>{}}),es=null!==(r=W.breaking_change_enabled)&&void 0!==r&&r,[ed,ec]=(0,b.useState)(),eh=(0,b.useMemo)(()=>_?"action_result"===$?new Set(Object.keys(eo.actionState.actions)):W.column_level_lineage&&ed?new Set(Object.entries(ed).filter(e=>{let[n,t]=e;return t.size>0}).map(e=>{let[n,t]=e;return n})):Y?D(M(_,[Y.id]),A(_,[Y.id])):B?es?_.impactedSet:A(_,_.modifiedSet):new Set(Q):new Set,[_,$,W.column_level_lineage,ed,Y,B,eo.actionState.actions,es,Q]),ex=rk(),em=(0,s.p)();(0,b.useLayoutEffect)(()=>{(async()=>{let e;if(!_)return;if(W.node_ids)e=W.node_ids;else{var n,t;let i=null===(n=_.manifestMetadata.current)||void 0===n?void 0:n.project_name,l={view_mode:null!==(t=W.view_mode)&&void 0!==t?t:B?"changed_models":"all",packages:i?[i]:void 0,...d.viewOptions};try{e=(await t6({select:l.select,exclude:l.exclude,packages:l.packages,view_mode:l.view_mode})).nodes}catch(n){l.view_mode="all",e=(await t6({select:l.select,exclude:l.exclude,packages:l.packages,view_mode:l.view_mode})).nodes}K(l),ec(void 0)}let[i,l,r]=N(_,{selectedNodes:e,breakingChangeEnabled:es});F(i,l),j(i),k(l),ec(r)})()},[_]);let ep=()=>{G(void 0)},ef=e=>{if(e.width&&e.height){let n=e.position.x+e.width/2,t=e.position.y+e.height/2,i=u.getZoom();u.setCenter(n,t,{zoom:i,duration:200})}},ej=rI();rR(h,()=>{if("selecting"!==$){let e=v.find(e=>e.id===X);e?ef(e):u.fitView({nodes:v,duration:200})}});let ey=(e,n)=>{$||(W.column_level_lineage?ev({action:"view",source:"cll_column"}):ev({action:"view",source:"changed_column"}),X&&G(n.parentId),eC({...W,column_level_lineage:{node:n.data.node.id,column:n.data.column}},!1))},ew=(e,n)=>{if(a&&_){if("customColumnNode"===n.type){ey(e,n);return}if(ez(),$){if("action_result"===$){var t;let e=eo.actionState.actions[n.id];(null===(t=e.run)||void 0===t?void 0:t.run_id)&&O(e.run.run_id),G(n.id)}else{let e=new Set(en);en.has(n.id)?e.delete(n.id):e.add(n.id),et(e),0===e.size&&ee(void 0)}}else G(n.id)}},ek=async e=>{var n,t,i,l,r;let o,s;let{viewOptions:a=W,fitView:d}=e;if(!_)return;if(W.select!==a.select||W.exclude!==a.exclude||W.packages!==a.packages||W.view_mode!==a.view_mode){try{let e=await t6({select:a.select,exclude:a.exclude,packages:a.packages,view_mode:a.view_mode});a.column_level_lineage=void 0,s=e.nodes}catch(e){e instanceof tf.d7&&em({title:"Select node error",description:null!==(i=null===(t=e.response)||void 0===t?void 0:t.data.detail)&&void 0!==i?i:e.message,status:"error",isClosable:!0,position:"bottom-right"});return}G(void 0)}else s=v.map(e=>e.id);if(a.column_level_lineage)try{o=await rg(a.column_level_lineage.node,a.column_level_lineage.column)}catch(e){if(e instanceof tf.d7){em({title:"Column Level Lineage error",description:null!==(r=null===(l=e.response)||void 0===l?void 0:l.data.detail)&&void 0!==r?r:e.message,status:"error",isClosable:!0,position:"bottom-right"});return}}let[c,h,x]=N(_,{selectedNodes:s,columnLevelLineage:a.column_level_lineage,cll:o,breakingChangeEnabled:a.breaking_change_enabled});j(c),k(h),ec(x),(null==V?void 0:null===(n=V.params)||void 0===n?void 0:n.model)&&!J(V.params.model)&&q(),d&&(await new Promise(e=>setTimeout(e,1)),u.fitView({nodes:c,duration:200}))},eC=async function(e){let n=!(arguments.length>1)||void 0===arguments[1]||arguments[1];K(e),await ek({viewOptions:e,fitView:n})},e_=async e=>{var n;let t={...W,breaking_change_enabled:e};K(t),await ek({viewOptions:t}),n={enabled:e},ea.j("[Experiment] breaking_change_analysis",n),eg=n.enabled},eS=rn();(0,b.useEffect)(()=>{let e=null==V?void 0:V.type;if(!(!a||!P||!e||["query_diff","query","row_count"].includes(e))&&!$){var n;let e=null===(n=V.params)||void 0===n?void 0:n.model,t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});if(e){let n=J(e);n?Y!==n.data&&ew(t,n):eC({...W,view_mode:"all"})}else ep()}},[V,W,P,$]);let ez=()=>{ex.closeContextMenu()},eR=(e,n)=>{if(!a||"action_result"===$)return;e.preventDefault();let t=g.current,i=t.getBoundingClientRect(),l=e.clientX-i.left,r=e.clientY-i.top+t.offsetTop;ex.showContextMenu(l,r,n)},eI=()=>{ee(void 0),et(new Set),G(void 0),q(),null==I||I()},eE={interactive:a,nodes:v,focusedNode:Y,selectedNodes:el,viewOptions:W,showContextMenu:eR,onViewOptionsChanged:eC,selectMode:$,selectNode:e=>{if($){if("selecting"===$){let n=new Set(en);en.has(e)?n.delete(e):n.add(e),et(n),0===n.size&&ee(void 0)}}else{if(!_)return;et(new Set([e])),ee("selecting"),G(void 0),W.column_level_lineage&&eC({...W,column_level_lineage:void 0}),eo.reset()}},selectParentNodes:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;"action_result"!==$&&void 0!==_&&(!$&&(ee("selecting"),eo.reset(),W.column_level_lineage&&eC({...W,column_level_lineage:void 0})),et(D(en,M(_,[e],n))))},selectChildNodes:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;"action_result"!==$&&void 0!==_&&(!$&&(ee("selecting"),eo.reset(),W.column_level_lineage&&eC({...W,column_level_lineage:void 0})),et(D(en,A(_,[e],n))))},deselect:eI,breakingChangeEnabled:es,isNodeHighlighted:e=>eh.has(e),isNodeSelected:e=>en.has(e),isEdgeHighlighted:(e,n)=>!W.column_level_lineage&&eh.has(e)&&eh.has(n),getNodeAction:e=>eo.actionState.actions[e],getNodeColumnSet:e=>{var n;return ed&&null!==(n=ed[e])&&void 0!==n?n:new Set},runRowCount:async()=>{"selecting"===$?(await eo.runRowCount(),eu({type:"row_count",selected:"multi"})):Y?(H("row_count",{node_names:[Y.name]},{showForm:!1,showLast:!1}),eu({type:"row_count",selected:"single"})):(H("row_count",{select:W.select,exclude:W.exclude,packages:W.packages,view_mode:W.view_mode}),eu({type:"row_count",selected:"none"}))},runRowCountDiff:async()=>{"selecting"===$?(await eo.runRowCountDiff(),eu({type:"row_count_diff",selected:"multi"})):Y?(H("row_count_diff",{node_names:[Y.name]},{showForm:!1,showLast:!1}),eu({type:"row_count_diff",selected:"single"})):(H("row_count_diff",{select:W.select,exclude:W.exclude,packages:W.packages,view_mode:W.view_mode}),eu({type:"row_count_diff",selected:"none"}))},runValueDiff:async()=>{if(Y)H("value_diff",{model:Y.name},{showForm:!0,showLast:!1}),eu({type:"value_diff",selected:"single"});else{let e="selecting"===$?el.length:Q.length;await eS.confirm(e)&&(await eo.runValueDiff(),eu({type:"value_diff",selected:"selecting"===$?"multi":"none"}))}},addLineageDiffCheck:async()=>{let e;"selecting"===$?(e=await eo.addLineageDiffCheck(),eI(),eu({type:"lineage_diff",selected:"multi"})):Y||(e=await l3(W),eu({type:"lineage_diff",selected:"none"})),e&&ej(e)},addSchemaDiffCheck:async()=>{let e;"selecting"===$?el.length>0&&(e=await eo.addSchemaDiffCheck(),eI(),eu({type:"schema_diff",selected:"multi"})):Y?(e=await iU({node_id:Y.id}),eu({type:"schema_diff",selected:"single"})):(e=await iU({select:W.select,exclude:W.exclude,packages:W.packages,view_mode:W.view_mode}),eu({type:"schema_diff",selected:"none"})),e&&ej(e)},cancel:eo.cancel,actionState:eo.actionState,showColumnLevelLineage:async(e,n)=>{await eC({...W,column_level_lineage:{node:e,column:n}},!1),G(e)},resetColumnLevelLineage:()=>{G(void 0),eC({...W,column_level_lineage:void 0},!1)}};return z?(0,i.jsx)(c.k,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:(0,i.jsx)(iS.$,{size:"xl"})}):R?(0,i.jsx)(ni.M,{h:"100%",children:(0,i.jsxs)(nb.g,{children:[(0,i.jsx)(l.x,{children:"Failed to load lineage data. This could be because the server has been terminated or there is a network error."}),(0,i.jsxs)(l.x,{children:["[Reason: ",R,"]"]}),(0,i.jsx)(er.z,{colorScheme:"blue",onClick:()=>{S&&S()},children:"Retry"})]})}):_&&v!=r_?"changed_models"!==U||_.modifiedSet.length?(0,i.jsxs)(tX.Provider,{value:eE,children:[(0,i.jsxs)(t9,{sizes:Y?[70,30]:[100,0],minSize:Y?400:0,gutterSize:Y?5:0,style:{height:"100%",width:"100%"},children:[(0,i.jsxs)(nb.g,{ref:h,divider:(0,i.jsx)(iz.c,{borderColor:"gray.200"}),spacing:0,style:{contain:"strict"},position:"relative",children:[a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l6,{}),(0,i.jsx)(rs,{})]}),(0,i.jsxs)(E.x$,{nodeTypes:rC,edgeTypes:rS,nodes:v,edges:w,onNodesChange:y,onEdgesChange:C,onNodeClick:ew,onNodeContextMenu:eR,onClick:ez,onInit:()=>{if(B)u.fitView();else{let e=(0,E.RX)(v);u.setCenter(e.x+e.width/2,e.y+e.height/2,{zoom:1})}},maxZoom:1,minZoom:.1,nodesDraggable:a,ref:g,children:[(0,i.jsx)(iR.A,{color:"#ccc"}),(0,i.jsx)(iI.Z,{showInteractive:!1,position:"top-right",className:le,children:(0,i.jsx)(iI.B,{title:"copy image",onClick:async()=>{await p(),eb({type:U,from:"lineage_view"})},children:(0,i.jsx)(o.J,{as:iT.C3L})})}),(0,i.jsx)(f,{}),(0,i.jsx)(E.s_,{position:"bottom-left",children:(0,i.jsxs)(c.k,{direction:"column",gap:"5px",children:[B&&(0,i.jsx)(l9,{}),W.column_level_lineage&&(0,i.jsx)(rx,{})]})}),(0,i.jsx)(E.s_,{position:"top-center",children:(0,i.jsx)(rm,{notification:(null==L?void 0:L.single_env_onboarding)?(0,i.jsx)(rf,{}):null,type:"info"})}),(0,i.jsx)(E.s_,{position:"top-left",children:(0,i.jsxs)(c.k,{direction:"column",gap:"5px",children:[(0,i.jsx)(rd,{enabled:es,onChanged:e_}),W.column_level_lineage&&(0,i.jsx)(rh,{node:W.column_level_lineage.node,column:W.column_level_lineage.column,reset:a?()=>{G(void 0),eC({...W,column_level_lineage:void 0})}:void 0}),0==v.length&&(0,i.jsx)(ei.x,{fontSize:"xl",color:"grey",opacity:.5,children:"No nodes"})]})}),(0,i.jsx)(iE.a,{nodeColor:rz,nodeStrokeWidth:3,zoomable:!0,pannable:!0}),"action_result"===$&&(0,i.jsx)(E.s_,{position:"bottom-center",className:le,children:(0,i.jsx)(lX,{onClose:()=>{eI()}})})]}),(0,i.jsx)(rw,{...ex.props})]}),Y?(0,i.jsx)(l.x,{borderLeft:"solid 1px lightgray",height:"100%",children:(0,i.jsx)(lZ,{node:Y,onCloseNode:ep})}):(0,i.jsx)(l.x,{})]}),eS.AlertDialog]}):(0,i.jsx)(ni.M,{h:"100%",children:(0,i.jsxs)(nb.g,{children:[(0,i.jsx)(i.Fragment,{children:"No change detected"}),(0,i.jsx)(er.z,{colorScheme:"blue",onClick:async()=>{await eC({...W,view_mode:"all"})},children:"Show all nodes"})]})}):(0,i.jsx)(i.Fragment,{})}),rL=(0,b.forwardRef)(function(e,n){let{check:t}=e,l={...t.params,...t.view_options};return(0,i.jsx)(c.k,{direction:"column",height:"100%",children:(0,i.jsx)(E.tV,{children:(0,i.jsx)(rE,{viewOptions:l,interactive:!1,ref:n})})})});function rD(e){let{yamlTemplate:n}=e;return(0,i.jsx)(ij.ML,{height:"300px",language:"yaml",theme:"vs",value:n,options:{readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})}function rT(){let e=(0,s.p)();return{markedAsApprovedToast:function(){e({title:"Marked as approved",position:"bottom-right",status:"success",containerStyle:{fontSize:"sm"},duration:2e3})}}}function rO(){let e=(0,tO._)(["\n  <details><summary>","</summary>\n\n  ","\n\n  </details>"]);return rO=function(){return e},e}let rM=(e,n)=>"schema_diff"!==e&&"lineage_diff"!==e&&(!(null==n?void 0:n.result)||!!n.error),rA=e=>{var n,t,r,s,a,d,u,v,j,y,C,_,S;let{checkId:z,refreshCheckList:R}=e,{readOnly:I}=tn(),E=(0,k.NL)(),[,L]=(0,eq.TH)(),{successToast:D,failToast:T}=im(),{markedAsApprovedToast:O}=rT(),[M,A]=(0,b.useState)(),[N,F]=(0,b.useState)(),[H,P]=(0,b.useState)(!1),[V,W]=(0,b.useState)(""),{isOpen:K,onOpen:J,onClose:B}=(0,G.q)(),U=()=>(0,i.jsx)($.Z,{bg:"blackAlpha.300",backdropFilter:"blur(10px) "}),[Q,Z]=(0,b.useState)((0,i.jsx)(U,{})),{isLoading:X,error:el,data:eo}=(0,w.a)({queryKey:q.check(z),queryFn:async()=>tE(z),refetchOnMount:!0}),es=null!=M?M:null==eo?void 0:null===(n=eo.last_run)||void 0===n?void 0:n.run_id,{run:ea,error:ed}=iZ(es),ec=M?!ea||"running"===ea.status:(null==ea?void 0:ea.status)==="running",eu=(null==eo?void 0:eo.type)?ta(eo.type):void 0,eh=null!==(d=null==eo?void 0:eo.is_preset)&&void 0!==d&&d,ex=(0,b.useRef)(null),{mutate:em}=(0,tZ.D)({mutationFn:e=>tL(z,e),onSuccess:async()=>{await E.invalidateQueries({queryKey:q.check(z)}),await E.invalidateQueries({queryKey:q.checks()})}}),{mutate:ep}=(0,tZ.D)({mutationFn:()=>tD(z),onSuccess:async()=>{await E.invalidateQueries({queryKey:q.checks()}),L("/checks")}}),ef=(0,b.useCallback)(async()=>{(null==eo?void 0:eo.type)&&(A((await e_(z,{nowait:!0})).run_id),await E.invalidateQueries({queryKey:q.check(z)}),R&&R())},[eo,z,A,E,R]),eg=(0,b.useCallback)(async()=>{if(P(!0),es)return await eC(es)},[es]),ev=async()=>{var e;if(!eo)return;let n=(e=eo,(0,ix.RI)(rO(),"".concat(e.is_checked?" ":"").concat(e.name),function(e){if("query"===e.type||"query_diff"===e.type){var n;return"".concat(ig(e),"\n\n").concat((0,ix.Pn)(ip(),null===(n=e.params)||void 0===n?void 0:n.sql_template))}return ig(e)}(e)));if(!window.isSecureContext){T("Failed to copy the check to clipboard",Error("Copy to clipboard is available only in secure contexts (HTTPS)"));return}try{await navigator.clipboard.writeText(n),D("Copied the check to the clipboard")}catch(e){T("Failed to copy the check to clipboard",e)}},ej=(0,b.useCallback)(()=>{let e=null==eo?void 0:eo.is_checked;em({is_checked:!e}),e||O()},[null==eo?void 0:eo.is_checked,em,O]),[ey,ew]=(0,b.useState)(0),{ref:ek,onCopyToClipboard:eS,onMouseEnter:ez,onMouseLeave:eR}=lt();if((0,b.useEffect)(()=>{var e,n,t;W(function(e){let{name:n,description:t,type:i,params:l,viewOptions:r}=e,o={name:n,description:t,type:i,params:l};return r&&(o.view_options=r),i0.ZP.stringify({checks:[o]})}({name:null!==(e=null==eo?void 0:eo.name)&&void 0!==e?e:"",description:null!==(n=null==eo?void 0:eo.description)&&void 0!==n?n:"",type:null!==(t=null==eo?void 0:eo.type)&&void 0!==t?t:"",params:null==eo?void 0:eo.params,viewOptions:null==eo?void 0:eo.view_options}))},[eo]),X)return(0,i.jsx)(ni.M,{h:"100%",children:"Loading"});if(el)return(0,i.jsxs)(ni.M,{h:"100%",children:["Error: ",el.message]});let eI=(null==ea?void 0:ea.run_at)?(0,i_.Q)(new Date(ea.run_at),{addSuffix:!0}):null;return(0,i.jsxs)(t8,{minSize:100,sizes:[30,70],style:{height:"100%",width:"100%",maxHeight:"100%"},children:[(0,i.jsxs)(l.x,{style:{contain:"strict"},display:"flex",flexDirection:"column",children:[(0,i.jsxs)(c.k,{p:"0px 16px",alignItems:"center",h:"40px",children:[(0,i.jsx)(tQ,{name:null!==(u=null==eo?void 0:eo.name)&&void 0!==u?u:"",setName:e=>{em({name:e})}}),eh&&(0,i.jsx)(nW.u,{label:"Preset Check defined in recce config",children:(0,i.jsxs)(tM.Vp,{size:"sm",flex:"0 0 auto",ml:"2",children:[(0,i.jsx)(tM.AD,{boxSize:"14px",as:tW.bX4}),"Preset"]})}),(0,i.jsx)(m.L,{}),(0,i.jsxs)(x.U,{mr:"10px",children:[eI&&(0,i.jsx)(l.x,{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontSize:"10pt",children:eI}),(0,i.jsxs)(n1.v,{children:[(0,i.jsx)(n5.j,{isRound:!0,as:nu.h,icon:(0,i.jsx)(o.J,{as:ns.D_A}),variant:"ghost",size:"sm"}),(0,i.jsxs)(n4.q,{children:[(0,i.jsx)(n3.s,{as:ei.x,fontSize:"10pt",icon:(0,i.jsx)(tK.ovA,{}),onClick:()=>{Z((0,i.jsx)(U,{})),J()},children:"Get Preset Check Template"}),(0,i.jsx)(n3.s,{as:ei.x,fontSize:"10pt",icon:(0,i.jsx)(nd.T,{}),onClick:()=>ev(),children:"Copy Markdown"}),(0,i.jsx)(tA.R,{}),(0,i.jsx)(n3.s,{as:ei.x,fontSize:"10pt",icon:(0,i.jsx)(tH.p,{}),color:"red",onClick:()=>{ep()},isDisabled:I,children:"Delete"})]})]}),(0,i.jsx)(nW.u,{label:rM(null!==(v=null==eo?void 0:eo.type)&&void 0!==v?v:"",ea)?"Run the check first":(null==eo?void 0:eo.is_checked)?"Mark as Pending":"Mark as Approved",placement:"bottom-end",children:(0,i.jsx)(er.z,{flex:"0 0 auto",size:"sm",colorScheme:(null==eo?void 0:eo.is_checked)?"green":"gray",variant:(null==eo?void 0:eo.is_checked)?"solid":"outline",leftIcon:(null==eo?void 0:eo.is_checked)?(0,i.jsx)(tP.r,{}):(0,i.jsx)(o.J,{as:ns.Rbx,color:"lightgray"}),onClick:()=>{ej()},isDisabled:rM(null!==(j=null==eo?void 0:eo.type)&&void 0!==j?j:"",ea)||I,children:(null==eo?void 0:eo.is_checked)?"Approved":"Mark as Approved"})})]})]}),(0,i.jsx)(l.x,{flex:"1",p:"8px 16px",minHeight:"100px",children:(0,i.jsx)(ih,{value:null==eo?void 0:eo.description,onChange:e=>{em({description:e})}},null==eo?void 0:eo.check_id)})]}),(0,i.jsx)(l.x,{style:{contain:"strict"},children:(0,i.jsxs)(p.m,{height:"100%",display:"flex",flexDirection:"column",tabIndex:ey,onChange:ew,children:[(0,i.jsxs)(f.t,{height:"50px",children:[(0,i.jsx)(g.O,{fontSize:"10pt",children:"Result"}),((null==eo?void 0:eo.type)==="query"||(null==eo?void 0:eo.type)==="query_diff")&&(0,i.jsx)(g.O,{fontSize:"10pt",children:"Query"}),(0,i.jsx)(m.L,{}),(0,i.jsxs)(x.U,{mr:"10px",children:[(null==eu?void 0:eu.RunResultView)&&(0,i.jsx)(nW.u,{label:"Rerun",children:(0,i.jsx)(er.z,{leftIcon:(0,i.jsx)(tV.n,{}),variant:"outline",isLoading:ec,size:"sm",onClick:()=>ef(),isDisabled:I,children:"Rerun"})}),(0,i.jsx)(er.z,{leftIcon:(0,i.jsx)(nd.T,{}),variant:"outline",isDisabled:rM(null!==(y=null==eo?void 0:eo.type)&&void 0!==y?y:"",ea)||0!==ey,onMouseEnter:ez,onMouseLeave:eR,size:"sm",onClick:async()=>{var e,n;(null==eo?void 0:eo.type)==="lineage_diff"?null===(e=ex.current)||void 0===e||e.copyToClipboard():await eS(),eb({type:null!==(n=null==eo?void 0:eo.type)&&void 0!==n?n:"unknown",from:"check"})},children:"Copy to Clipboard"})]})]}),(0,i.jsxs)(tN.n,{height:"100%",flex:"1",style:{contain:"strict"},children:[(0,i.jsxs)(tF.x,{p:0,width:"100%",height:"100%",children:[(null==eu?void 0:eu.RunResultView)&&((null==eo?void 0:eo.last_run)||es?(0,i.jsx)(iC,{ref:ek,isRunning:ec,isAborting:H,run:es?ea:null==eo?void 0:eo.last_run,error:ed,progress:N,RunResultView:eu.RunResultView,viewOptions:null==eo?void 0:eo.view_options,onViewOptionsChanged:e=>{em({view_options:e})},onCancel:eg,onExecuteRun:ef}):(0,i.jsx)(ni.M,{bg:"rgb(249,249,249)",height:"100%",children:(0,i.jsxs)(nb.g,{spacing:4,children:[(0,i.jsx)(l.x,{children:"This action is part of the initial preset and has not been performed yet. Once performed, the result will be shown here."}),(0,i.jsx)(er.z,{onClick:ef,colorScheme:"blue",size:"sm",isDisabled:I,children:"Run Query"})]})})),eo&&"schema_diff"===eo.type&&(0,i.jsx)(ic,{check:eo,ref:ek}),eo&&"lineage_diff"===eo.type&&(0,i.jsx)(rL,{check:eo,ref:ex})]}),((null==eo?void 0:eo.type)==="query"||(null==eo?void 0:eo.type)==="query_diff"||(null==eo?void 0:eo.type)==="query_base")&&(0,i.jsx)(tF.x,{p:0,height:"100%",width:"100%",children:(null===(t=eo.params)||void 0===t?void 0:t.base_sql_template)?(0,i.jsx)(ib,{value:null!==(C=null===(r=eo.params)||void 0===r?void 0:r.sql_template)&&void 0!==C?C:"",baseValue:null!==(_=null===(s=eo.params)||void 0===s?void 0:s.base_sql_template)&&void 0!==_?_:"",options:{readOnly:!0}}):(0,i.jsx)(iy,{value:null!==(S=null===(a=eo.params)||void 0===a?void 0:a.sql_template)&&void 0!==S?S:"",options:{readOnly:!0}})})]})]})}),(0,i.jsxs)(Y.u_,{isOpen:K,onClose:B,isCentered:!0,size:"6xl",children:[Q,(0,i.jsxs)(ee.h,{overflowY:"auto",height:"40%",width:"60%",children:[(0,i.jsx)(en.x,{children:"Preset Check Template"}),(0,i.jsx)(eN.o,{}),(0,i.jsxs)(et.f,{children:[(0,i.jsxs)(h.X,{size:"sm",fontWeight:"bold",children:["Please"," ",(0,i.jsx)(ei.x,{as:"span",cursor:"pointer",_hover:{textDecoration:"underline"},color:"blue.500",onClick:async()=>{await navigator.clipboard.writeText(V),D("Copied the template to the clipboard")},children:"copy"})," ","the following template and paste it into the"," ",(0,i.jsx)(tq.y,{query:"recce.yml",styles:{px:"1",py:"0",bg:"red.100"},children:"recce.yml"})," ","file."]}),(0,i.jsx)("br",{}),(0,i.jsx)(rD,{yamlTemplate:V})]})]})]})]})};var rN=t(88994);let rF=e=>{var n,t,r,s,a;let{check:d,selected:u,onSelect:h,onMarkAsApproved:x}=e,{readOnly:m}=tn(),p=(0,k.NL)(),f=d.check_id,{mutate:g}=(0,tZ.D)({mutationFn:e=>tL(f,e),onSuccess:async()=>{await p.invalidateQueries({queryKey:q.check(f)}),await p.invalidateQueries({queryKey:q.checks()})}}),{run:v}=iZ(null===(n=d.last_run)||void 0===n?void 0:n.run_id),j=null!==(r=null===(t=ta(d.type))||void 0===t?void 0:t.icon)&&void 0!==r?r:eH.WzH,y=rM(null!==(s=d.type)&&void 0!==s?s:"",v)||m,b=rM(null!==(a=d.type)&&void 0!==a?a:"",v);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(c.k,{width:"100%",p:"10px 20px",cursor:"pointer",_hover:{bg:"Cornsilk"},bg:u?"Floralwhite":"inherit",borderBlockEndWidth:"1px",borderLeftWidth:"3px",borderLeftColor:u?"orange":"transparent",onClick:()=>{h(d.check_id)},alignItems:"center",gap:"5px",children:[(0,i.jsx)(o.J,{as:j}),(0,i.jsx)(l.x,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:d.name}),(0,i.jsx)(nW.u,{label:b?"Run the check first":"Click to mark as approved",placement:"top",hasArrow:!0,children:(0,i.jsx)(c.k,{children:(0,i.jsx)(nT.X,{isChecked:d.is_checked,variant:"circular",colorScheme:"green",size:"xs",onChange:e=>{let n=e.target.checked;n?x():g({is_checked:n})},disabled:y})})})]})})},rq=e=>{let{checks:n,selectedItem:t,onCheckSelected:r,onChecksReordered:o}=e,[s,a]=(0,b.useState)(!1),d=(0,k.NL)(),{mutate:u}=(0,tZ.D)({mutationFn:e=>tL(e,{is_checked:!0}),onSuccess:async(e,n)=>{await d.invalidateQueries({queryKey:q.check(n)}),await d.invalidateQueries({queryKey:q.checks()})}}),{isOpen:h,onOpen:x,onClose:m}=(0,G.q)(),{markedAsApprovedToast:p}=rT(),f=()=>{"true"===localStorage.getItem("bypassMarkAsApprovedWarning")?(u(t),p()):x()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(rN.Z5,{onDragEnd:e=>{e.destination&&o(e.source.index,e.destination.index)},children:(0,i.jsx)(rN.bK,{droppableId:"checklist",children:e=>(0,i.jsxs)(nb.g,{...e.droppableProps,ref:e.innerRef,w:"full",spacing:"0",flex:"1",overflow:"auto",children:[n.map((e,n)=>(0,i.jsx)(rN._l,{draggableId:e.check_id,index:n,children:(n,l)=>{if(l.isDragging){let e=n.draggableProps;if(null!=e.style&&"left"in e.style){let n={x:0,y:80},t=e.style.left-n.x,i=e.style.top-n.y;e.style.left=t,e.style.top=i}}return(0,i.jsx)(c.k,{ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,w:"full",children:(0,i.jsx)(rF,{check:e,selected:e.check_id===t,onSelect:r,onMarkAsApproved:f},e.check_id)})}},e.check_id)),e.placeholder]})})}),(0,i.jsxs)(Y.u_,{isOpen:h,onClose:m,isCentered:!0,children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{width:"400px",children:[(0,i.jsx)(en.x,{children:"Mark as Approved?"}),(0,i.jsx)(eN.o,{}),(0,i.jsx)(nK.i,{}),(0,i.jsxs)(l.x,{p:"16px",fontSize:"sm",gap:"16px",children:[(0,i.jsx)("p",{children:"Please ensure you have reviewed the contents of this check before marking it as approved."}),(0,i.jsx)(nT.X,{isChecked:s,onChange:e=>{a(e.target.checked)},fontWeight:"bold",size:"sm",pt:"8px",children:"Don't show this again"})]}),(0,i.jsx)(nK.i,{}),(0,i.jsxs)(el.m,{children:[(0,i.jsx)(er.z,{variant:"outline",size:"xs",mr:2,onClick:m,children:"Cancel"}),(0,i.jsx)(er.z,{colorScheme:"blue",size:"xs",onClick:()=>{u(t),s&&localStorage.setItem("bypassMarkAsApprovedWarning","true"),p(),m()},children:"Mark as approved"})]})]})]})]})};function rH(e){let{checksOnly:n=!0}=e,{readOnly:t}=tn(),l=(0,s.p)(),r=(0,k.NL)(),a=(0,b.useRef)(null),d=(0,b.useRef)(null),[u,h]=(0,b.useState)(null),{isOpen:x,onOpen:m,onClose:p}=(0,G.q)(),[f,g]=(0,eq.TH)(),[,v]=eA(),j=(0,b.useCallback)(async()=>{if(u){try{let{runs:e,checks:t}=await ty(u,n);v(),await r.invalidateQueries({queryKey:q.checks()}),await r.invalidateQueries({queryKey:q.runs()}),f.includes("/checks")&&g("/checks");let i=n?"".concat(t," checks imported successfully"):"".concat(e," runs and ").concat(t," checks imported successfully");l({description:i,status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}catch(e){console.error("Import failed",e),l({title:"Import failed",description:String(e),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}p()}},[r,u,l,p,f,g,v,n]),y=()=>{a.current&&a.current.click()},w=n?"checks":"runs and checks",{isDemoSite:C}=eM();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nW.u,{label:"Import Checklist from State File"+(C?" (Disabled in the demo site)":""),children:(0,i.jsx)(nu.h,{pt:"6px",variant:"unstyled","aria-label":"Import state",onClick:()=>{y(),ey({name:"import"})},icon:(0,i.jsx)(o.J,{as:lM}),isDisabled:t||C})}),(0,i.jsx)("input",{type:"file",style:{display:"none"},ref:a,onChange:e=>{var n;(null===(n=e.target.files)||void 0===n?void 0:n.length)===1&&(h(e.target.files[0]),m()),a.current&&(a.current.value="")}}),(0,i.jsx)(re.aR,{isOpen:x,leastDestructiveRef:d,onClose:p,size:"xl",children:(0,i.jsx)($.Z,{children:(0,i.jsxs)(re._T,{children:[(0,i.jsx)(en.x,{fontSize:"lg",fontWeight:"bold",children:"Import state"}),(0,i.jsx)(et.f,{children:(0,i.jsxs)(c.k,{px:"5px",gap:"5px",rounded:"md",direction:"column",children:[(0,i.jsxs)(c.k,{alignItems:"center",gap:"5px",children:[(0,i.jsx)(iL.s,{color:"red.600"}),(0,i.jsx)(ei.x,{as:"span",fontWeight:"500",color:"red.600",children:"Caution!"})]}),(0,i.jsx)(c.k,{children:(0,i.jsxs)(ei.x,{children:["The current ",w," will be"," ",(0,i.jsx)(ei.x,{as:"span",fontWeight:"600",children:"merged"})," ","with the imported state"]})})]})}),(0,i.jsxs)(el.m,{children:[(0,i.jsx)(er.z,{ref:d,onClick:p,children:"Cancel"}),(0,i.jsx)(er.z,{colorScheme:"blue",onClick:j,ml:"5px",children:"Import"})]})]})})})]})}let rP=()=>{let[,e]=(0,eq.TH)(),[,n]=(0,eq.yj)("/checks/:checkId"),{latestSelectedCheckId:t,setLatestSelectedCheckId:r}=tp(),o=(0,k.NL)(),s=null==n?void 0:n.checkId;s&&r(s);let{isLoading:a,error:d,data:u,status:h,refetch:x}=(0,w.a)({queryKey:q.checks(),queryFn:tI,refetchOnMount:!0}),m=(0,b.useCallback)(n=>{e("/checks/".concat(n))},[e]),[p,f]=(0,b.useState)(null!=u?u:[]),{mutate:g}=(0,tZ.D)({mutationFn:e=>tT(e),onSuccess:async()=>{await o.invalidateQueries({queryKey:q.checks()})}}),v=(0,b.useCallback)((e,n)=>{let t=[...p],[i]=t.splice(e,1);t.splice(n,0,i),g({source:e,destination:n}),f(t)},[p,f,g]);return((0,b.useEffect)(()=>{"success"===h&&(!s&&u.length>0&&(t?e("/checks/".concat(t)):e("/checks/".concat(u[0].check_id))),f(u))},[h,s,u,f,e,t]),a)?(0,i.jsx)(i.Fragment,{}):d?(0,i.jsxs)(i.Fragment,{children:["Error: ",d.message]}):(null==u?void 0:u.length)?(0,i.jsxs)(t9,{style:{height:"100%"},minSize:50,sizes:[20,80],children:[(0,i.jsx)(l.x,{borderRight:"lightgray solid 1px",height:"100%",style:{contain:"size"},children:(0,i.jsxs)(nb.g,{spacing:0,h:"100%",style:{contain:"strict"},alignItems:"stretch",children:[(0,i.jsx)(c.k,{justifyContent:"right",padding:"0px 10px",children:(0,i.jsx)(rH,{checksOnly:!0})}),(0,i.jsx)(nK.i,{}),(0,i.jsx)(rq,{checks:p,selectedItem:s,onCheckSelected:m,onChecksReordered:v})]})}),(0,i.jsx)(l.x,{height:"100%",children:(0,i.jsx)(eq.rs,{children:(0,i.jsx)(eq.AW,{path:"/checks/:checkId",children:e=>(0,i.jsx)(rA,{checkId:e.checkId,refreshCheckList:x},e.checkId)})})})]}):(0,i.jsx)(ni.M,{h:"100%",children:(0,i.jsx)(l.x,{children:"No checks"})})},rV=()=>{let{isHistoryOpen:e,showHistory:n,closeHistory:t}=th();return(0,i.jsxs)(l.x,{children:[(0,i.jsx)(l.x,{fontSize:"8pt",children:"History"}),(0,i.jsx)(er.z,{leftIcon:(0,i.jsx)(o.J,{as:ns.M1Q}),size:"xs",variant:"outline",onClick:()=>{e?(eh({name:"hide"}),t()):(eh({name:"show"}),n())},children:e?"Hide":"Show"})]})},rW=()=>{let{isCustomQueries:e,setCustomQueries:n,sqlQuery:t,setBaseSqlQuery:r}=z();return(0,i.jsxs)(l.x,{children:[(0,i.jsxs)(l.x,{fontSize:"8pt",children:["Custom Queries ","",(0,i.jsx)(nW.u,{label:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,i.jsx)(iL.s,{color:"gray.600",boxSize:"3"})})]}),(0,i.jsx)(ra.r,{size:"sm",isChecked:e,onChange:()=>{!e&&r&&r(t),n(!e)}})]})},rK=()=>{let{sqlQuery:e,baseSqlQuery:n,setSqlQuery:t,setBaseSqlQuery:r,primaryKeys:o,setPrimaryKeys:s,isCustomQueries:a}=z(),{lineageGraph:d,envInfo:u}=eM(),{readOnly:h}=tn(),{data:x}=eD(),p=e;(null==u?void 0:u.adapterType)==="sqlmesh"&&e===C&&(p="select * from db.mymodel"),h&&(p="--- Would like to do query here? Book a demo with us at https://datarecce.io/\n".concat(p));let{showRunId:f}=th(),g=async e=>{let t="query_base"===e?null!=n?n:"":p,i=function(e){switch(e){case"query":return lh;case"query_base":return lx;case"query_diff":return lm;default:throw Error("Unknown query type: ".concat(e))}}(e),l={sql_template:t};"query_diff"===e&&(l.primary_keys=o,a&&(l.base_sql_template=n));let{run_id:r}=await i(l,{nowait:!0});return f(r),await ek(r)},{mutate:v,isPending:j}=(0,tZ.D)({mutationFn:g}),y=(0,b.useMemo)(()=>{let e={};for(let t in null==d?void 0:d.nodes){var n;let i=null===(n=d.nodes[t].data.current)||void 0===n?void 0:n.schema;i&&(e[i]=(e[i]||0)+1)}return Object.keys(e).reduce((n,t)=>e[t]>(e[n]||0)?t:n,"N/A")},[null==d?void 0:d.nodes]);return(null==x?void 0:x.single_env_onboarding)?(0,i.jsxs)(c.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(c.k,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",children:[(0,i.jsx)(rV,{}),(0,i.jsx)(m.L,{}),(0,i.jsx)(nW.u,{label:"Please configure the base environment before running the diff",placement:"left",children:(0,i.jsx)(er.z,{colorScheme:"blue",isDisabled:!0,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})})]}),(0,i.jsx)(ib,{value:p,onChange:t,onRun:()=>{v("query")},labels:["base (production)","current (".concat(y,")")],BaseEnvironmentSetupGuide:(0,i.jsx)(rp,{})})]}):(0,i.jsxs)(c.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(c.k,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,i.jsx)(rV,{}),(0,i.jsx)(rW,{}),(0,i.jsx)(m.L,{}),(0,i.jsx)(lj,{defaultPrimaryKeys:o,onPrimaryKeysChange:s}),(0,i.jsx)(er.z,{colorScheme:"blue",onClick:()=>{v("query_diff")},isDisabled:j||h,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})]}),(0,i.jsx)(l.x,{width:"100%",flex:"1",children:a?(0,i.jsx)(ib,{value:p,baseValue:n,onChange:t,onChangeBase:r,onRun:()=>{v("query")},onRunBase:()=>{v("query_base")},onRunDiff:()=>{v("query_diff")}}):(0,i.jsx)(iy,{value:p,onChange:t,onRun:()=>{v("query")},onRunDiff:()=>{v("query_diff")}})})]})};var rJ=t(12826);let rB=e=>{(0,rJ.c4)("#!"+e)},rU=()=>[(0,rJ.LD)(()=>window.location.hash.replace(/^#!/,"")||"/",()=>"/ssr"),rB];var rQ=t(9779),rZ=t(75242);let rX=e=>{var n;let{runId:t}=e,{isPending:l,error:r,data:o}=(0,w.a)({queryKey:q.run(t),queryFn:async()=>ek(t)}),s=(null==o?void 0:o.type)?null===(n=ta(o.type))||void 0===n?void 0:n.RunResultView:void 0;return(0,i.jsx)(iC,{isPending:l,error:r,run:o,RunResultView:s})},rG=e=>{let{error:n,resetError:t}=e;return(0,i.jsx)(ni.M,{height:"100%",backgroundColor:"gray.50",children:(0,i.jsxs)(c.k,{p:4,direction:"column",justifyContent:"flex-start",backgroundColor:"white",border:"solid lightgray 1px",minHeight:"200px",children:[(0,i.jsx)(h.X,{width:"800px",size:"md",children:"You have encountered an error"}),(0,i.jsx)(l.x,{flex:"1",fontSize:"10pt",children:n.toString()}),(0,i.jsx)(er.z,{justifySelf:"center",alignSelf:"center",mt:"20px",colorScheme:"blue",size:"sm",onClick:()=>{t()},children:"Reset"})]})})},rY=e=>{let{children:n}=e;return(0,i.jsx)(ik.SV,{fallback:rG,children:n})};function r$(){let{readOnly:e}=tn(),n=(0,s.p)(),t=async()=>{try{let e=await tj(),n=JSON.stringify(e,null,2),t=new Blob([n],{type:"application/json"}),i=new Date,l="recce-state-".concat((0,i9.WU)(i,"yyyy-MM-dd-HH-mm-ss"),".json");i7()(t,l)}catch(e){console.error("Export failed",e),n({title:"Export failed",description:String(e),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}};return(0,i.jsx)(nW.u,{label:"Export",children:(0,i.jsx)(nu.h,{size:"sm",variant:"unstyled","aria-label":"Export state",onClick:async()=>{await t(),ey({name:"export"})},icon:(0,i.jsx)(o.J,{as:lO,verticalAlign:"middle",boxSize:"16px"}),isDisabled:e})})}function r0(){return(0,i.jsx)(E.tV,{children:(0,i.jsx)(rE,{interactive:!0})})}t(50710);let r1=e=>{let{isGuideOpen:n,closeGuide:t}=e;return(0,i.jsxs)(Y.u_,{isOpen:n,onClose:t,scrollBehavior:"inside",children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{maxW:"80vw",h:"80vh",children:[(0,i.jsx)(en.x,{children:"Welcome to Recce: 3 Steps to Begin"}),(0,i.jsx)(eN.o,{}),(0,i.jsx)(et.f,{children:(0,i.jsxs)(iv.K,{spacing:4,children:[(0,i.jsxs)(t7.aV,{spacing:2,children:[(0,i.jsx)(t7.HC,{children:"Step 1: Click the model you want to check"}),(0,i.jsx)(t7.HC,{children:'Step 2: Click "Explore Change"'}),(0,i.jsx)(t7.HC,{children:'Step 3: Click "Add to Checklist"'})]}),(0,i.jsx)(nK.i,{}),(0,i.jsx)(u.E,{src:"https://datarecce.io/assets/images/onboarding/material.svg",alt:"placeholder"})]})}),(0,i.jsx)(el.m,{children:(0,i.jsx)(er.z,{colorScheme:"blue",onClick:t,children:"Got it!"})})]})]})};var r5=()=>{let[e,n]=(0,b.useState)(!1),{data:t,isLoading:l}=eD();return((0,b.useEffect)(()=>{if(!l&&t){let e=t.show_onboarding_guide;!localStorage.getItem("hasVisited")&&e&&(n(!0),localStorage.setItem("hasVisited","true"))}},[t,l]),l)?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(r1,{isGuideOpen:e,closeGuide:()=>{n(!1),eE()}})},r2=t(62438);t(30848);let r4=e=>{var n,t;let{run:r,isSelected:s,onSelectRun:a,onAddToChecklist:d,onGoToCheck:u}=e,{readOnly:h,singleEnv:x}=tn(),{data:m}=(0,w.a)({queryKey:q.run(r.run_id),queryFn:async()=>await ek(r.run_id),enabled:"running"===r.status,retry:!1}),p=null!==(t=null===(n=ta(r.type))||void 0===n?void 0:n.icon)&&void 0!==t?t:eH.WzH,f=r.check_id;return(0,i.jsxs)(c.k,{minWidth:"200px",direction:"column",width:"100%",p:"5px 20px",cursor:"pointer",borderBottom:"solid 1px lightgray",borderLeft:"4px",borderLeftColor:s?"orange.400":"transparent",backgroundColor:s?"orange.50":"transparent",onClick:()=>{a(r.run_id)},_hover:{bg:s?"orange.50":"gray.200"},children:[(0,i.jsxs)(c.k,{onClick:()=>{},alignItems:"center",gap:"12px",children:[(0,i.jsx)(o.J,{as:p}),(0,i.jsx)(l.x,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",color:r.name?"inherit":"gray.500",fontSize:"11pt",fontWeight:"500",children:r.name||"<no name>"}),f?(0,i.jsx)(nW.u,{label:"Go to Check","aria-label":"Go to Check",children:(0,i.jsx)(ei.x,{onClick:e=>{e.preventDefault(),e.stopPropagation(),u(f)},children:(0,i.jsx)(o.J,{color:"green",as:ie.FJM})})}):h||x?null:(0,i.jsx)(nW.u,{label:"Add to Checklist","aria-label":"Add to Checklist",children:(0,i.jsx)(ei.x,{onClick:e=>{e.preventDefault(),e.stopPropagation(),eh({name:"add_to_checklist"}),d(r.run_id)},children:(0,i.jsx)(o.J,{as:ie.wO})})})]}),(0,i.jsx)(c.k,{justifyContent:"start",fontSize:"11pt",color:"gray.500",gap:"3px",alignItems:"center",children:(0,i.jsx)(ll,{run:null!=m?m:r})})]})},r6=e=>{let{runAt:n}=e,t=n?function(e){let n=new Date,t=new Date;return(t.setDate(n.getDate()-1),null==e)?null:n.toDateString()===e.toDateString()?"Today":t.toDateString()===e.toDateString()?"Yesterday":(0,i9.WU)(e,"MMM d")}(new Date(n)):null;return(0,i.jsx)(c.k,{minWidth:"200px",width:"100%",p:"5px 20px",borderBottom:"solid 1px lightgray",color:"gray.500",fontSize:"11pt",children:t})},r3=()=>{let{data:e,isLoading:n,isFetching:t,error:r,refetch:o}=(0,w.a)({queryKey:q.runs(),queryFn:async()=>await ez(),retry:!1}),{showRunId:s,runId:a}=th(),d=e=>{eh({name:"click_run"}),s(e,!1)},[,u]=(0,eq.TH)(),p=(0,k.NL)(),f=(0,b.useCallback)(async()=>{if(!a)return;let e=await tR(a);await p.invalidateQueries({queryKey:q.checks()}),u("/checks/".concat(e.check_id))},[a,u,p]),g=(0,b.useCallback)(e=>{eh({name:"go_to_check"}),u("/checks/".concat(e))},[u]),v=null;return(0,i.jsxs)(c.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(x.U,{width:"100%",flex:"0 0 54px",paddingInline:"24px 8px",borderBottom:"solid 1px lightgray",children:[(0,i.jsx)(h.X,{size:"md",children:"History"}),(0,i.jsx)(m.L,{}),(0,i.jsx)(nu.h,{variant:"unstyled",icon:(0,i.jsx)(tV.n,{}),"aria-label":"Search database",onClick:async()=>{await o()}})]}),(0,i.jsx)(l.x,{flex:"1 1 auto",children:n?"Loading...":(null==e?void 0:e.length)===0?(0,i.jsx)(ni.M,{height:"100%",color:"gray.400",children:"No runs"}):(0,i.jsx)(r2.Z,{style:{minHeight:"100%",height:0},children:(null!=e?e:[]).map((e,n)=>{let t=new Date(e.run_at).toDateString(),l=null!=v&&v!==t;return v=t,(0,i.jsxs)(i.Fragment,{children:[l&&(0,i.jsx)(r6,{runAt:e.run_at},t),(0,i.jsx)(r4,{run:e,isSelected:e.run_id===a,onSelectRun:d,onGoToCheck:g,onAddToChecklist:f},e.run_id)]})})})})]})};var r9=t(74614),r8=t(92475);let{definePartsStyle:r7,defineMultiStyleConfig:oe}=(0,r8.D)(r9.TB.keys),on=oe({variants:{circular:r7({control:(0,r8.k0)({rounded:"full"})})},sizes:{xs:r7({icon:(0,r8.k0)({fontSize:"8px"}),control:(0,r8.k0)({boxSize:"16px",padding:"4px"}),label:(0,r8.k0)({fontSize:"xs"})})}}),ot=(0,t(71034).fj)({baseStyle:{borderRadius:"4px"}});var oi=t(91153);let ol=()=>{let e=(0,s.p)();return{toastSuccess:n=>{e({description:n,status:"success",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0})},toastError:(n,t)=>{let i=n;if(null!=t){if(t instanceof tf.d7){var l,r;i="".concat(n,". ").concat(String(null===(r=t.response)||void 0===r?void 0:null===(l=r.data)||void 0===l?void 0:l.detail))}else i="".concat(n,". ").concat(t)}e({description:i,status:"error",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0})}}},or=e=>{(0,b.useEffect)(()=>{let n=e=>{e.preventDefault()};return e&&window.addEventListener("beforeunload",n),()=>{e&&window.removeEventListener("beforeunload",n)}},[e])},oo=()=>{var e,n;let t;let{readOnly:r}=tn(),{fileName:s,cloudMode:a,isDemoSite:d,envInfo:u}=eM(),h=(0,G.q)(),x=(0,G.q)(),m=!s&&!a&&!d,{data:p}=(0,w.a)({queryKey:q.checks(),queryFn:tI,enabled:m}),f=void 0!=p&&p.filter(e=>!e.is_preset).length>0;or(m&&f);let[{newFileName:g,errorMessage:v,modified:j,overwriteWithMethod:y,bypass:C},_]=(0,b.useState)({newFileName:null!=s?s:"recce_state.json"}),S=(0,b.useRef)(null),{toastSuccess:z,toastError:R}=ol(),I=(0,k.NL)(),E=async(e,n)=>{if(!g)return;let t="true"===localStorage.getItem(lC.bypassSaveOverwrite);try{"save"===e?await tg({filename:g,overwrite:null!=n?n:t}):await tv({filename:g,overwrite:null!=n?n:t}),z("save"===e?"Save file successfully":"Rename file successfully"),await I.invalidateQueries({queryKey:q.lineage()}),C&&localStorage.setItem(lC.bypassSaveOverwrite,"true")}catch(n){if(n instanceof tf.d7){var i;if((null===(i=n.response)||void 0===i?void 0:i.status)===409){_(n=>({...n,overwriteWithMethod:e})),x.onOpen();return}}R("save"===e?"Save file failed":"Rename file failed",n)}finally{h.onClose()}};if(a||d)return(0,i.jsx)(i.Fragment,{});if(r&&s){let n=null==u?void 0:null===(e=u.stateMetadata)||void 0===e?void 0:e.generated_at,i=n?li(new Date(n)):null;t=i?"".concat(s," (").concat(i,")"):null}return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(c.k,{justifyContent:"center",alignItems:"center",children:[(0,i.jsx)(l.x,{fontWeight:"600",children:null!==(n=null!=t?t:s)&&void 0!==n?n:"New Instance"+(f?" (unsaved)":"")}),!r&&(0,i.jsx)(nW.u,{label:s?"Change Filename":"Save",openDelay:1e3,children:(0,i.jsx)(nu.h,{onClick:()=>{_({newFileName:null!=s?s:"recce_state.json",modified:!s}),h.onOpen()},"aria-label":"",variant:"unstyled",size:"sm",children:(0,i.jsx)(o.J,{as:s?lN:lA,boxSize:"16px",verticalAlign:"middle"})})})]}),(0,i.jsxs)(Y.u_,{isOpen:h.isOpen,onClose:h.onClose,isCentered:!0,children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{children:[(0,i.jsx)(en.x,{children:s?"Change Filename":"Save File"}),(0,i.jsx)(eN.o,{}),(0,i.jsx)(et.f,{onKeyDown:e=>{e.stopPropagation()},children:(0,i.jsxs)(eP.NI,{isInvalid:!!v,children:[(0,i.jsx)(eV.l,{children:"File name:"}),(0,i.jsx)(nY.I,{ref:S,value:g,placeholder:"Enter filename",onChange:e=>{let n;let t=e.target.value;t?t.endsWith(".json")?/^[a-zA-Z0-9 _-]+\.json$/.test(t)?s&&t===s&&(n="Filename is the same as the current one."):n="Invalid filename. Only alphanumeric, space, _ and - are allowed.":n="Filename must end with .json.":n="Filename cannot be empty.",_(e=>({...e,modified:!0,newFileName:t,errorMessage:n}))},onKeyDown:e=>{"Enter"===e.key?v||(s?E("rename"):E("save")):"Escape"===e.key&&h.onClose()}}),(0,i.jsx)(oi.J1,{children:v})]})}),(0,i.jsxs)(el.m,{gap:"5px",children:[(0,i.jsx)(er.z,{size:"sm",colorScheme:s?void 0:"blue",onClick:async()=>{await E("save")},isDisabled:!g||!!v||!j,children:s?"Save as New File":"Confirm"}),s&&(0,i.jsx)(er.z,{size:"sm",colorScheme:"blue",onClick:async()=>{await E("rename")},isDisabled:!g||!!v||!j,children:"Rename"})]})]})]}),(0,i.jsxs)(Y.u_,{isOpen:x.isOpen,onClose:x.onClose,initialFocusRef:S,isCentered:!0,children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{children:[(0,i.jsx)(en.x,{children:"Overwrite File?"}),(0,i.jsx)(eN.o,{}),(0,i.jsxs)(et.f,{borderTop:"solid 1px lightgray",borderBottom:"solid 1px lightgray",onKeyDown:e=>{e.stopPropagation()},children:[(0,i.jsx)(l.x,{fontSize:"12pt",children:"save"===y?"Saving a file with this name will overwrite the existing file. Are you sure you wish to continue?":"Renaming the file with this name will overwrite the existing file. Are you sure you wish to continue?"}),(0,i.jsx)(nT.X,{isChecked:C,onChange:e=>{_(n=>({...n,bypass:e.target.checked}))},fontWeight:"bold",size:"sm",pt:"8px",children:"Don't show this again"})]}),(0,i.jsxs)(el.m,{gap:"5px",children:[(0,i.jsx)(er.z,{variant:"outline",onClick:()=>{x.onClose(),h.onOpen(),_(e=>({...e,overwriteWithMethod:void 0}))},size:"sm",children:"Back"}),(0,i.jsx)(er.z,{size:"sm",colorScheme:"blue",onClick:()=>{y&&(E(y,!0),x.onClose())},children:"Overwrite"})]})]})]})]})};var os=t(18707),oa=t(48262);function od(){return(0,i.jsx)(nW.u,{label:"Syncing",children:(0,i.jsx)(er.z,{pt:"6px",variant:"unstyled",boxSize:"1em",children:(0,i.jsx)(iS.$,{})})})}function oc(){let[e,n]=(0,b.useState)(!1),t=(0,k.NL)(),[r,a]=(0,eq.TH)(),{isOpen:d,onOpen:c,onClose:u}=(0,G.q)(),[h,x]=(0,b.useState)(""),m=(0,s.p)(),p=(0,b.useCallback)(async e=>{if(u(),n(!0),"conflict"===(await tw(e)).status){c(),n(!1);return}for(;await tb();)await new Promise(e=>setTimeout(e,1e3));m({description:"Sync Completed",status:"success",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0}),n(!1),x(""),await t.invalidateQueries({queryKey:q.lineage()}),await t.invalidateQueries({queryKey:q.checks()}),await t.invalidateQueries({queryKey:q.runs()}),/^\/checks\/([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/.test(r)&&a("/checks")},[t,r,a,m,c,u]);return e?(0,i.jsx)(od,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nW.u,{label:"Sync with Cloud",children:(0,i.jsx)(nu.h,{size:"sm",variant:"unstyled","aria-label":"Sync state",onClick:()=>p({}),icon:(0,i.jsx)(o.J,{as:lT,verticalAlign:"middle",boxSize:"16px"})})}),(0,i.jsxs)(Y.u_,{isOpen:d,onClose:u,children:[(0,i.jsx)($.Z,{}),(0,i.jsxs)(ee.h,{children:[(0,i.jsx)(en.x,{fontSize:"lg",fontWeight:"bold",children:"Sync with Cloud"}),(0,i.jsxs)(et.f,{children:[(0,i.jsx)(l.x,{children:"New changes have been detected in the cloud. Please choose a method to sync your state"}),(0,i.jsx)(l.x,{mt:"5px",children:(0,i.jsx)(os.E,{onChange:x,value:h,children:(0,i.jsxs)(iv.K,{direction:"column",children:[(0,i.jsxs)(oa.Y,{value:"merge",children:["Merge",(0,i.jsx)(nW.u,{label:"This will merge the local and remote states.",children:(0,i.jsx)("span",{children:(0,i.jsx)(o.J,{as:rt.h,ml:2,cursor:"pointer"})})})]}),(0,i.jsxs)(oa.Y,{value:"overwrite",children:["Overwrite",(0,i.jsx)(nW.u,{label:"This will overwrite the remote state file with the local state.",children:(0,i.jsx)("span",{children:(0,i.jsx)(o.J,{as:rt.h,ml:2,cursor:"pointer"})})})]}),(0,i.jsxs)(oa.Y,{value:"revert",children:["Revert",(0,i.jsx)(nW.u,{label:"This will discard local changes and revert to the cloud state.",children:(0,i.jsx)("span",{children:(0,i.jsx)(o.J,{as:rt.h,ml:2,cursor:"pointer"})})})]})]})})})]}),(0,i.jsxs)(el.m,{children:[(0,i.jsx)(er.z,{onClick:u,mr:3,children:"Cancel"}),(0,i.jsx)(er.z,{colorScheme:"blue",onClick:()=>p({method:h}),isDisabled:!h,children:"Sync"})]})]})]})]})}function ou(){let{successToast:e,failToast:n}=im(),{onCopy:t}=(0,nc.V)(""),{authed:l}=tn(),{shareUrl:o,isLoading:s,error:a,handleShareClick:d}=tS(),u=()=>{try{t(o),e("Copied the link to clipboard")}catch(e){n("Failed to copy the link",e)}};return l?(0,i.jsxs)(c.k,{flex:"1",alignItems:"center",gap:"5px",children:[(0,i.jsx)(er.z,{size:"sm",variant:"outline",onClick:async()=>{await d(),ej({name:"create"})},leftIcon:(0,i.jsx)(eH.eOs,{}),rightIcon:o?(0,i.jsx)(tP.r,{color:"green"}):void 0,isLoading:s,children:"Share"}),(0,i.jsxs)(c.k,{gap:"5px",alignItems:"center",children:[o&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.k,{overflowX:"auto",whiteSpace:"nowrap",maxWidth:"350px",children:(0,i.jsx)(ei.x,{fontSize:"14",children:o})}),(0,i.jsx)(nu.h,{size:"xs","aria-label":"Copy the share URL",icon:(0,i.jsx)(nd.T,{}),onClick:()=>{u(),ej({name:"copy"})}})]}),a&&(0,i.jsx)(ei.x,{fontSize:"14",color:"red.500",children:a})]})]}):(0,i.jsx)(c.k,{flex:"1",alignItems:"center",children:(0,i.jsxs)(iX.J,{trigger:"hover",placement:"bottom-start",children:[(0,i.jsx)(iG.x,{children:(0,i.jsx)(er.z,{rightIcon:(0,i.jsx)(i5.h,{}),size:"sm",onClick:()=>{ej({name:"enable"}),window.open("".concat(J,"/settings?utm_source=recce_oss&utm_content=enable_sharing_button#tokens"),"_blank")},children:"Enable sharing"})}),(0,i.jsx)(iY.y,{bg:"black",color:"white",sx:{width:"max-content"},children:(0,i.jsxs)(i$.b,{fontSize:"sm",children:["API token required."," ",(0,i.jsx)(r.r,{href:"https://docs.datarecce.io/recce-cloud/share-recce-session-securely",target:"_blank",textDecoration:"underline",children:"Learn more"}),"."]})})]})})}let oh={TOAST_ID:"lifetime-countdown",WARNING_THRESHOLD:60,UPDATE_INTERVAL:1e3,MESSAGE:e=>"The server will be closed in ".concat(e," seconds."),STYLE:{fontFamily:"monospace"}},ox=e=>{let{children:n,path:t}=e,[r]=(0,eq.yj)(t);return(0,i.jsx)(l.x,{display:r?"block":"none",height:"100%",children:n})};function om(e){let{icon:n,href:t,...l}=e;return(0,i.jsx)(r.r,{height:"20px",color:"white",href:t,isExternal:!0,...l,children:(0,i.jsx)(o.J,{color:"white",boxSize:"20px",as:n})})}function op(){let{version:e,latestVersion:n}=function(){let[e,n]=(0,b.useState)(""),[t,i]=(0,b.useState)("");return(0,b.useEffect)(()=>{(async function(){try{let{version:e,latestVersion:t}=(await U.get("/api/version")).data;n(e),i(t)}catch(e){console.error("Error fetching version number:",e)}})()},[]),{version:e,latestVersion:t}}(),t=(0,s.p)(),l="recce-update-available";return RegExp("^\\d+\\.\\d+\\.\\d+$").test(e)?(e===n||t.isActive(l)||t({id:l,title:"Update available",position:"top-right",description:(0,i.jsxs)("span",{children:["A new version of Recce (v",n,") is available.",(0,i.jsx)("br",{}),"Please run ",(0,i.jsx)(d.E,{children:"pip install --upgrade recce"})," to update Recce.",(0,i.jsx)("br",{}),(0,i.jsx)(r.r,{color:"rgb(255, 215, 0)",fontWeight:"bold",href:"https://github.com/DataRecce/recce/releases/tag/v".concat(n),isExternal:!0,_hover:{textDecoration:"underline"},target:"_blank",children:"Click here to view the detail of latest release"})]}),containerStyle:{background:"rgba(20, 20, 20, 0.6)",color:"white",backdropFilter:"blur(10px)",borderRadius:"8px"},variant:"unstyled",isClosable:!0}),(0,i.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:(0,i.jsx)(r.r,{href:"https://github.com/DataRecce/recce/releases/tag/v".concat(e),isExternal:!0,_hover:{textDecoration:"none"},children:e})})):(0,i.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:e})}function of(){var e;let{reviewMode:n,isDemoSite:t,envInfo:d,cloudMode:p}=eM(),{readOnly:f,lifetimeExpiredAt:g}=tn(),{url:v,id:j}=null!==(e=null==d?void 0:d.pullRequest)&&void 0!==e?e:{},y=v?v.split("/").pop():null;return!function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=(0,s.p)(),i=(0,b.useRef)(),l=(0,b.useRef)(),r=(0,b.useMemo)(()=>{var e,t,i;return{position:null!==(e=n.position)&&void 0!==e?e:"bottom-right",variant:null!==(t=n.variant)&&void 0!==t?t:"left-accent",status:null!==(i=n.status)&&void 0!==i?i:"warning",duration:null,isClosable:!0,containerStyle:oh.STYLE}},[n.position,n.variant,n.status]),o=(0,b.useCallback)(()=>{if(!e)return 0;let n=new Date;return Math.max(0,Math.floor((e.getTime()-n.getTime())/1e3))},[e]),a=(0,b.useCallback)(()=>{i.current&&(t.close(i.current),i.current=void 0),l.current&&(clearInterval(l.current),l.current=void 0)},[t]),d=(0,b.useCallback)(()=>{if(!i.current)return;let e=o();if(e<=0){a();return}t.update(i.current,{...r,description:oh.MESSAGE(e)})},[t,r,o,a]),c=(0,b.useCallback)(()=>{if(!e)return;a();let n=o();n<=0||(i.current=t({id:oh.TOAST_ID,description:oh.MESSAGE(n),...r}),l.current=setInterval(d,oh.UPDATE_INTERVAL))},[e,t,o,r,d,a]);(0,b.useEffect)(()=>{if(!e)return;let n=o();if(n-oh.WARNING_THRESHOLD<0)c();else{let e=setTimeout(c,(n-oh.WARNING_THRESHOLD)*1e3);return()=>{clearTimeout(e),a()}}return a},[e,o,c,a])}(g),(0,i.jsxs)(c.k,{gap:"10px",minHeight:"40px",alignItems:"center",bg:"rgb(255, 110, 66)",children:[(0,i.jsx)(u.E,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,i.jsx)(h.X,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,i.jsx)(op,{}),(f||n)&&(0,i.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:f?"read only":"review mode"}),p&&j&&(0,i.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:(0,i.jsxs)(x.U,{children:[(0,i.jsx)(l.x,{children:"cloud mode"}),(0,i.jsx)(l.x,{borderLeft:"1px",borderLeftColor:"whiteAlpha.500",paddingLeft:"8px",children:(0,i.jsxs)(r.r,{href:v,_hover:{textDecoration:"none"},isExternal:!0,children:[(0,i.jsx)(o.J,{as:ns.X9P,boxSize:"3",fontWeight:"extrabold",strokeWidth:"1"})," #".concat(String(j))]})})]})}),t&&v&&y&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:(0,i.jsxs)(x.U,{children:[(0,i.jsx)(l.x,{children:"demo mode"}),(0,i.jsx)(l.x,{borderLeft:"1px",borderLeftColor:"whiteAlpha.500",paddingLeft:"8px",children:(0,i.jsxs)(r.r,{href:v,_hover:{textDecoration:"none"},isExternal:!0,children:[(0,i.jsx)(o.J,{as:ns.X9P,boxSize:"3",fontWeight:"extrabold",strokeWidth:"1"})," #".concat(y)]})})]})})}),(0,i.jsx)(m.L,{}),(0,i.jsx)(om,{icon:ie.hJX,href:"https://github.com/DataRecce/recce"}),(0,i.jsx)(om,{icon:ie.w5k,href:"https://getdbt.slack.com/archives/C05C28V7CPP"}),(0,i.jsx)(om,{mr:"18px",icon:ie.MXt,href:"https://docs.datarecce.io"})]})}function og(e){let{queryKey:n,fetchCallback:t,selectCallback:r}=e,{data:o,isLoading:s,error:a}=(0,w.a)({queryKey:n,queryFn:t,select:r});return s||a||0===o?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(l.x,{ml:"2px",height:"80%",aspectRatio:1,borderRadius:"full",bg:"tomato",alignContent:"center",color:"white",fontSize:"xs",children:o})}function ov(){let{isDemoSite:e,cloudMode:n,isLoading:t}=eM(),{readOnly:r}=tn(),[o,s]=(0,eq.TH)(),{data:a,isLoading:d}=eD(),u=[{name:"Lineage",href:"/lineage"},{name:"Query",href:"/query"},{name:"Checklist",href:"/checks",badge:(0,i.jsx)(og,{queryKey:q.checks(),fetchCallback:tI,selectCallback:e=>e.filter(e=>!e.is_checked).length}),disable:(null==a?void 0:a.single_env_onboarding)===!0}],h=eJ().findIndex(u,e=>{let{href:n}=e;return o.startsWith(n)});return(0,i.jsx)(p.m,{index:h,children:(0,i.jsxs)(f.t,{children:[(0,i.jsx)(l.x,{flex:"1",display:"flex",children:u.map(e=>{let{name:n,href:l,badge:r,disable:o}=e;return(0,i.jsxs)(g.O,{onClick:()=>{s(l)},isDisabled:!!t||d||o,hidden:o,children:[n,r]},n)})}),(0,i.jsx)(c.k,{flex:"3",justifyContent:"right",alignItems:"center",children:!t&&!e&&(0,i.jsx)(oo,{})}),(0,i.jsx)(c.k,{flex:"3",justifyContent:"left",alignItems:"center",children:!t&&!e&&!(null==a?void 0:a.single_env_onboarding)&&!r&&(0,i.jsx)(ou,{})}),!t&&(0,i.jsxs)(c.k,{flex:"1",justifyContent:"right",alignItems:"center",mr:"8px",children:[n&&(0,i.jsx)(oc,{}),(0,i.jsx)(r$,{}),(0,i.jsx)(lW,{})]})]})})}function oj(){let{isRunResultOpen:e,isHistoryOpen:n,closeRunResult:t}=th(),{data:r}=eD(),[o]=(0,eq.TH)(),s=n&&!o.startsWith("/checks");return(0,i.jsxs)(t9,{sizes:[0,100],minSize:s?300:0,gutterSize:s?5:0,style:{height:"100%"},children:[(0,i.jsx)(l.x,{style:{contain:"size"},children:s&&(0,i.jsx)(r3,{})}),(0,i.jsxs)(t8,{sizes:e?[50,50]:[100,0],minSize:e?100:0,gutterSize:e?5:0,style:{flex:"1",contain:"size"},children:[(0,i.jsx)(l.x,{p:0,style:{contain:"content"},children:(0,i.jsxs)(rY,{children:[(0,i.jsx)(ox,{path:"/lineage",children:(0,i.jsx)(r0,{})}),(0,i.jsxs)(eq.rs,{children:[(0,i.jsx)(eq.AW,{path:"/query",children:(0,i.jsx)(rK,{})}),(0,i.jsx)(eq.AW,{path:"/checks/:slug*",children:(0,i.jsx)(rP,{})}),(0,i.jsx)(eq.AW,{path:"/runs/:runId",children:e=>{let{runId:n}=e;return(0,i.jsx)(rX,{runId:n})}}),(0,i.jsx)(eq.AW,{path:"/ssr",children:(0,i.jsx)(v.E,{size:"xs",isIndeterminate:!0})}),(0,i.jsx)(eq.AW,{children:(0,i.jsx)(eq.l_,{to:"/lineage"})})]})]})}),e?(0,i.jsx)(lu,{onClose:t,isSingleEnvironment:!!(null==r?void 0:r.single_env_onboarding)}):(0,i.jsx)(l.x,{})]})]})}let oy=(0,j.B1)({components:{Checkbox:on,Tooltip:ot}});function ob(){(0,b.useLayoutEffect)(()=>{!function(){let e=function(e){let n=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return n?n.pop():""}("recce_user_id"),n=ec.env.AMPLITUDE_API_KEY;if(e&&n)try{let t=(0,ed.k)();ea.IH(t),ea.S1(n,e,{autocapture:!0})}catch(e){console.error(e)}}()},[]);let e=(0,rQ.Z)({components:{MuiTooltip:{styleOverrides:{tooltip:{zIndex:1500}}}}});return(0,i.jsx)(rZ.Z,{theme:e,children:(0,i.jsx)(y.x,{theme:oy,children:(0,i.jsx)(k.aH,{client:Q,children:(0,i.jsx)(eq.F0,{hook:rU,children:(0,i.jsx)(tz,{children:(0,i.jsxs)(c.k,{direction:"column",height:"100vh",overflow:"hidden",children:[(0,i.jsx)(of,{}),(0,i.jsx)(ov,{}),(0,i.jsx)(r5,{}),(0,i.jsx)(oj,{})]})})})})})})}},52997:function(){},26372:function(){},90345:function(){},12613:function(){}},function(e){e.O(0,[113,266,517,376,455,881,678,509,648,989,147,995,739,283,303,22,25,355,495,599,971,368,62,700,744],function(){return e(e.s=65490)}),_N_E=e.O()}]);