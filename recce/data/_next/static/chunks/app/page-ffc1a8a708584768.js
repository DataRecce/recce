(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{29536:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>iz});var i=t(79367),l=t(781),s=t(57483),r=t(26917),o=t(70933),a=t(33449),c=t(70029),d=t(74673),u=t(45470),h=t(13944),x=t(5055),p=t(37659),m=t(48777),f=t(58708),j=t(5007),g=t(75842),v=t(77721);t(88930);var y=t(7206),b=t(28623);async function w(e,n){let t=(0,b.XJ)()?{breaking_change_analysis:!0}:{};return(await v.g.post("/api/checks",{run_id:e,view_options:n,track_props:t})).data}async function k(){return(await v.g.get("/api/checks")).data}async function C(e){return(await v.g.get("/api/checks/".concat(e))).data}async function _(e,n){return(await v.g.patch("/api/checks/".concat(e),n)).data}async function S(e){return(await v.g.delete("/api/checks/".concat(e))).data}async function z(e){return await v.g.post("/api/checks/reorder",e)}var E=t(36357),I=t(37018),D=t(28701),R=t(55255),T=t(95127),F=t(33674),N=t(77745),A=t(73793),q=t(25809),L=t(53379),M=t(74523),O=t(51583),P=t(64144),X=t(72039),K=t(39111),Q=t(25685),$=t(97274);function W(e){let{name:n,setName:t}=e,[s,r]=(0,j.useState)(!1),[o,a]=(0,j.useState)(n),c=(0,j.useRef)(null),d=(0,j.useCallback)(()=>{t(o),r(!1)},[t,r,o]);return(0,j.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&d()};return s&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[s,c,d]),(0,i.jsx)(Q.Yl,{flex:"0 1 auto",fontSize:"12pt",fontWeight:"500",className:"no-track-pii-safe",overflow:"hidden",children:(0,i.jsx)(Q.J5,{cursor:"pointer",flex:"0 1 auto",overflow:"hidden",children:s?(0,i.jsx)($.p,{ref:c,value:o,onChange:e=>{a(e.target.value)},onKeyDown:e=>{"Enter"===e.key?(t(o),r(!1)):"Escape"===e.key&&(a(n),r(!1))},size:"sm",w:"100%"}):(0,i.jsx)(l.a,{flex:"0 1 auto",onClick:()=>{a(n),r(!0)},textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n})})})}var Z=t(31633),V=t(13903),B=t(50154),H=t(44957),U=t(90271);t(79207);var G=t(97887),J=t(63845),Y=t(67774),ee=t(43094);let en=(0,j.createContext)(void 0),et=()=>{let e=(0,j.useContext)(en);if(!e)throw Error("useLineageViewContext must be used within a LineageViewProvider");return e},ei=()=>(0,j.useContext)(en);var el=t(41946);function es(e){let{model:n,row:t,singleEnv:s,cllRunning:o}=e,a=ei(),{runAction:d}=(0,G.tr)(),{featureToggles:u}=(0,ee.c)(),{name:h,baseType:x,currentType:m,baseIndex:f,currentIndex:j}=t,g=null!=m?m:x,v=!x||!m;return(0,i.jsx)(el.m,{content:"View column lineage",positioning:{placement:"top"},showArrow:!0,disabled:void 0===a||void 0!==f&&void 0===j,children:(0,i.jsxs)(c.s,{alignItems:"center",gap:"3px",children:[(0,i.jsx)(l.a,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:h}),(0,i.jsx)(p.h,{}),o&&(0,i.jsx)(J.y,{size:"xs",color:"gray.400"}),!s&&"source"!==n.resource_type&&(0,i.jsxs)(A.il,{children:[(0,i.jsx)(A.cQ,{asChild:!0,children:(0,i.jsx)(q.K,{display:"flex",className:"row-context-menu",variant:"plain",size:"sm",color:"gray",_hover:{color:"black"},disabled:u.disableDatabaseQuery,onClick:e=>{e.stopPropagation()},children:(0,i.jsx)(r.I,{as:Z.EUt})})}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsx)(A.rm,{lineHeight:"20px",children:(0,i.jsxs)(A.Uh,{title:"Diff",m:"0",p:"4px 12px",children:[(0,i.jsx)(A.Dr,{value:"profile-diff",fontSize:"10pt",onClick:()=>{d("profile_diff",{model:n.name,columns:[h]},{showForm:!1})},disabled:v,children:"Profile Diff"}),(0,i.jsx)(A.Dr,{value:"histogram-diff",fontSize:"10pt",onClick:()=>{d("histogram_diff",{model:n.name,column_name:h,column_type:g},{showForm:!1})},disabled:v||!g||!(0,Y.c)(g),children:"Histogram Diff"}),(0,i.jsx)(A.Dr,{value:"top-k-diff",fontSize:"10pt",onClick:()=>{d("top_k_diff",{model:n.name,column_name:h,k:50},{showForm:!1})},disabled:v,children:"Top-k Diff"})]})})})})]})]})})}function er(e,n,t){function l(e){return void 0!==e.baseIndex&&void 0!==e.currentIndex&&!0===e.reordered?"column-index-reordered schema-column schema-column-index":"schema-column schema-column-index"}function s(e){return void 0!==e.baseIndex&&void 0!==e.currentIndex&&e.baseType!==e.currentType?"column-body-type-changed schema-column":"schema-column"}return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:l},{key:"currentIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:l},{key:"name",name:"Name",resizable:!0,renderCell:e=>{var l;let{row:s,column:r}=e;return n?(0,i.jsx)(es,{model:n,row:s,cllRunning:null!=(l=null==t?void 0:t.get(s.name))&&l}):s.name},cellClass:function(){return"schema-column"}},{key:"baseType",name:"Base Type",resizable:!0,cellClass:s},{key:"currentType",name:"Current Type",resizable:!0,cellClass:s}],rows:Object.values(e)}}var eo=t(37285),ea=t(56536);let ec=(0,j.forwardRef)(function(e,n){let t,l,{base:s,current:r,enableScreenshot:o=!1}=e,a=ei(),[d,u]=(0,j.useState)(new Map),{columns:h,rows:x}=(0,j.useMemo)(()=>{var e;let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={};return Object.entries((0,U.l)(Object.keys(e),Object.keys(n))).forEach(e=>{let[n,i]=e;t[n]={name:n,reordered:"reordered"===i}}),Object.entries(e).map((e,n)=>{let[i,l]=e;t[i].baseIndex=n+1,t[i].baseType=l.type}),Object.entries(n).map((e,n)=>{let[i,l]=e;t[i].currentIndex=n+1,t[i].currentType=l.type}),t}(null==s?void 0:s.columns,null==r?void 0:r.columns),t=null!=(e=null==r?void 0:r.resource_type)?e:null==s?void 0:s.resource_type;return t&&["model","seed","snapshot","source"].includes(t)?er(n,null!=r?r:s,d):er(n)},[s,r,d]),{lineageGraph:p}=(0,H.cE)(),m=!(null==p?void 0:p.catalogMetadata.base),f=!(null==p?void 0:p.catalogMetadata.current);m&&f?t="catalog.json not found on both environments. Run `recce debug` to troubleshoot.":m?t="catalog.json not found on base environment. Run `recce debug` to troubleshoot.":f&&(t="catalog.json not found on current environment. Run `recce debug` to troubleshoot.");let g=s&&void 0===s.columns,v=r&&void 0===r.columns;g&&v?l="catalog.json is outdated on both environments. Update catalog.json to get schema information.":g?l="catalog.json is outdated on base environment. Update catalog.json to get schema information.":v&&(l="catalog.json is outdated on current environment. Update catalog.json to get schema information.");let y=async e=>{var n;(0,b.vD)({action:"view",source:"schema_column"}),u(n=>new Map(n).set(e,!0));let t=null!=(n=null==r?void 0:r.id)?n:null==s?void 0:s.id;t&&await (null==a?void 0:a.showColumnLevelLineage({node_id:t,column:e})),u(n=>new Map(n).set(e,!1))},w=null==a?void 0:a.viewOptions.column_level_lineage,k=w?new Set(["".concat(w.node_id,"-").concat(w.column)]):new Set;return(0,i.jsxs)(c.s,{direction:"column",children:[t?(0,i.jsxs)(eo.Bm,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(eo.mZ,{}),(0,i.jsx)(eo.TN,{children:t})]}):l?(0,i.jsxs)(eo.Bm,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(eo.mZ,{}),(0,i.jsx)(eo.TN,{children:l})]}):(0,i.jsx)(i.Fragment,{}),x.length>0&&(0,i.jsx)(ea.z,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"0.8rem",borderWidth:1},columns:h,rows:x,rowHeight:35,renderers:{noRowsFallback:(0,i.jsx)(ea.a,{})},className:"rdg-light no-track-pii-safe",ref:n,rowKeyGetter:e=>{var n;let t=null!=(n=null==r?void 0:r.id)?n:null==s?void 0:s.id;return"".concat(t,"-").concat(e.name)},selectedRows:k,onSelectedRowsChange:()=>{},onCellClick:async e=>{(void 0===e.row.baseIndex||void 0!==e.row.currentIndex)&&await y(e.row.name)},rowClass:e=>{let n;if(void 0===e.baseIndex)n="row-added";else{if(void 0===e.currentIndex)return"row-removed";n="row-normal"}return void 0!==a&&(n+=" row-selectable"),n}})]})}),ed=(0,j.forwardRef)(function(e,n){let t,l,{current:s}=e,r=ei(),[o,a]=(0,j.useState)(new Map),{columns:d,rows:u}=(0,j.useMemo)(()=>(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;return{columns:[{key:"index",name:"",resizable:!0,minWidth:35,width:35,cellClass:"schema-column schema-column-index"},{key:"name",name:"Name",resizable:!0,renderCell:e=>{var l;let{row:s,column:r}=e;return n?(0,i.jsx)(es,{model:n,row:s,cllRunning:null!=(l=null==t?void 0:t.get(s.name))&&l,singleEnv:!0}):s.name},cellClass:"schema-column"},{key:"type",name:"Type",resizable:!0,cellClass:"schema-column"}],rows:Object.entries(e).map((e,n)=>{let[t,i]=e;return{name:t,index:n+1,type:i.type}})}})(null==s?void 0:s.columns,s,o),[s,o]),{lineageGraph:h}=(0,H.cE)();(null==h?void 0:h.catalogMetadata.current)||(t="catalog.json not found. Run `recce debug` to troubleshoot."),s&&void 0===s.columns&&(l="catalog.json is outdated. Update catalog.json to get schema information.");let x=async e=>{(0,b.vD)({action:"view",source:"schema_column"}),a(n=>new Map(n).set(e,!0));let n=null==s?void 0:s.id;n&&await (null==r?void 0:r.showColumnLevelLineage({node_id:n,column:e})),a(n=>new Map(n).set(e,!1))},p=null==r?void 0:r.viewOptions.column_level_lineage,m=p?new Set(["".concat(p.node_id,"-").concat(p.column)]):new Set;return(0,i.jsxs)(c.s,{direction:"column",children:[t?(0,i.jsxs)(eo.Bm,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(eo.mZ,{}),(0,i.jsx)(eo.TN,{children:t})]}):l?(0,i.jsxs)(eo.Bm,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(eo.mZ,{}),(0,i.jsx)(eo.TN,{children:l})]}):(0,i.jsx)(i.Fragment,{}),u.length>0&&(0,i.jsx)(ea.z,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:d,rows:u,renderers:{noRowsFallback:(0,i.jsx)(ea.a,{})},className:"rdg-light",ref:n,rowKeyGetter:e=>{let n=null==s?void 0:s.id;return"".concat(n,"-").concat(e.name)},selectedRows:m,onSelectedRowsChange:()=>{},onCellClick:async e=>{await x(e.row.name)},rowClass:()=>void 0!==r?"row-normal row-selectable":"row-normal"})]})});async function eu(e){return(await v.g.post("/api/select",e)).data}var eh=t(63348);t(87545);let ex=e=>{let{style:n,children:t,gutterSize:l=5,...s}=e;return(0,i.jsx)(eh.A,{style:{display:"flex",flexDirection:"row",...n},direction:"horizontal",gutterSize:l,...s,children:t})},ep=e=>{let{style:n,children:t,gutterSize:l=5,...s}=e;return(0,i.jsx)(eh.A,{style:{display:"flex",flexDirection:"column",...n},gutterSize:l,direction:"vertical",...s,children:t})};var em=t(27163),ef=t(82744),ej=t(56906),eg=t(77498);let ev=Z.gAg,ey=Z.GKh,eb=Z.f6c;function ew(e){return"added"===e?{color:"green.solid",hexColor:String(eg.q.token("colors.green.solid")),backgroundColor:"green.subtle",hexBackgroundColor:String(eg.q.token("colors.green.subtle")),icon:ev}:"removed"===e?{color:"red.solid",hexColor:String(eg.q.token("colors.red.solid")),backgroundColor:"red.subtle",hexBackgroundColor:String(eg.q.token("colors.red.subtle")),icon:ey}:"modified"===e?{color:"orange.emphasized",hexColor:String(eg.q.token("colors.orange.emphasized")),backgroundColor:"orange.subtle",hexBackgroundColor:String(eg.q.token("colors.orange.subtle")),icon:eb}:{color:"gray.focusRing",hexColor:String(eg.q.token("colors.gray.focusRing")),backgroundColor:"white",hexBackgroundColor:String(eg.q.token("colors.white")),icon:void 0}}function ek(e){if("model"===e)return{color:"#c0eafd",icon:ef.$ZR};if("metric"===e)return{color:"#ffe6ee",icon:ej.mJh};if("source"===e)return{color:"#a6dda6",icon:ef.nBS};if("exposure"===e)return{color:"#ffe6ee",icon:ej.nM$};if("semantic_model"===e)return{color:"#fb8caf",icon:ej.Z4p};else if("seed"===e)return{color:"#a6dda6",icon:ef.b9F};else if("snapshot"===e)return{color:"#a6dda6",icon:ef.p5B};else return{color:"inherit",icon:void 0}}function eC(e,n){if(!e||!n)return;let t=Object.keys(e),i=Object.keys(n);if(t.length!==i.length)return!0;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!0;for(let t of i)if(!e[t]||e[t].type!==n[t].type)return!0;return!1}var e_=t(99634);let eS=e=>{let n,t,{node:s,selected:o,onSelect:a,schemaChanged:d}=e,{icon:u}=ek(s.resourceType),{base:h,current:x}=s.data;if(d){var p;n=null==(p=(0,e_.C)("schema_diff"))?void 0:p.icon,t=ew("modified").color}else!h&&x?(n=ew("added").icon,t=ew("added").color):h&&!x&&(n=ew("removed").icon,t=ew("removed").color);return(0,i.jsx)(em.ck,{children:(0,i.jsxs)(c.s,{width:"100%",fontSize:"10pt",p:"5px 8px",cursor:"pointer",_hover:{bg:"gray.200"},bg:o?"gray.100":"inherit",onClick:()=>{a(s.id)},alignItems:"center",gap:"5px",children:[(0,i.jsx)(r.I,{as:u}),(0,i.jsx)(l.a,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:s.name}),n&&t&&(0,i.jsx)(r.I,{as:n,color:t})]})})},ez=(0,j.forwardRef)(function(e,n){let{check:t}=e,{lineageGraph:l}=(0,H.cE)(),s=t.params,r=[...y.X.check(t.check_id),"select"],{isLoading:o,error:a,refetch:c,data:d}=(0,g.I)({queryKey:r,queryFn:async()=>eu({select:s.select,exclude:s.exclude,packages:s.packages,view_mode:s.view_mode}),refetchOnMount:!0,enabled:!s.node_id}),[u,h]=(0,j.useMemo)(()=>{var e,n,t;let i=[],r=[],o=[],a=[];if(s.node_id)for(let e of s.node_id instanceof Array?s.node_id:[s.node_id]){let n=null==l?void 0:l.nodes[e];n&&i.push(n)}else for(let n of null!=(e=null==d?void 0:d.nodes)?e:[]){let e=null==l?void 0:l.nodes[n];e&&i.push(e)}let c=i.filter(e=>"model"===e.resourceType||"seed"===e.resourceType||"source"===e.resourceType||"snapshot"===e.resourceType);for(let e of c)eC(null==(n=e.data.base)?void 0:n.columns,null==(t=e.data.current)?void 0:t.columns)?r.push(e.id):!e.data.base&&e.data.current?o.push(e.id):e.data.base&&!e.data.current&&a.push(e.id);function u(e){return r.includes(e.id)?3:o.includes(e.id)?2:+!!a.includes(e.id)}return c.sort((e,n)=>{let t=u(e),i=u(n);return t!==i?i-t:e.name.localeCompare(n.name)}),[c,r]},[s.node_id,null==d?void 0:d.nodes,l]),[x,p]=(0,j.useState)(0);if(o)return(0,i.jsx)(E.o,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(a)return(0,i.jsxs)(E.o,{bg:"rgb(249,249,249)",height:"100%",children:["Error: ",a.message]});if(0==u.length)return(0,i.jsx)(E.o,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"});if(x<u.length){let e=u[x];return(0,i.jsxs)(ex,{sizes:[80,20],minSize:30,style:{height:"100%"},children:[(0,i.jsx)(ec,{base:e.data.base,current:e.data.current,enableScreenshot:!0,ref:n}),(0,i.jsx)(em.$z,{overflow:"auto",backgroundColor:"white",as:"ul",listStyle:"none",children:u.map((e,n)=>(0,i.jsx)(eS,{node:e,schemaChanged:h.includes(e.id),selected:n===x,onSelect:()=>{p(n)}},n))})]})}return(0,i.jsx)(i.Fragment,{})});var eE=t(82633),eI=t(43458);function eD(e){let{value:n,onChange:t}=e,{featureToggles:l}=(0,ee.c)(),[r,o]=(0,j.useState)(!1),[a,d]=(0,j.useState)(),u=(0,j.useRef)(null),h=()=>{t&&(t(a),o(!1))};return((0,j.useEffect)(()=>{if(r&&u.current){let e=u.current;e.focus(),e.setSelectionRange(e.value.length,e.value.length)}},[r]),r)?(0,i.jsxs)(c.s,{direction:"column",align:"flex-end",height:"100%",className:"no-track-pii-safe",children:[(0,i.jsx)(eI.T,{value:a,onChange:e=>{d(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&o(!1),(e.metaKey||e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),h())},ref:u,flex:1}),(0,i.jsxs)(c.s,{gap:"12px",alignItems:"flex-end",children:[(0,i.jsx)(s.N,{onClick:()=>{setTimeout(()=>{o(!1)},100)},colorPalette:"blue",children:"cancel"}),(0,i.jsx)(M.$,{mt:"8px",size:"sm",colorPalette:"blue",onClick:h,children:"Update"})]})]}):(0,i.jsx)(x.E,{className:"no-track-pii-safe",height:"100%",overflow:"auto",fontSize:"11pt",onClick:l.disableUpdateChecklist?void 0:()=>{d(null!=n?n:""),o(!0)},whiteSpace:"pre-wrap",wordBreak:"break-word",color:n?"inherit":"lightgray",children:n||"Add description here"})}var eR=t(77182),eT=t(25035);function eF(){return{successToast:function(e){eT.X.create({description:e,type:"info",duration:5e3,closable:!0})},failToast:function(e,n){eT.X.create({title:e,description:"".concat(n),type:"error",duration:5e3,closable:!0})}}}function eN(){let e=(0,R._)(["\n    **SQL**\n    ```sql\n    ","\n    ```\n    "],["\n    **SQL**\n    \\`\\`\\`sql\n    ","\n    \\`\\`\\`\n    "]);return eN=function(){return e},e}function eA(e){return e.description?e.description:"_(no description)_"}var eq=t(58971),eL=t(44872),eM=t(31105),eO=t(5043),eP=t(24534),eX=t(37962),eK=t(71407),eQ=t(76436),e$=t.n(eQ),eW=t(37630);function eZ(e){let n=(0,eO.H)(e);return(0,eP.GP)(n,"yyyy-MM-dd'T'HH:mm:ss")}function eV(e){let n=(0,eO.H)(e);return(0,eX.B)(n,new Date,{addSuffix:!0})}function eB(e){let n=new Set,t=new Set;if(null==e?void 0:e.nodes)for(let s of Object.values(e.nodes)){var i,l;(null==(i=s.data.base)?void 0:i.schema)&&n.add(s.data.base.schema),(null==(l=s.data.current)?void 0:l.schema)&&t.add(s.data.current.schema)}return[n,t]}function eH(e){return Object.values(e).every(e=>null===e)?[(0,i.jsx)(c.s,{ml:"10px",children:"No information"},"no info")]:Object.entries(e).filter(e=>{let[n,t]=e;return"url"!==n&&null!=t}).map(e=>{let[n,t]=e;return(0,i.jsxs)(em.ck,{ml:"10px",children:[n,": ",t]},n)})}function eU(){var e,n,t,l;let{envInfo:o,reviewMode:a,lineageGraph:d}=(0,H.cE)(),{open:h,onOpen:x,onClose:p}=(0,T.j)(),m=null==o?void 0:o.git,f=null==o?void 0:o.pullRequest,j={...m,...f},g=null==o||null==(e=o.dbt)?void 0:e.base,v=null==o||null==(n=o.dbt)?void 0:n.current,y=(null==g?void 0:g.generated_at)?eZ(g.generated_at):"",b=(null==v?void 0:v.generated_at)?eZ(v.generated_at):"",w="",k="";g&&(w=g.generated_at?eV(g.generated_at):""),v&&(k=v.generated_at?eV(v.generated_at):"");let[C,_]=eB(d);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(el.m,{content:"Environment Info",positioning:{placement:"bottom-end"},children:(0,i.jsxs)("div",{className:"flex items-center hover:cursor-pointer hover:text-black",onClick:x,children:[(0,i.jsxs)("div",{className:"hidden text-sm lg:flex lg:flex-col",children:[(0,i.jsxs)("div",{className:"flex gap-1",children:[(0,i.jsx)("span",{className:"no-track-pii-safe max-w-32 truncate",children:Array.from(C).join(", ")})," ","(",w,")"]}),(0,i.jsxs)("div",{className:"flex gap-1",children:[(0,i.jsx)("span",{className:"no-track-pii-safe max-w-32 truncate",children:Array.from(_).join(", ")})," ","(",k,")"]})]}),(0,i.jsx)(q.K,{size:"sm",variant:"plain","aria-label":"Environment Info",children:(0,i.jsx)(r.I,{verticalAlign:"middle",as:eK.G_,boxSize:"16px"})})]})}),(0,i.jsx)(F.Dz,{open:h,onOpenChange:p,size:"lg",children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{children:[(0,i.jsx)(F.c7,{children:(0,i.jsx)(F.L3,{children:"Environment Information"})}),(0,i.jsx)(F.R4,{children:(0,i.jsxs)(c.s,{direction:"column",gap:"5px",children:[a?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(c.s,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(u.D,{size:"sm",children:"Review Information"}),(0,i.jsxs)(em.$z,{children:[j.url&&(0,i.jsxs)(em.ck,{ml:"10px",children:["url:"," ",(0,i.jsxs)(s.N,{href:j.url,color:"blue.500",target:"_blank",children:[j.url," ",(0,i.jsx)(eW.TdP,{})]})]}),!e$()(j)&&eH(j)]})]})}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(c.s,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(u.D,{size:"sm",children:"Dev Information"}),(0,i.jsx)(em.$z,{children:m&&eH(m)})]})}),(0,i.jsx)(D.w,{}),(null==o?void 0:o.adapterType)==="dbt"&&(0,i.jsxs)(c.s,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(u.D,{size:"sm",children:"DBT"}),(0,i.jsx)(eM.Rz,{borderWidth:"1px",height:"30rem",children:(0,i.jsxs)(eM.jq,{size:"sm",variant:"line",stickyHeader:!0,children:[(0,i.jsx)(eM.A0,{children:(0,i.jsxs)(eM.Hj,{children:[(0,i.jsx)(eM.ug,{}),(0,i.jsx)(eM.ug,{children:"base"}),(0,i.jsx)(eM.ug,{children:"current"})]})}),(0,i.jsxs)(eM.BF,{children:[(0,i.jsxs)(eM.Hj,{children:[(0,i.jsx)(eM.nA,{children:"schema"}),(0,i.jsx)(eM.nA,{className:"no-track-pii-safe",children:Array.from(C).map(e=>(0,i.jsx)(el.m,{content:e,positioning:{placement:"bottom"},children:(0,i.jsx)("div",{className:"max-w-72 truncate",children:e})},e))}),(0,i.jsx)(eM.nA,{className:"no-track-pii-safe",children:Array.from(_).map(e=>(0,i.jsx)(el.m,{content:e,positioning:{placement:"bottom"},children:(0,i.jsx)("div",{className:"max-w-72 truncate",children:e})},e))})]}),(0,i.jsxs)(eM.Hj,{children:[(0,i.jsx)(eM.nA,{children:"version"}),(0,i.jsx)(eM.nA,{children:null==g?void 0:g.dbt_version}),(0,i.jsx)(eM.nA,{children:null==v?void 0:v.dbt_version})]}),(0,i.jsxs)(eM.Hj,{children:[(0,i.jsx)(eM.nA,{children:"timestamp"}),(0,i.jsx)(eM.nA,{children:y}),(0,i.jsx)(eM.nA,{children:b})]})]})]})})]}),(null==o?void 0:o.adapterType)==="sqlmesh"&&(0,i.jsxs)(c.s,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(u.D,{size:"sm",children:"SQLMesh"}),(0,i.jsx)(eM.Rz,{borderWidth:"1px",height:"30rem",children:(0,i.jsxs)(eM.jq,{variant:"line",stickyHeader:!0,children:[(0,i.jsx)(eM.A0,{children:(0,i.jsxs)(eM.Hj,{children:[(0,i.jsx)(eM.ug,{}),(0,i.jsx)(eM.ug,{children:"base"}),(0,i.jsx)(eM.ug,{children:"current"})]})}),(0,i.jsx)(eM.BF,{children:(0,i.jsxs)(eM.Hj,{children:[(0,i.jsx)(eM.nA,{children:"Environment"}),(0,i.jsx)(eM.nA,{className:"no-track-pii-safe",children:null==(t=o.sqlmesh)?void 0:t.base_env}),(0,i.jsx)(eM.nA,{className:"no-track-pii-safe",children:null==(l=o.sqlmesh)?void 0:l.current_env})]})})]})})]})]})}),(0,i.jsx)(F.Es,{children:(0,i.jsx)(M.$,{colorPalette:"blue",mr:3,onClick:p,children:"Close"})}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]})})]})})]})}function eG(e){var n;let{value:t,onChange:l,onRun:s,onRunBase:r,onRunDiff:o,label:a,CustomEditor:d,options:u={},manifestData:h,schemas:m,...f}=e,{featureToggles:j}=(0,ee.c)(),g="";return h&&(g=h.generated_at?eV(h.generated_at):""),(0,i.jsxs)(i.Fragment,{children:[(null!=(n=null!=a?a:s)?n:r)&&(0,i.jsxs)(c.s,{backgroundColor:"#EDF2F880",height:"40px",minH:"40px",fontSize:"14px",align:"center",margin:"0",padding:"0px 16px",flex:"0 0 40px",children:[(0,i.jsx)(x.E,{as:"strong",children:a?a.toUpperCase():""}),h&&(0,i.jsxs)("span",{className:"ml-1",children:["(",m&&(0,i.jsxs)("span",{children:[m,", "]}),(0,i.jsx)("span",{children:g}),")"]}),(0,i.jsx)(p.h,{}),(null!=s?s:r)&&(0,i.jsxs)(M.$,{size:"xs",variant:"outline",onClick:null!=s?s:r,backgroundColor:"white",padding:"6px 12px",disabled:j.disableDatabaseQuery,children:[(0,i.jsx)(ej.gSK,{})," Run Query"]})]}),null!=d?d:(0,i.jsx)(eL.KE,{className:"no-track-pii-safe",language:"sql",theme:"vs",value:t,onChange:e=>{void 0!==e&&l&&l(e)},onMount:(e,n)=>{s&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.Enter,s),r&&e.addCommand(n.KeyMod.Alt|n.KeyCode.Enter,r),o&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.Enter,o)},options:{extraEditorClassName:"no-track-pii-safe",tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent",...u}})]})}function eJ(e){var n;let t,l,{value:s,baseValue:r,onChange:o,onChangeBase:a,onRun:d,onRunBase:u,onRunDiff:h,options:x={},labels:p,BaseEnvironmentSetupGuide:m,...f}=e,j=p?p[0]:"Base",g=p?p[1]:"Current",{envInfo:v,lineageGraph:y}=(0,H.cE)();(null==v||null==(n=v.dbt)?void 0:n.base)&&v.dbt.current&&(t=v.dbt.base,l=v.dbt.current);let[b,w]=eB(y);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(c.s,{height:"100%",gap:0,children:[(0,i.jsx)(eq.B,{height:"100%",width:"50%",gap:0,borderRight:"1px",borderColor:"#D4DBE4",children:(0,i.jsx)(eG,{label:j,value:null!=r?r:"",onChange:a,onRunBase:u,options:x,CustomEditor:m,manifestData:null!=t?t:void 0,schemas:Array.from(b).join(", "),...f})}),(0,i.jsx)(eq.B,{height:"100%",width:"50%",gap:0,children:(0,i.jsx)(eG,{label:g,value:s,onChange:o,onRun:d,options:x,manifestData:null!=l?l:void 0,schemas:Array.from(w).join(", "),...f})})]})})}var eY=t(52810),e0=t(6354),e1=t(34563);let e5=(0,j.forwardRef)((e,n)=>{var t,s,r,o,a;let{isRunning:d,isAborting:u,progress:h,error:x,run:p,onCancel:m,viewOptions:f,onViewOptionsChanged:j,RunResultView:g,children:v,onExecuteRun:y}=e,b=null!=(r=null==x||null==(s=x.response)||null==(t=s.data)?void 0:t.detail)?r:null==p?void 0:p.error;if(b)return(0,i.jsxs)(eo.Bm,{status:"error",title:"Error: ".concat(b),children:[(0,i.jsx)(eo.mZ,{}),(0,i.jsxs)(eo.XL,{children:["Error: ",b]})]});if(null!=d?d:(null==p?void 0:p.status)==="running"){let e="Loading...";return(null==h?void 0:h.message)?e=h.message:(null==p||null==(o=p.progress)?void 0:o.message)&&(e=p.progress.message),(0,i.jsx)(E.o,{p:"16px",height:"100%",bg:"rgb(249,249,249)",children:(0,i.jsxs)(I.T,{children:[(0,i.jsxs)(c.s,{alignItems:"center",children:[(null==h?void 0:h.percentage)==null?(0,i.jsx)(e0.QU,{value:null,size:"md",mr:"8px",children:(0,i.jsx)(e0.Au,{})}):(0,i.jsx)(e0.QU,{value:100*h.percentage,size:"md",mr:"8px",children:(0,i.jsx)(e0.Au,{})}),u?(0,i.jsx)(i.Fragment,{children:"Aborting..."}):(0,i.jsx)(i.Fragment,{children:e})]}),!u&&(0,i.jsx)(M.$,{onClick:m,colorPalette:"blue",size:"sm",children:"Cancel"})]})})}if(!p)return(0,i.jsx)(E.o,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(v&&g)throw Error("RunView requires either a children or a RunResultView prop, but not both.");if(!v&&!g)throw Error("RunView requires at least one of children or RunResultView prop.");return(0,i.jsxs)(l.a,{h:"100%",style:{contain:"size layout"},overflow:"auto",className:"no-track-pii-safe",children:[g&&(null!=(a=p.error)?a:p.result)&&(0,i.jsx)(e1.tH,{children:(0,i.jsx)(g,{ref:n,run:p,viewOptions:f,onViewOptionsChanged:j})}),null==v?void 0:v({run:p,viewOptions:f,onViewOptionsChanged:j})]})});var e2=t(51407),e4=t(94805),e3=t(91427),e8=t(15456),e7=t(68166),e6=t(13705),e9=t(16038);t(3496),t(34980);var ne=t(37725),nn=t(59088),nt=t(43900),ni=t(13900),nl=t(48358);function ns(e){let{node:n}=e,{icon:t}=ek(n.resourceType);return(0,i.jsx)(el.m,{showArrow:!0,content:"Type of resource",children:(0,i.jsxs)(N.f8,{children:[t&&(0,i.jsx)(N.FV,{children:(0,i.jsx)(t,{})}),(0,i.jsx)(N.d1,{children:n.resourceType})]})})}function nr(e){let{rowCount:n}=e,t=n.base,l=n.curr,s=null===n.base?"N/A":"".concat(n.base," rows"),o=null===n.curr?"N/A":"".concat(n.curr," rows");return null===t&&null===l?(0,i.jsx)(i.Fragment,{children:" Failed to load"}):null===t||null===l?(0,i.jsxs)(h.z,{children:[(0,i.jsx)(x.E,{children:s}),(0,i.jsx)(r.I,{as:nn.dyV}),(0,i.jsx)(x.E,{children:o})]}):t===l?(0,i.jsxs)(h.z,{children:[(0,i.jsx)(x.E,{children:o}),(0,i.jsx)(r.I,{as:nt.lso,color:"gray.500"}),(0,i.jsx)(x.E,{color:"gray.500",children:"No Change"})]}):t<l?(0,i.jsxs)(h.z,{children:[(0,i.jsx)(x.E,{children:o}),(0,i.jsx)(r.I,{as:nt.euc,color:"green.500"}),(0,i.jsx)(x.E,{color:"green.500",children:(0,ni.Q)(t,l)})]}):(0,i.jsxs)(h.z,{children:[(0,i.jsx)(x.E,{children:o}),(0,i.jsx)(r.I,{as:nt.p1_,color:"red.500"}),(0,i.jsx)(x.E,{color:"red.500",children:(0,ni.Q)(t,l)})]})}function no(e){var n,t;let{rowCount:l,node:s,onRefresh:r,isFetching:o}=e,{featureToggles:a}=(0,ee.c)(),{runsAggregated:d}=(0,H.cE)(),u=null==d||null==(n=d[s.id])?void 0:n.row_count_diff.result,h=null==(t=(0,e_.C)("row_count_diff"))?void 0:t.icon,[p,m]=(0,j.useState)(),[f,g]=(0,j.useState)("");return(0,j.useEffect)(()=>{let e=null!=l?l:u;if(e){var n,t;let i=null!=(n=e.base)?n:"N/A",l=null!=(t=e.curr)?t:"N/A";g("".concat(i," -> ").concat(l," rows")),m(e)}},[l,u]),(0,i.jsx)(el.m,{content:f,children:(0,i.jsx)(N.f8,{asChild:!0,children:(0,i.jsx)(x.E,{fontSize:"xs",children:(0,i.jsxs)(c.s,{direction:"row",alignItems:"center",gap:"1",children:[h&&(0,i.jsx)(h,{}),null!=p||o?(0,i.jsx)(ne.rr,{loading:!1,noOfLines:1,minWidth:"30px",children:null!=p?(0,i.jsx)(nr,{rowCount:p}):"row count"}):(0,i.jsx)("span",{children:"row count"}),r&&(0,i.jsx)(q.K,{loading:o,"aria-label":"Query Row Count",size:"2xs",p:"0",variant:"ghost",onClick:r,disabled:a.disableDatabaseQuery,children:(0,i.jsx)(nl.fZv,{})})]})})})})}function na(e){var n,t,l;let s,{rowCount:r,node:o,onRefresh:a,isFetching:c}=e,{runsAggregated:d,refetchRunsAggregated:u}=(0,H.cE)(),h=null==d||null==(n=d[o.id])?void 0:n.row_count.result,x=null==(t=(0,e_.C)("row_count"))?void 0:t.icon,p=null!=r?r:h;if(p){let e=null!=(l=p.curr)?l:"N/A";s="".concat(e," rows")}return(0,i.jsxs)(N.f8,{children:[x&&(0,i.jsx)(N.FV,{children:(0,i.jsx)(x,{})}),(0,i.jsx)(N.d1,{children:p||c?(0,i.jsx)(ne.rr,{loading:c,lineClamp:1,height:2,minWidth:"30px",children:p?"".concat(s):"row count"}):(0,i.jsx)(i.Fragment,{children:"row count"})}),a&&(0,i.jsx)(q.K,{loading:c,"aria-label":"Query Row Count",size:"2xs",p:"0",variant:"ghost",onClick:a,disabled:"base"===o.from,children:(0,i.jsx)(nl.fZv,{})})]})}let nc=e=>{let{node:n,action:t}=e,{status:s,skipReason:r,run:o}=t;if("pending"===s)return(0,i.jsx)(e0.QU,{value:0,size:"xs",children:(0,i.jsxs)(e0.Au,{children:[(0,i.jsx)(e0.JU,{}),(0,i.jsx)(e0.nM,{})]})});if("skipped"===s)return(0,i.jsx)(N.f8,{backgroundColor:"gray.100",children:(0,i.jsx)(N.d1,{children:(0,i.jsxs)(c.s,{fontSize:"10pt",color:"gray.500",alignItems:"center",gap:"3px",children:[(0,i.jsx)(l.a,{children:"Skipped"}),r&&(0,i.jsx)(el.m,{content:r,children:(0,i.jsx)(nl.GLE,{})})]})})});if(!o)return(0,i.jsx)(e0.QU,{value:null,size:"xs",children:(0,i.jsxs)(e0.Au,{children:[(0,i.jsx)(e0.JU,{}),(0,i.jsx)(e0.nM,{})]})});let{error:a,result:d,run_id:u,progress:h}=o;if("running"===s)if((null==h?void 0:h.percentage)===void 0)return(0,i.jsx)(e0.QU,{value:null,size:"xs",children:(0,i.jsxs)(e0.Au,{children:[(0,i.jsx)(e0.JU,{}),(0,i.jsx)(e0.nM,{})]})});else return(0,i.jsx)(e0.QU,{value:100*h.percentage,size:"xs",children:(0,i.jsxs)(e0.Au,{children:[(0,i.jsx)(e0.JU,{}),(0,i.jsx)(e0.nM,{})]})});if(a)return(0,i.jsxs)(c.s,{fontSize:"10pt",color:"gray",children:[(0,i.jsx)(l.a,{children:"Error"}),r&&(0,i.jsx)(el.m,{content:a,children:(0,i.jsx)(nl.e5t,{})})]});if("value_diff"===o.type){let e=0;for(let n of d.data.data)n[2]<1&&e++;return(0,i.jsx)(N.f8,{backgroundColor:e>0?"red.100":"green.100",children:(0,i.jsx)(N.d1,{children:(0,i.jsx)(c.s,{fontSize:"10pt",color:e>0?"red":"green",alignItems:"center",gap:"3px",children:e>0?"".concat(e," columns mismatched"):"All columns match"})})})}if("row_count_diff"===o.type){let e=o.result;return(0,i.jsx)(no,{rowCount:e[n.name],node:n})}if("row_count"===o.type){let e=o.result;return(0,i.jsx)(na,{rowCount:e[n.name],node:n})}return(0,i.jsx)(i.Fragment,{children:u})};function nd(e){var n;let t,l,{rowCount:s}=e,o=s.base,a=s.curr,d=null===s.base?"N/A":"".concat(s.base," Rows"),u=null===s.curr?"N/A":"".concat(s.curr," Rows");return null===o&&null===a?(t="Failed to load",l="gray"):null===o||null===a?(t="".concat(d," -> ").concat(u),l=null===o?"green":"red"):o===a?(t="=",l="gray"):o!==a&&(t="".concat((0,ni.Q)(o,a)," Rows"),l=o<a?"green":"red"),(0,i.jsx)(N.f8,{colorPalette:l,children:(0,i.jsxs)(c.s,{gap:1,alignItems:"center",children:[(0,i.jsx)(r.I,{as:null==(n=(0,e_.C)("row_count_diff"))?void 0:n.icon}),(0,i.jsx)(N.d1,{children:t})]})})}let nu={breaking:"Breaking",non_breaking:"Non Breaking",partial_breaking:"Partial Breaking",unknown:"Unknown"},nh=e=>{var n;let t,s,{id:o,inverted:a}=e,{lineageGraph:d,runsAggregated:u}=(0,H.cE)(),h=null==u?void 0:u[o],x=null==d?void 0:d.nodes[o];if(!h&&!x)return(0,i.jsx)(i.Fragment,{});if((null==x?void 0:x.data.base)&&x.data.current&&(t=eC(x.data.base.columns,x.data.current.columns)),null==h?void 0:h.row_count_diff){let e=h.row_count_diff;s=e.result.curr!==e.result.base}let m=a?"white":ew("modified").color;return(0,i.jsxs)(c.s,{flex:"1",children:[void 0!==t&&(0,i.jsx)(el.m,{content:"Schema (".concat(t?"changed":"no change",")"),openDelay:500,children:(0,i.jsx)(l.a,{height:"16px",children:(0,i.jsx)(r.I,{as:null==(n=(0,e_.C)("schema_diff"))?void 0:n.icon,color:t?m:a?"gray":"gray.100"})})}),(0,i.jsx)(p.h,{}),(null==h?void 0:h.row_count_diff)&&void 0!==s&&(0,i.jsx)(el.m,{content:"Row count (".concat(s?"changed":"=",")"),openDelay:500,children:(0,i.jsx)(l.a,{children:(0,i.jsx)(nd,{rowCount:h.row_count_diff.result})})})]})},nx=e=>{let{checked:n,onClick:t}=e;return(0,i.jsx)(c.s,{onClick:t,alignSelf:"center",alignItems:"center",cursor:"pointer",children:n?(0,i.jsx)(r.I,{boxSize:"20px",as:ef.Hcz}):(0,i.jsx)(r.I,{boxSize:"20px",as:ef.PVM})})},np=e=>{let{name:n,color:t,resourceType:s}=e;return(0,i.jsx)(l.a,{flex:"1",color:t,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:(0,i.jsx)(el.m,{content:"model"===s?n:"".concat(n," (").concat(s,")"),positioning:{placement:"top"},children:(0,i.jsx)("span",{children:n})})})};var nm=t(85123),nf=t(93569),nj=t(50323);async function ng(e){return(await v.g.post("/api/checks",{type:"schema_diff",params:e})).data}let nv={add_or_remove:"Unavailable for added or removed resources."};var ny=t(48288);let nb=e=>{var n;let[t,i]=(0,j.useState)(!1),[l,s]=(0,j.useState)(!1),[,r]=(0,H.JL)(),{error:o,data:a}=(0,g.I)({queryKey:y.X.run(null!=e?e:""),queryFn:async()=>(0,eY.Zc)(null!=e?e:"",2*!!t),enabled:!!e,refetchInterval:!!t&&50,retry:!1});(0,j.useEffect)(()=>{(o||(null==a?void 0:a.result)||(null==a?void 0:a.error))&&(t&&i(!1),((null==a?void 0:a.type)==="row_count_diff"||(null==a?void 0:a.type)==="row_count")&&r()),(null==a?void 0:a.status)==="running"&&i(!0)},[a,o,t,r]);let c=(0,j.useCallback)(async()=>{s(!0),e&&await (0,eY.Su)(e)},[e,s]),d=(null==a?void 0:a.type)?null==(n=(0,e_.C)(a.type))?void 0:n.RunResultView:void 0;return{run:a,isRunning:t,aborting:l,error:o,onCancel:c,RunResultView:d}};var nw=t(91592),nk=t(35752),nC=t.n(nk),n_=t(35147),nS=t(60745),nz=t.n(nS);let nE="ignore-screenshot";function nI(e){let{renderLibrary:n="html2canvas",imageType:t="png",backgroundColor:l=null,boardEffect:s=!0,shadowEffect:r=!1,borderStyle:o="solid 1px #ccc",borderRadius:a="10px",onSuccess:u,onError:h,ignoreElements:p}=e,[m,f]=(0,j.useState)("idle"),g=(0,j.useRef)(null),{onOpen:v,setImgBlob:y,ImageDownloadModal:b}=function(){let{open:e,onOpen:n,onClose:t}=(0,T.j)(),[l,s]=(0,j.useState)();return{onOpen:n,setImgBlob:s,ImageDownloadModal:function(){let[n,s]=(0,j.useState)();return(0,j.useEffect)(()=>{if(!l)return;let e=new FileReader;e.readAsDataURL(l),e.onloadend=e=>{var n;(null==(n=e.target)?void 0:n.result)!=null&&s(e.target.result)}},[s]),(0,i.jsx)(F.Dz,{size:"xl",open:e,onOpenChange:t,children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{children:[(0,i.jsx)(F.c7,{children:(0,i.jsx)(F.L3,{children:"Screenshot Preview"})}),(0,i.jsxs)(F.R4,{children:[(0,i.jsxs)(c.s,{px:"10px",gap:"10px",direction:"column",children:[(0,i.jsxs)(c.s,{alignItems:"center",gap:"5px",children:[(0,i.jsx)(nl.GLE,{color:"red.600"}),(0,i.jsx)(x.E,{fontWeight:"500",display:"inline",children:"Copy to the Clipboard"})," ","is not supported in the current browser"]}),(0,i.jsx)(x.E,{children:"Please download it directly"})]}),(0,i.jsx)(d._,{src:n,alt:"screenshot"})]}),(0,i.jsxs)(F.Es,{children:[(0,i.jsx)(M.$,{mr:3,onClick:t,children:"Close"}),(0,i.jsx)(M.$,{colorPalette:"blue",onClick:()=>{if(!l)return;let e=new Date,n="recce-screenshot-".concat((0,eP.GP)(e,"yyyy-MM-dd-HH-mm-ss"),".png");nz()(l,n),t()},children:"Download"})]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]})})]})})}}}(),w=async()=>{var e,t;if(!g.current)throw console.error("No node to use for screenshot"),Error("No node to use for screenshot");let i=null!=(e=g.current.element)?e:g.current,c=i.style.overflow,d=i.style.border,u=i.style.borderRadius,h=i.style.backgroundColor,x=i.style.height;try{i.style.overflow="hidden",i.style.border=s?o:"",i.style.borderRadius=s?a:"",i.style.backgroundColor=null!=l?l:"",i.style.height="".concat(String(i.offsetHeight),"px");let e=document.createElement("style");document.head.appendChild(e),null==(t=e.sheet)||t.insertRule("body > div:last-child img { display: inline-block; }"),f("loading");let c="html2canvas"===n?await nC()(i,{logging:!1,backgroundColor:null,ignoreElements:p}):await (0,n_.mo)(i,{filter:p?e=>!p(e):void 0});e.remove();let d=r?document.createElement("canvas"):c;if(r){d.width=c.width+80,d.height=c.height+80;let e=d.getContext("2d");if(e)e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=20,e.shadowOffsetX=10,e.shadowOffsetY=10,e.drawImage(c,40,40);else throw console.error("Error getting canvas context"),Error("Error getting canvas context to add shadow effect")}let u=await fetch(d.toDataURL());return await u.blob()}catch(e){throw console.error("Error converting to image",e),e}finally{i.style.overflow=c,i.style.border=d,i.style.borderRadius=u,i.style.backgroundColor=h,i.style.height=x}};return{status:m,isLoading:"loading"===m,isErrored:"error"===m,isSuccess:"success"===m,copyToClipboard:async()=>{try{await navigator.clipboard.write([new ClipboardItem({["image/".concat(t)]:w()})]),f("success"),u&&u()}catch(e){"ClipboardItem is not defined"===e.message?(y(await w()),v(),f("success")):(f("error"),console.error("Error copying to clipboard",e),h&&h(e))}},ImageDownloadModal:b,ref:g}}function nD(e){var n;let{successToast:t,failToast:l}=eF(),{isLoading:s,copyToClipboard:r,ImageDownloadModal:o,ref:a}=nI({imageType:"png",shadowEffect:!0,backgroundColor:null!=(n=null==e?void 0:e.backgroundColor)?n:null,onSuccess:()=>{t("Copied the query result as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),l("Failed to copy image to clipboard",e)}}),c=(0,j.useCallback)(()=>{if(a.current){var e;let n=null!=(e=a.current.element)?e:a.current;n.style.boxShadow="rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px",n.style.transition="box-shadow 0.5s ease-in-out"}},[a]),d=(0,j.useCallback)(()=>{if(a.current){var e;(null!=(e=a.current.element)?e:a.current).style.boxShadow=""}},[a]),u=(0,j.useCallback)(async()=>{if(a.current){var e;await r(),(null!=(e=a.current.element)?e:a.current).style.boxShadow=""}else l("Failed to copy image to clipboard","No content to copy")},[a,r,l]);return{ref:a,CopyToClipboardButton:function(e){let{imageType:n="png",...t}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(M.$,{size:"sm",style:{position:"absolute",bottom:"16px",right:"16px"},loading:s,onMouseEnter:c,onMouseLeave:d,onClick:u,children:[(0,i.jsx)(nl.hX7,{})," Copy to Clipboard"]}),(0,i.jsx)(o,{})]})},onMouseEnter:c,onMouseLeave:d,onCopyToClipboard:u}}function nR(e){let n=new Date,t=new Date;return(t.setDate(n.getDate()-1),null==e)?null:n.toDateString()===e.toDateString()?"Today, "+(0,eP.GP)(e,"HH:mm"):t.toDateString()===e.toDateString()?"Yesterday, "+(0,eP.GP)(e,"HH:mm"):(0,eP.GP)(e,"MMM d, HH:mm")}let nT=e=>{let{run:n}=e,t="running"===n.status,l=n.status;!l&&(n.result?l="finished":n.error&&(l="failed"));let s="",r="";"successful"===l||"finished"===l?(s="green",r="Finished"):"failed"===l?(s="red",r="Failed"):"cancelled"===l?(s="gray",r="Cancelled"):"running"===l?(s="blue",r="Running"):(s="green",r="Finished");let o=n.run_at?nR(new Date(n.run_at)):null;return(0,i.jsxs)(c.s,{justifyContent:"start",fontSize:"11pt",color:"gray.500",gap:"3px",alignItems:"center",overflow:"hidden",children:[t&&(0,i.jsx)(J.y,{size:"xs",color:"".concat(s,".400")}),(0,i.jsx)(x.E,{fontWeight:500,color:"".concat(s,".400"),children:r}),(0,i.jsx)(x.E,{children:"•"}),(0,i.jsx)(x.E,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:o})]})},nF=e=>{var n;return(0,i.jsxs)(c.s,{flex:"1",minH:"48px",m:"4px",px:"16px",py:"12px",bg:"blue.50",border:"1px",borderRadius:"4px",borderColor:"blue.400",align:null!=(n=e.align)?n:"center",gap:"12px",children:[(0,i.jsx)(r.I,{as:nn.S8s,width:"20px",height:"20px",color:"blue.900"}),e.children,(0,i.jsx)(p.h,{}),(0,i.jsx)(P.J,{onClick:e.onClose})]})},nN=()=>(0,i.jsxs)(s.N,{href:"https://docs.datarecce.io/get-started/#prepare-dbt-artifacts",target:"_blank",color:"rgba(49, 130, 206, 1)",fontWeight:"bold",textDecoration:"underline",children:["Learn how ",(0,i.jsx)(eW.TdP,{})]});var nA=t(81721),nq=t(12877),nL=t(94807);let nM={src:"/_next/static/media/reload-image.79aabb7d.svg"};async function nO(){return(await v.g.post("/api/connect")).data}function nP(e){var n;let{handleParentClose:t,parentOpen:l=!1,ignoreCookie:s=!1}=e,{authed:r}=(0,ee.c)(),[o,a]=(0,j.useState)(l||!r),c=null!=(n=nL.A.get("authState"))?n:"pending",[u,h]=(0,j.useState)(s?"pending":c);return"ignored"===u&&!s||r?null:(0,i.jsx)(F.Dz,{size:"lg",placement:"center",lazyMount:!0,open:o,onOpenChange:e=>{a(e.open),t&&t(e.open)},children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{borderRadius:"2xl",children:["authenticating"!==u&&(0,i.jsx)(F.c7,{className:"text-center",fontSize:"2xl",children:(0,i.jsx)(F.L3,{children:"Use Recce Cloud for Free"})}),"authenticating"!==u?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F.R4,{className:"space-y-2 font-light",children:(0,i.jsxs)("ul",{className:"list-inside list-disc",children:[(0,i.jsx)("li",{children:"Share your work with teammates, no setup needed"}),(0,i.jsx)("li",{children:"Reviewers can access it with a link."}),(0,i.jsx)("li",{children:"It’s recommended, but optional."})]})}),(0,i.jsx)(F.Es,{children:(0,i.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,i.jsxs)(M.$,{className:"w-full !rounded-lg !font-medium",colorPalette:"brand",onClick:async()=>{h("authenticating");let{connection_url:e}=await nO();window.open(e,"_blank")},children:["Use Recce Cloud ",(0,i.jsx)(eW.TdP,{})]}),(0,i.jsx)(F.Tt,{asChild:!0,children:(0,i.jsx)(M.$,{className:"!rounded-lg !font-medium",variant:"subtle",colorPalette:"gray",size:"sm",children:"Skip"})}),(0,i.jsx)(F.Tt,{asChild:!0,children:(0,i.jsx)(M.$,{width:"100%",className:"!rounded-lg !font-medium !text-black",variant:"ghost",size:"sm",onClick:()=>{nL.A.set("authState","ignored",{expires:30}),h("ignored")},children:"Snooze for 30 days"})})]})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F.R4,{className:"space-y-2 self-center font-light",children:(0,i.jsxs)(I.T,{gap:4,paddingTop:"1rem",children:[(0,i.jsx)(d._,{className:"mx-auto mb-2",h:"6rem",fit:"contain",src:nM.src}),(0,i.jsx)(x.E,{fontSize:"2xl",fontWeight:"medium",children:"Reload to Finish"}),(0,i.jsx)(x.E,{children:"Reload to complete connection to Recce Cloud"})]})}),(0,i.jsx)(F.Es,{children:(0,i.jsx)(M.$,{className:"w-full",colorPalette:"brand",onClick:()=>{window.location.reload()},children:"Reload"})})]})]})})]})})}let nX=e=>{let n=nw.Ay.stringify(e,null,2);return(0,i.jsx)(eL.KE,{className:"no-track-pii-safe",height:"100%",language:"yaml",theme:"vs",value:n,options:{extraEditorClassName:"no-track-pii-safe",readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})},nK=e=>{let{runType:n}=e,{open:t,onClose:l}=(0,T.j)({defaultOpen:!0});if(!t)return(0,i.jsx)(i.Fragment,{});switch(n){case"row_count":return(0,i.jsx)(nF,{onClose:l,children:(0,i.jsxs)(x.E,{children:["Enable row count diffing, and other Recce features, by configuring a base dbt environment to compare against. ",(0,i.jsx)(nN,{})]})});case"profile":return(0,i.jsx)(nF,{onClose:l,children:(0,i.jsxs)(x.E,{children:["Enable data-profile diffing, and other Recce features, by configuring a base dbt environment to compare against. ",(0,i.jsx)(nN,{})]})});default:return(0,i.jsx)(i.Fragment,{})}},nQ=e=>{let{disableCopyToClipboard:n,onCopyToClipboard:t,onMouseEnter:l,onMouseLeave:s}=e,{authed:r}=(0,ee.c)(),{handleShareClick:o}=(0,nq.l)(),[a,c]=(0,j.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(A.il,{children:[(0,i.jsx)(A.cQ,{asChild:!0,children:(0,i.jsxs)(M.$,{size:"xs",variant:"outline",colorPalette:"gray",children:["Share ",(0,i.jsx)(nl.RQe,{})]})}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsxs)(A.rm,{minW:"0",children:[(0,i.jsxs)(A.Dr,{value:"copy-to-clipboard",onClick:t,onMouseEnter:l,onMouseLeave:s,disabled:n,children:[(0,i.jsx)(nl.hX7,{})," Copy to Clipboard"]}),(0,i.jsx)(A.bX,{}),r?(0,i.jsxs)(A.Dr,{value:"share-to-cloud",onClick:async()=>{await o(),(0,b.o$)({name:"create"})},children:[(0,i.jsx)(nA.Fsk,{})," Share to Cloud"]}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(A.Dr,{value:"share",onClick:()=>{c(!0)},children:[(0,i.jsx)(nA.Fsk,{})," Share"]})})]})})})]}),a&&(0,i.jsx)(nP,{parentOpen:a,handleParentClose:c,ignoreCookie:!0})]})},n$=e=>{var n,t,l,s;let{runId:r,onClose:o,isSingleEnvironment:a}=e,{featureToggles:d}=(0,ee.c)(),{runAction:u}=(0,G.tr)(),{error:x,run:f,onCancel:g,isRunning:v}=nb(r),[k,C]=(0,j.useState)(),_=(0,V.jE)(),[,S]=(0,eE.zy)(),[z,E]=(0,j.useState)("result"),I=(null==f?void 0:f.type)?null==(n=(0,e_.C)(f.type))?void 0:n.RunResultView:void 0,D=(0,j.useCallback)(()=>{var e;u(null!=(e=null==f?void 0:f.type)?e:"",null==f?void 0:f.params)},[f,u]),R=null==f?void 0:f.check_id,T=(0,j.useCallback)(()=>{R&&S("/checks/".concat(R))},[R,S]),F=(0,j.useCallback)(async()=>{if(!r)return;let e=await w(r,k);await _.invalidateQueries({queryKey:y.X.checks()}),S("/checks/".concat(e.check_id))},[r,S,_,k]),N=(null==f?void 0:f.type)==="query"||(null==f?void 0:f.type)==="query_diff"||(null==f?void 0:f.type)==="query_base",{ref:A,onCopyToClipboard:q,onMouseEnter:L,onMouseLeave:O}=nD(),X=!r||!(null==f?void 0:f.result)||!!x||"result"!==z;return(0,i.jsxs)(c.s,{direction:"column",children:[a&&(0,i.jsx)(nK,{runType:null==f?void 0:f.type}),(0,i.jsx)(m.pK,{size:"lg",colorPalette:"cyan",value:z,onValueChange:e=>{E(e.value)},flexDirection:"column",mb:"1px",children:(0,i.jsxs)(m.j7,{children:[(0,i.jsx)(m.Xi,{value:"result",children:"Result"}),(0,i.jsx)(m.Xi,{value:"params",children:"Params"}),N&&(0,i.jsx)(m.Xi,{value:"query",children:"Query"}),(0,i.jsx)(p.h,{}),(0,i.jsxs)(h.z,{overflow:"hidden",children:[f&&(0,i.jsx)(nT,{run:f}),(0,i.jsxs)(M.$,{variant:"outline",colorPalette:"gray",disabled:!r||v||d.disableDatabaseQuery,size:"xs",onClick:D,children:[(0,i.jsx)(nl.fZv,{})," Rerun"]}),d.disableShare?(0,i.jsxs)(M.$,{variant:"outline",disabled:!r||!(null==f?void 0:f.result)||!!x||"result"!==z,onMouseEnter:L,onMouseLeave:O,size:"sm",onClick:q,children:[(0,i.jsx)(nl.hX7,{})," Copy to Clipboard"]}):(0,i.jsx)(nQ,{disableCopyToClipboard:X,onCopyToClipboard:async()=>{var e;await q(),(0,b.uH)({type:null!=(e=null==f?void 0:f.type)?e:"unknown",from:"run"})},onMouseEnter:L,onMouseLeave:O}),(0,i.jsx)(function(){return d.disableUpdateChecklist?(0,i.jsx)(i.Fragment,{}):(null==f?void 0:f.check_id)?(0,i.jsxs)(M.$,{disabled:!r||!f.result||!!x,size:"sm",colorPalette:"cyan",onClick:T,children:[(0,i.jsx)(nl.wiW,{})," Go to Check"]}):(0,i.jsxs)(M.$,{disabled:!r||!(null==f?void 0:f.result)||!!x,size:"xs",colorPalette:"cyan",onClick:F,children:[(0,i.jsx)(nl.wiW,{})," Add to Checklist"]})},{}),(0,i.jsx)(P.J,{size:"sm",onClick:()=>{o&&o()}})]})]})}),"result"===z&&(0,i.jsx)(e5,{ref:A,error:x,run:f,onCancel:g,viewOptions:k,onViewOptionsChanged:C,RunResultView:I}),"params"===z&&f&&(0,i.jsx)(nX,{type:f.type,params:f.params}),"query"===z&&f&&((null==(t=f.params)?void 0:t.base_sql_template)?(0,i.jsx)(eJ,{value:f.params.sql_template,baseValue:f.params.base_sql_template,options:{readOnly:!0}}):(0,i.jsx)(eG,{value:null!=(s=null==(l=f.params)?void 0:l.sql_template)?s:"",options:{readOnly:!0}}))]})},nW=e=>{let{onClose:n,isSingleEnvironment:t}=e,{runId:l}=(0,G.tr)();return(0,i.jsx)(n$,{runId:l,onClose:n,isSingleEnvironment:t})};async function nZ(e,n){return await (0,eY.AU)("query",e,n)}async function nV(e,n){return await (0,eY.AU)("query_base",e,n)}async function nB(e,n){return await (0,eY.AU)("query_diff",e,n)}var nH=t(75918),nU=t(90499);let nG=e=>{var n;let{defaultValues:t,suggestionList:s,onValuesChange:r,className:o}=e,[a,c]=(0,j.useState)(null!=t?t:[]),[d,u]=(0,j.useState)(""),[h,x]=(0,j.useState)(!1),p=(0,j.useRef)(null),m=e=>{a.includes(e)||(u(""),c([...a,e]),r([...a,e]))},f=null!=(n=null==s?void 0:s.filter(e=>""===d||e.includes(d)).filter(e=>!a.includes(e)))?n:[],g=a.length>0?(0,i.jsx)(M.$,{size:"2xs",variant:"ghost",color:"#3182CE",fontSize:e.size,paddingTop:"0",me:-2,onClick:()=>{u(""),c([]),r([])},children:"Clear"}):void 0;return(0,i.jsx)(nH.M,{width:e.width,className:o,endElement:g,children:(0,i.jsxs)(A.il,{size:"sm",lazyMount:!0,closeOnSelect:!1,onOpenChange:()=>{var e;return null==(e=p.current)?void 0:e.focus()},children:[(0,i.jsx)(A.cQ,{asChild:!0,children:(0,i.jsx)(M.$,{width:"100%",size:"2xs",colorPalette:"gray",variant:"outline",justifyContent:"flex-start",children:(n=>n.length>1?"".concat(n.length," ").concat(e.unitName,"s selected"):1===n.length?n[0]:"")(a)})}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsxs)(A.rm,{zIndex:"popover",fontSize:e.size,width:e.width,className:"no-track-pii-safe",children:[(0,i.jsx)(A.Uh,{children:(0,i.jsxs)(nU.B,{border:"1px solid #e2e8f0",borderRadius:"4px",width:"calc(100% - 8px)",marginX:"4px",padding:"4px",children:[a.map((n,t)=>(0,i.jsx)(nU.Q,{children:(0,i.jsxs)(N.f8,{paddingX:"0.5rem",size:"sm"===e.size||"md"===e.size||"lg"===e.size?e.size:"md",children:[(0,i.jsx)(N.d1,{children:n}),(0,i.jsx)(N.Cs,{children:(0,i.jsx)(N.TG,{onClick:()=>{c(a.filter(e=>e!==n)),r(a.filter(e=>e!==n))}})})]},n)},"tag-".concat(t))),(0,i.jsx)(nU.Q,{width:"100%",children:(0,i.jsx)($.p,{ref:p,placeholder:"Filter or add custom keys",variant:"subtle",size:e.size,value:d,onChange:e=>{u(e.target.value),x(!0)},onKeyDown:e=>{let n=e.currentTarget.value.trim().replace(",","");switch(e.key){case",":case"Enter":m(n),u("");break;case"Backspace":""===e.currentTarget.value&&a.length>0&&(c(a.slice(0,-1)),r(a.slice(0,-1)))}},onBlur:()=>{p.current&&h&&p.current.focus()}})})]})}),(0,i.jsx)(A.bX,{}),(0,i.jsxs)(A.Uh,{children:[""!==d&&!(null==s?void 0:s.includes(d))&&(0,i.jsxs)(A.Dr,{value:"custom-value-by-filter",onClick:()=>{m(d),x(!1)},children:["Add '",d,"' to the list"]},"custom-value-by-filter"),f.map((e,n)=>(0,i.jsx)(A.Dr,{value:"option-".concat(n),onClick:()=>{m(e)},children:e},"option-".concat(n))).slice(0,10),f.length>10&&(0,i.jsx)(el.m,{content:"Please use filter to find more items",positioning:{placement:"top"},children:(0,i.jsxs)(l.a,{px:"12px",color:"gray",fontSize:"8pt",children:["and ",f.length-10," more items..."]})})]})]})})})]})})};var nJ=t(97188);let nY=e=>{let{defaultPrimaryKeys:n,onPrimaryKeysChange:t,...l}=e,{lineageGraph:s,isActionAvailable:r}=(0,H.cE)(),o=(0,j.useMemo)(()=>{if(!s)return[];let e=new Set;for(let i in s.nodes){var n,t;let l=s.nodes[i],r=null==(n=l.data.base)?void 0:n.columns,o=null==(t=l.data.current)?void 0:t.columns;for(let n in r)e.add(n);for(let n in o)e.add(n)}return Array.from(e).sort()},[s]);return(0,i.jsx)(c.s,{...l,children:(0,i.jsxs)(nJ.XO,{m:"0 0.5rem",gap:0,children:[(0,i.jsxs)(nJ.dh,{fontSize:"0.625rem",margin:0,children:["Diff with Primary Key(s) (suggested)"," ",(0,i.jsx)(el.m,{content:"Provide a primary key to perform query diff in data warehouse and only return changed rows.",positioning:{placement:"bottom-end"},children:(0,i.jsx)(nl.GLE,{color:"gray.600"})})]}),(0,i.jsx)(nG,{className:"no-track-pii-safe",unitName:"key",defaultValues:n,suggestionList:o,onValuesChange:t,size:"2xs",width:"240px",placeholder:"Select or type to add keys",disabled:!r("query_diff_with_primary_key")})]})})};var n0=t(47305);function n1(e){let{description:n,onLike:t,onDislike:l,onClickLink:r,externalLink:o,externalLinkText:a}=e;return(0,i.jsxs)(c.s,{gap:4,justifyContent:"center",alignContent:"center",alignItems:"center",children:[n,(0,i.jsx)(q.K,{"aria-label":"thumbs up",variant:"ghost",width:"32px",height:"32px",onClick:t,children:(0,i.jsx)(d._,{src:"/imgs/feedback/thumbs-up.png",alt:"like"})}),(0,i.jsx)(q.K,{"aria-label":"thumbs down",variant:"ghost",width:"32px",height:"32px",onClick:l,children:(0,i.jsx)(d._,{src:"/imgs/feedback/thumbs-down.png",alt:"dislike"})}),o&&a&&(0,i.jsxs)(s.N,{href:o,target:"_blank",textDecoration:"underline",onClick:r,children:[a," ",(0,i.jsx)(eW.TdP,{})]})]})}let n5="recce-",n2={bypassSaveOverwrite:"".concat(n5,"-bypass-save-overwrite"),previewChangeFeedbackID:"".concat(n5,"-preview-change-feedback"),prepareEnvGuideID:"".concat(n5,"-prepare-env")};function n4(e){let{current:n,primaryKeys:t,setPrimaryKeys:s,onRunResultOpen:o,runQuery:a,isPending:d}=e;return(0,i.jsxs)(c.s,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,i.jsxs)(l.a,{children:[(0,i.jsxs)(u.D,{as:"h2",size:"md",display:"flex",alignItems:"center",gap:"5px",children:[(0,i.jsx)(r.I,{as:n0.czL,boxSize:"1.2em"}),"Sandbox"]}),(0,i.jsxs)(x.E,{fontSize:"xs",color:"gray.500",children:["Compare the run results based on the modified SQL code of model ",(0,i.jsx)("b",{children:null==n?void 0:n.name})]})]}),(0,i.jsx)(p.h,{}),(0,i.jsx)(nY,{defaultPrimaryKeys:t,onPrimaryKeysChange:s}),(0,i.jsx)(el.m,{content:"Run diff to see the changes",children:(0,i.jsx)(M.$,{size:"xs",marginTop:"16px",fontSize:"14px",onClick:()=>{o(),a()},colorPalette:"blue",loading:d,children:"Run Diff"})})]})}function n3(e){var n,t,l,s;let{currentModelID:r,height:o="32px",flex:a="0 0 auto"}=e,{lineageGraph:d,envInfo:u}=(0,H.cE)(),h="0 16px",p=eZ(null!=(l=null==u||null==(t=u.dbt)||null==(n=t.current)?void 0:n.generated_at)?l:""),m=(0,e2.m)(p,{addSuffix:!0}),f="N/A";if(null==d?void 0:d.nodes[r]){let e=d.nodes[r];(null==(s=e.data.current)?void 0:s.schema)&&(f=e.data.current.schema)}return(0,i.jsxs)(c.s,{gap:0,height:o,flex:a,fontSize:"14px",align:"center",margin:"0",backgroundColor:"#EDF2F880",children:[(0,i.jsx)(eq.B,{width:"50%",children:(0,i.jsxs)(x.E,{as:"b",margin:h,children:["ORIGINAL (Schema: ",f,", Last Updated: ",m,")"]})}),(0,i.jsx)(eq.B,{width:"50%",children:(0,i.jsx)(x.E,{as:"b",margin:h,children:"SANDBOX EDITOR"})})]})}function n8(e){var n;let{current:t,onChange:s}=e,r=function(e,n){let t=(0,j.useRef)(null);return(0,j.useEffect)(()=>{t.current&&e!==t.current.getValue()&&t.current.setValue(e)},[e]),{onMount(e){let i=e.getModifiedEditor();t.current=i,i.onDidChangeModelContent(()=>{n(i.getValue())})}}}(null!=(n=null==t?void 0:t.raw_code)?n:"",s);return(0,i.jsx)(l.a,{flex:1,overflowY:"auto",children:(0,i.jsx)(eL.zC,{language:"sql",theme:"vs",original:null==t?void 0:t.raw_code,modified:null==t?void 0:t.raw_code,options:{readOnly:!1,fontSize:14,lineNumbers:"on",automaticLayout:!0,renderOverviewRuler:!1,minimap:{enabled:!0}},onMount:r.onMount})})}function n7(e){var n,t;let{isOpen:s,onClose:r,current:a}=e,{open:u,onClose:x,onOpen:p}=(0,T.j)(),[m,f]=(0,j.useState)(null!=(n=null==a?void 0:a.raw_code)?n:""),{showRunId:g,clearRunResult:v}=(0,G.tr)(),{primaryKeys:y,setPrimaryKeys:w}=(0,nf.vr)(),{data:k,isLoading:C}=(0,ny.T)(),_=async()=>{var e;let n={current_model:null!=(e=null==a?void 0:a.name)?e:"",primary_keys:y,sql_template:m},{run_id:t}=await nB(n,{nowait:!0});return g(t),await (0,eY.Zc)(t)},{mutate:S,isPending:z}=(0,B.n)({mutationFn:_,onSuccess(e,n){e.error?(0,b.In)({action:"run",node:null==a?void 0:a.name,status:"failure"}):((0,b.In)({action:"run",node:null==a?void 0:a.name,status:"success"}),setTimeout(()=>{E()},1e3),!C&&(null==k?void 0:k.single_env_onboarding)&&setTimeout(()=>{D()},2e3))}}),{feedbackToast:E,closeToast:I}=function(e){let{feedbackId:n,description:t,onFeedbackSubmit:l,externalLink:s,externalLinkText:r}=e,[o,a]=(0,j.useState)(void 0);return{feedbackToast:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=localStorage.getItem(n);null==o&&("true"!==c||e)&&a(eT.X.create({id:n,duration:void 0,type:"success",description:(0,i.jsx)(h.z,{children:(0,i.jsx)(n1,{description:t,onLike:()=>{l("like"),eT.X.dismiss(o),localStorage.setItem(n,"true")},onDislike:()=>{l("dislike"),eT.X.dismiss(o),localStorage.setItem(n,"true")},externalLink:s,externalLinkText:r,onClickLink:()=>{l("link")}})})}))},closeToast:()=>{eT.X.dismiss(o)}}}({feedbackId:n2.previewChangeFeedbackID,description:"Enjoy preview change?",onFeedbackSubmit:e=>{switch(e){case"like":(0,b.Ly)({feedback:"like",node:null==a?void 0:a.name});break;case"dislike":(0,b.Ly)({feedback:"dislike",node:null==a?void 0:a.name});break;case"link":(0,b.Ly)({feedback:"form",node:null==a?void 0:a.name});break;default:console.log("Not support feedback type")}},externalLink:"https://docs.google.com/forms/d/e/1FAIpQLSd7Lei7Ijwo7MinWaI0K6rzZi_21gV1BKetmiNEX254kDziDA/viewform?usp=header",externalLinkText:"Give us feedback"}),{guideToast:D,closeGuideToast:R}=function(e){let[n,t]=(0,j.useState)(void 0),{guideId:i,description:l,externalLink:s,externalLinkText:r,onExternalLinkClick:o}=e;return{guideToast:function(){null==n&&t(eT.X.create({id:i,duration:3e3,type:"success",description:l,action:{label:null!=r?r:"link",onClick:()=>{o&&o()}}}))},closeGuideToast:()=>{eT.X.dismiss(n)}}}({guideId:n2.prepareEnvGuideID,description:"Want to compare data changes with production data?",externalLink:"https://docs.datarecce.io/get-started/#prepare-dbt-artifacts",externalLinkText:"Learn how.",onExternalLinkClick:()=>{(0,b.TL)({action:"external_link",from:"preview_changes",node:null==a?void 0:a.name})}});return(0,j.useEffect)(()=>{if(s){var e;f(null!=(e=null==a?void 0:a.raw_code)?e:"")}},[s,a]),(0,i.jsx)(F.Dz,{open:s,size:"cover",onOpenChange:()=>{r(),x(),v(),I(),R(),(0,b.In)({action:"close",node:null==a?void 0:a.name})},children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{height:"100%",children:[(0,i.jsxs)(F.c7,{height:"40px",bg:"rgb(77, 209, 176)",px:0,py:4,children:[(0,i.jsxs)(c.s,{alignItems:"center",height:"100%",gap:"10px",children:[(0,i.jsx)(d._,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,i.jsx)(F.L3,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,i.jsx)(o.Ex,{fontSize:"sm",color:"white/80",variant:"outline",children:"Experiment"})]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]}),(0,i.jsx)(F.R4,{p:0,children:(0,i.jsxs)(ep,{sizes:u?[50,50]:[100,0],minSize:100*!!u,gutterSize:5*!!u,style:{flex:"1",contain:"size",height:"100%"},children:[(0,i.jsxs)(c.s,{direction:"column",height:"100%",m:0,p:0,children:[(0,i.jsx)(n4,{current:a,primaryKeys:null!=y?y:[],setPrimaryKeys:w,onRunResultOpen:p,runQuery:S,isPending:z}),(0,i.jsx)(n3,{height:"32pxs",flex:"0 0 auto",currentModelID:null!=(t=null==a?void 0:a.id)?t:""}),(0,i.jsx)(n8,{current:a,onChange:f})]}),u?(0,i.jsx)(nW,{onClose:x,disableAddToChecklist:!0}):(0,i.jsx)(l.a,{})]})}),(0,i.jsx)(l.a,{position:"fixed",bottom:"4",right:"4",opacity:.5,children:(0,i.jsx)(el.m,{content:"Give us feedback",children:(0,i.jsx)(q.K,{"aria-label":"feedback",variant:"ghost",size:"md",onClick:()=>{E(!0)},children:(0,i.jsx)(Z.Kyq,{})})})})]})})]})})}let n6=e=>{var n,t,s,r,o,a;let{node:c}=e,{open:d,onOpen:u,onClose:h}=(0,T.j)(),[x,p]=(0,j.useState)(!1),{data:m,isLoading:f}=(0,ny.T)(),g=null==m?void 0:m.single_env_onboarding;if(f)return(0,i.jsx)(i.Fragment,{});if("model"!==c.resourceType&&"snapshot"!==c.resourceType)return"Not available";let v={readOnly:!0,lineNumbers:"on",automaticLayout:!0,renderOverviewRuler:!1,wordWrap:"off",minimap:{enabled:!1}},y={readOnly:!0,lineNumbers:"on",automaticLayout:!0,wordWrap:"off",minimap:{enabled:!1}},b=null==(n=c.data.base)?void 0:n.raw_code,w=null==(t=c.data.current)?void 0:t.raw_code,k=null!=(a=null!=(o=null==(s=c.data.base)?void 0:s.name)?o:null==(r=c.data.current)?void 0:r.name)?a:"";return(0,i.jsxs)(l.a,{className:"no-track-pii-safe",style:{position:"relative"},height:"100%",onMouseEnter:()=>{p(!0)},onMouseLeave:()=>{p(!1)},children:[g?(0,i.jsx)(eG,{language:"sql",theme:"vs",value:null!=b?b:"",options:y}):(0,i.jsx)(eL.zC,{language:"sql",theme:"vs",original:b,modified:w,options:{...v,renderSideBySide:!1}}),(0,i.jsx)(q.K,{onClick:u,size:"md","aria-label":"Expand",variant:"ghost",style:{position:"absolute",top:"5px",right:"20px",opacity:x?.5:.1,transition:"opacity 0.3s ease-in-out"},children:(0,i.jsx)(ef.xKl,{})}),(0,i.jsx)(F.Dz,{open:d,onOpenChange:h,size:"xl",children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{overflowY:"auto",height:"75%",children:[(0,i.jsxs)(F.c7,{children:[g?(0,i.jsxs)(F.L3,{children:[(0,i.jsx)("code",{children:k})," Model Code"]}):(0,i.jsxs)(F.L3,{children:[(0,i.jsx)("code",{children:k})," Model Code Diff"]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]}),(0,i.jsx)(F.R4,{children:g?(0,i.jsx)(eL.KE,{language:"sql",theme:"vs",value:null!=b?b:"",options:{...y,fontSize:16}}):(0,i.jsx)(eL.zC,{language:"sql",theme:"vs",original:b,modified:w,options:{...v,fontSize:16}})})]})})]})})]})};function n9(e,n){let t=(0,U.Z)(e,n);if(0===t.length)return[];if(0===e.length||0===n.length)return t.map((e,n)=>n===t.length-1?e:e+",");let i="";return t.forEach(t=>{e.includes(t)&&n.includes(t)&&(i=t)}),t.map((l,s)=>{let r;return(r=e.includes(l)?n.includes(l)?l:"--- ".concat(l," (Removed)"):"--- ".concat(l," (Added)"),l===i||s===t.length-1)?r:r+","})}function te(e){var n,t,s,o;let{node:a,onCloseNode:c}=e,[,d]=(0,eE.zy)(),{setSqlQuery:f,setPrimaryKeys:g}=(0,nf.vr)(),v="model"===a.resourceType||"seed"===a.resourceType||"source"===a.resourceType||"snapshot"===a.resourceType,{open:y,onOpen:w,onClose:k}=(0,T.j)(),{open:C,onClose:_}=(0,T.j)({defaultOpen:!0}),{runAction:S}=(0,G.tr)(),{envInfo:z,isActionAvailable:E}=(0,H.cE)(),{primaryKey:I}=(0,nj.Ay)(a.name),D=()=>{S("row_count",{node_names:[a.name]},{showForm:!1,showLast:!1})},R=()=>{S("row_count_diff",{node_names:[a.name]},{showForm:!1,showLast:!1})},{data:F}=(0,ny.T)(),N=null==F?void 0:F.single_env_onboarding,q=(0,j.useCallback)(async()=>{let e=a.id,n=await ng({node_id:e});d("/checks/".concat(n.check_id))},[a,d]),O=(e,n)=>e?nv.add_or_remove:E(n)?"":"This action is not supported yet.",X="added"===a.changeStatus||"removed"===a.changeStatus,K=Object.keys(null!=(s=null==(n=a.data.base)?void 0:n.columns)?s:{}),Q=Object.keys(null!=(o=null==(t=a.data.current)?void 0:t.columns)?o:{});return(0,i.jsxs)(nm.x,{height:"100%",templateRows:"auto auto 1fr",children:[(0,i.jsxs)(h.z,{children:[(0,i.jsx)(l.a,{flex:"0 1 20%",p:"16px",children:(0,i.jsx)(u.D,{size:"sm",className:"no-track-pii-safe",children:a.name})}),(0,i.jsx)(p.h,{}),N?(0,i.jsx)(function(){var e,n,t;let l=n9(K,Q),s='select * from {{ ref("'.concat(a.name,'") }}');return(l.length&&(s="select \n  ".concat(l.join("\n  "),'\nfrom {{ ref("').concat(a.name,'") }}')),"model"!==a.resourceType&&"seed"!==a.resourceType&&"snapshot"!==a.resourceType)?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(A.il,{children:[(0,i.jsx)(A.cQ,{asChild:!0,children:(0,i.jsxs)(M.$,{size:"xs",variant:"outline",children:["Explore ",(0,i.jsx)(nl.RQe,{})]})}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsxs)(A.rm,{children:[(0,i.jsxs)(A.Dr,{value:"label",fontSize:"14px",onClick:()=>{(null==z?void 0:z.adapterType)==="dbt"?f(s):(null==z?void 0:z.adapterType)==="sqlmesh"&&f("select * from ".concat(a.name)),d("/query")},children:[(0,i.jsx)(r.I,{as:null==(e=(0,e_.C)("query"))?void 0:e.icon})," Query"]}),(0,i.jsxs)(A.Dr,{value:"row-count",fontSize:"14px",onClick:()=>{D()},children:[(0,i.jsx)(r.I,{as:null==(n=(0,e_.C)("row_count"))?void 0:n.icon})," Row Count"]}),(0,i.jsx)(el.m,{content:O(X,"profile"),positioning:{placement:"left"},children:(0,i.jsxs)(A.Dr,{value:"profile",fontSize:"14px",disabled:X,onClick:()=>{S("profile",{model:a.name},{showForm:!0,showLast:!1})},children:[(0,i.jsx)(r.I,{as:null==(t=(0,e_.C)("profile"))?void 0:t.icon})," Profile"]})})]})})})]})},{}):(0,i.jsx)(function(){var e,n,t,l,s,o,c,u;let h=n9(K,Q),x='select * from {{ ref("'.concat(a.name,'") }}');h.length&&(x="select \n  ".concat(h.join("\n  "),'\nfrom {{ ref("').concat(a.name,'") }}'));let{featureToggles:p}=(0,ee.c)();return"model"!==a.resourceType&&"seed"!==a.resourceType&&"snapshot"!==a.resourceType?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(A.il,{children:[(0,i.jsx)(A.cQ,{asChild:!0,children:(0,i.jsxs)(M.$,{size:"2xs",variant:"outline",disabled:p.disableNodeActionDropdown,children:["Explore ",(0,i.jsx)(nl.RQe,{})]})}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsxs)(A.rm,{children:[(0,i.jsxs)(A.Dr,{value:"query",fontSize:"14px",disabled:p.disableDatabaseQuery,onClick:()=>{(null==z?void 0:z.adapterType)==="dbt"?f(x):(null==z?void 0:z.adapterType)==="sqlmesh"&&f("select * from ".concat(a.name)),E("query_diff_with_primary_key")&&g(void 0!==I?[I]:void 0),d("/query")},children:[(0,i.jsx)(r.I,{as:null==(e=(0,e_.C)("query_diff"))?void 0:e.icon})," Query"]}),(0,i.jsxs)(A.Dr,{value:"sandbox",fontSize:"14px",disabled:p.disableDatabaseQuery,onClick:()=>{E("query_diff_with_primary_key")&&g(void 0!==I?[I]:void 0),w(),(0,b.In)({action:"explore",node:a.name})},children:[(0,i.jsx)(r.I,{as:null==(n=(0,e_.C)("sandbox"))?void 0:n.icon})," Sandbox (Experiment)"]}),(0,i.jsx)(A.bX,{}),(0,i.jsxs)(A.Uh,{m:"0",p:"0",children:[(0,i.jsx)(A.QC,{children:"Diff"}),(0,i.jsxs)(A.Dr,{value:"row-count-diff",fontSize:"14px",disabled:p.disableDatabaseQuery,onClick:()=>{R()},children:[(0,i.jsx)(r.I,{as:null==(t=(0,e_.C)("row_count_diff"))?void 0:t.icon})," Row Count Diff"]}),(0,i.jsx)(el.m,{disabled:""===O(X,"profile_diff"),content:O(X,"profile_diff"),positioning:{placement:"left"},children:(0,i.jsxs)(A.Dr,{value:"profile-diff",fontSize:"14px",disabled:X||p.disableDatabaseQuery,onClick:()=>{S("profile_diff",{model:a.name},{showForm:!0,showLast:!1})},children:[(0,i.jsx)(r.I,{as:null==(l=(0,e_.C)("profile_diff"))?void 0:l.icon})," Profile Diff"]})}),(0,i.jsx)(el.m,{disabled:""===O(X,"value_diff"),content:O(X,"value_diff"),positioning:{placement:"left"},children:(0,i.jsxs)(A.Dr,{value:"value-diff",fontSize:"14px",disabled:X||p.disableDatabaseQuery,onClick:()=>{S("value_diff",{model:a.name},{showForm:!0,showLast:!1})},children:[(0,i.jsx)(r.I,{as:null==(s=(0,e_.C)("value_diff"))?void 0:s.icon})," Value Diff"]})}),(0,i.jsx)(el.m,{disabled:""===O(X,"top_k_diff"),content:O(X,"top_k_diff"),positioning:{placement:"left"},children:(0,i.jsxs)(A.Dr,{value:"top-k-diff",fontSize:"14px",disabled:X||p.disableDatabaseQuery,onClick:()=>{S("top_k_diff",{model:a.name,column_name:"",k:50},{showForm:!0})},children:[(0,i.jsx)(r.I,{as:null==(o=(0,e_.C)("top_k_diff"))?void 0:o.icon})," Top-K Diff"]})}),(0,i.jsx)(el.m,{disabled:""===O(X,"histogram_diff"),content:O(X,"histogram_diff"),positioning:{placement:"left"},children:(0,i.jsxs)(A.Dr,{value:"histogram-diff",fontSize:"14px",disabled:X||p.disableDatabaseQuery,onClick:()=>{S("histogram_diff",{model:a.name,column_name:"",column_type:""},{showForm:!0})},children:[(0,i.jsx)(r.I,{as:null==(c=(0,e_.C)("histogram_diff"))?void 0:c.icon})," Histogram Diff"]})})]}),(0,i.jsx)(A.bX,{}),(0,i.jsxs)(A.Uh,{m:"0",p:"4px 12px",children:[(0,i.jsx)(A.QC,{children:"Add to Checklist"}),(0,i.jsxs)(A.Dr,{value:"schema-diff",fontSize:"14px",onClick:()=>{q()},children:[(0,i.jsx)(r.I,{as:null==(u=(0,e_.C)("schema_diff"))?void 0:u.icon})," Schema Diff"]})]})]})})})]})},{}),(0,i.jsx)(l.a,{flex:"0 1 1%",children:(0,i.jsx)(P.J,{size:"2xs",onClick:c})})]}),(0,i.jsx)(l.a,{color:"gray",paddingLeft:"16px",children:(0,i.jsxs)(h.z,{gap:"8px",children:[(0,i.jsx)(ns,{node:a}),("model"===a.resourceType||"snapshot"===a.resourceType||"seed"===a.resourceType)&&(N?(0,i.jsx)(na,{node:a,onRefresh:D}):(0,i.jsx)(no,{node:a,onRefresh:R}))]})}),v&&(0,i.jsxs)(m.pK,{defaultValue:"columns",overflow:"auto",children:[N&&C&&(0,i.jsx)(l.a,{p:"12px",children:(0,i.jsx)(nF,{onClose:_,align:"flex-start",children:(0,i.jsxs)(x.E,{children:["Enable the Recce Checklist and start adding checks for better data validation and review.",(0,i.jsx)("br",{}),(0,i.jsx)(nN,{})]})})}),(0,i.jsxs)(m.j7,{children:[(0,i.jsx)(m.Xi,{value:"columns",children:"Columns"}),(0,i.jsx)(m.Xi,{value:"code",children:"Code"})]}),(0,i.jsxs)(m.T$,{overflow:"auto",height:"calc(100% - 42px)",children:[(0,i.jsx)(m.av,{value:"columns",p:0,overflowY:"auto",height:"100%",children:N?(0,i.jsx)(ed,{current:a.data.current}):(0,i.jsx)(ec,{base:a.data.base,current:a.data.current})}),(0,i.jsx)(m.av,{value:"code",height:"100%",p:0,children:(0,i.jsx)(n6,{node:a})})]})]}),(0,i.jsx)(n7,{isOpen:y,onClose:k,current:a.data.current})]})}function tn(e){var n,t;let{onClose:s}=e,{cancel:r,actionState:o}=et();return(0,i.jsx)(l.a,{bg:"white",rounded:"md",shadow:"dark-lg",children:(0,i.jsxs)(h.z,{p:"5px 15px",mt:"4",separator:(0,i.jsx)(e3.k,{borderColor:"gray.200"}),gap:4,children:[(0,i.jsxs)(l.a,{fontSize:"10pt",children:["Progress: ","per_node"===o.mode?"".concat(o.completed," / ").concat(o.total):(null==(t=o.currentRun)||null==(n=t.progress)?void 0:n.percentage)?"".concat(100*o.currentRun.progress.percentage,"%"):"completed"===o.status?"100%":"0%"," ","canceled"===o.status?" (canceled)":""]}),"running"===o.status||"canceling"===o.status?(0,i.jsx)(M.$,{size:"xs",variant:"outline",onClick:r,loading:"canceling"===o.status,loadingText:"Canceling",children:"Cancel"}):(0,i.jsx)(h.z,{children:(0,i.jsx)(M.$,{size:"xs",variant:"outline",onClick:s,children:"Close"})})]})})}var tt=t(7273),ti=t(8193);let tl=()=>(0,i.jsxs)(I.T,{align:"start",gap:0,children:[(0,i.jsx)(x.E,{fontSize:"10pt",color:"gray.500",pb:1,children:"Select nodes by dbt node selector syntax"}),(0,i.jsxs)(x.E,{fontSize:"8pt",children:[(0,i.jsx)(a.C,{fontSize:"8pt",children:"model_name"})," Select a node"]}),(0,i.jsxs)(x.E,{fontSize:"8pt",children:[(0,i.jsx)(a.C,{fontSize:"8pt",children:"model_name+"})," Select downstream nodes"]}),(0,i.jsxs)(x.E,{fontSize:"8pt",children:[(0,i.jsx)(a.C,{fontSize:"8pt",children:"+model_name"})," Select upstream nodes"]}),(0,i.jsxs)(x.E,{fontSize:"8pt",children:[(0,i.jsx)(a.C,{fontSize:"8pt",children:"model*"})," Select by wildcard"]})]}),ts=()=>{let{isHistoryOpen:e,showHistory:n,closeHistory:t}=(0,G.tr)();return(0,i.jsxs)(M.$,{size:"2xs",variant:"outline",onClick:()=>{e?((0,b.iZ)({name:"hide"}),t()):((0,b.iZ)({name:"show"}),n())},children:[(0,i.jsx)(r.I,{as:Z.XVG})," ",e?"Hide":"Show"]})},tr=e=>{var n;let{isDisabled:t}=e,{viewOptions:l,onViewOptionsChanged:s}=et(),o=null!=(n=l.view_mode)?n:"changed_models",a=e=>{s({...l,view_mode:e})};return(0,i.jsxs)(A.il,{children:[(0,i.jsx)(A.cQ,{asChild:!0,children:(0,i.jsxs)(M.$,{minWidth:"100px",size:"2xs",variant:"outline",disabled:t,children:[(0,i.jsx)(r.I,{as:ek("model").icon})," ","changed_models"===o?"Changed Models":"All"," ",(0,i.jsx)(nl.RQe,{})]})}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsx)(A.rm,{children:(0,i.jsxs)(A.x0,{value:o,onValueChange:e=>{a(e.value)},children:[(0,i.jsx)(A.QC,{children:"mode"}),(0,i.jsxs)(A.iD,{value:"changed_models",children:["Changed Models",(0,i.jsx)(A.S3,{})]}),(0,i.jsxs)(A.iD,{value:"all",children:["All",(0,i.jsx)(A.S3,{})]})]})})})})]})},to=e=>{var n,t;let{isDisabled:l}=e,{lineageGraph:s}=(0,H.cE)(),{viewOptions:o,onViewOptionsChanged:a}=et(),c=new Set;for(let e of Object.values(null!=(t=null==s?void 0:s.nodes)?t:{}))e.packageName&&c.add(e.packageName);let d=null==s||null==(n=s.manifestMetadata.current)?void 0:n.project_name,u=o.packages?new Set(o.packages):d?new Set([d]):c,h=u.size===c.size,x=0===u.size,p=1===u.size?Array.from(u)[0]:h?"All Packages":x?"No Package":"".concat(u.size," Packages"),m=e=>{let n=new Set(u);n.has(e)?n.delete(e):n.add(e),a({...o,packages:Array.from(n)})};return(0,i.jsxs)(A.il,{closeOnSelect:!1,children:[(0,i.jsx)(A.cQ,{asChild:!0,children:(0,i.jsxs)(M.$,{minWidth:"100px",size:"2xs",variant:"outline",disabled:l,children:[(0,i.jsx)(r.I,{as:nn.est})," ",p," ",(0,i.jsx)(nl.RQe,{})]})}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsx)(A.rm,{children:(0,i.jsxs)(A.Uh,{children:[(0,i.jsx)(A.QC,{children:"Select Packages"}),(0,i.jsx)(A.Dr,{value:"",asChild:!0,children:(0,i.jsxs)(tt.y8,{checked:h||x?h:"indeterminate",onCheckedChange:()=>{h?a({...o,packages:[]}):a({...o,packages:Array.from(c)})},children:[(0,i.jsx)(tt.Ks,{}),(0,i.jsx)(tt.v7,{}),(0,i.jsx)(tt.Sb,{children:"Select All"})]})}),(0,i.jsx)(A.bX,{}),Array.from(c).map(e=>(0,i.jsx)(A.Dr,{value:e,children:(0,i.jsxs)(tt.y8,{checked:u.has(e),onCheckedChange:()=>{m(e)},children:[(0,i.jsx)(tt.Ks,{}),(0,i.jsx)(tt.v7,{}),(0,i.jsx)(tt.Sb,{children:e})]})},e))]})})})})]})},ta=e=>{let[n,t]=(0,j.useState)(e.value),{data:l}=(0,ny.T)(),s=(0,j.useRef)(null);return(0,j.useEffect)(()=>{s.current&&(s.current.value=e.value)},[e.value]),(0,i.jsx)(el.m,{contentProps:{width:"300px",padding:2,shadow:"md",borderWidth:1,rounded:"md",color:"black",backgroundColor:"white"},content:e.tooltipComponent,positioning:{placement:"bottom-start"},closeOnClick:!1,disabled:!(null==l?void 0:l.single_env_onboarding),children:(0,i.jsx)($.p,{ref:s,height:"24px",fontSize:"10pt",placeholder:"with selectors",disabled:e.isDisabled,value:n,onChange:e=>{t(e.target.value)},onKeyUp:i=>{"Enter"===i.key?e.onChange(n):"Escape"===i.key&&(i.preventDefault(),t(e.value),s.current&&s.current.blur())},onBlur:()=>{t(e.value)}})})},tc=e=>{var n;let{isDisabled:t}=e,{viewOptions:l,onViewOptionsChanged:s}=et();return(0,i.jsx)(ta,{isDisabled:t,value:null!=(n=l.select)?n:"",onChange:e=>{s({...l,select:e||void 0})},tooltipComponent:(0,i.jsx)(tl,{})})},td=e=>{var n;let{isDisabled:t}=e,{viewOptions:l,onViewOptionsChanged:s}=et();return(0,i.jsx)(ta,{isDisabled:t,value:null!=(n=l.exclude)?n:"",onChange:e=>{s({...l,exclude:e||void 0})}})},tu=e=>(0,i.jsxs)(l.a,{style:e.style,maxWidth:"300px",children:[(0,i.jsx)(l.a,{fontSize:"8pt",children:e.label||(0,i.jsx)(i.Fragment,{children:"\xa0"})}),e.children]}),th=()=>{var e,n,t,l,s;let{deselect:o,focusedNode:a,selectedNodes:c,...d}=et(),{featureToggles:u}=(0,ee.c)(),{data:m}=(0,ny.T)(),f=null==m?void 0:m.single_env_onboarding,j=c.length>0,g=!a&&!j;return(0,i.jsx)(h.z,{width:"100%",padding:"4pt 8pt",className:"chakra-style-reset",children:(0,i.jsxs)(h.z,{flex:"1",children:[(0,i.jsx)(tu,{label:"History",style:{flexShrink:"1"},children:(0,i.jsx)(ts,{})}),(0,i.jsx)(tu,{label:"Mode",style:{flexShrink:"1"},children:(0,i.jsx)(tr,{isDisabled:j})}),(0,i.jsx)(tu,{label:"Package",style:{flexShrink:"1"},children:(0,i.jsx)(to,{isDisabled:j})}),(0,i.jsx)(tu,{label:"Select",style:{flex:"100 1 auto"},children:(0,i.jsx)(tc,{isDisabled:j})}),(0,i.jsx)(tu,{label:"Exclude",style:{flex:"100 1 auto"},children:(0,i.jsx)(td,{isDisabled:j})}),(0,i.jsx)(p.h,{}),j&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tu,{label:"",style:{flexShrink:"0"},children:(0,i.jsx)(x.E,{fontSize:"9pt",color:"gray.500",children:c.length>1?"".concat(c.length," nodes selected"):"".concat(c.length," node selected")})}),(0,i.jsx)(tu,{label:"",children:(0,i.jsx)(M.$,{variant:"outline",size:"2xs",fontSize:"9pt",onClick:()=>{o()},children:"Deselect"})}),f&&(0,i.jsx)(tu,{label:"Explore",children:(0,i.jsx)(ti.e,{attached:!0,variant:"outline",children:(0,i.jsxs)(A.il,{positioning:{placement:"bottom-end"},children:[(0,i.jsx)(A.cQ,{asChild:!0,children:(0,i.jsxs)(M.$,{size:"2xs",children:["Actions ",(0,i.jsx)(nl.RQe,{})]})}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsx)(A.rm,{children:(0,i.jsx)(A.Dr,{value:"row-count",disabled:u.disableDatabaseQuery,onClick:async()=>{await d.runRowCount()},children:(0,i.jsxs)(x.E,{textStyle:"sm",children:[(0,i.jsx)(r.I,{as:null==(e=(0,e_.C)("row_count_diff"))?void 0:e.icon})," Row Count"]})})})})})]})})})]}),!f&&(0,i.jsx)(tu,{label:"Explore",children:(0,i.jsx)(ti.e,{attached:!0,variant:"outline",children:(0,i.jsxs)(A.il,{positioning:{placement:"bottom-end"},children:[(0,i.jsx)(A.cQ,{asChild:!0,children:(0,i.jsxs)(M.$,{size:"2xs",disabled:u.disableViewActionDropdown,children:["Actions ",(0,i.jsx)(nl.RQe,{})]})}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsxs)(A.rm,{children:[(0,i.jsxs)(A.Uh,{m:"0",p:"4px 12px",children:[(0,i.jsx)(A.QC,{children:"Diff"}),(0,i.jsx)(A.Dr,{value:"row-count-diff",disabled:u.disableDatabaseQuery,onClick:async()=>{await d.runRowCountDiff()},children:(0,i.jsxs)(x.E,{textStyle:"sm",children:[(0,i.jsx)(r.I,{as:null==(n=(0,e_.C)("row_count_diff"))?void 0:n.icon})," Row Count Diff"]})}),(0,i.jsx)(A.Dr,{value:"value-diff",disabled:u.disableDatabaseQuery,onClick:async()=>{await d.runValueDiff()},children:(0,i.jsxs)(x.E,{textStyle:"sm",children:[(0,i.jsx)(r.I,{as:null==(t=(0,e_.C)("value_diff"))?void 0:t.icon})," Value Diff"]})})]}),(0,i.jsx)(A.bX,{}),(0,i.jsxs)(A.Uh,{m:"0",px:"12px",children:[(0,i.jsx)(A.QC,{children:"Add to Checklist"}),(0,i.jsx)(A.Dr,{value:"lineage-diff",disabled:!(g||j&&c.length>1),onClick:()=>{d.addLineageDiffCheck(d.viewOptions.view_mode)},children:(0,i.jsxs)(x.E,{textStyle:"sm",children:[(0,i.jsx)(r.I,{as:null==(l=(0,e_.C)("lineage_diff"))?void 0:l.icon})," Lineage Diff"]})}),(0,i.jsx)(A.Dr,{value:"schema-diff",disabled:!1,onClick:()=>{d.addSchemaDiffCheck()},children:(0,i.jsxs)(x.E,{textStyle:"sm",children:[(0,i.jsx)(r.I,{as:null==(s=(0,e_.C)("schema_diff"))?void 0:s.icon})," Schema Diff"]})})]})]})})})]})})})]})})};var tx=t(36956);async function tp(e){return(await v.g.post("/api/checks",{type:"lineage_diff",params:{},view_options:e})).data}function tm(){return(0,i.jsx)(l.a,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[n,[t,l]]=e,{icon:s,color:o}=ew(n);return(0,i.jsx)(el.m,{content:l,positioning:{placement:"right"},children:(0,i.jsxs)(c.s,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,i.jsx)(r.I,{color:o,as:s})," ",t]})},n)})})}var tf=t(80028);let tj={mode:"per_node",status:"pending",completed:0,total:0,actions:{}},tg=(e,n)=>{let{onActionStarted:t,onActionNodeUpdated:i,onActionCompleted:l}=n,s=(0,j.useRef)({...tj}).current,{showRunId:r}=(0,G.tr)(),o=async(n,o,a)=>{s.mode="multi_nodes",s.actions={};let c=s.mode,d=s.actions;t(),s.status="running";let u=[];for(let n of e){let e=o(n);e?(d[n.id]={mode:c,status:"skipped",skipReason:e},i(n)):(d[n.id]={mode:c,status:"pending"},u.push(n))}let h=a(u);try{let{run_id:e}=await (0,eY.AU)(n,h,{nowait:!0});for(r(e),s.currentRun={run_id:e},s.total=1;;){let n=await (0,eY.Zc)(e,2);s.currentRun=n;let t=n.error?"failure":n.result?"success":"running";for(let e of u)d[e.id]={mode:c,status:t,run:n},i(e);if(n.error||n.result)break}}catch(e){}if(s.completed=1,"canceling"===s.status){s.status="canceled",l();return}s.status="completed",l()},a=async(n,r)=>{s.mode="per_node",s.actions={};let o=s.mode,a=s.actions;for(let n of(t(),s.status="running",e))a[n.id]={mode:o,status:"pending"},i(n);for(let t of(s.completed=0,s.total=e.length,e)){let{params:e,skipReason:c}=r(t);if(c)a[t.id]={mode:o,status:"skipped",skipReason:c},i(t);else try{let{run_id:l}=await (0,eY.AU)(n,e,{nowait:!0});for(s.currentRun={run_id:l},a[t.id]={mode:o,status:"running"},i(t);;){let e=await (0,eY.Zc)(l,2);s.currentRun=e;let n=e.error?"failure":e.result?"success":"running";if(a[t.id]={mode:o,status:n,run:e},i(t),e.error||e.result)break}}catch(e){}finally{s.currentRun=void 0}if(s.completed++,"canceling"===s.status){s.status="canceled",l();return}}s.status="completed",l()},c=async()=>{let n=[];for(let t of e)"model"!==t.resourceType?(s.actions[t.id]={mode:"multi_nodes",status:"skipped",skipReason:"Not a model"},i(t)):n.push(t.name);await o("row_count",e=>{if("model"!==e.resourceType)return"Not a model"},e=>({node_names:e.map(e=>e.name)}))},d=async()=>{let n=[];for(let t of e)"model"!==t.resourceType?(s.actions[t.id]={mode:"multi_nodes",status:"skipped",skipReason:"Not a model"},i(t)):n.push(t.name);await o("row_count_diff",e=>{if("model"!==e.resourceType)return"Not a model"},e=>({node_names:e.map(e=>e.name)}))},u=async()=>{var e;s.status="canceling",(null==(e=s.currentRun)?void 0:e.run_id)&&await (0,eY.Su)(s.currentRun.run_id)};return{actionState:s,runRowCount:c,runRowCountDiff:d,runValueDiff:async()=>{await a("value_diff",e=>{var n;let t=null==(n=e.data.current)?void 0:n.primary_key;return t?{params:{model:e.name,primary_key:t}}:{skipReason:"No primary key found. The first unique column is used as primary key."}})},addLineageDiffCheck:async()=>{let n=e.map(e=>e.id);return await tp({node_ids:n})},addSchemaDiffCheck:async()=>{let n;if(1===e.length)n=await ng({node_id:e[0].id});else{let t=e.map(e=>e.id);n=await ng({node_id:t})}return n},cancel:u,reset:()=>{Object.assign(s,tj)}}},tv=function(){let{open:e,onOpen:n,onClose:t}=(0,T.j)(),[s,r]=(0,j.useState)(0),[o,a]=(0,j.useState)(),d=(0,j.useRef)(null),u=(0,j.useCallback)(e=>(r(e),new Promise(e=>{a(()=>e),n()})),[n]),h=()=>{null==o||o(!1),t()};return{confirm:u,AlertDialog:(0,i.jsx)(F.Dz,{size:"xl",open:e,role:"alertdialog",initialFocusEl:()=>d.current,onOpenChange:h,children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{children:[(0,i.jsx)(F.c7,{fontSize:"lg",fontWeight:"bold",children:(0,i.jsxs)(F.L3,{children:["Value Diff on ",s," nodes"]})}),(0,i.jsx)(F.R4,{gap:"20px",as:c.s,direction:"column",children:(0,i.jsxs)(l.a,{children:["Value diff will be executed on ",s," nodes in the Lineage, which can add extra costs to your bill."]})}),(0,i.jsxs)(F.Es,{gap:1,children:[(0,i.jsx)(M.$,{ref:d,onClick:h,variant:"outline",colorPalette:"gray",children:"Cancel"}),(0,i.jsx)(M.$,{colorPalette:"cyan",onClick:()=>{null==o||o(!0),t()},ml:3,children:"Execute"})]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]})})]})})}},ty="recce",tb={recommendationIgnored:"".concat(ty,"-recommendation-ignored"),recommendationShowed:"".concat(ty,"-recommendation-showed"),prevRefreshTimeStamp:"".concat(ty,"-prev-refresh-timestamp"),lineageNotificationDismissed:"".concat(ty,"-lineage-notification-dismissed")},tw=()=>{var e;let n=(0,g.I)({queryKey:y.X.checks(),queryFn:k}),t=(0,j.useMemo)(()=>{if("success"===n.status&&n.data.length>0){let e=n.data.filter(e=>e.is_preset).findLast(e=>"row_count_diff"===e.type);if(e)return e}},[n]),i=(0,g.I)({queryKey:(null==t?void 0:t.check_id)?y.X.check(t.check_id):[],queryFn:async()=>{if(null==t?void 0:t.check_id)return C(t.check_id)},enabled:!!(null==t?void 0:t.check_id)}),l=(0,g.I)({queryKey:(null==t?void 0:t.check_id)?[...y.X.check(t.check_id),"select"]:[],queryFn:async()=>{var e,n;return eu({select:null==t||null==(e=t.params)?void 0:e.select,exclude:null==t||null==(n=t.params)?void 0:n.exclude})},enabled:!!(null==t||null==(e=t.params)?void 0:e.select)}),s=(0,j.useMemo)(()=>{if(t){var e,n;if(null==(e=t.params)?void 0:e.node_names)return t.params.node_names;if(null==(n=t.params)?void 0:n.node_ids)return t.params.node_ids}if("success"===l.status&&l.data)return l.data.nodes},[t,l]);return{recommendedCheck:i.data,selectedNodes:s}},tk=()=>{let{featureToggles:e}=(0,ee.c)(),{lineageGraph:n,envInfo:t}=(0,H.cE)(),{showRunId:l}=(0,G.tr)(),{data:s}=(0,ny.T)(),r=(0,V.jE)(),{recommendedCheck:o,selectedNodes:a}=tw(),[d,u]=(0,j.useState)(),[m,f]=(0,j.useState)(!1),[g,v]=(0,j.useState)(!1),[w,k]=(0,j.useState)(!1),{open:C,onOpen:_,onClose:S}=(0,T.j)(),z=tb.recommendationIgnored,E=tb.recommendationShowed,I=tb.prevRefreshTimeStamp;(0,j.useEffect)(()=>{sessionStorage.getItem(z)&&v(!0)},[z]),(0,j.useEffect)(()=>{var e,i,l,s,r,c,d,h,x,p;if(!o||!a)return;if(null==(e=o.last_run)?void 0:e.run_id){let e=new Date(o.last_run.run_at).getTime(),n=null==t?void 0:t.dbt,i=Math.max((null==n||null==(s=n.current)?void 0:s.generated_at)?new Date(n.current.generated_at).getTime():0,(null==n||null==(r=n.base)?void 0:r.generated_at)?new Date(n.base.generated_at).getTime():0);if(e>=i)return void f(!0);f(!1),k(!0);let l=sessionStorage.getItem(I);(null===l||parseInt(l)!==i)&&(sessionStorage.setItem(I,i.toString()),sessionStorage.removeItem(z),sessionStorage.removeItem(E),v(!1))}let m=e=>e.map(e=>{var t;return null==n||null==(t=n.nodes[e])?void 0:t.name}).join(", ");if(a.length>0&&a.length<=3){if(null==(c=o.params)?void 0:c.node_names){let e=null==(h=o.params)?void 0:h.node_names.join(", ");u("'".concat(e,"'"))}else if(null==(d=o.params)?void 0:d.node_ids){let e=m(null==(x=o.params)?void 0:x.node_ids);u("'".concat(e,"'"))}else if(a){let e=m(a);u("'".concat(e,"'"))}}else(null==n?void 0:n.modifiedSet.length)===a.length?u("modified and potentially impacted models"):(null==(i=o.params)?void 0:i.select)&&!(null==(l=o.params)?void 0:l.exclude)?u("'".concat(null==(p=o.params)?void 0:p.select,"'")):u("".concat(a.length," models"));if(!sessionStorage.getItem(E)){let e=sessionStorage.getItem(I);sessionStorage.setItem(E,"true"),(0,b.QS)({action:"recommend",from:null===e?"initial":"rerun"})}},[o,a,n,z,E,I,t]);let D=(0,j.useCallback)(async()=>{o&&(l((await (0,eY.gM)(o.check_id,{nowait:!0})).run_id),await r.invalidateQueries({queryKey:y.X.check(o.check_id)}))},[o,l,r]);if(!o||!a||(null==s?void 0:s.single_env_onboarding))return(0,i.jsx)(i.Fragment,{});let R=a.length;return!g&&!m&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.z,{width:"100%",padding:"2pt 8pt",backgroundColor:"cyan.50",children:(0,i.jsxs)(h.z,{flex:"1",fontSize:"10pt",color:"cyan.600",children:[w?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nl.xtx,{}),(0,i.jsx)(x.E,{children:"New dbt build detected - Re-run row count checks to maintain result accuracy"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nl.GLE,{}),(0,i.jsxs)(x.E,{children:["First Check: Perform a row count diff of ",d," for basic impact assessment"]})]}),(0,i.jsx)(p.h,{}),(0,i.jsx)(M.$,{size:"2xs",variant:"ghost",onClick:()=>{v(!0),sessionStorage.setItem(z,"true"),(0,b.QS)({action:"ignore",from:w?"rerun":"initial",nodes:R})},children:"Ignore"}),(0,i.jsx)(M.$,{colorPalette:"cyan",size:"2xs",onClick:()=>{_(),(0,b.QS)({action:"perform",from:w?"rerun":"initial",nodes:R})},disabled:e.disableDatabaseQuery,children:"Perform"})]})}),(0,i.jsx)(F.Dz,{open:C,onOpenChange:()=>{S(),(0,b.QS)({action:"close",from:w?"rerun":"initial",nodes:R})},placement:"center",children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{children:[(0,i.jsx)(F.c7,{children:(0,i.jsx)(F.L3,{children:"Row Count Check"})}),(0,i.jsx)(F.R4,{children:(0,i.jsxs)(eq.B,{gap:"4",children:[(0,i.jsxs)(x.E,{children:["Perform a row count check of the ",R," node(s) displayed in the lineage diff DAG."]}),(0,i.jsxs)(c.s,{bg:"blue.100",color:"blue.700",children:[(0,i.jsx)(nl.GLE,{className:"mt-[0.625rem] ml=[0.3125rem]"}),(0,i.jsx)(x.E,{margin:"0.3125rem",paddingX:"0.1875rem",children:"This is a recommended first check based on the preset checks defined in your recce.yml file."})]})]})}),(0,i.jsxs)(F.Es,{gap:"0.3125rem",children:[(0,i.jsx)(M.$,{onClick:()=>{S(),(0,b.QS)({action:"close",from:w?"rerun":"initial",nodes:R})},children:"Cancel"}),(0,i.jsxs)(M.$,{colorPalette:"cyan",onClick:()=>{S(),D(),f(!0),(0,b.QS)({action:"execute",from:w?"rerun":"initial",nodes:R})},children:["Execute on ",R," models"]})]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]})})]})})]})},tC=e=>{let{changeStatus:n}=e;if(!n)return(0,i.jsx)(i.Fragment,{});let{color:t,icon:l}=ew(n);return(0,i.jsx)(r.I,{boxSize:"14px",display:"inline-flex",color:t,as:l})},t_=e=>{let{transformationType:n,legend:t}=e,l="U",s="red";return("passthrough"===n?(l="P",s="gray"):"renamed"===n?(l="R",s="orange"):"derived"===n?(l="D",s="orange"):"source"===n?(l="S",s="blue"):(l="U",s="red"),n)?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(N.f8,{fontSize:"8pt",size:"sm",colorPalette:s,borderRadius:"full",paddingX:"4px",children:(0,i.jsx)(N.d1,{children:l})})}):(0,i.jsx)(i.Fragment,{})},tS=()=>{let{lineageGraph:e}=(0,H.cE)(),{centerNode:n,viewOptions:t,cll:l}=et(),s=t.column_level_lineage;if(!e)return(0,i.jsx)(i.Fragment,{});if(!s)return"Default View";if(void 0===s.node_id)return(0,i.jsx)(x.E,{as:"span",children:"Impact Radius for All Changed Models"});let r=s.node_id in e.nodes?e.nodes[s.node_id].name:s.node_id;if(s.column){let e="".concat(s.node_id,"_").concat(s.column);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(x.E,{as:"span",mr:"5px",children:["Column Lineage for"," "]}),(0,i.jsxs)(a.C,{onClick:()=>{n(e)},cursor:"pointer",children:[r,".",s.column]})]})}{let e=s.node_id;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.E,{as:"span",mr:"5px",children:"Impact Radius for"}),(0,i.jsx)(a.C,{onClick:()=>{n(e)},cursor:"pointer",children:r})]})}},tz=e=>{var n;let{action:t}=e,{showColumnLevelLineage:s,resetColumnLevelLineage:o,interactive:a,viewOptions:d}=et(),{data:u}=(0,ny.T)(),h=null!=(n=null==u?void 0:u.single_env_onboarding)&&n;return(0,i.jsxs)(c.s,{direction:"row",gap:"5px",children:[!h&&(0,i.jsx)(l.a,{borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:"white",children:(0,i.jsxs)(M.$,{size:"sm",variant:"ghost",whiteSpace:"nowrap",display:"inline-flex",disabled:!a,onClick:()=>{s({no_upstream:!0,change_analysis:!0})},children:[(0,i.jsx)(ef.JwZ,{})," Impact Radius"]})}),d.column_level_lineage&&(0,i.jsxs)(c.s,{borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:"white",fontSize:"0.8rem",p:"0 0.625rem",alignItems:"center",children:[(0,i.jsx)(tS,{}),t.isError&&(0,i.jsx)(el.m,{content:"Error: ".concat(t.error.message),positioning:{placement:"bottom"},children:(0,i.jsx)(x.E,{as:"span",color:"red.500",ml:"2px",display:"inline-flex",alignItems:"center",children:(0,i.jsx)(r.I,{as:nl.GLE,color:"red.500",boxSize:"14px"})})}),t.isPending?(0,i.jsx)(J.y,{size:"xs",ml:"2px"}):(0,i.jsx)(q.K,{variant:"ghost",size:"xs",ml:"2px","aria-label":"Reset Column Level Lineage",onClick:()=>{o()},children:(0,i.jsx)(nl.yBK,{size:"10px"})})]})]})};function tE(){return(0,i.jsx)(l.a,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({passthrough:["Pass Through","The column is directly selected from the upstream table."],renamed:["Renamed","The column is selected from the upstream table but with a different name."],derived:["Derived","The column is created through transformations applied to upstream columns, such as calculations, conditions, functions, or aggregations."],source:["Source","The column is not derived from any upstream data. It may originate from a seed/source node, literal value, or data generation function."],unknown:["Unknown","We have no information about the transformation type. This could be due to a parse error, or other unknown reason."]}).map(e=>{let[n,[t,l]]=e;return(0,i.jsx)(el.m,{content:l,positioning:{placement:"right"},children:(0,i.jsxs)(c.s,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,i.jsx)(t_,{legend:!0,transformationType:n})," ",t]})},n)})})}function tI(e){let{notification:n,type:t}=e,l=tb.lineageNotificationDismissed,[s,r]=(0,j.useState)(!0);return((0,j.useEffect)(()=>{"true"===sessionStorage.getItem(l)&&r(!1)},[l]),null!==n&&s)?(0,i.jsxs)(c.s,{w:"100%",direction:"row",p:"5px 10px",gap:"5px",alignItems:"flex-start",borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:{info:"blue.50",success:"green.50",warning:"yellow.50",error:"red.50"}[t],children:[n,(0,i.jsx)(p.h,{}),(0,i.jsx)(P.J,{onClick:()=>{sessionStorage.setItem(l,"true"),r(!1)}})]}):null}function tD(){return(0,i.jsx)(c.s,{flex:"1",h:"100%",minH:0,m:"2",p:"4",bg:"blue.50",borderRadius:"lg",boxShadow:"md",justifyContent:"center",children:(0,i.jsxs)(c.s,{w:"80%",direction:"column",overflowY:"auto",gap:6,px:8,pb:8,children:[(0,i.jsxs)(c.s,{direction:"column",alignItems:"center",gap:4,children:[(0,i.jsx)(c.s,{p:2,bg:"white",borderRadius:"full",alignItems:"center",justifyContent:"center",boxShadow:"md",children:(0,i.jsx)(r.I,{as:nt.JVA,boxSize:7,color:"blue.500"})}),(0,i.jsx)(u.D,{mt:"4",size:"lg",children:"Wait, there's more!"}),(0,i.jsxs)(x.E,{fontSize:"md",textAlign:"center",children:["Recce is currently running in"," ",(0,i.jsx)(x.E,{fontWeight:"bold",as:"span",children:"limited functionality mode"})," ","so you can run queries but"," ",(0,i.jsx)(x.E,{fontWeight:"bold",as:"span",children:"can't diff the results yet!"})]})]}),(0,i.jsxs)(c.s,{direction:"column",gap:2,children:[(0,i.jsx)(x.E,{fontSize:"md",children:"To unlock the full power of Recce, set up a base environment of dbt artifacts for comparison."}),(0,i.jsx)(x.E,{children:"Once configured, you'll be able to:"}),(0,i.jsxs)(em.$z,{children:[(0,i.jsx)(em.ck,{children:(0,i.jsx)(x.E,{children:"Run statistical data diffs"})}),(0,i.jsx)(em.ck,{children:(0,i.jsx)(x.E,{children:"Run query diffs"})}),(0,i.jsx)(em.ck,{children:(0,i.jsx)(x.E,{children:"Save checks to your Recce Checklist"})}),(0,i.jsx)(em.ck,{children:(0,i.jsx)(x.E,{children:"...and more!"})})]}),(0,i.jsx)(x.E,{fontSize:"md",children:"Take the next step toward better data impact assessment."})]}),(0,i.jsx)(c.s,{w:"100%",direction:"column",mt:6,children:(0,i.jsx)(M.$,{colorPalette:"blue",size:"lg",onClick:()=>{window.open("https://docs.datarecce.io/get-started/#prepare-dbt-artifacts","_blank")},children:"Start Now"})})]})})}function tR(){return(0,i.jsxs)(c.s,{direction:"row",gap:"10px",alignItems:"flex-start",children:[(0,i.jsx)(r.I,{as:nt.yHN,color:"blue.500",boxSize:"5"}),(0,i.jsxs)(c.s,{direction:"column",gap:"5px",children:[(0,i.jsxs)(x.E,{fontWeight:"bold",children:["Single Environment Mode"," ",(0,i.jsx)(x.E,{color:"red",as:"span",children:"Limited Functionality"})]}),(0,i.jsx)(x.E,{fontSize:"sm",children:"Single Environment Mode allows you to explore your dbt project but won't show data comparisons between environments."}),(0,i.jsx)(x.E,{fontSize:"sm",children:"To set up full environment comparison:"}),(0,i.jsxs)(em.$z,{ps:"4",children:[(0,i.jsx)(em.ck,{children:(0,i.jsx)(x.E,{fontSize:"sm",children:"Run `recce debug` for setup assistance"})}),(0,i.jsx)(em.ck,{children:(0,i.jsxs)(x.E,{fontSize:"sm",children:["Visit"," ",(0,i.jsx)(s.N,{color:"blue.500",fontSize:"sm",fontWeight:"medium",target:"_blank",href:"https://docs.datarecce.io/configure-diff/",children:"docs"})," ","for configuration details"]})})]})]})]})}async function tT(e){return(await v.g.post("/api/cll",e)).data}var tF=t(12748);let tN=e=>{let{menuItems:n,open:t,onClose:l,x:s,y:r}=e;return(0,i.jsx)(A.il,{open:t,onOpenChange:l,children:(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsx)(A.rm,{fontSize:"10pt",position:"absolute",width:"250px",style:{left:"".concat(s,"px"),top:"".concat(r,"px")},children:0===n.length?(0,i.jsx)(A.Dr,{value:"no-action",disabled:!0,children:"No action available"},"no action"):n.map(e=>{let{isSeparator:n,label:t,isDisabled:s,action:r,itemIcon:o}=e;return n?(0,i.jsx)(A.bX,{},t):(0,i.jsxs)(A.Dr,{value:String(t),disabled:s,onClick:()=>{r&&r(),l()},children:[o," ",t]},t)})})})})})},tA=e=>{var n,t,l,s,o,a,c,d,u,h,x;let{isOpen:p,onClose:m,x:f,y:j,node:g}=e,v=[],{selectParentNodes:y,selectChildNodes:b,getNodeColumnSet:w,selectMode:k,cll:C,showColumnLevelLineage:_}=et(),{runAction:S}=(0,G.tr)(),{featureToggles:z}=(0,ee.c)(),{isActionAvailable:E}=(0,H.cE)(),{data:I}=(0,ny.T)(),D=null!=(t=null==I?void 0:I.single_env_onboarding)&&t,R=z.disableDatabaseQuery,{primaryKey:T}=(0,nj.Ay)(null==g||null==(n=g.data)?void 0:n.name),{setSqlQuery:F,setPrimaryKeys:N}=(0,nf.vr)(),[,A]=(0,eE.zy)();if(!(null==g?void 0:g.data))return(0,i.jsx)(i.Fragment,{});let q=g.data,L=q.resourceType,M=Array.from(w(g.id)),O={source:"lineage_model_node"};if("modified"===q.changeStatus&&v.push({label:"Show Impact Radius",itemIcon:(0,i.jsx)(ef.JwZ,{}),action:()=>{_({node_id:g.id,change_analysis:!0,no_upstream:!0})}}),!k&&L&&["model","seed","snapshot"].includes(L)){v.length>0&&v.push({label:"select group one",isSeparator:!0});let e=(0,e_.C)(D?"query":"query_diff"),n=n9(Object.keys(null!=(o=null==(l=q.data.base)?void 0:l.columns)?o:{}),Object.keys(null!=(a=null==(s=q.data.current)?void 0:s.columns)?a:{})),t='select * from {{ ref("'.concat(q.name,'") }}');if(n.length&&(t="select \n  ".concat(n.join("\n  "),'\nfrom {{ ref("').concat(q.name,'") }}')),v.push({label:"Query",itemIcon:(0,i.jsx)(r.I,{as:null==e?void 0:e.icon}),isDisabled:R,action:()=>{F(t),E("query_diff_with_primary_key")&&N(void 0!==T?[T]:void 0),A("/query")}}),M.length>0)if(void 0!==C){let n=new Set;T&&n.add(T),M.forEach(e=>{n.add(e)}),v.push({label:"Query Related Columns",itemIcon:(0,i.jsx)(r.I,{as:null==e?void 0:e.icon}),isDisabled:R,action:()=>{F("select \n  ".concat(Array.from(n).join(",\n  "),'\nfrom {{ ref("').concat(q.name,'") }}')),E("query_diff_with_primary_key")&&N(void 0!==T?[T]:void 0),A("/query")}})}else{let n=Object.entries(null!=(d=null==(c=q.change)?void 0:c.columns)?d:{}).filter(e=>{let[,n]=e;return"modified"===n}).map(e=>{let[n]=e;return n});if(n.length>0){let t=new Set;T&&t.add(T),n.forEach(e=>{t.add(e)}),v.push({label:"Query Modified Columns",itemIcon:(0,i.jsx)(r.I,{as:null==e?void 0:e.icon}),isDisabled:R,action:()=>{F("select \n  ".concat(Array.from(t).join(",\n  "),'\nfrom {{ ref("').concat(q.name,'") }}')),E("query_diff_with_primary_key")&&N(void 0!==T?[T]:void 0),A("/query")}})}}e=(0,e_.C)(D?"row_count":"row_count_diff"),v.push({label:null!=(u=null==e?void 0:e.title)?u:"Row count",itemIcon:(0,i.jsx)(r.I,{as:null==e?void 0:e.icon}),isDisabled:R,action:()=>{S(D?"row_count":"row_count_diff",{node_names:[q.name]},{showForm:!1,trackProps:O})}}),e=(0,e_.C)(D?"profile":"profile_diff"),v.push({label:null!=(h=null==e?void 0:e.title)?h:"Profile",itemIcon:(0,i.jsx)(r.I,{as:null==e?void 0:e.icon}),isDisabled:R,action:()=>{let e=Array.from(w(g.id));S(D?"profile":"profile_diff",{model:q.name,columns:e},{showForm:!0,trackProps:O})}}),D||(e=(0,e_.C)("value_diff"),v.push({label:null!=(x=null==e?void 0:e.title)?x:"Value Diff",itemIcon:(0,i.jsx)(r.I,{as:null==e?void 0:e.icon}),isDisabled:R,action:()=>{let e=Array.from(w(g.id));S("value_diff",{model:q.name,columns:e},{showForm:!0,trackProps:O})}}))}return D||(v.length>0&&v.push({label:"select group two",isSeparator:!0}),v.push({label:"Select Parent Nodes",itemIcon:(0,i.jsx)(tF.iXB,{}),action:()=>{y(g.id,1)}}),v.push({label:"Select Child Nodes",itemIcon:(0,i.jsx)(tF.pnF,{}),action:()=>{b(g.id,1)}}),v.push({label:"Select All Upstream Nodes",itemIcon:(0,i.jsx)(tF.iXB,{}),action:()=>{y(g.id)}}),v.push({label:"Select All Downstream Nodes",itemIcon:(0,i.jsx)(tF.pnF,{}),action:()=>{b(g.id)}})),(0,i.jsx)(tN,{x:f,y:j,menuItems:v,open:p,onClose:m})},tq=e=>{var n,t,l,s,o,a,c,d;let{isOpen:u,onClose:h,x,y:p,node:m}=e,f=[],{runAction:j}=(0,G.tr)(),{isActionAvailable:g}=(0,H.cE)(),{featureToggles:v}=(0,ee.c)(),{data:y}=(0,ny.T)(),b=null!=(o=null==y?void 0:y.single_env_onboarding)&&o,w=v.disableDatabaseQuery;if((null==m?void 0:m.data)===void 0)return(0,i.jsx)(i.Fragment,{});let k=m.data,C=k.node,_=k.column,S=k.type,z={source:"lineage_column_node"},E=(null==(t=C.data.base)||null==(n=t.columns)?void 0:n[_])===void 0||(null==(s=C.data.current)||null==(l=s.columns)?void 0:l[_])===void 0,I=(0,e_.C)(b?"profile":"profile_diff");return f.push({label:null!=(a=null==I?void 0:I.title)?a:"Profile",itemIcon:(0,i.jsx)(r.I,{as:null==I?void 0:I.icon}),action:()=>{j("profile_diff",{model:C.name,columns:[_]},{showForm:!1,trackProps:z})},isDisabled:E||!g("profile_diff")||w}),b||(I=(0,e_.C)("histogram_diff"),f.push({label:null!=(c=null==I?void 0:I.title)?c:"Histogram Diff",itemIcon:(0,i.jsx)(r.I,{as:null==I?void 0:I.icon}),action:()=>{j("histogram_diff",{model:C.name,column_name:_,column_type:S},{showForm:!1,trackProps:z})},isDisabled:E||!S||!(0,Y.c)(S)||w}),I=(0,e_.C)("top_k_diff"),f.push({label:null!=(d=null==I?void 0:I.title)?d:"Top-K Diff",itemIcon:(0,i.jsx)(r.I,{as:null==I?void 0:I.icon}),action:()=>{j("top_k_diff",{model:C.name,column_name:_,k:50},{showForm:!1,trackProps:z})},isDisabled:E||w})),(0,i.jsx)(tN,{x:x,y:p,menuItems:f,open:u,onClose:h})},tL=e=>{let{isOpen:n,onClose:t,x:l,y:s,node:r}=e,{featureToggles:o}=(0,ee.c)();return o.disableViewActionDropdown?(0,i.jsx)(tN,{menuItems:[],open:n,onClose:t,x:l,y:s}):(null==r?void 0:r.type)==="customNode"?(0,i.jsx)(tA,{x:l,y:s,isOpen:n,onClose:t,node:r}):(null==r?void 0:r.type)==="customColumnNode"?(0,i.jsx)(tq,{x:l,y:s,isOpen:n,onClose:t,node:r}):void 0},tM=()=>{let{open:e,onClose:n,onOpen:t}=(0,T.j)(),[i,l]=(0,j.useState)({x:0,y:0}),[s,r]=(0,j.useState)();return{props:{x:i.x,y:i.y,node:s,isOpen:e,onClose:n},showContextMenu:(e,n,i)=>{l({x:e,y:n}),r(i),t()},closeContextMenu:()=>{l({x:0,y:0}),r(void 0),n()}}},tO={customNode:function(e){var n,t,s,o;let{data:a}=e,{id:d,resourceType:u,changeStatus:x}=a,m=(0,e8.Pj)(e=>e.transform[2]>.3),{icon:f}=ek(u),[g,v]=(0,j.useState)(!1),{interactive:y,selectNode:b,selectMode:w,focusedNode:k,getNodeAction:C,getNodeColumnSet:_,isNodeHighlighted:S,isNodeSelected:z,isNodeShowingChangeAnalysis:I,showContextMenu:D,viewOptions:R,cll:T,showColumnLevelLineage:F}=et(),N=null==T||null==(n=T.current.nodes[d])?void 0:n.change_category,A=S(d),q=z(d),L=(null==(t=R.column_level_lineage)?void 0:t.node_id)===d&&void 0===R.column_level_lineage.column,M=(null==k?void 0:k.id)===d||L,O=I(d),{icon:P,color:X,backgroundColor:K}=x?ew(x):{icon:void 0,color:"gray.400",backgroundColor:"gray.100"},Q=a.name,$=_(a.id),W=$.size>0,V="action_result"===w?C(a.id):void 0,B=m?"selecting"===w?q?X:"white":"action_result"!==w?M||q||g?K:"white":V?M||q||g?K:X:"white":M||q||g?X:K,H="selecting"===w?q?"white":"inherit":"action_result"===w&&V&&!q?"white":"inherit",U="selecting"===w?q?"white":"inherit":"action_result"===w&&V&&!q?"white":"inherit",G="selecting"===w?q?"white":X:"action_result"===w?V&&!q?"white":"inherit":X;return(0,i.jsxs)(c.s,{cursor:"selecting"===w?"pointer":"inherit",direction:"column",width:"300px",transition:"box-shadow 0.2s ease-in-out",padding:0,filter:"action_result"===w?V?"none":"opacity(0.2) grayscale(50%)":A||M||q||g?"none":"opacity(0.2) grayscale(50%)",onMouseEnter:()=>{v(!0)},onMouseLeave:()=>{v(!1)},children:[(0,i.jsxs)(c.s,{borderColor:X,borderWidth:"2px",borderTopRadius:8,borderBottomRadius:8*!W,backgroundColor:B,height:"60px",children:[(0,i.jsx)(c.s,{bg:X,padding:y?"8px":"2px",borderRightWidth:"2px",borderColor:"selecting"===w?"#00000020":X,alignItems:"top",visibility:m?"inherit":"hidden",children:y&&(0,i.jsx)(nx,{checked:"selecting"===w&&q||"action_result"===w&&!!V,onClick:e=>{"action_result"!==w&&(e.stopPropagation(),b(a.id))}})}),(0,i.jsxs)(c.s,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:[(0,i.jsxs)(c.s,{width:"100%",textAlign:"left",fontWeight:"600",flex:"1",p:1,gap:"5px",alignItems:"center",visibility:m?"inherit":"hidden",children:[(0,i.jsx)(np,{name:Q,color:H,resourceType:u}),g?(0,i.jsxs)(i.Fragment,{children:["modified"===x&&(0,i.jsx)(el.m,{content:"Show Impact Radius",positioning:{placement:"top"},openDelay:500,children:(0,i.jsx)(E.o,{children:(0,i.jsx)(r.I,{boxSize:"14px",as:ef.JwZ,color:"gray",cursor:"pointer",_hover:{color:"black"},onClick:e=>{e.preventDefault(),e.stopPropagation(),F({node_id:d,change_analysis:!0,no_upstream:!0})}})})}),(0,i.jsx)(r.I,{as:Z.EUt,color:"gray",cursor:"pointer",_hover:{color:"black"},onClick:n=>{n.preventDefault(),n.stopPropagation(),D(n,e)}})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.I,{boxSize:"16px",color:U,as:f}),x&&(0,i.jsx)(r.I,{color:G,as:P})]})]}),(0,i.jsx)(c.s,{flex:"1 0 auto",mx:"1",direction:"column",paddingBottom:"1",visibility:m?"inherit":"hidden",children:(0,i.jsx)(h.z,{gap:"8px",children:V?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.h,{}),(0,i.jsx)(nc,{node:a,action:V})]}):O?(0,i.jsx)(l.a,{height:"20px",color:"gray",fontSize:"9pt",margin:0,fontWeight:600,children:N?nu[N]:""}):"action_result"!==w&&"model"===a.resourceType?(0,i.jsx)(nh,{id:a.id,inverted:"selecting"===w&&!!q}):(0,i.jsx)(i.Fragment,{})})})]})]}),W&&(0,i.jsx)(l.a,{p:"10px 10px",borderColor:X,borderWidth:"2px",borderTopWidth:0,borderBottomRadius:8,children:(0,i.jsx)(l.a,{height:"".concat($.size*e4.$M,"px"),overflow:"auto"})}),Object.keys(null!=(s=a.parents)?s:{}).length>0&&(0,i.jsx)(e8.h7,{type:"target",position:e8.yX.Left,isConnectable:!1}),Object.keys(null!=(o=a.children)?o:{}).length>0&&(0,i.jsx)(e8.h7,{type:"source",position:e8.yX.Right,isConnectable:!1})]})},customColumnNode:function(e){var n,t;let{id:s,data:o}=e,{id:a}=o.node,{column:d,type:u,transformationType:h,changeStatus:x}=o,m=(0,e8.Pj)(e=>e.transform[2]>.3),{viewOptions:f,showContextMenu:g,isNodeHighlighted:v,isNodeShowingChangeAnalysis:y}=et(),b=null==(n=f.column_level_lineage)?void 0:n.node_id,w=d===(null==(t=f.column_level_lineage)?void 0:t.column)&&a===b,[k,C]=j.useState(!1),_=v(s),S=y(a);return m?(0,i.jsxs)(c.s,{width:"280px",padding:"0px 10px",border:"1px solid gray",backgroundColor:w?"#f0f0f0":"inherit",_hover:{backgroundColor:"#f0f0f0"},onMouseEnter:()=>{C(!0)},onMouseLeave:()=>{C(!1)},filter:_?"none":"opacity(0.2) grayscale(50%)",cursor:"pointer",children:[(0,i.jsxs)(c.s,{fontSize:"11px",color:"black",width:"100%",gap:"3px",alignItems:"center",height:"".concat(e4.$M-1,"px"),children:[S&&x?(0,i.jsx)(tC,{changeStatus:x}):(0,i.jsx)(t_,{transformationType:h}),(0,i.jsx)(l.a,{height:"".concat(e4.$M+1,"px"),children:d}),(0,i.jsx)(p.h,{}),k?(0,i.jsx)(r.I,{as:Z.EUt,boxSize:"14px",display:"inline-flex",cursor:"pointer",_hover:{color:"black"},onClick:n=>{n.preventDefault(),n.stopPropagation(),g(n,e)}}):(0,i.jsx)(l.a,{height:"".concat(e4.$M+1," px"),children:u})]}),(0,i.jsx)(e8.h7,{type:"target",position:e8.yX.Left,isConnectable:!1,style:{left:0,visibility:"hidden"}}),(0,i.jsx)(e8.h7,{type:"source",position:e8.yX.Right,isConnectable:!1,style:{right:0,visibility:"hidden"}})]}):(0,i.jsx)(i.Fragment,{})}},tP=[],tX={customEdge:function(e){let{source:n,target:t,sourceX:l,sourceY:s,targetX:r,targetY:o,sourcePosition:a,targetPosition:c,style:d={},markerEnd:u,data:h}=e,x={...d},{isEdgeHighlighted:p}=et();(null==h?void 0:h.changeStatus)&&(x.stroke=ew(h.changeStatus).hexColor,x.strokeDasharray="5"),p(n,t)||(x.filter="opacity(0.2) grayscale(50%)");let[m]=(0,e8.Fp)({sourceX:l,sourceY:s,sourcePosition:a,targetX:r,targetY:o,targetPosition:c});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(e8.tE,{path:m,markerEnd:u,style:{...x,...d}})})}},tK=e=>e.data.changeStatus?ew(e.data.changeStatus).hexColor:"lightgray",tQ=(e,n)=>{let t=e.current,i=(0,j.useRef)({width:0,height:0});(0,j.useEffect)(()=>{let e=new ResizeObserver(e=>{for(let t of e){let e=t.contentRect.width,l=t.contentRect.height;(Math.abs(l-i.current.height)>10||Math.abs(e-i.current.width)>10)&&i.current.height>0&&l>0&&i.current.width>0&&e>0&&n(),i.current={width:e,height:l}}});return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[t,i,n])},t$=()=>{let[,e]=(0,eE.zy)();return(0,j.useCallback)(n=>{n.check_id&&e("/checks/".concat(n.check_id))},[e])},tW=(0,j.forwardRef)(function(e,n){var t;let{interactive:s=!1,...o}=e,a=(0,e8.VH)(),d=(0,j.useRef)(null),{successToast:u,failToast:h}=eF(),{copyToClipboard:p,ImageDownloadModal:m,ref:f}=nI({renderLibrary:"html-to-image",imageType:"png",shadowEffect:!0,backgroundColor:"white",ignoreElements:e=>e.className.includes(nE),onSuccess:()=>{u("Copied the Lineage View as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),h("Failed to copy image to clipboard",e)}}),[g,v,y]=(0,e8.ck)(tP),[w,k,C]=(0,e8.fM)([]),{lineageGraph:_,retchLineageGraph:S,isLoading:z,error:D,refetchRunsAggregated:R}=(0,H.cE)(),{data:T}=(0,ny.T)(),{runId:F,showRunId:N,closeRunResult:A,runAction:q,isRunResultOpen:L}=(0,G.tr)(),{run:O}=nb(F),[P,X]=(0,j.useState)({...o.viewOptions}),K=(0,j.useRef)([]).current,[Q,$]=(0,j.useState)(void 0),W=(0,B.n)({mutationFn:tT}),[Z,V]=(0,j.useState)({}),U=e=>g.find(n=>n.data.name===e);(0,j.useImperativeHandle)(n,()=>({copyToClipboard:p}));let Y=(0,j.useMemo)(()=>!!_&&_.modifiedSet.length>0,[_]),ee=null!=(t=P.view_mode)?t:"changed_models",et=(0,j.useMemo)(()=>g.filter(e=>"customNode"===e.type).map(e=>e.id),[g]),ei=(0,j.useMemo)(()=>_?et.map(e=>_.nodes[e]):[],[_,et]),[el,es]=(0,j.useState)(),er=el?null==_?void 0:_.nodes[el]:void 0,[eo,ea]=(0,j.useState)(),[ec,ed]=(0,j.useState)(new Set),eh=(0,j.useMemo)(()=>_?Array.from(ec).map(e=>_.nodes[e]):[],[_,ec]),ep=tg(eh.length>0?eh:ei,{onActionStarted:()=>{ea("action_result")},onActionNodeUpdated:e=>{v(n=>n.map(n=>n.id===e.id?{...n}:n))},onActionCompleted:()=>{}}),em=(0,j.useMemo)(()=>{if(!_)return new Set;let e=new Set;if(Q){for(let[n,t]of Object.entries(Q.current.nodes))!1!==t.impacted&&e.add(n);for(let n of Object.keys(Q.current.columns))e.add(n)}else e="action_result"===eo?new Set(Object.keys(ep.actionState.actions)):er?(0,tx.KC)((0,e4.Qf)(_,[er.id]),(0,e4.Ve)(_,[er.id])):Y?(0,e4.Ve)(_,_.modifiedSet):new Set(et);return new Set(e)},[_,Q,eo,er,Y,ep.actionState.actions,et]),ef=tM();(0,j.useLayoutEffect)(()=>{(async()=>{var e,n,t,i;let l,s;if(!_)return;if(P.node_ids)s=P.node_ids;else{let t=null==(e=_.manifestMetadata.current)?void 0:e.project_name,i={view_mode:null!=(n=P.view_mode)?n:Y?"changed_models":"all",packages:t?[t]:void 0,...o.viewOptions};try{s=(await eu({select:i.select,exclude:i.exclude,packages:i.packages,view_mode:i.view_mode})).nodes}catch(e){i.view_mode="all",s=(await eu({select:i.select,exclude:i.exclude,packages:i.packages,view_mode:i.view_mode})).nodes}X(i)}if(P.column_level_lineage)try{l=await W.mutateAsync(P.column_level_lineage)}catch(e){if(e instanceof tf.pe)return void eT.X.create({title:"Column Level Lineage error",description:null!=(i=null==(t=e.response)?void 0:t.data.detail)?i:e.message,type:"error",closable:!0})}let[r,a,c]=(0,e4.X2)(_,{selectedNodes:s,cll:l});(0,e4.Zp)(r,a),v(r),k(a),V(c),$(l)})()},[_]);let ej=()=>{es(void 0)},eg=e=>{let n=g.find(n=>n.id===e);if(n){if(n.parentId){var t;let e=n.parentId;n=null!=(t=g.find(n=>n.id===e))?t:n}if(n.width&&n.height){let e=n.position.x+n.width/2,t=n.position.y+n.height/2,i=a.getZoom();a.setCenter(e,t,{zoom:i,duration:200})}}},ev=t$();tQ(d,()=>{"selecting"!==eo&&(el?eg(el):a.fitView({nodes:g,duration:200}))});let ey=async function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=P.column_level_lineage;await e_({...P,column_level_lineage:e},!1),n||K.push(t),(null==e?void 0:e.node_id)?es(e.node_id):es(void 0)},eb=async e=>{if(e){if(0===K.length)return;let e=K.pop();e?await ey(e,!0):await ey(void 0,!0)}else await ey(void 0,!0)},ew=(e,n)=>{eo||ey({node_id:n.data.node.id,column:n.data.column})},ek=(e,n)=>{if(s&&_){if("customColumnNode"===n.type)return void ew(e,n);if(ez(),eo)if("action_result"===eo){var t;let e=ep.actionState.actions[n.id];(null==(t=e.run)?void 0:t.run_id)&&N(e.run.run_id),es(n.id)}else{let e=new Set(ec);ec.has(n.id)?e.delete(n.id):e.add(n.id),ed(e),0===e.size&&ea(void 0)}else es(n.id)}},eC=async e=>{var n,t,i,l,s;let r,o,{viewOptions:c=P,fitView:d}=e;if(!_)return;if(P.select!==c.select||P.exclude!==c.exclude||P.packages!==c.packages||P.view_mode!==c.view_mode){try{let e=await eu({select:c.select,exclude:c.exclude,packages:c.packages,view_mode:c.view_mode});c.column_level_lineage=void 0,o=e.nodes}catch(e){e instanceof tf.pe&&eT.X.create({title:"Select node error",description:null!=(i=null==(t=e.response)?void 0:t.data.detail)?i:e.message,type:"error",closable:!0});return}es(void 0)}else o=g.map(e=>e.id);if(c.column_level_lineage)try{r=await W.mutateAsync(c.column_level_lineage)}catch(e){if(e instanceof tf.pe)return void eT.X.create({title:"Column Level Lineage error",description:null!=(s=null==(l=e.response)?void 0:l.data.detail)?s:e.message,type:"error",closable:!0})}let[u,h,x]=(0,e4.X2)(_,{selectedNodes:o,cll:r});v(u),k(h),V(x),$(r),(null==O||null==(n=O.params)?void 0:n.model)&&!U(O.params.model)&&A(),d&&(await new Promise(e=>setTimeout(e,1)),a.fitView({nodes:u,duration:200}))},e_=async function(e){let n=!(arguments.length>1)||void 0===arguments[1]||arguments[1];X(e),await eC({viewOptions:e,fitView:n})},eS=tv();(0,j.useEffect)(()=>{let e=null==O?void 0:O.type;if(s&&L&&!(!e||["query_diff","query","row_count"].includes(e))&&!eo){var n;let e=null==(n=O.params)?void 0:n.model,t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});if(e){let n=U(e);n?er!==n.data&&ek(t,n):e_({...P,view_mode:"all"})}else ej()}},[O,P,L,eo]);let ez=()=>{ef.closeContextMenu()},eE=(e,n)=>{if(!s||"action_result"===eo)return;e.preventDefault();let t=f.current,i=t.getBoundingClientRect(),l=e.clientX-i.left,r=e.clientY-i.top+t.offsetTop;ef.showContextMenu(l,r,n)},eI=()=>{ea(void 0),ed(new Set),es(void 0),A(),null==R||R()},eD={interactive:s,nodes:g,focusedNode:er,selectedNodes:eh,viewOptions:P,showContextMenu:eE,onViewOptionsChanged:e_,selectMode:eo,selectNode:e=>{if(eo){if("selecting"===eo){let n=new Set(ec);ec.has(e)?n.delete(e):n.add(e),ed(n),0===n.size&&ea(void 0)}}else _&&(ed(new Set([e])),ea("selecting"),es(void 0),ep.reset())},selectParentNodes:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if("action_result"===eo||void 0===_)return;!eo&&(ea("selecting"),ep.reset(),P.column_level_lineage&&e_({...P,column_level_lineage:void 0}));let t=(0,e4.Qf)(_,[e],n);ed((0,tx.KC)(ec,t))},selectChildNodes:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if("action_result"===eo||void 0===_)return;!eo&&(ea("selecting"),ep.reset(),P.column_level_lineage&&e_({...P,column_level_lineage:void 0}));let t=(0,e4.Ve)(_,[e],n);ed((0,tx.KC)(ec,t))},deselect:eI,isNodeHighlighted:e=>em.has(e),isNodeSelected:e=>ec.has(e),isEdgeHighlighted:(e,n)=>Q?e in Q.current.parent_map&&n in Q.current.parent_map[e]:em.has(e)&&em.has(n),isNodeShowingChangeAnalysis:e=>{var n;if(!_)return!1;let t=e in _.nodes?_.nodes[e]:void 0;if(null==(n=P.column_level_lineage)?void 0:n.change_analysis){let n=P.column_level_lineage;return n.node_id&&!n.column?n.node_id===e&&!!(null==t?void 0:t.changeStatus):!!(null==t?void 0:t.changeStatus)}return!1},getNodeAction:e=>ep.actionState.actions[e],getNodeColumnSet:e=>e in Z?new Set(Z[e]):new Set,runRowCount:async()=>{"selecting"===eo?(await ep.runRowCount(),(0,b.yk)({type:"row_count",selected:"multi"})):er?(q("row_count",{node_names:[er.name]},{showForm:!1,showLast:!1}),(0,b.yk)({type:"row_count",selected:"single"})):(q("row_count",{select:P.select,exclude:P.exclude,packages:P.packages,view_mode:P.view_mode}),(0,b.yk)({type:"row_count",selected:"none"}))},runRowCountDiff:async()=>{"selecting"===eo?(await ep.runRowCountDiff(),(0,b.yk)({type:"row_count_diff",selected:"multi"})):er?(q("row_count_diff",{node_names:[er.name]},{showForm:!1,showLast:!1}),(0,b.yk)({type:"row_count_diff",selected:"single"})):(q("row_count_diff",{select:P.select,exclude:P.exclude,packages:P.packages,view_mode:P.view_mode}),(0,b.yk)({type:"row_count_diff",selected:"none"}))},runValueDiff:async()=>{if(er)q("value_diff",{model:er.name},{showForm:!0,showLast:!1}),(0,b.yk)({type:"value_diff",selected:"single"});else{let e="selecting"===eo?eh.length:et.length;await eS.confirm(e)&&(await ep.runValueDiff(),(0,b.yk)({type:"value_diff",selected:"selecting"===eo?"multi":"none"}))}},addLineageDiffCheck:async()=>{let e;"selecting"===eo?(e=await ep.addLineageDiffCheck(),eI(),(0,b.yk)({type:"lineage_diff",selected:"multi"})):er||(e=await tp(P),(0,b.yk)({type:"lineage_diff",selected:"none"})),e&&ev(e)},addSchemaDiffCheck:async()=>{let e;"selecting"===eo?eh.length>0&&(e=await ep.addSchemaDiffCheck(),eI(),(0,b.yk)({type:"schema_diff",selected:"multi"})):er?(e=await ng({node_id:er.id}),(0,b.yk)({type:"schema_diff",selected:"single"})):(e=await ng({select:P.select,exclude:P.exclude,packages:P.packages,view_mode:P.view_mode}),(0,b.yk)({type:"schema_diff",selected:"none"})),e&&ev(e)},cancel:ep.cancel,actionState:ep.actionState,centerNode:eg,cll:Q,showColumnLevelLineage:ey,resetColumnLevelLineage:eb};return z?(0,i.jsx)(c.s,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:(0,i.jsx)(J.y,{size:"xl"})}):D?(0,i.jsx)(E.o,{h:"100%",children:(0,i.jsxs)(I.T,{children:[(0,i.jsx)(l.a,{children:"Failed to load lineage data. This could be because the server has been terminated or there is a network error."}),(0,i.jsxs)(l.a,{children:["[Reason: ",D,"]"]}),(0,i.jsx)(M.$,{colorPalette:"blue",onClick:()=>{S&&S()},children:"Retry"})]})}):_&&g!=tP?"changed_models"!==ee||_.modifiedSet.length?(0,i.jsxs)(en.Provider,{value:eD,children:[(0,i.jsxs)(ex,{sizes:er?[70,30]:[100,0],minSize:400*!!er,gutterSize:5*!!er,style:{height:"100%",width:"100%"},children:[(0,i.jsxs)(I.T,{ref:d,separator:(0,i.jsx)(e3.k,{borderColor:"gray.200"}),gap:0,style:{contain:"strict"},position:"relative",children:[s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(th,{}),(0,i.jsx)(tk,{})]}),(0,i.jsxs)(e8.Gc,{proOptions:{hideAttribution:!0},nodeTypes:tO,edgeTypes:tX,nodes:g,edges:w,onNodesChange:y,onEdgesChange:C,onNodeClick:ek,onNodeContextMenu:eE,onClick:ez,onInit:()=>{if(Y)a.fitView();else{let e=(0,e8.Jo)(g);a.setCenter(e.x+e.width/2,e.y+e.height/2,{zoom:1})}},maxZoom:1,minZoom:.1,nodesDraggable:s,ref:f,children:[(0,i.jsx)(e7.V,{color:"#ccc"}),(0,i.jsx)(e6.H,{showInteractive:!1,position:"top-right",className:nE,children:(0,i.jsx)(e6.a,{title:"copy image",onClick:async()=>{await p(),(0,b.uH)({type:ee,from:"lineage_view"})},children:(0,i.jsx)(r.I,{as:nn.nxz})})}),(0,i.jsx)(m,{}),(0,i.jsx)(e8.Zk,{position:"bottom-left",children:(0,i.jsxs)(c.s,{direction:"column",gap:"5px",children:[Y&&(0,i.jsx)(tm,{}),P.column_level_lineage&&(0,i.jsx)(tE,{})]})}),(0,i.jsx)(e8.Zk,{position:"top-center",children:(0,i.jsx)(tI,{notification:(null==T?void 0:T.single_env_onboarding)?(0,i.jsx)(tR,{}):null,type:"info"})}),(0,i.jsx)(e8.Zk,{position:"top-left",children:(0,i.jsxs)(c.s,{direction:"column",gap:"5px",children:[(0,i.jsx)(tz,{action:W}),0==g.length&&(0,i.jsx)(x.E,{fontSize:"xl",color:"grey",opacity:.5,children:"No nodes"})]})}),(0,i.jsx)(e9.o,{nodeColor:tK,nodeStrokeWidth:3,zoomable:!0,pannable:!0}),"action_result"===eo&&(0,i.jsx)(e8.Zk,{position:"bottom-center",className:nE,children:(0,i.jsx)(tn,{onClose:()=>{eI()}})})]}),(0,i.jsx)(tL,{...ef.props})]}),er?(0,i.jsx)(l.a,{borderLeft:"solid 1px lightgray",height:"100%",children:(0,i.jsx)(te,{node:er,onCloseNode:ej})}):(0,i.jsx)(l.a,{})]}),eS.AlertDialog]}):(0,i.jsx)(E.o,{h:"100%",children:(0,i.jsxs)(I.T,{children:[(0,i.jsx)(i.Fragment,{children:"No change detected"}),(0,i.jsx)(M.$,{colorPalette:"blue",onClick:async()=>{await e_({...P,view_mode:"all"})},children:"Show all nodes"})]})}):(0,i.jsx)(i.Fragment,{})}),tZ=(0,j.forwardRef)(function(e,n){let{check:t}=e,l={...t.params,...t.view_options};return(0,i.jsx)(c.s,{direction:"column",height:"100%",children:(0,i.jsx)(e8.Ln,{children:(0,i.jsx)(tW,{viewOptions:l,interactive:!1,ref:n})})})});function tV(e){let{yamlTemplate:n}=e;return(0,i.jsx)(eL.KE,{height:"300px",language:"yaml",theme:"vs",value:n,options:{readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})}function tB(){return{markedAsApprovedToast:function(){eT.X.create({title:"Marked as approved",type:"success",duration:2e3})}}}function tH(){let e=(0,R._)(["\n  <details><summary>","</summary>\n\n  ","\n\n  </details>"]);return tH=function(){return e},e}let tU=(e,n)=>"schema_diff"!==e&&"lineage_diff"!==e&&(!(null==n?void 0:n.result)||!!n.error),tG=e=>{var n,t,s,o,a,d,f,v,w,k,z,D,R;let{checkId:Q,refreshCheckList:$}=e,{featureToggles:H}=(0,ee.c)(),U=(0,V.jE)(),[,G]=(0,eE.zy)(),{successToast:J,failToast:Y}=eF(),{markedAsApprovedToast:en}=tB(),[et,ei]=(0,j.useState)(),[es]=(0,j.useState)(),[er,eo]=(0,j.useState)(!1),[ea,ec]=(0,j.useState)(""),{open:ed,onOpen:eu,onClose:eh}=(0,T.j)(),ex=()=>(0,i.jsx)(F.Xi,{bg:"blackAlpha.300",backdropFilter:"blur(10px) "}),[em,ef]=(0,j.useState)((0,i.jsx)(ex,{})),{isLoading:ej,error:eg,data:ev}=(0,g.I)({queryKey:y.X.check(Q),queryFn:async()=>C(Q),refetchOnMount:!0}),ey=null!=et?et:null==ev||null==(n=ev.last_run)?void 0:n.run_id,{run:eb,error:ew}=nb(ey),ek=et?!eb||"running"===eb.status:(null==eb?void 0:eb.status)==="running",eC=(null==ev?void 0:ev.type)?(0,e_.C)(ev.type):void 0,eS=null!=(d=null==ev?void 0:ev.is_preset)&&d,eI=(0,j.useRef)(null),{mutate:eT}=(0,B.n)({mutationFn:e=>_(Q,e),onSuccess:async()=>{await U.invalidateQueries({queryKey:y.X.check(Q)}),await U.invalidateQueries({queryKey:y.X.checks()})}}),{mutate:eq}=(0,B.n)({mutationFn:()=>S(Q),onSuccess:async()=>{await U.invalidateQueries({queryKey:y.X.checks()}),G("/checks")}}),eL=(0,j.useCallback)(async()=>{(null==ev?void 0:ev.type)&&(ei((await (0,eY.gM)(Q,{nowait:!0})).run_id),await U.invalidateQueries({queryKey:y.X.check(Q)}),$&&$())},[ev,Q,ei,U,$]),eM=(0,j.useCallback)(async()=>{if(eo(!0),ey)return await (0,eY.Su)(ey)},[ey]),eO=async()=>{if(!ev)return;let e=function(e){return(0,eR.mi)(tH(),"".concat(e.is_checked?"✅ ":"").concat(e.name),function(e){if("query"===e.type||"query_diff"===e.type){var n;return"".concat(eA(e),"\n\n").concat((0,eR.dx)(eN(),null==(n=e.params)?void 0:n.sql_template))}return eA(e)}(e))}(ev);if(!window.isSecureContext)return void Y("Failed to copy the check to clipboard",Error("Copy to clipboard is available only in secure contexts (HTTPS)"));try{await navigator.clipboard.writeText(e),J("Copied the check to the clipboard")}catch(e){Y("Failed to copy the check to clipboard",e)}},eP=(0,j.useCallback)(()=>{let e=null==ev?void 0:ev.is_checked;eT({is_checked:!e}),e||en()},[null==ev?void 0:ev.is_checked,eT,en]),[eX,eK]=(0,j.useState)("result"),{ref:eQ,onCopyToClipboard:e$,onMouseEnter:eW,onMouseLeave:eZ}=nD();if((0,j.useEffect)(()=>{var e,n,t;ec(function(e){let{name:n,description:t,type:i,params:l,viewOptions:s}=e,r={name:n,description:t,type:i,params:l};return s&&(r.view_options=s),nw.Ay.stringify({checks:[r]})}({name:null!=(e=null==ev?void 0:ev.name)?e:"",description:null!=(n=null==ev?void 0:ev.description)?n:"",type:null!=(t=null==ev?void 0:ev.type)?t:"",params:null==ev?void 0:ev.params,viewOptions:null==ev?void 0:ev.view_options}))},[ev]),ej)return(0,i.jsx)(E.o,{h:"100%",children:"Loading"});if(eg)return(0,i.jsxs)(E.o,{h:"100%",children:["Error: ",eg.message]});let eV=(null==eb?void 0:eb.run_at)?(0,e2.m)(new Date(eb.run_at),{addSuffix:!0}):null;return(0,i.jsxs)(ep,{minSize:100,sizes:[30,70],style:{height:"100%",width:"100%",maxHeight:"100%"},children:[(0,i.jsxs)(l.a,{style:{contain:"strict"},display:"flex",flexDirection:"column",children:[(0,i.jsxs)(c.s,{p:"0px 16px",alignItems:"center",h:"40px",children:[(0,i.jsx)(W,{name:null!=(f=null==ev?void 0:ev.name)?f:"",setName:e=>{eT({name:e})}}),eS&&(0,i.jsx)(el.m,{content:"Preset Check defined in recce config",children:(0,i.jsxs)(N.f8,{size:"sm",flex:"0 0 auto",ml:"2",children:[(0,i.jsx)(N.FV,{children:(0,i.jsx)(X.NaU,{size:"14px"})}),(0,i.jsx)(N.d1,{children:"Preset"})]})}),(0,i.jsx)(p.h,{}),(0,i.jsxs)(h.z,{mr:"10px",children:[eV&&(0,i.jsx)(l.a,{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontSize:"10pt",children:eV}),(0,i.jsxs)(A.il,{children:[(0,i.jsx)(A.cQ,{asChild:!0,children:(0,i.jsx)(q.K,{rounded:"full",variant:"ghost",size:"sm",children:(0,i.jsx)(r.I,{as:Z.EUt})})}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(A.y3,{children:(0,i.jsxs)(A.rm,{children:[(0,i.jsx)(A.Dr,{value:"preset-check-template",onClick:()=>{ef((0,i.jsx)(ex,{})),eu()},children:(0,i.jsxs)(c.s,{alignItems:"center",gap:1,textStyle:"sm",children:[(0,i.jsx)(K.EFr,{})," Get Preset Check Template"]})}),(0,i.jsx)(A.Dr,{value:"copy-markdown",onClick:()=>eO(),children:(0,i.jsxs)(c.s,{alignItems:"center",gap:1,textStyle:"sm",children:[(0,i.jsx)(nl.hX7,{})," Copy Markdown"]})}),(0,i.jsx)(A.bX,{}),(0,i.jsx)(A.Dr,{value:"delete",color:"red.solid",onClick:()=>{eq()},disabled:H.disableUpdateChecklist,children:(0,i.jsxs)(c.s,{alignItems:"center",gap:1,textStyle:"sm",children:[(0,i.jsx)(nl.tS8,{})," Delete"]})})]})})})]}),(0,i.jsx)(el.m,{content:tU(null!=(v=null==ev?void 0:ev.type)?v:"",eb)?"Run the check first":(null==ev?void 0:ev.is_checked)?"Mark as Pending":"Mark as Approved",positioning:{placement:"bottom-end"},children:(0,i.jsxs)(M.$,{flex:"0 0 auto",size:"sm",colorPalette:(null==ev?void 0:ev.is_checked)?"green":"gray",variant:(null==ev?void 0:ev.is_checked)?"solid":"outline",onClick:()=>{eP()},disabled:tU(null!=(w=null==ev?void 0:ev.type)?w:"",eb)||H.disableUpdateChecklist,children:[(null==ev?void 0:ev.is_checked)?(0,i.jsx)(nl.Ykz,{}):(0,i.jsx)(r.I,{as:Z.MKj,color:"lightgray"})," ",(null==ev?void 0:ev.is_checked)?"Approved":"Mark as Approved"]})})]})]}),(0,i.jsx)(l.a,{flex:"1",p:"8px 16px",minHeight:"100px",children:(0,i.jsx)(eD,{value:null==ev?void 0:ev.description,onChange:e=>{eT({description:e})}},null==ev?void 0:ev.check_id)})]}),(0,i.jsx)(l.a,{style:{contain:"strict"},children:(0,i.jsxs)(m.pK,{height:"100%",display:"flex",flexDirection:"column",value:eX,onValueChange:e=>{eK(e.value)},children:[(0,i.jsxs)(m.j7,{height:"50px",children:[(0,i.jsx)(m.Xi,{value:"result",fontSize:"0.75rem",children:"Result"}),((null==ev?void 0:ev.type)==="query"||(null==ev?void 0:ev.type)==="query_diff")&&(0,i.jsx)(m.Xi,{value:"query",fontSize:"0.75rem",children:"Query"}),(0,i.jsx)(p.h,{}),(0,i.jsxs)(h.z,{mr:"10px",children:[(null==eC?void 0:eC.RunResultView)&&(0,i.jsx)(el.m,{content:"Rerun",children:(0,i.jsxs)(M.$,{variant:"outline",loading:ek,size:"sm",onClick:()=>eL(),disabled:H.disableDatabaseQuery,children:[(0,i.jsx)(nl.fZv,{})," Rerun"]})}),(0,i.jsxs)(M.$,{variant:"outline",disabled:tU(null!=(k=null==ev?void 0:ev.type)?k:"",eb)||"result"!==eX,onMouseEnter:eW,onMouseLeave:eZ,size:"sm",onClick:async()=>{var e,n;(null==ev?void 0:ev.type)==="lineage_diff"?null==(e=eI.current)||e.copyToClipboard():await e$(),(0,b.uH)({type:null!=(n=null==ev?void 0:ev.type)?n:"unknown",from:"check"})},children:[(0,i.jsx)(nl.hX7,{})," Copy to Clipboard"]})]})]}),(0,i.jsxs)(m.T$,{height:"100%",flex:"1",style:{contain:"strict"},children:[(0,i.jsxs)(m.av,{value:"result",p:0,width:"100%",height:"100%",children:[(null==eC?void 0:eC.RunResultView)&&((null==ev?void 0:ev.last_run)||ey?(0,i.jsx)(e5,{ref:eQ,isRunning:ek,isAborting:er,run:ey?eb:null==ev?void 0:ev.last_run,error:ew,progress:es,RunResultView:eC.RunResultView,viewOptions:null==ev?void 0:ev.view_options,onViewOptionsChanged:e=>{eT({view_options:e})},onCancel:eM,onExecuteRun:eL}):(0,i.jsx)(E.o,{bg:"rgb(249,249,249)",height:"100%",children:(0,i.jsxs)(I.T,{gap:4,children:[(0,i.jsx)(l.a,{children:"This action is part of the initial preset and has not been performed yet. Once performed, the result will be shown here."}),(0,i.jsx)(M.$,{onClick:eL,colorPalette:"blue",size:"sm",disabled:H.disableDatabaseQuery,children:"Run Query"})]})})),ev&&"schema_diff"===ev.type&&(0,i.jsx)(ez,{check:ev,ref:eQ}),ev&&"lineage_diff"===ev.type&&(0,i.jsx)(tZ,{check:ev,ref:eI})]}),((null==ev?void 0:ev.type)==="query"||(null==ev?void 0:ev.type)==="query_diff"||(null==ev?void 0:ev.type)==="query_base")&&(0,i.jsx)(m.av,{value:"query",p:0,height:"100%",width:"100%",children:(null==(t=ev.params)?void 0:t.base_sql_template)?(0,i.jsx)(eJ,{value:null!=(z=null==(s=ev.params)?void 0:s.sql_template)?z:"",baseValue:null!=(D=null==(o=ev.params)?void 0:o.base_sql_template)?D:"",options:{readOnly:!0}}):(0,i.jsx)(eG,{value:null!=(R=null==(a=ev.params)?void 0:a.sql_template)?R:"",options:{readOnly:!0}})})]})]})}),(0,i.jsx)(F.Dz,{open:ed,onOpenChange:eh,placement:"center",size:"xl",children:(0,i.jsxs)(L.Z,{children:[em,(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{overflowY:"auto",height:"40%",width:"60%",children:[(0,i.jsx)(F.c7,{children:(0,i.jsx)(F.L3,{children:"Preset Check Template"})}),(0,i.jsxs)(F.R4,{children:[(0,i.jsxs)(u.D,{size:"sm",fontWeight:"bold",children:["Please"," ",(0,i.jsx)(x.E,{as:"span",cursor:"pointer",_hover:{textDecoration:"underline"},color:"blue.500",onClick:async()=>{await navigator.clipboard.writeText(ea),J("Copied the template to the clipboard")},children:"copy"})," ","the following template and paste it into the"," ",(0,i.jsx)(O.f,{query:"recce.yml",styles:{px:"1",py:"0",bg:"red.100"},children:"recce.yml"})," ","file."]}),(0,i.jsx)("br",{}),(0,i.jsx)(tV,{yamlTemplate:ea})]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]})})]})})]})};var tJ=t(24188);let tY=e=>{var n,t,s,o;let{check:a,selected:d,onSelect:u,onMarkAsApproved:h}=e,{featureToggles:x}=(0,ee.c)(),p=(0,V.jE)(),m=a.check_id,{mutate:f}=(0,B.n)({mutationFn:e=>_(m,e),onSuccess:async()=>{await p.invalidateQueries({queryKey:y.X.check(m)}),await p.invalidateQueries({queryKey:y.X.checks()})}}),{run:j}=nb(null==(n=a.last_run)?void 0:n.run_id),g=null!=(s=null==(t=(0,e_.C)(a.type))?void 0:t.icon)?s:nA.XJv,v=null!=(o=a.type)?o:"",b=tU(v,j)||x.disableUpdateChecklist,w=tU(v,j);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(c.s,{width:"100%",p:"10px 20px",cursor:"pointer",_hover:{bg:"Cornsilk"},bg:d?"Floralwhite":"inherit",borderBlockEndWidth:"1px",borderLeftWidth:"3px",borderLeftColor:d?"orange":"transparent",onClick:()=>{u(a.check_id)},alignItems:"center",gap:"5px",children:[(0,i.jsx)(r.I,{as:g}),(0,i.jsx)(l.a,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:a.name}),(0,i.jsx)(el.m,{content:w?"Run the check first":"Click to mark as approved",positioning:{placement:"top"},showArrow:!0,children:(0,i.jsx)(c.s,{children:(0,i.jsxs)(tt.y8,{checked:a.is_checked,colorPalette:"green",variant:"solid",size:"sm",onCheckedChange:e=>{e.checked?h():f({is_checked:e.checked})},disabled:b,children:[(0,i.jsx)(tt.Ks,{}),(0,i.jsx)(tt.v7,{borderColor:"border.inverted",backgroundColor:b?"bg.emphasized":void 0})]})})})]})})},t0=e=>{let{checks:n,selectedItem:t,onCheckSelected:s,onChecksReordered:r}=e,[o,a]=(0,j.useState)(!1),d=(0,V.jE)(),{mutate:u}=(0,B.n)({mutationFn:e=>_(e,{is_checked:!0}),onSuccess:async(e,n)=>{await d.invalidateQueries({queryKey:y.X.check(n)}),await d.invalidateQueries({queryKey:y.X.checks()})}}),{open:h,onOpen:x,onClose:p}=(0,T.j)(),{markedAsApprovedToast:m}=tB(),f=()=>{"true"===localStorage.getItem("bypassMarkAsApprovedWarning")?(u(t),m()):x()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tJ.JY,{onDragEnd:e=>{e.destination&&r(e.source.index,e.destination.index)},children:(0,i.jsx)(tJ.gL,{droppableId:"checklist",children:e=>(0,i.jsxs)(I.T,{...e.droppableProps,ref:e.innerRef,className:"no-track-pii-safe",w:"full",gap:"0",flex:"1",overflow:"auto",children:[n.map((e,n)=>(0,i.jsx)(tJ.sx,{draggableId:e.check_id,index:n,children:(n,l)=>{if(l.isDragging){let e=n.draggableProps;if(null!=e.style&&"left"in e.style){let n={x:0,y:80},t=e.style.left-n.x,i=e.style.top-n.y;e.style.left=t,e.style.top=i}}return(0,i.jsx)(c.s,{ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,w:"full",children:(0,i.jsx)(tY,{check:e,selected:e.check_id===t,onSelect:s,onMarkAsApproved:f},e.check_id)})}},e.check_id)),e.placeholder]})})}),(0,i.jsx)(F.Dz,{open:h,onOpenChange:p,placement:"center",children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{width:"400px",children:[(0,i.jsx)(F.c7,{children:(0,i.jsx)(F.L3,{children:"Mark as Approved?"})}),(0,i.jsx)(D.w,{}),(0,i.jsxs)(l.a,{p:"16px",fontSize:"sm",gap:"16px",children:[(0,i.jsx)("p",{children:"Please ensure you have reviewed the contents of this check before marking it as approved."}),(0,i.jsxs)(tt.y8,{checked:o,onCheckedChange:e=>{a(!!e.checked)},fontWeight:"bold",size:"sm",pt:"8px",children:[(0,i.jsx)(tt.Ks,{}),(0,i.jsx)(tt.v7,{}),(0,i.jsx)(tt.Sb,{children:"Don't show this again"})]})]}),(0,i.jsx)(D.w,{}),(0,i.jsxs)(F.Es,{gap:0,children:[(0,i.jsx)(M.$,{variant:"outline",size:"xs",mr:2,onClick:p,children:"Cancel"}),(0,i.jsx)(M.$,{colorPalette:"cyan",size:"xs",onClick:()=>{u(t),o&&localStorage.setItem("bypassMarkAsApprovedWarning","true"),m(),p()},children:"Mark as approved"})]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]})})]})})]})};var t1=t(41757);function t5(e){let{checksOnly:n=!0}=e,{featureToggles:t}=(0,ee.c)(),l=(0,V.jE)(),s=(0,j.useRef)(null),o=(0,j.useRef)(null),[a,d]=(0,j.useState)(null),{open:u,onOpen:h,onClose:p}=(0,T.j)(),[m,f]=(0,eE.zy)(),[,g]=(0,H.JL)(),v=(0,j.useCallback)(async()=>{if(a){try{let{runs:e,checks:t}=await (0,t1.N_)(a,n);g(),await l.invalidateQueries({queryKey:y.X.checks()}),await l.invalidateQueries({queryKey:y.X.runs()}),m.includes("/checks")&&f("/checks");let i=n?"".concat(t," checks imported successfully"):"".concat(e," runs and ").concat(t," checks imported successfully");eT.X.create({description:i,type:"info",duration:5e3,closable:!0})}catch(e){console.error("Import failed",e),eT.X.create({title:"Import failed",description:String(e),type:"error",duration:5e3,closable:!0})}p()}},[l,a,p,m,f,g,n]),w=()=>{s.current&&s.current.click()},k=n?"checks":"runs and checks",{isDemoSite:C}=(0,H.cE)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(el.m,{content:"Import Checklist from State File"+(C?" (Disabled in the demo site)":""),children:(0,i.jsx)(q.K,{pt:"6px",variant:"plain","aria-label":"Import state",onClick:()=>{w(),(0,b.vM)({name:"import"})},disabled:t.disableImportStateFile||C,children:(0,i.jsx)(r.I,{as:eK.Th})})}),(0,i.jsx)("input",{type:"file",style:{display:"none"},ref:s,onChange:e=>{var n;(null==(n=e.target.files)?void 0:n.length)===1&&(d(e.target.files[0]),h()),s.current&&(s.current.value="")}}),(0,i.jsx)(F.Dz,{open:u,role:"alertdialog",initialFocusEl:()=>o.current,onOpenChange:p,size:"xl",children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{children:[(0,i.jsx)(F.c7,{fontSize:"lg",fontWeight:"bold",children:(0,i.jsx)(F.L3,{children:"Import state"})}),(0,i.jsx)(F.R4,{children:(0,i.jsxs)(c.s,{px:"5px",gap:"5px",rounded:"md",direction:"column",children:[(0,i.jsxs)(c.s,{alignItems:"center",gap:"5px",children:[(0,i.jsx)(nl.GLE,{color:"red.600"}),(0,i.jsx)(x.E,{as:"span",fontWeight:"500",color:"red.600",children:"Caution!"})]}),(0,i.jsx)(c.s,{children:(0,i.jsxs)(x.E,{children:["The current ",k," will be"," ",(0,i.jsx)(x.E,{as:"span",fontWeight:"600",children:"merged"})," ","with the imported state"]})})]})}),(0,i.jsxs)(F.Es,{children:[(0,i.jsx)(M.$,{ref:o,onClick:p,children:"Cancel"}),(0,i.jsx)(M.$,{colorPalette:"blue",onClick:v,ml:"5px",children:"Import"})]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]})})]})})]})}var t2=t(26901);let t4=()=>{let[,e]=(0,eE.zy)(),[,n]=(0,eE.lq)("/checks/:checkId"),{latestSelectedCheckId:t,setLatestSelectedCheckId:s}=(0,t2.J)(),r=(0,V.jE)(),o=null==n?void 0:n.checkId;o&&s(o);let{isLoading:a,error:d,data:u,status:h,refetch:x}=(0,g.I)({queryKey:y.X.checks(),queryFn:k,refetchOnMount:!0}),p=(0,j.useCallback)(n=>{e("/checks/".concat(n))},[e]),[m,f]=(0,j.useState)(null!=u?u:[]),{mutate:v}=(0,B.n)({mutationFn:e=>z(e),onSuccess:async()=>{await r.invalidateQueries({queryKey:y.X.checks()})}}),b=(0,j.useCallback)((e,n)=>{let t=[...m],[i]=t.splice(e,1);t.splice(n,0,i),v({source:e,destination:n}),f(t)},[m,f,v]);return((0,j.useEffect)(()=>{"success"===h&&(!o&&u.length>0&&(t?e("/checks/".concat(t)):e("/checks/".concat(u[0].check_id))),f(u))},[h,o,u,f,e,t]),a)?(0,i.jsx)(i.Fragment,{}):d?(0,i.jsxs)(i.Fragment,{children:["Error: ",d.message]}):(null==u?void 0:u.length)?(0,i.jsxs)(ex,{style:{height:"100%"},minSize:50,sizes:[20,80],children:[(0,i.jsx)(l.a,{borderRight:"lightgray solid 1px",height:"100%",style:{contain:"size"},children:(0,i.jsxs)(I.T,{gap:0,h:"100%",style:{contain:"strict"},alignItems:"stretch",children:[(0,i.jsx)(c.s,{justifyContent:"right",padding:"0px 10px",children:(0,i.jsx)(t5,{checksOnly:!0})}),(0,i.jsx)(D.w,{}),(0,i.jsx)(t0,{checks:m,selectedItem:o,onCheckSelected:p,onChecksReordered:b})]})}),(0,i.jsx)(l.a,{height:"100%",children:(0,i.jsx)(eE.dO,{children:(0,i.jsx)(eE.qh,{path:"/checks/:checkId",children:e=>(0,i.jsx)(tG,{checkId:e.checkId,refreshCheckList:x},e.checkId)})})})]}):(0,i.jsx)(E.o,{h:"100%",children:(0,i.jsx)(l.a,{children:"No checks"})})};var t3=t(13920);let t8=()=>{let{isHistoryOpen:e,showHistory:n,closeHistory:t}=(0,G.tr)();return(0,i.jsxs)(l.a,{children:[(0,i.jsx)(l.a,{fontSize:"8pt",children:"History"}),(0,i.jsxs)(M.$,{size:"2xs",variant:"outline",onClick:()=>{e?((0,b.iZ)({name:"hide"}),t()):((0,b.iZ)({name:"show"}),n())},children:[(0,i.jsx)(Z.XVG,{})," ",e?"Hide":"Show"]})]})},t7=()=>{let{isCustomQueries:e,setCustomQueries:n,sqlQuery:t,setBaseSqlQuery:s}=(0,nf.vr)();return(0,i.jsxs)(l.a,{children:[(0,i.jsxs)(c.s,{fontSize:"0.75rem",gap:1,alignItems:"center",children:["Custom Queries"," ",(0,i.jsx)(el.m,{content:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,i.jsx)(nl.H2l,{color:"gray.600",fontSize:"1rem"})})]}),(0,i.jsxs)(t3.lq,{size:"sm",colorPalette:"cyan",checked:e,onCheckedChange:()=>{!e&&s&&s(t),n(!e)},children:[(0,i.jsx)(t3.tD,{}),(0,i.jsx)(t3.oO,{}),(0,i.jsx)(t3.$X,{})]})]})},t6=()=>{let{sqlQuery:e,baseSqlQuery:n,setSqlQuery:t,setBaseSqlQuery:s,primaryKeys:r,setPrimaryKeys:o,isCustomQueries:a}=(0,nf.vr)(),{lineageGraph:d,envInfo:u}=(0,H.cE)(),{featureToggles:h}=(0,ee.c)(),{data:x}=(0,ny.T)(),m=e;(null==u?void 0:u.adapterType)==="sqlmesh"&&e===nf.I&&(m="select * from db.mymodel"),h.disableDatabaseQuery&&(m="--- Would like to do query here? Book a demo with us at https://datarecce.io/\n".concat(m));let{showRunId:f}=(0,G.tr)(),g=async e=>{let t="query_base"===e?null!=n?n:"":m,i=function(e){switch(e){case"query":return nZ;case"query_base":return nV;case"query_diff":return nB;default:throw Error("Unknown query type: ".concat(e))}}(e),l={sql_template:t};"query_diff"===e&&(l.primary_keys=r,a&&(l.base_sql_template=n));let{run_id:s}=await i(l,{nowait:!0});return f(s),await (0,eY.Zc)(s)},{mutate:v,isPending:y}=(0,B.n)({mutationFn:g}),b=(0,j.useMemo)(()=>{let e={};for(let t in null==d?void 0:d.nodes){var n;let i=null==(n=d.nodes[t].data.current)?void 0:n.schema;i&&(e[i]=(e[i]||0)+1)}return Object.keys(e).reduce((n,t)=>e[t]>(e[n]||0)?t:n,"N/A")},[null==d?void 0:d.nodes]);return(null==x?void 0:x.single_env_onboarding)?(0,i.jsxs)(c.s,{direction:"column",height:"100%",children:[(0,i.jsxs)(c.s,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",children:[(0,i.jsx)(t8,{}),(0,i.jsx)(p.h,{}),(0,i.jsx)(el.m,{content:"Please configure the base environment before running the diff",positioning:{placement:"left"},children:(0,i.jsx)(M.$,{colorPalette:"cyan",disabled:!0,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})})]}),(0,i.jsx)(eJ,{value:m,onChange:t,onRun:()=>{v("query")},labels:["base (production)","current (".concat(b,")")],BaseEnvironmentSetupGuide:(0,i.jsx)(tD,{})})]}):(0,i.jsxs)(c.s,{direction:"column",height:"100%",children:[(0,i.jsxs)(c.s,{justifyContent:"right",alignItems:"flex-end",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,i.jsx)(t8,{}),(0,i.jsx)(t7,{}),(0,i.jsx)(p.h,{}),(0,i.jsx)(nY,{defaultPrimaryKeys:r,onPrimaryKeysChange:o}),(0,i.jsx)(M.$,{colorPalette:"cyan",onClick:()=>{v("query_diff")},disabled:y||h.disableDatabaseQuery,size:"2xs",children:"Run Diff"})]}),(0,i.jsx)(l.a,{width:"100%",flex:"1",children:a?(0,i.jsx)(eJ,{value:m,baseValue:n,onChange:t,onChangeBase:s,onRun:()=>{v("query")},onRunBase:()=>{v("query_base")},onRunDiff:()=>{v("query_diff")}}):(0,i.jsx)(eG,{value:m,onChange:t,onRun:()=>{v("query")},onRunDiff:()=>{v("query_diff")}})})]})},t9=e=>{var n;let{runId:t}=e,{isPending:l,error:s,data:r}=(0,g.I)({queryKey:y.X.run(t),queryFn:async()=>(0,eY.Zc)(t)}),o=(null==r?void 0:r.type)?null==(n=(0,e_.C)(r.type))?void 0:n.RunResultView:void 0;return(0,i.jsx)(e5,{error:s,run:r,RunResultView:o})},ie=e=>{let{error:n,resetError:t}=e;return(0,i.jsx)(E.o,{height:"100%",backgroundColor:"gray.50",children:(0,i.jsxs)(c.s,{p:4,direction:"column",justifyContent:"flex-start",backgroundColor:"white",border:"solid lightgray 1px",minHeight:"200px",children:[(0,i.jsx)(u.D,{width:"800px",size:"md",children:"You have encountered an error"}),(0,i.jsx)(l.a,{flex:"1",fontSize:"10pt",children:String(n)}),(0,i.jsx)(M.$,{justifySelf:"center",alignSelf:"center",mt:"20px",colorPalette:"blue",size:"sm",onClick:()=>{t()},children:"Reset"})]})})},it=e=>{let{children:n}=e;return(0,i.jsx)(e1.tH,{fallback:ie,children:n})};function ii(){let{featureToggles:e}=(0,ee.c)(),n=async()=>{try{let e=await (0,t1.sp)(),n=JSON.stringify(e,null,2),t=new Blob([n],{type:"application/json"}),i=new Date,l="recce-state-".concat((0,eP.GP)(i,"yyyy-MM-dd-HH-mm-ss"),".json");nz()(t,l)}catch(e){console.error("Export failed",e),eT.X.create({title:"Export failed",description:String(e),type:"error",duration:5e3,closable:!0})}};return(0,i.jsx)(el.m,{content:"Export",children:(0,i.jsx)(q.K,{size:"sm",variant:"plain","aria-label":"Export state",onClick:async()=>{await n(),(0,b.vM)({name:"export"})},disabled:e.disableExportStateFile,children:(0,i.jsx)(r.I,{as:eK.gY,verticalAlign:"middle",boxSize:"16px"})})})}function il(){return(0,i.jsx)(e8.Ln,{children:(0,i.jsx)(tW,{interactive:!0})})}t(56489);var is=t(50117);t(6639);let ir=e=>{var n,t;let{run:s,isSelected:o,onSelectRun:a,onAddToChecklist:d,onGoToCheck:u}=e,{featureToggles:h}=(0,ee.c)(),{data:p}=(0,g.I)({queryKey:y.X.run(s.run_id),queryFn:async()=>await (0,eY.Zc)(s.run_id),enabled:"running"===s.status,retry:!1}),m=null!=(t=null==(n=(0,e_.C)(s.type))?void 0:n.icon)?t:nA.XJv,f=s.check_id,j=h.disableUpdateChecklist;return(0,i.jsxs)(c.s,{minWidth:"200px",direction:"column",width:"100%",p:"5px 20px",cursor:"pointer",borderBottom:"solid 1px lightgray",borderLeft:"4px",borderLeftColor:o?"orange.400":"transparent",backgroundColor:o?"orange.50":"transparent",onClick:()=>{a(s.run_id)},_hover:{bg:o?"orange.50":"gray.200"},children:[(0,i.jsxs)(c.s,{onClick:()=>{},alignItems:"center",gap:"12px",children:[(0,i.jsx)(r.I,{as:m}),(0,i.jsx)(l.a,{className:"no-track-pii-safe",flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",color:s.name?"inherit":"gray.500",fontSize:"11pt",fontWeight:"500",children:s.name||"<no name>"}),f?(0,i.jsx)(el.m,{content:"Go to Check","aria-label":"Go to Check",children:(0,i.jsx)(x.E,{onClick:e=>{e.preventDefault(),e.stopPropagation(),u(f)},children:(0,i.jsx)(r.I,{color:"green",as:ef.A7C})})}):j?null:(0,i.jsx)(el.m,{content:"Add to Checklist","aria-label":"Add to Checklist",children:(0,i.jsx)(x.E,{onClick:e=>{e.preventDefault(),e.stopPropagation(),(0,b.iZ)({name:"add_to_checklist"}),d(s.run_id)},children:(0,i.jsx)(r.I,{as:ef.yjt})})})]}),(0,i.jsx)(c.s,{justifyContent:"start",fontSize:"11pt",color:"gray.500",gap:"3px",alignItems:"center",children:(0,i.jsx)(nT,{run:null!=p?p:s})})]})},io=e=>{let{runAt:n}=e,t=n?function(e){let n=new Date,t=new Date;return(t.setDate(n.getDate()-1),null==e)?null:n.toDateString()===e.toDateString()?"Today":t.toDateString()===e.toDateString()?"Yesterday":(0,eP.GP)(e,"MMM d")}(new Date(n)):null;return(0,i.jsx)(c.s,{minWidth:"200px",width:"100%",p:"5px 20px",borderBottom:"solid 1px lightgray",color:"gray.500",fontSize:"11pt",children:t})},ia=()=>{let{data:e,isLoading:n,isFetching:t,error:s,refetch:r}=(0,g.I)({queryKey:y.X.runs(),queryFn:async()=>await (0,eY.v)(),retry:!1}),{showRunId:o,runId:a}=(0,G.tr)(),d=e=>{(0,b.iZ)({name:"click_run"}),o(e,!1)},[,x]=(0,eE.zy)(),m=(0,V.jE)(),f=(0,j.useCallback)(async()=>{if(!a)return;let e=await w(a);await m.invalidateQueries({queryKey:y.X.checks()}),x("/checks/".concat(e.check_id))},[a,x,m]),v=(0,j.useCallback)(e=>{(0,b.iZ)({name:"go_to_check"}),x("/checks/".concat(e))},[x]),k=null;return(0,i.jsxs)(c.s,{direction:"column",height:"100%",children:[(0,i.jsxs)(h.z,{width:"100%",flex:"0 0 54px",paddingInline:"24px 8px",borderBottom:"solid 1px lightgray",children:[(0,i.jsx)(u.D,{size:"md",children:"History"}),(0,i.jsx)(p.h,{}),(0,i.jsx)(q.K,{variant:"plain","aria-label":"Search database",onClick:async()=>{await r()},children:(0,i.jsx)(nl.fZv,{})})]}),(0,i.jsx)(l.a,{flex:"1 1 auto",children:n?"Loading...":(null==e?void 0:e.length)===0?(0,i.jsx)(E.o,{height:"100%",color:"gray.400",children:"No runs"}):(0,i.jsx)(is.A,{style:{minHeight:"100%",height:0},children:(null!=e?e:[]).map((e,n)=>{let t=new Date(e.run_at).toDateString(),l=null!=k&&k!==t;return k=t,(0,i.jsxs)(i.Fragment,{children:[l&&(0,i.jsx)(io,{runAt:e.run_at},t),(0,i.jsx)(ir,{run:e,isSelected:e.run_id===a,onSelectRun:d,onGoToCheck:v,onAddToChecklist:f},e.run_id)]})})})})]})},ic=()=>({toastSuccess:e=>{eT.X.create({description:e,type:"success",duration:5e3,closable:!0})},toastError:(e,n)=>{let t=e;if(null!=n)if(n instanceof tf.pe){var i,l;t="".concat(e,". ").concat(String(null==(l=n.response)||null==(i=l.data)?void 0:i.detail))}else t="".concat(e,". ").concat(n);eT.X.create({description:t,type:"error",duration:5e3,closable:!0})}}),id=e=>{(0,j.useEffect)(()=>{let n=e=>{e.preventDefault()};return e&&window.addEventListener("beforeunload",n),()=>{e&&window.removeEventListener("beforeunload",n)}},[e])},iu=()=>{var e,n;let t,{featureToggles:s}=(0,ee.c)(),{fileName:o,cloudMode:a,isDemoSite:d,envInfo:u}=(0,H.cE)(),h=(0,T.j)(),x=(0,T.j)(),p=!o&&!a&&!d,{data:m}=(0,g.I)({queryKey:y.X.checks(),queryFn:k,enabled:p}),f=void 0!=m&&m.filter(e=>!e.is_preset).length>0;id(p&&f);let[{newFileName:v,errorMessage:b,modified:w,overwriteWithMethod:C,bypass:_},S]=(0,j.useState)({newFileName:null!=o?o:"recce_state.json"}),z=(0,j.useRef)(null),{toastSuccess:E,toastError:I}=ic(),D=(0,V.jE)(),R=async(e,n)=>{if(!v)return;let t="true"===localStorage.getItem(n2.bypassSaveOverwrite);try{"save"===e?await (0,t1.Uh)({filename:v,overwrite:null!=n?n:t}):await (0,t1.$w)({filename:v,overwrite:null!=n?n:t}),E("save"===e?"Save file successfully":"Rename file successfully"),await D.invalidateQueries({queryKey:y.X.lineage()}),_&&localStorage.setItem(n2.bypassSaveOverwrite,"true")}catch(n){if(n instanceof tf.pe){var i;if((null==(i=n.response)?void 0:i.status)===409){S(n=>({...n,overwriteWithMethod:e})),x.onOpen();return}}I("save"===e?"Save file failed":"Rename file failed",n)}finally{h.onClose()}};if(a||d)return(0,i.jsx)(i.Fragment,{});if(s.disableSaveToFile&&o){let n=null==u||null==(e=u.stateMetadata)?void 0:e.generated_at,i=n?nR(new Date(n)):null;t=i?"".concat(o," (").concat(i,")"):null}return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(c.s,{justifyContent:"center",alignItems:"center",children:[(0,i.jsx)(l.a,{fontWeight:"600",children:null!=(n=null!=t?t:o)?n:"New Instance"+(f?" (unsaved)":"")}),!s.disableSaveToFile&&(0,i.jsx)(el.m,{content:o?"Change Filename":"Save",openDelay:1e3,children:(0,i.jsx)(q.K,{onClick:()=>{S({newFileName:null!=o?o:"recce_state.json",modified:!o}),h.onOpen()},"aria-label":o?"Change Filename":"Save",variant:"ghost",size:"sm",colorPalette:"gray",children:(0,i.jsx)(r.I,{as:o?eK.GI:eK.FS,boxSize:"16px",verticalAlign:"middle"})})})]}),(0,i.jsx)(F.Dz,{open:h.open,onOpenChange:h.onClose,placement:"center",children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{children:[(0,i.jsx)(F.c7,{children:(0,i.jsx)(F.L3,{children:o?"Change Filename":"Save File"})}),(0,i.jsx)(F.R4,{onKeyDown:e=>{e.stopPropagation()},children:(0,i.jsxs)(nJ.XO,{invalid:!!b,children:[(0,i.jsx)(nJ.dh,{children:"File name:"}),(0,i.jsx)($.p,{ref:z,value:v,placeholder:"Enter filename",onChange:e=>{let n,t=e.target.value;t?t.endsWith(".json")?/^[a-zA-Z0-9 _-]+\.json$/.test(t)?o&&t===o&&(n="Filename is the same as the current one."):n="Invalid filename. Only alphanumeric, space, _ and - are allowed.":n="Filename must end with .json.":n="Filename cannot be empty.",S(e=>({...e,modified:!0,newFileName:t,errorMessage:n}))},onKeyDown:e=>{"Enter"===e.key?b||(o?R("rename"):R("save")):"Escape"===e.key&&h.onClose()}}),(0,i.jsx)(nJ.wp,{children:b})]})}),(0,i.jsxs)(F.Es,{gap:"5px",children:[(0,i.jsx)(M.$,{size:"sm",colorPalette:o?void 0:"blue",onClick:async()=>{await R("save")},disabled:!v||!!b||!w,children:o?"Save as New File":"Confirm"}),o&&(0,i.jsx)(M.$,{size:"sm",colorPalette:"blue",onClick:async()=>{await R("rename")},disabled:!v||!!b||!w,children:"Rename"})]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]})})]})}),(0,i.jsx)(F.Dz,{open:x.open,onOpenChange:x.onClose,initialFocusEl:()=>z.current,placement:"center",children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsx)(F.f5,{children:(0,i.jsxs)(F.Cf,{children:[(0,i.jsx)(F.c7,{children:(0,i.jsx)(F.L3,{children:"Overwrite File?"})}),(0,i.jsxs)(F.R4,{borderTop:"solid 1px lightgray",borderBottom:"solid 1px lightgray",onKeyDown:e=>{e.stopPropagation()},children:[(0,i.jsx)(l.a,{fontSize:"12pt",children:"save"===C?"Saving a file with this name will overwrite the existing file. Are you sure you wish to continue?":"Renaming the file with this name will overwrite the existing file. Are you sure you wish to continue?"}),(0,i.jsxs)(tt.y8,{size:"xs",checked:_,onCheckedChange:e=>{S(n=>({...n,bypass:!!e.checked}))},children:[(0,i.jsx)(tt.Ks,{}),(0,i.jsx)(tt.v7,{}),(0,i.jsx)(tt.Sb,{fontWeight:"bold",pt:"8px",children:"Don't show this again"})]})]}),(0,i.jsxs)(F.Es,{gap:"5px",children:[(0,i.jsx)(M.$,{variant:"outline",onClick:()=>{x.onClose(),h.onOpen(),S(e=>({...e,overwriteWithMethod:void 0}))},size:"sm",children:"Back"}),(0,i.jsx)(M.$,{size:"sm",colorPalette:"blue",onClick:()=>{C&&(R(C,!0),x.onClose())},children:"Overwrite"})]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]})})]})})]})};var ih=t(73409);function ix(){return(0,i.jsx)(el.m,{content:"Syncing",children:(0,i.jsx)(M.$,{pt:"6px",variant:"plain",boxSize:"1em",children:(0,i.jsx)(J.y,{})})})}function ip(){let[e,n]=(0,j.useState)(!1),t=(0,V.jE)(),[s,o]=(0,eE.zy)(),{open:a,onOpen:c,onClose:d}=(0,T.j)(),[u,h]=(0,j.useState)(""),x=(0,j.useCallback)(async e=>{if(d(),n(!0),"conflict"===(await (0,t1.Z3)(e)).status){c(),n(!1);return}for(;await (0,t1.$k)();)await new Promise(e=>setTimeout(e,1e3));eT.X.create({description:"Sync Completed",type:"success",duration:5e3,closable:!0}),n(!1),h(""),await t.invalidateQueries({queryKey:y.X.lineage()}),await t.invalidateQueries({queryKey:y.X.checks()}),await t.invalidateQueries({queryKey:y.X.runs()}),/^\/checks\/([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/.test(s)&&o("/checks")},[t,s,o,c,d]);return e?(0,i.jsx)(ix,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(el.m,{content:"Sync with Cloud",children:(0,i.jsx)(q.K,{size:"sm",variant:"plain","aria-label":"Sync state",onClick:()=>x({}),children:(0,i.jsx)(r.I,{as:eK.nU,verticalAlign:"middle",boxSize:"16px"})})}),(0,i.jsx)(F.Dz,{open:a,onOpenChange:d,children:(0,i.jsxs)(L.Z,{children:[(0,i.jsx)(F.Xi,{}),(0,i.jsxs)(F.f5,{children:[(0,i.jsxs)(F.Cf,{children:[(0,i.jsx)(F.c7,{fontSize:"lg",fontWeight:"bold",children:(0,i.jsx)(F.L3,{children:"Sync with Cloud"})}),(0,i.jsxs)(F.R4,{children:[(0,i.jsx)(l.a,{children:"New changes have been detected in the cloud. Please choose a method to sync your state"}),(0,i.jsx)(l.a,{mt:"5px",children:(0,i.jsx)(ih.Bz,{onValueChange:e=>{h(String(e.value))},value:u,children:(0,i.jsxs)(eq.B,{direction:"column",children:[(0,i.jsxs)(ih.CU,{value:"merge",children:[(0,i.jsx)(ih.GS,{}),(0,i.jsx)(ih.rB,{}),(0,i.jsxs)(ih.JZ,{children:["Merge",(0,i.jsx)(el.m,{content:"This will merge the local and remote states.",children:(0,i.jsx)("span",{children:(0,i.jsx)(r.I,{as:nl.GLE,ml:2,cursor:"pointer"})})})]})]}),(0,i.jsxs)(ih.CU,{value:"overwrite",children:[(0,i.jsx)(ih.GS,{}),(0,i.jsx)(ih.rB,{}),(0,i.jsxs)(ih.JZ,{children:["Overwrite",(0,i.jsx)(el.m,{content:"This will overwrite the remote state file with the local state.",children:(0,i.jsx)("span",{children:(0,i.jsx)(r.I,{as:nl.GLE,ml:2,cursor:"pointer"})})})]})]}),(0,i.jsxs)(ih.CU,{value:"revert",children:[(0,i.jsx)(ih.GS,{}),(0,i.jsx)(ih.rB,{}),(0,i.jsxs)(ih.JZ,{children:["Revert",(0,i.jsx)(el.m,{content:"This will discard local changes and revert to the cloud state.",children:(0,i.jsx)("span",{children:(0,i.jsx)(r.I,{as:nl.GLE,ml:2,cursor:"pointer"})})})]})]})]})})})]}),(0,i.jsxs)(F.Es,{children:[(0,i.jsx)(M.$,{onClick:d,mr:3,children:"Cancel"}),(0,i.jsx)(M.$,{colorPalette:"blue",onClick:()=>x({method:u}),disabled:!u,children:"Sync"})]})]}),(0,i.jsx)(F.tK,{asChild:!0,children:(0,i.jsx)(P.J,{size:"sm"})})]})]})})]})}var im=t(42125);function ij(){let{successToast:e,failToast:n}=eF(),[,t]=(0,im.Cj)(),{authed:l}=(0,ee.c)(),{shareUrl:s,isLoading:r,error:o,handleShareClick:a}=(0,nq.l)(),[d,u]=(0,j.useState)(!1),h=async()=>{try{await t(String(s)),e("Copied the link to clipboard")}catch(e){n("Failed to copy the link",e)}};return l?(0,i.jsxs)(c.s,{flex:"1",alignItems:"center",gap:"5px",children:[(0,i.jsxs)(M.$,{size:"xs",variant:"outline",colorPalette:"gray",onClick:async()=>{await a(),(0,b.o$)({name:"create"})},loading:r,children:[(0,i.jsx)(nA.Fsk,{})," Share ",s?(0,i.jsx)(nl.Ykz,{color:"green"}):void 0]}),(0,i.jsxs)(c.s,{gap:"5px",alignItems:"center",children:[s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.s,{overflowX:"auto",whiteSpace:"nowrap",maxWidth:"350px",children:(0,i.jsx)(x.E,{fontSize:"14",children:s})}),(0,i.jsx)(q.K,{size:"2xs","aria-label":"Copy the share URL",onClick:async()=>{await h(),(0,b.o$)({name:"copy"})},children:(0,i.jsx)(nl.hX7,{})})]}),o&&(0,i.jsx)(x.E,{fontSize:"14",color:"red.500",children:o})]})]}):(0,i.jsxs)(c.s,{flex:"1",alignItems:"center",children:[(0,i.jsxs)(M.$,{size:"xs",colorPalette:"gray",variant:"outline",onClick:()=>{u(!0)},children:[(0,i.jsx)(nA.Fsk,{})," Share"]}),d&&(0,i.jsx)(nP,{handleParentClose:()=>{u(!1)},ignoreCookie:!0})]})}let ig={TOAST_ID:"lifetime-countdown",WARNING_THRESHOLD:60,UPDATE_INTERVAL:1e3,MESSAGE:e=>"The server will be closed in ".concat(e," seconds.")},iv=e=>{let{children:n,path:t}=e,[s]=(0,eE.lq)(t);return(0,i.jsx)(l.a,{display:s?"block":"none",height:"100%",children:n})};function iy(e){let{icon:n,href:t,...l}=e;return(0,i.jsx)(s.N,{height:"20px",color:"white",href:t,target:"_blank",...l,children:(0,i.jsx)(r.I,{color:"white",boxSize:"20px",as:n})})}function ib(){let{version:e,latestVersion:n}=function(){let[e,n]=(0,j.useState)(""),[t,i]=(0,j.useState)("");return(0,j.useEffect)(()=>{!async function(){try{let{version:e,latestVersion:t}=(await v.g.get("/api/version")).data;n(e),i(t)}catch(e){console.error("Error fetching version number:",e)}}()},[]),{version:e,latestVersion:t}}(),[t,l]=(0,j.useState)(void 0);return RegExp("^\\d+\\.\\d+\\.\\d+$").test(e)?(e!==n&&null==t&&l(eT.X.create({id:t,title:"Update available",description:(0,i.jsxs)("span",{children:["A new version of Recce (v",n,") is available.",(0,i.jsx)("br",{}),"Please run ",(0,i.jsx)(a.C,{children:"pip install --upgrade recce"})," to update Recce.",(0,i.jsx)("br",{}),(0,i.jsx)(s.N,{color:"rgb(255, 215, 0)",fontWeight:"bold",href:"https://github.com/DataRecce/recce/releases/tag/v".concat(n),_hover:{textDecoration:"underline"},target:"_blank",children:"Click here to view the detail of latest release"})]}),closable:!0})),(0,i.jsx)(o.Ex,{fontSize:"sm",color:"white/80",variant:"outline",children:(0,i.jsxs)(s.N,{href:"https://github.com/DataRecce/recce/releases/tag/v".concat(e),_hover:{textDecoration:"none"},children:[e," ",(0,i.jsx)(eW.TdP,{})]})})):(0,i.jsx)(o.Ex,{fontSize:"sm",color:"white/80",variant:"outline",textTransform:"uppercase",children:e})}function iw(){var e,n,t;let{reviewMode:a,isDemoSite:m,envInfo:f,cloudMode:g}=(0,H.cE)(),{featureToggles:v,lifetimeExpiredAt:y}=(0,ee.c)(),{url:b,id:w}=null!=(e=null==f?void 0:f.pullRequest)?e:{},k=b?b.split("/").pop():null;return!function(e){let n=eT.X,[t,i]=(0,j.useState)(null),l=(0,j.useRef)(void 0),s=(0,j.useCallback)(()=>{if(!e)return 0;let n=new Date;return Math.max(0,Math.floor((e.getTime()-n.getTime())/1e3))},[e]),r=(0,j.useCallback)(()=>{null!=t&&(n.remove(t),i(null))},[n,t]),o=(0,j.useCallback)(()=>{if(null==t)return;let e=s();if(e<=0)return void r();n.update(t,{description:ig.MESSAGE(e)})},[t,s,n,r]),a=(0,j.useCallback)(()=>{if(!e)return;r();let t=s();t<=0||(i(n.create({id:ig.TOAST_ID,description:ig.MESSAGE(t)})),l.current=setInterval(o,ig.UPDATE_INTERVAL))},[e,n,s,o,r]);(0,j.useEffect)(()=>{if(!e)return;let n=s();if(n-ig.WARNING_THRESHOLD<0)a();else{let e=setTimeout(a,(n-ig.WARNING_THRESHOLD)*1e3);return()=>{clearTimeout(e),r()}}return r},[e,s,a,r])}(y),(0,i.jsxs)(c.s,{gap:"10px",minHeight:"40px",alignItems:"center",bg:"rgb(255, 110, 66)",children:[(0,i.jsx)(d._,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,i.jsx)(u.D,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,i.jsx)(ib,{}),(null!=(n=v.mode)?n:a)&&(0,i.jsx)(o.Ex,{fontSize:"sm",color:"white/80",variant:"outline",textTransform:"uppercase",children:null!=(t=v.mode)?t:"review mode"}),g&&w&&(0,i.jsx)(o.Ex,{fontSize:"sm",color:"white/80",variant:"outline",textTransform:"uppercase",children:(0,i.jsxs)(h.z,{children:[(0,i.jsx)(l.a,{children:"cloud mode"}),(0,i.jsx)(l.a,{borderLeftWidth:"1px",borderLeftColor:"white/80",paddingLeft:"8px",children:(0,i.jsxs)(s.N,{href:b,_hover:{textDecoration:"none"},target:"_blank",children:[(0,i.jsx)(r.I,{color:"white/80",as:Z.XaX,boxSize:"3",fontWeight:"extrabold",strokeWidth:"1"}),(0,i.jsx)(x.E,{color:"white/80",children:" #".concat(String(w))})]})})]})}),m&&b&&k&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(o.Ex,{fontSize:"sm",color:"white/80",variant:"outline",children:(0,i.jsxs)(h.z,{children:[(0,i.jsx)(l.a,{children:"demo mode"}),(0,i.jsx)(l.a,{borderLeft:"1px",borderLeftColor:"whiteAlpha.500",paddingLeft:"8px",children:(0,i.jsxs)(s.N,{href:b,_hover:{textDecoration:"none"},target:"_blank",children:[(0,i.jsx)(r.I,{as:Z.XaX,boxSize:"3",fontWeight:"extrabold",strokeWidth:"1"})," #".concat(k)," ",(0,i.jsx)(eW.TdP,{})]})})]})})}),(0,i.jsx)(p.h,{}),(0,i.jsx)(iy,{icon:ef.hL4,href:"https://github.com/DataRecce/recce"}),(0,i.jsx)(iy,{icon:ef.iWS,href:"https://getdbt.slack.com/archives/C05C28V7CPP"}),(0,i.jsx)(iy,{mr:"18px",icon:ef.gZZ,href:"https://docs.datarecce.io"})]})}function ik(e){let{queryKey:n,fetchCallback:t,selectCallback:s}=e,{data:r,isLoading:o,error:a}=(0,g.I)({queryKey:n,queryFn:t,select:s});return o||a||0===r?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(l.a,{ml:"2px",maxH:"20px",height:"80%",aspectRatio:1,borderRadius:"full",bg:"tomato",alignContent:"center",color:"white",fontSize:"xs",children:r})}function iC(){let{isDemoSite:e,cloudMode:n,isLoading:t}=(0,H.cE)(),{featureToggles:s}=(0,ee.c)(),[r,o]=(0,eE.zy)(),[a,d]=(0,j.useState)("/lineage"),{data:u,isLoading:h}=(0,ny.T)(),x=[{name:"Lineage",href:"/lineage"},{name:"Query",href:"/query"},{name:"Checklist",href:"/checks",badge:(0,i.jsx)(ik,{queryKey:y.X.checks(),fetchCallback:k,selectCallback:e=>e.filter(e=>!e.is_checked).length}),disable:(null==u?void 0:u.single_env_onboarding)===!0}];return(0,j.useEffect)(()=>{d("/".concat(r.split("/")[1]))},[r]),(0,i.jsx)(m.pK,{colorPalette:"cyan",defaultValue:"/lineage",value:a,onValueChange:e=>{d(e.value)},children:(0,i.jsxs)(m.j7,{children:[(0,i.jsx)(l.a,{flex:"1",display:"flex",children:x.map(e=>{let{name:n,href:l,badge:s,disable:r}=e;return(0,i.jsxs)(m.Xi,{value:l,onClick:()=>{o(l)},disabled:!!t||h||r,hidden:r,children:[n,s]},l)})}),(0,i.jsx)(c.s,{flex:"3",justifyContent:"right",alignItems:"center",children:!t&&!e&&(0,i.jsx)(iu,{})}),(0,i.jsx)(c.s,{flex:"3",justifyContent:"left",alignItems:"center",children:!t&&!e&&!(null==u?void 0:u.single_env_onboarding)&&!s.disableShare&&(0,i.jsx)(ij,{})}),!t&&(0,i.jsxs)(c.s,{flex:"3",justifyContent:"right",alignItems:"center",mr:"8px",children:[(0,i.jsx)(eU,{}),n&&(0,i.jsx)(ip,{}),(0,i.jsx)(ii,{})]})]})})}function i_(){let{isRunResultOpen:e,isHistoryOpen:n,closeRunResult:t}=(0,G.tr)(),{data:s}=(0,ny.T)(),[r]=(0,eE.zy)(),o=e&&!r.startsWith("/checks"),a=n&&!r.startsWith("/checks");return(0,i.jsxs)(ex,{sizes:[0,100],minSize:300*!!a,gutterSize:5*!!a,style:{height:"100%"},children:[(0,i.jsx)(l.a,{style:{contain:"size"},children:a&&(0,i.jsx)(ia,{})}),(0,i.jsxs)(ep,{sizes:o?[50,50]:[100,0],minSize:100*!!o,gutterSize:5*!!o,style:{flex:"1",contain:"size"},children:[(0,i.jsx)(l.a,{p:0,style:{contain:"content"},children:(0,i.jsxs)(it,{children:[(0,i.jsx)(iv,{path:"/lineage",children:(0,i.jsx)(il,{})}),(0,i.jsxs)(eE.dO,{children:[(0,i.jsx)(eE.qh,{path:"/query",children:(0,i.jsx)(t6,{})}),(0,i.jsx)(eE.qh,{path:"/checks/:slug?",children:(0,i.jsx)(t4,{})}),(0,i.jsx)(eE.qh,{path:"/runs/:runId",children:e=>{let{runId:n}=e;return(0,i.jsx)(t9,{runId:n})}}),(0,i.jsx)(eE.qh,{path:"/ssr",children:(0,i.jsx)(f.wi,{size:"xs",value:null,colorPalette:"cyan",children:(0,i.jsx)(f.XL,{children:(0,i.jsx)(f.Fx,{})})})}),(0,i.jsx)(eE.qh,{children:(0,i.jsx)(eE.rd,{to:"/lineage"})})]})]})}),o?(0,i.jsx)(nW,{onClose:t,isSingleEnvironment:!!(null==s?void 0:s.single_env_onboarding)}):(0,i.jsx)(l.a,{})]})]})}function iS(e){let{children:n}=e;return(0,i.jsx)(c.s,{direction:"column",height:"100vh",overflow:"hidden",children:n})}function iz(){let{isDemoSite:e,isLoading:n}=(0,H.cE)(),{featureToggles:t}=(0,ee.c)();return(0,j.useEffect)(()=>{(0,b.uz)()},[]),(0,i.jsxs)(iS,{children:[(0,i.jsx)(iw,{}),(0,i.jsx)(iC,{}),(0,i.jsx)(i_,{}),!n&&!e&&null===t.mode&&(0,i.jsx)(nP,{})]})}},34980:()=>{},42290:(e,n,t)=>{Promise.resolve().then(t.bind(t,29536))},79207:()=>{},87545:()=>{}},e=>{var n=n=>e(e.s=n);e.O(0,[830,750,134,14,72,452,383,265,138,587,598,17,719,217,215,73,458,29,344,896,90,683,71,711,583,545,88,358],()=>n(42290)),_N_E=e.O()}]);