(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{27709:function(e,n,t){Promise.resolve().then(t.bind(t,35829))},35829:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return re}});var i=t(95766),r=t(48510);function l(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=new Set,r={},l=(e,t)=>{if(!(t<0)&&(void 0===r[e]||!(r[e]>=t))){for(let i of(r[e]=t,n(e)))l(i,t-1);i.add(e)}};for(let n of e)l(n,t);return i}function o(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let i=new Set;return n.forEach(e=>{e.forEach(e=>{i.add(e)})}),i}var s=t(28482),a=t.n(s);function c(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return l(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].parents),t)}function d(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return l(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].children),t)}function u(e,n){let t=[],i=[];function l(e){return"base"===e?0:"current"===e?2:1}function s(e,n){let t=l(e.from),i=l(n.from);return t<i?-1:t>i?1:0}let a=n?function(e,n){var t;let i=Object.values(e.nodes);if("changed_models"===(n.view_mode||"changed_models")){let n=o(c(e,e.modifiedSet,1),d(e,e.modifiedSet));i=i.filter(e=>n.has(e.id))}if(void 0!==n.node_ids){let e=new Set(n.node_ids);i=i.filter(n=>e.has(n.id))}let r=void 0!==n.packages?n.packages:(null===(t=e.manifestMetadata.current)||void 0===t?void 0:t.project_name)?[e.manifestMetadata.current.project_name]:void 0;return void 0!==r&&(i=i.filter(e=>!!e.packageName&&r.includes(e.packageName))),new Set(i.map(e=>e.id))}(e,n):void 0;for(let n of Object.values(e.nodes).sort(s))(!a||a.has(n.id))&&t.push({id:n.id,position:{x:0,y:0},data:n,type:"customNode",targetPosition:r.Ly.Left,sourcePosition:r.Ly.Right});for(let n of Object.values(e.edges).sort(s))(!a||a.has(n.parent.id)&&a.has(n.child.id))&&i.push({id:n.id,type:"customEdge",source:n.parent.id,target:n.child.id,data:n});return h(t,i),x(Array.from(d(e,e.modifiedSet)),t,i)}let h=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR",i=new(a()).graphlib.Graph;i.setDefaultEdgeLabel(()=>({})),i.setGraph({rankdir:t}),e.forEach(e=>{i.setNode(e.id,{width:300,height:36})}),n.forEach(e=>{i.setEdge(e.source,e.target)}),a().layout(i),e.forEach(e=>{let n=i.node(e.id);return e.position={x:n.x-150,y:n.y-18},e})};function x(e,n,t){let i=new Set(e),r=new Set(t.filter(e=>i.has(e.source)&&i.has(e.target)).map(e=>e.id));return[n.map(e=>({...e,data:{...e.data,isHighlighted:i.has(e.id)}})),t.map(e=>({...e,data:{...e.data,isHighlighted:r.has(e.id)}}))]}function m(e,n){return n.map(n=>{let t=n.id===e;return{...n,data:{...n.data,isSelected:t}}})}function p(e,n){return n.map(n=>{let t=e.includes(n.id);return{...n,data:{...n.data,isSelected:n.data.isSelected||t}}})}function f(e,n){return e.map(e=>({...e,data:{...e.data,isSelected:!1,isActionMode:n,action:void 0}}))}var g=t(58396),v=t(29012),j=t(24112),y=t(25773),b=t(88117),k=t(64653),w=t(51742),C=t(68825),_=t(79481),S=t(43361),z=t(49801),T=t(39226),R=t(34510),E=t(66518),I=t(49110),O=t(55415),A=t(24432);t(90548);var N=t(32088),M=t(26138),L=t(52091),F=t(68630),D=t(91363);let q=L.Nbv,P=L.sFB,W=L.UGs;function H(e){return"added"===e?{color:"#1dce00",icon:q}:"removed"===e?{color:"#ff4444",icon:P}:"modified"===e?{color:"#ffa502",icon:W}:{color:"inherit",icon:void 0}}function V(e){if("model"===e)return{color:"#c0eafd",icon:F.Fn3};if("metric"===e)return{color:"#ffe6ee",icon:D._MV};if("source"===e)return{color:"#a6dda6",icon:F.i1q};if("exposure"===e)return{color:"#ffe6ee",icon:D.n8P};if("semantic_model"===e)return{color:"#fb8caf",icon:D.R1C};if("seed"===e)return{color:"#a6dda6",icon:F.tWi};if("snapshot"===e)return{color:"#a6dda6",icon:F.Dmm};else return{color:"inherit",icon:void 0}}t(91074);var K=t(48289),U=t(93998),J=t(23567),B=t(94734),Q=t(66633),X=t(39171),Z=t(83143),Y=t(62330),$=t(39588);let G=$.env.NEXT_PUBLIC_API_URL?$.env.NEXT_PUBLIC_API_URL:window.location.origin;var ee=t(94614);let en=Y.Z.create({baseURL:G}),et=new ee.S;async function ei(e,n,t){return(await en.post("/api/runs",{type:e,params:n,nowait:null==t?void 0:t.nowait})).data}async function er(e,n){return(await en.get("/api/runs/".concat(e,"/wait"),{params:{timeout:n}})).data}async function el(e){return await en.post("/api/runs/".concat(e,"/cancel"))}async function eo(e,n){return(await en.post("/api/checks/".concat(e,"/run"),{nowait:null==n?void 0:n.nowait})).data}async function es(e,n,t){return(await en.post("/api/runs/search",{type:e,params:n,limit:t})).data}async function ea(){return(await en.post("/api/runs/aggregate",{})).data}async function ec(e,n){return await ei("row_count_diff",e,n)}async function ed(e){let{result:n}=await eu([e]);return n[e]}async function eu(e){if(0===e.length)throw Error("No model names provided");let{run_id:n}=await ec({node_names:e},{nowait:!0}),t=await er(n);return{runId:n,result:t.result}}let eh={rowCount:e=>["row_count",e],lineage:()=>["lineage"],checks:()=>["checks","list"],check:e=>["checks",e],run:e=>["runs",e],runsAggregated:()=>["runs_aggregated"]};var ex=t(39944),em=t(29937),ep=t(55465);async function ef(){return(await en.get("/api/info")).data}async function eg(e){return(await en.get("/api/model/".concat(e))).data}var ev=t(99873),ej=t(85929),ey=t.n(ej);let eb=(0,E.createContext)({});function ek(e){let{refetch:n}=e,t=(0,ev.p)(),[r,l]=(0,E.useState)(),o=(0,ep.NL)();return(0,E.useEffect)(()=>{let e=new WebSocket("".concat(G.replace(/(http)(s)?\:\/\//,"ws$2://"),"/api/ws"));return l(e),e.onopen=()=>{e.send("ping")},e.onmessage=e=>{if("pong"!==e.data)try{let n=JSON.parse(e.data);if("refresh"===n.command){let{eventType:e,srcPath:i}=n.event,[r,l]=i.split("/").slice(-2),s=ey().parse(l).name;t({description:"Detected ".concat(r," ").concat(s," ").concat(e),status:"info",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0}),o.invalidateQueries({queryKey:eh.lineage()})}}catch(e){console.error(e)}},()=>{e&&e.close()}},[t,o]),(0,i.jsx)(i.Fragment,{})}function ew(e){var n,t;let{children:r}=e,{data:l,isLoading:o,error:s,refetch:a}=(0,ex.a)({queryKey:eh.lineage(),queryFn:ef}),{data:c,refetch:d}=(0,ex.a)({queryKey:eh.runsAggregated(),queryFn:ea}),u=(0,E.useMemo)(()=>{let e=null==l?void 0:l.lineage;if(e&&e.base&&e.current)return function(e,n){let t={},i={},r=(e,n)=>({id:e,name:e,data:{},from:n,parents:{},children:{},isSelected:!1});for(let[n,i]of Object.entries(e.nodes))t[n]=r(n,"base"),i&&(t[n].data.base=i,t[n].name=null==i?void 0:i.name,t[n].resourceType=null==i?void 0:i.resource_type,t[n].packageName=null==i?void 0:i.package_name);for(let[e,i]of Object.entries(n.nodes))t[e]?t[e].from="both":t[e]=r(e,"current"),i&&(t[e].data.current=n.nodes&&n.nodes[e],t[e].name=null==i?void 0:i.name,t[e].resourceType=null==i?void 0:i.resource_type,t[e].packageName=null==i?void 0:i.package_name);for(let[n,r]of Object.entries(e.parent_map))for(let e of r){let r=t[n],l=t[e],o="".concat(e,"_").concat(n);if(!r||!l)continue;i[o]={id:o,from:"base",parent:l,child:r};let s=i[o];r.parents[e]=s,l.children[n]=s}for(let[e,r]of Object.entries(n.parent_map))for(let n of r){let r=t[e],l=t[n],o="".concat(n,"_").concat(e);if(!r||!l)continue;i[o]?i[o].from="both":i[o]={id:o,from:"current",parent:l,child:r};let s=i[o];r.parents[n]=s,l.children[e]=s}let l=[];for(let[e,n]of Object.entries(t))if("base"===n.from)n.changeStatus="removed",l.push(n.id);else if("current"===n.from)n.changeStatus="added",l.push(n.id);else{var o,s,a,c,d,u;let e=null==n?void 0:null===(a=n.data)||void 0===a?void 0:null===(s=a.base)||void 0===s?void 0:null===(o=s.checksum)||void 0===o?void 0:o.checksum,t=null==n?void 0:null===(u=n.data)||void 0===u?void 0:null===(d=u.current)||void 0===d?void 0:null===(c=d.checksum)||void 0===c?void 0:c.checksum;e&&t&&e!==t&&(n.changeStatus="modified",l.push(n.id))}for(let[e,n]of Object.entries(i))"base"===n.from?n.changeStatus="removed":"current"===n.from&&(n.changeStatus="added");return{nodes:t,edges:i,modifiedSet:l,manifestMetadata:{base:e.manifest_metadata||void 0,current:n.manifest_metadata||void 0},catalogMetadata:{base:e.catalog_metadata||void 0,current:n.catalog_metadata||void 0}}}(e.base,e.current)},[l]),h=null==s?void 0:s.message,x=null==l?void 0:l.lineage,m=null==l?void 0:l.demo,p=null==l?void 0:l.review_mode,f=null==l?void 0:l.cloud_mode,g=null==l?void 0:l.adapter_type,v=null==l?void 0:l.git,j={adapterType:g,git:v,pullRequest:null==l?void 0:l.pull_request,dbt:{base:null==x?void 0:null===(n=x.base)||void 0===n?void 0:n.manifest_metadata,current:null==x?void 0:null===(t=x.current)||void 0===t?void 0:t.manifest_metadata},sqlmesh:null==l?void 0:l.sqlmesh};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ek,{refetch:a}),(0,i.jsx)(eb.Provider,{value:{lineageGraph:u,retchLineageGraph:()=>{a()},envInfo:j,reviewMode:p,cloudMode:f,isDemoSite:m,error:h,isLoading:o,runsAggregated:c,refetchRunsAggregated:()=>{d()}},children:r})]})}let eC=()=>(0,E.useContext)(eb),e_=()=>{let{runsAggregated:e,refetchRunsAggregated:n}=eC();return[e,n]};function eS(e,n){if(e<n){let t=(n-e)/e*100;return"+".concat(t>=.1?t.toFixed(1):" <0.1 ","%")}if(!(e>n))return"0 %";{let t=(e-n)/e*100;return"-".concat(t>=.1?t.toFixed(1):" <0.1 ","%")}}var ez=t(42675),eT=t(53152),eR=t(18222),eE=t(30678),eI=t(2838),eO=t(13156),eA=t.n(eO);function eN(e,n){let t=[];return e.forEach(e=>{t.some(n=>n.name===e.name)||t.push(e)}),n.forEach(e=>{t.some(n=>n.name===e.name)||t.push(e)}),t}var eM=e=>{var n;let{lineageGraph:t}=eC(),[i,r]=(0,E.useState)([]),[l,o]=(0,E.useState)(),[s,a]=(0,E.useState)(!0),[c,d]=(0,E.useState)(null),u=eA().find(null==t?void 0:t.nodes,{name:e}),h=(0,E.useMemo)(()=>u?function(e){function n(e){return e&&e.columns?Object.values(e.columns):[]}return eN(n(e.data.base),n(e.data.current))}(u):[],[u]),x=u?null===(n=u.data.current)||void 0===n?void 0:n.primary_key:void 0;return(0,E.useEffect)(()=>{let e=async()=>{try{let e=(await eg(null==u?void 0:u.id)).model;if(!e||!e.base.columns||!e.current.columns){r([]);return}o(e.current.primary_key);let n=Object.values(e.base.columns),t=Object.values(e.current.columns);r(eN(n,t))}catch(e){d(e)}};h.length>0?(r(h),o(x)):(null==u?void 0:u.id)===void 0?r([]):e(),a(!1)},[null==u?void 0:u.id,h,x]),{columns:i,primaryKey:l,isLoading:s,error:c}},eL=t(41042),eF=t(81945),eD=t(14827);function eq(e){let n=e>0&&e<=.001,t=e<1&&e>=.999,i=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US",t=arguments.length>2?arguments[2]:void 0;return"number"!=typeof e?e:new Intl.NumberFormat(n,t).format(e)}(n,"en-US",{style:"percent",minimumFractionDigits:1})};if(n){let e=i(.001);return"<".concat(e)}if(t){let e=i(.999);return">".concat(e)}return i()}function eP(e){if("number"!=typeof e)return e;{let n=Math.abs(e),t=n>=.01,i=n>=1e6,r=n>=1e9,l=n>=1e15;if(l||n>=1e12)return new Intl.NumberFormat("en-US",{style:"unit",unit:"liter",unitDisplay:"narrow",maximumFractionDigits:l?0:2}).format(e/1e12).replace("L","T");if(r||i||n>=1e3){let n={base:r?1e9:i?1e6:1e3,unit:r?"B":i?"M":"K"};return new Intl.NumberFormat("en-US",{style:"unit",unit:"liter",unitDisplay:"narrow",maximumFractionDigits:1}).format(e/n.base).replace("L",n.unit)}return n>=1?new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(e):new Intl.NumberFormat("en-US",{maximumFractionDigits:t?3:2,notation:t||0===n?"standard":"scientific"}).format(e)}}let eW="#63B3ED",eH="#F6AD55",eV="".concat(eW,"A5"),eK="".concat(eH,"A5");function eU(e){let{color:n}=e;return(0,i.jsx)(b.xu,{display:"inline-block",w:"10px",h:"10px",bgColor:n,mr:"2",borderRadius:"sm"})}function eJ(e){let{data:n,hideAxis:t=!1,animation:r=!1}=e;eF.kL.register(eF.ZL,eF.RM,eF.f$,eF.uw,eF.u);let l=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{...t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{datasets:i,type:r,samples:l=0,binEdges:o}=e,[s,a]=i,c="datetime"===r;return{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{mode:"index",intersect:!1,callbacks:{title(e){let[{dataIndex:n,datasetIndex:t}]=e,i=eQ(o,n);return"".concat(c?"Date Range":"string"===r?"Text Length":"Value Range","\n").concat(i)},label(e){let{datasetIndex:n,dataIndex:t,dataset:{label:i}}=e,r=0===n?a.counts:s.counts,o=eq(r[t]/l),c=r[t];return"".concat(i,": ").concat(c," (").concat(o,")")}}}},scales:function(e){let{datasets:n,min:t=0,max:i=0,type:r,binEdges:l}=e,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],[s,a]=n,c=Math.max(...a.counts,...s.counts),d=l.map((e,n)=>eQ(l,n)).slice(0,-1);return{x:"datetime"===r?{display:!o,type:"timeseries",min:t,max:i,adapters:{date:{}},time:{minUnit:"day"},grid:{display:!1},ticks:{minRotation:30,maxRotation:30,maxTicksLimit:8}}:{display:!o,type:"category",grid:{display:!1},ticks:{callback:(e,n)=>d[n]},stacked:!0},y:{display:!o,type:"linear",max:c,border:{dash:[2,2]},grid:{color:"lightgray"},ticks:{maxTicksLimit:8,callback:function(e,n){return eP(e)}},beginAtZero:!0}}}(e,n),...t}}(n,t,{animation:r}),o=function(e){let{datasets:n,type:t,binEdges:i}=e,[r,l]=n,o=eB(t,i,"Current",eV,l),s=eB(t,i,"Base",eK,r);return{labels:i.map((e,n)=>eQ(i,n)).slice(0,-1),datasets:[o,s]}}(n);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(g.k,{alignItems:"center",direction:"row",children:[(0,i.jsx)(M.L,{}),(0,i.jsxs)(_.x,{as:"h3",size:"sm",p:"2",color:"gray",children:[(0,i.jsx)(eU,{color:eK})," Base"]}),(0,i.jsxs)(_.x,{as:"h3",size:"sm",p:"2",color:"gray",children:[(0,i.jsx)(eU,{color:eV})," Current"]}),(0,i.jsx)(M.L,{})]}),(0,i.jsx)(eD.kL,{type:"bar",options:l,data:o,plugins:[]})]})}function eB(e,n,t,i,r){let{counts:l=[]}=r;return{label:t,data:"datetime"===e?l.map((e,t)=>({x:n[t],y:e})):l,backgroundColor:i,borderColor:i,hoverBackgroundColor:i,borderWidth:0,categoryPercentage:1,barPercentage:1,xAxisID:"x"}}function eQ(e,n){let t=e[n],i=e[n+1],r=eP(t),l=eP(i);return"".concat(r," - ").concat(l)}var eX=t(20074),eZ=t(65952),eY=t(17695),e$=t(62628),eG=t(68830),e0=t(96985),e1=t(69384),e2=t(7797),e5=t(49989),e4=t(13844),e9=t(81737),e3=t.n(e9),e6=t(77249);function e8(){let e=(0,ev.p)();return{successToast:function(n){e({description:n,status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})},failToast:function(n,t){e({title:n,description:"".concat(t),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}}}var e7=t(50228),ne=t(67605),nn=t.n(ne);let nt="ignore-screenshot";function ni(e){let{renderLibrary:n="html2canvas",imageType:t="png",backgroundColor:r=null,boardEffect:l=!0,shadowEffect:o=!1,borderStyle:s="solid 1px #ccc",borderRadius:a="10px",onSuccess:c,onError:d,ignoreElements:u}=e,[h,x]=(0,E.useState)("idle"),m=(0,E.useRef)(null),{onOpen:p,setImgBlob:f,ImageDownloadModal:v}=function(){let{isOpen:e,onOpen:n,onClose:t}=(0,eZ.q)(),[r,l]=(0,E.useState)();return{onOpen:n,setImgBlob:l,ImageDownloadModal:function(){let[n,l]=(0,E.useState)();return(0,E.useEffect)(()=>{if(!r)return;let e=new FileReader;e.readAsDataURL(r),e.onloadend=e=>{var n,t;(null===(n=e.target)||void 0===n?void 0:n.result)&&(null===(t=e.target)||void 0===t?void 0:t.result)!==null&&l(e.target.result)}},[l]),(0,i.jsxs)(eY.u_,{size:"3xl",isOpen:e,onClose:t,children:[(0,i.jsx)(e$.Z,{}),(0,i.jsxs)(eG.h,{children:[(0,i.jsx)(e0.x,{children:"Screenshot Preview"}),(0,i.jsx)(e1.o,{}),(0,i.jsxs)(e2.f,{children:[(0,i.jsxs)(g.k,{px:"10px",gap:"10px",direction:"column",children:[(0,i.jsxs)(g.k,{alignItems:"center",gap:"5px",children:[(0,i.jsx)(K.s,{color:"red.600"}),(0,i.jsx)(_.x,{fontWeight:"500",display:"inline",children:"Copy to the Clipboard"})," ","is not supported in the current browser"]}),(0,i.jsx)(_.x,{children:"Please download it directly"})]}),(0,i.jsx)(e5.E,{src:n,alt:"screenshot"})]}),(0,i.jsxs)(e4.m,{children:[(0,i.jsx)(k.z,{mr:3,onClick:t,children:"Close"}),(0,i.jsx)(k.z,{colorScheme:"blue",onClick:()=>{if(!r)return;let e=new Date,n="recce-screenshot-".concat((0,e7.WU)(e,"yyyy-MM-dd-HH-mm-ss"),".png");nn()(r,n),t()},children:"Download"})]})]})]})}}}(),j=async()=>{if(!m.current)throw console.error("No node to use for screenshot"),Error("No node to use for screenshot");let e=m.current.element||m.current,t=e.style.overflow,i=e.style.border,c=e.style.borderRadius,d=e.style.backgroundColor,h=e.style.height;try{var p;e.style.overflow="hidden",e.style.border=l?s:"",e.style.borderRadius=l?a:"",e.style.backgroundColor=r||"",e.style.height=e.offsetHeight+"px";let t=document.createElement("style");document.head.appendChild(t),null===(p=t.sheet)||void 0===p||p.insertRule("body > div:last-child img { display: inline-block; }"),x("loading");let i="html2canvas"===n?await e3()(e,{logging:!1,backgroundColor:null,ignoreElements:u}):await (0,e6.rT)(e,{filter:u?e=>!u(e):void 0});t.remove();let c=o?document.createElement("canvas"):i;if(o){c.width=i.width+80,c.height=i.height+80;let e=c.getContext("2d");if(e)e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=20,e.shadowOffsetX=10,e.shadowOffsetY=10,e.drawImage(i,40,40);else throw console.error("Error getting canvas context"),Error("Error getting canvas context to add shadow effect")}let d=await fetch(c.toDataURL());return await d.blob()}catch(e){throw console.error("Error converting to image",e),e}finally{e.style.overflow=t,e.style.border=i,e.style.borderRadius=c,e.style.backgroundColor=d,e.style.height=h}};return{status:h,isLoading:"loading"===h,isErrored:"error"===h,isSuccess:"success"===h,copyToClipboard:async()=>{try{await navigator.clipboard.write([new ClipboardItem({["image/".concat(t)]:j()})]),x("success"),c&&c()}catch(e){"ClipboardItem is not defined"===e.message?(f(await j()),p(),x("success")):(x("error"),console.error("Error copying to clipboard",e),d&&d(e))}},ImageDownloadModal:v,ref:m}}function nr(e){let{successToast:n,failToast:t}=e8(),{isLoading:r,copyToClipboard:l,ImageDownloadModal:o,ref:s}=ni({imageType:"png",shadowEffect:!0,backgroundColor:(null==e?void 0:e.backgroundColor)||null,onSuccess:()=>{n("Copied the query result as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),t("Failed to copy image to clipboard",e)}});return{ref:s,CopyToClipboardButton:function(e){let{imageType:n="png",...t}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(k.z,{size:"sm",leftIcon:(0,i.jsx)(eX.T,{}),style:{position:"absolute",bottom:"16px",right:"16px"},isLoading:r,onMouseEnter:()=>{if(s.current){let e=s.current.element||s.current;e.style.boxShadow="rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px",e.style.transition="box-shadow 0.5s ease-in-out"}},onMouseLeave:()=>{s.current&&((s.current.element||s.current).style.boxShadow="")},onClick:async()=>{s.current&&(await l(),(s.current.element||s.current).style.boxShadow="")},children:"Copy to Clipboard"}),(0,i.jsx)(o,{})]})}}}let nl=e=>{let{backgroundColor:n="white",blockSize:t,children:r,...l}=e,{ref:o,CopyToClipboardButton:s}=nr({backgroundColor:n});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b.xu,{ref:o,...l,overflowY:"auto",overflowX:"hidden",children:(0,i.jsx)(b.xu,{backgroundColor:n,height:"100%",blockSize:t,children:r})}),(0,i.jsx)(s,{imageType:"png"})]})};t(63156);var no=t(22204);function ns(e){let{enableScreenshot:n=!0,...t}=e,{ref:r,CopyToClipboardButton:l}=nr();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(no.ZP,{ref:r,...t}),n&&(0,i.jsx)(l,{imageType:"png"})]})}function na(){return(0,i.jsx)(g.k,{h:"35px",alignItems:"center",justifyContent:"center",bg:"gray.100",style:{textAlign:"center",gridColumn:"1/-1"},children:(0,i.jsx)(_.x,{fontWeight:"600",children:" No rows"})})}function nc(e,n){let t=function(e,n){let t=[...e],i=[...n],r=[];for(;t.length>0&&i.length>0;)if(r.includes(t[0]))t.shift();else if(r.includes(i[0]))i.shift();else if(t[0]===i[0])r.push(t[0]),t.shift(),i.shift();else if(i.includes(t[0])){let e=i.indexOf(t[0]);for(let n=0;n<e;n++)r.includes(i[n])||r.push(i[n]);r.push(t[0]),t.shift(),i.splice(0,e+1)}else r.push(t[0]),t.shift();return t.forEach(e=>{r.includes(e)||r.push(e)}),i.forEach(e=>{r.includes(e)||r.push(e)}),r}(e,n),i={};for(let r of t)e.includes(r)?n.includes(r)?i[r]=void 0:i[r]="removed":i[r]="added";let r={};e.forEach((e,n)=>{r[e]=n});let l=-1;for(let e of t){let n=r[e];void 0!==n&&(n>l?l=n:i[e]="reordered")}return i}function nd(e,n){let t=[];for(let i of n){let n=e.findIndex(e=>e.name===i);if(n<0)throw Error("Column ".concat(i," not found"));t.push(n)}return t}function nu(e,n,t){let i={};if(0===n.length)return JSON.stringify({_index:t._index});for(let r of n)i[e[r].name]=t[r];return JSON.stringify(i)}function nh(e){let{name:n,columnStatus:t,onPrimaryKeyChange:r,onPinnedColumnsChange:l,...o}=e,s=o.primaryKeys||[],a=o.pinnedColumns||[],c=s.includes(n),d=a.includes(n);return"index"===n?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(g.k,{alignItems:"center",gap:"10px",className:"grid-header",children:[(0,i.jsx)(b.xu,{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:n}),"added"!==t&&"removed"!==t&&r&&(0,i.jsx)(w.J,{className:c?"close-icon":"key-icon",display:c?"block":"none",cursor:"pointer",as:c?L.ven:L.MhP,onClick:c?()=>{let e=s.filter(e=>e!==n);r&&r(e)}:()=>{let e=[...s.filter(e=>"index"!==e),n];r&&r(e)}}),!c&&l&&(0,i.jsx)(w.J,{className:d?"unpin-icon":"pin-icon",display:d?"block":"none",cursor:"pointer",as:d?L.$kI:L.oJP,onClick:d?()=>{let e=a.filter(e=>e!==n);l&&l(e)}:()=>{let e=[...a,n];l&&l(e)}})]})}t(87679);let nx=e=>{let n;let t=!1;return"boolean"==typeof e?n=e.toString():""===e?(n="(empty)",t=!0):null==e?(n="(null)",t=!0):n=e,[n,t]},nm=e=>{let{row:n,column:t}=e;if(!n.hasOwnProperty(t.key))return(0,i.jsx)(_.x,{style:{color:"gray"},children:"-"});let[r,l]=nx(n[t.key]);return(0,i.jsx)(_.x,{style:{color:l?"gray":"inherit"},children:r})};function np(e,n,t){let r=e||{columns:[],data:[]},l=n||{columns:[],data:[]},o=(null==t?void 0:t.primaryKeys)||[],s=(null==t?void 0:t.pinnedColumns)||[],a=(null==t?void 0:t.changedOnly)||!1,c=[],d=function(e,n){let t={};return Object.entries(nc(e.columns.map(e=>e.name),n.columns.map(e=>e.name))).map(i=>{let[r,l]=i;t[r]={status:l,baseColumnIndex:e.columns.findIndex(e=>e.name===r),currentColumnIndex:n.columns.findIndex(e=>e.name===r)}}),t}(r,l),u={},h={},x=!1,m=!1;if(0===o.length)r.data.forEach((e,n)=>{e._index=n+1,u[JSON.stringify({_index:n+1})]=e}),l.data.forEach((e,n)=>{e._index=n+1,h[JSON.stringify({_index:n+1})]=e});else{let e=nd(r.columns,o);r.data.forEach((n,t)=>{let i=nu(r.columns,e,n);i in u&&(x=!0),u[i]=n}),e=nd(l.columns,o),l.data.forEach((n,t)=>{let i=nu(l.columns,e,n);i in h&&(m=!0),h[i]=n})}let p=nc(Object.keys(u),Object.keys(h)),f={added:0,removed:0,modified:0},g=Object.entries(p).map(e=>{let[n,t]=e,i=u[n],s=h[n],a=JSON.parse(n);if(i&&r.columns.forEach((e,n)=>{o.includes(e.name)||(a["base__".concat(e.name)]=i[n])}),s&&l.columns.forEach((e,n)=>{o.includes(e.name)||(a["current__".concat(e.name)]=s[n])}),i){if(s){for(let[e,n]of Object.entries(d))"index"===e||o.includes(e)||n.baseColumnIndex<0||n.currentColumnIndex<0||eA().isEqual(i[n.baseColumnIndex],s[n.currentColumnIndex])||(a.__status="modified",n.status="modified");"modified"===a.__status&&f.modified++}else a.__status="removed",f.removed++}else a.__status="added",f.added++;return a});a&&(g=g.filter(e=>"added"===e.__status||"removed"===e.__status||"modified"===e.__status));let v=(e,n)=>{let r="added"===n?"diff-header-added":"removed"===n?"diff-header-removed":void 0,l=t=>{let i=t.__status;if("removed"===i)return"diff-cell-removed";if("added"===i)return"diff-cell-added";if("added"===n);else if("removed"===n);else if(!eA().isEqual(t["base__".concat(e)],t["current__".concat(e)]))return"diff-cell-modified"};return{headerCellClass:r,name:(0,i.jsx)(nh,{name:e,columnStatus:n,...t}),children:[{key:"base__".concat(e),name:"Base",renderEditCell:no.Ug,headerCellClass:r,cellClass:l,renderCell:nm,size:"auto"},{key:"current__".concat(e),name:"Current",renderEditCell:no.Ug,headerCellClass:r,cellClass:l,renderCell:nm,size:"auto"}]}};return 0===o.length?c.push({key:"_index",width:50,maxWidth:100,name:"",cellClass:"index-column"}):o.forEach(e=>{let n=d[e].status||"";c.push({key:"".concat(e),name:(0,i.jsx)(nh,{name:e,columnStatus:n,...t}),frozen:!0,cellClass:e=>{if(e.__status)return"diff-header-".concat(e.__status)},renderCell:nm})}),s.forEach(e=>{let n=d[e].status||"";"index"===e||o.includes(e)||c.push(v(e,n))}),Object.entries(d).forEach(e=>{let[n,t]=e,i=t.status||"";"index"===n||o.includes(n)||s.includes(n)||a&&f.modified>0&&"added"!==i&&"removed"!==i&&"modified"!==i||c.push(v(n,i))}),{columns:c,rows:g,invalidPKeyBase:x,invalidPKeyCurrent:m}}function nf(e){let{name:n,columnStatus:t,onPrimaryKeyChange:r,onPinnedColumnsChange:l,...o}=e,s=o.primaryKeys||[],a=o.pinnedColumns||[],c=s.includes(n),d=a.includes(n);return"index"===n?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(g.k,{alignItems:"center",gap:"10px",className:"grid-header",children:[(0,i.jsx)(b.xu,{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:n}),!c&&l&&(0,i.jsx)(w.J,{className:d?"unpin-icon":"pin-icon",display:d?"block":"none",cursor:"pointer",as:d?L.$kI:L.oJP,onClick:d?()=>{let e=a.filter(e=>e!==n);l&&l(e)}:()=>{let e=[...a,n];l&&l(e)}})]})}function ng(e,n,t){let r=(null==t?void 0:t.pinnedColumns)||[],l=(null==t?void 0:t.changedOnly)||!1,o=[],s=function(e){let n={};return e.columns.map((e,t)=>{n[e.name]={index:t}}),n}(e),a={},c={};if(0===n.length)throw Error("Primary keys are required");let d=function(e,n){let t=[];for(let i of n){let n=e.findIndex(e=>e.name===i);if(n<0)throw Error("Column ".concat(i," not found"));t.push(n)}return t}(e.columns,n),u=(s.in_a||s.IN_A).index,h=(s.in_b||s.IN_B).index;e.data.forEach((n,t)=>{let i=function(e,n,t){let i={};if(0===n.length)return JSON.stringify({_index:t._index});for(let r of n)i[e[r].name]=t[r];return JSON.stringify(i)}(e.columns,d,n);n[u]&&(a[i]=n),n[h]&&(c[i]=n)});let x=nc(Object.keys(a),Object.keys(c)),m={added:0,removed:0,modified:0},p=Object.entries(x).map(t=>{let[i,r]=t,l=a[i],o=c[i],d=JSON.parse(i);if(l&&e.columns.forEach((e,t)=>{n.includes(e.name)||(d["base__".concat(e.name)]=l[t])}),o&&e.columns.forEach((e,t)=>{n.includes(e.name)||(d["current__".concat(e.name)]=o[t])}),l){if(o)for(let[e,t]of Object.entries(s))!("index"===e||n.includes(e))&&(eA().isEqual(l[t.index],o[t.index])||(d.__status="modified",t.status="modified"));else d.__status="removed",m.removed++}else d.__status="added",m.added++;return"modified"===d.__status&&m.modified++,d});l&&(p=p.filter(e=>"added"===e.__status||"removed"===e.__status||"modified"===e.__status));let f=(e,n)=>{let r="added"===n?"diff-header-added":"removed"===n?"diff-header-removed":void 0,l=t=>{let i=t.__status;if("removed"===i)return"diff-cell-removed";if("added"===i)return"diff-cell-added";if("added"===n);else if("removed"===n);else if(!eA().isEqual(t["base__".concat(e)],t["current__".concat(e)]))return"diff-cell-modified"};return{headerCellClass:r,name:(0,i.jsx)(nf,{name:e,columnStatus:n,...t}),children:[{key:"base__".concat(e),name:"Base",renderEditCell:no.Ug,headerCellClass:r,cellClass:l,renderCell:nm,size:"auto"},{key:"current__".concat(e),name:"Current",renderEditCell:no.Ug,headerCellClass:r,cellClass:l,renderCell:nm,size:"auto"}]}};return n.forEach(e=>{let n=s[e].status||"";o.push({key:"".concat(e),name:(0,i.jsx)(nf,{name:e,columnStatus:n,...t}),frozen:!0,cellClass:e=>{if(e.__status)return"diff-header-".concat(e.__status)},renderCell:nm})}),r.forEach(e=>{let t=s[e].status||"";n.includes(e)||o.push(f(e,t))}),Object.entries(s).forEach(e=>{let[t,i]=e,s=i.status||"";"in_a"===t||"in_b"===t||n.includes(t)||r.includes(t)||l&&m.modified>0&&"added"!==s&&"removed"!==s&&"modified"!==s||o.push(f(t,s))}),{columns:o,rows:p}}var nv=t(18454),nj=t(93657);let ny=e=>{let{run:n,warnings:t,viewOptions:r,onAddToChecklist:l,onViewOptionsChanged:o}=e;return(0,i.jsxs)(g.k,{borderBottom:"1px solid lightgray",justifyContent:"flex-end",gap:"5px",alignItems:"center",px:"10px",bg:t&&t.length>0?"orange.100":"inherit",children:[(0,i.jsx)(y.g,{alignItems:"flex-start",spacing:0,children:t&&t.map((e,n)=>(0,i.jsxs)(b.xu,{children:[(0,i.jsx)(U.a,{color:"orange.600"})," ",e]},n))}),(0,i.jsx)(M.L,{minHeight:"32px"}),(0,i.jsx)(nj.X,{isChecked:null==r?void 0:r.changed_only,onChange:()=>{let e=!(null==r?void 0:r.changed_only);o&&o({...r,changed_only:e})},children:"Changed only"}),l&&(0,i.jsx)(N.u,{label:"Add to Checklist",children:(0,i.jsx)(X.h,{variant:"unstyled",size:"sm","aria-label":"Add",icon:(0,i.jsx)(nv.d,{}),onClick:()=>l(n)})})]})},nb=e=>{var n,t,r,l,o,s;let{run:a,onAddToChecklist:c,viewOptions:d,onViewOptionsChanged:u}=e,h=(0,E.useMemo)(()=>(null==d?void 0:d.primary_keys)||[],[d]),x=(0,E.useMemo)(()=>(null==d?void 0:d.changed_only)||!1,[d]),m=(0,E.useMemo)(()=>(null==d?void 0:d.pinned_columns)||[],[d]),p=(0,E.useMemo)(()=>{var e,n;return np(null==a?void 0:null===(e=a.result)||void 0===e?void 0:e.base,null==a?void 0:null===(n=a.result)||void 0===n?void 0:n.current,{changedOnly:x,primaryKeys:h,onPrimaryKeyChange:e=>{u&&u({...d,primary_keys:e})},pinnedColumns:m,onPinnedColumnsChange:e=>{u&&u({...d,pinned_columns:e})}})},[a,d,x,h,m,u]),f=(0,E.useMemo)(()=>{let e=h.join(", ");return p.invalidPKeyBase&&p.invalidPKeyCurrent?"Warning: The primary key '".concat(e,"' is not unique in the base and current environments"):p.invalidPKeyBase?"Warning: The primary key '".concat(e,"' is not unique in the base environment"):p.invalidPKeyCurrent?"Warning: The primary key '".concat(e,"' is not unique in the current environment"):void 0},[p.invalidPKeyBase,p.invalidPKeyCurrent,h]),v=(null===(t=a.result)||void 0===t?void 0:null===(n=t.current)||void 0===n?void 0:n.limit)||0,y=v>0&&((null==a?void 0:null===(l=a.result)||void 0===l?void 0:null===(r=l.current)||void 0===r?void 0:r.more)||(null==a?void 0:null===(s=a.result)||void 0===s?void 0:null===(o=s.base)||void 0===o?void 0:o.more))?"Warning: Displayed results are limited to ".concat(v.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,b=[];return(f&&b.push(f),y&&b.push(y),0===p.columns.length)?(0,i.jsx)(j.M,{height:"100%",children:"No data"}):x&&0===p.rows.length?(0,i.jsxs)(g.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ny,{run:a,viewOptions:d,onAddToChecklist:c,onViewOptionsChanged:u,warnings:b}),(0,i.jsx)(j.M,{height:"100%",children:"No change"}),";"]}):(0,i.jsxs)(g.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ny,{run:a,viewOptions:d,onAddToChecklist:c,onViewOptionsChanged:u,warnings:b}),(0,i.jsx)(ns,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:p.columns,rows:p.rows,renderers:{noRowsFallback:(0,i.jsx)(na,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})},nk=e=>{var n,t,r,l;let{run:o,onAddToChecklist:s,viewOptions:a,onViewOptionsChanged:c}=e,d=(0,E.useMemo)(()=>(null==a?void 0:a.changed_only)||!1,[a]),u=(0,E.useMemo)(()=>(null==a?void 0:a.pinned_columns)||[],[a]),h=(0,E.useMemo)(()=>{var e,n;if(!(null===(e=o.result)||void 0===e?void 0:e.diff)||!(null==o?void 0:null===(n=o.params)||void 0===n?void 0:n.primary_keys))return{columns:[],rows:[]};let t=o.params.primary_keys;return ng(null==o?void 0:o.result.diff,t,{changedOnly:d,pinnedColumns:u,onPinnedColumnsChange:e=>{c&&c({...a,pinned_columns:e})}})},[o,a,d,u,c]),x=(null===(t=o.result)||void 0===t?void 0:null===(n=t.diff)||void 0===n?void 0:n.limit)||0,m=x>0&&(null==o?void 0:null===(l=o.result)||void 0===l?void 0:null===(r=l.diff)||void 0===r?void 0:r.more)?"Warning: Displayed results are limited to ".concat(x.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,p=[];return(m&&p.push(m),0===h.columns.length)?(0,i.jsx)(j.M,{height:"100%",children:"No data"}):d&&0===h.rows.length?(0,i.jsxs)(g.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ny,{run:o,viewOptions:a,onAddToChecklist:s,onViewOptionsChanged:c,warnings:p}),(0,i.jsx)(j.M,{height:"100%",children:"No change"})]}):(0,i.jsxs)(g.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ny,{run:o,viewOptions:a,onAddToChecklist:s,onViewOptionsChanged:c,warnings:p}),(0,i.jsx)(ns,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:h.columns,rows:h.rows,renderers:{noRowsFallback:(0,i.jsx)(na,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})},nw=e=>{var n;return(null===(n=e.run)||void 0===n?void 0:n.result)!==void 0&&null!==e.run.result.diff?(0,i.jsx)(nk,{...e}):(0,i.jsx)(nb,{...e})};function nC(e){let{name:n,pinnedColumns:t=[],onPinnedColumnsChange:r=()=>{}}=e,l=t.includes(n);return(0,i.jsxs)(g.k,{className:"grid-header",alignItems:"center",children:[(0,i.jsx)(b.xu,{flex:1,children:n}),(0,i.jsx)(w.J,{className:l?"unpin-icon":"pin-icon",display:l?"block":"none",cursor:"pointer",as:l?L.$kI:L.oJP,onClick:l?()=>{r(t.filter(e=>e!==n))}:()=>{r([...t,n])}})]})}let n_=e=>{let{run:n,viewOptions:t,onViewOptionsChanged:r,onAddToChecklist:l}=e,o=(0,E.useMemo)(()=>(null==t?void 0:t.pinned_columns)||[],[t]),s=null==n?void 0:n.result,a=(0,E.useMemo)(()=>s?function(e,n){let t=[],r=n.pinnedColumns||[],l=(e,t)=>({key:String(e),name:(0,i.jsx)(nC,{name:t,...n}),width:"auto",renderCell:nm});return t.push({key:"_index",name:"",width:50,cellClass:"index-column"}),r.forEach(n=>{let i=eA().findIndex(e.columns,e=>e.name===n);i<0||t.push(l(i,n))}),e.columns.forEach((e,n)=>{r.includes(e.name)||t.push(l(n,e.name))}),e.data.forEach((e,n)=>{e._index=n+1}),{columns:t,rows:e.data}}(s,{pinnedColumns:o,onPinnedColumnsChange:e=>{r&&r({...t,pinned_columns:e})}}):{rows:[],columns:[]},[s,o,t,r]);if(0===a.columns.length)return(0,i.jsx)(j.M,{height:"100%",children:"No data"});let c=(null==s?void 0:s.limit)||0,d=c>0&&(null==s?void 0:s.more)?"Warning: Displayed results are limited to ".concat(c.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,u=l||d;return(0,i.jsxs)(g.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[u&&(0,i.jsxs)(g.k,{borderBottom:"1px solid lightgray",alignItems:"center",gap:"5px",px:"10px",bg:d?"orange.100":"inherit",children:[d&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(U.a,{color:"orange.600",alignSelf:"center"})," ",(0,i.jsx)(b.xu,{children:d})]}),(0,i.jsx)(M.L,{minHeight:"32px"}),l&&(0,i.jsx)(N.u,{label:"Add to Checklist",children:(0,i.jsx)(X.h,{variant:"unstyled",size:"sm","aria-label":"Add",icon:(0,i.jsx)(nv.d,{}),onClick:()=>l(n)})})]}),(0,i.jsx)(ns,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:a.columns,rows:a.rows,renderers:{noRowsFallback:(0,i.jsx)(na,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})};function nS(e){let{run:n}=e;function t(e){if(e.base===e.current);else if(e.base<e.current||"N/A"===e.base)return"column-body-added";else if(e.base>e.current||"N/A"===e.current)return"column-body-removed";return"column-body-normal"}let r=n.result||{},l=Object.keys(n.result||{}).map(e=>{let n=r[e],t=(null==n?void 0:n.base)||null,i=(null==n?void 0:n.curr)||null,l="No Change";return null!==t&&null!==i?l=t!==i?eS(t,i):"No Change":t===i?l="N/A":null===t?l="Added":null===i&&(l="Removed"),{name:e,base:null===t?"N/A":Number(t),current:null===i?"N/A":Number(i),delta:l}});return(0,i.jsx)(g.k,{direction:"column",children:Object.keys(r).length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ns,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:[{key:"name",name:"Name",cellClass:t},{key:"base",name:"Base Rows",cellClass:t},{key:"current",name:"Current Rows",cellClass:t},{key:"delta",name:"Delta",cellClass:t}],rows:l,renderers:{noRowsFallback:(0,i.jsx)(na,{})},className:"rdg-light",enableScreenshot:!0})})})}var nz=t(78390),nT=t(96124);let nR="#63B3ED";function nE(e,n){let t=n?10:e.counts.length,i=e.counts.slice(0,t),r=e.valids-i.reduce((e,n)=>e+n,0);return e.values.slice(0,t).concat([r]).map((n,t)=>{let l;let o=t===i.length,s=o?r:i[t],a=!1;return o?(l="(others)",a=!0):null==n?(l="(null)",a=!0):"string"==typeof n&&0===n.length?(l="(empty)",a=!0):l=String(n),{isLastItemOthers:o,isSpecialLabel:a,label:l,count:s,displayCount:eP(s),displayRatio:eq(s/e.valids)||"N/A"}})}function nI(e){let{base:n,current:t,children:r}=e;return(0,i.jsx)(N.u,{label:(0,i.jsxs)(b.xu,{children:[(0,i.jsxs)(_.x,{children:[(0,i.jsx)(eU,{color:eW}),"Current: ",t.count," (",t.displayRatio,")"]}),(0,i.jsxs)(_.x,{children:[(0,i.jsx)(eU,{color:eH}),"Base: ",n.count," (",n.displayRatio,")"]})]}),placement:"auto",hasArrow:!0,children:r})}function nO(e){let{topKDiff:n,isDisplayTopTen:t}=e,r=nE(n.current,t),l=nE(n.base,t);return(0,i.jsxs)(b.xu,{w:"100%",px:20,py:4,children:[(0,i.jsxs)(g.k,{alignItems:"center",direction:"row",children:[(0,i.jsx)(M.L,{}),(0,i.jsxs)(_.x,{as:"h3",size:"sm",p:"2",color:"gray",children:[(0,i.jsx)(eU,{color:eH})," Base"]}),(0,i.jsxs)(_.x,{as:"h3",size:"sm",p:"2",color:"gray",children:[(0,i.jsx)(eU,{color:eW})," Current"]}),(0,i.jsx)(M.L,{})]}),r.map((e,t)=>{let r=l[t];return e.isLastItemOthers&&0===e.count&&0===r.count?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(E.Fragment,{children:[(0,i.jsx)(nI,{base:r,current:e,children:(0,i.jsxs)(g.k,{alignItems:"center",width:"100%",_hover:{bg:"blackAlpha.300"},px:4,children:[(0,i.jsx)(_.x,{noOfLines:1,width:"10em",fontSize:"sm",color:e.isSpecialLabel?"gray.400":"inherit",children:e.label}),(0,i.jsxs)(g.k,{width:"70%",direction:"column",children:[(0,i.jsxs)(g.k,{height:"1em",children:[(0,i.jsx)(nA,{topkCount:e.count,topkLabel:e.label,valids:n.current.valids,color:eW}),(0,i.jsx)(_.x,{ml:5,mr:2,fontSize:"sm",width:"6em",children:e.displayCount}),(0,i.jsx)(_.x,{color:"gray.400",fontSize:"sm",width:"4em",children:e.displayRatio})]}),(0,i.jsxs)(g.k,{height:"1em",children:[(0,i.jsx)(nA,{topkCount:r.count,topkLabel:r.label,valids:n.base.valids,color:eH}),(0,i.jsx)(_.x,{ml:5,mr:2,fontSize:"sm",width:"6em",children:r.displayCount}),(0,i.jsx)(_.x,{color:"gray.400",fontSize:"sm",width:"4em",children:r.displayRatio})]})]})]})}),(0,i.jsx)(nT.i,{})]},t)})]})}function nA(e){let{topkCount:n,topkLabel:t,valids:r,animation:l=!1,color:o=nR}=e;eF.kL.register(eF.uw,eF.ZL,eF.f$);let s=function(e,n){let{...t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{display:!1,max:n,grid:{display:!1}},y:{display:!1}},plugins:{tooltip:{enabled:!1}},...t}}(n,r,{animation:l}),a=function(e){let{topkLabel:n,topkCount:t,color:i=nR}=e;return{labels:[n],datasets:[{indexAxis:"y",data:[t],backgroundColor:i,hoverBackgroundColor:i,borderWidth:0,borderColor:i,barPercentage:1,categoryPercentage:.6}]}}({topkCount:n,topkLabel:t,color:o});return(0,i.jsx)(eD.$Q,{data:a,options:s,plugins:[]})}var nN=t(93960),nM=t(66011);function nL(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:r}=e,[l,o]=(0,E.useState)(!n.columns||0===n.columns.length),s=null==n?void 0:n.model,a=null==n?void 0:n.primary_key,{columns:c,primaryKey:d,isLoading:u,error:h}=eM(n.model);(0,E.useEffect)(()=>{!a&&d&&t({...n,primary_key:d})},[a,d,n,t]),(0,E.useEffect)(()=>{r(!!a&&!!s)},[a,s,r]);let x=c.map(e=>e.name),m=Array.isArray(a)?a:a?[a]:void 0;return u?(0,i.jsx)(b.xu,{children:"Loading..."}):0===x.length||h?(0,i.jsx)(b.xu,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsxs)(y.g,{gap:5,m:"8px 24px",paddingBottom:"200px",children:[(0,i.jsxs)(eR.NI,{children:[(0,i.jsx)(eE.l,{children:"Model"}),(0,i.jsx)(nN.I,{isReadOnly:!0,value:null==n?void 0:n.model})]}),(0,i.jsxs)(eR.NI,{children:[(0,i.jsx)(eE.l,{children:"Primary key"}),(0,i.jsx)(nM.Z,{placeholder:"Select primary key",isMulti:!0,closeMenuOnSelect:!1,options:(x||[]).map(e=>({label:e,value:e})),value:(m||[]).map(e=>({label:e,value:e})),onChange:e=>{t({...n,primary_key:1==e.length?e[0].value:e.map(e=>e.value)})}})]}),(0,i.jsxs)(eR.NI,{children:[(0,i.jsx)(eE.l,{children:"Columns"}),(0,i.jsx)(nj.X,{marginBottom:"10px",isChecked:l,onChange:e=>{o(e.target.checked),t({...n,columns:void 0})},children:"All columns"}),!l&&(0,i.jsx)(nM.Z,{isMulti:!0,closeMenuOnSelect:!1,options:(x||[]).map(e=>({label:e,value:e})),value:(n.columns||[]).map(e=>({label:e,value:e})),onChange:e=>{t({...n,columns:(e||[]).map(e=>e.value)})}})]})]})}var nF=t(50104),nD=t(78439),nq=t(70949);async function nP(){return(await en.post("/api/checks",{type:"simple"})).data}async function nW(e){return(await en.post("/api/checks",{type:"schema_diff",params:{node_id:e}})).data}async function nH(e,n){return(await en.post("/api/checks",{run_id:e,view_options:n})).data}async function nV(){return(await en.get("/api/checks")).data}async function nK(e){return(await en.get("/api/checks/".concat(e))).data}async function nU(e,n){return(await en.patch("/api/checks/".concat(e),n)).data}async function nJ(e){return(await en.delete("/api/checks/".concat(e))).data}async function nB(e){return await en.post("/api/checks/reorder",e)}var nQ=t(94019),nX=t(76330),nZ=t(89725),nY=t(13965);let n$=e=>{var n,t;let{isPending:r,isAborting:l,isCheckDetail:o,progress:s,error:a,run:c,onCancel:d,viewOptions:u,onViewOptionsChanged:h,RunResultView:x,children:m,onExecuteRun:p}=e,f=(null==a?void 0:null===(t=a.response)||void 0===t?void 0:null===(n=t.data)||void 0===n?void 0:n.detail)||(null==c?void 0:c.error);if(f)return(0,i.jsxs)(nZ.b,{status:"error",children:[(0,i.jsx)(nY.z,{}),"Error: ",f]});if(r){let e=(null==s?void 0:s.message)?null==s?void 0:s.message:"Loading...";return(0,i.jsx)(j.M,{p:"16px",height:"100%",bg:"rgb(249,249,249)",children:(0,i.jsxs)(y.g,{children:[(0,i.jsxs)(g.k,{alignItems:"center",children:[(null==s?void 0:s.percentage)===void 0||(null==s?void 0:s.percentage)===null?(0,i.jsx)(J.D,{isIndeterminate:!0,size:"20px",mr:"8px"}):(0,i.jsx)(J.D,{size:"20px",value:100*s.percentage,mr:"8px"}),l?(0,i.jsx)(i.Fragment,{children:"Aborting..."}):(0,i.jsx)(i.Fragment,{children:e})]}),!l&&(0,i.jsx)(k.z,{onClick:d,colorScheme:"blue",size:"sm",children:"Cancel"})]})})}if(!c)return o?(0,i.jsx)(j.M,{bg:"rgb(249,249,249)",height:"100%",children:(0,i.jsx)(k.z,{onClick:p,colorScheme:"blue",size:"sm",children:"Run Query"})}):(0,i.jsx)(j.M,{bg:"rgb(249,249,249)",height:"100%",children:"No Data"});if(m&&x)throw Error("RunView requires either a children or a RunResultView prop, but not both.");if(!m&&!x)throw Error("RunView requires at least one of children or RunResultView prop.");return(0,i.jsxs)(b.xu,{h:"100%",style:{contain:"size layout"},overflow:"auto",children:[x&&(0,i.jsx)(x,{run:c,viewOptions:u,onViewOptionsChanged:h}),m&&m({run:c,viewOptions:u,onViewOptionsChanged:h})]})};var nG=t(65674);let n0=e=>{let{isOpen:n,onClose:t,type:r,title:l,params:o,initialRun:s,RunForm:a,RunResultView:c}=e,[,d]=(0,nX.TH)(),[u,h]=(0,E.useState)(),[x,m]=(0,E.useState)(o),[p,f]=(0,E.useState)(!1),[v,j]=(0,E.useState)(!1),[y,w]=(0,E.useState)(),[C,_]=(0,E.useState)(),[S,z]=(0,E.useState)(s),T=async()=>{let{run_id:e}=await ei(r,x,{nowait:!0});for(h(e);;){let n=await er(e,2);if(w(n.progress),n.result||n.error)return f(!1),w(void 0),n}},{data:R,mutate:I,reset:O,error:A,isPending:N}=(0,nQ.D)({mutationFn:T});(0,E.useEffect)(()=>{n&&void 0===a&&void 0===S&&I()},[n]);let M=(0,ep.NL)(),L=(0,E.useCallback)(async()=>{if(f(!0),u)return await el(u)},[u]),F=(0,E.useCallback)(()=>{I()},[I]),D=(0,E.useCallback)(()=>{I(),z(void 0)},[I]),q=()=>{f(!1),m(o),w(void 0),z(void 0),O()},P=(0,E.useCallback)(async()=>{let e=S?S.run_id:null==R?void 0:R.run_id;if(void 0===e)return;let n=await nH(e,C);M.invalidateQueries({queryKey:eh.checks()}),d("/checks/".concat(n.check_id))},[null==R?void 0:R.run_id,S,d,M,C]),W=async()=>{t(),N&&u&&await el(u),q()},H=!!(null==S?void 0:S.result)||!!(null==R?void 0:R.result),V=!!(null==S?void 0:S.error)||!!(null==R?void 0:R.error)||!!A,K=(null==S?void 0:S.run_at)?(0,nG.Q)(new Date(S.run_at),{addSuffix:!0}):null;return(0,i.jsxs)(eY.u_,{isOpen:n,onClose:W,size:"6xl",scrollBehavior:"inside",children:[(0,i.jsx)(e$.Z,{}),(0,i.jsxs)(eG.h,{overflowY:"auto",height:"75%",children:[(0,i.jsxs)(e0.x,{children:[l,!R&&!N&&K&&(0,i.jsx)(b.xu,{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontSize:"10pt",children:K})]}),(0,i.jsx)(e1.o,{}),(0,i.jsx)(e2.f,{p:"0px",h:"100%",overflow:"auto",borderY:"1px solid lightgray",children:N||R||A||S?(0,i.jsx)(n$,{isPending:N,isAborting:p,run:S||R,error:A,progress:y,onCancel:L,viewOptions:C,onViewOptionsChanged:_,RunResultView:c}):(0,i.jsx)(b.xu,{style:{contain:"layout"},children:a&&(0,i.jsx)(a,{params:x,onParamsChanged:m,setIsReadyToExecute:j})})}),(0,i.jsx)(e4.m,{children:(0,i.jsxs)(g.k,{gap:"10px",children:[(H||V)&&a&&(0,i.jsx)(k.z,{colorScheme:"blue",onClick:q,children:"Reset"}),H&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(k.z,{colorScheme:"blue",onClick:P,children:"Add to checklist"})}),N&&(0,i.jsx)(k.z,{onClick:L,isDisabled:p,colorScheme:"blue",children:"Cancel"}),!H&&!V&&!N&&(0,i.jsx)(k.z,{isDisabled:N||!v,colorScheme:"blue",onClick:F,children:"Execute"}),H&&!a&&(0,i.jsx)(k.z,{colorScheme:"blue",onClick:D,children:"Rerun"})]})})]})]})},n1=(0,E.createContext)({runAction:()=>{}}),n2=e=>{let[n]=(0,nX.TH)();(0,E.useEffect)(()=>{e()},[e,n])};function n5(e){var n;let{action:t,isOpen:r,onClose:l}=e,o=tn(t.type);if(void 0===o)throw Error("Unknown run type: ".concat(t.type));let{title:s,RunResultView:a,RunForm:c}=o;if(void 0===a)throw Error("Run type ".concat(t.type," does not have a result view"));return(0,i.jsx)(n0,{isOpen:r,onClose:l,title:s,type:t.type,params:t.params,initialRun:t.lastRun,RunResultView:a,RunForm:(null===(n=t.options)||void 0===n?void 0:n.showForm)&&c?c:void 0},t.session)}function n4(e){let{children:n}=e,[t,r]=(0,E.useState)(),{isOpen:l,onOpen:o,onClose:s}=(0,eZ.q)(),a=(0,E.useCallback)(async(e,n,t)=>{let i;let l=new Date().getTime().toString();if(null==t?void 0:t.showLast){let t=await es(e,n,1);1===t.length&&(i=t[0])}r({session:l,type:e,params:n,lastRun:i,options:t}),o()},[r,o]);return n2(s),(0,i.jsxs)(n1.Provider,{value:{runAction:a},children:[t&&(0,i.jsx)(n5,{action:t,isOpen:l,onClose:s}),n]})}let n9=()=>(0,E.useContext)(n1);function n3(e){let{params:n,column:t,containerRef:r}=e,{runAction:l}=n9(),o=(e,t)=>{l("value_diff_detail",{...n,...e},t)};return(0,i.jsxs)(g.k,{children:[(0,i.jsx)(b.xu,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t}),(0,i.jsx)(M.L,{}),(0,i.jsx)(z.v,{children:e=>{let{isOpen:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nF.j,{className:"row-context-menu",visibility:n?"visible":"hidden",width:n?"auto":"0px",minWidth:n?"auto":"0px",as:X.h,icon:(0,i.jsx)(w.J,{as:L.D_A}),variant:"unstyled",size:"sm"}),(0,i.jsx)(nD.h,{containerRef:r,children:(0,i.jsx)(T.q,{lineHeight:"20px",children:(0,i.jsxs)(nq.k,{title:"Action",as:b.xu,fontSize:"8pt",children:[(0,i.jsx)(R.s,{fontSize:"10pt",onClick:()=>o({},{showForm:!0}),children:"Show mismatched values..."}),(0,i.jsxs)(R.s,{fontSize:"10pt",onClick:()=>o({columns:[t]},{showForm:!1}),children:["Show mismatched values for '",t,"'"]})]})})})]})}})]})}function n6(e){let{run:n}=e,t=n.result,r=n.params,l=e=>{let n=e[2];return null!=n&&n<1?"diff-cell-modified":""},o=(0,E.useRef)(),s=Array.isArray(r.primary_key)?r.primary_key:[r.primary_key],a=[{key:"__is_pk__",name:"",width:30,maxWidth:30,renderCell:e=>{let{row:n}=e;return(0,i.jsx)(j.M,{height:"100%",children:s.includes(n[0])&&(0,i.jsx)(w.J,{as:L.MhP})})}},{key:"0",name:"Column",resizable:!0,renderCell:e=>{let{row:n,column:t}=e;return(0,i.jsx)(n3,{column:n[t.key],params:r,containerRef:o})},cellClass:"cell-show-context-menu"},{key:"1",name:"Matched",resizable:!0,cellClass:l},{key:"2",name:"Matched %",resizable:!0,renderCell:e=>{let{column:n,row:t}=e,r=t[n.key];return(0,i.jsx)(b.xu,{textAlign:"end",children:void 0!=r&&null!==r?"".concat((100*r).toFixed(2)," %"):"N/A"})},cellClass:l}];return(0,i.jsxs)(g.k,{direction:"column",gap:"5px",pt:"5px",height:"100%",ref:o,children:[(0,i.jsxs)(b.xu,{px:"16px",children:["Model: ",r.model,", ",t.summary.total," total (",t.summary.total-t.summary.added-t.summary.removed," ","common, ",t.summary.added," added, ",t.summary.removed," removed)"]}),(0,i.jsx)(ns,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",borderBlock:"1px solid lightgray"},columns:a,rows:t.data.data,renderers:{noRowsFallback:(0,i.jsx)(na,{})},defaultColumnOptions:{resizable:!0},className:"rdg-light",enableScreenshot:!0})]})}var n8=t(18502),n7=t(63594);let te={lineage_diff:{title:"Lineage Diff",icon:eT.Ks7},schema_diff:{title:"Schema Diff",icon:n7.C8A},query:{title:"Query",icon:eT.r2i,RunResultView:n_},query_diff:{title:"Query Diff",icon:eT.r2i,RunResultView:nw},row_count_diff:{title:"Row Count Diff",icon:n7.QUK,RunResultView:nS},profile_diff:{title:"Profile Diff",icon:eT.KA6,RunResultView:function(e){var n;let{run:t,viewOptions:r,onViewOptionsChanged:l}=e,o=t.result;t.params;let s=(0,E.useMemo)(()=>(null==r?void 0:r.pinned_columns)||[],[r]),a=((null==o?void 0:null===(n=o.current)||void 0===n?void 0:n.columns)||[]).find(e=>"column_name"===e.name.toLowerCase()),c=(null==a?void 0:a.name)||"column_name",d=(0,E.useMemo)(()=>np(null==o?void 0:o.base,null==o?void 0:o.current,{primaryKeys:[c],pinnedColumns:s,onPinnedColumnsChange:e=>{l&&l({...r,pinned_columns:e})}}),[o,c,s,r,l]);return 0===d.columns.length?(0,i.jsx)(j.M,{height:"100%",children:"No data"}):(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ns,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:d.columns,rows:d.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})})}},value_diff:{title:"Value Diff",icon:eT.pRi,RunResultView:n6,RunForm:nL},value_diff_detail:{title:"Value Diff Detail",icon:eT.pRi,RunResultView:e=>{var n,t;let{run:r,onAddToChecklist:l,viewOptions:o,onViewOptionsChanged:s}=e,a=(0,E.useMemo)(()=>(null==o?void 0:o.changed_only)||!1,[o]),c=(0,E.useMemo)(()=>(null==o?void 0:o.pinned_columns)||[],[o]),d=(0,E.useMemo)(()=>{var e;if(!r.result||!(null==r?void 0:null===(e=r.params)||void 0===e?void 0:e.primary_key))return{columns:[],rows:[]};let n=r.params.primary_key,t=Array.isArray(n)?n:[n];return ng(null==r?void 0:r.result,t,{changedOnly:a,pinnedColumns:c,onPinnedColumnsChange:e=>{s&&s({...o,pinned_columns:e})}})},[r,o,a,c,s]),u=(null===(n=r.result)||void 0===n?void 0:n.limit)||0,h=u>0&&(null==r?void 0:null===(t=r.result)||void 0===t?void 0:t.more)?"Warning: Displayed results are limited to ".concat(u.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,x=[];return(h&&x.push(h),0===d.columns.length)?(0,i.jsx)(j.M,{height:"100%",children:"No data"}):a&&0===d.rows.length?(0,i.jsxs)(g.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ny,{run:r,viewOptions:o,onAddToChecklist:l,onViewOptionsChanged:s,warnings:x}),(0,i.jsx)(j.M,{height:"100%",children:"No change"}),";"]}):(0,i.jsxs)(g.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ny,{run:r,viewOptions:o,onAddToChecklist:l,onViewOptionsChanged:s,warnings:x}),(0,i.jsx)(ns,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:d.columns,rows:d.rows,renderers:{noRowsFallback:(0,i.jsx)(na,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})},RunForm:nL},top_k_diff:{title:"Top-K Diff",icon:n8.Pkc,RunResultView:function(e){let{run:n}=e,[t,r]=(0,E.useState)(!0),l=n.result,o=n.params,s=l.base,a=l.current;return(0,i.jsxs)(g.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(nl,{blockSize:"auto",children:[(0,i.jsxs)(eL.X,{as:"h1",size:"md",paddingTop:4,textAlign:"center",children:["Model ",o.model,".",o.column_name]}),(0,i.jsxs)(C.U,{children:[(0,i.jsx)(M.L,{}),(0,i.jsx)(nO,{topKDiff:l,valids:a.valids||0,isDisplayTopTen:t}),(0,i.jsx)(M.L,{})]})]}),(0,i.jsx)(M.L,{}),(s.values.length>10||a.values.length>10)&&(0,i.jsx)(g.k,{p:5,justify:"start",children:(0,i.jsx)(nz.r,{onClick:()=>r(e=>!e),textColor:"blue.500",children:t?"View More Items":"View Only Top-10"})})]})},RunForm:function(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:r}=e,{columns:l,isLoading:o,error:s}=eM(n.model),a=l.map(e=>e.name);return((0,E.useEffect)(()=>{r(!!n.column_name)},[n,r]),o)?(0,i.jsx)(b.xu,{children:"Loading..."}):0===a.length||s?(0,i.jsx)(b.xu,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsx)(b.xu,{m:"16px",children:(0,i.jsxs)(eR.NI,{children:[(0,i.jsx)(eE.l,{children:"Pick a column to show top-k"}),(0,i.jsx)(eI.P,{placeholder:"Select column",value:null==n?void 0:n.column_name,onChange:e=>{let i=e.target.value;t({...n,column_name:i})},children:a.map(e=>(0,i.jsx)("option",{value:e,children:e},e))})]})})}},histogram_diff:{title:"Histogram Diff",icon:eT.dku,RunResultView:function(e){var n,t,r,l,o,s;let{run:a}=e,c=a.params,d=null===(n=a.result)||void 0===n?void 0:n.base,u=null===(t=a.result)||void 0===t?void 0:t.current,h=null===(r=a.result)||void 0===r?void 0:r.min,x=null===(l=a.result)||void 0===l?void 0:l.max,m=null===(o=a.result)||void 0===o?void 0:o.bin_edges;return d&&u?(0,i.jsx)(g.k,{direction:"column",height:"500px",children:(0,i.jsxs)(nl,{height:"100%",children:[(0,i.jsxs)(eL.X,{as:"h1",size:"md",paddingTop:"4",textAlign:"center",children:["Model ",c.model,".",c.column_name]}),(0,i.jsxs)(C.U,{children:[(0,i.jsx)(M.L,{}),(0,i.jsx)(b.xu,{w:"80%",h:"300px",m:"4",children:(0,i.jsx)(eJ,{data:{type:(null===(s=a.params)||void 0===s?void 0:s.column_type)||"",datasets:[u,d],min:h,max:x,samples:d.total,binEdges:m}})}),(0,i.jsx)(M.L,{})]})]})}):(0,i.jsx)("div",{children:"Loading..."})},RunForm:function(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:r}=e,{columns:l,isLoading:o,error:s}=eM(n.model),a=l.filter(e=>!["CHAR","VARCHAR","TINYTEXT","TEXT","MEDIUMTEXT","LONGTEXT","NCHAR","NVARCHAR","VARCHAR2","NVARCHAR2","CLOB","NCLOB","VARCHAR(MAX)","XML","JSON","BOOLEAN","TINYINT(1)","BIT","NUMBER(1)","BOOL"].includes(e.type.toUpperCase())&&!["DATE","DATETIME","TIMESTAMP","TIME","YEAR","DATETIME2","SMALLDATETIME","DATETIMEOFFSET","INTERVAL","TIMESTAMPTZ","TIMETZ","TIMESTAMP WITH TIME ZONE","TIMESTAMP WITH LOCAL TIME ZONE","TIMESTAMP_LTZ","TIMESTAMP_NTZ","TIMESTAMP_TZ"].includes(e.type.toUpperCase()));return o?(0,i.jsx)(b.xu,{children:"Loading..."}):0===a.length||s?(0,i.jsx)(b.xu,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsx)(b.xu,{m:"16px",children:(0,i.jsxs)(eR.NI,{children:[(0,i.jsx)(eE.l,{children:"Pick a column to show Histogram Diff"}),(0,i.jsx)(eI.P,{placeholder:"Select column",value:null==n?void 0:n.column_name,onChange:e=>{var i;let l=e.target.value;r(!!l);let o=(null===(i=a.find(e=>e.name===l))||void 0===i?void 0:i.type)||"";t({...n,column_name:l,column_type:o})},children:a.map(e=>(0,i.jsxs)("option",{value:e.name,children:[e.name," : ",e.type]},e.name))})]})})}}},tn=e=>te[e];function tt(e){let{node:n}=e,{icon:t}=V(n.resourceType);return(0,i.jsx)(N.u,{hasArrow:!0,label:"Type of resource",children:(0,i.jsxs)(B.Vp,{children:[(0,i.jsx)(B.AD,{as:t}),(0,i.jsx)(B.Sn,{children:n.resourceType})]})})}function ti(e){let{rowCount:n}=e,t=n.base,r=n.curr,l=null===n.base?"N/A":"".concat(n.base," rows"),o=null===n.curr?"N/A":"".concat(n.curr," rows");return null===t&&null===r?(0,i.jsx)(i.Fragment,{children:" Failed to load"}):null===t||null===r?(0,i.jsxs)(C.U,{children:[(0,i.jsx)(_.x,{children:l}),(0,i.jsx)(w.J,{as:Z.Rgz}),(0,i.jsx)(_.x,{children:o})]}):t===r?(0,i.jsxs)(C.U,{children:[(0,i.jsx)(_.x,{children:o}),(0,i.jsx)(w.J,{as:em.lxc,color:"gray.500"}),(0,i.jsx)(_.x,{color:"gray.500",children:"No Change"})]}):t<r?(0,i.jsxs)(C.U,{children:[(0,i.jsx)(_.x,{children:o}),(0,i.jsx)(w.J,{as:em.Tvk,color:"green.500"}),(0,i.jsx)(_.x,{color:"green.500",children:eS(t,r)})]}):(0,i.jsxs)(C.U,{children:[(0,i.jsx)(_.x,{children:o}),(0,i.jsx)(w.J,{as:em.ebp,color:"red.500"}),(0,i.jsx)(_.x,{color:"red.500",children:eS(t,r)})]})}function tr(e){var n,t,r;let l,{rowCount:o,node:s,isInteractive:a}=e,{runsAggregated:c,refetchRunsAggregated:d}=eC(),u=null==c?void 0:null===(t=c[s.id])||void 0===t?void 0:null===(n=t.row_count_diff)||void 0===n?void 0:n.result,{data:h,refetch:x,isFetching:m}=(0,ex.a)({queryKey:eh.rowCount(s.name),queryFn:()=>ed(s.name),enabled:!1,initialData:o}),p=h||o||u,f=null===(r=tn("row_count_diff"))||void 0===r?void 0:r.icon;if(p){let e=(null==p?void 0:p.base)===null?"N/A":null==p?void 0:p.base,n=(null==p?void 0:p.curr)===null?"N/A":null==p?void 0:p.curr;l="".concat(e," -> ").concat(n," rows")}return(0,i.jsx)(N.u,{label:l,children:(0,i.jsxs)(B.Vp,{children:[(0,i.jsx)(B.AD,{as:f}),(0,i.jsx)(B.Sn,{children:p||m?(0,i.jsx)(Q.N,{isLoaded:!m,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:p?(0,i.jsx)(ti,{rowCount:p}):"row count"}):(0,i.jsx)(i.Fragment,{children:"row count"})}),a&&(0,i.jsx)(B.bq,{as:X.h,isLoading:m,"aria-label":"Query Row Count",icon:(0,i.jsx)(ez.n,{}),size:"xs",onClick:async()=>{await x(),null==d||d()}})]})})}let tl=e=>{let{node:n,action:t}=e,{status:r,skipReason:l,run:o}=t;if("pending"===r)return(0,i.jsx)(J.D,{size:"20px",value:0});if("skipped"===r)return(0,i.jsxs)(g.k,{fontSize:"10pt",color:"gray",children:[(0,i.jsx)(b.xu,{children:"Skipped"}),l&&(0,i.jsx)(N.u,{label:l,children:(0,i.jsx)(K.s,{})})]});if(!o)return(0,i.jsx)(J.D,{isIndeterminate:!0,size:"20px"});let{error:s,result:a,run_id:c,progress:d}=o;if("running"===r)return(null==d?void 0:d.percentage)===void 0?(0,i.jsx)(J.D,{isIndeterminate:!0,size:"20px"}):(0,i.jsx)(J.D,{size:"20px",value:(null==d?void 0:d.percentage)*100});if(s)return(0,i.jsxs)(g.k,{fontSize:"10pt",color:"gray",children:[(0,i.jsx)(b.xu,{children:"Error"}),l&&(0,i.jsx)(N.u,{label:s,children:(0,i.jsx)(U.a,{})})]});if("value_diff"===o.type){let e=0;for(let n of a.data.data)n[2]<1&&e++;return(0,i.jsx)(B.Vp,{children:(0,i.jsx)(B.Sn,{children:(0,i.jsx)(g.k,{fontSize:"10pt",color:e>0?"red":"green",alignItems:"center",gap:"3px",children:e>0?"".concat(e," columns mismatched"):"All columns match"})})})}if("row_count_diff"===o.type){let e=o.result;return(0,i.jsx)(tr,{rowCount:e[n.name],node:n,isInteractive:!1})}return(0,i.jsx)(i.Fragment,{children:c})};function to(e,n){if(!e||!n)return;let t=Object.keys(e),i=Object.keys(n);if(t.length!==i.length)return!0;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!0;for(let t of i)if(!e[t]||e[t].type!==n[t].type)return!0;return!1}let ts=e=>{var n,t,r,l;let o,s,{id:a}=e,{lineageGraph:c,runsAggregated:d}=eC(),u=null==d?void 0:d[a],h=null==c?void 0:c.nodes[a];if(!u&&!h)return(0,i.jsx)(i.Fragment,{});if((null==h?void 0:h.data.base)&&(null==h?void 0:h.data.current)&&(o=to(null===(r=h.data.base)||void 0===r?void 0:r.columns,null===(l=h.data.current)||void 0===l?void 0:l.columns)),u&&u.row_count_diff){let e=u.row_count_diff;s=e.result.curr!==e.result.base}return(0,i.jsxs)(g.k,{gap:"5px",children:[void 0!==o&&(0,i.jsx)(N.u,{label:"Schema (".concat(o?"changed":"no change",")"),openDelay:500,children:(0,i.jsx)(b.xu,{height:"16px",children:(0,i.jsx)(w.J,{as:null===(n=tn("schema_diff"))||void 0===n?void 0:n.icon,color:o?H("modified").color:"lightgray"})})}),void 0!==s&&(0,i.jsx)(N.u,{label:"Row count (".concat(s?"changed":"no change",")"),openDelay:500,children:(0,i.jsx)(b.xu,{height:"16px",children:(0,i.jsx)(w.J,{as:null===(t=tn("row_count_diff"))||void 0===t?void 0:t.icon,color:s?H("modified").color:"lightgray"})})})]})};var ta=t(13358),tc=t(15196),td=t(84963),tu=t(78939),th=t(63993),tx=t(83246),tm=t(71738),tp=t(38414);function tf(e){let n,t,{base:r,current:l,enableScreenshot:o=!1}=e,{columns:s,rows:a}=(0,E.useMemo)(()=>(function(e){function n(e){return void 0===e.baseIndex?"column-index-added":void 0===e.currentIndex?"column-index-removed":!0===e.reordered?"column-index-reordered":"column-index-normal"}function t(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":e.baseType!==e.currentType?"column-body-type-changed":!0===e.reordered?"column-body-reordered":"column-body-normal"}return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:n},{key:"currentIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:n},{key:"name",name:"Name",resizable:!0,cellClass:function(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":!0===e.reordered?"column-body-reordered":"column-body-normal"}},{key:"baseType",name:"Base Type",resizable:!0,cellClass:t},{key:"currentType",name:"Current Type",resizable:!0,cellClass:t}],rows:Object.values(e)}})(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={};return Object.entries(nc(Object.keys(e),Object.keys(n))).forEach(e=>{let[n,i]=e;t[n]={name:n,reordered:"reordered"===i}}),Object.entries(e).map((e,n)=>{let[i,r]=e;t[i].baseIndex=n+1,t[i].baseType=r.type}),Object.entries(n).map((e,n)=>{let[i,r]=e;t[i].currentIndex=n+1,t[i].currentType=r.type}),t}(null==r?void 0:r.columns,null==l?void 0:l.columns)),[r,l]),{lineageGraph:c}=eC(),d=!(null==c?void 0:c.catalogMetadata.base),u=!(null==c?void 0:c.catalogMetadata.current);d&&u?n="catalog.json is missing on both current and base environments.":d?n="catalog.json is missing on base environment.":u&&(n="catalog.json is missing on current environment.");let h=r&&void 0===r.columns,x=l&&void 0===l.columns;return h&&x?t="Schema information is missing on both current and base environments.":h?t="Schema information is missing on base environment.":x&&(t="Schema information is missing on current environment."),(0,i.jsxs)(g.k,{direction:"column",children:[n?(0,i.jsxs)(nZ.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(nY.z,{}),n]}):t?(0,i.jsxs)(nZ.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(nY.z,{}),t]}):(0,i.jsx)(i.Fragment,{}),a.length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ns,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:s,rows:a,renderers:{noRowsFallback:(0,i.jsx)(na,{})},className:"rdg-light",enableScreenshot:o})})]})}t(81974);let tg='select * from {{ ref("mymodel") }}',tv=(0,E.createContext)({sqlQuery:tg,setSqlQuery:()=>{},primaryKeys:void 0,setPrimaryKeys:()=>{}});function tj(e){let{children:n}=e,[t,r]=E.useState(tg),[l,o]=E.useState();return(0,i.jsx)(tv.Provider,{value:{setSqlQuery:r,sqlQuery:t,setPrimaryKeys:o,primaryKeys:l},children:n})}let ty=()=>(0,E.useContext)(tv),tb=(0,E.createContext)({isNodesFetching:[],setIsNodesFetching:()=>{}});function tk(e){let{children:n}=e,[t,r]=E.useState([]);return(0,i.jsx)(tb.Provider,{value:{isNodesFetching:t,setIsNodesFetching:r},children:n})}var tw=t(31265);function tC(e){let{base:n,current:t}=e;return(0,i.jsx)(tw.SV,{height:"500px",language:"sql",theme:"vs",original:null==n?void 0:n.raw_code,modified:null==t?void 0:t.raw_code,options:{readOnly:!0,fontSize:14,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same"}})}function t_(e){let{node:n,onCloseNode:t}=e,[,r]=(0,nX.TH)(),{setSqlQuery:l,setPrimaryKeys:o}=ty(),s="model"===n.resourceType||"seed"===n.resourceType||"source"===n.resourceType||"snapshot"===n.resourceType,{isOpen:a,onOpen:c,onClose:d}=(0,eZ.q)(),{runAction:u}=n9(),{envInfo:h}=eC(),{primaryKey:x}=eM(n.name),m=(0,E.useCallback)(async()=>{let e=n.id,t=await nW(e);r("/checks/".concat(t.check_id))},[n,r]);return(0,i.jsxs)(tc.r,{height:"100%",templateRows:"auto auto 1fr",children:[(0,i.jsxs)(C.U,{children:[(0,i.jsx)(b.xu,{flex:"0 1 20%",p:"16px",children:(0,i.jsx)(eL.X,{size:"sm",children:n.name})}),(0,i.jsx)(M.L,{}),"modified"===n.changeStatus&&(0,i.jsxs)(b.xu,{children:[(0,i.jsx)(k.z,{onClick:c,leftIcon:(0,i.jsx)(F.tvD,{}),colorScheme:"orange",variant:"solid",children:"Diff"}),(0,i.jsxs)(eY.u_,{isOpen:a,onClose:d,size:"6xl",children:[(0,i.jsx)(e$.Z,{}),(0,i.jsxs)(eG.h,{overflowY:"auto",height:"75%",children:[(0,i.jsx)(e0.x,{children:"Model Raw Code Diff"}),(0,i.jsx)(e1.o,{}),(0,i.jsx)(e2.f,{children:(0,i.jsx)(tC,{base:n.data.base,current:n.data.current})})]})]})]}),(0,i.jsx)(b.xu,{flex:"0 1 1%",p:"16px",children:(0,i.jsx)(td.P,{onClick:t})})]}),(0,i.jsx)(b.xu,{color:"gray",paddingLeft:"16px",children:(0,i.jsxs)(C.U,{spacing:"8px",children:[(0,i.jsx)(tt,{node:n}),("model"===n.resourceType||"snapshot"===n.resourceType)&&(0,i.jsx)(tr,{node:n,isInteractive:!0})]})}),s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(tu.m,{overflow:"auto",as:g.k,children:[(0,i.jsx)(th.t,{children:(0,i.jsx)(tx.O,{children:"Columns"})}),(0,i.jsx)(tm.n,{overflow:"auto",height:"calc(100% - 42px)",children:(0,i.jsx)(tp.x,{p:0,overflowY:"auto",height:"100%",children:(0,i.jsx)(tf,{base:n.data.base,current:n.data.current})})})]}),(0,i.jsxs)(C.U,{p:"16px",children:[(0,i.jsxs)(z.v,{children:[(0,i.jsx)(nF.j,{as:k.z,size:"sm",colorScheme:"blue",children:"Add check"}),(0,i.jsx)(T.q,{children:(0,i.jsx)(R.s,{onClick:m,children:"Schema Check"})})]}),(0,i.jsx)(M.L,{}),"model"===n.resourceType&&(0,i.jsxs)(i.Fragment,{children:["added"!==n.changeStatus&&"removed"!==n.changeStatus&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(z.v,{children:[(0,i.jsx)(nF.j,{as:k.z,size:"sm",colorScheme:"blue",children:"Advanced Diffs"}),(0,i.jsxs)(T.q,{children:[(0,i.jsx)(R.s,{onClick:()=>{u("profile_diff",{model:n.name},{showForm:!1,showLast:!0})},children:"Profile Diff"}),(0,i.jsx)(R.s,{onClick:()=>{u("value_diff",{model:n.name},{showForm:!0,showLast:!0})},children:"Value Diff"}),(0,i.jsx)(R.s,{onClick:()=>{u("top_k_diff",{model:n.name,column_name:"",k:50},{showForm:!0})},children:"Top-K Diff"}),(0,i.jsx)(R.s,{onClick:()=>{u("histogram_diff",{model:n.name,column_name:"",column_type:""},{showForm:!0})},children:"Histogram Diff"})]})]})}),(0,i.jsx)(k.z,{colorScheme:"blue",size:"sm",onClick:()=>{(null==h?void 0:h.adapterType)==="dbt"?l('select * from {{ ref("'.concat(n.name,'") }}')):(null==h?void 0:h.adapterType)==="sqlmesh"&&l("select * from ".concat(n.name)),o(void 0!==x?[x]:void 0),r("/query")},children:"Query"})]})]})]})]})}var tS=t(88989),tz=t(12867),tT=t(25783),tR=t(27547);async function tE(e){return(await en.post("/api/checks",{type:"lineage_diff",params:{},view_options:e})).data}function tI(e){var n;let{nodes:t,onFinish:r}=e,[,l]=(0,nX.TH)();return(0,i.jsxs)(k.z,{size:"xs",variant:"outline",isDisabled:0===t.length,onClick:async()=>{let e;1===t.length?e=await nW(t[0].id):await Promise.all(t.map(async e=>{await nW(e.id)})),r(),e?l("/checks/".concat(e.check_id)):l("/checks")},children:[(0,i.jsx)(w.J,{as:null===(n=tn("schema_diff"))||void 0===n?void 0:n.icon}),"Add schema check"]})}function tO(e){var n;let{viewMode:t,nodes:r,onFinish:l,isDisabled:o,withIcon:s}=e,[,a]=(0,nX.TH)();return(0,i.jsxs)(k.z,{size:"xs",variant:"outline",backgroundColor:"white",isDisabled:0===r.length||o,onClick:async()=>{let e=r.map(e=>e.id),n=await tE({view_mode:t,node_ids:e});l(),n?a("/checks/".concat(n.check_id)):a("/checks")},children:[s&&(0,i.jsx)(w.J,{as:null===(n=tn("lineage_diff"))||void 0===n?void 0:n.icon}),"Add lineage diff check"]})}function tA(e){var n,t,r,l,o,s;let{viewMode:a,nodes:c,onClose:d,onActionStarted:u,onActionNodeUpdated:h,onActionCompleted:x}=e,[m,p]=(0,E.useState)({mode:"per_node",status:"pending",completed:0,total:0}),f=(0,ep.NL)(),[,g]=(0,nX.TH)(),v=async(e,n,t)=>{let i="multi_nodes";m.mode=i,u(),m.status="running";let r=[];for(let e of c){let t=n(e);t?(e.action={mode:i,status:"skipped",skipReason:t},h(e)):(e.action={mode:i,status:"pending"},r.push(e))}let l=t(r);try{let{run_id:n}=await ei(e,l,{nowait:!0});for(m.currentRun={run_id:n},m.total=1;;){let e=await er(n,2);m.currentRun=e;let t=e.error?"failure":e.result?"success":"running";for(let n of r)n.action={mode:i,status:t,run:e},h(n);if(e.error||e.result)break}}catch(e){}if(m.completed=1,"canceling"===m.status){m.status="canceled",x();return}m.status="completed",x()},j=async(e,n)=>{let t="per_node";for(let e of(m.mode=t,u(),m.status="running",c))e.action={mode:t,status:"pending"},h(e);for(let i of(m.completed=0,m.total=c.length,c)){let{params:r,skipReason:l}=n(i);if(l)i.action={mode:t,status:"skipped",skipReason:l},h(i);else try{let{run_id:n}=await ei(e,r,{nowait:!0});for(m.currentRun={run_id:n},i.action={mode:t,status:"running"},h(i);;){let e=await er(n,2);m.currentRun=e;let r=e.error?"failure":e.result?"success":"running";if(i.action={mode:t,status:r,run:e},h(i),e.error||e.result)break}}catch(e){}finally{m.currentRun=void 0}if(m.completed++,"canceling"===m.status){m.status="canceled",x();return}}m.status="completed",x()},y=async()=>{let e=[];for(let n of c)"model"!==n.resourceType?(n.action={mode:"multi_nodes",status:"skipped",skipReason:"Not a model"},h(n)):e.push(n.name);v("row_count_diff",e=>{if("model"!==e.resourceType)return"Not a model"},e=>({node_names:e.map(e=>e.name)}))},_=async()=>{j("value_diff",e=>{var n,t;let i=null===(t=e.data)||void 0===t?void 0:null===(n=t.current)||void 0===n?void 0:n.primary_key;return i?{params:{model:e.name,primary_key:i}}:{skipReason:"No primary key found. The first unique column is used as primary key."}})},S=async()=>{var e;m.status="canceling",(null===(e=m.currentRun)||void 0===e?void 0:e.run_id)&&el(m.currentRun.run_id)},z=(0,E.useCallback)(async()=>{var e;let n=null===(e=m.currentRun)||void 0===e?void 0:e.run_id;if(!n)return;let t=await nH(n);f.invalidateQueries({queryKey:eh.checks()}),g("/checks/".concat(t.check_id))},[null===(n=m.currentRun)||void 0===n?void 0:n.run_id,g,f]);return(0,tz.z)(()=>{"running"===m.status&&S()}),(0,i.jsxs)(b.xu,{bg:"white",rounded:"md",shadow:"dark-lg",children:["pending"===m.status&&(0,i.jsxs)(C.U,{p:"5px 15px",mt:"4",divider:(0,i.jsx)(tT.c,{borderColor:"gray.200"}),spacing:4,children:[(0,i.jsxs)(tR.h,{size:"xs",isAttached:!0,variant:"outline",rounded:"xs",onClick:d,children:[(0,i.jsxs)(k.z,{children:[c.length," selected"]}),(0,i.jsx)(X.h,{"aria-label":"Exit select Mode",icon:(0,i.jsx)(tS.D,{})})]}),(0,i.jsxs)(C.U,{children:[(0,i.jsx)(tI,{nodes:c,onFinish:d}),(0,i.jsx)(tO,{viewMode:a,nodes:c,onFinish:d,withIcon:!0})]}),(0,i.jsxs)(C.U,{children:[(0,i.jsxs)(k.z,{size:"xs",variant:"outline",isDisabled:0===c.length,onClick:y,children:[(0,i.jsx)(w.J,{as:null===(t=tn("row_count_diff"))||void 0===t?void 0:t.icon}),"Row count diff"]}),(0,i.jsxs)(k.z,{size:"xs",variant:"outline",isDisabled:0===c.length,onClick:_,children:[(0,i.jsx)(w.J,{as:null===(r=tn("value_diff"))||void 0===r?void 0:r.icon}),"Value diff"]})]})]}),"pending"!==m.status&&(0,i.jsxs)(C.U,{p:"5px 15px",mt:"4",divider:(0,i.jsx)(tT.c,{borderColor:"gray.200"}),spacing:4,children:[(0,i.jsxs)(b.xu,{fontSize:"10pt",children:["Progress: ","per_node"===m.mode?"".concat(m.completed," / ").concat(m.total):(null===(s=m.currentRun)||void 0===s?void 0:null===(o=s.progress)||void 0===o?void 0:o.percentage)?"".concat(100*m.currentRun.progress.percentage,"%"):"completed"===m.status?"100%":"0%"," ","canceled"===m.status?" (canceled)":""]}),"running"===m.status||"canceling"===m.status?(0,i.jsx)(k.z,{size:"xs",variant:"outline",onClick:S,isLoading:"canceling"===m.status,loadingText:"Canceling",children:"Cancel"}):(0,i.jsxs)(C.U,{children:["multi_nodes"===m.mode&&(null===(l=m.currentRun)||void 0===l?void 0:l.result)&&(0,i.jsx)(k.z,{display:"none",size:"xs",variant:"outline",onClick:z,children:"Add to checklist"}),(0,i.jsx)(k.z,{size:"xs",variant:"outline",onClick:d,children:"Close"})]})]})]})}var tN=t(28023);let tM=e=>{let{viewOptions:n,onViewOptionsChanged:t}=e,r=n.view_mode||"changed_models",l=e=>{t({...n,view_mode:e})};return(0,i.jsxs)(z.v,{children:[(0,i.jsx)(nF.j,{as:k.z,minWidth:"150px",leftIcon:(0,i.jsx)(w.J,{as:V("model").icon}),size:"xs",variant:"outline",children:"changed_models"===r?"Changed Models":"All"}),(0,i.jsxs)(T.q,{title:"packages",children:[(0,i.jsx)(R.s,{as:nj.X,size:"sm",isChecked:"changed_models"===r,onChange:()=>l("changed_models"),children:"Changed Models"}),(0,i.jsx)(R.s,{as:nj.X,size:"sm",isChecked:"all"===r,onChange:()=>l("all"),children:"All"})]})]})},tL=e=>{var n,t;let{viewOptions:r,onViewOptionsChanged:l}=e,{lineageGraph:o}=eC(),s=new Set;for(let e of Object.values((null==o?void 0:o.nodes)||{}))e.packageName&&s.add(e.packageName);let a=null==o?void 0:null===(t=o.manifestMetadata)||void 0===t?void 0:null===(n=t.current)||void 0===n?void 0:n.project_name,c=r.packages?new Set(r.packages):a?new Set([a]):s,d=c.size===s.size,u=0===c.size,h=1===c.size?Array.from(c)[0]:d?"All Packages":u?"No Package":"".concat(c.size," Packages"),x=e=>{let n=new Set(c);n.has(e)?n.delete(e):n.add(e),l({...r,packages:Array.from(n)})};return(0,i.jsxs)(z.v,{closeOnSelect:!1,children:[(0,i.jsx)(nF.j,{as:k.z,minWidth:"150px",leftIcon:(0,i.jsx)(w.J,{as:Z.zFh}),size:"xs",variant:"outline",children:h}),(0,i.jsx)(T.q,{title:"packages",children:(0,i.jsxs)(nq.k,{title:"Select Packages",children:[(0,i.jsx)(R.s,{as:nj.X,size:"sm",isIndeterminate:!d&&!u,isChecked:d,onChange:()=>{d?l({...r,packages:[]}):l({...r,packages:Array.from(s)})},children:"Select All"}),(0,i.jsx)(tN.R,{}),Array.from(s).map(e=>(0,i.jsx)(R.s,{as:nj.X,size:"sm",isChecked:c.has(e),onChange:()=>{console.log("selected"),x(e)},children:e},e))]})})]})},tF=e=>{let{onClose:n}=e;return(0,i.jsx)(b.xu,{bg:"white",rounded:"md",shadow:"dark-lg",children:(0,i.jsxs)(C.U,{p:"5px 15px",mt:"4",divider:(0,i.jsx)(tT.c,{borderColor:"gray.200"}),children:[(0,i.jsxs)(C.U,{children:[(0,i.jsx)(tM,{...e}),(0,i.jsx)(tL,{...e})]}),(0,i.jsxs)(tR.h,{size:"xs",isAttached:!0,variant:"outline",rounded:"xs",children:[(0,i.jsx)(k.z,{onClick:()=>n(!0),children:"Fit and Close"}),(0,i.jsx)(X.h,{"aria-label":"Exit filter Mode",icon:(0,i.jsx)(tS.D,{}),onClick:()=>n(!1)})]})]})})};function tD(e){var n,t,r,l,o,s,a,c,d;let{node:u,onCloseNode:h}=e,x=null===(n=u.action)||void 0===n?void 0:n.run,[,m]=(0,nX.TH)(),p=(0,ep.NL)(),[f,v]=(0,E.useState)(),j=(0,E.useCallback)(async()=>{if(!(null==x?void 0:x.run_id))return;let e=await nH(x.run_id,f);p.invalidateQueries({queryKey:eh.checks()}),m("/checks/".concat(e.check_id))},[null==x?void 0:x.run_id,m,p,f]),y=(null===(r=u.action)||void 0===r?void 0:null===(t=r.run)||void 0===t?void 0:t.type)==="value_diff"?n6:(null===(o=u.action)||void 0===o?void 0:null===(l=o.run)||void 0===l?void 0:l.type)==="row_count_diff"?nS:null;return(0,i.jsxs)(tc.r,{height:"100%",templateRows:"auto auto 1fr",children:[(0,i.jsxs)(C.U,{children:[(0,i.jsx)(b.xu,{flex:"0 1 20%",p:"16px",children:(0,i.jsx)(eL.X,{size:"sm",children:u.name})}),(0,i.jsx)(M.L,{}),(0,i.jsx)(b.xu,{flex:"0 1 1%",p:"16px",children:(0,i.jsx)(td.P,{onClick:h})})]}),(0,i.jsx)(b.xu,{color:"gray",paddingLeft:"16px",children:(0,i.jsxs)(C.U,{spacing:"8px",children:[(0,i.jsx)(tt,{node:u}),(null==x?void 0:x.type)==="row_count_diff"&&(null===(s=x.result)||void 0===s?void 0:s[u.name])&&(0,i.jsx)(tr,{rowCount:x.result[u.name],node:u})]})}),(0,i.jsxs)(tu.m,{overflow:"auto",as:g.k,children:[(0,i.jsx)(th.t,{children:(0,i.jsx)(tx.O,{children:"Run"})}),(0,i.jsx)(tm.n,{overflow:"auto",height:"calc(100% - 42px)",children:(0,i.jsx)(tp.x,{p:0,overflowY:"auto",height:"100%",children:y?(0,i.jsx)(n$,{run:null===(a=u.action)||void 0===a?void 0:a.run,viewOptions:f,onViewOptionsChanged:v,RunResultView:y}):(0,i.jsx)(b.xu,{p:"20px 10px",children:"No run result"})})})]}),(0,i.jsxs)(C.U,{p:"16px",children:[(0,i.jsx)(M.L,{}),(0,i.jsx)(k.z,{size:"sm",colorScheme:"blue",isDisabled:!(null===(d=u.action)||void 0===d?void 0:null===(c=d.run)||void 0===c?void 0:c.result),onClick:j,children:"Add to checklist"})]})]})}function tq(){return(0,i.jsx)(b.xu,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[n,[t,r]]=e,{icon:l,color:o}=H(n);return(0,i.jsx)(N.u,{label:r,children:(0,i.jsxs)(g.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,i.jsx)(w.J,{color:o,as:l})," ",t]})},n)})})}var tP=t(12282);t(15080);let tW=e=>{let{style:n,children:t,gutterSize:r=5,...l}=e;return(0,i.jsx)(tP.Z,{style:{display:"flex",flexDirection:"row",...n},direction:"horizontal",gutterSize:r,...l,children:t})},tH=e=>{let{style:n,children:t,gutterSize:r=5,...l}=e;return(0,i.jsx)(tP.Z,{style:{display:"flex",flexDirection:"column",...n},gutterSize:r,direction:"vertical",...l,children:t})},tV={customNode:function(e){var n,t;let l,{data:o}=e,{isHighlighted:s,isSelected:a,resourceType:c,changeStatus:d}=o,u=(0,r.oR)(e=>e.transform[2]>.3),{icon:h}=V(c),x="gray.400",m="solid";d&&(l=H(d).icon,x=H(d).color);let p=x,f=o.isSelected?"rgba(3, 102, 214, 0.5) 5px 5px 10px 3px":"unset",v=null==o?void 0:o.name;return(0,i.jsx)(N.u,{label:"model"===c?v:"".concat(v," (").concat(c,")"),placement:"top",children:(0,i.jsxs)(g.k,{width:"300px",_hover:{backgroundColor:u?"gray.100":x},borderColor:p,borderWidth:1,borderStyle:m,backgroundColor:u?"white":x,borderRadius:3,boxShadow:f,transition:"box-shadow 0.2s ease-in-out",padding:0,className:!0===s?"node-highlight":!0===a?"node-highlight":!1===s?"node-unhighlight":void 0,children:[(0,i.jsx)(g.k,{backgroundColor:x,padding:2,borderRightWidth:1,borderColor:p,borderStyle:m,alignItems:"top",visibility:u?"inherit":"hidden",children:(0,i.jsx)(w.J,{as:h})}),(0,i.jsxs)(g.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:[(0,i.jsxs)(g.k,{width:"100%",textAlign:"left",flex:"1",p:1,alignItems:"center",visibility:u?"inherit":"hidden",children:[(0,i.jsx)(b.xu,{flex:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:v}),l&&(0,i.jsx)(g.k,{children:(0,i.jsx)(w.J,{color:x,as:l,flex:"0 0 20px"})})]}),(0,i.jsx)(g.k,{flex:"1 0 auto",mx:"1",direction:"column",paddingBottom:"1",visibility:u?"inherit":"hidden",children:(0,i.jsxs)(C.U,{spacing:"8px",children:[(0,i.jsx)(M.L,{}),o.isActionMode?o.action?(0,i.jsx)(tl,{node:o,action:o.action}):(0,i.jsx)(i.Fragment,{}):"model"===o.resourceType?(0,i.jsx)(ts,{id:o.id}):(0,i.jsx)(i.Fragment,{})]})})]}),Object.keys(null!==(n=null==o?void 0:o.parents)&&void 0!==n?n:{}).length>0&&(0,i.jsx)(r.HH,{type:"target",position:r.Ly.Left,isConnectable:!1}),Object.keys(null!==(t=null==o?void 0:o.children)&&void 0!==t?t:{}).length>0&&(0,i.jsx)(r.HH,{type:"source",position:r.Ly.Right,isConnectable:!1})]})})}},tK={customEdge:function(e){let{sourceX:n,sourceY:t,targetX:l,targetY:o,sourcePosition:s,targetPosition:a,style:c={},markerEnd:d,data:u}=e,h={...c};(null==u?void 0:u.changeStatus)&&(h.stroke=H(null==u?void 0:u.changeStatus).color,h.strokeDasharray="5"),(null==u?void 0:u.isHighlighted)===!1&&(h.filter="opacity(0.2) grayscale(50%)");let[x]=(0,r.OQ)({sourceX:n,sourceY:t,sourcePosition:s,targetX:l,targetY:o,targetPosition:a});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(r.u5,{path:x,markerEnd:d,style:{...h,...c}})})}},tU=e=>{var n,t;return(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.changeStatus)?H(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.changeStatus).color:"lightgray"},tJ={all:"All",changed_models:"Changed Models"};function tB(e){var n;let{...t}=e,l=(0,r._K)(),{successToast:s,failToast:a}=e8(),{copyToClipboard:N,ImageDownloadModal:M,ref:L}=ni({renderLibrary:"html-to-image",imageType:"png",shadowEffect:!0,backgroundColor:"white",ignoreElements:e=>{let n=e.className;return!!("string"==typeof n&&n.includes(nt))},onSuccess:()=>{s("Copied the Lineage View as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),a("Failed to copy image to clipboard",e)}}),[F,D,q]=(0,r.Rr)([]),[P,W,H]=(0,r.ll)([]),[V,K]=(0,E.useState)(t.viewOptions||{}),{lineageGraph:U,retchLineageGraph:J,isLoading:B,error:Q,refetchRunsAggregated:X}=eC(),Y=V.view_mode||t.viewMode||"changed_models",[$,G]=(0,E.useState)("detail"),[ee,en]=(0,E.useState)("normal"),[et,ei]=(0,E.useState)(),[er,el]=(0,E.useState)(!1),[eo,es]=(0,E.useState)(!1),[ea,ec]=(0,E.useState)({x:0,y:0});(0,E.useLayoutEffect)(()=>{if(!U)return;let[e,n]=u(U,V);h(e,n),D(e),W(n)},[D,W,U]);let ed=async e=>{if(e.width&&e.height){let n=e.position.x+e.width/2,t=e.position.y+e.height/2,i=l.getZoom();l.setCenter(n,t,{zoom:i,duration:200})}},eu=(0,E.useCallback)(e=>{D(n=>n.map(n=>n.id===e.id?{...n,data:e}:n))},[D]),eh=e=>{if(!U)return;let[n,t]=u(U,e);h(n,t),D(n),W(t),K(e),l.fitView({nodes:n})};if(B)return(0,i.jsx)(g.k,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:(0,i.jsx)(v.$,{size:"xl"})});let ex=()=>{es(!1),ec({x:0,y:0})};return Q?(0,i.jsx)(j.M,{h:"100%",children:(0,i.jsxs)(y.g,{children:[(0,i.jsx)(b.xu,{children:"Failed to load lineage data. This could be because the server has been terminated or there is a network error."}),(0,i.jsxs)(b.xu,{children:["[Reason: ",Q,"]"]}),(0,i.jsx)(k.z,{colorScheme:"blue",onClick:()=>{J&&J()},children:"Retry"})]})}):"changed_models"!==Y||(null==U?void 0:null===(n=U.modifiedSet)||void 0===n?void 0:n.length)?(0,i.jsxs)(tW,{sizes:et?[70,30]:[100,0],minSize:et?400:0,gutterSize:et?5:0,style:{height:"100%",width:"100%"},children:[(0,i.jsx)(b.xu,{children:(0,i.jsxs)(r.x$,{nodeTypes:tV,edgeTypes:tK,nodes:F,edges:P,onNodesChange:q,onEdgesChange:H,onNodeClick:(e,n)=>{if(!1!==t.interactive){if(ex(),"detail"===$)ei(n.data),er||(el(!0),ed(n)),D(m(n.id,F));else if("action_result"===$)ei(n.data),er||(el(!0),ed(n)),D(m(n.id,F));else{var i;D((i=n.id,F.map(e=>{let n=e.id===i;return{...e,data:{...e.data,isSelected:e.data.isSelected!==n}}})))}}},onNodeMouseEnter:(e,n)=>{if(!U)return;let[t,i]=x(Array.from(o(c(U,[n.id]),d(U,[n.id]))),F,P);D(t),W(i)},onNodeMouseLeave:(e,n)=>{if(!U)return;let[t,i]=x(Array.from(d(U,U.modifiedSet)),F,P);D(t),W(i)},onNodeContextMenu:(e,n)=>{"action"===$&&(e.preventDefault(),ec({x:e.clientX,y:e.clientY,selectedNode:n}),es(!0))},onClick:ex,maxZoom:1,minZoom:.1,fitView:!0,nodesDraggable:t.interactive,ref:L,children:[(0,i.jsx)(I.A,{color:"#ccc"}),(0,i.jsx)(O.Z,{showInteractive:!1,position:"top-right",className:nt,children:(0,i.jsx)(O.B,{title:"copy image",onClick:async()=>{N()},children:(0,i.jsx)(w.J,{as:Z.C3L})})}),(0,i.jsx)(M,{}),(0,i.jsx)(r.s_,{position:"bottom-left",children:(0,i.jsxs)(C.U,{children:[(0,i.jsx)(tq,{}),t.interactive&&(0,i.jsxs)(b.xu,{p:2,flex:"0 1 160px",fontSize:"14px",className:nt,children:[(0,i.jsx)(_.x,{color:"gray",mb:"2px",children:"Actions"}),(0,i.jsxs)(y.g,{spacing:1,align:"baseline",children:[(0,i.jsx)(k.z,{size:"xs",variant:"outline",backgroundColor:"white",isDisabled:"normal"!==ee,onClick:()=>{let e="detail"===$?"action":"detail";ei(void 0),el(!1),D(f(F,"action"===e)),G(e),en("selector")},children:"Select models"}),(0,i.jsx)(k.z,{size:"xs",variant:"outline",backgroundColor:"white",isDisabled:"normal"!==ee,onClick:()=>{en("filter")},children:"Filter nodes"}),(0,i.jsx)(tO,{isDisabled:"normal"!==ee,viewMode:Y,nodes:F.map(e=>e.data),onFinish:()=>G("detail")})]})]})]})}),(0,i.jsx)(r.s_,{position:"top-left",children:(0,i.jsx)(_.x,{fontSize:"xl",color:"grey",opacity:.5,children:F.length>0?tJ[Y]:"No nodes"})}),(0,i.jsx)(A.a,{nodeColor:tU,nodeStrokeWidth:3,zoomable:!0,pannable:!0}),(0,i.jsxs)(r.s_,{position:"bottom-center",className:nt,children:[(0,i.jsx)(S.R,{in:"selector"===ee,unmountOnExit:!0,style:{zIndex:10},children:(0,i.jsx)(tA,{viewMode:Y,nodes:F.map(e=>e.data).filter(e=>e.isSelected),onClose:()=>{G("detail"),en("normal");let e=f(F);ei(void 0),el(!1),D(e),null==X||X()},onActionStarted:()=>{G("action_result")},onActionNodeUpdated:eu,onActionCompleted:()=>{}})}),(0,i.jsx)(S.R,{in:"filter"===ee,unmountOnExit:!0,style:{zIndex:10},children:(0,i.jsx)(tF,{viewOptions:V,onViewOptionsChanged:eh,onClose:e=>{en("normal"),e&&l.fitView()}})})]})]})}),"detail"===$&&et?(0,i.jsx)(b.xu,{borderLeft:"solid 1px lightgray",height:"100%",children:(0,i.jsx)(t_,{node:et,onCloseNode:()=>{ei(void 0),el(!1),D(f(F))}})}):"action_result"===$&&et?(0,i.jsx)(b.xu,{borderLeft:"solid 1px lightgray",height:"100%",children:(0,i.jsx)(tD,{node:et,onCloseNode:()=>{ei(void 0),el(!1)}})}):(0,i.jsx)(b.xu,{}),eo&&(0,i.jsx)(z.v,{isOpen:!0,onClose:ex,children:(0,i.jsxs)(T.q,{style:{position:"absolute",left:"".concat(ea.x,"px"),top:"".concat(ea.y,"px")},children:[(0,i.jsx)(R.s,{icon:(0,i.jsx)(ta.Cv2,{}),onClick:()=>{let e=ea.selectedNode;"action"===$&&void 0!==e&&void 0!==U&&D(p([...c(U,[e.id])],F))},children:"Select parent nodes"}),(0,i.jsx)(R.s,{icon:(0,i.jsx)(ta.IMj,{}),onClick:()=>{let e=ea.selectedNode;"action"===$&&void 0!==e&&void 0!==U&&D(p([...d(U,[e.id])],F))},children:"Select child nodes"})]})})]}):(0,i.jsx)(j.M,{h:"100%",children:(0,i.jsxs)(y.g,{children:[(0,i.jsx)(i.Fragment,{children:"No change detected"}),(0,i.jsx)(k.z,{colorScheme:"blue",onClick:()=>{en("normal"),eh({...V,view_mode:"all"})},children:"Show all nodes"})]})})}function tQ(e){let{...n}=e;return void 0===n.interactive&&(n.interactive=!0),void 0===n.viewMode&&(n.viewMode="changed_models"),(0,i.jsx)(r.tV,{children:(0,i.jsx)(tB,{...n})})}var tX=t(15370),tZ=t(19046),tY=t(50068),t$=t(57489);function tG(e){let{children:n}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(tj,{children:(0,i.jsx)(ew,{children:(0,i.jsx)(tk,{children:(0,i.jsx)(n4,{children:n})})})})})}var t0=t(81600),t1=t(29598),t2=t(62216),t5=t(54097),t4=t(95862),t9=t(82960),t3=t(69879),t6=t(618),t8=t(77153);function t7(e){let{name:n,setName:t}=e,[r,l]=(0,E.useState)(!1),[o,s]=(0,E.useState)(n),a=(0,E.useRef)(null),c=(0,E.useCallback)(()=>{t(o),l(!1)},[t,l,o]);return(0,E.useEffect)(()=>{let e=e=>{a.current&&!a.current.contains(e.target)&&c()};return r&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[r,a,c]),(0,i.jsxs)(t3.a,{flex:"0 1",fontSize:"12pt",fontWeight:"500",separator:(0,i.jsx)(t8.X,{color:"gray.500"}),children:[(0,i.jsx)(t6.g,{children:(0,i.jsx)(b.xu,{children:"Checklist"})}),(0,i.jsx)(t6.g,{flex:"0 1",cursor:"pointer",children:r?(0,i.jsx)(nN.I,{ref:a,value:o,onChange:e=>{s(e.target.value)},onKeyDown:e=>{"Enter"===e.key?(t(o),l(!1)):"Escape"===e.key&&(s(n),l(!1))},size:"sm",w:"auto",minW:"200px",maxW:"600px"}):(0,i.jsx)(b.xu,{onClick:()=>{s(n),l(!0)},textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n})})]})}async function ie(e){return(await en.post("/api/select",e)).data}var it=t(79898);let ii=e=>{var n;let{node:t,selected:r,onSelect:l,schemaChanged:o}=e,{icon:s}=V(t.resourceType);return(0,i.jsxs)(g.k,{width:"100%",fontSize:"10pt",p:"5px 8px",cursor:"pointer",_hover:{bg:"gray.200"},bg:r?"gray.100":"inherit",onClick:()=>l(t.id),alignItems:"center",gap:"5px",children:[(0,i.jsx)(w.J,{as:s}),(0,i.jsx)(b.xu,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:t.name}),o&&(0,i.jsx)(w.J,{as:null===(n=tn("schema_diff"))||void 0===n?void 0:n.icon,color:H("modified").color})]})};function ir(e){let{check:n}=e,{lineageGraph:t}=eC(),r=n.params,l=[...eh.check(n.check_id),"select"],{isLoading:o,error:s,refetch:a,data:c}=(0,ex.a)({queryKey:l,queryFn:async()=>ie({select:null==r?void 0:r.select,exclude:null==r?void 0:r.exclude}),refetchOnMount:!0,enabled:!(null==r?void 0:r.node_id)}),[d,u]=(0,E.useMemo)(()=>{let e=[],n=[];if(null==r?void 0:r.node_id){let n=null==t?void 0:t.nodes[r.node_id];n&&e.push(n)}else for(let n of(null==c?void 0:c.nodes)||[]){let i=null==t?void 0:t.nodes[n];i&&e.push(i)}let i=e.filter(e=>"model"===e.resourceType||"seed"===e.resourceType||"source"===e.resourceType||"snapshot"===e.resourceType);for(let e of i){var l,o;to(null===(l=e.data.base)||void 0===l?void 0:l.columns,null===(o=e.data.current)||void 0===o?void 0:o.columns)&&n.push(e.id)}return i.sort((e,t)=>n.includes(e.id)&&!n.includes(t.id)?-1:!n.includes(e.id)&&n.includes(t.id)?1:e.name.localeCompare(t.name)),[i,n]},[null==r?void 0:r.node_id,null==c?void 0:c.nodes,t]),[h,x]=(0,E.useState)(0);if(o)return(0,i.jsx)(j.M,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(s)return(0,i.jsxs)(j.M,{bg:"rgb(249,249,249)",height:"100%",children:["Error: ",null==s?void 0:s.message]});if(0==d.length)return(0,i.jsx)(j.M,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"});if(h<d.length){let e=d[h];return(0,i.jsxs)(tW,{sizes:[80,20],minSize:30,style:{height:"100%"},children:[(0,i.jsx)(tf,{base:e.data.base,current:e.data.current,enableScreenshot:!0}),(0,i.jsx)(it.aV,{overflow:"auto",children:d.map((e,n)=>(0,i.jsx)(ii,{node:e,schemaChanged:u.includes(e.id),selected:n===h,onSelect:()=>{x(n)}},n))})]})}return(0,i.jsx)(i.Fragment,{})}var il=t(51643);function io(e){let{value:n,onChange:t}=e,[r,l]=(0,E.useState)(!1),[o,s]=(0,E.useState)(),a=(0,E.useRef)(null);return((0,E.useEffect)(()=>{if(r&&a.current){let e=a.current;e.focus(),e.setSelectionRange(e.value.length,e.value.length)}},[r]),r)?(0,i.jsxs)(g.k,{direction:"column",align:"flex-end",height:"100%",children:[(0,i.jsx)(il.g,{value:o,onChange:e=>{s(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&l(!1)},ref:a,flex:1}),(0,i.jsxs)(g.k,{gap:"12px",alignItems:"flex-end",children:[(0,i.jsx)(nz.r,{onClick:()=>{setTimeout(()=>{l(!1)},100)},colorScheme:"blue",children:"cancel"}),(0,i.jsx)(k.z,{mt:"8px",size:"sm",colorScheme:"blue",onClick:()=>{t&&(t(o),l(!1))},children:"Update"})]})]}):(0,i.jsx)(_.x,{overflow:"auto",fontSize:"11pt",onClick:()=>{s(n||""),l(!0)},whiteSpace:"pre",color:n?"inherit":"lightgray",children:n||"Add description here"})}var is=t(40902);function ia(){let e=(0,t0._)(["\n    **SQL**\n    ```sql\n    ","\n    ```\n    "],["\n    **SQL**\n    \\`\\`\\`sql\n    ","\n    \\`\\`\\`\n    "]);return ia=function(){return e},e}function ic(e){return"".concat(e.is_checked?" ":"").concat(e.name)}function id(e){return e.description?e.description:"_(no description)_"}var iu=e=>{let{value:n,onChange:t,onRun:r,onRunDiff:l,options:o={},...s}=e;return(0,i.jsx)(tw.ZP,{language:"sql",theme:"vs",value:n,onChange:e=>{void 0!==e&&t&&t(e)},onMount:(e,n)=>{r&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.Enter,r),l&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.Enter,l)},options:{tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent",...o}})};function ih(e){let{check:n}=e,t={...n.params,...n.view_options};return(0,i.jsx)(g.k,{direction:"column",height:"100%",children:(0,i.jsx)(tQ,{viewOptions:t,interactive:!1})})}var ix=t(19339);function im(e){let{name:n,description:t,type:r,params:l,viewOptions:o}=e,s={name:n,description:t,type:r,params:l};o&&(s.view_options=o);let a=ix.ZP.stringify({checks:[s]});return(0,i.jsx)(tw.ML,{height:"300px",language:"yaml",theme:"vs",value:a,options:{readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})}function ip(){let e=(0,t0._)(["\n  <details><summary>","</summary>\n\n  ","\n\n  </details>"]);return ip=function(){return e},e}let ig=e=>{let{runId:n,isPending:t,setAborting:i}=e;(0,E.useEffect)(()=>()=>{i(!1),n&&t&&el(n)},[t,n,i])},iv=e=>{var n;let{checkId:t}=e,r=(0,ep.NL)(),[,l]=(0,nX.TH)(),{successToast:o,failToast:s}=e8(),[a,c]=(0,E.useState)(),[d,u]=(0,E.useState)(),[h,x]=(0,E.useState)(!1),{isOpen:m,onOpen:p,onClose:f}=(0,eZ.q)(),v=()=>(0,i.jsx)(e$.Z,{bg:"blackAlpha.300",backdropFilter:"blur(10px) "}),[y,C]=(0,E.useState)((0,i.jsx)(v,{})),{isLoading:_,error:S,refetch:I,data:O}=(0,ex.a)({queryKey:eh.check(t),queryFn:async()=>nK(t),refetchOnMount:!1,staleTime:3e5}),A=(null==O?void 0:O.type)?tn(null==O?void 0:O.type):void 0,F=(null==O?void 0:O.is_preset)||!1,{mutate:D}=(0,nQ.D)({mutationFn:e=>nU(t,e),onSuccess:()=>{r.invalidateQueries({queryKey:eh.check(t)}),r.invalidateQueries({queryKey:eh.checks()})}}),{mutate:q}=(0,nQ.D)({mutationFn:()=>nJ(t),onSuccess:()=>{r.invalidateQueries({queryKey:eh.checks()}),l("/checks")}}),P=async()=>{if(!(null==O?void 0:O.type))return;let{run_id:e}=await eo(t,{nowait:!0});for(c(e);;){let n=await er(e,2);if(u(n.progress),n.result||n.error)return x(!1),u(void 0),n}},{data:W,mutate:H,error:V,isIdle:K,isPending:U}=(0,nQ.D)({mutationFn:P,onSuccess:e=>{I()}}),J=async()=>{H()},Q=(0,E.useCallback)(async()=>{if(x(!0),a)return await el(a)},[a]);ig({runId:a,isPending:U,setAborting:x});let Z=async()=>{if(!O)return;let e=(0,is.RI)(ip(),ic(O),function(e){if("query"===e.type||"query_diff"===e.type){var n;return"".concat(id(e),"\n\n").concat((0,is.Pn)(ia(),null===(n=e.params)||void 0===n?void 0:n.sql_template))}return id(e)}(O));if(!navigator.clipboard){s("Failed to copy the check to clipboard",Error("Copy to clipboard is available only in secure contexts (HTTPS)"));return}try{await navigator.clipboard.writeText(e),o("Copied the check to the clipboard")}catch(e){s("Failed to copy the check to clipboard",e)}},Y=(0,E.useCallback)(()=>{D({is_checked:!(null==O?void 0:O.is_checked)})},[null==O?void 0:O.is_checked,D]);if(_)return(0,i.jsx)(j.M,{h:"100%",children:"Loading"});if(S)return(0,i.jsxs)(j.M,{h:"100%",children:["Error: ",S.message]});let $=K?null==O?void 0:O.last_run:W,G=(null==$?void 0:$.run_at)?(0,nG.Q)(new Date($.run_at),{addSuffix:!0}):null;return(0,i.jsxs)(tH,{minSize:100,sizes:[30,70],style:{height:"100%",width:"100%",maxHeight:"100%"},children:[(0,i.jsxs)(b.xu,{style:{contain:"strict"},display:"flex",flexDirection:"column",overflow:"auto",children:[(0,i.jsxs)(g.k,{p:"0px 16px",alignItems:"center",children:[(0,i.jsx)(t7,{name:(null==O?void 0:O.name)||"",setName:e=>{D({name:e})}}),(0,i.jsx)(M.L,{}),F&&(0,i.jsx)(N.u,{label:"Preset Check defined in recce config",children:(0,i.jsxs)(B.Vp,{size:"sm",children:[(0,i.jsx)(B.AD,{boxSize:"14px",as:t4.bX4}),"Preset"]})}),(0,i.jsxs)(z.v,{children:[(0,i.jsx)(nF.j,{isRound:!0,as:X.h,icon:(0,i.jsx)(w.J,{as:L.D_A}),variant:"ghost"}),(0,i.jsxs)(T.q,{children:[(0,i.jsx)(R.s,{icon:(0,i.jsx)(t9.ovA,{}),onClick:()=>{C((0,i.jsx)(v,{})),p()},children:"Get Preset Check Template"}),(0,i.jsx)(R.s,{icon:(0,i.jsx)(t2.p,{}),onClick:()=>q(),children:"Delete"})]})]}),G&&(0,i.jsx)(b.xu,{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontSize:"10pt",children:G}),(null==A?void 0:A.RunResultView)&&(0,i.jsx)(N.u,{label:"Rerun",children:(0,i.jsx)(X.h,{isRound:!0,isLoading:U,variant:"ghost","aria-label":"Rerun",icon:(0,i.jsx)(ez.n,{}),onClick:()=>J()})}),(0,i.jsx)(N.u,{label:"Copy markdown",children:(0,i.jsx)(X.h,{isRound:!0,variant:"ghost","aria-label":"Copy markdown",icon:(0,i.jsx)(eX.T,{}),onClick:()=>Z()})}),(0,i.jsx)(N.u,{label:(null==O?void 0:O.is_checked)?"Mark as unchecked":"Mark as checked",children:(0,i.jsx)(k.z,{size:"sm",colorScheme:(null==O?void 0:O.is_checked)?"green":"gray",leftIcon:(0,i.jsx)(t5.r,{}),onClick:()=>Y(),children:(null==O?void 0:O.is_checked)?"Checked":"Unchecked"})})]}),(0,i.jsx)(b.xu,{flex:"1",p:"8px 16px",minHeight:"100px",children:(0,i.jsx)(io,{value:null==O?void 0:O.description,onChange:e=>{D({description:e})}},null==O?void 0:O.check_id)})]}),(0,i.jsx)(b.xu,{style:{contain:"strict"},children:(0,i.jsxs)(tu.m,{height:"100%",display:"flex",flexDirection:"column",children:[(0,i.jsxs)(th.t,{children:[(0,i.jsx)(tx.O,{fontSize:"10pt",children:"Result"}),((null==O?void 0:O.type)==="query"||(null==O?void 0:O.type)==="query_diff")&&(0,i.jsx)(tx.O,{fontSize:"10pt",children:"Query"})]}),(0,i.jsxs)(tm.n,{height:"100%",flex:"1",style:{contain:"strict"},children:[(0,i.jsxs)(tp.x,{p:0,width:"100%",height:"100%",children:[(null==A?void 0:A.RunResultView)&&(0,i.jsx)(n$,{isPending:U,isAborting:h,isCheckDetail:!0,run:$,error:V,progress:d,RunResultView:A.RunResultView,viewOptions:null==O?void 0:O.view_options,onViewOptionsChanged:e=>{D({view_options:e})},onCancel:Q,onExecuteRun:J}),O&&"schema_diff"===O.type&&(0,i.jsx)(ir,{check:O}),O&&"lineage_diff"===O.type&&(0,i.jsx)(ih,{check:O})]}),((null==O?void 0:O.type)==="query"||(null==O?void 0:O.type)==="query_diff")&&(0,i.jsx)(tp.x,{p:0,height:"100%",width:"100%",children:(0,i.jsx)(iu,{value:(null==O?void 0:null===(n=O.params)||void 0===n?void 0:n.sql_template)||"",options:{readOnly:!0}})})]})]})}),(0,i.jsxs)(eY.u_,{isOpen:m,onClose:f,isCentered:!0,size:"6xl",children:[y,(0,i.jsxs)(eG.h,{overflowY:"auto",height:"40%",width:"60%",children:[(0,i.jsx)(e0.x,{children:"Preset Check Template"}),(0,i.jsx)(e1.o,{}),(0,i.jsxs)(e2.f,{children:[(0,i.jsx)(eL.X,{size:"sm",fontWeight:"bold",children:(0,i.jsx)(t1.y$,{query:"recce.yml",styles:{px:"1",py:"0",bg:"red.100"},children:"Please copy the following template and paste it into the recce.yml file."})}),(0,i.jsx)("br",{}),(0,i.jsx)(im,{name:(null==O?void 0:O.name)||"",description:(null==O?void 0:O.description)||"",type:(null==O?void 0:O.type)||"",params:null==O?void 0:O.params,viewOptions:null==O?void 0:O.view_options})]})]})]})]})};var ij=t(53924);let iy=e=>{var n;let{check:t,selected:r,onSelect:l}=e,o=(0,ep.NL)(),s=t.check_id,{mutate:a}=(0,nQ.D)({mutationFn:e=>nU(s,e),onSuccess:()=>{o.invalidateQueries({queryKey:eh.check(s)}),o.invalidateQueries({queryKey:eh.checks()})}}),c=(null===(n=tn(t.type))||void 0===n?void 0:n.icon)||eT.WzH;return(0,i.jsxs)(g.k,{width:"100%",p:"10px 20px",cursor:"pointer",_hover:{bg:"gray.200"},bg:r?"gray.100":"inherit",onClick:()=>l(t.check_id),alignItems:"center",gap:"5px",children:[(0,i.jsx)(w.J,{as:c}),(0,i.jsx)(b.xu,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:t.name}),t.is_checked&&(0,i.jsx)(w.J,{color:"green",as:F.FJM})]})},ib=e=>{let{checks:n,selectedItem:t,onCheckSelected:r,onChecksReordered:l}=e;return(0,i.jsx)(ij.Z5,{onDragEnd:e=>{e.destination&&l(e.source.index,e.destination.index)},children:(0,i.jsx)(ij.bK,{droppableId:"checklist",children:e=>(0,i.jsxs)(y.g,{...e.droppableProps,ref:e.innerRef,w:"full",spacing:"0",flex:"1",overflow:"auto",children:[n.map((e,n)=>(0,i.jsx)(ij._l,{draggableId:e.check_id,index:n,children:n=>(0,i.jsx)(g.k,{ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,w:"full",children:(0,i.jsx)(iy,{check:e,selected:e.check_id===t,onSelect:r},e.check_id)})},e.check_id)),e.placeholder]})})})};function ik(){let e=(0,t0._)(["\n    <details><summary>","</summary>\n\n    ","\n\n    </details>"]);return ik=function(){return e},e}let iw=()=>{let[,e]=(0,nX.TH)(),[,n]=(0,nX.yj)("/checks/:checkId"),t=(0,ep.NL)(),{successToast:r,failToast:l}=e8(),o=null==n?void 0:n.checkId,{isLoading:s,error:a,data:c,status:d}=(0,ex.a)({queryKey:eh.checks(),queryFn:nV,refetchOnMount:!0}),u=(0,E.useCallback)(n=>{e("/checks/".concat(n))},[e]),[h,x]=(0,E.useState)(c||[]),{mutate:m}=(0,nQ.D)({mutationFn:e=>nB(e),onSuccess:()=>{t.invalidateQueries({queryKey:eh.checks()})}}),p=(0,E.useCallback)((e,n)=>{let t=[...h],[i]=t.splice(e,1);t.splice(n,0,i),m({source:e,destination:n}),x(t)},[h,x,m]);return((0,E.useCallback)(async()=>{let e=await nP();t.invalidateQueries({queryKey:eh.checks()}),u(e.check_id)},[t,u]),(0,E.useEffect)(()=>{"success"===d&&(!o&&c.length>0&&e("/checks/".concat(c[0].check_id)),x(c))},[d,o,c,x,e]),s)?(0,i.jsx)(i.Fragment,{}):a?(0,i.jsxs)(i.Fragment,{children:["Error: ",a.message]}):(null==c?void 0:c.length)?(0,i.jsxs)(tW,{style:{height:"100%"},minSize:50,sizes:[20,80],children:[(0,i.jsx)(b.xu,{borderRight:"lightgray solid 1px",height:"100%",style:{contain:"size"},children:(0,i.jsxs)(y.g,{spacing:0,align:"flex-end",h:"100%",style:{contain:"strict"},children:[(0,i.jsx)(N.u,{label:"Copy checklist to the clipboard",children:(0,i.jsx)(X.h,{mr:"10px",variant:"unstyled","aria-label":"Copy checklist to the clipboard",onClick:async()=>{let e=c.map(e=>(0,is.RI)(ik(),ic(e),id(e))).join("\n\n");if(!navigator.clipboard){l("Failed to copy checklist to clipboard",Error("Copy to clipboard is available only in secure contexts (HTTPS)"));return}try{await navigator.clipboard.writeText(e),r("Copied ".concat(c.length," checks to the clipboard"))}catch(e){l("Failed to copy checklist to clipboard",e)}},icon:(0,i.jsx)(eX.T,{})})}),(0,i.jsx)(nT.i,{mb:"8px"}),(0,i.jsx)(ib,{checks:h,selectedItem:o,onCheckSelected:u,onChecksReordered:p})]})}),(0,i.jsx)(b.xu,{height:"100%",children:(0,i.jsx)(nX.rs,{children:(0,i.jsx)(nX.AW,{path:"/checks/:checkId",children:e=>(0,i.jsx)(iv,{checkId:e.checkId},e.checkId)})})})]}):(0,i.jsx)(j.M,{h:"100%",children:(0,i.jsx)(b.xu,{children:"No checks"})})};async function iC(e,n){return await ei("query",e,n)}async function i_(e,n){return await ei("query_diff",e,n)}var iS=t(66070);let iz=e=>{let{defaultPrimaryKeys:n,onPrimaryKeysChange:t,...r}=e,{lineageGraph:l}=eC(),o=(0,E.useMemo)(()=>{if(!l)return[];let e=new Set;for(let i in l.nodes){var n,t;let r=l.nodes[i],o=null===(n=r.data.base)||void 0===n?void 0:n.columns,s=null===(t=r.data.current)||void 0===t?void 0:t.columns;for(let n in o)e.add(n);for(let n in s)e.add(n)}return Array.from(e).sort()},[l]);return(0,i.jsx)(g.k,{...r,children:(0,i.jsxs)(eR.NI,{m:"4px 8px",children:[(0,i.jsxs)(eE.l,{children:["Primary key"," ",(0,i.jsx)(N.u,{label:"When a primary key is present, the query difference is computed in the warehouse. Otherwise, it's computed on the client side.",children:(0,i.jsx)(K.s,{color:"gray.600",boxSize:"3"})})]}),(0,i.jsxs)(iS.Qc,{restoreOnBlurIfEmpty:!1,multiple:!0,creatable:!0,filter:(e,n)=>n.startsWith(e),onChange:e=>t(e),defaultValues:void 0!==n&&0!==n.length?n:void 0,children:[(0,i.jsx)(iS.Vp,{placeholder:"Select primary key...",variant:"outline",children:e=>{let{tags:n}=e;return n.map((e,n)=>(0,i.jsx)(iS.Y4,{label:e.label,onRemove:e.onRemove},n))}}),(0,i.jsxs)(iS.Jm,{children:[o.map((e,n)=>(0,i.jsx)(iS.Gb,{value:e,children:e},"option-".concat(n))),(0,i.jsx)(iS.JU,{children:e=>{let{value:n}=e;return(0,i.jsxs)(g.k,{children:["Add '",n,"' to List"]})}})]})]})]})})},iT=()=>{let{sqlQuery:e,setSqlQuery:n,primaryKeys:t,setPrimaryKeys:r}=ty(),{envInfo:l}=eC(),o=e;(null==l?void 0:l.adapterType)==="sqlmesh"&&e===tg&&(o="select * from db.mymodel");let[s,a]=(0,E.useState)(),[c,d]=(0,E.useState)(),[u,h]=(0,E.useState)({}),x=(0,ep.NL)(),[,m]=(0,nX.TH)(),p=async e=>{a(e);let{run_id:n}="query"===e?await iC({sql_template:o},{nowait:!0}):await i_({sql_template:o,primary_keys:t},{nowait:!0});return d(n),await er(n)},{data:f,mutate:v,error:j,isPending:y}=(0,nQ.D)({mutationFn:p,onSuccess:e=>{h({})}}),w=(0,E.useCallback)(async()=>{if(c)return await el(c)},[c]),C=(0,E.useCallback)(async e=>{if(!(null==e?void 0:e.run_id))return;let n=await nH(e.run_id,u);x.invalidateQueries({queryKey:eh.checks()}),m("/checks/".concat(n.check_id))},[m,u,x]);return(0,i.jsxs)(g.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(g.k,{justifyContent:"right",padding:"5px",gap:"5px",children:[(0,i.jsx)(k.z,{colorScheme:"blue",onClick:()=>v("query_diff"),isDisabled:y,size:"sm",children:"Run Diff"}),(0,i.jsx)(k.z,{colorScheme:"blue",onClick:()=>v("query"),isDisabled:y,size:"sm",children:"Run"})]}),(0,i.jsxs)(tH,{sizes:[40,60],minSize:100,style:{height:"100%",borderTop:"1px solid #CBD5E0"},children:[(0,i.jsxs)(tW,{sizes:[90,10],minSize:300,children:[(0,i.jsx)(b.xu,{width:"70%",border:"1px solid #CBD5E0",children:(0,i.jsx)(iu,{value:o,onChange:n,onRun:()=>v("query"),onRunDiff:()=>v("query_diff")})}),(0,i.jsx)(iz,{p:"5px",border:"1px",borderColor:"gray.300",defaultPrimaryKeys:t,onPrimaryKeysChange:r})]}),(0,i.jsx)(g.k,{flex:"1",direction:"column",children:"query"===s?(0,i.jsx)(n$,{run:f,error:j,isPending:y,onCancel:w,children:e=>(0,i.jsx)(n_,{...e,onAddToChecklist:C})},c):(0,i.jsx)(n$,{isPending:y,run:f,error:j,viewOptions:u,onViewOptionsChanged:h,onCancel:w,children:e=>(0,i.jsx)(nw,{...e,onAddToChecklist:C})},c)})]})]})};var iR=t(30148);let iE=e=>(0,iR.c4)("#!"+e),iI=()=>[(0,iR.LD)(()=>window.location.hash.replace(/^#!/,"")||"/",()=>"/ssr"),iE];var iO=t(24681),iA=t(62843);let iN=e=>{var n;let{runId:t}=e,{isPending:r,error:l,data:o}=(0,ex.a)({queryKey:eh.run(t),queryFn:async()=>er(t)}),s=(null==o?void 0:o.type)?null===(n=tn(o.type))||void 0===n?void 0:n.RunResultView:void 0;return(0,i.jsx)(n$,{isPending:r,error:l,run:o,RunResultView:s})};var iM=t(20085);let iL=e=>{let{error:n,resetError:t}=e;return(0,i.jsx)(j.M,{height:"100%",backgroundColor:"gray.50",children:(0,i.jsxs)(g.k,{p:4,direction:"column",justifyContent:"flex-start",backgroundColor:"white",border:"solid lightgray 1px",minHeight:"200px",children:[(0,i.jsx)(eL.X,{width:"800px",size:"md",children:"You have encountered an error"}),(0,i.jsx)(b.xu,{flex:"1",fontSize:"10pt",children:n.toString()}),(0,i.jsx)(k.z,{justifySelf:"center",alignSelf:"center",mt:"20px",colorScheme:"blue",size:"sm",onClick:()=>{t()},children:"Reset"})]})})},iF=e=>{let{children:n}=e;return(0,i.jsx)(iM.SV,{fallback:iL,children:n})};async function iD(){return(await en.post("/api/export")).data}async function iq(e){let n=new FormData;return n.append("file",e),(await en.post("/api/import",n)).data}async function iP(){return 208===(await en.get("/api/sync")).status}async function iW(){let e=await en.post("/api/sync");if(202===e.status)return{status:"accepted"};if(208===e.status)return{status:"syncing"};throw Error("Failed to sync state")}var iH=t(16021);function iV(){let e=(0,ev.p)(),n=async()=>{try{let e=await iD(),n=JSON.stringify(e,null,2),t=new Blob([n],{type:"application/json"}),i=new Date,r="recce-state-".concat((0,e7.WU)(i,"yyyy-MM-dd-HH-mm-ss"),".json");nn()(t,r)}catch(n){console.error("Export failed",n),e({title:"Export failed",description:"".concat(n),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}};return(0,i.jsx)(N.u,{label:"Export",children:(0,i.jsx)(X.h,{pt:"6px",variant:"unstyled","aria-label":"Export state",onClick:n,icon:(0,i.jsx)(w.J,{as:iH.tRY,boxSize:"1.2em"})})})}var iK=t(65475);function iU(){let e=(0,ev.p)(),n=(0,ep.NL)(),t=(0,E.useRef)(null),r=(0,E.useRef)(null),[l,o]=(0,E.useState)(null),{isOpen:s,onOpen:a,onClose:c}=(0,eZ.q)(),[d,u]=(0,nX.TH)(),[,h]=e_(),x=(0,E.useCallback)(async()=>{if(l){try{let{runs:t,checks:i}=await iq(l);h(),await n.invalidateQueries({queryKey:eh.checks()}),d.includes("/checks")&&u("/checks"),e({description:"".concat(t," runs and ").concat(i," checks imported successfully"),status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}catch(n){console.error("Import failed",n),e({title:"Import failed",description:"".concat(n),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}c()}},[n,l,e,c,d,u,h]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.u,{label:"Import",children:(0,i.jsx)(X.h,{pt:"6px",variant:"unstyled","aria-label":"Import state",onClick:()=>{t.current&&t.current.click()},icon:(0,i.jsx)(w.J,{as:iH.wQf,boxSize:"1.2em"})})}),(0,i.jsx)("input",{type:"file",style:{display:"none"},ref:t,onChange:e=>{var n;(null===(n=e.target.files)||void 0===n?void 0:n.length)===1&&(o(e.target.files[0]),a())}}),(0,i.jsx)(iK.a,{isOpen:s,leastDestructiveRef:r,onClose:c,size:"xl",children:(0,i.jsx)(e$.Z,{children:(0,i.jsxs)(iK._,{children:[(0,i.jsx)(e0.x,{fontSize:"lg",fontWeight:"bold",children:"Import state"}),(0,i.jsx)(e2.f,{children:(0,i.jsxs)(g.k,{px:"5px",gap:"5px",rounded:"md",direction:"column",children:[(0,i.jsxs)(g.k,{alignItems:"center",gap:"5px",children:[(0,i.jsx)(K.s,{color:"red.600"}),(0,i.jsx)(_.x,{as:"span",fontWeight:"500",color:"red.600",children:"Caution!"})]}),(0,i.jsx)(g.k,{children:(0,i.jsxs)(_.x,{children:["The current runs and checks will be"," ",(0,i.jsx)(_.x,{as:"span",fontWeight:"600",children:"merged"})," ","with the imported state"]})})]})}),(0,i.jsxs)(e4.m,{children:[(0,i.jsx)(k.z,{ref:r,onClick:c,children:"Cancel"}),(0,i.jsx)(k.z,{colorScheme:"blue",onClick:x,ml:"5px",children:"Import"})]})]})})})]})}t(97770);var iJ=t(93126),iB=t(1026),iQ=t(13154),iX=t(99434),iZ=t(20143),iY=t(89830),i$=t(13276),iG=t(31610);function i0(e){let n=(0,iG.D)(e);return(0,e7.WU)(n,"yyyy-MM-dd'T'HH:mm:ss")}function i1(e){return Object.values(e).every(e=>null===e)?[(0,i.jsx)(g.k,{ml:"10px",children:"No information"},"no info")]:Object.entries(e).filter(e=>{let[n,t]=e;return"url"!==n&&null!=t}).map(e=>{let[n,t]=e;return(0,i.jsxs)(it.HC,{ml:"10px",children:[n,": ",t]},n)})}function i2(){var e,n,t,r,l,o;let{envInfo:s,reviewMode:a,lineageGraph:c}=eC(),{isOpen:d,onOpen:u,onClose:h}=(0,eZ.q)(),x=null==s?void 0:s.git,m=null==s?void 0:s.pullRequest,p={...x,...m},f=null==s?void 0:null===(e=s.dbt)||void 0===e?void 0:e.base,v=null==s?void 0:null===(n=s.dbt)||void 0===n?void 0:n.current,j=(null==f?void 0:f.generated_at)?i0(null==f?void 0:f.generated_at):"",y=(null==v?void 0:v.generated_at)?i0(null==v?void 0:v.generated_at):"",b=new Set,C=new Set;if(null==c?void 0:c.nodes)for(let e of Object.values(null==c?void 0:c.nodes))(null===(l=e.data.base)||void 0===l?void 0:l.schema)&&b.add(e.data.base.schema),(null===(o=e.data.current)||void 0===o?void 0:o.schema)&&C.add(e.data.current.schema);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.u,{label:"Environment Info",children:(0,i.jsx)(X.h,{pt:"6px",variant:"unstyled","aria-label":"Export state",onClick:u,icon:(0,i.jsx)(w.J,{as:t9.lS4,boxSize:"1.5em",color:"gray.500"})})}),(0,i.jsxs)(eY.u_,{isOpen:d,onClose:h,size:"3xl",children:[(0,i.jsx)(e$.Z,{}),(0,i.jsxs)(eG.h,{children:[(0,i.jsx)(e0.x,{children:"Environment Information"}),(0,i.jsx)(e1.o,{}),(0,i.jsx)(e2.f,{children:(0,i.jsxs)(g.k,{direction:"column",gap:"5px",children:[a?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(g.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(eL.X,{size:"sm",children:"Review Information"}),(0,i.jsxs)(it.QI,{spacing:1,children:[(null==p?void 0:p.url)&&(0,i.jsxs)(it.HC,{ml:"10px",children:["url:"," ",(0,i.jsx)(nz.r,{href:p.url,color:"blue.500",isExternal:!0,children:p.url})]}),p&&i1(p)]})]})}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(g.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(eL.X,{size:"sm",children:"Dev Information"}),(0,i.jsx)(it.QI,{spacing:1,children:x&&i1(x)})]})}),(0,i.jsx)(nT.i,{}),(null==s?void 0:s.adapterType)==="dbt"&&(0,i.jsxs)(g.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(eL.X,{size:"sm",children:"DBT"}),(0,i.jsx)(iJ.x,{children:(0,i.jsxs)(iB.i,{variant:"simple",children:[(0,i.jsx)(iQ.h,{children:(0,i.jsxs)(iX.Tr,{children:[(0,i.jsx)(iZ.Th,{}),(0,i.jsx)(iZ.Th,{children:"base"}),(0,i.jsx)(iZ.Th,{children:"current"})]})}),(0,i.jsxs)(iY.p,{children:[(0,i.jsxs)(iX.Tr,{children:[(0,i.jsx)(i$.Td,{children:"schema"}),(0,i.jsx)(i$.Td,{children:JSON.stringify(Array.from(b))}),(0,i.jsx)(i$.Td,{children:JSON.stringify(Array.from(C))})]}),(0,i.jsxs)(iX.Tr,{children:[(0,i.jsx)(i$.Td,{children:"version"}),(0,i.jsx)(i$.Td,{children:null==f?void 0:f.dbt_version}),(0,i.jsx)(i$.Td,{children:null==v?void 0:v.dbt_version})]}),(0,i.jsxs)(iX.Tr,{children:[(0,i.jsx)(i$.Td,{children:"timestamp"}),(0,i.jsx)(i$.Td,{children:j}),(0,i.jsx)(i$.Td,{children:y})]})]})]})})]}),(null==s?void 0:s.adapterType)==="sqlmesh"&&(0,i.jsxs)(g.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(eL.X,{size:"sm",children:"SQLMesh"}),(0,i.jsx)(iJ.x,{children:(0,i.jsxs)(iB.i,{variant:"simple",children:[(0,i.jsx)(iQ.h,{children:(0,i.jsxs)(iX.Tr,{children:[(0,i.jsx)(iZ.Th,{}),(0,i.jsx)(iZ.Th,{children:"base"}),(0,i.jsx)(iZ.Th,{children:"current"})]})}),(0,i.jsx)(iY.p,{children:(0,i.jsxs)(iX.Tr,{children:[(0,i.jsx)(i$.Td,{children:"Environment"}),(0,i.jsx)(i$.Td,{children:null==s?void 0:null===(t=s.sqlmesh)||void 0===t?void 0:t.base_env}),(0,i.jsx)(i$.Td,{children:null==s?void 0:null===(r=s.sqlmesh)||void 0===r?void 0:r.current_env})]})})]})})]})]})}),(0,i.jsx)(e4.m,{children:(0,i.jsx)(k.z,{colorScheme:"blue",mr:3,onClick:h,children:"Close"})})]})]})]})}function i5(){return(0,i.jsx)(N.u,{label:"Loading",children:(0,i.jsx)(k.z,{pt:"6px",variant:"unstyled",boxSize:"1.2em",children:(0,i.jsx)(v.$,{})})})}function i4(){let[e,n]=(0,E.useState)(!1),t=(0,ep.NL)(),[r,l]=(0,nX.TH)(),o=(0,E.useCallback)(async()=>{await iP()||(n(!1),t.invalidateQueries({queryKey:eh.lineage()}),t.invalidateQueries({queryKey:eh.checks()}))},[n,t]);(0,E.useEffect)(()=>{let n=null;return e&&(n=setInterval(o,2e3)),()=>{n&&(/^\/checks\/([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/.test(r)&&l("/checks"),clearInterval(n))}},[e,o,l,r]);let s=(0,E.useCallback)(async()=>{await iP()===!1&&await iW(),n(!0)},[n]);return e?(0,i.jsx)(i5,{}):(0,i.jsx)(N.u,{label:"Sync with Cloud",children:(0,i.jsx)(X.h,{pt:"6px",variant:"unstyled","aria-label":"Sync state",onClick:s,icon:(0,i.jsx)(w.J,{as:iH.jq8,boxSize:"1.2em"})})})}var i9=t(39588);let i3=e=>{let{children:n,path:t}=e,[r]=(0,nX.yj)(t);return(0,i.jsx)(b.xu,{display:r?"block":"none",height:"100%",children:n})};function i6(e){let{icon:n,href:t,...r}=e;return(0,i.jsx)(nz.r,{height:"20px",color:"white",href:t,isExternal:!0,...r,children:(0,i.jsx)(w.J,{color:"white",boxSize:"20px",as:n})})}function i8(){var e;let{reviewMode:n,isDemoSite:t,envInfo:r,cloudMode:l,isLoading:o}=eC(),s=function(){let[e,n]=(0,E.useState)("");return(0,E.useEffect)(()=>{(async function(){try{let e=await en.get("/api/version");n(e.data)}catch(e){console.error("Error fetching version number:",e)}})()},[]),e}(),a=null==r?void 0:null===(e=r.pullRequest)||void 0===e?void 0:e.url;return(0,i.jsxs)(g.k,{gap:"10px",minHeight:"40px",alignItems:"center",bg:"rgb(255, 110, 66)",children:[(0,i.jsx)(e5.E,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,i.jsx)(eL.X,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,i.jsx)(tX.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:s}),n&&(0,i.jsx)(tX.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:"review mode"}),l&&(0,i.jsx)(tX.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:"cloud mode"}),(0,i.jsx)(M.L,{}),t&&a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(K.s,{}),(0,i.jsxs)(_.x,{children:["Please check"," ",(0,i.jsx)(nz.r,{textDecoration:"underline",fontWeight:"600",href:a,isExternal:!0,children:"this Pull Request"})," ","comment for context about this Recce instance"]})]}),(0,i.jsx)(M.L,{}),(0,i.jsx)(i6,{icon:F.hJX,href:"https://github.com/DataRecce/recce"}),(0,i.jsx)(i6,{icon:F.w5k,href:"https://getdbt.slack.com/archives/C05C28V7CPP"}),(0,i.jsx)(i6,{mr:"18px",icon:F.MXt,href:"https://datarecce.io/docs"})]})}function i7(){let{isDemoSite:e,cloudMode:n,isLoading:t}=eC(),[r,l]=(0,nX.TH)(),o=[{name:"Lineage",href:"/lineage"},{name:"Query",href:"/query"},{name:"Checks",href:"/checks"}],s=eA().findIndex(o,e=>{let{href:n}=e;return r.startsWith(n)});return(0,i.jsx)(tu.m,{index:s,children:(0,i.jsxs)(th.t,{children:[o.map(e=>{let{name:n,href:t}=e;return(0,i.jsx)(tx.O,{onClick:()=>{l(t)},children:n},n)}),(0,i.jsx)(M.L,{}),!t&&(0,i.jsxs)(i.Fragment,{children:[n&&(0,i.jsx)(i4,{}),!e&&!n&&(0,i.jsx)(iU,{}),(0,i.jsx)(iV,{})]}),(0,i.jsx)(i2,{})]})})}function re(){(0,E.useLayoutEffect)(()=>{var e;let n=(e=document.cookie.match("(^|;)\\s*recce_user_id\\s*=\\s*([^;]+)"))?e.pop():"";if(n&&i9.env.AMPLITUDE_API_KEY)try{t$.S1(i9.env.AMPLITUDE_API_KEY,n,{defaultTracking:!0})}catch(e){console.error(e)}},[]);let e=(0,iO.Z)({components:{MuiTooltip:{styleOverrides:{tooltip:{zIndex:1500}}}}});return(0,i.jsx)(iA.Z,{theme:e,children:(0,i.jsx)(tZ.x,{children:(0,i.jsx)(ep.aH,{client:et,children:(0,i.jsx)(nX.F0,{hook:iI,children:(0,i.jsx)(tG,{children:(0,i.jsxs)(g.k,{direction:"column",height:"100vh",children:[(0,i.jsx)(i8,{}),(0,i.jsx)(i7,{}),(0,i.jsx)(iF,{children:(0,i.jsxs)(b.xu,{p:0,overflow:"auto",flex:"1",style:{contain:"size"},children:[(0,i.jsx)(i3,{path:"/lineage",children:(0,i.jsx)(tQ,{})}),(0,i.jsxs)(nX.rs,{children:[(0,i.jsx)(nX.AW,{path:"/query",children:(0,i.jsx)(iT,{})}),(0,i.jsx)(nX.AW,{path:"/checks/:slug*",children:(0,i.jsx)(iw,{})}),(0,i.jsx)(nX.AW,{path:"/runs/:runId",children:e=>{let{runId:n}=e;return(0,i.jsx)(iN,{runId:n})}}),(0,i.jsx)(nX.AW,{path:"/ssr",children:(0,i.jsx)(tY.E,{size:"xs",isIndeterminate:!0})}),(0,i.jsx)(nX.AW,{children:(0,i.jsx)(nX.l_,{to:"/lineage"})})]})]})})]})})})})})})}},91074:function(){},87679:function(){},81974:function(){},15080:function(){}},function(e){e.O(0,[634,145,170,591,521,462,531,498,43,987,182,710,615,971,495,599,512,680,132,584,744],function(){return e(e.s=27709)}),_N_E=e.O()}]);