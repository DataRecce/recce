(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{53770:function(e,n,t){Promise.resolve().then(t.bind(t,42253))},42253:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return rB}});var i=t(9651),l=t(25752),r=t(68345),o=t(10037),s=t(80474),a=t(29626),d=t(52764),c=t(29455),u=t(72875),h=t(90037),x=t(95644),m=t(80735),p=t(22183),f=t(95170),g=t(33899),v=t(31794),j=t(56233),y=t(58714),b=t(38756);let w='select * from {{ ref("mymodel") }}',k=(0,j.createContext)({sqlQuery:w,setSqlQuery:()=>{},primaryKeys:void 0,setPrimaryKeys:()=>{},isCustomQueries:!1,setCustomQueries:()=>{},baseSqlQuery:w,setBaseSqlQuery:()=>{}});function C(e){let{children:n}=e,[t,l]=j.useState(w),[r,o]=j.useState(w),[s,a]=j.useState(!1),[d,c]=j.useState();return(0,i.jsx)(k.Provider,{value:{setSqlQuery:l,sqlQuery:t,setPrimaryKeys:c,primaryKeys:d,isCustomQueries:s,setCustomQueries:a,baseSqlQuery:r,setBaseSqlQuery:o},children:n})}let _=()=>(0,j.useContext)(k),S=(0,j.createContext)({isNodesFetching:[],setIsNodesFetching:()=>{}});function z(e){let{children:n}=e,[t,l]=j.useState([]);return(0,i.jsx)(S.Provider,{value:{isNodesFetching:t,setIsNodesFetching:l},children:n})}var R=t(70867);function E(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=new Set,l={},r=(e,t)=>{if(!(t<0)&&(void 0===l[e]||!(l[e]>=t))){for(let i of(l[e]=t,n(e)))r(i,t-1);i.add(e)}};for(let n of e)r(n,t);return i}function I(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let i=new Set;return n.forEach(e=>{e.forEach(e=>{i.add(e)})}),i}var T=t(85688),L=t.n(T);function D(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return E(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].parents),t)}function O(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return E(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].children),t)}function A(e){return new Set(Object.values(e.nodes).map(e=>e.id))}function M(e,n){return n?e.impactedSet:O(e,e.modifiedSet)}function F(e,n,t){let i=[],l=[],r=t?function(e,n,t){let i={},l={},r="".concat(n,"_").concat(t);for(let[,n]of Object.entries(e)){var o,s;let e=null===(o=n.data.current)||void 0===o?void 0:o.name;for(let[,t]of Object.entries((null===(s=n.data.current)||void 0===s?void 0:s.columns)||{})){let n="".concat(e,"_").concat(t.name);for(let e of(i[n]=[],t.depends_on||[])){let t="".concat(e.node,"_").concat(e.column);i[n].push(t),void 0===l[t]&&(l[t]=[]),l[t].push(n)}}}return I(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return E(e,e=>void 0===l[e]?[]:l[e],n)}([r]),function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return E(e,e=>void 0===i[e]?[]:i[e],n)}([r]))}(e.nodes,t.node,t.column):new Set;function o(e){return"base"===e?0:"current"===e?2:1}function s(e,n){let t=o(e.from),i=o(n.from);return t<i?-1:t>i?1:0}let a=null!=n?new Set(n):void 0;for(let n of Object.values(e.nodes).sort(s)){var d;if(a&&!a.has(n.id))continue;let e=new Set,t=0;if(null===(d=n.data.current)||void 0===d?void 0:d.columns)for(let o of Object.values(n.data.current.columns)){let s="".concat(n.name,"_").concat(o.name);if(r.has(s)){for(let e of(i.push({id:s,position:{x:10,y:70+15*t},parentId:n.id,extent:"parent",draggable:!1,data:{node:n,column:o.name,type:o.type,transformationType:o.transformation_type},style:{zIndex:9999},type:"customColumnNode",targetPosition:R.Ly.Left,sourcePosition:R.Ly.Right}),o.depends_on||[])){let n="".concat(e.node,"_").concat(e.column);r.has(n)&&l.push({id:"".concat(n,"_").concat(s),source:n,target:s,style:{zIndex:9999}})}t++,e.add(s)}}i.push({id:n.id,position:{x:0,y:0},width:300,height:36+15*t,data:{...n,columnSet:e},type:"customNode",targetPosition:R.Ly.Left,sourcePosition:R.Ly.Right})}for(let n of Object.values(e.edges).sort(s))(!a||a.has(n.parent.id)&&a.has(n.child.id))&&l.push({id:n.id,type:"customEdge",source:n.parent.id,target:n.child.id,data:n});return N(i,l),[i,l]}let N=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR",i=new(L()).graphlib.Graph;i.setDefaultEdgeLabel(()=>({})),i.setGraph({rankdir:t}),e.forEach(e=>{"customNode"===e.type&&i.setNode(e.id,{width:e.width,height:e.height})}),n.forEach(e=>{i.setEdge(e.source,e.target)}),L().layout(i),e.forEach(e=>{if("customNode"!==e.type)return;let n=e.width||300,t=e.height||36,l=i.node(e.id);return e.position={x:l.x-n/2,y:l.y-t/2},e})};function q(e,n,t){let i=new Set(e),l=new Set(t.filter(e=>i.has(e.source)&&i.has(e.target)).map(e=>e.id));return[n.map(e=>({...e,data:{...e.data,isHighlighted:i.has(e.id)}})),t.map(e=>({...e,data:{...e.data,isHighlighted:l.has(e.id)}}))]}function H(e,n){return n.map(n=>{let t=n.id===e;return{...n,data:{...n.data,isSelected:t}}})}function V(e,n){return n.map(n=>{let t=n.id===e;return{...n,data:{...n.data,isSelected:n.data.isSelected!==t}}})}function P(e,n){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.map(n=>{let i=e.includes(n.id);return{...n,data:{...n.data,isSelected:t?i:n.data.isSelected||i}}})}function W(e){return e.map(e=>({...e,data:{...e.data,isSelected:!1}}))}function K(e,n){return e.map(e=>({...e,data:{...e.data,isActionMode:n,action:void 0}}))}let B={lineage:()=>["lineage"],checks:()=>["checks","list"],check:e=>["checks",e],runs:()=>["runs"],run:e=>["runs",e],runsAggregated:()=>["runs_aggregated"],flag:()=>["flag"]};var J=t(26363),U=t(94916);let Q=U.env.NEXT_PUBLIC_API_URL?U.env.NEXT_PUBLIC_API_URL:window.location.origin;var Z=t(93192);let X=J.default.create({baseURL:Q}),G=new Z.S;async function Y(){return(await X.get("/api/info")).data}async function $(e){return(await X.get("/api/model/".concat(e))).data}var ee=t(81614),en=t(73263),et=t(76931),ei=t(52344),el=t(71106),er=t(82043),eo=t(29978),es=t(19563),ea=t(65185),ed=t(89243),ec=t(6393),eu=t.n(ec),eh=t(91501),ex=t(94916);function em(e){eh.j("[Web] multi_nodes_action",e)}function ep(e){eh.j("[Web] history_action",e)}function ef(e){eh.j("[Experiment] preview_change",e)}function eg(e){eh.j("[Experiment] preview_change",e)}function ev(e){eh.j("[Experiment] single_environment",e)}function ej(e){eh.j("[Experiment] recommend_preset_check",e)}let ey=!1;async function eb(e,n,t){let i=ey?{breaking_change_analysis:!0}:{};return(await X.post("/api/runs",{type:e,params:n,nowait:null==t?void 0:t.nowait,track_props:i})).data}async function ew(e,n){return(await X.get("/api/runs/".concat(e,"/wait"),{params:{timeout:n}})).data}async function ek(e){return await X.post("/api/runs/".concat(e,"/cancel"))}async function eC(e,n){return(await X.post("/api/checks/".concat(e,"/run"),{nowait:null==n?void 0:n.nowait})).data}async function e_(e,n,t){return(await X.post("/api/runs/search",{type:e,params:n,limit:t})).data}async function eS(){return(await X.get("/api/runs")).data}async function ez(){return(await X.post("/api/runs/aggregate",{})).data}async function eR(){return(await X.get("/api/flag")).data}async function eE(){try{await X.post("/api/onboarding/completed")}catch(e){}}async function eI(){try{await X.post("/api/relaunch-hint/completed")}catch(e){}}let eT=()=>(0,y.a)({queryKey:B.flag(),queryFn:eR}),eL=(0,j.createContext)({isActionAvailable:()=>!0});function eD(e){var n,t,l;let{children:r}=e,o=(0,y.a)({queryKey:B.lineage(),queryFn:Y}),s=(0,y.a)({queryKey:B.runsAggregated(),queryFn:ez}),a=(0,j.useMemo)(()=>{var e;let n=null===(e=o.data)||void 0===e?void 0:e.lineage;if(n&&n.base&&n.current)return function(e,n,t){let i={},l={},r=(e,n)=>({id:e,name:e,data:{},from:n,parents:{},children:{},isSelected:!1});for(let[n,t]of Object.entries(e.nodes))i[n]=r(n,"base"),t&&(i[n].data.base=t,i[n].name=null==t?void 0:t.name,i[n].resourceType=null==t?void 0:t.resource_type,i[n].packageName=null==t?void 0:t.package_name);for(let[e,t]of Object.entries(n.nodes))i[e]?i[e].from="both":i[e]=r(e,"current"),t&&(i[e].data.current=n.nodes&&n.nodes[e],i[e].name=null==t?void 0:t.name,i[e].resourceType=null==t?void 0:t.resource_type,i[e].packageName=null==t?void 0:t.package_name);for(let[n,t]of Object.entries(e.parent_map))for(let e of t){let t=i[n],r=i[e],o="".concat(e,"_").concat(n);if(!t||!r)continue;l[o]={id:o,from:"base",parent:r,child:t};let s=l[o];t.parents[e]=s,r.children[n]=s}for(let[e,t]of Object.entries(n.parent_map))for(let n of t){let t=i[e],r=i[n],o="".concat(n,"_").concat(e);if(!t||!r)continue;l[o]?l[o].from="both":l[o]={id:o,from:"current",parent:r,child:t};let s=l[o];t.parents[n]=s,r.children[e]=s}let o=[],s=[],a=[];for(let[e,n]of Object.entries(i))if(t){let i=t[e];i&&(n.changeStatus=i.change_status,o.push(e),"non-breaking"===i.change_category?s.push(e):a.push(e))}else if("base"===n.from)n.changeStatus="removed",o.push(n.id);else if("current"===n.from)n.changeStatus="added",o.push(n.id);else{var d,c,u,h,x,m;let t=null==n?void 0:null===(u=n.data)||void 0===u?void 0:null===(c=u.base)||void 0===c?void 0:null===(d=c.checksum)||void 0===d?void 0:d.checksum,i=null==n?void 0:null===(m=n.data)||void 0===m?void 0:null===(x=m.current)||void 0===x?void 0:null===(h=x.checksum)||void 0===h?void 0:h.checksum;t&&i&&t!==i&&(n.changeStatus="modified",o.push(n.id),a.push(e))}for(let[e,n]of Object.entries(l))"base"===n.from?n.changeStatus="removed":"current"===n.from&&(n.changeStatus="added");let p=I(new Set(o),E(a,e=>void 0===i[e]?[]:Object.keys(i[e].children)));return{nodes:i,edges:l,modifiedSet:o,nonBreakingSet:new Set(s),impactedSet:p,manifestMetadata:{base:e.manifest_metadata||void 0,current:n.manifest_metadata||void 0},catalogMetadata:{base:e.catalog_metadata||void 0,current:n.catalog_metadata||void 0}}}(n.base,n.current,n.diff)},[o.data]),d=null===(n=o.error)||void 0===n?void 0:n.message,{lineage:c,sqlmesh:u,demo:h,review_mode:x,cloud_mode:m,file_mode:p,filename:f,adapter_type:g,git:v,pull_request:w,support_tasks:k}=o.data||{},C=null==c?void 0:null===(t=c.base)||void 0===t?void 0:t.manifest_metadata,_=null==c?void 0:null===(l=c.current)||void 0===l?void 0:l.manifest_metadata,{connectionStatus:S,connect:z,envStatus:R}=function(){let e=(0,ee.p)(),n=(0,j.useRef)({ws:void 0,status:"pending"}),[t,i]=(0,j.useState)("pending"),[l,r]=(0,j.useState)(void 0);n.current.status=t;let o=(0,b.NL)(),s=()=>{o.invalidateQueries({queryKey:B.lineage()}),o.invalidateQueries({queryKey:B.checks()}),o.invalidateQueries({queryKey:B.runs()})},a=()=>{let t=new WebSocket("".concat(Q.replace(/(http)(s)?\:\/\//,"ws$2://"),"/api/ws"));n.current.ws=t,t.onopen=()=>{t.send("ping")},t.onmessage=t=>{if("pong"===t.data){"disconnected"===n.current.status&&s(),i("connected");return}try{let n=JSON.parse(t.data);if("refresh"===n.command){let{eventType:t,srcPath:i}=n.event,[l,r]=i.split("/").slice(-2),o=eu().parse(r).name,a="".concat(l,"-").concat(o,"-").concat(t);e.isActive(a)||e({id:a,description:"Detected ".concat(l," ").concat(o," ").concat(t),status:"info",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0}),s()}else"relaunch"===n.command&&r("relaunch")}catch(e){console.error(e)}},t.onerror=e=>{console.error(e)},t.onclose=()=>{i(e=>"connected"===e?"disconnected":e),n.current.ws=void 0}};return(0,j.useEffect)(()=>{let e=n.current;return a(),()=>{e.ws&&e.ws.close()}},[]),{connectionStatus:t,connect:a,envStatus:l}}(),{data:T,isLoading:L}=eT(),{onClose:D}=(0,en.q)(),[O,A]=(0,j.useState)(!1),M=(0,b.NL)(),F=(0,j.useCallback)(e=>{if(k){var n;return null===(n=k[e])||void 0===n||n}return!0},[k]);return(0,j.useEffect)(()=>{L||("relaunch"===R&&(null==T?void 0:T.single_env_onboarding)&&(null==T?void 0:T.show_relaunch_hint)?(A(!0),ev({action:"target_base_added"})):A(!1))},[T,R,L]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eL.Provider,{value:{lineageGraph:a,retchLineageGraph:()=>{s.refetch()},envInfo:{adapterType:g,git:v,pullRequest:w,dbt:{base:C,current:_},sqlmesh:u},reviewMode:x,cloudMode:m,fileMode:p,fileName:f,isDemoSite:h,error:d,supportTasks:k,isActionAvailable:F,isLoading:o.isLoading,runsAggregated:s.data,refetchRunsAggregated:()=>{s.refetch()}},children:r}),(0,i.jsxs)(et.u_,{isOpen:"disconnected"===S,onClose:()=>{},isCentered:!0,children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{children:[(0,i.jsx)(er.x,{children:"Server Disconnected"}),(0,i.jsx)(eo.f,{children:(0,i.jsx)(es.x,{children:"The server connection has been lost. Please restart the Recce server and try again."})}),(0,i.jsx)(ea.m,{children:(0,i.jsx)(ed.z,{colorScheme:"blue",onClick:()=>{z()},children:"Retry"})})]})]}),(null==T?void 0:T.single_env_onboarding)&&(0,i.jsxs)(et.u_,{isOpen:O,onClose:()=>{D(),eI(),M.invalidateQueries({queryKey:B.flag()})},isCentered:!0,children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{children:[(0,i.jsx)(er.x,{children:"Target-base Added"}),(0,i.jsx)(eo.f,{children:(0,i.jsx)(es.x,{children:"Please restart the Recce server."})}),(0,i.jsx)(ea.m,{children:(0,i.jsx)(ed.z,{colorScheme:"blue",onClick:()=>{D(),eI(),M.invalidateQueries({queryKey:B.flag()})},children:"Got it!"})})]})]})]})}let eO=()=>(0,j.useContext)(eL),eA=()=>{let{runsAggregated:e,refetchRunsAggregated:n}=eO();return[e,n]};var eM=t(23164);let eF=e=>{let{isOpen:n,onClose:t,onExecute:r,type:o,title:a,params:d,RunForm:c}=e,[u,h]=(0,j.useState)(d),[x,m]=(0,j.useState)(!1);return(0,i.jsxs)(et.u_,{isOpen:n,onClose:t,size:"6xl",scrollBehavior:"inside",children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{overflowY:"auto",height:"75%",children:[(0,i.jsx)(er.x,{children:a}),(0,i.jsx)(eM.o,{}),(0,i.jsx)(eo.f,{p:"0px",h:"100%",overflow:"auto",borderY:"1px solid lightgray",children:(0,i.jsx)(l.x,{style:{contain:"layout"},children:c&&(0,i.jsx)(c,{params:u,onParamsChanged:h,setIsReadyToExecute:m})})}),(0,i.jsx)(ea.m,{children:(0,i.jsx)(s.k,{gap:"10px",children:(0,i.jsx)(ed.z,{isDisabled:!x,colorScheme:"blue",onClick:()=>{r(o,u)},children:"Execute"})})})]})]})};var eN=t(50393),eq=t(38257),eH=t(96084),eV=t(42274),eP=t(46075),eW=t(45837),eK=t.n(eW);function eB(e,n){let t=[];return e.forEach(e=>{t.some(n=>n.name===e.name)||t.push(e)}),n.forEach(e=>{t.some(n=>n.name===e.name)||t.push(e)}),t}var eJ=e=>{var n;let{lineageGraph:t}=eO(),[i,l]=(0,j.useState)([]),[r,o]=(0,j.useState)(),[s,a]=(0,j.useState)(!0),[d,c]=(0,j.useState)(null),u=eK().find(null==t?void 0:t.nodes,{name:e}),h=(0,j.useMemo)(()=>u?function(e){function n(e){return e&&e.columns?Object.values(e.columns):[]}return eB(n(e.data.base),n(e.data.current))}(u):[],[u]),x=u?null===(n=u.data.current)||void 0===n?void 0:n.primary_key:void 0;return(0,j.useEffect)(()=>{let e=async()=>{try{let e=(await $(null==u?void 0:u.id)).model;if(!e||!e.base.columns||!e.current.columns){l([]);return}o(e.current.primary_key);let n=Object.values(e.base.columns),t=Object.values(e.current.columns);l(eB(n,t))}catch(e){c(e)}};h.length>0?(l(h),o(x)):(null==u?void 0:u.id)===void 0?l([]):e(),a(!1)},[null==u?void 0:u.id,h,x]),{columns:i,primaryKey:r,isLoading:s,error:d}};function eU(e){let n=e.trim().toUpperCase();return!!["CHAR","VARCHAR","TINYTEXT","TEXT","MEDIUMTEXT","LONGTEXT","NCHAR","NVARCHAR","VARCHAR2","NVARCHAR2","CLOB","NCLOB","VARCHAR(MAX)","XML","JSON"].includes(n)||/^(VARCHAR|NVARCHAR|VARCHAR2|NVARCHAR2|CHAR|NCHAR)\(\d+\)$/.test(n)}function eQ(e){return["BOOLEAN","TINYINT(1)","BIT","NUMBER(1)","BOOL"].includes(e.toUpperCase())}function eZ(e){return["DATE","DATETIME","TIMESTAMP","TIME","YEAR","DATETIME2","SMALLDATETIME","DATETIMEOFFSET","INTERVAL","TIMESTAMPTZ","TIMETZ","TIMESTAMP WITH TIME ZONE","TIMESTAMP WITH LOCAL TIME ZONE","TIMESTAMP_LTZ","TIMESTAMP_NTZ","TIMESTAMP_TZ"].includes(e.toUpperCase())}var eX=t(2992),eG=t(45637),eY=t(14715);function e$(e){let n=e>0&&e<=.001,t=e<1&&e>=.999,i=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US",t=arguments.length>2?arguments[2]:void 0;return"number"!=typeof e?e:new Intl.NumberFormat(n,t).format(e)}(n,"en-US",{style:"percent",minimumFractionDigits:1})};if(n){let e=i(.001);return"<".concat(e)}if(t){let e=i(.999);return">".concat(e)}return i()}function e0(e){if("number"!=typeof e)return e;{let n=Math.abs(e),t=n>=.01,i=n>=1e6,l=n>=1e9,r=n>=1e15;if(r||n>=1e12)return new Intl.NumberFormat("en-US",{style:"unit",unit:"liter",unitDisplay:"narrow",maximumFractionDigits:r?0:2}).format(e/1e12).replace("L","T");if(l||i||n>=1e3){let n={base:l?1e9:i?1e6:1e3,unit:l?"B":i?"M":"K"};return new Intl.NumberFormat("en-US",{style:"unit",unit:"liter",unitDisplay:"narrow",maximumFractionDigits:1}).format(e/n.base).replace("L",n.unit)}return n>=1?new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(e):new Intl.NumberFormat("en-US",{maximumFractionDigits:t?3:2,notation:t||0===n?"standard":"scientific"}).format(e)}}let e1="#63B3ED",e5="#F6AD55",e2="".concat(e1,"A5"),e4="".concat(e5,"A5");function e6(e){let{color:n}=e;return(0,i.jsx)(l.x,{display:"inline-block",w:"10px",h:"10px",bgColor:n,mr:"2",borderRadius:"sm"})}function e3(e){let{data:n,hideAxis:t=!1,animation:l=!1}=e;eG.kL.register(eG.ZL,eG.RM,eG.f$,eG.uw,eG.Dx,eG.De,eG.u);let r=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{...t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{title:i,datasets:l,type:r,samples:o=0,binEdges:s}=e,[a,d]=l,c="datetime"===r;return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{reverse:!0},title:{display:!0,text:i,font:{size:20}},tooltip:{mode:"index",intersect:!1,callbacks:{title(e){let[{dataIndex:n,datasetIndex:t}]=e,i=e8(s,n);return"".concat(c?"Date Range":"string"===r?"Text Length":"Value Range","\n").concat(i)},label(e){let{datasetIndex:n,dataIndex:t,dataset:{label:i}}=e,l=0===n?d.counts:a.counts,r=e$(l[t]/o),s=l[t];return"".concat(i,": ").concat(s," (").concat(r,")")}}}},scales:function(e){let{datasets:n,min:t=0,max:i=0,type:l,binEdges:r}=e,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],[s,a]=n,d=Math.max(...a.counts,...s.counts),c=r.map((e,n)=>e8(r,n)).slice(0,-1);return{x:"datetime"===l?{display:!o,type:"timeseries",min:t,max:i,adapters:{date:{}},time:{minUnit:"day"},grid:{display:!1},ticks:{minRotation:30,maxRotation:30,maxTicksLimit:8}}:{display:!o,type:"category",grid:{display:!1},ticks:{callback:(e,n)=>c[n]},stacked:!0},y:{display:!o,type:"linear",max:d,border:{dash:[2,2]},grid:{color:"lightgray"},ticks:{maxTicksLimit:8,callback:function(e,n){return e0(e)}},beginAtZero:!0}}}(e,n),...t}}(n,t,{animation:l}),o=function(e){let{datasets:n,type:t,binEdges:i}=e,[l,r]=n,o=e9(t,i,"Current",e2,r),s=e9(t,i,"Base",e4,l);return{labels:i.map((e,n)=>e8(i,n)).slice(0,-1),datasets:[o,s]}}(n);return(0,i.jsx)(eY.kL,{type:"bar",options:r,data:o,plugins:[]})}function e9(e,n,t,i,l){let{counts:r=[]}=l;return{label:t,data:"datetime"===e?r.map((e,t)=>({x:n[t],y:e})):r,backgroundColor:i,borderColor:i,hoverBackgroundColor:i,borderWidth:0,categoryPercentage:1,barPercentage:1,xAxisID:"x"}}function e8(e,n){let t=e[n],i=e[n+1],l=e0(t),r=e0(i);return"".concat(l," - ").concat(r)}let e7=(0,eX.G)((e,n)=>{let{backgroundColor:t="white",blockSize:r,children:o,...s}=e;return(0,i.jsx)(l.x,{ref:n,...s,overflowY:"auto",overflowX:"hidden",children:(0,i.jsx)(l.x,{backgroundColor:t,height:"100%",blockSize:r,children:o})})}),ne=(0,eX.G)(function(e,n){var t,r,o,a,d,c;let{run:x}=e,m=x.params,p=null===(t=x.result)||void 0===t?void 0:t.base,f=null===(r=x.result)||void 0===r?void 0:r.current,g=null===(o=x.result)||void 0===o?void 0:o.min,v=null===(a=x.result)||void 0===a?void 0:a.max,j=null===(d=x.result)||void 0===d?void 0:d.bin_edges;return p&&f?(0,i.jsx)(s.k,{direction:"column",height:"100%",children:(0,i.jsx)(e7,{ref:n,height:"100%",children:(0,i.jsxs)(u.U,{children:[(0,i.jsx)(h.L,{}),(0,i.jsx)(l.x,{w:"80%",h:"35vh",m:"4",children:(0,i.jsx)(e3,{data:{title:"Model ".concat(m.model,".").concat(m.column_name),type:(null===(c=x.params)||void 0===c?void 0:c.column_type)||"",datasets:[p,f],min:g,max:v,samples:p.total,binEdges:j}})}),(0,i.jsx)(h.L,{})]})})}):(0,i.jsx)("div",{children:"Loading..."})});var nn=t(45697);t(94095);var nt=t(42922);let ni=(0,eX.G)((e,n)=>{let{...t}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(nt.ZP,{ref:n,...t})})});function nl(){return(0,i.jsx)(s.k,{h:"35px",alignItems:"center",justifyContent:"center",bg:"gray.100",style:{textAlign:"center",gridColumn:"1/-1"},children:(0,i.jsx)(es.x,{fontWeight:"600",children:" No rows"})})}t(74229);var nr=t(95347);function no(e,n){let t=function(e,n){let t=[...e],i=[...n],l=[];for(;t.length>0&&i.length>0;)if(l.includes(t[0]))t.shift();else if(l.includes(i[0]))i.shift();else if(t[0]===i[0])l.push(t[0]),t.shift(),i.shift();else if(i.includes(t[0])){let e=i.indexOf(t[0]);for(let n=0;n<e;n++)l.includes(i[n])||l.push(i[n]);l.push(t[0]),t.shift(),i.splice(0,e+1)}else l.push(t[0]),t.shift();return t.forEach(e=>{l.includes(e)||l.push(e)}),i.forEach(e=>{l.includes(e)||l.push(e)}),l}(e,n),i={};for(let l of t)e.includes(l)?n.includes(l)?i[l]=void 0:i[l]="removed":i[l]="added";let l={};e.forEach((e,n)=>{l[e]=n});let r=-1;for(let e of t){let n=l[e];void 0!==n&&(n>r?r=n:i[e]="reordered")}return i}function ns(e,n){let t=[];for(let i of n){let n=e.findIndex(e=>e.name===i);if(n<0)throw Error("Column ".concat(i," not found"));t.push(n)}return t}function na(e,n,t){let i={};if(0===n.length)return JSON.stringify({_index:t._index});for(let l of n)i[e[l].name]=t[l];return JSON.stringify(i)}function nd(e){let{name:n,columnStatus:t,onPrimaryKeyChange:r,onPinnedColumnsChange:a,...d}=e,c=d.primaryKeys||[],u=d.pinnedColumns||[],h=c.includes(n),x=u.includes(n);return"index"===n?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(s.k,{alignItems:"center",gap:"10px",className:"grid-header",children:[(0,i.jsx)(l.x,{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:n}),"added"!==t&&"removed"!==t&&r&&(0,i.jsx)(o.J,{className:h?"close-icon":"key-icon",display:h?"block":"none",cursor:"pointer",as:h?nr.ven:nr.MhP,onClick:h?()=>{let e=c.filter(e=>e!==n);r&&r(e)}:()=>{let e=[...c.filter(e=>"index"!==e),n];r&&r(e)}}),!h&&a&&(0,i.jsx)(o.J,{className:x?"unpin-icon":"pin-icon",display:x?"block":"none",cursor:"pointer",as:x?nr.$kI:nr.oJP,onClick:x?()=>{let e=u.filter(e=>e!==n);a&&a(e)}:()=>{let e=[...u,n];a&&a(e)}})]})}let nc=e=>{let n;let t=!1;return"boolean"==typeof e?n=e.toString():""===e?(n="(empty)",t=!0):null==e?(n="(null)",t=!0):n=e,[n,t]},nu=e=>{let{row:n,column:t}=e;if(!n.hasOwnProperty(t.key))return(0,i.jsx)(es.x,{style:{color:"gray"},children:"-"});let[l,r]=nc(n[t.key]);return(0,i.jsx)(es.x,{style:{color:r?"gray":"inherit"},children:l})};function nh(e,n,t){let l=e||{columns:[],data:[]},r=n||{columns:[],data:[]},o=(null==t?void 0:t.primaryKeys)||[],s=(null==t?void 0:t.pinnedColumns)||[],a=(null==t?void 0:t.changedOnly)||!1,d=[],c=function(e,n){let t={};return Object.entries(no(e.columns.map(e=>e.name),n.columns.map(e=>e.name))).map(i=>{let[l,r]=i;t[l]={status:r,baseColumnIndex:e.columns.findIndex(e=>e.name===l),currentColumnIndex:n.columns.findIndex(e=>e.name===l)}}),t}(l,r),u={},h={},x=!1,m=!1;if(0===o.length)l.data.forEach((e,n)=>{e._index=n+1,u[JSON.stringify({_index:n+1})]=e}),r.data.forEach((e,n)=>{e._index=n+1,h[JSON.stringify({_index:n+1})]=e});else{let e=ns(l.columns,o);l.data.forEach((n,t)=>{let i=na(l.columns,e,n);i in u&&(x=!0),u[i]=n}),e=ns(r.columns,o),r.data.forEach((n,t)=>{let i=na(r.columns,e,n);i in h&&(m=!0),h[i]=n})}let p=no(Object.keys(u),Object.keys(h)),f={added:0,removed:0,modified:0},g=Object.entries(p).map(e=>{let[n,t]=e,i=u[n],s=h[n],a=JSON.parse(n);if(i&&l.columns.forEach((e,n)=>{o.includes(e.name)||(a["base__".concat(e.name)]=i[n])}),s&&r.columns.forEach((e,n)=>{o.includes(e.name)||(a["current__".concat(e.name)]=s[n])}),i){if(s){for(let[e,n]of Object.entries(c))"index"===e||o.includes(e)||n.baseColumnIndex<0||n.currentColumnIndex<0||eK().isEqual(i[n.baseColumnIndex],s[n.currentColumnIndex])||(a.__status="modified",n.status="modified");"modified"===a.__status&&f.modified++}else a.__status="removed",f.removed++}else a.__status="added",f.added++;return a});a&&(g=g.filter(e=>"added"===e.__status||"removed"===e.__status||"modified"===e.__status));let v=(e,n)=>{let l="added"===n?"diff-header-added":"removed"===n?"diff-header-removed":void 0,r=t=>{let i=t.__status;if("removed"===i)return"diff-cell-removed";if("added"===i)return"diff-cell-added";if("added"===n);else if("removed"===n);else if(!eK().isEqual(t["base__".concat(e)],t["current__".concat(e)]))return"diff-cell-modified"};return{headerCellClass:l,name:(0,i.jsx)(nd,{name:e,columnStatus:n,...t}),children:[{key:"base__".concat(e),name:(null==t?void 0:t.baseTitle)||"Base",renderEditCell:nt.Ug,headerCellClass:l,cellClass:r,renderCell:nu,size:"auto"},{key:"current__".concat(e),name:(null==t?void 0:t.currentTitle)||"Current",renderEditCell:nt.Ug,headerCellClass:l,cellClass:r,renderCell:nu,size:"auto"}]}};return 0===o.length?d.push({key:"_index",width:50,maxWidth:100,name:"",cellClass:"index-column"}):o.forEach(e=>{let n=c[e].status||"";d.push({key:"".concat(e),name:(0,i.jsx)(nd,{name:e,columnStatus:n,...t}),frozen:!0,cellClass:e=>{if(e.__status)return"diff-header-".concat(e.__status)},renderCell:nu})}),s.forEach(e=>{let n=c[e].status||"";"index"===e||o.includes(e)||d.push(v(e,n))}),Object.entries(c).forEach(e=>{let[n,t]=e,i=t.status||"";"index"===n||o.includes(n)||s.includes(n)||a&&f.modified>0&&"added"!==i&&"removed"!==i&&"modified"!==i||d.push(v(n,i))}),{columns:d,rows:g,invalidPKeyBase:x,invalidPKeyCurrent:m}}let nx=(0,eX.G)((e,n)=>{var t;let{run:l,viewOptions:r,onViewOptionsChanged:o}=e,s=l.result;l.params;let a=(0,j.useMemo)(()=>(null==r?void 0:r.pinned_columns)||[],[r]),d=((null==s?void 0:null===(t=s.current)||void 0===t?void 0:t.columns)||[]).find(e=>"column_name"===e.name.toLowerCase()),c=(null==d?void 0:d.name)||"column_name",u=(0,j.useMemo)(()=>nh(null==s?void 0:s.base,null==s?void 0:s.current,{primaryKeys:[c],pinnedColumns:a,onPinnedColumnsChange:e=>{o&&o({...r,pinned_columns:e})}}),[s,c,a,r,o]);return 0===u.columns.length?(0,i.jsx)(nn.M,{height:"100%",children:"No data"}):(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ni,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:u.columns,rows:u.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})})});function nm(e){let{name:n,columnStatus:t,onPrimaryKeyChange:r,onPinnedColumnsChange:a,...d}=e,c=d.primaryKeys||[],u=d.pinnedColumns||[],h=c.includes(n),x=u.includes(n);return"index"===n?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(s.k,{alignItems:"center",gap:"10px",className:"grid-header",children:[(0,i.jsx)(l.x,{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:n}),!h&&a&&(0,i.jsx)(o.J,{className:x?"unpin-icon":"pin-icon",display:x?"block":"none",cursor:"pointer",as:x?nr.$kI:nr.oJP,onClick:x?()=>{let e=u.filter(e=>e!==n);a&&a(e)}:()=>{let e=[...u,n];a&&a(e)}})]})}function np(e,n,t){let l=(null==t?void 0:t.pinnedColumns)||[],r=(null==t?void 0:t.changedOnly)||!1,o=[],s=function(e){let n={};return e.columns.map((e,t)=>{n[e.name]={index:t}}),n}(e),a={},d={};if(0===n.length)throw Error("Primary keys are required");let c=function(e,n){let t=[];for(let i of n){let n=e.findIndex(e=>e.name===i);if(n<0)throw Error("Column ".concat(i," not found"));t.push(n)}return t}(e.columns,n),u=(s.in_a||s.IN_A).index,h=(s.in_b||s.IN_B).index;e.data.forEach((n,t)=>{let i=function(e,n,t){let i={};if(0===n.length)return JSON.stringify({_index:t._index});for(let l of n)i[e[l].name]=t[l];return JSON.stringify(i)}(e.columns,c,n);n[u]&&(a[i]=n),n[h]&&(d[i]=n)});let x=no(Object.keys(a),Object.keys(d)),m={added:0,removed:0,modified:0},p=Object.entries(x).map(t=>{let[i,l]=t,r=a[i],o=d[i],c=JSON.parse(i);if(r&&e.columns.forEach((e,t)=>{n.includes(e.name)||(c["base__".concat(e.name)]=r[t])}),o&&e.columns.forEach((e,t)=>{n.includes(e.name)||(c["current__".concat(e.name)]=o[t])}),r){if(o)for(let[e,t]of Object.entries(s))!("index"===e||n.includes(e))&&(eK().isEqual(r[t.index],o[t.index])||(c.__status="modified",t.status="modified"));else c.__status="removed",m.removed++}else c.__status="added",m.added++;return"modified"===c.__status&&m.modified++,c});r&&(p=p.filter(e=>"added"===e.__status||"removed"===e.__status||"modified"===e.__status));let f=(e,n)=>{let l="added"===n?"diff-header-added":"removed"===n?"diff-header-removed":void 0,r=t=>{let i=t.__status;if("removed"===i)return"diff-cell-removed";if("added"===i)return"diff-cell-added";if("added"===n);else if("removed"===n);else if(!eK().isEqual(t["base__".concat(e)],t["current__".concat(e)]))return"diff-cell-modified"};return{headerCellClass:l,name:(0,i.jsx)(nm,{name:e,columnStatus:n,...t}),children:[{key:"base__".concat(e),name:(null==t?void 0:t.baseTitle)||"Base",renderEditCell:nt.Ug,headerCellClass:l,cellClass:r,renderCell:nu,size:"auto"},{key:"current__".concat(e),name:(null==t?void 0:t.currentTitle)||"Current",renderEditCell:nt.Ug,headerCellClass:l,cellClass:r,renderCell:nu,size:"auto"}]}};return n.forEach(e=>{let n=s[e].status||"";o.push({key:"".concat(e),name:(0,i.jsx)(nm,{name:e,columnStatus:n,...t}),frozen:!0,cellClass:e=>{if(e.__status)return"diff-header-".concat(e.__status)},renderCell:nu})}),l.forEach(e=>{let t=s[e].status||"";n.includes(e)||o.push(f(e,t))}),Object.entries(s).forEach(e=>{let[t,i]=e,s=i.status||"";"in_a"===t||"in_b"===t||n.includes(t)||l.includes(t)||r&&m.modified>0&&"added"!==s&&"removed"!==s&&"modified"!==s||o.push(f(t,s))}),{columns:o,rows:p}}var nf=t(27904),ng=t(41152),nv=t(65906);let nj=e=>{let{run:n,warnings:t,viewOptions:r,onAddToChecklist:o,onViewOptionsChanged:a}=e;return(0,i.jsxs)(s.k,{borderBottom:"1px solid lightgray",justifyContent:"flex-end",gap:"5px",alignItems:"center",px:"10px",bg:t&&t.length>0?"orange.100":"inherit",children:[(0,i.jsx)(ng.g,{alignItems:"flex-start",spacing:0,children:t&&t.map((e,n)=>(0,i.jsxs)(l.x,{children:[(0,i.jsx)(nf.a,{color:"orange.600"})," ",e]},n))}),(0,i.jsx)(h.L,{minHeight:"32px"}),(0,i.jsx)(nv.X,{isChecked:null==r?void 0:r.changed_only,onChange:()=>{let e=!(null==r?void 0:r.changed_only);a&&a({...r,changed_only:e})},children:"Changed only"}),o&&(0,i.jsx)(ed.z,{marginBlock:"5px",size:"sm",colorScheme:"blue",onClick:()=>o(n),children:"Add to Checklist"})]})},ny=(e,n)=>{var t,l,r,o,a,d;let{run:c,onAddToChecklist:u,viewOptions:h,onViewOptionsChanged:x,baseTitle:m,currentTitle:p}=e,f=(0,j.useMemo)(()=>(null==h?void 0:h.primary_keys)||[],[h]),g=(0,j.useMemo)(()=>(null==h?void 0:h.changed_only)||!1,[h]),v=(0,j.useMemo)(()=>(null==h?void 0:h.pinned_columns)||[],[h]),y=(0,j.useMemo)(()=>{var e,n;return nh(null==c?void 0:null===(e=c.result)||void 0===e?void 0:e.base,null==c?void 0:null===(n=c.result)||void 0===n?void 0:n.current,{changedOnly:g,primaryKeys:f,onPrimaryKeyChange:e=>{x&&x({...h,primary_keys:e})},pinnedColumns:v,onPinnedColumnsChange:e=>{x&&x({...h,pinned_columns:e})},baseTitle:m,currentTitle:p})},[c,h,g,f,v,x,m,p]),b=(0,j.useMemo)(()=>{let e=f.join(", ");return y.invalidPKeyBase&&y.invalidPKeyCurrent?"Warning: The primary key '".concat(e,"' is not unique in the base and current environments"):y.invalidPKeyBase?"Warning: The primary key '".concat(e,"' is not unique in the base environment"):y.invalidPKeyCurrent?"Warning: The primary key '".concat(e,"' is not unique in the current environment"):void 0},[y.invalidPKeyBase,y.invalidPKeyCurrent,f]),w=(null===(l=c.result)||void 0===l?void 0:null===(t=l.current)||void 0===t?void 0:t.limit)||0,k=w>0&&((null==c?void 0:null===(o=c.result)||void 0===o?void 0:null===(r=o.current)||void 0===r?void 0:r.more)||(null==c?void 0:null===(d=c.result)||void 0===d?void 0:null===(a=d.base)||void 0===a?void 0:a.more))?"Warning: Displayed results are limited to ".concat(w.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,C=[];return(b&&C.push(b),k&&C.push(k),0===y.columns.length)?(0,i.jsx)(nn.M,{height:"100%",children:"No data"}):g&&0===y.rows.length?(0,i.jsxs)(s.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(nj,{run:c,viewOptions:h,onAddToChecklist:u,onViewOptionsChanged:x,warnings:C}),(0,i.jsx)(nn.M,{height:"100%",children:"No change"}),";"]}):(0,i.jsxs)(s.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(nj,{run:c,viewOptions:h,onAddToChecklist:u,onViewOptionsChanged:x,warnings:C}),(0,i.jsx)(ni,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:y.columns,rows:y.rows,renderers:{noRowsFallback:(0,i.jsx)(nl,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})},nb=(e,n)=>{var t,l,r,o;let{run:a,onAddToChecklist:d,viewOptions:c,onViewOptionsChanged:u,baseTitle:h,currentTitle:x}=e,m=(0,j.useMemo)(()=>(null==c?void 0:c.changed_only)||!1,[c]),p=(0,j.useMemo)(()=>(null==c?void 0:c.pinned_columns)||[],[c]),f=(0,j.useMemo)(()=>{var e,n;if(!(null===(e=a.result)||void 0===e?void 0:e.diff)||!(null==a?void 0:null===(n=a.params)||void 0===n?void 0:n.primary_keys))return{columns:[],rows:[]};let t=a.params.primary_keys;return np(null==a?void 0:a.result.diff,t,{changedOnly:m,pinnedColumns:p,onPinnedColumnsChange:e=>{u&&u({...c,pinned_columns:e})},baseTitle:h,currentTitle:x})},[a,c,m,p,u,h,x]),g=(null===(l=a.result)||void 0===l?void 0:null===(t=l.diff)||void 0===t?void 0:t.limit)||0,v=g>0&&(null==a?void 0:null===(o=a.result)||void 0===o?void 0:null===(r=o.diff)||void 0===r?void 0:r.more)?"Warning: Displayed results are limited to ".concat(g.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,y=[];return(v&&y.push(v),0===f.columns.length)?(0,i.jsx)(nn.M,{height:"100%",children:"No data"}):m&&0===f.rows.length?(0,i.jsxs)(s.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(nj,{run:a,viewOptions:c,onAddToChecklist:d,onViewOptionsChanged:u,warnings:y}),(0,i.jsx)(nn.M,{height:"100%",children:"No change"})]}):(0,i.jsxs)(s.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(nj,{run:a,viewOptions:c,onAddToChecklist:d,onViewOptionsChanged:u,warnings:y}),(0,i.jsx)(ni,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:f.columns,rows:f.rows,renderers:{noRowsFallback:(0,i.jsx)(nl,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})},nw=(0,eX.G)((e,n)=>{var t,l,r;let o,s;if((null===(t=e.run)||void 0===t?void 0:t.params)&&(null===(l=e.run)||void 0===l?void 0:l.params).current_model&&(o="Original",s="Editor"),(null===(r=e.run)||void 0===r?void 0:r.result)!==void 0&&null!==e.run.result.diff&&void 0!==e.run.result.diff){let t=(0,eX.G)(nb);return(0,i.jsx)(t,{...e,ref:n,baseTitle:o,currentTitle:s})}{let t=(0,eX.G)(ny);return(0,i.jsx)(t,{...e,ref:n,baseTitle:o,currentTitle:s})}});function nk(e){let{name:n,pinnedColumns:t=[],onPinnedColumnsChange:r=()=>{}}=e,a=t.includes(n);return(0,i.jsxs)(s.k,{className:"grid-header",alignItems:"center",children:[(0,i.jsx)(l.x,{flex:1,children:n}),(0,i.jsx)(o.J,{className:a?"unpin-icon":"pin-icon",display:a?"block":"none",cursor:"pointer",as:a?nr.$kI:nr.oJP,onClick:a?()=>{r(t.filter(e=>e!==n))}:()=>{r([...t,n])}})]})}let nC=(0,eX.G)((e,n)=>{let{run:t,viewOptions:r,onViewOptionsChanged:o,onAddToChecklist:a}=e,d=(0,j.useMemo)(()=>(null==r?void 0:r.pinned_columns)||[],[r]),c=null==t?void 0:t.result,u=(0,j.useMemo)(()=>c?function(e,n){let t=[],l=n.pinnedColumns||[],r=(e,t)=>({key:String(e),name:(0,i.jsx)(nk,{name:t,...n}),width:"auto",renderCell:nu});return t.push({key:"_index",name:"",width:50,cellClass:"index-column"}),l.forEach(n=>{let i=eK().findIndex(e.columns,e=>e.name===n);i<0||t.push(r(i,n))}),e.columns.forEach((e,n)=>{l.includes(e.name)||t.push(r(n,e.name))}),e.data.forEach((e,n)=>{e._index=n+1}),{columns:t,rows:e.data}}(c,{pinnedColumns:d,onPinnedColumnsChange:e=>{o&&o({...r,pinned_columns:e})}}):{rows:[],columns:[]},[c,d,r,o]);if(0===u.columns.length)return(0,i.jsx)(nn.M,{height:"100%",children:"No data"});let x=(null==c?void 0:c.limit)||0,m=x>0&&(null==c?void 0:c.more)?"Warning: Displayed results are limited to ".concat(x.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,p=a||m;return(0,i.jsxs)(s.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[p&&(0,i.jsxs)(s.k,{borderBottom:"1px solid lightgray",alignItems:"center",gap:"5px",px:"10px",bg:m?"orange.100":"inherit",children:[m&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nf.a,{color:"orange.600",alignSelf:"center"})," ",(0,i.jsx)(l.x,{children:m})]}),(0,i.jsx)(h.L,{minHeight:"32px"}),a&&(0,i.jsx)(ed.z,{marginBlock:"5px",size:"sm",colorScheme:"blue",onClick:()=>a(t),children:"Add to Checklist"})]}),(0,i.jsx)(ni,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:u.columns,rows:u.rows,renderers:{noRowsFallback:(0,i.jsx)(nl,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})});function n_(e,n){if(e<n){let t=(n-e)/e*100;return"+".concat(t>=.1?t.toFixed(1):" <0.1 ","%")}if(!(e>n))return"0 %";{let t=(e-n)/e*100;return"-".concat(t>=.1?t.toFixed(1):" <0.1 ","%")}}var nS=t(51818),nz=t.n(nS);let nR=(0,eX.G)(function(e,n){let{run:t}=e;function l(e){if(e.base===e.current);else if(e.base<e.current||"N/A"===e.base)return"column-body-added";else if(e.base>e.current||"N/A"===e.current)return"column-body-removed";return"column-body-normal"}let r=t.result||{},o=Object.keys(t.result||{}).map(e=>{let n=r[e],t=nz()(null==n?void 0:n.base)?null==n?void 0:n.base:null,i=nz()(null==n?void 0:n.curr)?null==n?void 0:n.curr:null,l="=";return null!==t&&null!==i?l=t!==i?n_(t,i):"=":t===i?l="N/A":null===t?l="Added":null===i&&(l="Removed"),{name:e,base:null===t?"N/A":Number(t),current:null===i?"N/A":Number(i),delta:l}});return 0===o.length?(0,i.jsx)(nn.M,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"}):(0,i.jsx)(s.k,{direction:"column",children:Object.keys(r).length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ni,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:[{key:"name",name:"Name",cellClass:l},{key:"base",name:"Base Rows",cellClass:l},{key:"current",name:"Current Rows",cellClass:l},{key:"delta",name:"Delta",cellClass:l}],rows:o,renderers:{noRowsFallback:(0,i.jsx)(nl,{})},className:"rdg-light",enableScreenshot:!0})})})}),nE=(0,eX.G)(function(e,n){let{run:t}=e,l=t.result||{},r=Object.keys(t.result||{}).map(e=>{let n=l[e],t=nz()(null==n?void 0:n.curr)?null==n?void 0:n.curr:null;return{name:e,current:null===t?"N/A":Number(t)}});return 0===r.length?(0,i.jsx)(nn.M,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"}):(0,i.jsx)(s.k,{direction:"column",children:Object.keys(l).length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ni,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:[{key:"name",name:"Name"},{key:"current",name:"Row Count"}],rows:r,renderers:{noRowsFallback:(0,i.jsx)(nl,{})},className:"rdg-light",enableScreenshot:!0})})})});var nI=t(88692),nT=t(60287);let nL="#63B3ED";function nD(e,n){let t=n?10:e.counts.length,i=e.counts.slice(0,t),l=e.valids-i.reduce((e,n)=>e+n,0);return e.values.slice(0,t).concat([l]).map((n,t)=>{let r;let o=t===i.length,s=o?l:i[t],a=!1;return o?(r="(others)",a=!0):null==n?(r="(null)",a=!0):"string"==typeof n&&0===n.length?(r="(empty)",a=!0):r=String(n),{isLastItemOthers:o,isSpecialLabel:a,label:r,count:s,displayCount:e0(s),displayRatio:e$(s/e.valids)||"N/A"}})}function nO(e){let{base:n,current:t,children:r}=e;return(0,i.jsx)(nI.u,{label:(0,i.jsxs)(l.x,{children:[(0,i.jsxs)(es.x,{children:[(0,i.jsx)(e6,{color:e1}),"Current: ",t.count," (",t.displayRatio,")"]}),(0,i.jsxs)(es.x,{children:[(0,i.jsx)(e6,{color:e5}),"Base: ",n.count," (",n.displayRatio,")"]})]}),placement:"auto",hasArrow:!0,children:r})}function nA(e){let{topKDiff:n,isDisplayTopTen:t}=e,r=nD(n.current,t),o=nD(n.base,t);return(0,i.jsxs)(l.x,{w:"100%",px:20,py:4,children:[(0,i.jsxs)(s.k,{alignItems:"center",direction:"row",children:[(0,i.jsx)(h.L,{}),(0,i.jsxs)(es.x,{as:"h3",size:"sm",p:"2",color:"gray",children:[(0,i.jsx)(e6,{color:e5})," Base"]}),(0,i.jsxs)(es.x,{as:"h3",size:"sm",p:"2",color:"gray",children:[(0,i.jsx)(e6,{color:e1})," Current"]}),(0,i.jsx)(h.L,{})]}),r.map((e,t)=>{let l=o[t];return e.isLastItemOthers&&0===e.count&&0===l.count?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(j.Fragment,{children:[(0,i.jsx)(nO,{base:l,current:e,children:(0,i.jsxs)(s.k,{alignItems:"center",width:"100%",_hover:{bg:"blackAlpha.300"},px:4,children:[(0,i.jsx)(es.x,{noOfLines:1,width:"10em",fontSize:"sm",color:e.isSpecialLabel?"gray.400":"inherit",children:e.label}),(0,i.jsxs)(s.k,{width:"70%",direction:"column",children:[(0,i.jsxs)(s.k,{height:"1em",children:[(0,i.jsx)(nM,{topkCount:e.count,topkLabel:e.label,valids:n.current.valids,color:e1}),(0,i.jsx)(es.x,{ml:5,mr:2,fontSize:"sm",width:"6em",children:e.displayCount}),(0,i.jsx)(es.x,{color:"gray.400",fontSize:"sm",width:"4em",children:e.displayRatio})]}),(0,i.jsxs)(s.k,{height:"1em",children:[(0,i.jsx)(nM,{topkCount:l.count,topkLabel:l.label,valids:n.base.valids,color:e5}),(0,i.jsx)(es.x,{ml:5,mr:2,fontSize:"sm",width:"6em",children:l.displayCount}),(0,i.jsx)(es.x,{color:"gray.400",fontSize:"sm",width:"4em",children:l.displayRatio})]})]})]})}),(0,i.jsx)(nT.i,{})]},t)})]})}function nM(e){let{topkCount:n,topkLabel:t,valids:l,animation:r=!1,color:o=nL}=e;eG.kL.register(eG.uw,eG.ZL,eG.f$);let s=function(e,n){let{...t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{display:!1,max:n,grid:{display:!1}},y:{display:!1}},plugins:{tooltip:{enabled:!1}},...t}}(n,l,{animation:r}),a=function(e){let{topkLabel:n,topkCount:t,color:i=nL}=e;return{labels:[n],datasets:[{indexAxis:"y",data:[t],backgroundColor:i,hoverBackgroundColor:i,borderWidth:0,borderColor:i,barPercentage:1,categoryPercentage:.6}]}}({topkCount:n,topkLabel:t,color:o});return(0,i.jsx)(eY.$Q,{data:a,options:s,plugins:[]})}let nF=(0,eX.G)((e,n)=>{let{run:t}=e,[l,o]=(0,j.useState)(!0),a=t.result,c=t.params,x=a.base,m=a.current;return(0,i.jsxs)(s.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(e7,{ref:n,blockSize:"auto",children:[(0,i.jsxs)(d.X,{as:"h1",size:"md",paddingTop:4,textAlign:"center",color:"gray.600",children:["Model ",c.model,".",c.column_name]}),(0,i.jsxs)(u.U,{children:[(0,i.jsx)(h.L,{}),(0,i.jsx)(nA,{topKDiff:a,valids:m.valids||0,isDisplayTopTen:l}),(0,i.jsx)(h.L,{})]})]}),(0,i.jsx)(h.L,{}),(x.values.length>10||m.values.length>10)&&(0,i.jsx)(s.k,{p:5,justify:"start",children:(0,i.jsx)(r.r,{onClick:()=>o(e=>!e),textColor:"blue.500",children:l?"View More Items":"View Only Top-10"})})]})}),nN=(0,eX.G)((e,n)=>{var t,l;let{run:r,onAddToChecklist:o,viewOptions:a,onViewOptionsChanged:d}=e,c=(0,j.useMemo)(()=>(null==a?void 0:a.changed_only)||!1,[a]),u=(0,j.useMemo)(()=>(null==a?void 0:a.pinned_columns)||[],[a]),h=(0,j.useMemo)(()=>{var e;if(!r.result||!(null==r?void 0:null===(e=r.params)||void 0===e?void 0:e.primary_key))return{columns:[],rows:[]};let n=r.params.primary_key,t=Array.isArray(n)?n:[n];return np(null==r?void 0:r.result,t,{changedOnly:c,pinnedColumns:u,onPinnedColumnsChange:e=>{d&&d({...a,pinned_columns:e})}})},[r,a,c,u,d]),x=(null===(t=r.result)||void 0===t?void 0:t.limit)||0,m=x>0&&(null==r?void 0:null===(l=r.result)||void 0===l?void 0:l.more)?"Warning: Displayed results are limited to ".concat(x.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,p=[];return(m&&p.push(m),0===h.columns.length)?(0,i.jsx)(nn.M,{height:"100%",children:"No data"}):c&&0===h.rows.length?(0,i.jsxs)(s.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(nj,{run:r,viewOptions:a,onAddToChecklist:o,onViewOptionsChanged:d,warnings:p}),(0,i.jsx)(nn.M,{height:"100%",children:"No change"}),";"]}):(0,i.jsxs)(s.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(nj,{run:r,viewOptions:a,onAddToChecklist:o,onViewOptionsChanged:d,warnings:p}),(0,i.jsx)(ni,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:h.columns,rows:h.rows,renderers:{noRowsFallback:(0,i.jsx)(nl,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})});var nq=t(51609),nH=t(56662);function nV(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:r}=e,[o,s]=(0,j.useState)(!n.columns||0===n.columns.length),a=null==n?void 0:n.model,d=null==n?void 0:n.primary_key,{columns:c,primaryKey:u,isLoading:h,error:x}=eJ(n.model);(0,j.useEffect)(()=>{!d&&u&&t({...n,primary_key:u})},[d,u,n,t]),(0,j.useEffect)(()=>{r(!!d&&!!a)},[d,a,r]);let m=c.map(e=>e.name),p=Array.isArray(d)?d:d?[d]:void 0;return h?(0,i.jsx)(l.x,{children:"Loading..."}):0===m.length||x?(0,i.jsx)(l.x,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsxs)(ng.g,{gap:5,m:"8px 24px",paddingBottom:"200px",children:[(0,i.jsxs)(eH.NI,{children:[(0,i.jsx)(eV.l,{children:"Model"}),(0,i.jsx)(nq.I,{isReadOnly:!0,value:null==n?void 0:n.model})]}),(0,i.jsxs)(eH.NI,{children:[(0,i.jsx)(eV.l,{children:"Primary key"}),(0,i.jsx)(nH.Ph,{placeholder:"Select primary key",isMulti:!0,closeMenuOnSelect:!1,options:(m||[]).map(e=>({label:e,value:e})),value:(p||[]).map(e=>({label:e,value:e})),onChange:e=>{t({...n,primary_key:1==e.length?e[0].value:e.map(e=>e.value)})}})]}),(0,i.jsxs)(eH.NI,{children:[(0,i.jsx)(eV.l,{children:"Columns"}),(0,i.jsx)(nv.X,{marginBottom:"10px",isChecked:o,onChange:e=>{s(e.target.checked),t({...n,columns:void 0})},children:"All columns"}),!o&&(0,i.jsx)(nH.Ph,{isMulti:!0,closeMenuOnSelect:!1,options:(m||[]).map(e=>({label:e,value:e})),value:(n.columns||[]).map(e=>({label:e,value:e})),onChange:e=>{t({...n,columns:(e||[]).map(e=>e.value)})}})]})]})}var nP=t(43215),nW=t(55055),nK=t(60651),nB=t(38371),nJ=t(62885),nU=t(88936),nQ=t(11636);function nZ(e){let{params:n,column:t}=e,{runAction:r}=n4(),a=(e,t)=>{r("value_diff_detail",{...n,...e},t)};return(0,i.jsxs)(s.k,{children:[(0,i.jsx)(l.x,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t}),(0,i.jsx)(h.L,{}),(0,i.jsx)(nP.v,{isLazy:!0,children:e=>{let{isOpen:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nW.j,{className:"row-context-menu",visibility:n?"visible":"hidden",width:n?"auto":"0px",minWidth:n?"auto":"0px",as:nK.h,icon:(0,i.jsx)(o.J,{as:nr.D_A}),variant:"unstyled",size:"sm"}),(0,i.jsx)(nB.h,{children:(0,i.jsx)(nJ.q,{lineHeight:"20px",children:(0,i.jsxs)(nU.k,{title:"Action",as:l.x,fontSize:"8pt",children:[(0,i.jsx)(nQ.s,{fontSize:"10pt",onClick:()=>a({},{showForm:!0}),children:"Show mismatched values..."}),(0,i.jsxs)(nQ.s,{fontSize:"10pt",onClick:()=>a({columns:[t]},{showForm:!1}),children:["Show mismatched values for '",t,"'"]})]})})})]})}})]})}let nX=(0,eX.G)(function(e,n){let{run:t}=e,r=t.result,a=t.params,d=e=>{let n=e[2];return null!=n&&n<1?"diff-cell-modified":""},c=Array.isArray(a.primary_key)?a.primary_key:[a.primary_key],u=[{key:"__is_pk__",name:"",width:30,maxWidth:30,renderCell:e=>{let{row:n}=e;return(0,i.jsx)(nn.M,{height:"100%",children:c.includes(n[0])&&(0,i.jsx)(o.J,{as:nr.MhP})})}},{key:"0",name:"Column",resizable:!0,renderCell:e=>{let{row:n,column:t}=e;return(0,i.jsx)(nZ,{column:n[t.key],params:a})},cellClass:"cell-show-context-menu"},{key:"1",name:"Matched",resizable:!0,cellClass:d},{key:"2",name:"Matched %",resizable:!0,renderCell:e=>{let{column:n,row:t}=e,r=t[n.key];return(0,i.jsx)(l.x,{textAlign:"end",children:void 0!=r&&null!==r?"".concat((100*r).toFixed(2)," %"):"N/A"})},cellClass:d}];return(0,i.jsxs)(s.k,{direction:"column",gap:"5px",pt:"5px",height:"100%",children:[(0,i.jsxs)(l.x,{px:"16px",children:["Model: ",a.model,", ",r.summary.total," total (",r.summary.total-r.summary.added-r.summary.removed," ","common, ",r.summary.added," added, ",r.summary.removed," removed)"]}),(0,i.jsx)(ni,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",borderBlock:"1px solid lightgray"},columns:u,rows:r.data.data,renderers:{noRowsFallback:(0,i.jsx)(nl,{})},defaultColumnOptions:{resizable:!0},className:"rdg-light",enableScreenshot:!0})]})});var nG=t(54517),nY=t(27342);let n$={lineage_diff:{title:"Lineage Diff",icon:eq.Ks7},schema_diff:{title:"Schema Diff",icon:nY.C8A},query:{title:"Query",icon:eq.r2i,RunResultView:nC},query_base:{title:"Query Base",icon:eq.r2i,RunResultView:nC},query_diff:{title:"Query Diff",icon:eq.r2i,RunResultView:nw},row_count:{title:"Row Count",icon:nY.QUK,RunResultView:nE},row_count_diff:{title:"Row Count Diff",icon:nY.QUK,RunResultView:nR},profile_diff:{title:"Profile Diff",icon:eq.KA6,RunResultView:nx},value_diff:{title:"Value Diff",icon:eq.pRi,RunResultView:nX,RunForm:nV},value_diff_detail:{title:"Value Diff Detail",icon:eq.pRi,RunResultView:nN,RunForm:nV},top_k_diff:{title:"Top-K Diff",icon:nG.Pkc,RunResultView:nF,RunForm:function(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:r}=e,{columns:o,isLoading:s,error:a}=eJ(n.model),d=o.map(e=>e.name);return((0,j.useEffect)(()=>{r(!!n.column_name)},[n,r]),s)?(0,i.jsx)(l.x,{children:"Loading..."}):0===d.length||a?(0,i.jsx)(l.x,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsx)(l.x,{m:"16px",children:(0,i.jsxs)(eH.NI,{children:[(0,i.jsx)(eV.l,{children:"Pick a column to show top-k"}),(0,i.jsx)(eP.P,{placeholder:"Select column",value:null==n?void 0:n.column_name,onChange:e=>{let i=e.target.value;t({...n,column_name:i})},children:d.map(e=>(0,i.jsx)("option",{value:e,children:e},e))})]})})}},histogram_diff:{title:"Histogram Diff",icon:eq.dku,RunResultView:ne,RunForm:function(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:r}=e,{columns:o,isLoading:s,error:a}=eJ(n.model),d=o.filter(e=>!eU(e.type)&&!eQ(e.type)&&!eZ(e.type));return s?(0,i.jsx)(l.x,{children:"Loading..."}):0===o.length||a?(0,i.jsx)(l.x,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsx)(l.x,{m:"16px",children:(0,i.jsxs)(eH.NI,{children:[(0,i.jsx)(eV.l,{children:"Pick a column to show Histogram Diff"}),(0,i.jsx)(eP.P,{placeholder:0!==d.length?"Select column":"No numeric column is available",isDisabled:0===d.length,value:null==n?void 0:n.column_name,onChange:e=>{var i;let l=e.target.value;r(!!l);let o=(null===(i=d.find(e=>e.name===l))||void 0===i?void 0:i.type)||"";t({...n,column_name:l,column_type:o})},children:d.map(e=>(0,i.jsxs)("option",{value:e.name,children:[e.name," : ",e.type]},e.name))})]})})}},sandbox:{title:"Sandbox",icon:eq.iQd}},n0=e=>n$[e],n1=(0,j.createContext)({runAction:()=>{},showRunId:e=>{},isRunResultOpen:!1,closeRunResult:()=>{},isHistoryOpen:!1,closeHistory:()=>{},showHistory:()=>{},clearRunResult:()=>{}}),n5=e=>{let[n]=(0,eN.TH)();(0,j.useEffect)(()=>{e()},[e,n])};function n2(e){var n;let{children:t}=e,[l,r]=(0,j.useState)(),{isOpen:o,onOpen:s,onClose:a}=(0,en.q)(),{isOpen:d,onOpen:c,onClose:u}=(0,en.q)(),{isOpen:h,onOpen:x,onClose:m}=(0,en.q)(),p=(0,ee.p)(),[f,g]=(0,j.useState)(),[v,y]=(0,eN.TH)(),w=(0,b.NL)(),k=(0,j.useCallback)((e,n)=>{g(e),c(),!1!==n&&w.invalidateQueries({queryKey:B.runs()})},[g,c,w]),C=(0,j.useCallback)(()=>{g(void 0),u()},[u,g]),_=(0,j.useCallback)(async(e,n,t)=>{try{let i;let l=new Date().getTime().toString();if(null==t?void 0:t.showLast){let t=await e_(e,n,1);1===t.length&&(i=t[0])}let o=n0(e);if(void 0===o)throw Error("Unknown run type: ".concat(e));let{title:a,RunResultView:d,RunForm:c}=o;if(void 0===d)throw Error("Run type ".concat(e," does not have a result view"));if(void 0!==c&&(null==t?void 0:t.showForm))r({session:l,title:a,type:e,params:n,lastRun:i,options:t,RunForm:c}),s();else{let{run_id:t}=await eb(e,n,{nowait:!0});k(t),w.invalidateQueries({queryKey:B.runs()}),v.startsWith("/lineage")&&y("/lineage")}}catch(e){p({title:"Failed to submit a run",description:null==e?void 0:e.message,position:"bottom-right",status:"error",duration:5e3,isClosable:!0})}},[r,s,k,p,v,y,w]);n5(a);let S=async(e,n)=>{try{a();let{run_id:t}=await eb(e,n,{nowait:!0});k(t)}catch(e){p({title:"Failed to submit a run",description:null==e?void 0:e.message,position:"bottom-right",status:"error",duration:5e3,isClosable:!0})}};return(0,i.jsxs)(n1.Provider,{value:{runAction:_,runId:f,showRunId:k,isRunResultOpen:d,closeRunResult:u,isHistoryOpen:h,closeHistory:m,showHistory:x,clearRunResult:C},children:[l&&(0,i.jsx)(eF,{isOpen:o,onClose:a,onExecute:S,title:l.title,type:l.type,params:l.params,initialRun:l.lastRun,RunForm:(null===(n=l.options)||void 0===n?void 0:n.showForm)&&l.RunForm?l.RunForm:void 0},l.session),t]})}let n4=()=>(0,j.useContext)(n1),n6=(0,j.createContext)({latestSelectedCheckId:"",setLatestSelectedCheckId:()=>{}});function n3(e){let{children:n}=e,[t,l]=j.useState("");return(0,i.jsx)(n6.Provider,{value:{setLatestSelectedCheckId:l,latestSelectedCheckId:t},children:n})}let n9=()=>(0,j.useContext)(n6);function n8(e){let{children:n}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(C,{children:(0,i.jsx)(eD,{children:(0,i.jsx)(z,{children:(0,i.jsx)(n2,{children:(0,i.jsx)(n3,{children:n})})})})})})}async function n7(){return(await X.post("/api/checks",{type:"simple"})).data}async function te(e,n){let t=ey?{breaking_change_analysis:!0}:{};return(await X.post("/api/checks",{run_id:e,view_options:n,track_props:t})).data}async function tn(){return(await X.get("/api/checks")).data}async function tt(e){return(await X.get("/api/checks/".concat(e))).data}async function ti(e,n){return(await X.patch("/api/checks/".concat(e),n)).data}async function tl(e){return(await X.delete("/api/checks/".concat(e))).data}async function tr(e){return await X.post("/api/checks/reorder",e)}var to=t(37983),ts=t(50437),ta=t(32392),td=t(74917),tc=t(10649),tu=t(83890),th=t(95133),tx=t(28378),tm=t(62004),tp=t(74327),tf=t(16725),tg=t(64863),tv=t(49431),tj=t(64529),ty=t(77138);function tb(e){let{name:n,setName:t}=e,[r,o]=(0,j.useState)(!1),[s,a]=(0,j.useState)(n),d=(0,j.useRef)(null),c=(0,j.useCallback)(()=>{t(s),o(!1)},[t,o,s]);return(0,j.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&c()};return r&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[r,d,c]),(0,i.jsx)(tv.a,{flex:"0 1 auto",fontSize:"12pt",fontWeight:"500",separator:(0,i.jsx)(ty.X,{color:"gray.500"}),overflow:"hidden",children:(0,i.jsx)(tj.g,{cursor:"pointer",flex:"0 1 auto",overflow:"hidden",children:r?(0,i.jsx)(nq.I,{ref:d,value:s,onChange:e=>{a(e.target.value)},onKeyDown:e=>{"Enter"===e.key?(t(s),o(!1)):"Escape"===e.key&&(a(n),o(!1))},size:"sm",w:"100%"}):(0,i.jsx)(l.x,{flex:"0 1 auto",onClick:()=>{a(n),o(!0)},textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n})})})}var tw=t(98702);t(54351);let tk=(0,j.createContext)(void 0),tC=()=>{let e=(0,j.useContext)(tk);if(!e)throw Error("useLineageViewContext must be used within a LineageViewProvider");return e};function t_(e){let{model:n,name:t,baseType:r,currentType:a,singleEnv:d}=e,{runAction:c}=n4(),{showColumnLevelLineage:u}=tC(),x=a||r,m=()=>{c("histogram_diff",{model:n,column_name:t,column_type:x},{showForm:!1})},p=()=>{c("top_k_diff",{model:n,column_name:t,k:50},{showForm:!1})},f=!r||!a;return(0,i.jsxs)(s.k,{alignItems:"center",children:[(0,i.jsx)(l.x,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t}),(0,i.jsx)(h.L,{}),(0,i.jsx)(nK.h,{icon:(0,i.jsx)(nG.Lr9,{}),"aria-label":"",className:"row-context-menu",visibility:"hidden",width:"0px",minWidth:"0px",variant:"unstyled",size:"sm",onClick:()=>{u(n,t)}}),!d&&(0,i.jsx)(()=>(0,i.jsx)(nP.v,{children:e=>{let{isOpen:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nW.j,{className:"row-context-menu",visibility:n?"visible":"hidden",width:n?"auto":"0px",minWidth:n?"auto":"0px",as:nK.h,icon:(0,i.jsx)(o.J,{as:nr.D_A}),variant:"unstyled",size:"sm"}),(0,i.jsx)(nB.h,{children:(0,i.jsx)(nJ.q,{lineHeight:"20px",children:(0,i.jsxs)(nU.k,{title:"Diff",m:"0",p:"4px 12px",children:[(0,i.jsx)(nQ.s,{fontSize:"10pt",onClick:m,isDisabled:f||!x||!(!eU(x)&&!eQ(x)&&!eZ(x)),children:"Histogram Diff"}),(0,i.jsx)(nQ.s,{fontSize:"10pt",onClick:p,isDisabled:f,children:"Top-k Diff"})]})})})]})}}),{})]})}function tS(e,n){function t(e){return void 0===e.baseIndex?"column-index-added":void 0===e.currentIndex?"column-index-removed":!0===e.reordered?"column-index-reordered":"column-index-normal"}function l(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":e.baseType!==e.currentType?"column-body-type-changed":!0===e.reordered?"column-body-reordered":"column-body-normal"}return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:t},{key:"currentIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:t},{key:"name",name:"Name",resizable:!0,renderCell:e=>{let{row:t,column:l}=e;return n?(0,i.jsx)(t_,{model:n,name:t.name,baseType:t.baseType,currentType:t.currentType}):t.name},cellClass:function(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":!0===e.reordered?"column-body-reordered":"column-body-normal"}},{key:"baseType",name:"Base Type",resizable:!0,cellClass:l},{key:"currentType",name:"Current Type",resizable:!0,cellClass:l}],rows:Object.values(e)}}var tz=t(30028),tR=t(22593);let tE=(0,j.forwardRef)(function(e,n){let t,l,{base:r,current:o,enableScreenshot:a=!1}=e,{columns:d,rows:c}=(0,j.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={};return Object.entries(no(Object.keys(e),Object.keys(n))).forEach(e=>{let[n,i]=e;t[n]={name:n,reordered:"reordered"===i}}),Object.entries(e).map((e,n)=>{let[i,l]=e;t[i].baseIndex=n+1,t[i].baseType=l.type}),Object.entries(n).map((e,n)=>{let[i,l]=e;t[i].currentIndex=n+1,t[i].currentType=l.type}),t}(null==r?void 0:r.columns,null==o?void 0:o.columns),n=(null==o?void 0:o.resource_type)||(null==r?void 0:r.resource_type);return n&&["model","seed","snapshot"].includes(n)?tS(e,(null==o?void 0:o.name)||(null==r?void 0:r.name)):tS(e)},[r,o]),{lineageGraph:u}=eO(),h=!(null==u?void 0:u.catalogMetadata.base),x=!(null==u?void 0:u.catalogMetadata.current);h&&x?t="catalog.json is missing on both current and base environments.":h?t="catalog.json is missing on base environment.":x&&(t="catalog.json is missing on current environment.");let m=r&&void 0===r.columns,p=o&&void 0===o.columns;return m&&p?l="Schema information is missing on both current and base environments.":m?l="Schema information is missing on base environment.":p&&(l="Schema information is missing on current environment."),(0,i.jsxs)(s.k,{direction:"column",children:[t?(0,i.jsxs)(tz.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(tR.z,{}),t]}):l?(0,i.jsxs)(tz.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(tR.z,{}),l]}):(0,i.jsx)(i.Fragment,{}),c.length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ni,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:d,rows:c,renderers:{noRowsFallback:(0,i.jsx)(nl,{})},className:"rdg-light",enableScreenshot:a,ref:n})})]})}),tI=(0,j.forwardRef)(function(e,n){let t,l,{current:r}=e,{columns:o,rows:a}=(0,j.useMemo)(()=>(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return{columns:[{key:"index",name:"",resizable:!0,minWidth:35,width:35,cellClass:"column-index-normal"},{key:"name",name:"Name",resizable:!0,renderCell:e=>{let{row:t,column:l}=e;return n?(0,i.jsx)(t_,{model:n,name:t.name,singleEnv:!0}):t.name},cellClass:"column-body-normal"},{key:"type",name:"Type",resizable:!0,cellClass:"column-body-normal"}],rows:Object.entries(e).map((e,n)=>{let[t,i]=e;return{name:t,index:n+1,type:i.type}})}})(null==r?void 0:r.columns,null==r?void 0:r.name),[r]),{lineageGraph:d}=eO();return(null==d?void 0:d.catalogMetadata.current)||(t="catalog.json is missing."),r&&void 0===r.columns&&(l="Schema information is missing."),(0,i.jsxs)(s.k,{direction:"column",children:[t?(0,i.jsxs)(tz.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(tR.z,{}),t]}):l?(0,i.jsxs)(tz.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(tR.z,{}),l]}):(0,i.jsx)(i.Fragment,{}),a.length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ni,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:o,rows:a,renderers:{noRowsFallback:(0,i.jsx)(nl,{})},className:"rdg-light",enableScreenshot:!1,ref:n})})]})});async function tT(e){return(await X.post("/api/select",e)).data}var tL=t(39556);t(57920);let tD=e=>{let{style:n,children:t,gutterSize:l=5,...r}=e;return(0,i.jsx)(tL.Z,{style:{display:"flex",flexDirection:"row",...n},direction:"horizontal",gutterSize:l,...r,children:t})},tO=e=>{let{style:n,children:t,gutterSize:l=5,...r}=e;return(0,i.jsx)(tL.Z,{style:{display:"flex",flexDirection:"column",...n},gutterSize:l,direction:"vertical",...r,children:t})};var tA=t(15240),tM=t(57038),tF=t(45584);let tN=nr.Nbv,tq=nr.sFB,tH=nr.UGs;function tV(e){return"added"===e?{color:"#1dce00",backgroundColor:"#e8fce5",icon:tN}:"removed"===e?{color:"#ff4444",backgroundColor:"#ffdbdb",icon:tq}:"modified"===e?{color:"#ffa502",backgroundColor:"#fff2dd",icon:tH}:{color:"inherit",backgroundColor:"white",icon:void 0}}function tP(e){if("model"===e)return{color:"#c0eafd",icon:tM.Fn3};if("metric"===e)return{color:"#ffe6ee",icon:tF._MV};if("source"===e)return{color:"#a6dda6",icon:tM.i1q};if("exposure"===e)return{color:"#ffe6ee",icon:tF.n8P};if("semantic_model"===e)return{color:"#fb8caf",icon:tF.R1C};if("seed"===e)return{color:"#a6dda6",icon:tM.tWi};if("snapshot"===e)return{color:"#a6dda6",icon:tM.Dmm};else return{color:"inherit",icon:void 0}}function tW(e,n){if(!e||!n)return;let t=Object.keys(e),i=Object.keys(n);if(t.length!==i.length)return!0;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!0;for(let t of i)if(!e[t]||e[t].type!==n[t].type)return!0;return!1}let tK=e=>{let n,t,{node:r,selected:a,onSelect:d,schemaChanged:c}=e,{icon:u}=tP(r.resourceType),{base:h,current:x}=r.data;if(c){var m;n=null===(m=n0("schema_diff"))||void 0===m?void 0:m.icon,t=tV("modified").color}else!h&&x?(n=tV("added").icon,t=tV("added").color):h&&!x&&(n=tV("removed").icon,t=tV("removed").color);return(0,i.jsxs)(s.k,{width:"100%",fontSize:"10pt",p:"5px 8px",cursor:"pointer",_hover:{bg:"gray.200"},bg:a?"gray.100":"inherit",onClick:()=>d(r.id),alignItems:"center",gap:"5px",children:[(0,i.jsx)(o.J,{as:u}),(0,i.jsx)(l.x,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:r.name}),n&&t&&(0,i.jsx)(o.J,{as:n,color:t})]})},tB=(0,j.forwardRef)(function(e,n){let{check:t}=e,{lineageGraph:l}=eO(),r=t.params,o=[...B.check(t.check_id),"select"],{isLoading:s,error:a,refetch:d,data:c}=(0,y.a)({queryKey:o,queryFn:async()=>tT({select:null==r?void 0:r.select,exclude:null==r?void 0:r.exclude,packages:null==r?void 0:r.packages,view_mode:null==r?void 0:r.view_mode}),refetchOnMount:!0,enabled:!(null==r?void 0:r.node_id)}),[u,h]=(0,j.useMemo)(()=>{let e=[],n=[],t=[],i=[];if(null==r?void 0:r.node_id)for(let n of r.node_id instanceof Array?r.node_id:[r.node_id]){let t=null==l?void 0:l.nodes[n];t&&e.push(t)}else for(let n of(null==c?void 0:c.nodes)||[]){let t=null==l?void 0:l.nodes[n];t&&e.push(t)}let o=e.filter(e=>"model"===e.resourceType||"seed"===e.resourceType||"source"===e.resourceType||"snapshot"===e.resourceType);for(let e of o){var s,a;tW(null===(s=e.data.base)||void 0===s?void 0:s.columns,null===(a=e.data.current)||void 0===a?void 0:a.columns)?n.push(e.id):!e.data.base&&e.data.current?t.push(e.id):e.data.base&&!e.data.current&&i.push(e.id)}function d(e){return n.includes(e.id)?3:t.includes(e.id)?2:i.includes(e.id)?1:0}return o.sort((e,n)=>{let t=d(e),i=d(n);return t!==i?i-t:e.name.localeCompare(n.name)}),[o,n]},[null==r?void 0:r.node_id,null==c?void 0:c.nodes,l]),[x,m]=(0,j.useState)(0);if(s)return(0,i.jsx)(nn.M,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(a)return(0,i.jsxs)(nn.M,{bg:"rgb(249,249,249)",height:"100%",children:["Error: ",null==a?void 0:a.message]});if(0==u.length)return(0,i.jsx)(nn.M,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"});if(x<u.length){let e=u[x];return(0,i.jsxs)(tD,{sizes:[80,20],minSize:30,style:{height:"100%"},children:[(0,i.jsx)(tE,{base:e.data.base,current:e.data.current,enableScreenshot:!0,ref:n}),(0,i.jsx)(tA.aV,{overflow:"auto",backgroundColor:"white",children:u.map((e,n)=>(0,i.jsx)(tK,{node:e,schemaChanged:h.includes(e.id),selected:n===x,onSelect:()=>{m(n)}},n))})]})}return(0,i.jsx)(i.Fragment,{})});var tJ=t(60772);function tU(e){let{value:n,onChange:t}=e,[l,o]=(0,j.useState)(!1),[a,d]=(0,j.useState)(),c=(0,j.useRef)(null),u=()=>{t&&(t(a),o(!1))};return((0,j.useEffect)(()=>{if(l&&c.current){let e=c.current;e.focus(),e.setSelectionRange(e.value.length,e.value.length)}},[l]),l)?(0,i.jsxs)(s.k,{direction:"column",align:"flex-end",height:"100%",children:[(0,i.jsx)(tJ.g,{value:a,onChange:e=>{d(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&o(!1),(e.metaKey||e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),u())},ref:c,flex:1}),(0,i.jsxs)(s.k,{gap:"12px",alignItems:"flex-end",children:[(0,i.jsx)(r.r,{onClick:()=>{setTimeout(()=>{o(!1)},100)},colorScheme:"blue",children:"cancel"}),(0,i.jsx)(ed.z,{mt:"8px",size:"sm",colorScheme:"blue",onClick:u,children:"Update"})]})]}):(0,i.jsx)(es.x,{height:"100%",overflow:"auto",fontSize:"11pt",onClick:()=>{d(n||""),o(!0)},whiteSpace:"pre-wrap",wordBreak:"break-word",color:n?"inherit":"lightgray",children:n||"Add description here"})}var tQ=t(54238);function tZ(){let e=(0,ee.p)();return{successToast:function(n){e({description:n,status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})},failToast:function(n,t){e({title:n,description:"".concat(t),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}}}function tX(){let e=(0,to._)(["\n    **SQL**\n    ```sql\n    ","\n    ```\n    "],["\n    **SQL**\n    \\`\\`\\`sql\n    ","\n    \\`\\`\\`\n    "]);return tX=function(){return e},e}function tG(e){return e.description?e.description:"_(no description)_"}var tY=t(35852),t$=t(92071);let t0=e=>{let{value:n,onChange:t,onRun:l,onRunBase:r,onRunDiff:a,label:d,CustomEditor:c,options:u={},...x}=e;return(0,i.jsxs)(i.Fragment,{children:[(d||l||r)&&(0,i.jsxs)(s.k,{backgroundColor:"#EDF2F880",height:"40px",minH:"40px",fontSize:"14px",align:"center",margin:"0",padding:"0px 16px",children:[(0,i.jsx)(es.x,{as:"b",children:d?d.toUpperCase():""}),(0,i.jsx)(h.L,{}),(l||r)&&(0,i.jsx)(ed.z,{size:"sm",variant:"outline",onClick:l||r,backgroundColor:"white",leftIcon:(0,i.jsx)(o.J,{as:tF.gmG}),padding:"6px 12px",children:"Run Query"})]}),c||(0,i.jsx)(t$.ML,{language:"sql",theme:"vs",value:n,onChange:e=>{void 0!==e&&t&&t(e)},onMount:(e,n)=>{l&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.Enter,l),r&&e.addCommand(n.KeyMod.Alt|n.KeyCode.Enter,r),a&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.Enter,a)},options:{tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent",...u}})]})},t1=e=>{let{value:n,baseValue:t,onChange:l,onChangeBase:r,onRun:o,onRunBase:a,onRunDiff:d,options:c={},labels:u,BaseEnvironmentSetupGuide:h,...x}=e,m=u?u[0]:"Base",p=u?u[1]:"Current";return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(s.k,{height:"100%",gap:0,children:[(0,i.jsx)(tY.K,{height:"100%",width:"50%",gap:0,borderRight:"1px",borderColor:"#D4DBE4",children:(0,i.jsx)(t0,{label:m,value:t||"",onChange:r,onRunBase:a,options:c,CustomEditor:h||void 0,...x})}),(0,i.jsx)(tY.K,{height:"100%",width:"50%",gap:0,children:(0,i.jsx)(t0,{label:p,value:n,onChange:l,onRun:o,options:c,...x})})]})})};var t5=t(86562),t2=t(36807);let t4=(0,eX.G)((e,n)=>{var t,r,o,a;let{isRunning:d,isAborting:c,progress:u,error:h,run:x,onCancel:m,viewOptions:p,onViewOptionsChanged:f,RunResultView:g,children:v,onExecuteRun:j}=e,y=(null==h?void 0:null===(r=h.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.detail)||(null==x?void 0:x.error);if(y)return(0,i.jsxs)(tz.b,{status:"error",children:[(0,i.jsx)(tR.z,{}),"Error: ",y]});if(void 0!==d?d:(null==x?void 0:x.status)==="running"){let e=(null==u?void 0:u.message)?null==u?void 0:u.message:(null==x?void 0:null===(o=x.progress)||void 0===o?void 0:o.message)?null==x?void 0:null===(a=x.progress)||void 0===a?void 0:a.message:"Loading...";return(0,i.jsx)(nn.M,{p:"16px",height:"100%",bg:"rgb(249,249,249)",children:(0,i.jsxs)(ng.g,{children:[(0,i.jsxs)(s.k,{alignItems:"center",children:[(null==u?void 0:u.percentage)===void 0||(null==u?void 0:u.percentage)===null?(0,i.jsx)(t5.D,{isIndeterminate:!0,size:"20px",mr:"8px"}):(0,i.jsx)(t5.D,{size:"20px",value:100*u.percentage,mr:"8px"}),c?(0,i.jsx)(i.Fragment,{children:"Aborting..."}):(0,i.jsx)(i.Fragment,{children:e})]}),!c&&(0,i.jsx)(ed.z,{onClick:m,colorScheme:"blue",size:"sm",children:"Cancel"})]})})}if(!x)return(0,i.jsx)(nn.M,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(v&&g)throw Error("RunView requires either a children or a RunResultView prop, but not both.");if(!v&&!g)throw Error("RunView requires at least one of children or RunResultView prop.");return(0,i.jsxs)(l.x,{h:"100%",style:{contain:"size layout"},overflow:"auto",children:[g&&(x.error||x.result)&&(0,i.jsx)(t2.SV,{children:(0,i.jsx)(g,{ref:n,run:x,viewOptions:p,onViewOptionsChanged:f})}),v&&v({run:x,viewOptions:p,onViewOptionsChanged:f})]})});var t6=t(28376),t3=t(87704),t9=t(72581),t8=t(76675),t7=t(17810),ie=t(99413);t(34336),t(92075);var it=t(96054),ii=t(53009),il=t(19867),ir=t(33059);function io(e){let{node:n}=e,{icon:t}=tP(n.resourceType);return(0,i.jsx)(nI.u,{hasArrow:!0,label:"Type of resource",children:(0,i.jsxs)(ts.Vp,{children:[(0,i.jsx)(ts.AD,{as:t}),(0,i.jsx)(ts.Sn,{children:n.resourceType})]})})}function is(e){let{rowCount:n}=e,t=n.base,l=n.curr,r=null===n.base?"N/A":"".concat(n.base," rows"),s=null===n.curr?"N/A":"".concat(n.curr," rows");return null===t&&null===l?(0,i.jsx)(i.Fragment,{children:" Failed to load"}):null===t||null===l?(0,i.jsxs)(u.U,{children:[(0,i.jsx)(es.x,{children:r}),(0,i.jsx)(o.J,{as:il.Rgz}),(0,i.jsx)(es.x,{children:s})]}):t===l?(0,i.jsxs)(u.U,{children:[(0,i.jsx)(es.x,{children:s}),(0,i.jsx)(o.J,{as:ir.lxc,color:"gray.500"}),(0,i.jsx)(es.x,{color:"gray.500",children:"No Change"})]}):t<l?(0,i.jsxs)(u.U,{children:[(0,i.jsx)(es.x,{children:s}),(0,i.jsx)(o.J,{as:ir.Tvk,color:"green.500"}),(0,i.jsx)(es.x,{color:"green.500",children:n_(t,l)})]}):(0,i.jsxs)(u.U,{children:[(0,i.jsx)(es.x,{children:s}),(0,i.jsx)(o.J,{as:ir.ebp,color:"red.500"}),(0,i.jsx)(es.x,{color:"red.500",children:n_(t,l)})]})}function ia(e){var n,t,l;let r,{rowCount:o,node:s,onRefresh:a,isFetching:d}=e,{runsAggregated:c,refetchRunsAggregated:u}=eO(),h=null==c?void 0:null===(t=c[s.id])||void 0===t?void 0:null===(n=t.row_count_diff)||void 0===n?void 0:n.result,x=null===(l=n0("row_count_diff"))||void 0===l?void 0:l.icon,m=o||h;if(m){let e=(null==m?void 0:m.base)===null?"N/A":null==m?void 0:m.base,n=(null==m?void 0:m.curr)===null?"N/A":null==m?void 0:m.curr;r="".concat(e," -> ").concat(n," rows")}return(0,i.jsx)(nI.u,{label:r,children:(0,i.jsxs)(ts.Vp,{children:[(0,i.jsx)(ts.AD,{as:x}),(0,i.jsx)(ts.Sn,{children:m||d?(0,i.jsx)(ii.N,{isLoaded:!d,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:m?(0,i.jsx)(is,{rowCount:m}):"row count"}):(0,i.jsx)(i.Fragment,{children:"row count"})}),a&&(0,i.jsx)(ts.bq,{as:nK.h,isLoading:d,"aria-label":"Query Row Count",icon:(0,i.jsx)(tp.n,{}),size:"xs",onClick:a})]})})}function id(e){var n,t,l;let r,{rowCount:o,node:s,onRefresh:a,isFetching:d}=e,{runsAggregated:c,refetchRunsAggregated:u}=eO(),h=null==c?void 0:null===(t=c[s.id])||void 0===t?void 0:null===(n=t.row_count)||void 0===n?void 0:n.result,x=null===(l=n0("row_count"))||void 0===l?void 0:l.icon,m=o||h;if(m){let e=null===m.curr?"N/A":m.curr;r="".concat(e," rows")}return(0,i.jsxs)(ts.Vp,{children:[(0,i.jsx)(ts.AD,{as:x}),(0,i.jsx)(ts.Sn,{children:m||d?(0,i.jsx)(ii.N,{isLoaded:!d,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:m?"".concat(r):"row count"}):(0,i.jsx)(i.Fragment,{children:"row count"})}),a&&(0,i.jsx)(ts.bq,{as:nK.h,isLoading:d,"aria-label":"Query Row Count",icon:(0,i.jsx)(tp.n,{}),size:"xs",onClick:a,disabled:"base"===s.from})]})}let ic=e=>{let{node:n,action:t}=e,{status:r,skipReason:o,run:a}=t;if("pending"===r)return(0,i.jsx)(t5.D,{size:"20px",value:0});if("skipped"===r)return(0,i.jsx)(ts.Vp,{backgroundColor:"gray.100",children:(0,i.jsxs)(s.k,{fontSize:"10pt",color:"gray.500",alignItems:"center",gap:"3px",children:[(0,i.jsx)(l.x,{children:"Skipped"}),o&&(0,i.jsx)(nI.u,{label:o,children:(0,i.jsx)(it.s,{})})]})});if(!a)return(0,i.jsx)(t5.D,{isIndeterminate:!0,size:"20px"});let{error:d,result:c,run_id:u,progress:h}=a;if("running"===r)return(null==h?void 0:h.percentage)===void 0?(0,i.jsx)(t5.D,{isIndeterminate:!0,size:"20px"}):(0,i.jsx)(t5.D,{size:"20px",value:(null==h?void 0:h.percentage)*100});if(d)return(0,i.jsxs)(s.k,{fontSize:"10pt",color:"gray",children:[(0,i.jsx)(l.x,{children:"Error"}),o&&(0,i.jsx)(nI.u,{label:d,children:(0,i.jsx)(nf.a,{})})]});if("value_diff"===a.type){let e=0;for(let n of c.data.data)n[2]<1&&e++;return(0,i.jsx)(ts.Vp,{backgroundColor:e>0?"red.100":"green.100",children:(0,i.jsx)(ts.Sn,{children:(0,i.jsx)(s.k,{fontSize:"10pt",color:e>0?"red":"green",alignItems:"center",gap:"3px",children:e>0?"".concat(e," columns mismatched"):"All columns match"})})})}if("row_count_diff"===a.type){let e=a.result;return(0,i.jsx)(ia,{rowCount:e[n.name],node:n})}if("row_count"===a.type){let e=a.result;return(0,i.jsx)(id,{rowCount:e[n.name],node:n})}return(0,i.jsx)(i.Fragment,{children:u})};function iu(e){var n;let t,l,{rowCount:r}=e,o=r.base,s=r.curr,a=null===r.base?"N/A":"".concat(r.base," Rows"),d=null===r.curr?"N/A":"".concat(r.curr," Rows");return null===o&&null===s?(t="Failed to load",l="gray"):null===o||null===s?(t="".concat(a," -> ").concat(d),l=null===o?"green":"red"):o===s?(t="=",l="gray"):o!==s&&(t="".concat(n_(o,s)," Rows"),l=o<s?"green":"red"),(0,i.jsxs)(ts.Vp,{colorScheme:l,children:[(0,i.jsx)(ts.AD,{as:null===(n=n0("row_count_diff"))||void 0===n?void 0:n.icon}),(0,i.jsx)(ts.Sn,{children:t})]})}let ih=e=>{var n,t,r;let a,d,{id:c,inverted:u}=e,{lineageGraph:x,runsAggregated:m}=eO(),p=null==m?void 0:m[c],f=null==x?void 0:x.nodes[c];if(!p&&!f)return(0,i.jsx)(i.Fragment,{});if((null==f?void 0:f.data.base)&&(null==f?void 0:f.data.current)&&(a=tW(null===(t=f.data.base)||void 0===t?void 0:t.columns,null===(r=f.data.current)||void 0===r?void 0:r.columns)),p&&p.row_count_diff){let e=p.row_count_diff;d=e.result.curr!==e.result.base}let g=u?"white":tV("modified").color;return(0,i.jsxs)(s.k,{flex:"1",children:[void 0!==a&&(0,i.jsx)(nI.u,{label:"Schema (".concat(a?"changed":"no change",")"),openDelay:500,children:(0,i.jsx)(l.x,{height:"16px",children:(0,i.jsx)(o.J,{as:null===(n=n0("schema_diff"))||void 0===n?void 0:n.icon,color:a?g:u?"gray":"lightgray"})})}),(0,i.jsx)(h.L,{}),p&&p.row_count_diff&&void 0!==d&&(0,i.jsx)(nI.u,{label:"Row count (".concat(d?"changed":"=",")"),openDelay:500,children:(0,i.jsx)(l.x,{children:(0,i.jsx)(iu,{rowCount:p.row_count_diff.result})})})]})},ix=e=>{let{checked:n,onClick:t}=e;return(0,i.jsx)(s.k,{onClick:t,alignSelf:"center",alignItems:"center",children:n?(0,i.jsx)(o.J,{boxSize:"20px",as:tM.xik}):(0,i.jsx)(o.J,{boxSize:"20px",as:tM.hGI})})};var im=t(76810),ip=t(77712),ig=t(46929);function iv(e){let{base:n,current:t}=e;return(0,i.jsx)(t$.SV,{height:"100%",language:"sql",theme:"vs",original:null==n?void 0:n.raw_code,modified:null==t?void 0:t.raw_code,options:{readOnly:!0,fontSize:14,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same"}})}function ij(e){let{current:n,onChange:t}=e,r=function(e,n){let t=(0,j.useRef)(null);return(0,j.useEffect)(()=>{t.current&&e!==t.current.getValue()&&t.current.setValue(e)},[e]),{onMount(e){let i=e.getModifiedEditor();t.current=i,i.onDidChangeModelContent(()=>{n(i.getValue())})}}}((null==n?void 0:n.raw_code)||"",t);return(0,i.jsx)(l.x,{flex:1,overflowY:"auto",children:(0,i.jsx)(t$.SV,{language:"sql",theme:"vs",original:null==n?void 0:n.raw_code,modified:null==n?void 0:n.raw_code,options:{readOnly:!1,fontSize:14,lineNumbers:"on",automaticLayout:!0,wordWrap:"on",wrappingIndent:"same",renderOverviewRuler:!1,minimap:{enabled:!0}},onMount:r.onMount})})}async function iy(e){return(await X.post("/api/checks",{type:"schema_diff",params:e})).data}let ib={audit_helper:"Require the dbt package 'dbt-labs/audit_helper'. Please install it and re-run dbt to activate this feature.",dbt_profiler:"Require the dbt package 'data-mie/dbt_profiler'. Please install it and re-run dbt to activate this feature.",add_or_remove:"Unavailable for added or removed resources."},iw=e=>{var n;let[t,i]=(0,j.useState)(!1),[l,r]=(0,j.useState)(!1),[,o]=eA(),{error:s,data:a}=(0,y.a)({queryKey:B.run(e||""),queryFn:async()=>ew(e||"",t?2:0),enabled:!!e,refetchInterval:!!t&&50,retry:!1});(0,j.useEffect)(()=>{(s||(null==a?void 0:a.result)||(null==a?void 0:a.error))&&(t&&i(!1),((null==a?void 0:a.type)==="row_count_diff"||(null==a?void 0:a.type)==="row_count")&&o()),(null==a?void 0:a.status)==="running"&&i(!0)},[a,s,t,o]);let d=(0,j.useCallback)(async()=>{if(r(!0),e)return await ek(e)},[e,r]),c=(null==a?void 0:a.type)?null===(n=n0(a.type))||void 0===n?void 0:n.RunResultView:void 0;return{run:a,isRunning:t,aborting:l,error:s,onCancel:d,RunResultView:c}};var ik=t(2607),iC=t(16947),i_=t(89258),iS=t.n(i_),iz=t(85027),iR=t(40892),iE=t(24766),iI=t.n(iE);let iT="ignore-screenshot";function iL(e){let{renderLibrary:n="html2canvas",imageType:t="png",backgroundColor:l=null,boardEffect:r=!0,shadowEffect:o=!1,borderStyle:d="solid 1px #ccc",borderRadius:c="10px",onSuccess:u,onError:h,ignoreElements:x}=e,[m,p]=(0,j.useState)("idle"),f=(0,j.useRef)(null),{onOpen:g,setImgBlob:v,ImageDownloadModal:y}=function(){let{isOpen:e,onOpen:n,onClose:t}=(0,en.q)(),[l,r]=(0,j.useState)();return{onOpen:n,setImgBlob:r,ImageDownloadModal:function(){let[n,r]=(0,j.useState)();return(0,j.useEffect)(()=>{if(!l)return;let e=new FileReader;e.readAsDataURL(l),e.onloadend=e=>{var n,t;(null===(n=e.target)||void 0===n?void 0:n.result)&&(null===(t=e.target)||void 0===t?void 0:t.result)!==null&&r(e.target.result)}},[r]),(0,i.jsxs)(et.u_,{size:"3xl",isOpen:e,onClose:t,children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{children:[(0,i.jsx)(er.x,{children:"Screenshot Preview"}),(0,i.jsx)(eM.o,{}),(0,i.jsxs)(eo.f,{children:[(0,i.jsxs)(s.k,{px:"10px",gap:"10px",direction:"column",children:[(0,i.jsxs)(s.k,{alignItems:"center",gap:"5px",children:[(0,i.jsx)(it.s,{color:"red.600"}),(0,i.jsx)(es.x,{fontWeight:"500",display:"inline",children:"Copy to the Clipboard"})," ","is not supported in the current browser"]}),(0,i.jsx)(es.x,{children:"Please download it directly"})]}),(0,i.jsx)(a.E,{src:n,alt:"screenshot"})]}),(0,i.jsxs)(ea.m,{children:[(0,i.jsx)(ed.z,{mr:3,onClick:t,children:"Close"}),(0,i.jsx)(ed.z,{colorScheme:"blue",onClick:()=>{if(!l)return;let e=new Date,n="recce-screenshot-".concat((0,iR.WU)(e,"yyyy-MM-dd-HH-mm-ss"),".png");iI()(l,n),t()},children:"Download"})]})]})]})}}}(),b=async()=>{if(!f.current)throw console.error("No node to use for screenshot"),Error("No node to use for screenshot");let e=f.current.element||f.current,t=e.style.overflow,i=e.style.border,s=e.style.borderRadius,a=e.style.backgroundColor,u=e.style.height;try{var h;e.style.overflow="hidden",e.style.border=r?d:"",e.style.borderRadius=r?c:"",e.style.backgroundColor=l||"",e.style.height=e.offsetHeight+"px";let t=document.createElement("style");document.head.appendChild(t),null===(h=t.sheet)||void 0===h||h.insertRule("body > div:last-child img { display: inline-block; }"),p("loading");let i="html2canvas"===n?await iS()(e,{logging:!1,backgroundColor:null,ignoreElements:x}):await (0,iz.rT)(e,{filter:x?e=>!x(e):void 0});t.remove();let s=o?document.createElement("canvas"):i;if(o){s.width=i.width+80,s.height=i.height+80;let e=s.getContext("2d");if(e)e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=20,e.shadowOffsetX=10,e.shadowOffsetY=10,e.drawImage(i,40,40);else throw console.error("Error getting canvas context"),Error("Error getting canvas context to add shadow effect")}let a=await fetch(s.toDataURL());return await a.blob()}catch(e){throw console.error("Error converting to image",e),e}finally{e.style.overflow=t,e.style.border=i,e.style.borderRadius=s,e.style.backgroundColor=a,e.style.height=u}};return{status:m,isLoading:"loading"===m,isErrored:"error"===m,isSuccess:"success"===m,copyToClipboard:async()=>{try{await navigator.clipboard.write([new ClipboardItem({["image/".concat(t)]:b()})]),p("success"),u&&u()}catch(e){"ClipboardItem is not defined"===e.message?(v(await b()),g(),p("success")):(p("error"),console.error("Error copying to clipboard",e),h&&h(e))}},ImageDownloadModal:y,ref:f}}function iD(e){let{successToast:n,failToast:t}=tZ(),{isLoading:l,copyToClipboard:r,ImageDownloadModal:o,ref:s}=iL({imageType:"png",shadowEffect:!0,backgroundColor:(null==e?void 0:e.backgroundColor)||null,onSuccess:()=>{n("Copied the query result as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),t("Failed to copy image to clipboard",e)}}),a=(0,j.useCallback)(()=>{if(s.current){let e=s.current.element||s.current;e.style.boxShadow="rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px",e.style.transition="box-shadow 0.5s ease-in-out"}},[s]),d=(0,j.useCallback)(()=>{s.current&&((s.current.element||s.current).style.boxShadow="")},[s]),c=(0,j.useCallback)(async()=>{s.current?(await r(),(s.current.element||s.current).style.boxShadow=""):t("Failed to copy image to clipboard","No content to copy")},[s,r,t]);return{ref:s,CopyToClipboardButton:function(e){let{imageType:n="png",...t}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ed.z,{size:"sm",leftIcon:(0,i.jsx)(th.T,{}),style:{position:"absolute",bottom:"16px",right:"16px"},isLoading:l,onMouseEnter:a,onMouseLeave:d,onClick:c,children:"Copy to Clipboard"}),(0,i.jsx)(o,{})]})},onMouseEnter:a,onMouseLeave:d,onCopyToClipboard:c}}let iO=e=>{let{run:n}=e,t=(null==n?void 0:n.status)==="running",l=null==n?void 0:n.status;!l&&(n.result?l="finished":n.error&&(l="failed"));let r="",o="";"successful"===l||"finished"===l?(r="green",o="Finished"):"failed"===l?(r="red",o="Failed"):"cancelled"===l?(r="gray",o="Cancelled"):"running"===l?(r="blue",o="Running"):(r="green",o="Finished");let a=(null==n?void 0:n.run_at)?function(e){let n=new Date,t=new Date;return(t.setDate(n.getDate()-1),null==e)?null:n.toDateString()===e.toDateString()?"Today, "+(0,iR.WU)(e,"HH:mm"):t.toDateString()===e.toDateString()?"Yesterday, "+(0,iR.WU)(e,"HH:mm"):(0,iR.WU)(e,"MMM d, HH:mm")}(new Date(n.run_at)):null;return(0,i.jsxs)(s.k,{justifyContent:"start",fontSize:"11pt",color:"gray.500",gap:"3px",alignItems:"center",overflow:"hidden",children:[t&&(0,i.jsx)(t3.$,{size:"xs",color:"".concat(r,".400")}),(0,i.jsx)(es.x,{fontWeight:500,color:"".concat(r,".400"),children:o}),(0,i.jsx)(es.x,{children:""}),(0,i.jsx)(es.x,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:a})]})},iA=e=>{let n=ik.ZP.stringify(e,null,2);return(0,i.jsx)(t$.ML,{height:"100%",language:"yaml",theme:"vs",value:n,options:{readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})},iM=e=>{var n,t,l;let{runId:r,onClose:o,disableAddToChecklist:a}=e,{runAction:d}=n4(),{error:c,run:f,onCancel:g,isRunning:v}=iw(r),[y,w]=(0,j.useState)(),k=(0,b.NL)(),[,C]=(0,eN.TH)(),[_,S]=(0,j.useState)(0),z=(null==f?void 0:f.type)?null===(n=n0(f.type))||void 0===n?void 0:n.RunResultView:void 0,R=(0,j.useCallback)(()=>{d((null==f?void 0:f.type)||"",null==f?void 0:f.params)},[f,d]),E=null==f?void 0:f.check_id,I=(0,j.useCallback)(async()=>{E&&C("/checks/".concat(E))},[E,C]),T=(0,j.useCallback)(async()=>{if(!r)return;let e=await te(r,y);k.invalidateQueries({queryKey:B.checks()}),C("/checks/".concat(e.check_id))},[r,C,k,y]),L=(null==f?void 0:f.type)==="query"||(null==f?void 0:f.type)==="query_diff"||(null==f?void 0:f.type)==="query_base",{ref:D,onCopyToClipboard:O,onMouseEnter:A,onMouseLeave:M}=iD();return(0,i.jsxs)(s.k,{direction:"column",children:[(0,i.jsx)(x.m,{tabIndex:_,onChange:S,flexDirection:"column",mb:"1px",children:(0,i.jsxs)(m.t,{height:"50px",children:[(0,i.jsx)(p.O,{children:"Result"}),(0,i.jsx)(p.O,{children:"Params"}),L&&(0,i.jsx)(p.O,{children:"Query"}),(0,i.jsx)(h.L,{}),(0,i.jsxs)(u.U,{overflow:"hidden",children:[f&&(0,i.jsx)(iO,{run:f}),(0,i.jsx)(ed.z,{leftIcon:(0,i.jsx)(tp.n,{}),variant:"outline",isDisabled:!r||v,size:"sm",onClick:R,children:"Rerun"}),(0,i.jsx)(ed.z,{leftIcon:(0,i.jsx)(th.T,{}),variant:"outline",isDisabled:!r||!(null==f?void 0:f.result)||!!c||0!==_,onMouseEnter:A,onMouseLeave:M,size:"sm",onClick:O,children:"Copy to Clipboard"}),(0,i.jsx)(function(){return a?(0,i.jsx)(i.Fragment,{}):(null==f?void 0:f.check_id)?(0,i.jsx)(ed.z,{leftIcon:(0,i.jsx)(iC.n,{}),isDisabled:!r||!(null==f?void 0:f.result)||!!c,size:"sm",colorScheme:"blue",onClick:I,children:"Go to Check"}):(0,i.jsx)(ed.z,{leftIcon:(0,i.jsx)(iC.n,{}),isDisabled:!r||!(null==f?void 0:f.result)||!!c,size:"sm",colorScheme:"blue",onClick:T,children:"Add to Checklist"})},{}),(0,i.jsx)(ig.P,{onClick:()=>{o&&o()}})]})]})}),0===_&&(0,i.jsx)(t4,{ref:D,error:c,run:f,onCancel:g,viewOptions:y,onViewOptionsChanged:w,RunResultView:z}),1===_&&f&&(0,i.jsx)(iA,{type:f.type,params:f.params}),2===_&&f&&((null===(t=f.params)||void 0===t?void 0:t.base_sql_template)?(0,i.jsx)(t1,{value:f.params.sql_template,baseValue:f.params.base_sql_template,options:{readOnly:!0}}):(0,i.jsx)(t0,{value:(null==f?void 0:null===(l=f.params)||void 0===l?void 0:l.sql_template)||"",options:{readOnly:!0}}))]})},iF=e=>{let{onClose:n,disableAddToChecklist:t}=e,{runId:l}=n4();return(0,i.jsx)(iM,{runId:l,onClose:n,disableAddToChecklist:t})};var iN=t(17429);async function iq(e,n){return await eb("query",e,n)}async function iH(e,n){return await eb("query_base",e,n)}async function iV(e,n){return await eb("query_diff",e,n)}function iP(){return(0,i.jsx)(l.x,{height:"100%",children:(0,i.jsxs)(tY.K,{spacing:4,p:4,m:"32px",fontSize:"sm",children:[(0,i.jsx)(d.X,{as:"h1",size:"md",children:"Config the Base Environment to run query diff"}),(0,i.jsx)(es.x,{children:"To diff the model by SQL, you need to setup two environments. Currently, only the target environment is setup."}),(0,i.jsx)(es.x,{children:"Please configure the base environment before running the query diff."}),(0,i.jsx)(r.r,{textDecor:"underline",isExternal:!0,color:"blue.500",href:"https://datarecce.io/docs/get-started/#prepare-dbt-artifacts",children:"Learn how"})]})})}function iW(e){let{current:n}=e;return(0,i.jsxs)(s.k,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,i.jsxs)(l.x,{children:[(0,i.jsxs)(d.X,{as:"h2",size:"md",display:"flex",alignItems:"center",gap:"5px",children:[(0,i.jsx)(o.J,{as:iN.vc4,boxSize:"1.2em"}),"Query"]}),(0,i.jsx)(es.x,{fontSize:"xs",color:"gray.500",children:"Query model by SQL"})]}),(0,i.jsx)(h.L,{}),(0,i.jsx)(nI.u,{label:"Please configure the base environment before running the diff",children:(0,i.jsx)(ed.z,{colorScheme:"blue",isDisabled:!0,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})})]})}function iK(e){let{isOpen:n,onClose:t,current:r}=e,{isOpen:o,onClose:u,onOpen:h}=(0,en.q)(),[x,m]=(0,j.useState)('SELECT * FROM {{ ref("'.concat(null==r?void 0:r.name,'")}}')),{showRunId:p,clearRunResult:f}=n4(),{lineageGraph:g}=eO(),v="N/A";if((null==g?void 0:g.nodes)&&(null==g?void 0:g.nodes[(null==r?void 0:r.id)||""])){var y;let e=null==g?void 0:g.nodes[(null==r?void 0:r.id)||""];(null===(y=e.data.current)||void 0===y?void 0:y.schema)&&(v=e.data.current.schema)}(0,j.useEffect)(()=>{m('SELECT * FROM {{ ref("'.concat(null==r?void 0:r.name,'")}}'))},[r]);let b=async()=>{let{run_id:e}=await iq({sql_template:x},{nowait:!0});return p(e),await ew(e)},{mutate:w,isPending:k}=(0,tw.D)({mutationFn:b});return(0,i.jsx)(et.u_,{isOpen:n,size:"full",onClose:()=>{t(),u(),f()},children:(0,i.jsxs)(el.h,{height:"100%",children:[(0,i.jsx)(er.x,{height:"40px",bg:"rgb(77, 209, 176)",px:0,py:4,children:(0,i.jsxs)(s.k,{alignItems:"center",height:"100%",gap:"10px",children:[(0,i.jsx)(a.E,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,i.jsx)(d.X,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,i.jsx)(c.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:"Experiment"})]})}),(0,i.jsx)(eM.o,{}),(0,i.jsx)(eo.f,{p:0,children:(0,i.jsxs)(tO,{sizes:o?[50,50]:[100,0],minSize:o?100:0,gutterSize:o?5:0,style:{flex:"1",contain:"size",height:"100%"},children:[(0,i.jsx)(l.x,{p:0,style:{contain:"content"},children:(0,i.jsxs)(s.k,{direction:"column",height:"100%",m:0,p:0,children:[(0,i.jsx)(iW,{current:r}),(0,i.jsx)(t1,{value:x,onChange:m,onRun:()=>{w(),h()},labels:["base (production)","current (".concat(v,")")],BaseEnvironmentSetupGuide:(0,i.jsx)(iP,{})})]})}),o?(0,i.jsx)(iF,{onClose:u,disableAddToChecklist:!0}):(0,i.jsx)(l.x,{})]})})]})})}var iB=t(17879),iJ=t(67891),iU=t(83868);let iQ=e=>{let{defaultValues:n,suggestionList:t,onValuesChange:r,isDisabled:s}=e,[a,d]=(0,j.useState)(n||[]),[c,u]=(0,j.useState)(""),[h,x]=(0,j.useState)(!1),m=(0,j.useRef)(null),p=e=>{a.includes(e)||(u(""),d([...a,e]),r([...a,e]))};if(s)return(0,i.jsx)(nI.u,{label:ib.audit_helper,children:(0,i.jsx)(nq.I,{size:"xs",disabled:!0,placeholder:"Unavailable"})});let f=(null==t?void 0:t.filter(e=>""===c||e.includes(c)).filter(e=>!a.includes(e)))||[];return(0,i.jsxs)(iB.B,{size:e.size,width:e.width,children:[(0,i.jsxs)(nP.v,{isLazy:!0,closeOnSelect:!1,onOpen:()=>{var e;return null==m?void 0:null===(e=m.current)||void 0===e?void 0:e.focus()},children:[(0,i.jsxs)(nW.j,{width:"100%",children:[(0,i.jsx)(nq.I,{placeholder:e.placeholder,size:e.size,borderRadius:"4px",value:a.length>1?"".concat(a.length," ").concat(e.unitName,"s selected"):1===a.length?"".concat(a[0]):"",onChange:()=>{},backgroundColor:"white"}),0===a.length&&(0,i.jsx)(iJ.x,{children:(0,i.jsx)(o.J,{as:tF.RiI,color:"blue.500",fontSize:e.size,mt:"1",mr:"6"})})]}),(0,i.jsx)(nB.h,{children:(0,i.jsxs)(nJ.q,{zIndex:"popover",fontSize:e.size,width:e.width,children:[(0,i.jsx)(nU.k,{children:(0,i.jsxs)(iU.E,{border:"1px solid #e2e8f0",borderRadius:"4px",width:"calc(100% - 8px)",marginX:"4px",padding:"4px",children:[a.map((n,t)=>(0,i.jsx)(iU.U,{children:(0,i.jsxs)(ts.Vp,{size:e.size,children:[(0,i.jsx)(ts.Sn,{paddingLeft:"8px",children:n}),(0,i.jsx)(ts.SD,{paddingRight:"8px",onClick:()=>{d(a.filter(e=>e!==n)),r(a.filter(e=>e!==n))}})]},n)},"tag-".concat(t))),(0,i.jsx)(iU.U,{width:"100%",children:(0,i.jsx)(nq.I,{ref:m,placeholder:"Filter or add custom keys",variant:"unstyled",size:e.size,value:c,onChange:e=>{u(e.target.value),x(!0)},onKeyDown:e=>{let n=e.currentTarget.value.trim().replace(",","");switch(e.key){case",":case"Enter":p(n),u("");break;case"Backspace":""===e.currentTarget.value&&a.length>0&&(d(a.slice(0,-1)),r(a.slice(0,-1)))}},onBlur:()=>{var e;m&&h&&(null==m||null===(e=m.current)||void 0===e||e.focus())}})})]})}),(0,i.jsx)(ta.R,{}),(0,i.jsxs)(nU.k,{children:[""!==c&&!(null==t?void 0:t.includes(c))&&(0,i.jsxs)(nQ.s,{onClick:()=>{p(c),x(!1)},children:["Add '",c,"' to the list"]},"custom-value-by-filter"),null==f?void 0:f.map((e,n)=>(0,i.jsx)(nQ.s,{onClick:()=>p(e),children:e},"option-".concat(n))).slice(0,10),(null==f?void 0:f.length)>10&&(0,i.jsx)(nI.u,{label:"Please use filter to find more items",placement:"top",children:(0,i.jsxs)(l.x,{px:"12px",color:"gray",fontSize:"8pt",children:["and ",f.length-10," more items..."]})})]})]})})]}),a.length>0&&(0,i.jsx)(iJ.x,{children:(0,i.jsx)(ed.z,{variant:"link",color:"#3182CE",fontSize:e.size,paddingTop:"4px",paddingRight:"24px",onClick:()=>{u(""),d([]),r([])},children:"Clear"})})]})},iZ=e=>{let{defaultPrimaryKeys:n,onPrimaryKeysChange:t,...l}=e,{lineageGraph:r,isActionAvailable:o}=eO(),a=(0,j.useMemo)(()=>{if(!r)return[];let e=new Set;for(let i in r.nodes){var n,t;let l=r.nodes[i],o=null===(n=l.data.base)||void 0===n?void 0:n.columns,s=null===(t=l.data.current)||void 0===t?void 0:t.columns;for(let n in o)e.add(n);for(let n in s)e.add(n)}return Array.from(e).sort()},[r]);return(0,i.jsx)(s.k,{...l,children:(0,i.jsxs)(eH.NI,{m:"4px 8px",children:[(0,i.jsxs)(eV.l,{fontSize:"8pt",margin:"0",children:["Diff with Primary Key(s) (suggested)"," ",(0,i.jsx)(nI.u,{label:"Provide a primary key to perform query diff in data warehouse and only return changed rows.",placement:"bottom-end",children:(0,i.jsx)(it.s,{color:"gray.600",boxSize:"3"})})]}),(0,i.jsx)(iQ,{unitName:"key",defaultValues:n,suggestionList:a,onValuesChange:t,size:"xs",width:"240px",placeholder:"Select or type to add keys",isDisabled:!o("query_diff_with_primary_key")})]})})};var iX=t(302);function iG(e){let{description:n,onLike:t,onDislike:l,onClickLink:o,externalLink:d,externalLinkText:c}=e;return(0,i.jsxs)(s.k,{gap:4,justifyContent:"center",alignContent:"center",alignItems:"center",children:[n,(0,i.jsx)(nK.h,{"aria-label":"thumbs up",variant:"ghost",icon:(0,i.jsx)(a.E,{src:"/imgs/feedback/thumbs-up.png",alt:"like"}),width:"32px",height:"32px",onClick:t}),(0,i.jsx)(nK.h,{"aria-label":"thumbs down",variant:"ghost",icon:(0,i.jsx)(a.E,{src:"/imgs/feedback/thumbs-down.png",alt:"dislike"}),width:"32px",height:"32px",onClick:l}),d&&c&&(0,i.jsx)(r.r,{href:d,isExternal:!0,textDecoration:"underline",onClick:o,children:c})]})}let iY="recce-",i$={bypassSaveOverwrite:"".concat(iY,"-bypass-save-overwrite"),previewChangeFeedbackID:"".concat(iY,"-preview-change-feedback"),prepareEnvGuideID:"".concat(iY,"-prepare-env")};var i0=t(29260),i1=t(30997),i5=t(21257),i2=t(32501),i4=t(1363),i6=t(23260),i3=t(35757),i9=t(7090);let i8=e=>(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,i.jsx)("g",{"clip-path":"url(#clip0_1479_25070)",children:(0,i.jsx)("path",{d:"M15.625 0.25H14.759C14.5484 0.25 14.3791 0.423375 14.3841 0.633937L14.4575 3.71441C13.0691 1.62634 10.6955 0.25 8 0.25C4.21291 0.25 1.06041 2.96638 0.38425 6.557C0.340875 6.78728 0.518875 7 0.753219 7H1.64622C1.82353 7 1.97566 6.87556 2.013 6.70222C2.60753 3.9415 5.05991 1.875 8 1.875C10.4858 1.875 12.6232 3.35256 13.5836 5.47819L9.63394 5.38416C9.42341 5.37916 9.25 5.54844 9.25 5.75906V6.625C9.25 6.83209 9.41791 7 9.625 7H15.625C15.8321 7 16 6.83209 16 6.625V0.625C16 0.417906 15.8321 0.25 15.625 0.25ZM15.2468 9H14.3538C14.1765 9 14.0243 9.12444 13.987 9.29778C13.3925 12.0585 10.9401 14.125 8 14.125C5.51419 14.125 3.37681 12.6474 2.41637 10.5218L6.36606 10.6158C6.57659 10.6208 6.75 10.4516 6.75 10.2409V9.375C6.75 9.16791 6.58209 9 6.375 9H0.375C0.167906 9 0 9.16791 0 9.375V15.375C0 15.5821 0.167906 15.75 0.375 15.75H1.24097C1.45156 15.75 1.62088 15.5766 1.61588 15.3661L1.54253 12.2856C2.93087 14.3737 5.3045 15.75 8 15.75C11.7871 15.75 14.9396 13.0336 15.6158 9.443C15.6591 9.21272 15.4811 9 15.2468 9Z",fill:"currentColor"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"clip0_1479_25070",children:(0,i.jsx)("rect",{width:"16",height:"16",fill:"white"})})})]}),i7=e=>(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,i.jsx)("g",{"clip-path":"url(#clip0_1479_25102)",children:(0,i.jsx)("path",{d:"M-1.88399 8.72062L0.358816 6.46094C0.594752 6.22344 1.00006 6.39031 1.00006 6.725V8.2525H4.00005V4.12438C4.00005 3.7275 4.16161 3.34313 4.44286 3.06219L7.06441 0.440625C7.34566 0.159375 7.72691 0 8.12347 0H14.5003C15.3281 0.003125 16 0.675 16 1.50281V14.5003C16 15.3281 15.3281 16 14.5003 16H5.50223C4.67411 16 4.00005 15.3281 4.00005 14.5003V11.2522H5.50005V14.5003H14.5003V1.50281H9.50128V4.75219C9.50128 5.16781 9.1669 5.50187 8.75128 5.50187H5.50005V8.25219H10.625C10.8322 8.25219 11 8.42 11 8.62719V9.37719C11 9.58438 10.8322 9.75219 10.625 9.75219H1.00006V11.2797C1.00006 11.6144 0.594752 11.7813 0.358816 11.5438L-1.88399 9.28406C-2.03867 9.12813 -2.03867 8.87656 -1.88399 8.72062ZM8.0016 4.00219V1.62469L5.62379 4.00219H8.0016Z",fill:"currentColor"})}),(0,i.jsx)("g",{"clip-path":"url(#clip1_1479_25102)",children:(0,i.jsx)("path",{d:"M0.103056 8.72062L2.09667 6.46094C2.30639 6.22344 2.66667 6.39031 2.66667 6.725V8.2525H5.33333V4.12438C5.33333 3.7275 5.47694 3.34313 5.72694 3.06219L8.05722 0.440625C8.30722 0.159375 8.64611 0 8.99861 0H14.6669C15.4028 0.003125 16 0.675 16 1.50281V14.5003C16 15.3281 15.4028 16 14.6669 16H6.66861C5.9325 16 5.33333 15.3281 5.33333 14.5003V11.2522H6.66667V14.5003H14.6669V1.50281H10.2233V4.75219C10.2233 5.16781 9.92611 5.50187 9.55667 5.50187H6.66667V8.25219H11.2222C11.4064 8.25219 11.5556 8.42 11.5556 8.62719V9.37719C11.5556 9.58438 11.4064 9.75219 11.2222 9.75219H2.66667V11.2797C2.66667 11.6144 2.30639 11.7813 2.09667 11.5438L0.103056 9.28406C-0.0344448 9.12813 -0.0344448 8.87656 0.103056 8.72062ZM8.89028 4.00219V1.62469L6.77666 4.00219H8.89028Z",fill:"currentColor"})}),(0,i.jsxs)("defs",{children:[(0,i.jsx)("clipPath",{id:"clip0_1479_25102",children:(0,i.jsx)("rect",{width:"13",height:"16",fill:"white",transform:"matrix(-1 0 0 1 16 0)"})}),(0,i.jsx)("clipPath",{id:"clip1_1479_25102",children:(0,i.jsx)("rect",{width:"3",height:"16",fill:"white"})})]})]}),le=e=>(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,i.jsx)("g",{"clip-path":"url(#clip0_1426_8619)",children:(0,i.jsx)("path",{d:"M15.5572 3.06188L12.9356 0.440625C12.6544 0.159375 12.2731 0 11.8766 0H5.49969C4.67188 0.003125 4 0.675 4 1.50281V8.25219H0.375C0.167812 8.25219 0 8.42 0 8.62719V9.37719C0 9.58438 0.167812 9.75219 0.375 9.75219H9V11.2797C9 11.6144 9.40531 11.7812 9.64125 11.5437L11.8841 9.28406C12.0388 9.12813 12.0388 8.87656 11.8841 8.72062L9.64125 6.46094C9.40531 6.22344 9 6.39031 9 6.725V8.2525H5.49969V1.50281H10.4987V4.75219C10.4987 5.16781 10.8331 5.50187 11.2487 5.50187H14.5V14.5003H5.49969V11.2522H4V14.5003C4 15.3281 4.67188 16 5.49969 16H14.4978C15.3259 16 16 15.3281 16 14.5003V4.12406C16 3.7275 15.8384 3.34313 15.5572 3.06188ZM11.9984 4.00219V1.62469L14.3763 4.00219H11.9984Z",fill:"black"})}),(0,i.jsx)("defs",{children:(0,i.jsx)("clipPath",{id:"clip0_1426_8619",children:(0,i.jsx)("rect",{width:"16",height:"16",fill:"white"})})})]}),ln=e=>(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,i.jsx)("path",{d:"M14.5607 4.06066L11.9393 1.43934C11.658 1.15804 11.2765 1 10.8787 1H2.5C1.67156 1 1 1.67156 1 2.5V13.5C1 14.3284 1.67156 15 2.5 15H13.5C14.3284 15 15 14.3284 15 13.5V5.12131C15 4.72349 14.842 4.34196 14.5607 4.06066ZM9.5 2.5V5H5.5V2.5H9.5ZM13.3125 13.5H2.6875C2.63777 13.5 2.59008 13.4802 2.55492 13.4451C2.51975 13.4099 2.5 13.3622 2.5 13.3125V2.6875C2.5 2.63777 2.51975 2.59008 2.55492 2.55492C2.59008 2.51975 2.63777 2.5 2.6875 2.5H4V5.75C4 6.16422 4.33578 6.5 4.75 6.5H10.25C10.6642 6.5 11 6.16422 11 5.75V2.62131L13.4451 5.06641C13.4625 5.08382 13.4763 5.10449 13.4857 5.12724C13.4952 5.14999 13.5 5.17438 13.5 5.199V13.3125C13.5 13.3622 13.4802 13.4099 13.4451 13.4451C13.4099 13.4802 13.3622 13.5 13.3125 13.5ZM8 7.25C6.48366 7.25 5.25 8.48366 5.25 10C5.25 11.5163 6.48366 12.75 8 12.75C9.51634 12.75 10.75 11.5163 10.75 10C10.75 8.48366 9.51634 7.25 8 7.25ZM8 11.25C7.31075 11.25 6.75 10.6892 6.75 10C6.75 9.31075 7.31075 8.75 8 8.75C8.68925 8.75 9.25 9.31075 9.25 10C9.25 10.6892 8.68925 11.25 8 11.25Z",fill:"currentColor"})}),lt=e=>(0,i.jsx)("svg",{width:"17",height:"16",viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,i.jsx)("path",{d:"M15.9143 1.75812L14.7422 0.585938C14.3515 0.195312 13.8397 0 13.3278 0C12.8159 0 12.304 0.195312 11.9137 0.585625L9.58593 2.91344L8.5 3.99938L0.901592 11.5975L0.504719 15.1669C0.454719 15.6163 0.80878 16 1.24847 16C1.27628 16 1.3044 15.9984 1.33253 15.9953L4.89939 15.6012L12.5006 8L13.5862 6.91437L15.914 4.58656C16.6953 3.80531 16.6953 2.53906 15.9143 1.75812ZM4.21095 14.1684L2.09909 14.4016L2.3344 12.2863L9.56062 5.06L10.53 4.09062L12.4094 5.97L11.44 6.93937L4.21095 14.1684ZM14.8534 3.52562L13.4697 4.90938L11.5906 3.03L12.9744 1.64625C13.1019 1.51875 13.2506 1.49969 13.3278 1.49969C13.405 1.49969 13.554 1.51875 13.6812 1.64625L14.8534 2.81844C15.0484 3.01375 15.0484 3.33094 14.8534 3.52562Z",fill:"currentColor"})}),li=e=>(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,i.jsx)("path",{d:"M7.26326 6.5462H8.71794V12.3642H7.26326V6.5462ZM7.9906 3.1102C7.43278 3.1102 6.97888 3.5641 6.97888 4.12192C6.97888 4.67974 7.43278 5.13364 7.9906 5.13364C8.54842 5.13364 9.00232 4.67974 9.00232 4.12192C9.00232 3.5641 8.54842 3.1102 7.9906 3.1102ZM16 8C16 12.411 12.411 16 8 16C3.589 16 0 12.411 0 8C0 3.589 3.589 0 8 0C12.411 0 16 3.589 16 8ZM14.5453 8C14.5453 4.3906 11.6093 1.4546 7.99992 1.4546C4.39052 1.4546 1.45452 4.3914 1.45452 8.0006C1.45452 11.6098 4.39052 14.546 7.99992 14.546C11.6093 14.546 14.5453 11.6092 14.5453 8.0006V8Z",fill:"currentColor"})});function ll(e){let n=(0,i9.D)(e);return(0,iR.WU)(n,"yyyy-MM-dd'T'HH:mm:ss")}function lr(e){return Object.values(e).every(e=>null===e)?[(0,i.jsx)(s.k,{ml:"10px",children:"No information"},"no info")]:Object.entries(e).filter(e=>{let[n,t]=e;return"url"!==n&&null!=t}).map(e=>{let[n,t]=e;return(0,i.jsxs)(tA.HC,{ml:"10px",children:[n,": ",t]},n)})}function lo(){var e,n,t,l,a,c;let{envInfo:u,reviewMode:h,lineageGraph:x}=eO(),{isOpen:m,onOpen:p,onClose:f}=(0,en.q)(),g=null==u?void 0:u.git,v=null==u?void 0:u.pullRequest,j={...g,...v},y=null==u?void 0:null===(e=u.dbt)||void 0===e?void 0:e.base,b=null==u?void 0:null===(n=u.dbt)||void 0===n?void 0:n.current,w=(null==y?void 0:y.generated_at)?ll(null==y?void 0:y.generated_at):"",k=(null==b?void 0:b.generated_at)?ll(null==b?void 0:b.generated_at):"",C=new Set,_=new Set;if(null==x?void 0:x.nodes)for(let e of Object.values(null==x?void 0:x.nodes))(null===(a=e.data.base)||void 0===a?void 0:a.schema)&&C.add(e.data.base.schema),(null===(c=e.data.current)||void 0===c?void 0:c.schema)&&_.add(e.data.current.schema);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nI.u,{label:"Environment Info",placement:"bottom-end",children:(0,i.jsx)(nK.h,{size:"sm",variant:"unstyled","aria-label":"Export state",onClick:p,icon:(0,i.jsx)(o.J,{verticalAlign:"middle",as:li,boxSize:"16px"})})}),(0,i.jsxs)(et.u_,{isOpen:m,onClose:f,size:"3xl",children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{children:[(0,i.jsx)(er.x,{children:"Environment Information"}),(0,i.jsx)(eM.o,{}),(0,i.jsx)(eo.f,{children:(0,i.jsxs)(s.k,{direction:"column",gap:"5px",children:[h?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(s.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(d.X,{size:"sm",children:"Review Information"}),(0,i.jsxs)(tA.QI,{spacing:1,children:[(null==j?void 0:j.url)&&(0,i.jsxs)(tA.HC,{ml:"10px",children:["url:"," ",(0,i.jsx)(r.r,{href:j.url,color:"blue.500",isExternal:!0,children:j.url})]}),j&&lr(j)]})]})}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(s.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(d.X,{size:"sm",children:"Dev Information"}),(0,i.jsx)(tA.QI,{spacing:1,children:g&&lr(g)})]})}),(0,i.jsx)(nT.i,{}),(null==u?void 0:u.adapterType)==="dbt"&&(0,i.jsxs)(s.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(d.X,{size:"sm",children:"DBT"}),(0,i.jsx)(i0.x,{children:(0,i.jsxs)(i1.i,{variant:"simple",children:[(0,i.jsx)(i5.h,{children:(0,i.jsxs)(i2.Tr,{children:[(0,i.jsx)(i4.Th,{}),(0,i.jsx)(i4.Th,{children:"base"}),(0,i.jsx)(i4.Th,{children:"current"})]})}),(0,i.jsxs)(i6.p,{children:[(0,i.jsxs)(i2.Tr,{children:[(0,i.jsx)(i3.Td,{children:"schema"}),(0,i.jsx)(i3.Td,{children:JSON.stringify(Array.from(C))}),(0,i.jsx)(i3.Td,{children:JSON.stringify(Array.from(_))})]}),(0,i.jsxs)(i2.Tr,{children:[(0,i.jsx)(i3.Td,{children:"version"}),(0,i.jsx)(i3.Td,{children:null==y?void 0:y.dbt_version}),(0,i.jsx)(i3.Td,{children:null==b?void 0:b.dbt_version})]}),(0,i.jsxs)(i2.Tr,{children:[(0,i.jsx)(i3.Td,{children:"timestamp"}),(0,i.jsx)(i3.Td,{children:w}),(0,i.jsx)(i3.Td,{children:k})]})]})]})})]}),(null==u?void 0:u.adapterType)==="sqlmesh"&&(0,i.jsxs)(s.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(d.X,{size:"sm",children:"SQLMesh"}),(0,i.jsx)(i0.x,{children:(0,i.jsxs)(i1.i,{variant:"simple",children:[(0,i.jsx)(i5.h,{children:(0,i.jsxs)(i2.Tr,{children:[(0,i.jsx)(i4.Th,{}),(0,i.jsx)(i4.Th,{children:"base"}),(0,i.jsx)(i4.Th,{children:"current"})]})}),(0,i.jsx)(i6.p,{children:(0,i.jsxs)(i2.Tr,{children:[(0,i.jsx)(i3.Td,{children:"Environment"}),(0,i.jsx)(i3.Td,{children:null==u?void 0:null===(t=u.sqlmesh)||void 0===t?void 0:t.base_env}),(0,i.jsx)(i3.Td,{children:null==u?void 0:null===(l=u.sqlmesh)||void 0===l?void 0:l.current_env})]})})]})})]})]})}),(0,i.jsx)(ea.m,{children:(0,i.jsx)(ed.z,{colorScheme:"blue",mr:3,onClick:f,children:"Close"})})]})]})]})}function ls(e){let{current:n,primaryKeys:t,setPrimaryKeys:r,onRunResultOpen:a,runQuery:c,isPending:u}=e;return(0,i.jsxs)(s.k,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,i.jsxs)(l.x,{children:[(0,i.jsxs)(d.X,{as:"h2",size:"md",display:"flex",alignItems:"center",gap:"5px",children:[(0,i.jsx)(o.J,{as:iN.vc4,boxSize:"1.2em"}),"Sandbox"]}),(0,i.jsxs)(es.x,{fontSize:"xs",color:"gray.500",children:["Compare the run results based on the modified SQL code of model"," ",(0,i.jsx)("b",{children:null==n?void 0:n.name})]})]}),(0,i.jsx)(h.L,{}),(0,i.jsx)(iZ,{defaultPrimaryKeys:t,onPrimaryKeysChange:r}),(0,i.jsx)(nI.u,{label:"Run diff to see the changes",children:(0,i.jsx)(ed.z,{size:"xs",marginTop:"16px",fontSize:"14px",onClick:()=>{a(),c()},colorScheme:"blue",isLoading:u,children:"Run Diff"})})]})}function la(e){var n,t,l;let{currentModelID:r,height:o="32px",flex:a="0 0 auto"}=e,{lineageGraph:d,envInfo:c}=eO(),u="0 16px",h=ll((null==c?void 0:null===(t=c.dbt)||void 0===t?void 0:null===(n=t.current)||void 0===n?void 0:n.generated_at)||""),x=(0,t6.Q)(h,{addSuffix:!0}),m="N/A";if((null==d?void 0:d.nodes)&&(null==d?void 0:d.nodes[r])){let e=null==d?void 0:d.nodes[r];(null===(l=e.data.current)||void 0===l?void 0:l.schema)&&(m=e.data.current.schema)}return(0,i.jsxs)(s.k,{gap:0,height:o,flex:a,fontSize:"14px",align:"center",margin:"0",backgroundColor:"#EDF2F880",children:[(0,i.jsx)(tY.K,{width:"50%",children:(0,i.jsxs)(es.x,{as:"b",margin:u,children:["ORIGINAL (Schema: ",m,", Last Updated: ",x,")"]})}),(0,i.jsx)(tY.K,{width:"50%",children:(0,i.jsx)(es.x,{as:"b",margin:u,children:"SANDBOX EDITOR"})})]})}function ld(e){let{isOpen:n,onClose:t,current:o}=e,{isOpen:h,onClose:x,onOpen:m}=(0,en.q)(),[p,f]=(0,j.useState)((null==o?void 0:o.raw_code)||""),{showRunId:g,clearRunResult:v}=n4(),{primaryKeys:y,setPrimaryKeys:b}=_(),{data:w,isLoading:k}=eT(),C=async()=>{let e={current_model:(null==o?void 0:o.name)||"",primary_keys:y,sql_template:p},{run_id:n}=await iV(e,{nowait:!0});return g(n),await ew(n)},{mutate:S,isPending:z}=(0,tw.D)({mutationFn:C,onSuccess(e,n){e.error?ef({action:"run",node:null==o?void 0:o.name,status:"failure"}):(ef({action:"run",node:null==o?void 0:o.name,status:"success"}),setTimeout(()=>R(),1e3),!k&&(null==w?void 0:w.single_env_onboarding)&&setTimeout(()=>I(),2e3))}}),{feedbackToast:R,closeToast:E}=function(e){let n=(0,ee.p)(),{feedbackId:t,description:l,onFeedbackSubmit:r,externalLink:o,externalLinkText:s}=e;return{feedbackToast:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=localStorage.getItem(t);n.isActive(t)||"true"===a&&!1===e||n({id:t,position:"bottom-right",duration:null,render:e=>{let{id:n,onClose:a}=e;return(0,i.jsx)(tz.b,{status:"success",variant:"subtle",zIndex:"toast",borderColor:"gray.200",borderWidth:3,borderRadius:"md",backgroundColor:"white",opacity:1,children:(0,i.jsx)(iX.X,{fontSize:"md",children:(0,i.jsxs)(u.U,{children:[(0,i.jsx)(iG,{description:l,onLike:()=>{r("like"),a(),localStorage.setItem(t,"true")},onDislike:()=>{r("dislike"),a(),localStorage.setItem(t,"true")},externalLink:o,externalLinkText:s,onClickLink:()=>{r("link")}}),(0,i.jsx)(ig.P,{onClick:()=>{a()}})]})})})}})},closeToast:()=>n.closeAll()}}({feedbackId:i$.previewChangeFeedbackID,description:"Enjoy preview change?",onFeedbackSubmit:e=>{switch(e){case"like":eg({feedback:"like",node:null==o?void 0:o.name});break;case"dislike":eg({feedback:"dislike",node:null==o?void 0:o.name});break;case"link":eg({feedback:"form",node:null==o?void 0:o.name});break;default:console.log("Not support feedback type")}},externalLink:"https://docs.google.com/forms/d/e/1FAIpQLSd7Lei7Ijwo7MinWaI0K6rzZi_21gV1BKetmiNEX254kDziDA/viewform?usp=header",externalLinkText:"Give us feedback"}),{guideToast:I,closeGuideToast:T}=function(e){let n=(0,ee.p)(),{guideId:t,description:l,externalLink:o,externalLinkText:s,onExternalLinkClick:a}=e;return{guideToast:function(){n.isActive(t)||n({id:t,position:"bottom-right",duration:3e3,description:"some text",render:e=>{let{id:n,onClose:t}=e;return(0,i.jsx)(tz.b,{status:"success",variant:"subtle",zIndex:"toast",borderColor:"gray.200",borderWidth:3,borderRadius:"md",backgroundColor:"white",opacity:1,children:(0,i.jsx)(iX.X,{fontSize:"md",children:(0,i.jsxs)(u.U,{children:[(0,i.jsxs)(es.x,{children:[l," ",(0,i.jsx)(r.r,{textDecor:"underline",isExternal:!0,href:o,onClick:()=>{a&&a(),t()},children:s})]}),(0,i.jsx)(ig.P,{onClick:()=>{t()}})]})})})}})},closeGuideToast:()=>n.closeAll()}}({guideId:i$.prepareEnvGuideID,description:"Want to compare data changes with production data?",externalLink:"https://datarecce.io/docs/get-started/#prepare-dbt-artifacts",externalLinkText:"Learn how.",onExternalLinkClick:()=>ev({action:"external_link",from:"preview_changes",node:null==o?void 0:o.name})});return(0,j.useEffect)(()=>{n&&f((null==o?void 0:o.raw_code)||"")},[n,o]),(0,i.jsx)(et.u_,{isOpen:n,size:"full",onClose:()=>{t(),x(),v(),E(),T(),ef({action:"close",node:null==o?void 0:o.name})},children:(0,i.jsxs)(el.h,{height:"100%",children:[(0,i.jsx)(er.x,{height:"40px",bg:"rgb(77, 209, 176)",px:0,py:4,children:(0,i.jsxs)(s.k,{alignItems:"center",height:"100%",gap:"10px",children:[(0,i.jsx)(a.E,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,i.jsx)(d.X,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,i.jsx)(c.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:"Experiment"})]})}),(0,i.jsx)(eM.o,{}),(0,i.jsx)(eo.f,{p:0,children:(0,i.jsxs)(tO,{sizes:h?[50,50]:[100,0],minSize:h?100:0,gutterSize:h?5:0,style:{flex:"1",contain:"size",height:"100%"},children:[(0,i.jsxs)(s.k,{direction:"column",height:"100%",m:0,p:0,children:[(0,i.jsx)(ls,{current:o,primaryKeys:null!=y?y:[],setPrimaryKeys:b,onRunResultOpen:m,runQuery:S,isPending:z}),(0,i.jsx)(la,{height:"32pxs",flex:"0 0 auto",currentModelID:(null==o?void 0:o.id)||""}),(0,i.jsx)(ij,{current:o,onChange:f})]}),h?(0,i.jsx)(iF,{onClose:x,disableAddToChecklist:!0}):(0,i.jsx)(l.x,{})]})}),(0,i.jsx)(l.x,{position:"fixed",bottom:"4",right:"4",opacity:.5,children:(0,i.jsx)(nI.u,{label:"Give us feedback",children:(0,i.jsx)(nK.h,{"aria-label":"feedback",icon:(0,i.jsx)(nr.xJq,{}),variant:"ghost",size:"md",onClick:()=>{R(!0)}})})})]})})}var lc=t(29901);function lu(e){let{node:n,onCloseNode:t}=e,[,r]=(0,eN.TH)(),{setSqlQuery:a,setPrimaryKeys:c}=_(),f="model"===n.resourceType||"seed"===n.resourceType||"source"===n.resourceType||"snapshot"===n.resourceType,{isOpen:g,onOpen:v,onClose:y}=(0,en.q)(),{isOpen:b,onOpen:w,onClose:k}=(0,en.q)(),{isOpen:C,onOpen:S,onClose:z}=(0,en.q)(),{runAction:R}=n4(),{envInfo:E,isActionAvailable:I}=eO(),{primaryKey:T}=eJ(n.name),L=()=>{R("row_count_diff",{node_names:[n.name]},{showForm:!1,showLast:!1})},{data:D}=eT(),O=null==D?void 0:D.single_env_onboarding,A=(0,j.useCallback)(async()=>{let e=n.id,t=await iy({node_id:e});r("/checks/".concat(t.check_id))},[n,r]),M=(e,n)=>e?ib.add_or_remove:I(n)?"":"value_diff"===n?ib.audit_helper:"profile_diff"===n?ib.dbt_profiler:"This action is not supported yet.",F="added"===n.changeStatus||"removed"===n.changeStatus;return(0,i.jsxs)(ip.r,{height:"100%",templateRows:"auto auto 1fr",children:[(0,i.jsxs)(u.U,{children:[(0,i.jsx)(l.x,{flex:"0 1 20%",p:"16px",children:(0,i.jsx)(d.X,{size:"sm",children:n.name})}),(0,i.jsx)(h.L,{}),O?(0,i.jsx)(function(){return(0,i.jsx)(ed.z,{as:ed.z,size:"xs",colorScheme:"blue",onClick:()=>{w()},disabled:"base"===n.from,children:"Query"})},{}):(0,i.jsx)(function(){var e,t,l,s,d,u,h,x;return"model"!==n.resourceType&&"seed"!==n.resourceType&&"snapshot"!==n.resourceType?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(nP.v,{children:[(0,i.jsx)(nW.j,{as:ed.z,size:"xs",variant:"outline",rightIcon:(0,i.jsx)(lc.v,{}),children:"Explore"}),(0,i.jsxs)(nJ.q,{children:[(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(o.J,{as:null===(e=n0("query_diff"))||void 0===e?void 0:e.icon}),fontSize:"14px",onClick:()=>{(null==E?void 0:E.adapterType)==="dbt"?a('select * from {{ ref("'.concat(n.name,'") }}')):(null==E?void 0:E.adapterType)==="sqlmesh"&&a("select * from ".concat(n.name)),I("query_diff_with_primary_key")&&c(void 0!==T?[T]:void 0),r("/query")},children:"Query"}),(0,i.jsx)(nQ.s,{fontSize:"14px",icon:(0,i.jsx)(o.J,{as:null===(t=n0("sandbox"))||void 0===t?void 0:t.icon}),onClick:()=>{I("query_diff_with_primary_key")&&c(void 0!==T?[T]:void 0),S(),ef({action:"explore",node:n.name})},children:"Sandbox (Experiment)"}),(0,i.jsx)(ta.R,{}),(0,i.jsxs)(nU.k,{title:"Diff",m:"0",p:"4px 12px",children:[("model"===n.resourceType||"snapshot"===n.resourceType)&&(0,i.jsx)(nQ.s,{onClick:v,icon:(0,i.jsx)(tM.tvD,{}),fontSize:"14px",children:"Code Diff"}),(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(o.J,{as:null===(l=n0("row_count_diff"))||void 0===l?void 0:l.icon}),fontSize:"14px",onClick:()=>L(),children:"Row Count Diff"}),(0,i.jsx)(nI.u,{label:M(F,"profile_diff"),placement:"left",children:(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(o.J,{as:null===(s=n0("profile_diff"))||void 0===s?void 0:s.icon}),fontSize:"14px",isDisabled:F||!I("profile_diff"),onClick:()=>{R("profile_diff",{model:n.name},{showForm:!1,showLast:!1})},children:"Profile Diff"})}),(0,i.jsx)(nI.u,{label:M(F,"value_diff"),placement:"left",children:(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(o.J,{as:null===(d=n0("value_diff"))||void 0===d?void 0:d.icon}),fontSize:"14px",isDisabled:F||!I("value_diff"),onClick:()=>{R("value_diff",{model:n.name},{showForm:!0,showLast:!1})},children:"Value Diff"})}),(0,i.jsx)(nI.u,{label:M(F,"top_k_diff"),placement:"left",children:(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(o.J,{as:null===(u=n0("top_k_diff"))||void 0===u?void 0:u.icon}),fontSize:"14px",isDisabled:F,onClick:()=>{R("top_k_diff",{model:n.name,column_name:"",k:50},{showForm:!0})},children:"Top-K Diff"})}),(0,i.jsx)(nI.u,{label:M(F,"histogram_diff"),placement:"left",children:(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(o.J,{as:null===(h=n0("histogram_diff"))||void 0===h?void 0:h.icon}),fontSize:"14px",isDisabled:F,onClick:()=>{R("histogram_diff",{model:n.name,column_name:"",column_type:""},{showForm:!0})},children:"Histogram Diff"})})]}),(0,i.jsx)(ta.R,{}),(0,i.jsx)(nU.k,{title:"Add to Checklist",m:"0",p:"4px 12px",children:(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(o.J,{as:null===(x=n0("schema_diff"))||void 0===x?void 0:x.icon}),fontSize:"14px",onClick:A,children:"Schema Diff"})})]})]})},{}),(0,i.jsx)(l.x,{flex:"0 1 1%",children:(0,i.jsx)(ig.P,{onClick:t})})]}),(0,i.jsx)(l.x,{color:"gray",paddingLeft:"16px",children:(0,i.jsxs)(u.U,{spacing:"8px",children:[(0,i.jsx)(io,{node:n}),("model"===n.resourceType||"snapshot"===n.resourceType||"seed"===n.resourceType)&&(O?(0,i.jsx)(id,{node:n,onRefresh:()=>{R("row_count",{node_names:[n.name]},{showForm:!1,showLast:!1})}}):(0,i.jsx)(ia,{node:n,onRefresh:L}))]})}),f&&(0,i.jsxs)(x.m,{overflow:"auto",as:s.k,children:[(0,i.jsx)(m.t,{children:(0,i.jsx)(p.O,{children:"Columns"})}),(0,i.jsx)(td.n,{overflow:"auto",height:"calc(100% - 42px)",children:(0,i.jsx)(tc.x,{p:0,overflowY:"auto",height:"100%",children:O?(0,i.jsx)(tI,{current:n.data.current}):(0,i.jsx)(tE,{base:n.data.base,current:n.data.current})})})]}),(0,i.jsxs)(et.u_,{isOpen:g,onClose:y,size:"6xl",children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{overflowY:"auto",height:"75%",children:[(0,i.jsx)(er.x,{children:"Model Raw Code Diff"}),(0,i.jsx)(eM.o,{}),(0,i.jsx)(eo.f,{children:(0,i.jsx)(iv,{base:n.data.base,current:n.data.current})})]})]}),(0,i.jsx)(iK,{isOpen:b,onClose:k,current:n.data.current}),(0,i.jsx)(ld,{isOpen:C,onClose:z,current:n.data.current})]})}function lh(e){var n,t;let{onClose:r}=e,{cancel:o,actionState:s}=tC();return(0,i.jsx)(l.x,{bg:"white",rounded:"md",shadow:"dark-lg",children:(0,i.jsxs)(u.U,{p:"5px 15px",mt:"4",divider:(0,i.jsx)(t9.c,{borderColor:"gray.200"}),spacing:4,children:[(0,i.jsxs)(l.x,{fontSize:"10pt",children:["Progress: ","per_node"===s.mode?"".concat(s.completed," / ").concat(s.total):(null===(t=s.currentRun)||void 0===t?void 0:null===(n=t.progress)||void 0===n?void 0:n.percentage)?"".concat(100*s.currentRun.progress.percentage,"%"):"completed"===s.status?"100%":"0%"," ","canceled"===s.status?" (canceled)":""]}),"running"===s.status||"canceling"===s.status?(0,i.jsx)(ed.z,{size:"xs",variant:"outline",onClick:o,isLoading:"canceling"===s.status,loadingText:"Canceling",children:"Cancel"}):(0,i.jsx)(u.U,{children:(0,i.jsx)(ed.z,{size:"xs",variant:"outline",onClick:r,children:"Close"})})]})})}var lx=t(63988),lm=t(12767);let lp=()=>(0,i.jsxs)(ng.g,{align:"start",spacing:0,children:[(0,i.jsx)(es.x,{fontSize:"10pt",color:"gray.500",pb:1,children:"Select nodes by dbt node selector syntax"}),(0,i.jsxs)(es.x,{fontSize:"8pt",children:[(0,i.jsx)(lx.E,{fontSize:"8pt",children:"model_name"})," Select a node"]}),(0,i.jsxs)(es.x,{fontSize:"8pt",children:[(0,i.jsx)(lx.E,{fontSize:"8pt",children:"model_name+"})," Select downstream nodes"]}),(0,i.jsxs)(es.x,{fontSize:"8pt",children:[(0,i.jsx)(lx.E,{fontSize:"8pt",children:"+model_name"})," Select upstream nodes"]}),(0,i.jsxs)(es.x,{fontSize:"8pt",children:[(0,i.jsx)(lx.E,{fontSize:"8pt",children:"model*"})," Select by wildcard"]})]}),lf=()=>{let{isHistoryOpen:e,showHistory:n,closeHistory:t}=n4();return(0,i.jsx)(ed.z,{leftIcon:(0,i.jsx)(o.J,{as:nr.M1Q}),size:"xs",variant:"outline",onClick:()=>{e?(ep({name:"hide"}),t()):(ep({name:"show"}),n())},children:e?"Hide":"Show"})},lg=e=>{let{isDisabled:n}=e,{viewOptions:t,onViewOptionsChanged:l,selectMode:r}=tC(),s=t.view_mode||"changed_models",a=e=>{l({...t,view_mode:e})};return(0,i.jsxs)(nP.v,{children:[(0,i.jsx)(nW.j,{as:ed.z,minWidth:"100px",leftIcon:(0,i.jsx)(o.J,{as:tP("model").icon}),size:"xs",variant:"outline",isDisabled:n,rightIcon:(0,i.jsx)(lc.v,{}),children:"changed_models"===s?"Changed Models":"All"}),(0,i.jsxs)(nJ.q,{title:"packages",children:[(0,i.jsx)(nQ.s,{as:nv.X,size:"sm",isChecked:"changed_models"===s,onChange:()=>a("changed_models"),children:"Changed Models"}),(0,i.jsx)(nQ.s,{as:nv.X,size:"sm",isChecked:"all"===s,onChange:()=>a("all"),children:"All"})]})]})},lv=e=>{var n,t;let{isDisabled:l}=e,{lineageGraph:r}=eO(),{viewOptions:s,onViewOptionsChanged:a}=tC(),d=new Set;for(let e of Object.values((null==r?void 0:r.nodes)||{}))e.packageName&&d.add(e.packageName);let c=null==r?void 0:null===(t=r.manifestMetadata)||void 0===t?void 0:null===(n=t.current)||void 0===n?void 0:n.project_name,u=s.packages?new Set(s.packages):c?new Set([c]):d,h=u.size===d.size,x=0===u.size,m=1===u.size?Array.from(u)[0]:h?"All Packages":x?"No Package":"".concat(u.size," Packages"),p=e=>{let n=new Set(u);n.has(e)?n.delete(e):n.add(e),a({...s,packages:Array.from(n)})};return(0,i.jsxs)(nP.v,{closeOnSelect:!1,children:[(0,i.jsx)(nW.j,{as:ed.z,minWidth:"100px",leftIcon:(0,i.jsx)(o.J,{as:il.zFh}),size:"xs",variant:"outline",isDisabled:l,rightIcon:(0,i.jsx)(lc.v,{}),children:m}),(0,i.jsx)(nJ.q,{title:"packages",children:(0,i.jsxs)(nU.k,{title:"Select Packages",children:[(0,i.jsx)(nQ.s,{as:nv.X,size:"sm",isIndeterminate:!h&&!x,isChecked:h,onChange:()=>{h?a({...s,packages:[]}):a({...s,packages:Array.from(d)})},children:"Select All"}),(0,i.jsx)(ta.R,{}),Array.from(d).map(e=>(0,i.jsx)(nQ.s,{as:nv.X,size:"sm",isChecked:u.has(e),onChange:()=>{p(e)},children:e},e))]})})]})},lj=e=>{let[n,t]=(0,j.useState)(e.value),{data:l}=eT(),r=(0,j.useRef)(null);return(0,j.useEffect)(()=>{r.current&&(r.current.value=e.value)},[e.value]),(0,i.jsx)(nI.u,{width:"300px",padding:2,shadow:"md",borderWidth:1,rounded:"md",styleConfig:{zIndex:"dropdown"},label:e.tooltipComponent,placement:"bottom-start",defaultIsOpen:!0,color:"black",backgroundColor:"white",closeOnClick:!1,isDisabled:!(null==l?void 0:l.single_env_onboarding),children:(0,i.jsx)(nq.I,{ref:r,height:"24px",fontSize:"10pt",placeholder:"with selectors",isDisabled:e.isDisabled,value:n,onChange:e=>{t(e.target.value)},onKeyUp:i=>{"Enter"===i.key?e.onChange(n):"Escape"===i.key&&(i.preventDefault(),t(e.value),r.current&&r.current.blur())},onBlur:()=>t(e.value)})})},ly=e=>{let{isDisabled:n}=e,{viewOptions:t,onViewOptionsChanged:l}=tC();return(0,i.jsx)(lj,{isDisabled:n,value:t.select||"",onChange:e=>{l({...t,select:e||void 0})},tooltipComponent:(0,i.jsx)(lp,{})})},lb=e=>{let{isDisabled:n}=e,{viewOptions:t,onViewOptionsChanged:l}=tC();return(0,i.jsx)(lj,{isDisabled:n,value:t.exclude||"",onChange:e=>{l({...t,exclude:e||void 0})}})},lw=e=>(0,i.jsxs)(l.x,{style:e.style,maxWidth:"300px",children:[(0,i.jsx)(l.x,{fontSize:"8pt",children:(null==e?void 0:e.label)||(0,i.jsx)(i.Fragment,{children:"\xa0"})}),e.children]}),lk=()=>{var e,n,t,l,r;let{nodes:s,deselect:a,selectMode:d,...c}=tC(),{isActionAvailable:x}=eO(),m=(0,j.useMemo)(()=>s.filter(e=>e.data.isSelected),[s]),{data:p}=eT(),f=null==p?void 0:p.single_env_onboarding,g="single"===d&&1===m.length,v="multi"===d&&m.length>=1,y="single"===d&&0===m.length,b="single"!==d;return(0,i.jsx)(u.U,{width:"100%",padding:"4pt 8pt",children:(0,i.jsxs)(u.U,{flex:"1",children:[(0,i.jsx)(lw,{label:"History",style:{flexShrink:"1"},children:(0,i.jsx)(lf,{})}),(0,i.jsx)(lw,{label:"Mode",style:{flexShrink:"1"},children:(0,i.jsx)(lg,{isDisabled:b})}),(0,i.jsx)(lw,{label:"Package",style:{flexShrink:"1"},children:(0,i.jsx)(lv,{isDisabled:b})}),(0,i.jsx)(lw,{label:"Select",style:{flex:"100 1 auto"},children:(0,i.jsx)(ly,{isDisabled:b})}),(0,i.jsx)(lw,{label:"Exclude",style:{flex:"100 1 auto"},children:(0,i.jsx)(lb,{isDisabled:b})}),(0,i.jsx)(h.L,{}),"multi"===d&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(lw,{label:"",style:{flexShrink:"0"},children:(0,i.jsx)(es.x,{fontSize:"9pt",color:"gray.500",children:m.length>1?"".concat(m.length," nodes selected"):"".concat(m.length," node selected")})}),(0,i.jsx)(lw,{label:"",children:(0,i.jsx)(ed.z,{variant:"outline",size:"xs",fontSize:"9pt",isDisabled:"multi"!==d,onClick:()=>{a()},children:"Deselect"})}),f&&(0,i.jsx)(lw,{label:"Explore",children:(0,i.jsx)(lm.h,{isAttached:!0,variant:"outline",children:(0,i.jsxs)(nP.v,{placement:"bottom-end",children:[(0,i.jsx)(nW.j,{as:ed.z,size:"xs",rightIcon:(0,i.jsx)(lc.v,{}),children:"Actions"}),(0,i.jsx)(nJ.q,{children:(0,i.jsx)(nQ.s,{as:es.x,size:"sm",fontSize:"10pt",isDisabled:!(y||g||v),icon:(0,i.jsx)(o.J,{as:null===(e=n0("row_count_diff"))||void 0===e?void 0:e.icon}),onClick:()=>{c.runRowCount()},children:"Row Count"})})]})})})]}),!f&&(0,i.jsx)(lw,{label:"Explore",children:(0,i.jsx)(lm.h,{isAttached:!0,variant:"outline",children:(0,i.jsxs)(nP.v,{placement:"bottom-end",children:[(0,i.jsx)(nW.j,{as:ed.z,size:"xs",rightIcon:(0,i.jsx)(lc.v,{}),children:"Actions"}),(0,i.jsxs)(nJ.q,{children:[(0,i.jsxs)(nU.k,{title:"Diff",m:"0",p:"4px 12px",children:[(0,i.jsx)(nQ.s,{as:es.x,size:"sm",fontSize:"10pt",isDisabled:!(y||g||v),icon:(0,i.jsx)(o.J,{as:null===(n=n0("row_count_diff"))||void 0===n?void 0:n.icon}),onClick:()=>{c.runRowCountDiff()},children:"Row Count Diff"}),(0,i.jsx)(nI.u,{label:x("value_diff")?null:ib.audit_helper,placement:"left",children:(0,i.jsx)(nQ.s,{as:es.x,size:"sm",fontSize:"10pt",isDisabled:!(y||g||v)||!x("value_diff"),icon:(0,i.jsx)(o.J,{as:null===(t=n0("value_diff"))||void 0===t?void 0:t.icon}),onClick:()=>{c.runValueDiff()},children:"Value Diff"})})]}),(0,i.jsx)(ta.R,{}),(0,i.jsxs)(nU.k,{title:"Add to Checklist",m:"0",px:"12px",children:[(0,i.jsx)(nQ.s,{as:es.x,size:"sm",fontSize:"10pt",isDisabled:!(y||v&&m.length>1),icon:(0,i.jsx)(o.J,{as:null===(l=n0("lineage_diff"))||void 0===l?void 0:l.icon}),onClick:()=>{c.addLineageDiffCheck(c.viewOptions.view_mode)},children:"Lineage Diff"}),(0,i.jsx)(nQ.s,{as:es.x,size:"sm",fontSize:"10pt",isDisabled:!(y||g||v),icon:(0,i.jsx)(o.J,{as:null===(r=n0("schema_diff"))||void 0===r?void 0:r.icon}),onClick:()=>{c.addSchemaDiffCheck()},children:"Schema Diff"})]})]})]})})})]})})};async function lC(e){return(await X.post("/api/checks",{type:"lineage_diff",params:{},view_options:e})).data}function l_(){return(0,i.jsx)(l.x,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[n,[t,l]]=e,{icon:r,color:a}=tV(n);return(0,i.jsx)(nI.u,{label:l,children:(0,i.jsxs)(s.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,i.jsx)(o.J,{color:a,as:r})," ",t]})},n)})})}var lS=t(88500);let lz={mode:"per_node",status:"pending",completed:0,total:0},lR=(e,n)=>{let{onActionStarted:t,onActionNodeUpdated:i,onActionCompleted:l}=n,r=(0,j.useRef)({...lz}).current,{showRunId:o}=n4(),s=async(n,s,a)=>{let d="multi_nodes";r.mode=d,t(),r.status="running";let c=[];for(let n of e){let e=s(n);n.isActionMode=!0,e?(n.action={mode:d,status:"skipped",skipReason:e},i(n)):(n.action={mode:d,status:"pending"},c.push(n))}let u=a(c);try{let{run_id:e}=await eb(n,u,{nowait:!0});for(o(e),r.currentRun={run_id:e},r.total=1;;){let n=await ew(e,2);r.currentRun=n;let t=n.error?"failure":n.result?"success":"running";for(let e of c)e.action={mode:d,status:t,run:n},i(e);if(n.error||n.result)break}}catch(e){}if(r.completed=1,"canceling"===r.status){r.status="canceled",l();return}r.status="completed",l()},a=async(n,o)=>{let s="per_node";for(let n of(r.mode=s,t(),r.status="running",e))n.action={mode:s,status:"pending"},i(n);for(let t of(r.completed=0,r.total=e.length,e)){let{params:e,skipReason:a}=o(t);if(t.isActionMode=!0,a)t.action={mode:s,status:"skipped",skipReason:a},i(t);else try{let{run_id:l}=await eb(n,e,{nowait:!0});for(r.currentRun={run_id:l},t.action={mode:s,status:"running"},i(t);;){let e=await ew(l,2);r.currentRun=e;let n=e.error?"failure":e.result?"success":"running";if(t.action={mode:s,status:n,run:e},i(t),e.error||e.result)break}}catch(e){}finally{r.currentRun=void 0}if(r.completed++,"canceling"===r.status){r.status="canceled",l();return}}r.status="completed",l()},d=async()=>{var e;r.status="canceling",(null===(e=r.currentRun)||void 0===e?void 0:e.run_id)&&await ek(r.currentRun.run_id)};return{actionState:r,runRowCount:async()=>{let n=[];for(let t of e)"model"!==t.resourceType?(t.action={mode:"multi_nodes",status:"skipped",skipReason:"Not a model"},i(t)):n.push(t.name);await s("row_count",e=>{if("model"!==e.resourceType)return"Not a model"},e=>({node_names:e.map(e=>e.name)}))},runRowCountDiff:async()=>{let n=[];for(let t of e)"model"!==t.resourceType?(t.action={mode:"multi_nodes",status:"skipped",skipReason:"Not a model"},i(t)):n.push(t.name);await s("row_count_diff",e=>{if("model"!==e.resourceType)return"Not a model"},e=>({node_names:e.map(e=>e.name)}))},runValueDiff:async()=>{a("value_diff",e=>{var n,t;let i=null===(t=e.data)||void 0===t?void 0:null===(n=t.current)||void 0===n?void 0:n.primary_key;return i?{params:{model:e.name,primary_key:i}}:{skipReason:"No primary key found. The first unique column is used as primary key."}})},addLineageDiffCheck:async()=>{let n=e.map(e=>e.id);return await lC({node_ids:n})},addSchemaDiffCheck:async()=>{let n;if(1===e.length)n=await iy({node_id:e[0].id});else{let t=e.map(e=>e.id);n=await iy({node_id:t})}return n},cancel:d,reset:()=>{Object.assign(r,lz)}}};var lE=t(42154),lI=function(){let{isOpen:e,onOpen:n,onClose:t}=(0,en.q)(),[r,o]=(0,j.useState)(0),[a,d]=(0,j.useState)(),c=(0,j.useRef)(),u=(0,j.useCallback)(e=>(o(e),new Promise(e=>{d(()=>e),n()})),[n]),h=()=>{null==a||a(!1),t()};return{confirm:u,AlertDialog:(0,i.jsx)(lE.aR,{size:"xl",isOpen:e,leastDestructiveRef:c,onClose:h,children:(0,i.jsx)(ei.Z,{children:(0,i.jsxs)(lE._T,{children:[(0,i.jsxs)(er.x,{fontSize:"lg",fontWeight:"bold",children:["Value Diff on ",r," nodes"]}),(0,i.jsx)(eo.f,{gap:"20px",as:s.k,direction:"column",children:(0,i.jsxs)(l.x,{children:["Value diff will be executed on ",r," nodes in the Lineage, which can add extra costs to your bill."]})}),(0,i.jsxs)(ea.m,{children:[(0,i.jsx)(ed.z,{ref:c,onClick:h,children:"Cancel"}),(0,i.jsx)(ed.z,{colorScheme:"blue",onClick:()=>{null==a||a(!0),t()},ml:3,children:"Execute"})]})]})})})}},lT=t(95534),lL=t(51366);let lD="recce",lO={recommendationIgnored:"".concat(lD,"-recommendation-ignored"),recommendationShowed:"".concat(lD,"-recommendation-showed"),prevRefreshTimeStamp:"".concat(lD,"-prev-refresh-timestamp")},lA=()=>{var e;let n=(0,y.a)({queryKey:B.checks(),queryFn:tn}),t=(0,j.useMemo)(()=>{if("success"===n.status&&n.data.length>0){let e=n.data.filter(e=>e.is_preset).findLast(e=>"row_count_diff"===e.type);if(e)return e}},[n]),i=(0,y.a)({queryKey:(null==t?void 0:t.check_id)?B.check(t.check_id):[],queryFn:async()=>{if(null==t?void 0:t.check_id)return tt(t.check_id)},enabled:!!(null==t?void 0:t.check_id)}),l=(0,y.a)({queryKey:(null==t?void 0:t.check_id)?[...B.check(t.check_id),"select"]:[],queryFn:async()=>{var e,n;return tT({select:null==t?void 0:null===(e=t.params)||void 0===e?void 0:e.select,exclude:null==t?void 0:null===(n=t.params)||void 0===n?void 0:n.exclude})},enabled:!!(null==t?void 0:null===(e=t.params)||void 0===e?void 0:e.select)}),r=(0,j.useMemo)(()=>{if(t){var e,n;if(null===(e=t.params)||void 0===e?void 0:e.node_names)return t.params.node_names;if(null===(n=t.params)||void 0===n?void 0:n.node_ids)return t.params.node_ids}if("success"===l.status&&l.data)return l.data.nodes},[t,l]);return{recommendedCheck:i.data,selectedNodes:r}},lM=()=>{let{lineageGraph:e,envInfo:n}=eO(),{showRunId:t}=n4(),{data:l}=eT(),r=(0,b.NL)(),{recommendedCheck:o,selectedNodes:a}=lA(),[d,c]=(0,j.useState)(),[x,m]=(0,j.useState)(!1),[p,f]=(0,j.useState)(!1),[g,v]=(0,j.useState)(!1),{isOpen:y,onOpen:w,onClose:k}=(0,en.q)(),C=lO.recommendationIgnored,_=lO.recommendationShowed,S=lO.prevRefreshTimeStamp;(0,j.useEffect)(()=>{sessionStorage.getItem(C)&&f(!0)},[C]),(0,j.useEffect)(()=>{var t,i,l,r,s,d,u,h,x,p,g,j;if(!o||!a)return;if(null===(t=o.last_run)||void 0===t?void 0:t.run_id){let e=new Date(null===(s=o.last_run)||void 0===s?void 0:s.run_at).getTime(),t=null==n?void 0:n.dbt,i=Math.max((null==t?void 0:null===(d=t.current)||void 0===d?void 0:d.generated_at)?new Date(t.current.generated_at).getTime():0,(null==t?void 0:null===(u=t.base)||void 0===u?void 0:u.generated_at)?new Date(t.base.generated_at).getTime():0);if(e>=i){m(!0);return}m(!1),v(!0);let l=sessionStorage.getItem(S);(null===l||parseInt(l)!==i)&&(sessionStorage.setItem(S,i.toString()),sessionStorage.removeItem(C),sessionStorage.removeItem(_),f(!1))}let y=n=>n.map(n=>{var t;return null==e?void 0:null===(t=e.nodes[n])||void 0===t?void 0:t.name}).join(", ");if(a.length>0&&a.length<=3){if(null===(h=o.params)||void 0===h?void 0:h.node_names){let e=null===(p=o.params)||void 0===p?void 0:p.node_names.join(", ");c("'".concat(e,"'"))}else if(null===(x=o.params)||void 0===x?void 0:x.node_ids){let e=y(null===(g=o.params)||void 0===g?void 0:g.node_ids);c("'".concat(e,"'"))}else if(a){let e=y(a);c("'".concat(e,"'"))}}else(null==e?void 0:null===(i=e.modifiedSet)||void 0===i?void 0:i.length)===a.length?c("modified and potentially impacted models"):(null===(l=o.params)||void 0===l?void 0:l.select)&&!(null===(r=o.params)||void 0===r?void 0:r.exclude)?c("'".concat(null===(j=o.params)||void 0===j?void 0:j.select,"'")):c("".concat(a.length," models"));if(!sessionStorage.getItem(_)){let e=sessionStorage.getItem(S);sessionStorage.setItem(_,"true"),ej({action:"recommend",from:null===e?"initial":"rerun"})}},[o,a,e,C,_,S,n]);let z=(0,j.useCallback)(async()=>{o&&(t((await eC(o.check_id,{nowait:!0})).run_id),r.invalidateQueries({queryKey:B.check(o.check_id)}))},[o,t,r]);if(!o||!a||(null==l?void 0:l.single_env_onboarding))return(0,i.jsx)(i.Fragment,{});let R=a.length;return!p&&!x&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.U,{width:"100%",padding:"2pt 8pt",backgroundColor:"blue.50",children:(0,i.jsxs)(u.U,{flex:"1",fontSize:"10pt",color:"blue.600",children:[g?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(lL.i,{}),(0,i.jsx)(es.x,{children:"New dbt build detected - Re-run row count checks to maintain result accuracy"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(lT.h,{}),(0,i.jsxs)(es.x,{children:["First Check: Perform a row count diff of ",d," for basic impact assessment"]})]}),(0,i.jsx)(h.L,{}),(0,i.jsx)(ed.z,{size:"xs",onClick:()=>{f(!0),sessionStorage.setItem(C,"true"),ej({action:"ignore",from:g?"rerun":"initial",nodes:R})},children:"Ignore"}),(0,i.jsx)(ed.z,{colorScheme:"blue",size:"xs",onClick:()=>{w(),ej({action:"perform",from:g?"rerun":"initial",nodes:R})},children:"Perform"})]})}),(0,i.jsxs)(et.u_,{isOpen:y,onClose:()=>{k(),ej({action:"close",from:g?"rerun":"initial",nodes:R})},isCentered:!0,children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{children:[(0,i.jsx)(er.x,{children:"Row Count Check"}),(0,i.jsx)(eo.f,{children:(0,i.jsxs)(tY.K,{spacing:"4",children:[(0,i.jsxs)(es.x,{children:["Perform a row count check of the ",R," node(s) displayed in the lineage diff DAG."]}),(0,i.jsxs)(s.k,{bg:"blue.100",color:"blue.700",children:[(0,i.jsx)(lT.h,{mt:"10px",ml:"5px"}),(0,i.jsx)(es.x,{margin:"5px",paddingX:"3px",children:"This is a recommended first check based on the preset checks defined in your recce.yml file."})]})]})}),(0,i.jsxs)(ea.m,{gap:"5px",children:[(0,i.jsx)(ed.z,{onClick:()=>{k(),ej({action:"close",from:g?"rerun":"initial",nodes:R})},children:"Cancel"}),(0,i.jsxs)(ed.z,{colorScheme:"blue",onClick:()=>{k(),z(),m(!0),ej({action:"execute",from:g?"rerun":"initial",nodes:R})},children:["Execute on ",R," models"]})]})]})]})]})};var lF=t(71736),lN=t(29128),lq=t(11359),lH=t(55329),lV=t(32554);let lP=e=>{let{enabled:n,onChanged:t}=e,l=eT();return!l.data||l.data.single_env_onboarding?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(s.k,{direction:"row",alignItems:"center",gap:"5px",p:"5px 10px",borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:"white",children:[(0,i.jsx)(lF.r,{isChecked:n,onChange:e=>{t(e.target.checked)},alignItems:"center"}),(0,i.jsx)(s.k,{alignItems:"center",children:(0,i.jsx)(es.x,{fontSize:"10pt",lineHeight:"1",children:"Breaking Change Analysis"})}),(0,i.jsxs)(lN.J,{trigger:"hover",placement:"top-start",children:[(0,i.jsx)(lq.x,{children:(0,i.jsx)(o.J,{boxSize:"10px",as:lT.h,color:"gray.500",cursor:"pointer"})}),(0,i.jsx)(lH.y,{bg:"black",color:"white",children:(0,i.jsxs)(lV.b,{fontSize:"sm",children:["Breaking changes are determined by analyzing SQL for changes that may impact downstream models."," ",(0,i.jsx)(r.r,{href:"https://datarecce.io/docs/features/breaking-change-analysis/",target:"_blank",children:"Learn more"}),"."]})})]}),(0,i.jsx)(c.C,{color:"gray",children:"Experiment"})]})},lW=e=>{let{transformationType:n}=e,t="U",l="red";return"passthrough"===n?(t="P",l="gray"):"renamed"===n?(t="R",l="orange"):"derived"===n?(t="D",l="orange"):(t="U",l="red"),(0,i.jsx)(ts.Vp,{fontSize:"6pt",size:"xs",colorScheme:l,borderRadius:"full",paddingX:"2px",children:(0,i.jsx)(ts.Sn,{children:t})})};var lK=t(14729);let lB=e=>{let{node:n,column:t,reset:l}=e;return(0,i.jsxs)(s.k,{direction:"row",alignItems:"center",gap:"5px",p:"5px 10px",borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:"white",fontSize:"10pt",children:[(0,i.jsx)(es.x,{children:"Column Lineage for"}),(0,i.jsxs)(lx.E,{children:[n,".",t]}),(0,i.jsx)(nK.h,{icon:(0,i.jsx)(lK.T,{}),"aria-label":"",onClick:l,size:"xs"})]})},lJ={customNode:function(e){var n,t;let{data:r}=e,{id:a,isHighlighted:d,isSelected:c,resourceType:x,changeStatus:m}=r,p=(0,R.oR)(e=>e.transform[2]>.3),{icon:f}=tP(x),[g,v]=(0,j.useState)(!1),{interactive:y,selectNodeMulti:b,selectMode:w,advancedImpactRadius:k,viewOptions:C}=tC(),{lineageGraph:_}=eO(),S=k&&"modified"===m&&(null==_?void 0:_.nonBreakingSet.has(a)),{icon:z,color:E,backgroundColor:I}=m?tV(m):{icon:void 0,color:"gray.400",backgroundColor:"gray.100"},T=S?"dashed":"solid",L=null==r?void 0:r.name,D=(null==r?void 0:r.columnSet)&&(null==r?void 0:r.columnSet.size)>0;return(0,i.jsxs)(s.k,{direction:"column",width:"300px",transition:"box-shadow 0.2s ease-in-out",padding:0,filter:"action_result"===w?(null==r?void 0:r.action)?"none":"opacity(0.2) grayscale(50%)":d||c||g?"none":"opacity(0.2) grayscale(50%)",onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),children:[(0,i.jsxs)(s.k,{borderColor:E,borderWidth:"2px",borderStyle:T,borderTopRadius:8,borderBottomRadius:D?0:8,backgroundColor:p?"multi"===w?c?E:"white":"action_result"!==w?c||g?I:"white":r.action?c||g?I:E:"white":c||g?E:I,height:"60px",children:[(0,i.jsx)(s.k,{bg:E,padding:y?"8px":"2px",borderRightWidth:"2px",borderColor:"multi"===w?"#00000020":E,borderStyle:T,alignItems:"top",visibility:p?"inherit":"hidden",children:y&&(0,i.jsx)(ix,{checked:"multi"===w&&c||"action_result"===w&&!!r.action,onClick:e=>{"action_result"!==w&&(e.stopPropagation(),b(r.id))}})}),(0,i.jsxs)(s.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:[(0,i.jsxs)(s.k,{width:"100%",textAlign:"left",fontWeight:"600",flex:"1",p:1,gap:"5px",alignItems:"center",visibility:p?"inherit":"hidden",children:[(0,i.jsx)(l.x,{flex:"1",color:"multi"===w?c?"white":"inherit":"action_result"===w&&r.action&&!c?"white":"inherit",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:(0,i.jsx)(nI.u,{label:"model"===x?L:"".concat(L," (").concat(x,")"),placement:"top",children:L})}),(0,i.jsx)(o.J,{boxSize:"16px",color:"multi"===w?c?"white":"inherit":"action_result"===w&&r.action&&!c?"white":"inherit",as:f}),z&&(0,i.jsx)(o.J,{color:"multi"===w?c?"white":E:"action_result"===w?r.action&&!c?"white":"inherit":E,as:z})]}),(0,i.jsx)(s.k,{flex:"1 0 auto",mx:"1",direction:"column",paddingBottom:"1",visibility:p?"inherit":"hidden",children:(0,i.jsxs)(u.U,{spacing:"8px",children:["action_result"!==w&&"model"===r.resourceType&&(0,i.jsx)(ih,{id:r.id,inverted:"multi"===w&&!!c}),r.isActionMode&&(r.action?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.L,{}),(0,i.jsx)(ic,{node:r,action:r.action})]}):(0,i.jsx)(i.Fragment,{}))]})})]})]}),(null==r?void 0:r.columnSet)&&(null==r?void 0:r.columnSet.size)>0&&(0,i.jsx)(l.x,{p:"10px 20px",borderColor:E,borderWidth:"2px",borderTopWidth:0,borderStyle:T,borderBottomRadius:8,children:(0,i.jsx)(l.x,{height:"".concat((null==r?void 0:r.columnSet.size)*15,"px"),overflow:"auto"})}),Object.keys(null!==(n=null==r?void 0:r.parents)&&void 0!==n?n:{}).length>0&&(0,i.jsx)(R.HH,{type:"target",position:R.Ly.Left,isConnectable:!1}),Object.keys(null!==(t=null==r?void 0:r.children)&&void 0!==t?t:{}).length>0&&(0,i.jsx)(R.HH,{type:"source",position:R.Ly.Right,isConnectable:!1})]})},customColumnNode:function(e){var n,t;let{data:r}=e,{name:o}=r.node,{column:a,type:d,transformationType:c}=r,u=(0,R.oR)(e=>e.transform[2]>.3),{viewOptions:x}=tC(),m=null===(n=x.column_level_lineage)||void 0===n?void 0:n.node,p=a===(null===(t=x.column_level_lineage)||void 0===t?void 0:t.column)&&o===m;return u?(0,i.jsxs)(s.k,{width:"280px",height:"16px",padding:"0px 10px",border:"1px solid lightgray",backgroundColor:p?"#f0f0f0":"inherit",_hover:{backgroundColor:"#f0f0f0"},children:[(0,i.jsxs)(s.k,{fontSize:"10px",color:"gray",width:"100%",gap:"3px",alignItems:"center",children:[(0,i.jsx)(lW,{transformationType:c}),(0,i.jsx)(l.x,{children:a}),(0,i.jsx)(h.L,{}),(0,i.jsx)(l.x,{children:d})]}),(0,i.jsx)(R.HH,{type:"target",position:R.Ly.Left,isConnectable:!1,style:{left:0,visibility:"hidden"}}),(0,i.jsx)(R.HH,{type:"source",position:R.Ly.Right,isConnectable:!1,style:{right:0,visibility:"hidden"}})]}):(0,i.jsx)(i.Fragment,{})}},lU={customEdge:function(e){let{sourceX:n,sourceY:t,targetX:l,targetY:r,sourcePosition:o,targetPosition:s,style:a={},markerEnd:d,data:c}=e,u={...a};(null==c?void 0:c.changeStatus)&&(u.stroke=tV(null==c?void 0:c.changeStatus).color,u.strokeDasharray="5"),(null==c?void 0:c.isHighlighted)===!1&&(u.filter="opacity(0.2) grayscale(50%)");let[h]=(0,R.OQ)({sourceX:n,sourceY:t,sourcePosition:o,targetX:l,targetY:r,targetPosition:s});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(R.u5,{path:h,markerEnd:d,style:{...u,...a}})})}},lQ=e=>{var n,t;return(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.changeStatus)?tV(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.changeStatus).color:"lightgray"},lZ=(e,n)=>{let t=null==e?void 0:e.current,i=(0,j.useRef)({width:0,height:0});(0,j.useEffect)(()=>{let e=new ResizeObserver(e=>{for(let t of e){let e=t.contentRect.width,l=t.contentRect.height;(Math.abs(l-i.current.height)>10||Math.abs(e-i.current.width)>10)&&i.current.height>0&&l>0&&i.current.width>0&&e>0&&n(),i.current={width:e,height:l}}});return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[t,i,n])},lX=()=>{let[,e]=(0,eN.TH)();return(0,j.useCallback)(n=>{n.check_id&&e("/checks/".concat(n.check_id))},[e])},lG=(0,j.forwardRef)(function(e,n){var t;let{interactive:r=!1,...a}=e,d=(0,R._K)(),c=(0,j.useRef)(null),{successToast:h,failToast:x}=tZ(),{copyToClipboard:m,ImageDownloadModal:p,ref:f}=iL({renderLibrary:"html-to-image",imageType:"png",shadowEffect:!0,backgroundColor:"white",ignoreElements:e=>{let n=e.className;return!!("string"==typeof n&&n.includes(iT))},onSuccess:()=>{h("Copied the Lineage View as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),x("Failed to copy image to clipboard",e)}}),[g,v,y]=(0,R.Rr)([]),[b,w,k]=(0,R.ll)([]),{lineageGraph:C,retchLineageGraph:_,isLoading:S,error:z,refetchRunsAggregated:E}=eO(),{runId:T,showRunId:L,closeRunResult:B,runAction:J,isRunResultOpen:U}=n4(),{run:Q}=iw(T),[Z,X]=(0,j.useState)({...a.viewOptions}),G=e=>g.find(n=>n.data.name===e);(0,j.useImperativeHandle)(n,()=>({copyToClipboard:m}));let Y=(0,j.useMemo)(()=>{var e;return!!C&&(null==C?void 0:null===(e=C.modifiedSet)||void 0===e?void 0:e.length)>0},[C]),$=Z.view_mode||"changed_models",[en,et]=(0,j.useState)("single"),ei=(0,j.useMemo)(()=>{var e;if("single"===en)return null===(e=g.find(e=>e.data.isSelected))||void 0===e?void 0:e.data},[en,g]),el=(0,j.useMemo)(()=>g.filter(e=>e.data.isSelected).map(e=>e.data),[g]),er=(0,j.useMemo)(()=>g.map(e=>e.data),[g]),[eo,ea]=(0,j.useState)(!1),[ec,eu]=(0,j.useState)({x:0,y:0}),[ex,ep]=(0,j.useState)(!1),ef=(0,ee.p)();(0,j.useLayoutEffect)(()=>{(async()=>{let e;if(!C)return;if(Z.node_ids)e=Z.node_ids;else{var n;let t=null===(n=C.manifestMetadata.current)||void 0===n?void 0:n.project_name,i={view_mode:Z.view_mode?Z.view_mode:Y?"changed_models":"all",packages:t?[t]:void 0,...a.viewOptions};X(i),e=(await tT({select:i.select,exclude:i.exclude,packages:i.packages,view_mode:i.view_mode})).nodes}let[t,i]=F(C,e,Z.column_level_lineage),l=A(C);Y&&(l=M(C,ex)),[t,i]=q(Array.from(l),t,i),N(t,i),v(t),w(i)})()},[C]);let eg=e=>{let{deselect:n=!1,breakingChangeEnabled:t=!1}=e||{};if(!C)return;let[i,l]=q(Array.from(M(C,t)),g,b);v(K(n?W(i):i)),w(l)},ev=e=>{let{deselect:n=!1}=e||{};if(!C)return;let[t,i]=q(Array.from(A(C)),g,b);v(K(n?W(t):t)),w(i)},ej=()=>{Y?eg({deselect:!0}):ev({deselect:!0})},eb=async e=>{if(e.width&&e.height){let n=e.position.x+e.width/2,t=e.position.y+e.height/2,i=d.getZoom();d.setCenter(n,t,{zoom:i,duration:200})}},ew=lX();lZ(c,async()=>{if("single"===en||"action_result"===en){let e=g.find(e=>e.data.isSelected);e?eb(e):d.fitView({nodes:g,duration:200})}});let ek=(e,n)=>{n.data,eS({...Z,column_level_lineage:{node:n.data.node.name,column:n.data.column}},!1)},eC=(e,n)=>{if(!1!==r&&C){if("customColumnNode"===n.type)return ek(e,n);if(eT(),"single"===en){ei||eb(n);let[e,t]=q(Array.from(I(D(C,[n.id]),O(C,[n.id]))),g,b);v(H(n.id,e)),w(t),eb(n)}else if("action_result"===en){var t,i,l,o;(null===(i=n.data.action)||void 0===i?void 0:null===(t=i.run)||void 0===t?void 0:t.run_id)&&L(null===(o=n.data.action)||void 0===o?void 0:null===(l=o.run)||void 0===l?void 0:l.run_id),eb(n),v(H(n.id,g))}else{let e=V(n.id,g);e.find(e=>e.data.isSelected)||(et("single"),e=K(e)),v(e)}}},e_=(0,j.useCallback)(e=>{v(n=>n.map(n=>n.id===e.id?{...n,data:e}:n))},[v]),eS=async function(e){var n,t,i;let l;let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!C)return;if(Z.select!==e.select||Z.exclude!==e.exclude||Z.packages!==e.packages||Z.view_mode!==e.view_mode)try{l=(await tT({select:e.select,exclude:e.exclude,packages:e.packages,view_mode:e.view_mode})).nodes}catch(e){e instanceof lS.d7&&ef({title:"Select node error",description:(null===(i=e.response)||void 0===i?void 0:null===(t=i.data)||void 0===t?void 0:t.detail)||e.message,status:"error",isClosable:!0,position:"bottom-right"});return}else l=g.map(e=>e.id);let[o,s]=F(C,l,e.column_level_lineage),a=M(C,ex);if([o,s]=q(Array.from(a),o,s),"single"===en&&ei){let e=o.find(e=>e.id==ei.id);e&&(e.data.isSelected=!0)}N(o,s),v(o),w(s),X(e),(null==Q?void 0:null===(n=Q.params)||void 0===n?void 0:n.model)&&!G(Q.params.model)&&B(),r&&(await new Promise(e=>setTimeout(e,1)),await (async()=>{d.fitView({nodes:o,duration:200})})())},ez=lR("multi"===en?el:er,{onActionStarted:()=>{et("action_result")},onActionNodeUpdated:e_,onActionCompleted:()=>{}}),eR=lI();if((0,j.useEffect)(()=>{let e=null==Q?void 0:Q.type;if(!(!r||!U||!e||["query_diff","query","row_count"].includes(e))&&"single"===en){var n;let e=null==Q?void 0:null===(n=Q.params)||void 0===n?void 0:n.model,t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});if(e){let n=G(e);n?ei!==n.data&&eC(t,n):eS({...Z,view_mode:"all"})}else ej()}},[Q,Z,U,en]),S)return(0,i.jsx)(s.k,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:(0,i.jsx)(t3.$,{size:"xl"})});let eE=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,n=ec.selectedNode;"action_result"!==en&&void 0!==n&&void 0!==C&&("single"===en&&(v(K(g,!0)),et("multi"),ez.reset()),v(P([...D(C,[n.id],e)],g,"single"===en)))},eI=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,n=ec.selectedNode;"action_result"!==en&&void 0!==n&&void 0!==C&&("single"===en&&(v(K(g,!0)),et("multi"),ez.reset()),v(P([...O(C,[n.id],e)],g,"single"===en)))},eT=()=>{ea(!1),eu({x:0,y:0})};if(z)return(0,i.jsx)(nn.M,{h:"100%",children:(0,i.jsxs)(ng.g,{children:[(0,i.jsx)(l.x,{children:"Failed to load lineage data. This could be because the server has been terminated or there is a network error."}),(0,i.jsxs)(l.x,{children:["[Reason: ",z,"]"]}),(0,i.jsx)(ed.z,{colorScheme:"blue",onClick:()=>{_&&_()},children:"Retry"})]})});if("changed_models"===$&&!(null==C?void 0:null===(t=C.modifiedSet)||void 0===t?void 0:t.length))return(0,i.jsx)(nn.M,{h:"100%",children:(0,i.jsxs)(ng.g,{children:[(0,i.jsx)(i.Fragment,{children:"No change detected"}),(0,i.jsx)(ed.z,{colorScheme:"blue",onClick:()=>{eS({...Z,view_mode:"all"})},children:"Show all nodes"})]})});let eL=()=>{et("single"),Y?eg({deselect:!0}):ev({deselect:!0}),B(),null==E||E()},eD={interactive:r,selectMode:en,nodes:g,viewOptions:Z,onViewOptionsChanged:eS,selectNodeMulti:e=>{if("multi"!==en){if(!C)return;let[n,t]=q(Array.from(O(C,C.modifiedSet)),g,b);v(n=H(e,n=K(n,!0))),w(t),et("multi"),ez.reset()}else{let n=V(e,g);n.find(e=>e.data.isSelected)?v(n):eL()}},deselect:eL,advancedImpactRadius:ex,setAdvancedImpactRadius:ep,runRowCount:async()=>{"multi"===en?(await ez.runRowCount(),em({type:"row_count",selected:"multi"})):ei?(await J("row_count",{node_names:[ei.name]},{showForm:!1,showLast:!1}),em({type:"row_count",selected:"single"})):(await J("row_count",{select:Z.select,exclude:Z.exclude,packages:Z.packages,view_mode:Z.view_mode}),em({type:"row_count",selected:"none"}))},runRowCountDiff:async()=>{"multi"===en?(await ez.runRowCountDiff(),em({type:"row_count_diff",selected:"multi"})):ei?(await J("row_count_diff",{node_names:[ei.name]},{showForm:!1,showLast:!1}),em({type:"row_count_diff",selected:"single"})):(await J("row_count_diff",{select:Z.select,exclude:Z.exclude,packages:Z.packages,view_mode:Z.view_mode}),em({type:"row_count_diff",selected:"none"}))},runValueDiff:async()=>{if(ei)await J("value_diff",{model:ei.name},{showForm:!0,showLast:!1}),em({type:"value_diff",selected:"single"});else{let e="multi"===en?el.length:er.length;await eR.confirm(e)&&(await ez.runValueDiff(),em({type:"value_diff",selected:"multi"===en?"multi":"none"}))}},addLineageDiffCheck:async()=>{let e;"multi"===en?(e=await ez.addLineageDiffCheck(),eL(),em({type:"lineage_diff",selected:"multi"})):ei||(e=await lC(Z),em({type:"lineage_diff",selected:"none"})),e&&ew(e)},addSchemaDiffCheck:async()=>{let e;"multi"===en?el.length>0&&(e=await ez.addSchemaDiffCheck(),eL(),em({type:"schema_diff",selected:"multi"})):ei?(e=await iy({node_id:ei.id}),em({type:"schema_diff",selected:"single"})):(e=await iy({select:Z.select,exclude:Z.exclude,packages:Z.packages,view_mode:Z.view_mode}),em({type:"schema_diff",selected:"none"})),e&&ew(e)},cancel:ez.cancel,actionState:ez.actionState,showColumnLevelLineage:(e,n)=>{eS({...Z,column_level_lineage:{node:e,column:n}},!1)},resetColumnLevelLinage:()=>{eS({...Z,column_level_lineage:void 0},!1)}};return!C||Object.keys(C.nodes).length>0&&0===g.length?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(tk.Provider,{value:eD,children:[(0,i.jsxs)(tD,{sizes:ei?[70,30]:[100,0],minSize:ei?400:0,gutterSize:ei?5:0,style:{height:"100%",width:"100%"},children:[(0,i.jsxs)(ng.g,{ref:c,divider:(0,i.jsx)(t9.c,{borderColor:"gray.200"}),spacing:0,style:{contain:"strict"},position:"relative",children:[r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(lk,{}),(0,i.jsx)(lM,{})]}),(0,i.jsxs)(R.x$,{nodeTypes:lJ,edgeTypes:lU,nodes:g,edges:b,onNodesChange:y,onEdgesChange:k,onNodeClick:eC,onNodeContextMenu:(e,n)=>{if(!r||"action_result"===en)return;e.preventDefault();let t=f.current.getBoundingClientRect(),i=f.current.offsetTop;eu({x:e.clientX-t.left,y:e.clientY-t.top+i,selectedNode:n}),ea(!0)},onClick:eT,onInit:()=>{if(Y)d.fitView();else{let e=(0,R.RX)(g);d.setCenter(e.x+e.width/2,e.y+e.height/2,{zoom:1})}},maxZoom:2,minZoom:.1,nodesDraggable:r,ref:f,children:[(0,i.jsx)(t8.A,{color:"#ccc"}),(0,i.jsx)(t7.Z,{showInteractive:!1,position:"top-right",className:iT,children:(0,i.jsx)(t7.B,{title:"copy image",onClick:async()=>{m()},children:(0,i.jsx)(o.J,{as:il.C3L})})}),(0,i.jsx)(p,{}),(0,i.jsx)(R.s_,{position:"bottom-left",children:(0,i.jsx)(u.U,{children:(0,i.jsx)(l_,{})})}),(0,i.jsx)(R.s_,{position:"top-left",children:(0,i.jsxs)(s.k,{direction:"column",gap:"5px",children:[(0,i.jsx)(lP,{enabled:ex,onChanged:e=>{var n;ep(e),eg({breakingChangeEnabled:e}),n={enabled:e},eh.j("[Experiment] breaking_change_analysis",n),ey=n.enabled}}),Z.column_level_lineage&&(0,i.jsx)(lB,{node:Z.column_level_lineage.node,column:Z.column_level_lineage.column,reset:()=>{eS({...Z,column_level_lineage:void 0})}}),0==g.length&&(0,i.jsx)(es.x,{fontSize:"xl",color:"grey",opacity:.5,children:"No nodes"})]})}),(0,i.jsx)(ie.a,{nodeColor:lQ,nodeStrokeWidth:3,zoomable:!0,pannable:!0}),"action_result"===en&&(0,i.jsx)(R.s_,{position:"bottom-center",className:iT,children:(0,i.jsx)(lh,{onClose:()=>{eL()}})})]}),eo&&(0,i.jsx)(nP.v,{isOpen:!0,onClose:eT,children:(0,i.jsxs)(nJ.q,{fontSize:"11pt",position:"absolute",width:"250px",style:{left:"".concat(ec.x,"px"),top:"".concat(ec.y,"px")},children:[(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(im.Cv2,{}),onClick:()=>{eE(1)},children:"Select parent nodes"}),(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(im.IMj,{}),onClick:()=>{eI(1)},children:"Select child nodes"}),(0,i.jsx)(ta.R,{}),(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(im.Cv2,{}),onClick:()=>{eE()},children:"Select all upstream nodes"}),(0,i.jsx)(nQ.s,{icon:(0,i.jsx)(im.IMj,{}),onClick:()=>{eI()},children:"Select all downstream nodes"})]})})]}),"single"===en&&ei?(0,i.jsx)(l.x,{borderLeft:"solid 1px lightgray",height:"100%",children:(0,i.jsx)(lu,{node:ei,onCloseNode:ej})}):(0,i.jsx)(l.x,{})]}),eR.AlertDialog]})}),lY=(0,j.forwardRef)(function(e,n){let{check:t}=e,l={...t.params,...t.view_options};return(0,i.jsx)(s.k,{direction:"column",height:"100%",children:(0,i.jsx)(R.tV,{children:(0,i.jsx)(lG,{viewOptions:l,interactive:!1,ref:n})})})});function l$(e){let{yamlTemplate:n}=e;return(0,i.jsx)(t$.ML,{height:"300px",language:"yaml",theme:"vs",value:n,options:{readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})}function l0(){let e=(0,ee.p)();return{markedAsApprovedToast:function(){e({title:"Marked as approved",position:"bottom-right",status:"success",containerStyle:{fontSize:"sm"},duration:2e3})}}}function l1(){let e=(0,to._)(["\n  <details><summary>","</summary>\n\n  ","\n\n  </details>"]);return l1=function(){return e},e}let l5=(e,n)=>"schema_diff"!==e&&"lineage_diff"!==e&&(!(null==n?void 0:n.result)||!!(null==n?void 0:n.error)),l2=e=>{var n,t,r,a,c,f,g,v;let{checkId:w,refreshCheckList:k}=e,C=(0,b.NL)(),[,_]=(0,eN.TH)(),{successToast:S,failToast:z}=tZ(),{markedAsApprovedToast:R}=l0(),[E,I]=(0,j.useState)(),[T,L]=(0,j.useState)(),[D,O]=(0,j.useState)(!1),[A,M]=(0,j.useState)(""),{isOpen:F,onOpen:N,onClose:q}=(0,en.q)(),H=()=>(0,i.jsx)(ei.Z,{bg:"blackAlpha.300",backdropFilter:"blur(10px) "}),[V,P]=(0,j.useState)((0,i.jsx)(H,{})),{isLoading:W,error:K,data:J}=(0,y.a)({queryKey:B.check(w),queryFn:async()=>tt(w),refetchOnMount:!0}),U=E||(null==J?void 0:null===(n=J.last_run)||void 0===n?void 0:n.run_id),{run:Q,error:Z}=iw(U),X=E?!Q||"running"===Q.status:(null==Q?void 0:Q.status)==="running",G=(null==J?void 0:J.type)?n0(null==J?void 0:J.type):void 0,Y=(null==J?void 0:J.is_preset)||!1,$=(0,j.useRef)(null),{mutate:ee}=(0,tw.D)({mutationFn:e=>ti(w,e),onSuccess:()=>{C.invalidateQueries({queryKey:B.check(w)}),C.invalidateQueries({queryKey:B.checks()})}}),{mutate:ea}=(0,tw.D)({mutationFn:()=>tl(w),onSuccess:()=>{C.invalidateQueries({queryKey:B.checks()}),_("/checks")}}),ec=(0,j.useCallback)(async()=>{(null==J?void 0:J.type)&&(I((await eC(w,{nowait:!0})).run_id),C.invalidateQueries({queryKey:B.check(w)}),k&&k())},[J,w,I,C,k]),eu=(0,j.useCallback)(async()=>{if(O(!0),U)return await ek(U)},[U]),eh=async()=>{var e;if(!J)return;let n=(e=J,(0,tQ.RI)(l1(),"".concat(e.is_checked?" ":"").concat(e.name),function(e){if("query"===e.type||"query_diff"===e.type){var n;return"".concat(tG(e),"\n\n").concat((0,tQ.Pn)(tX(),null===(n=e.params)||void 0===n?void 0:n.sql_template))}return tG(e)}(e)));if(!navigator.clipboard){z("Failed to copy the check to clipboard",Error("Copy to clipboard is available only in secure contexts (HTTPS)"));return}try{await navigator.clipboard.writeText(n),S("Copied the check to the clipboard")}catch(e){z("Failed to copy the check to clipboard",e)}},ex=(0,j.useCallback)(()=>{let e=null==J?void 0:J.is_checked;ee({is_checked:!e}),!0==!e&&R()},[null==J?void 0:J.is_checked,ee,R]),[em,ep]=(0,j.useState)(0),{ref:ef,onCopyToClipboard:eg,onMouseEnter:ev,onMouseLeave:ej}=iD();if((0,j.useEffect)(()=>{M(function(e){let{name:n,description:t,type:i,params:l,viewOptions:r}=e,o={name:n,description:t,type:i,params:l};return r&&(o.view_options=r),ik.ZP.stringify({checks:[o]})}({name:(null==J?void 0:J.name)||"",description:(null==J?void 0:J.description)||"",type:(null==J?void 0:J.type)||"",params:null==J?void 0:J.params,viewOptions:null==J?void 0:J.view_options}))},[J]),W)return(0,i.jsx)(nn.M,{h:"100%",children:"Loading"});if(K)return(0,i.jsxs)(nn.M,{h:"100%",children:["Error: ",K.message]});let ey=(null==Q?void 0:Q.run_at)?(0,t6.Q)(new Date(Q.run_at),{addSuffix:!0}):null;return(0,i.jsxs)(tO,{minSize:100,sizes:[30,70],style:{height:"100%",width:"100%",maxHeight:"100%"},children:[(0,i.jsxs)(l.x,{style:{contain:"strict"},display:"flex",flexDirection:"column",children:[(0,i.jsxs)(s.k,{p:"0px 16px",alignItems:"center",h:"40px",children:[(0,i.jsx)(tb,{name:(null==J?void 0:J.name)||"",setName:e=>{ee({name:e})}}),Y&&(0,i.jsx)(nI.u,{label:"Preset Check defined in recce config",children:(0,i.jsxs)(ts.Vp,{size:"sm",flex:"0 0 auto",ml:"2",children:[(0,i.jsx)(ts.AD,{boxSize:"14px",as:tf.bX4}),"Preset"]})}),(0,i.jsx)(h.L,{}),(0,i.jsxs)(u.U,{mr:"10px",children:[ey&&(0,i.jsx)(l.x,{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontSize:"10pt",children:ey}),(0,i.jsxs)(nP.v,{children:[(0,i.jsx)(nW.j,{isRound:!0,as:nK.h,icon:(0,i.jsx)(o.J,{as:nr.D_A}),variant:"ghost",size:"sm"}),(0,i.jsxs)(nJ.q,{children:[(0,i.jsx)(nQ.s,{as:es.x,fontSize:"10pt",icon:(0,i.jsx)(tg.ovA,{}),onClick:()=>{P((0,i.jsx)(H,{})),N()},children:"Get Preset Check Template"}),(0,i.jsx)(nQ.s,{as:es.x,fontSize:"10pt",icon:(0,i.jsx)(th.T,{}),onClick:()=>eh(),children:"Copy Markdown"}),(0,i.jsx)(ta.R,{}),(0,i.jsx)(nQ.s,{as:es.x,fontSize:"10pt",icon:(0,i.jsx)(tx.p,{}),color:"red",onClick:()=>ea(),children:"Delete"})]})]}),(0,i.jsx)(nI.u,{label:l5(null!==(f=null==J?void 0:J.type)&&void 0!==f?f:"",Q)?"Run the check first":(null==J?void 0:J.is_checked)?"Mark as Pending":"Mark as Approved",placement:"bottom-end",children:(0,i.jsx)(ed.z,{flex:"0 0 auto",size:"sm",colorScheme:(null==J?void 0:J.is_checked)?"green":"gray",variant:(null==J?void 0:J.is_checked)?"solid":"outline",leftIcon:(null==J?void 0:J.is_checked)?(0,i.jsx)(tm.r,{}):(0,i.jsx)(o.J,{as:nr.Rbx,color:"lightgray"}),onClick:()=>ex(),isDisabled:l5(null!==(g=null==J?void 0:J.type)&&void 0!==g?g:"",Q),children:(null==J?void 0:J.is_checked)?"Approved":"Mark as Approved"})})]})]}),(0,i.jsx)(l.x,{flex:"1",p:"8px 16px",minHeight:"100px",children:(0,i.jsx)(tU,{value:null==J?void 0:J.description,onChange:e=>{ee({description:e})}},null==J?void 0:J.check_id)})]}),(0,i.jsx)(l.x,{style:{contain:"strict"},children:(0,i.jsxs)(x.m,{height:"100%",display:"flex",flexDirection:"column",tabIndex:em,onChange:ep,children:[(0,i.jsxs)(m.t,{height:"50px",children:[(0,i.jsx)(p.O,{fontSize:"10pt",children:"Result"}),((null==J?void 0:J.type)==="query"||(null==J?void 0:J.type)==="query_diff")&&(0,i.jsx)(p.O,{fontSize:"10pt",children:"Query"}),(0,i.jsx)(h.L,{}),(0,i.jsxs)(u.U,{mr:"10px",children:[(null==G?void 0:G.RunResultView)&&(0,i.jsx)(nI.u,{label:"Rerun",children:(0,i.jsx)(ed.z,{leftIcon:(0,i.jsx)(tp.n,{}),variant:"outline",isLoading:X,size:"sm",onClick:()=>ec(),children:"Rerun"})}),(0,i.jsx)(ed.z,{leftIcon:(0,i.jsx)(th.T,{}),variant:"outline",isDisabled:l5(null!==(v=null==J?void 0:J.type)&&void 0!==v?v:"",Q)||0!==em,onMouseEnter:ev,onMouseLeave:ej,size:"sm",onClick:()=>{if((null==J?void 0:J.type)==="lineage_diff"){var e;null===(e=$.current)||void 0===e||e.copyToClipboard()}else eg()},children:"Copy to Clipboard"})]})]}),(0,i.jsxs)(td.n,{height:"100%",flex:"1",style:{contain:"strict"},children:[(0,i.jsxs)(tc.x,{p:0,width:"100%",height:"100%",children:[(null==G?void 0:G.RunResultView)&&((null==J?void 0:J.last_run)||U?(0,i.jsx)(t4,{ref:ef,isRunning:X,isAborting:D,run:U?Q:null==J?void 0:J.last_run,error:Z,progress:T,RunResultView:G.RunResultView,viewOptions:null==J?void 0:J.view_options,onViewOptionsChanged:e=>{ee({view_options:e})},onCancel:eu,onExecuteRun:ec}):(0,i.jsx)(nn.M,{bg:"rgb(249,249,249)",height:"100%",children:(0,i.jsxs)(ng.g,{spacing:4,children:[(0,i.jsx)(l.x,{children:"This action is part of the initial preset and has not been performed yet. Once performed, the result will be shown here."}),(0,i.jsx)(ed.z,{onClick:ec,colorScheme:"blue",size:"sm",children:"Run Query"})]})})),J&&"schema_diff"===J.type&&(0,i.jsx)(tB,{check:J,ref:ef}),J&&"lineage_diff"===J.type&&(0,i.jsx)(lY,{check:J,ref:$})]}),((null==J?void 0:J.type)==="query"||(null==J?void 0:J.type)==="query_diff"||(null==J?void 0:J.type)==="query_base")&&(0,i.jsx)(tc.x,{p:0,height:"100%",width:"100%",children:(null===(t=J.params)||void 0===t?void 0:t.base_sql_template)?(0,i.jsx)(t1,{value:(null==J?void 0:null===(r=J.params)||void 0===r?void 0:r.sql_template)||"",baseValue:(null==J?void 0:null===(a=J.params)||void 0===a?void 0:a.base_sql_template)||"",options:{readOnly:!0}}):(0,i.jsx)(t0,{value:(null==J?void 0:null===(c=J.params)||void 0===c?void 0:c.sql_template)||"",options:{readOnly:!0}})})]})]})}),(0,i.jsxs)(et.u_,{isOpen:F,onClose:q,isCentered:!0,size:"6xl",children:[V,(0,i.jsxs)(el.h,{overflowY:"auto",height:"40%",width:"60%",children:[(0,i.jsx)(er.x,{children:"Preset Check Template"}),(0,i.jsx)(eM.o,{}),(0,i.jsxs)(eo.f,{children:[(0,i.jsxs)(d.X,{size:"sm",fontWeight:"bold",children:["Please"," ",(0,i.jsx)(es.x,{as:"span",cursor:"pointer",_hover:{textDecoration:"underline"},color:"blue.500",onClick:async()=>{await navigator.clipboard.writeText(A),S("Copied the template to the clipboard")},children:"copy"})," ","the following template and paste it into the"," ",(0,i.jsx)(tu.y,{query:"recce.yml",styles:{px:"1",py:"0",bg:"red.100"},children:"recce.yml"})," ","file."]}),(0,i.jsx)("br",{}),(0,i.jsx)(l$,{yamlTemplate:A})]})]})]})]})};var l4=t(35019);let l6=e=>{var n,t,r;let{check:a,selected:d,onSelect:c,onMarkAsApproved:u}=e,h=(0,b.NL)(),x=a.check_id,{mutate:m}=(0,tw.D)({mutationFn:e=>ti(x,e),onSuccess:()=>{h.invalidateQueries({queryKey:B.check(x)}),h.invalidateQueries({queryKey:B.checks()})}}),{run:p}=iw(null==a?void 0:null===(n=a.last_run)||void 0===n?void 0:n.run_id),f=(null===(t=n0(a.type))||void 0===t?void 0:t.icon)||eq.WzH,g=l5(null!==(r=null==a?void 0:a.type)&&void 0!==r?r:"",p);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(s.k,{width:"100%",p:"10px 20px",cursor:"pointer",_hover:{bg:"Cornsilk"},bg:d?"Floralwhite":"inherit",borderBlockEndWidth:"1px",borderLeftWidth:"3px",borderLeftColor:d?"orange":"transparent",onClick:()=>c(a.check_id),alignItems:"center",gap:"5px",children:[(0,i.jsx)(o.J,{as:f}),(0,i.jsx)(l.x,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:a.name}),(0,i.jsx)(nI.u,{label:g?"Run the check first":"Click to mark as approved",placement:"top",hasArrow:!0,children:(0,i.jsx)(s.k,{children:(0,i.jsx)(nv.X,{isChecked:a.is_checked,variant:"circular",colorScheme:"green",size:"xs",onChange:e=>{let n=e.target.checked;!1===n?m({is_checked:n}):u()},disabled:g})})})]})})},l3=e=>{let{checks:n,selectedItem:t,onCheckSelected:r,onChecksReordered:o}=e,[a,d]=(0,j.useState)(!1),c=(0,b.NL)(),{mutate:u}=(0,tw.D)({mutationFn:e=>ti(e,{is_checked:!0}),onSuccess:(e,n)=>{c.invalidateQueries({queryKey:B.check(n)}),c.invalidateQueries({queryKey:B.checks()})}}),{isOpen:h,onOpen:x,onClose:m}=(0,en.q)(),{markedAsApprovedToast:p}=l0(),f=()=>{"true"===localStorage.getItem("bypassMarkAsApprovedWarning")?(u(t),p()):x()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l4.Z5,{onDragEnd:e=>{e.destination&&o(e.source.index,e.destination.index)},children:(0,i.jsx)(l4.bK,{droppableId:"checklist",children:e=>(0,i.jsxs)(ng.g,{...e.droppableProps,ref:e.innerRef,w:"full",spacing:"0",flex:"1",overflow:"auto",children:[n.map((e,n)=>(0,i.jsx)(l4._l,{draggableId:e.check_id,index:n,children:(n,l)=>{if(l.isDragging){let e=n.draggableProps,t={x:0,y:80},i=e.style.left-t.x,l=e.style.top-t.y;e.style.left=i,e.style.top=l}return(0,i.jsx)(s.k,{ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,w:"full",children:(0,i.jsx)(l6,{check:e,selected:e.check_id===t,onSelect:r,onMarkAsApproved:f},e.check_id)})}},e.check_id)),e.placeholder]})})}),(0,i.jsxs)(et.u_,{isOpen:h,onClose:m,isCentered:!0,children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{width:"400px",children:[(0,i.jsx)(er.x,{children:"Mark as Approved?"}),(0,i.jsx)(eM.o,{}),(0,i.jsx)(nT.i,{}),(0,i.jsxs)(l.x,{p:"16px",fontSize:"sm",gap:"16px",children:[(0,i.jsx)("p",{children:"Please ensure you have reviewed the contents of this check before marking it as approved."}),(0,i.jsx)(nv.X,{isChecked:a,onChange:e=>d(e.target.checked),fontWeight:"bold",size:"sm",pt:"8px",children:"Don't show this again"})]}),(0,i.jsx)(nT.i,{}),(0,i.jsxs)(ea.m,{children:[(0,i.jsx)(ed.z,{variant:"outline",size:"xs",mr:2,onClick:m,children:"Cancel"}),(0,i.jsx)(ed.z,{colorScheme:"blue",size:"xs",onClick:()=>{u(t),!0===a&&localStorage.setItem("bypassMarkAsApprovedWarning","true"),p(),m()},children:"Mark as approved"})]})]})]})]})};async function l9(e){return(await X.post("/api/save-as",e)).data}async function l8(e){return(await X.post("/api/rename",e)).data}async function l7(){return(await X.post("/api/export")).data}async function re(e,n){let t=new FormData;return t.append("file",e),t.append("checks_only",(!!n).toString()),(await X.post("/api/import",t)).data}async function rn(){return 208===(await X.get("/api/sync")).status}async function rt(e){try{let n=await X.post("/api/sync",e);if(202===n.status)return{status:"accepted"};if(208===n.status)return{status:"syncing"}}catch(e){if((0,lS.IZ)(e)&&e.response&&409===e.response.status)return{status:"conflict"}}throw Error("Failed to sync state")}function ri(e){let{checksOnly:n=!0}=e,t=(0,ee.p)(),l=(0,b.NL)(),r=(0,j.useRef)(null),a=(0,j.useRef)(null),[d,c]=(0,j.useState)(null),{isOpen:u,onOpen:h,onClose:x}=(0,en.q)(),[m,p]=(0,eN.TH)(),[,f]=eA(),g=(0,j.useCallback)(async()=>{if(d){try{let{runs:e,checks:i}=await re(d,n);f(),await l.invalidateQueries({queryKey:B.checks()}),await l.invalidateQueries({queryKey:B.runs()}),m.includes("/checks")&&p("/checks");let r=n?"".concat(i," checks imported successfully"):"".concat(e," runs and ").concat(i," checks imported successfully");t({description:r,status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}catch(e){console.error("Import failed",e),t({title:"Import failed",description:"".concat(e),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}x()}},[l,d,t,x,m,p,f,n]),v=n?"checks":"runs and checks",{isDemoSite:y}=eO();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nI.u,{label:"Import Checklist from State File"+(y?" (Disabled in the demo site)":""),children:(0,i.jsx)(nK.h,{pt:"6px",variant:"unstyled","aria-label":"Import state",onClick:()=>{r.current&&r.current.click()},icon:(0,i.jsx)(o.J,{as:le}),isDisabled:y})}),(0,i.jsx)("input",{type:"file",style:{display:"none"},ref:r,onChange:e=>{var n;(null===(n=e.target.files)||void 0===n?void 0:n.length)===1&&(c(e.target.files[0]),h()),r.current&&(r.current.value="")}}),(0,i.jsx)(lE.aR,{isOpen:u,leastDestructiveRef:a,onClose:x,size:"xl",children:(0,i.jsx)(ei.Z,{children:(0,i.jsxs)(lE._T,{children:[(0,i.jsx)(er.x,{fontSize:"lg",fontWeight:"bold",children:"Import state"}),(0,i.jsx)(eo.f,{children:(0,i.jsxs)(s.k,{px:"5px",gap:"5px",rounded:"md",direction:"column",children:[(0,i.jsxs)(s.k,{alignItems:"center",gap:"5px",children:[(0,i.jsx)(it.s,{color:"red.600"}),(0,i.jsx)(es.x,{as:"span",fontWeight:"500",color:"red.600",children:"Caution!"})]}),(0,i.jsx)(s.k,{children:(0,i.jsxs)(es.x,{children:["The current ",v," will be"," ",(0,i.jsx)(es.x,{as:"span",fontWeight:"600",children:"merged"})," ","with the imported state"]})})]})}),(0,i.jsxs)(ea.m,{children:[(0,i.jsx)(ed.z,{ref:a,onClick:x,children:"Cancel"}),(0,i.jsx)(ed.z,{colorScheme:"blue",onClick:g,ml:"5px",children:"Import"})]})]})})})]})}let rl=()=>{let[,e]=(0,eN.TH)(),[,n]=(0,eN.yj)("/checks/:checkId"),{latestSelectedCheckId:t,setLatestSelectedCheckId:r}=n9(),o=(0,b.NL)(),a=null==n?void 0:n.checkId;a&&r(a);let{isLoading:d,error:c,data:u,status:h,refetch:x}=(0,y.a)({queryKey:B.checks(),queryFn:tn,refetchOnMount:!0}),m=(0,j.useCallback)(n=>{e("/checks/".concat(n))},[e]),[p,f]=(0,j.useState)(u||[]),{mutate:g}=(0,tw.D)({mutationFn:e=>tr(e),onSuccess:()=>{o.invalidateQueries({queryKey:B.checks()})}}),v=(0,j.useCallback)((e,n)=>{let t=[...p],[i]=t.splice(e,1);t.splice(n,0,i),g({source:e,destination:n}),f(t)},[p,f,g]);return((0,j.useCallback)(async()=>{let e=await n7();o.invalidateQueries({queryKey:B.checks()}),m(e.check_id)},[o,m]),(0,j.useEffect)(()=>{"success"===h&&(!a&&u.length>0&&(t?e("/checks/".concat(t)):e("/checks/".concat(u[0].check_id))),f(u))},[h,a,u,f,e,t]),d)?(0,i.jsx)(i.Fragment,{}):c?(0,i.jsxs)(i.Fragment,{children:["Error: ",c.message]}):(null==u?void 0:u.length)?(0,i.jsxs)(tD,{style:{height:"100%"},minSize:50,sizes:[20,80],children:[(0,i.jsx)(l.x,{borderRight:"lightgray solid 1px",height:"100%",style:{contain:"size"},children:(0,i.jsxs)(ng.g,{spacing:0,h:"100%",style:{contain:"strict"},alignItems:"stretch",children:[(0,i.jsx)(s.k,{justifyContent:"right",padding:"0px 10px",children:(0,i.jsx)(ri,{checksOnly:!0})}),(0,i.jsx)(nT.i,{}),(0,i.jsx)(l3,{checks:p,selectedItem:a,onCheckSelected:m,onChecksReordered:v})]})}),(0,i.jsx)(l.x,{height:"100%",children:(0,i.jsx)(eN.rs,{children:(0,i.jsx)(eN.AW,{path:"/checks/:checkId",children:e=>(0,i.jsx)(l2,{checkId:e.checkId,refreshCheckList:x},e.checkId)})})})]}):(0,i.jsx)(nn.M,{h:"100%",children:(0,i.jsx)(l.x,{children:"No checks"})})},rr=()=>{let{isHistoryOpen:e,showHistory:n,closeHistory:t}=n4();return(0,i.jsxs)(l.x,{children:[(0,i.jsx)(l.x,{fontSize:"8pt",children:"History"}),(0,i.jsx)(ed.z,{leftIcon:(0,i.jsx)(o.J,{as:nr.M1Q}),size:"xs",variant:"outline",onClick:()=>{e?(ep({name:"hide"}),t()):(ep({name:"show"}),n())},children:e?"Hide":"Show"})]})},ro=()=>{let{isCustomQueries:e,setCustomQueries:n,sqlQuery:t,setBaseSqlQuery:r}=_();return(0,i.jsxs)(l.x,{children:[(0,i.jsxs)(l.x,{fontSize:"8pt",children:["Custom Queries ","",(0,i.jsx)(nI.u,{label:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,i.jsx)(it.s,{color:"gray.600",boxSize:"3"})})]}),(0,i.jsx)(lF.r,{size:"sm",isChecked:e,onChange:()=>{!1===e&&r&&r(t),n(!e)}})]})},rs=()=>{let{sqlQuery:e,baseSqlQuery:n,setSqlQuery:t,setBaseSqlQuery:r,primaryKeys:o,setPrimaryKeys:a,isCustomQueries:d}=_(),{envInfo:c}=eO(),u=e;(null==c?void 0:c.adapterType)==="sqlmesh"&&e===w&&(u="select * from db.mymodel");let{showRunId:x}=n4(),m=async e=>{let t="query_base"===e?n||"":u,i=function(e){switch(e){case"query":return iq;case"query_base":return iH;case"query_diff":return iV;default:throw Error("Unknown query type: ".concat(e))}}(e),l={sql_template:t};"query_diff"===e&&(l.primary_keys=o,d&&(l.base_sql_template=n));let{run_id:r}=await i(l,{nowait:!0});return x(r),await ew(r)},{mutate:p,isPending:f}=(0,tw.D)({mutationFn:m});return(0,i.jsxs)(s.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(s.k,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,i.jsx)(rr,{}),(0,i.jsx)(ro,{}),(0,i.jsx)(h.L,{}),(0,i.jsx)(iZ,{defaultPrimaryKeys:o,onPrimaryKeysChange:a}),(0,i.jsx)(ed.z,{colorScheme:"blue",onClick:()=>p("query_diff"),isDisabled:f,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})]}),(0,i.jsx)(l.x,{width:"100%",flex:"1",children:d?(0,i.jsx)(t1,{value:u,baseValue:n,onChange:t,onChangeBase:r,onRun:()=>p("query"),onRunBase:()=>p("query_base"),onRunDiff:()=>p("query_diff")}):(0,i.jsx)(t0,{value:u,onChange:t,onRun:()=>p("query"),onRunDiff:()=>p("query_diff")})})]})};var ra=t(58172);let rd=e=>(0,ra.c4)("#!"+e),rc=()=>[(0,ra.LD)(()=>window.location.hash.replace(/^#!/,"")||"/",()=>"/ssr"),rd];var ru=t(98907),rh=t(55263);let rx=e=>{var n;let{runId:t}=e,{isPending:l,error:r,data:o}=(0,y.a)({queryKey:B.run(t),queryFn:async()=>ew(t)}),s=(null==o?void 0:o.type)?null===(n=n0(o.type))||void 0===n?void 0:n.RunResultView:void 0;return(0,i.jsx)(t4,{isPending:l,error:r,run:o,RunResultView:s})},rm=e=>{let{error:n,resetError:t}=e;return(0,i.jsx)(nn.M,{height:"100%",backgroundColor:"gray.50",children:(0,i.jsxs)(s.k,{p:4,direction:"column",justifyContent:"flex-start",backgroundColor:"white",border:"solid lightgray 1px",minHeight:"200px",children:[(0,i.jsx)(d.X,{width:"800px",size:"md",children:"You have encountered an error"}),(0,i.jsx)(l.x,{flex:"1",fontSize:"10pt",children:n.toString()}),(0,i.jsx)(ed.z,{justifySelf:"center",alignSelf:"center",mt:"20px",colorScheme:"blue",size:"sm",onClick:()=>{t()},children:"Reset"})]})})},rp=e=>{let{children:n}=e;return(0,i.jsx)(t2.SV,{fallback:rm,children:n})};function rf(){let e=(0,ee.p)(),n=async()=>{try{let e=await l7(),n=JSON.stringify(e,null,2),t=new Blob([n],{type:"application/json"}),i=new Date,l="recce-state-".concat((0,iR.WU)(i,"yyyy-MM-dd-HH-mm-ss"),".json");iI()(t,l)}catch(n){console.error("Export failed",n),e({title:"Export failed",description:"".concat(n),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}};return(0,i.jsx)(nI.u,{label:"Export",children:(0,i.jsx)(nK.h,{size:"sm",variant:"unstyled","aria-label":"Export state",onClick:n,icon:(0,i.jsx)(o.J,{as:i7,verticalAlign:"middle",boxSize:"16px"})})})}function rg(){return(0,i.jsx)(R.tV,{children:(0,i.jsx)(lG,{interactive:!0})})}t(94167);let rv=e=>{let{isGuideOpen:n,closeGuide:t}=e;return(0,i.jsxs)(et.u_,{isOpen:n,onClose:t,scrollBehavior:"inside",children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{maxW:"80vw",h:"80vh",children:[(0,i.jsx)(er.x,{children:"Welcome to Recce: 3 Steps to Begin"}),(0,i.jsx)(eM.o,{}),(0,i.jsx)(eo.f,{children:(0,i.jsxs)(tY.K,{spacing:4,children:[(0,i.jsxs)(tA.aV,{spacing:2,children:[(0,i.jsx)(tA.HC,{children:"Step 1: Click the model you want to check"}),(0,i.jsx)(tA.HC,{children:'Step 2: Click "Explore Change"'}),(0,i.jsx)(tA.HC,{children:'Step 3: Click "Add to Checklist"'})]}),(0,i.jsx)(nT.i,{}),(0,i.jsx)(a.E,{src:"https://datarecce.io/assets/images/onboarding/material.svg",alt:"placeholder"})]})}),(0,i.jsx)(ea.m,{children:(0,i.jsx)(ed.z,{colorScheme:"blue",onClick:t,children:"Got it!"})})]})]})};var rj=()=>{let[e,n]=(0,j.useState)(!1),{data:t,isLoading:l}=eT();return((0,j.useEffect)(()=>{if(!l&&t){let e=t.show_onboarding_guide;!localStorage.getItem("hasVisited")&&e&&(n(!0),localStorage.setItem("hasVisited","true"))}},[t,l]),l)?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(rv,{isGuideOpen:e,closeGuide:()=>{n(!1),eE()}})},ry=t(23899);t(55180);let rb=e=>{var n;let{run:t,isSelected:r,onSelectRun:a,onAddToChecklist:d,onGoToCheck:c}=e,{data:u}=(0,y.a)({queryKey:B.run(t.run_id),queryFn:async()=>await ew(t.run_id),enabled:(null==t?void 0:t.status)==="running",retry:!1}),h=(null===(n=n0(t.type))||void 0===n?void 0:n.icon)||eq.WzH,x=t.check_id;return(0,i.jsxs)(s.k,{minWidth:"200px",direction:"column",width:"100%",p:"5px 20px",cursor:"pointer",borderBottom:"solid 1px lightgray",borderLeft:"4px",borderLeftColor:r?"orange.400":"transparent",backgroundColor:r?"orange.50":"transparent",onClick:()=>{a(t.run_id)},_hover:{bg:r?"orange.50":"gray.200"},children:[(0,i.jsxs)(s.k,{onClick:()=>{},alignItems:"center",gap:"12px",children:[(0,i.jsx)(o.J,{as:h}),(0,i.jsx)(l.x,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",color:t.name?"inherit":"gray.500",fontSize:"11pt",fontWeight:"500",children:t.name||"<no name>"}),x?(0,i.jsx)(nI.u,{label:"Go to Check","aria-label":"Go to Check",children:(0,i.jsx)(es.x,{onClick:e=>{e.preventDefault(),e.stopPropagation(),c(x)},children:(0,i.jsx)(o.J,{color:"green",as:tM.FJM})})}):(0,i.jsx)(nI.u,{label:"Add to Checklist","aria-label":"Add to Checklist",children:(0,i.jsx)(es.x,{onClick:e=>{e.preventDefault(),e.stopPropagation(),ep({name:"add_to_checklist"}),d(t.run_id)},children:(0,i.jsx)(o.J,{as:tM.wO})})})]}),(0,i.jsx)(s.k,{justifyContent:"start",fontSize:"11pt",color:"gray.500",gap:"3px",alignItems:"center",children:(0,i.jsx)(iO,{run:u||t})})]})},rw=e=>{let{runAt:n}=e,t=n?function(e){let n=new Date,t=new Date;return(t.setDate(n.getDate()-1),null==e)?null:n.toDateString()===e.toDateString()?"Today":t.toDateString()===e.toDateString()?"Yesterday":(0,iR.WU)(e,"MMM d")}(new Date(n)):null;return(0,i.jsx)(s.k,{minWidth:"200px",width:"100%",p:"5px 20px",borderBottom:"solid 1px lightgray",color:"gray.500",fontSize:"11pt",children:t})},rk=()=>{let{data:e,isLoading:n,isFetching:t,error:r,refetch:o}=(0,y.a)({queryKey:B.runs(),queryFn:async()=>await eS(),retry:!1}),{showRunId:a,runId:c}=n4(),x=e=>{ep({name:"click_run"}),a(e,!1)},[,m]=(0,eN.TH)(),p=(0,b.NL)(),f=(0,j.useCallback)(async()=>{if(!c)return;let e=await te(c);p.invalidateQueries({queryKey:B.checks()}),m("/checks/".concat(e.check_id))},[c,m,p]),g=(0,j.useCallback)(e=>{ep({name:"go_to_check"}),m("/checks/".concat(e))},[m]),v=null;return(0,i.jsxs)(s.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(u.U,{width:"100%",flex:"0 0 54px",paddingInline:"24px 8px",borderBottom:"solid 1px lightgray",children:[(0,i.jsx)(d.X,{size:"md",children:"History"}),(0,i.jsx)(h.L,{}),(0,i.jsx)(nK.h,{variant:"unstyled",icon:(0,i.jsx)(tp.n,{}),"aria-label":"Search database",onClick:()=>{o()}})]}),(0,i.jsx)(l.x,{flex:"1 1 auto",children:n?"Loading...":(null==e?void 0:e.length)===0?(0,i.jsx)(nn.M,{height:"100%",color:"gray.400",children:"No runs"}):(0,i.jsx)(ry.Z,{style:{minHeight:"100%",height:0},children:(e||[]).map((e,n)=>{let t=new Date(e.run_at).toDateString(),l=null!=v&&v!==t;return v=t,(0,i.jsxs)(i.Fragment,{children:[l&&(0,i.jsx)(rw,{runAt:e.run_at},t),(0,i.jsx)(rb,{run:e,isSelected:e.run_id===c,onSelectRun:x,onGoToCheck:g,onAddToChecklist:f},e.run_id)]})})})})]})};var rC=t(45828),r_=t(12415);let{definePartsStyle:rS,defineMultiStyleConfig:rz}=(0,r_.D)(rC.TB.keys),rR=rz({variants:{circular:rS({control:(0,r_.k0)({rounded:"full"})})},sizes:{xs:rS({icon:(0,r_.k0)({fontSize:"8px"}),control:(0,r_.k0)({boxSize:"16px",padding:"4px"}),label:(0,r_.k0)({fontSize:"xs"})})}}),rE=(0,t(2809).fj)({baseStyle:{borderRadius:"4px"}});var rI=t(25301);let rT=()=>{let e=(0,ee.p)();return{toastSuccess:n=>{e({description:n,status:"success",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0})},toastError:(n,t)=>{var i,l;e({description:t?t instanceof lS.d7?"".concat(n,". ").concat(null==t?void 0:null===(l=t.response)||void 0===l?void 0:null===(i=l.data)||void 0===i?void 0:i.detail):"".concat(n,". ").concat(t):"".concat(n),status:"error",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0})}}},rL=e=>{(0,j.useEffect)(()=>{let n=e=>{e.preventDefault()};return e&&window.addEventListener("beforeunload",n),()=>{e&&window.removeEventListener("beforeunload",n)}},[e])},rD=()=>{let{fileName:e,cloudMode:n,isDemoSite:t,isLoading:r}=eO(),a=(0,en.q)(),d=(0,en.q)(),c=!e&&!n&&!t,{data:u}=(0,y.a)({queryKey:B.checks(),queryFn:tn,enabled:c}),h=void 0!=u&&u.filter(e=>!e.is_preset).length>0;rL(c&&h);let[{newFileName:x,errorMessage:m,modified:p,overwriteWithMethod:f,bypass:g},v]=(0,j.useState)({newFileName:e||"recce_state.json"}),w=(0,j.useRef)(null),{toastSuccess:k,toastError:C}=rT(),_=(0,b.NL)(),S=async(e,n)=>{if(!x)return;let t="true"===localStorage.getItem(i$.bypassSaveOverwrite);try{"save"===e?await l9({filename:x,overwrite:n||t}):await l8({filename:x,overwrite:n||t}),k("save"===e?"Save file successfully":"Rename file successfully"),_.invalidateQueries({queryKey:B.lineage()}),g&&localStorage.setItem(i$.bypassSaveOverwrite,"true")}catch(n){if(n instanceof lS.d7){var i;if((null===(i=n.response)||void 0===i?void 0:i.status)===409){v(n=>({...n,overwriteWithMethod:e})),d.onOpen();return}}C("save"===e?"Save file failed":"Rename file failed",n)}finally{a.onClose()}};return n||t?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.k,{flex:"1",justifyContent:"center",alignItems:"center",children:[(0,i.jsx)(l.x,{fontWeight:"600",children:e||(n?"cloud":"New Instance"+(h?" (unsaved)":""))}),(0,i.jsx)(nI.u,{label:e?"Change Filename":"Save",openDelay:1e3,children:(0,i.jsx)(nK.h,{onClick:()=>{v({newFileName:e||"recce_state.json",modified:!e}),a.onOpen()},"aria-label":"",variant:"unstyled",size:"sm",children:(0,i.jsx)(o.J,{as:e?lt:ln,boxSize:"16px",verticalAlign:"middle"})})})]}),(0,i.jsxs)(et.u_,{isOpen:a.isOpen,onClose:a.onClose,isCentered:!0,children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{children:[(0,i.jsx)(er.x,{children:e?"Change Filename":"Save File"}),(0,i.jsx)(eM.o,{}),(0,i.jsx)(eo.f,{onKeyDown:e=>{e.stopPropagation()},children:(0,i.jsxs)(eH.NI,{isInvalid:!!m,children:[(0,i.jsx)(eV.l,{children:"File name:"}),(0,i.jsx)(nq.I,{ref:w,value:x,placeholder:"Enter filename",onChange:n=>{let t;let i=n.target.value;i?i.endsWith(".json")?/^[a-zA-Z0-9 _-]+\.json$/.test(i)?e&&i===e&&(t="Filename is the same as the current one."):t="Invalid filename. Only alphanumeric, space, _ and - are allowed.":t="Filename must end with .json.":t="Filename cannot be empty.",v(e=>({...e,modified:!0,newFileName:i,errorMessage:t}))},onKeyDown:n=>{"Enter"===n.key?m||(e?S("rename"):S("save")):"Escape"===n.key&&a.onClose()}}),(0,i.jsx)(rI.J1,{children:m})]})}),(0,i.jsxs)(ea.m,{gap:"5px",children:[(0,i.jsx)(ed.z,{size:"sm",colorScheme:e?void 0:"blue",onClick:()=>{S("save")},isDisabled:!x||!!m||!p,children:e?"Save as New File":"Confirm"}),e&&(0,i.jsx)(ed.z,{size:"sm",colorScheme:"blue",onClick:()=>{S("rename")},isDisabled:!x||!!m||!p,children:"Rename"})]})]})]}),(0,i.jsxs)(et.u_,{isOpen:d.isOpen,onClose:d.onClose,initialFocusRef:w,isCentered:!0,children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{children:[(0,i.jsx)(er.x,{children:"Overwrite File?"}),(0,i.jsx)(eM.o,{}),(0,i.jsxs)(eo.f,{borderTop:"solid 1px lightgray",borderBottom:"solid 1px lightgray",onKeyDown:e=>{e.stopPropagation()},children:[(0,i.jsx)(l.x,{fontSize:"12pt",children:"save"===f?"Saving a file with this name will overwrite the existing file. Are you sure you wish to continue?":"Renaming the file with this name will overwrite the existing file. Are you sure you wish to continue?"}),(0,i.jsx)(nv.X,{isChecked:g,onChange:e=>v(n=>({...n,bypass:e.target.checked})),fontWeight:"bold",size:"sm",pt:"8px",children:"Don't show this again"})]}),(0,i.jsxs)(ea.m,{gap:"5px",children:[(0,i.jsx)(ed.z,{variant:"outline",onClick:()=>{d.onClose(),a.onOpen(),v(e=>({...e,overwriteWithMethod:void 0}))},size:"sm",children:"Back"}),(0,i.jsx)(ed.z,{size:"sm",colorScheme:"blue",onClick:()=>{f&&(S(f,!0),d.onClose())},children:"Overwrite"})]})]})]})]})};var rO=t(68883),rA=t(16375);function rM(){return(0,i.jsx)(nI.u,{label:"Syncing",children:(0,i.jsx)(ed.z,{pt:"6px",variant:"unstyled",boxSize:"1em",children:(0,i.jsx)(t3.$,{})})})}function rF(){let[e,n]=(0,j.useState)(!1),t=(0,b.NL)(),[r,s]=(0,eN.TH)(),{isOpen:a,onOpen:d,onClose:c}=(0,en.q)(),[u,h]=(0,j.useState)(""),x=(0,ee.p)(),m=(0,j.useCallback)(async e=>{if(c(),n(!0),"conflict"===(await rt(e)).status){d(),n(!1);return}for(;await rn();)await new Promise(e=>setTimeout(e,1e3));x({description:"Sync Completed",status:"success",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0}),n(!1),h(""),t.invalidateQueries({queryKey:B.lineage()}),t.invalidateQueries({queryKey:B.checks()}),t.invalidateQueries({queryKey:B.runs()}),/^\/checks\/([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/.test(r)&&s("/checks")},[t,r,s,x,d,c]);return e?(0,i.jsx)(rM,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nI.u,{label:"Sync with Cloud",children:(0,i.jsx)(nK.h,{size:"sm",variant:"unstyled","aria-label":"Sync state",onClick:()=>m({}),icon:(0,i.jsx)(o.J,{as:i8,verticalAlign:"middle",boxSize:"16px"})})}),(0,i.jsxs)(et.u_,{isOpen:a,onClose:c,children:[(0,i.jsx)(ei.Z,{}),(0,i.jsxs)(el.h,{children:[(0,i.jsx)(er.x,{fontSize:"lg",fontWeight:"bold",children:"Sync with Cloud"}),(0,i.jsxs)(eo.f,{children:[(0,i.jsx)(l.x,{children:"New changes have been detected in the cloud. Please choose a method to sync your state"}),(0,i.jsx)(l.x,{mt:"5px",children:(0,i.jsx)(rO.E,{onChange:h,value:u,children:(0,i.jsxs)(tY.K,{direction:"column",children:[(0,i.jsxs)(rA.Y,{value:"merge",children:["Merge",(0,i.jsx)(nI.u,{label:"This will merge the local and remote states.",children:(0,i.jsx)("span",{children:(0,i.jsx)(o.J,{as:lT.h,ml:2,cursor:"pointer"})})})]}),(0,i.jsxs)(rA.Y,{value:"overwrite",children:["Overwrite",(0,i.jsx)(nI.u,{label:"This will overwrite the remote state file with the local state.",children:(0,i.jsx)("span",{children:(0,i.jsx)(o.J,{as:lT.h,ml:2,cursor:"pointer"})})})]}),(0,i.jsxs)(rA.Y,{value:"revert",children:["Revert",(0,i.jsx)(nI.u,{label:"This will discard local changes and revert to the cloud state.",children:(0,i.jsx)("span",{children:(0,i.jsx)(o.J,{as:lT.h,ml:2,cursor:"pointer"})})})]})]})})})]}),(0,i.jsxs)(ea.m,{children:[(0,i.jsx)(ed.z,{onClick:c,mr:3,children:"Cancel"}),(0,i.jsx)(ed.z,{colorScheme:"blue",onClick:()=>m({method:u}),isDisabled:!u,children:"Sync"})]})]})]})]})}let rN=e=>{let{children:n,path:t}=e,[r]=(0,eN.yj)(t);return(0,i.jsx)(l.x,{display:r?"block":"none",height:"100%",children:n})};function rq(e){let{icon:n,href:t,...l}=e;return(0,i.jsx)(r.r,{height:"20px",color:"white",href:t,isExternal:!0,...l,children:(0,i.jsx)(o.J,{color:"white",boxSize:"20px",as:n})})}function rH(){let{reviewMode:e,isDemoSite:n,envInfo:t,cloudMode:x,isLoading:m}=eO(),p=function(){let[e,n]=(0,j.useState)("");return(0,j.useEffect)(()=>{(async function(){try{let e=await X.get("/api/version");n(e.data)}catch(e){console.error("Error fetching version number:",e)}})()},[]),e}(),{url:f,id:g}=(null==t?void 0:t.pullRequest)||{},v=f?f.split("/").pop():null;return(0,i.jsxs)(s.k,{gap:"10px",minHeight:"40px",alignItems:"center",bg:"rgb(255, 110, 66)",children:[(0,i.jsx)(a.E,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,i.jsx)(d.X,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,i.jsx)(c.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:p}),e&&(0,i.jsx)(c.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:"review mode"}),x&&(0,i.jsx)(c.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:(0,i.jsxs)(u.U,{children:[(0,i.jsx)(l.x,{children:"cloud mode"}),(0,i.jsx)(l.x,{borderLeft:"1px",borderLeftColor:"whiteAlpha.500",paddingLeft:"8px",children:(0,i.jsxs)(r.r,{href:f,_hover:{textDecoration:"none"},isExternal:!0,children:[(0,i.jsx)(o.J,{as:nr.X9P,boxSize:"3",fontWeight:"extrabold",strokeWidth:"1"})," #".concat(g)]})})]})}),n&&f&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(c.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:(0,i.jsxs)(u.U,{children:[(0,i.jsx)(l.x,{children:"demo mode"}),(0,i.jsx)(l.x,{borderLeft:"1px",borderLeftColor:"whiteAlpha.500",paddingLeft:"8px",children:(0,i.jsxs)(r.r,{href:f,_hover:{textDecoration:"none"},isExternal:!0,children:[(0,i.jsx)(o.J,{as:nr.X9P,boxSize:"3",fontWeight:"extrabold",strokeWidth:"1"})," #".concat(v)]})})]})})}),(0,i.jsx)(h.L,{}),(0,i.jsx)(rq,{icon:tM.hJX,href:"https://github.com/DataRecce/recce"}),(0,i.jsx)(rq,{icon:tM.w5k,href:"https://getdbt.slack.com/archives/C05C28V7CPP"}),(0,i.jsx)(rq,{mr:"18px",icon:tM.MXt,href:"https://datarecce.io/docs"})]})}function rV(e){let{queryKey:n,fetchCallback:t,selectCallback:r}=e,{data:o,isLoading:s,error:a}=(0,y.a)({queryKey:n,queryFn:t,select:r});return s||a||0===o?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(l.x,{ml:"2px",height:"80%",aspectRatio:1,borderRadius:"full",bg:"tomato",alignContent:"center",color:"white",fontSize:"xs",children:o})}function rP(){let{isDemoSite:e,reviewMode:n,fileMode:t,cloudMode:r,isLoading:o}=eO(),[a,d]=(0,eN.TH)(),{data:c,isLoading:u}=eT(),h=(0,i.jsx)(rV,{queryKey:B.checks(),fetchCallback:tn,selectCallback:e=>e.filter(e=>!e.is_checked).length}),f=[{name:"Lineage",href:"/lineage"},{name:"Query",href:"/query",disable:(null==c?void 0:c.single_env_onboarding)===!0},{name:"Checklist",href:"/checks",badge:h,disable:(null==c?void 0:c.single_env_onboarding)===!0}],g=eK().findIndex(f,e=>{let{href:n}=e;return a.startsWith(n)});return(0,i.jsx)(x.m,{index:g,children:(0,i.jsxs)(m.t,{children:[(0,i.jsx)(l.x,{flex:"1",display:"flex",children:f.map(e=>{let{name:n,href:t,badge:l,disable:r}=e;return(0,i.jsxs)(p.O,{onClick:()=>{d(t)},isDisabled:o||u||r,hidden:r,children:[n,l]},n)})}),!o&&!e&&(0,i.jsx)(rD,{}),!o&&(0,i.jsxs)(s.k,{flex:"1",justifyContent:"right",alignItems:"center",mr:"8px",children:[r&&(0,i.jsx)(rF,{}),(0,i.jsx)(rf,{}),(0,i.jsx)(lo,{})]})]})})}function rW(){let{isRunResultOpen:e,isHistoryOpen:n,closeRunResult:t}=n4(),{data:r}=eT(),[o]=(0,eN.TH)(),s=n&&!o.startsWith("/checks");return(0,i.jsxs)(tD,{sizes:[0,100],minSize:s?300:0,gutterSize:s?5:0,style:{height:"100%"},children:[(0,i.jsx)(l.x,{style:{contain:"size"},children:s&&(0,i.jsx)(rk,{})}),(0,i.jsxs)(tO,{sizes:e?[50,50]:[100,0],minSize:e?100:0,gutterSize:e?5:0,style:{flex:"1",contain:"size"},children:[(0,i.jsx)(l.x,{p:0,style:{contain:"content"},children:(0,i.jsxs)(rp,{children:[(0,i.jsx)(rN,{path:"/lineage",children:(0,i.jsx)(rg,{})}),(0,i.jsxs)(eN.rs,{children:[(0,i.jsx)(eN.AW,{path:"/query",children:(0,i.jsx)(rs,{})}),(0,i.jsx)(eN.AW,{path:"/checks/:slug*",children:(0,i.jsx)(rl,{})}),(0,i.jsx)(eN.AW,{path:"/runs/:runId",children:e=>{let{runId:n}=e;return(0,i.jsx)(rx,{runId:n})}}),(0,i.jsx)(eN.AW,{path:"/ssr",children:(0,i.jsx)(f.E,{size:"xs",isIndeterminate:!0})}),(0,i.jsx)(eN.AW,{children:(0,i.jsx)(eN.l_,{to:"/lineage"})})]})]})}),e?(0,i.jsx)(iF,{onClose:t,disableAddToChecklist:null!=r&&!!r.single_env_onboarding}):(0,i.jsx)(l.x,{})]})]})}let rK=(0,g.B1)({components:{Checkbox:rR,Tooltip:rE}});function rB(){(0,j.useLayoutEffect)(()=>{!function(){var e;let n=(e=document.cookie.match("(^|;)\\s*recce_user_id\\s*=\\s*([^;]+)"))?e.pop():"",t=ex.env.AMPLITUDE_API_KEY;if(n&&t)try{eh.S1(t,n,{defaultTracking:!0})}catch(e){console.error(e)}}()},[]);let e=(0,ru.Z)({components:{MuiTooltip:{styleOverrides:{tooltip:{zIndex:1500}}}}});return(0,i.jsx)(rh.Z,{theme:e,children:(0,i.jsx)(v.x,{theme:rK,children:(0,i.jsx)(b.aH,{client:G,children:(0,i.jsx)(eN.F0,{hook:rc,children:(0,i.jsx)(n8,{children:(0,i.jsxs)(s.k,{direction:"column",height:"100vh",overflow:"hidden",children:[(0,i.jsx)(rH,{}),(0,i.jsx)(rP,{}),(0,i.jsx)(rj,{}),(0,i.jsx)(rW,{})]})})})})})})}},92075:function(){},74229:function(){},54351:function(){},57920:function(){}},function(e){e.O(0,[32,524,434,678,509,648,989,147,995,739,283,303,22,25,355,495,599,852,771,95,312,744],function(){return e(e.s=53770)}),_N_E=e.O()}]);