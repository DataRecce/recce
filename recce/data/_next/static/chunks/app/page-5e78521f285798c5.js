(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{99178:function(e,t,r){Promise.resolve().then(r.bind(r,54661))},54661:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Home}});var n=r(757);r(91702);var o=r(27726),l=r(52116),i=r(99691),a=r(83978),s=r.n(a);r(7866);var d=r(55528),c=r(10126),u=r(29330),h=r(11180);function _getPrimaryKeyValue(e,t){let r={};for(let n of t)r[n]=e[n];return JSON.stringify(r)}function DataFrameColumnGroupHeader(e){let{name:t,primaryKeys:r,onPrimaryKeyChange:o}=e;return"index"===t?(0,n.jsx)(n.Fragment,{}):r.includes(t)?(0,n.jsxs)(d.k,{alignItems:"center",children:[(0,n.jsx)(c.xu,{flex:1,children:t}),(0,n.jsx)(u.J,{cursor:"pointer",as:h.ven,onClick:()=>{let e=r.filter(e=>e!==t);o&&o(e)}})]}):(0,n.jsxs)(d.k,{alignItems:"center",children:[(0,n.jsx)(c.xu,{flex:1,children:t}),(0,n.jsx)(u.J,{cursor:"pointer",as:h.MhP,onClick:()=>{let e=[...r.filter(e=>"index"!==e),t];o&&o(e)}})]})}function toDataGrid(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0,i={schema:{fields:[],primaryKey:[]},data:[]};if(!e&&t)e=i,0===r.length&&(r=t.schema.primaryKey);else if(!t&&e)t=i,0===r.length&&(r=e.schema.primaryKey);else{if(!e||!t)return{rows:[],columns:[]};if(!s().isEqual(e.schema.primaryKey,t.schema.primaryKey))throw Error("primary key mismatch! ".concat(e.schema.primaryKey," != ").concat(t.schema.primaryKey));0===r.length&&(r=e.schema.primaryKey)}let a=[],d=[],c={},u={};t.schema.fields.forEach(e=>{c[e.name]={},c[e.name].current=e}),e.schema.fields.forEach(e=>{c[e.name]||(c[e.name]={}),c[e.name].base=e}),Object.entries(c).forEach(e=>{let[t,{base:i,current:c}]=e;if(r.includes(t))d.push({key:"".concat(t),name:(0,n.jsx)(DataFrameColumnGroupHeader,{name:t,primaryKeys:r,onPrimaryKeyChange:o}),frozen:!0});else{if("index"===t)return;let cellClass=e=>{if(!s().isEqual(e["base__".concat(t)],e["current__".concat(t)]))return"diff-cell"};a.push({name:(0,n.jsx)(DataFrameColumnGroupHeader,{name:t,primaryKeys:r,onPrimaryKeyChange:o}),children:[{key:"base__".concat(t),name:"Base",renderEditCell:l.Ug,cellClass},{key:"current__".concat(t),name:"Current",renderEditCell:l.Ug,cellClass}]})}}),t.data.forEach(e=>{let t=_getPrimaryKeyValue(e,r);u[t]={},u[t].current=e}),e.data.forEach(e=>{let t=_getPrimaryKeyValue(e,r);u[t]||(u[t]={}),u[t].base=e});let h=Object.entries(u).map(e=>{let[t,{base:n,current:o}]=e,l=JSON.parse(t);return n&&Object.keys(n).forEach(e=>{r.includes(e)||(l["base__".concat(e)]=n[e])}),o&&Object.keys(o).forEach(e=>{r.includes(e)||(l["current__".concat(e)]=o[e])}),l});return{columns:[...d,...a],rows:h}}var m=r(76920),f=r(46543),g=r(93683),p=r(7873),x=r(62130),y=r(29357),query_SqlEditor=e=>{let{value:t,onChange:r,onRun:l,...i}=e;return(0,o.useRef)(null),(0,n.jsx)(y.ZP,{language:i.language||"sql",theme:i.theme||"vs",value:t,onChange:e=>{void 0!==e&&r(e)},onMount:(e,t)=>{e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.Enter,l)},options:{tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent"}})},v=r(71790),b=r(10929),j=r(12218);let C=j.env.NEXT_PUBLIC_API_URL||"";var w=r(13164);let k=b.default.create({baseURL:C}),E=new w.S;async function runQuery(e){let t=await k.post("/api/query",e);return t.data}function useRunQuery(e){return(0,v.a)({queryKey:["query",e.base],queryFn:()=>runQuery(e),retry:!1,enabled:!1})}let S='select * from {{ ref("mymodel") }}',_=(0,o.createContext)({sqlQuery:S,setSqlQuery:()=>{}});function RecceQueryContextProvider(e){let{children:t}=e,[r,l]=o.useState(S);return(0,n.jsx)(_.Provider,{value:{setSqlQuery:l,sqlQuery:r},children:t})}let useRecceQueryContext=()=>(0,o.useContext)(_),QueryViewDataGrid=e=>{let{loading:t,baseError:r,currentError:o,columns:a,rows:s}=e,c=r&&!o||!r&&o,getErrorMessage=e=>{if(!(e instanceof i.d7))return null==e?void 0:e.message;{var t,r;let n=null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.detail;return n||(null==e?void 0:e.message)}};return t?(0,n.jsxs)(m.M,{p:"16px",height:"100%",children:[(0,n.jsx)(f.$,{size:"sm",mr:"8px"}),"Loading..."]}):r&&o?(0,n.jsxs)(g.b,{status:"error",children:[(0,n.jsx)(p.z,{}),"Error: ",getErrorMessage(o)]}):0===a.length?(0,n.jsx)(m.M,{height:"100%",children:"No data"}):(0,n.jsxs)(d.k,{direction:"column",height:"100%",overflow:"auto",children:[c&&(0,n.jsxs)(g.b,{status:"error",children:[(0,n.jsx)(p.z,{}),r&&"Error[Base]: ".concat(getErrorMessage(r)),o&&"Error[Current]: ".concat(getErrorMessage(o))]}),(0,n.jsx)(l.ZP,{style:{height:"100%"},columns:a,rows:s,defaultColumnOptions:{resizable:!0,maxWidth:800,width:100},className:"rdg-light"})]})};var query_QueryView=()=>{let{sqlQuery:e,setSqlQuery:t}=useRecceQueryContext(),{data:r,refetch:l,...i}=useRunQuery({sql_template:e,base:!0}),{data:a,refetch:s,...u}=useRunQuery({sql_template:e,base:!1}),[h,m]=(0,o.useState)([]),f=(0,o.useCallback)(()=>{m([]),l(),s()},[l,s]),g=i.isFetching||u.isFetching,p=(0,o.useMemo)(()=>g?{rows:[],columns:[]}:toDataGrid(r,a,h,e=>{m(e)}),[r,a,g,h]);return(0,n.jsxs)(d.k,{direction:"column",height:"calc(100vh - 42px)",children:[(0,n.jsx)(d.k,{justifyContent:"right",padding:"5px",children:(0,n.jsx)(x.z,{colorScheme:"blue",onClick:f,isDisabled:g,size:"sm",children:"Run"})}),(0,n.jsx)(c.xu,{flex:"1",border:"1px solid #CBD5E0",height:"200px",width:"100%",children:(0,n.jsx)(query_SqlEditor,{language:"sql",theme:"vs",value:e,onChange:e=>t(e),onRun:()=>f()})}),(0,n.jsx)(c.xu,{backgroundColor:"gray.100",height:"50vh",children:(0,n.jsx)(QueryViewDataGrid,{loading:g,baseError:i.error,currentError:u.error,rows:p.rows,columns:p.columns})})]})},L=r(14612);function getNeighborSet(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,n=new Set,o={},dfs=(e,r)=>{if(r<0||void 0!==o[e]&&o[e]>=r)return;o[e]=r;let l=t(e);for(let e of l)dfs(e,r-1);n.add(e)};for(let t of e)dfs(t,r);return n}function buildDefaultLineageGraphSets(e,t){function buildAllLineageGraph(e,t){let r={},n={},buildNode=(e,t)=>({id:e,name:e,data:{},from:t,parents:{},children:{}});for(let[t,n]of Object.entries(e.parent_map)){r[t]=buildNode(t,"base");let n=e.nodes&&e.nodes[t];n&&(r[t].data.base=n,r[t].name=null==n?void 0:n.name,r[t].resourceType=null==n?void 0:n.resource_type,r[t].packageName=null==n?void 0:n.package_name)}for(let[e,n]of Object.entries(t.parent_map)){r[e]?r[e].from="both":r[e]=buildNode(e,"current");let n=t.nodes&&t.nodes[e];n&&(r[e].data.current=t.nodes&&t.nodes[e],r[e].name=null==n?void 0:n.name,r[e].resourceType=null==n?void 0:n.resource_type,r[e].packageName=null==n?void 0:n.package_name)}for(let[t,o]of Object.entries(e.parent_map))for(let e of o){let o=r[t],l=r[e],i="".concat(e,"_").concat(t);n[i]={id:i,from:"base",parent:l,child:o};let a=n[i];o.parents[e]=a,l.children[t]=a}for(let[e,o]of Object.entries(t.parent_map))for(let t of o){let o=r[e],l=r[t],i="".concat(t,"_").concat(e);n[i]?n[i].from="both":n[i]={id:i,from:"current",parent:l,child:o};let a=n[i];o.parents[t]=a,l.children[e]=a}return{edges:n,nodes:r}}function buildChangedOnlyLineageGraph(e,t){let r={},n={};function union(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=new Set;return t.forEach(e=>{e.forEach(e=>{n.add(e)})}),n}let o=selectDownstream(e,t),l=selectUpstream(e,t,1),i=union(o,l);return Object.entries(e.nodes).forEach(e=>{let[t,n]=e;i.has(t)&&(r[t]=n)}),Object.entries(e.edges).forEach(e=>{let[t,r]=e;i.has(r.parent.id)&&i.has(r.child.id)&&(n[t]=r)}),{nodes:r,edges:n}}let{nodes:r,edges:n}=buildAllLineageGraph(e,t),o=[];for(let[e,t]of Object.entries(r))if("base"===t.from)t.changeStatus="removed",o.push(t.id);else if("current"===t.from)t.changeStatus="added",o.push(t.id);else{var l,i,a,s,d,c;let e=null==t?void 0:null===(a=t.data)||void 0===a?void 0:null===(i=a.base)||void 0===i?void 0:null===(l=i.checksum)||void 0===l?void 0:l.checksum,r=null==t?void 0:null===(c=t.data)||void 0===c?void 0:null===(d=c.current)||void 0===d?void 0:null===(s=d.checksum)||void 0===s?void 0:s.checksum;e&&r&&e!==r&&(t.changeStatus="modified",o.push(t.id))}for(let[e,t]of Object.entries(n))"base"===t.from?t.changeStatus="removed":"current"===t.from&&(t.changeStatus="added");return{all:{nodes:r,edges:n},changed:buildChangedOnlyLineageGraph({nodes:r,edges:n},o),modifiedSet:o}}function selectUpstream(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(t,t=>void 0===e.nodes[t]?[]:Object.keys(e.nodes[t].parents),r)}function selectDownstream(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(t,t=>void 0===e.nodes[t]?[]:Object.keys(e.nodes[t].children),r)}function toReactflow(e,t){let r=[],n=[];for(let[t,n]of Object.entries(e.nodes))r.push({id:n.id,position:{x:0,y:0},data:n,type:"customNode",targetPosition:L.Ly.Left,sourcePosition:L.Ly.Right});for(let[t,r]of Object.entries(e.edges))n.push({id:r.id,type:"customEdge",source:r.parent.id,target:r.child.id,data:r});return highlightPath(e,t,r,n,null)}function highlightPath(e,t,r,n,o){function union(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=new Set;return t.forEach(e=>{e.forEach(e=>{n.add(e)})}),n}let l=null!==o?union(selectUpstream(e,[o]),selectDownstream(e,[o])):getNeighborSet(t,t=>void 0===e.nodes[t]?[]:Object.keys(e.nodes[t].children)),i=new Set(n.filter(e=>l.has(e.source)&&l.has(e.target)).map(e=>e.id)),a=r.map(e=>({...e,data:{...e.data,isHighlighted:l.has(e.id)}})),s=n.map(e=>({...e,data:{...e.data,isHighlighted:i.has(e.id)}}));return[a,s]}var O=r(81108),N=r(43093),I=r(77968),R=r(49473),P=r(16524),T=r(93864),K=r.n(T);r(38247);var z=r(63240),q=r(54057);let G=h.Nbv,D=h.sFB,V=h.UGs;function getIconForChangeStatus(e){return"added"===e?{color:"#1dce00",icon:G}:"removed"===e?{color:"#ff4444",icon:D}:"modified"===e?{color:"#ffa502",icon:V}:{color:"inherit",icon:void 0}}function getIconForResourceType(e){return"model"===e?{color:"#c0eafd",icon:z.Fn3}:"metric"===e?{color:"#ffe6ee",icon:q._MV}:"source"===e?{color:"#a6dda6",icon:z.i1q}:"exposure"===e?{color:"#ffe6ee",icon:q.n8P}:"semantic_model"===e?{color:"#fb8caf",icon:q.R1C}:"seed"===e?{color:"#a6dda6",icon:z.tWi}:{color:"inherit",icon:void 0}}function GraphNode(e){var t,r;let o,{data:l}=e,{isHighlighted:i,resourceType:a,changeStatus:s}=l,h=(0,L.oR)(e=>e.transform[2]>.3),{icon:m}=getIconForResourceType(a),f="gray.400",g="solid";s&&(o=getIconForChangeStatus(s).icon,f=getIconForChangeStatus(s).color);let p=f,x=null==l?void 0:l.name;return(0,n.jsx)(O.u,{label:"model"===a?x:"".concat(x," (").concat(a,")"),placement:"top",children:(0,n.jsxs)(d.k,{width:"300px",_hover:{backgroundColor:h?"gray.100":f},borderColor:p,borderWidth:1,borderStyle:g,backgroundColor:h?"white":f,borderRadius:3,boxShadow:"unset",padding:0,className:!0===i?"node-highlight":!1===i?"node-unhighlight":void 0,children:[(0,n.jsx)(d.k,{backgroundColor:f,padding:2,borderRightWidth:1,borderColor:p,borderStyle:g,alignItems:"top",visibility:h?"inherit":"hidden",children:(0,n.jsx)(u.J,{as:m})}),(0,n.jsx)(d.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:(0,n.jsxs)(d.k,{width:"100%",textAlign:"left",flex:"1",p:1,alignItems:"center",visibility:h?"inherit":"hidden",children:[(0,n.jsx)(c.xu,{flex:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:x}),o&&(0,n.jsx)(d.k,{children:(0,n.jsx)(u.J,{color:f,as:o,flex:"0 0 20px"})})]})}),Object.keys(null!==(t=null==l?void 0:l.parents)&&void 0!==t?t:{}).length>0&&(0,n.jsx)(L.HH,{type:"target",position:L.Ly.Left,isConnectable:!1}),Object.keys(null!==(r=null==l?void 0:l.children)&&void 0!==r?r:{}).length>0&&(0,n.jsx)(L.HH,{type:"source",position:L.Ly.Right,isConnectable:!1})]})})}function GraphEdge(e){let{sourceX:t,sourceY:r,targetX:o,targetY:l,sourcePosition:i,targetPosition:a,style:s={},markerEnd:d,data:c}=e,u={...s};(null==c?void 0:c.changeStatus)&&(u.stroke=getIconForChangeStatus(null==c?void 0:c.changeStatus).color,u.strokeDasharray="5"),(null==c?void 0:c.isHighlighted)===!1&&(u.filter="opacity(0.2) grayscale(50%)");let[h]=(0,L.OQ)({sourceX:t,sourceY:r,sourcePosition:i,targetX:o,targetY:l,targetPosition:a});return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(L.u5,{path:h,markerEnd:d,style:{...u,...s}})})}r(88727);var F=r(74796),H=r(28478),M=r(79315),Q=r(2593),A=r(55344),U=r(1726),W=r(83622),B=r(21801),J=r(29731),Z=r(90593),Y=r(49981);function mergeKeys(e,t){let r=[...e],n=[...t],o=[];for(;r.length>0&&n.length>0;)if(o.includes(r[0]))r.shift();else if(o.includes(n[0]))n.shift();else if(r[0]===n[0])o.push(r[0]),r.shift(),n.shift();else if(n.includes(r[0])){let e=n.indexOf(r[0]);for(let t=0;t<e;t++)o.includes(n[t])||o.push(n[t]);o.push(r[0]),r.shift(),n.splice(0,e+1)}else o.push(r[0]),r.shift();return r.forEach(e=>{o.includes(e)||o.push(e)}),n.forEach(e=>{o.includes(e)||o.push(e)}),o}function mergeKeysWithStatus(e,t){let r=mergeKeys(e,t),n={};for(let o of r)e.includes(o)?t.includes(o)?n[o]=void 0:n[o]="removed":n[o]="added";let o={};e.forEach((e,t)=>{o[e]=t});let l=-1;for(let e of r){let t=o[e];void 0!==t&&(t>l?l=t:n[e]="reordered")}return n}function mergeColumns(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={},n=mergeKeysWithStatus(Object.keys(e),Object.keys(t));return Object.entries(n).forEach(e=>{let[t,n]=e;r[t]={name:t,reordered:"reordered"===n}}),Object.entries(e).map((e,t)=>{let[n,o]=e;r[n].baseIndex=t+1,r[n].baseType=o.type}),Object.entries(t).map((e,t)=>{let[n,o]=e;r[n].currentIndex=t+1,r[n].currentType=o.type}),r}function schema_toDataGrid(e){function columnIndexCellClass(e){return void 0===e.baseIndex?"column-index-added":void 0===e.currentIndex?"column-index-removed":!0===e.reordered?"column-index-reordered":"column-index-normal"}function columnNameCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":!0===e.reordered?"column-body-reordered":"column-body-normal"}function columnTypeCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":e.baseType!==e.currentType?"column-body-type-changed":!0===e.reordered?"column-body-reordered":"column-body-normal"}let t=Object.values(e);return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"currentIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"name",name:"Name",resizable:!0,cellClass:columnNameCellClass},{key:"baseType",name:"Base Type",resizable:!0,cellClass:columnTypeCellClass},{key:"currentType",name:"Current Type",resizable:!0,cellClass:columnTypeCellClass}],rows:t}}function SchemaView(e){let t,{base:r,current:i}=e,{columns:a,rows:s}=(0,o.useMemo)(()=>schema_toDataGrid(mergeColumns(null==r?void 0:r.columns,null==i?void 0:i.columns)),[r,i]),c=r&&void 0===r.columns,u=i&&void 0===i.columns;return c&&u?t="catalog.json is missing on both current and base environments.":c?t="catalog.json is missing on base environment.":u&&(t="catalog.json is missing on current environment."),(0,n.jsxs)(d.k,{direction:"column",children:[t&&(0,n.jsxs)(g.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,n.jsx)(p.z,{}),t]}),s.length>0&&(0,n.jsx)(l.ZP,{style:{height:"100%",fontSize:"10pt",borderWidth:1,overflowY:"auto"},columns:a,rows:s,className:"rdg-light"})]})}function NodeView(e){let{node:t,onClose:r}=e,o=(0,Y.useRouter)(),{setSqlQuery:l}=useRecceQueryContext(),i="model"===t.resourceType||"seed"===t.resourceType||"source"===t.resourceType;return(0,n.jsxs)(F.r,{height:"100%",templateRows:"auto 1fr",children:[(0,n.jsxs)(H.U,{children:[(0,n.jsxs)(c.xu,{flex:"0 0 88%",p:"16px",children:[(0,n.jsx)(M.X,{size:"sm",children:t.name}),(0,n.jsx)(c.xu,{color:"gray",children:t.resourceType})]}),(0,n.jsx)(c.xu,{flex:"0 0 10%",p:"16px",children:(0,n.jsx)(Q.P,{onClick:r})})]}),i&&(0,n.jsxs)(A.m,{overflow:"auto",as:d.k,children:[(0,n.jsx)(U.t,{children:(0,n.jsx)(W.O,{children:"Columns"})}),(0,n.jsx)(B.n,{overflow:"auto",height:"calc(100% - 42px)",children:(0,n.jsx)(J.x,{p:0,overflowY:"auto",height:"100%",children:(0,n.jsx)(SchemaView,{base:t.data.base,current:t.data.current})})})]}),"model"===t.resourceType&&(0,n.jsxs)(H.U,{p:"16px",children:[(0,n.jsx)(Z.L,{}),(0,n.jsx)(x.z,{colorScheme:"blue",size:"sm",onClick:()=>{l('select * from {{ ref("'.concat(t.name,'") }}')),o.push("/#query")},children:"Query"})]})]})}r(75165);let layout=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR",n=new(K()).graphlib.Graph;n.setDefaultEdgeLabel(()=>({})),n.setGraph({rankdir:r}),e.forEach(e=>{n.setNode(e.id,{width:300,height:36})}),t.forEach(e=>{n.setEdge(e.source,e.target)}),K().layout(n),e.forEach(e=>{let t=n.node(e.id);return e.position={x:t.x-150,y:t.y-18},e})},$={customNode:GraphNode},X={customEdge:GraphEdge},nodeColor=e=>{var t;return(null==e?void 0:null===(t=e.style)||void 0===t?void 0:t.backgroundColor)||"lightgray"},ee={all:"All",changed_models:"Changed Models"};function ChangeStatusLegend(){return(0,n.jsx)(c.xu,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[t,[r,o]]=e,{icon:l,color:i}=getIconForChangeStatus(t);return(0,n.jsx)(O.u,{label:o,children:(0,n.jsxs)(d.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,n.jsx)(u.J,{color:i,as:l})," ",r]})},t)})})}function _LineageView(){let[e,t,r]=(0,L.Rr)([]),[l,a,s]=(0,L.ll)([]),[u,h]=(0,o.useState)(),[m,g]=(0,o.useState)(),[p,x]=(0,o.useState)(!1),[y,v]=(0,o.useState)(),[j,w]=(0,o.useState)(),[k,E]=(0,o.useState)(),[S,_]=(0,o.useState)("changed_models"),O=(0,o.useCallback)(async()=>{let e="current";try{x(!0);let r=await b.default.get("".concat(C,"/api/lineage?base=0"));if(200!==r.status)throw Error("error");e="base";let n=await b.default.get("".concat(C,"/api/lineage?base=1"));if(200!==n.status)throw Error("error");let o=buildDefaultLineageGraphSets(n.data,r.data),l="changed_models"===S?o.changed:o.all,i=o.modifiedSet,[s,d]=toReactflow(l,o.modifiedSet);layout(s,d),h(l),g(i),t(s),a(d),v(void 0),w(void 0)}catch(t){if(t instanceof i.d7){var r,n;let e=null==t?void 0:null===(n=t.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.detail;e?v(e):v(null==t?void 0:t.message)}else v(null==t?void 0:t.message);w(e)}finally{x(!1)}},[t,a,S]);return((0,o.useEffect)(()=>{O()},[O]),p)?(0,n.jsx)(d.k,{width:"100%",height:"calc(100vh - 42px)",alignItems:"center",justifyContent:"center",children:(0,n.jsx)(f.$,{size:"xl"})}):y?(0,n.jsxs)(n.Fragment,{children:["Fail to load lineage data: ",y]}):(0,n.jsxs)(d.k,{width:"100%",height:"calc(100vh - 42px)",children:[(0,n.jsx)(c.xu,{flex:"1 0 0px",children:(0,n.jsxs)(L.x$,{nodeTypes:$,edgeTypes:X,nodes:e,edges:l,onNodesChange:r,onEdgesChange:s,onNodeClick:(e,t)=>{E(t.id)},onNodeMouseEnter:(r,n)=>{if(u&&void 0!==m){let[r,o]=highlightPath(u,m,e,l,n.id);t(r),a(o)}},onNodeMouseLeave:(r,n)=>{if(u&&void 0!==m){let[r,n]=highlightPath(u,m,e,l,null);t(r),a(n)}},maxZoom:1,minZoom:.1,fitView:!0,children:[(0,n.jsx)(I.A,{color:"#ccc"}),(0,n.jsx)(R.Z,{showInteractive:!1,position:"top-right",children:(0,n.jsx)(R.B,{title:"switch mode",onClick:()=>{_("all"===S?"changed_models":"all")},children:(0,n.jsx)(z.lbL,{})})}),(0,n.jsx)(L.s_,{position:"bottom-left",children:(0,n.jsx)(ChangeStatusLegend,{})}),(0,n.jsx)(L.s_,{position:"top-left",children:(0,n.jsx)(N.x,{fontSize:"xl",color:"grey",opacity:.5,children:ee[S]})}),(0,n.jsx)(P.a,{nodeColor:nodeColor,nodeStrokeWidth:3})]})}),k&&(null==u?void 0:u.nodes[k])&&(0,n.jsx)(c.xu,{flex:"0 0 500px",borderLeft:"solid 1px lightgray",height:"100%",children:(0,n.jsx)(NodeView,{node:null==u?void 0:u.nodes[k],onClose:()=>{E(void 0)}})})]})}function LineageView(){return(0,n.jsx)(L.tV,{children:(0,n.jsx)(_LineageView,{})})}var et=r(47246),er=r(63956),en=r(35537);function useVersionNumber(){let[e,t]=(0,o.useState)("");return(0,o.useEffect)(()=>{(async function(){try{let e=await k.get("/api/version");t(e.data)}catch(e){console.error("Error fetching version number:",e)}})()},[]),e}function getLocationHash(){return window.location.hash.replace("#","")}function setLocationHash(e){window.location.hash=e}var eo=r(12218);function getCookie(e){var t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t?t.pop():""}function Home(){let e=useVersionNumber(),t=(0,Y.useParams)(),[r,l]=(0,o.useState)(getLocationHash()),[i,a]=(0,o.useState)(0);return(0,o.useLayoutEffect)(()=>{let e=getCookie("recce_user_id");if(e&&eo.env.AMPLITUDE_API_KEY)try{er.S1(eo.env.AMPLITUDE_API_KEY,e,{defaultTracking:!0})}catch(e){console.error(e)}},[]),(0,o.useEffect)(()=>{let e=getLocationHash();l(e),e===r&&("query"===e?a(1):a(0))},[t,r]),(0,n.jsx)(et.x,{children:(0,n.jsx)(RecceQueryContextProvider,{children:(0,n.jsx)(en.aH,{client:E,children:(0,n.jsxs)(A.m,{index:i,onChange:e=>{0===e?setLocationHash("lineage"):1===e&&setLocationHash("query"),a(e)},children:[(0,n.jsxs)(U.t,{children:[(0,n.jsx)(W.O,{children:"Lineage"}),(0,n.jsx)(W.O,{children:"Query"}),(0,n.jsx)(c.xu,{position:"absolute",right:"0",top:"0",p:"2",color:"gray.500",children:e})]}),(0,n.jsxs)(B.n,{children:[(0,n.jsx)(J.x,{p:0,children:(0,n.jsx)(LineageView,{})}),(0,n.jsx)(J.x,{p:0,children:(0,n.jsx)(query_QueryView,{})})]})]})})})})}},88727:function(){},7866:function(){},75165:function(){}},function(e){e.O(0,[759,170,182,710,495,485,297,62,744],function(){return e(e.s=99178)}),_N_E=e.O()}]);