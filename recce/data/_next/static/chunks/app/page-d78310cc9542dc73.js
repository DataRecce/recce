(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{95883:function(e,n,i){Promise.resolve().then(i.bind(i,14602))},14602:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return lp}});var t=i(5945),l=i(48726),o=i(97330),r=i(24281),s=i(74980),a=i(23089),c=i(96717),d=i(3392),u=i(19462),h=i(84425),x=i(20338),p=i(86914),m=i(43308),f=i(71924),g=i(56790),j=i(12275),v=i(92721),y=i(79052),b=i(32278),w=i.n(b),k=i(80106);i(88461);var C=i(56879),_=i(9460);async function S(e,n){let i=(0,_.rM)()?{breaking_change_analysis:!0}:{};return(await k.U.post("/api/checks",{run_id:e,view_options:n,track_props:i})).data}async function z(){return(await k.U.get("/api/checks")).data}async function D(e){return(await k.U.get("/api/checks/".concat(e))).data}async function R(e,n){return(await k.U.patch("/api/checks/".concat(e),n)).data}async function L(e){return(await k.U.delete("/api/checks/".concat(e))).data}async function I(e){return await k.U.post("/api/checks/reorder",e)}var T=i(2185),q=i(19030),N=i(3562),E=i(9492),F=i(66541),O=i(73768),M=i(4259),V=i(27901),A=i(37515),H=i(39768),P=i(66635),J=i(90648),W=i(57101),K=i(83088),U=i(15455),B=i(89529),Q=i(47142),$=i(10706),Z=i(82912),X=i(79065),G=i(67313),Y=i(39802),ee=i(46078),en=i(65631),ei=i(89246),et=i(14401),el=i(3897),eo=i(75375),er=i(55950),es=i(14179),ea=i(6966),ec=i(19933),ed=i(13342),eu=i(46109);function eh(e){let{name:n,setName:i}=e,[o,r]=(0,v.useState)(!1),[s,a]=(0,v.useState)(n),c=(0,v.useRef)(null),d=(0,v.useCallback)(()=>{i(s),r(!1)},[i,r,s]);return(0,v.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&d()};return o&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[o,c,d]),(0,t.jsx)(ea.a,{flex:"0 1 auto",fontSize:"12pt",fontWeight:"500",className:"no-track-pii-safe",separator:(0,t.jsx)(eu.X,{color:"gray.500"}),overflow:"hidden",children:(0,t.jsx)(ec.g,{cursor:"pointer",flex:"0 1 auto",overflow:"hidden",children:o?(0,t.jsx)(ed.I,{ref:c,value:s,onChange:e=>{a(e.target.value)},onKeyDown:e=>{"Enter"===e.key?(i(s),r(!1)):"Escape"===e.key&&(a(n),r(!1))},size:"sm",w:"100%"}):(0,t.jsx)(l.x,{flex:"0 1 auto",onClick:()=>{a(n),r(!0)},textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n})})})}var ex=i(13096),ep=i(76300),em=i(74176),ef=i(50535),eg=i(40083);i(87450);var ej=i(22417),ev=i(64345),ey=i(17282),eb=i(57610),ew=i(98212),ek=i(83344);let eC=(0,v.createContext)(void 0),e_=()=>{let e=(0,v.useContext)(eC);if(!e)throw Error("useLineageViewContext must be used within a LineageViewProvider");return e},eS=()=>(0,v.useContext)(eC);function ez(e){let{model:n,row:i,singleEnv:o,cllRunning:s}=e,a=eS(),{runAction:c}=(0,ej.$q)(),{readOnly:u}=(0,ek.$)(),{name:h,baseType:x,currentType:m,baseIndex:f,currentIndex:g}=i,j=null!=m?m:x,v=()=>{c("profile_diff",{model:n.name,columns:[h]},{showForm:!1})},y=()=>{c("histogram_diff",{model:n.name,column_name:h,column_type:j},{showForm:!1})},b=()=>{c("top_k_diff",{model:n.name,column_name:h,k:50},{showForm:!1})},w=!x||!m;return(0,t.jsx)(M.u,{label:"View column lineage",placement:"top",hasArrow:!0,isDisabled:void 0===a||void 0!==f&&void 0===g,children:(0,t.jsxs)(d.k,{alignItems:"center",gap:"3px",children:[(0,t.jsx)(l.x,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:h}),(0,t.jsx)(p.L,{}),s&&(0,t.jsx)(ev.$,{size:"xs",color:"gray.400"}),!o&&"source"!==n.resource_type&&(0,t.jsx)(A.v,{children:e=>{let{isOpen:n}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(H.j,{display:"flex",className:"row-context-menu",visibility:n?"visible":"hidden",width:n?"auto":"0px",minWidth:n?"auto":"0px",as:P.h,icon:(0,t.jsx)(r.J,{as:ex.D_A}),variant:"unstyled",size:"sm",color:"gray",_hover:{color:"black"},isDisabled:u,onClick:e=>{e.stopPropagation()}}),(0,t.jsx)(ey.h,{children:(0,t.jsx)(J.q,{lineHeight:"20px",children:(0,t.jsxs)(eb.k,{title:"Diff",m:"0",p:"4px 12px",children:[(0,t.jsx)(W.s,{fontSize:"10pt",onClick:v,isDisabled:w,children:"Profile Diff"}),(0,t.jsx)(W.s,{fontSize:"10pt",onClick:y,isDisabled:w||!j||!(0,ew.d)(j),children:"Histogram Diff"}),(0,t.jsx)(W.s,{fontSize:"10pt",onClick:b,isDisabled:w,children:"Top-k Diff"})]})})})]})}})]})})}function eD(e,n,i){function l(e){return void 0!==e.baseIndex&&void 0!==e.currentIndex&&!0===e.reordered?"column-index-reordered schema-column schema-column-index":"schema-column schema-column-index"}function o(e){return void 0!==e.baseIndex&&void 0!==e.currentIndex&&e.baseType!==e.currentType?"column-body-type-changed schema-column":"schema-column"}return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:l},{key:"currentIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:l},{key:"name",name:"Name",resizable:!0,renderCell:e=>{var l;let{row:o,column:r}=e;return n?(0,t.jsx)(ez,{model:n,row:o,cllRunning:null!==(l=null==i?void 0:i.get(o.name))&&void 0!==l&&l}):o.name},cellClass:function(){return"schema-column"}},{key:"baseType",name:"Base Type",resizable:!0,cellClass:o},{key:"currentType",name:"Current Type",resizable:!0,cellClass:o}],rows:Object.values(e)}}var eR=i(45272),eL=i(21107),eI=i(25919);let eT=(0,v.forwardRef)(function(e,n){let i,l,{base:o,current:r,enableScreenshot:s=!1}=e,a=eS(),[c,u]=(0,v.useState)(new Map),{columns:h,rows:x}=(0,v.useMemo)(()=>{var e;let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={};return Object.entries((0,eg.Z)(Object.keys(e),Object.keys(n))).forEach(e=>{let[n,t]=e;i[n]={name:n,reordered:"reordered"===t}}),Object.entries(e).map((e,n)=>{let[t,l]=e;i[t].baseIndex=n+1,i[t].baseType=l.type}),Object.entries(n).map((e,n)=>{let[t,l]=e;i[t].currentIndex=n+1,i[t].currentType=l.type}),i}(null==o?void 0:o.columns,null==r?void 0:r.columns),i=null!==(e=null==r?void 0:r.resource_type)&&void 0!==e?e:null==o?void 0:o.resource_type;return i&&["model","seed","snapshot","source"].includes(i)?eD(n,null!=r?r:o,c):eD(n)},[o,r,c]),{lineageGraph:p}=(0,ef.kJ)(),m=!(null==p?void 0:p.catalogMetadata.base),f=!(null==p?void 0:p.catalogMetadata.current);m&&f?i="catalog.json is missing on both current and base environments.":m?i="catalog.json is missing on base environment.":f&&(i="catalog.json is missing on current environment.");let g=o&&void 0===o.columns,j=r&&void 0===r.columns;g&&j?l="Schema information is missing on both current and base environments.":g?l="Schema information is missing on base environment.":j&&(l="Schema information is missing on current environment.");let y=async e=>{var n;(0,_.KB)({action:"view",source:"schema_column"}),u(n=>new Map(n).set(e,!0));let i=null!==(n=null==r?void 0:r.id)&&void 0!==n?n:null==o?void 0:o.id;i&&await (null==a?void 0:a.showColumnLevelLineage(i,e)),u(n=>new Map(n).set(e,!1))},b=null==a?void 0:a.viewOptions.column_level_lineage,w=b?new Set(["".concat(b.node,"-").concat(b.column)]):new Set;return(0,t.jsxs)(d.k,{direction:"column",children:[i?(0,t.jsxs)(eR.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,t.jsx)(eL.z,{}),i]}):l?(0,t.jsxs)(eR.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,t.jsx)(eL.z,{}),l]}):(0,t.jsx)(t.Fragment,{}),x.length>0&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(eI.o,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:h,rows:x,renderers:{noRowsFallback:(0,t.jsx)(eI.W,{})},className:"rdg-light no-track-pii-safe",enableScreenshot:s,ref:n,rowKeyGetter:e=>{var n;let i=null!==(n=null==r?void 0:r.id)&&void 0!==n?n:null==o?void 0:o.id;return"".concat(i,"-").concat(e.name)},selectedRows:w,onSelectedRowsChange:()=>{},onCellClick:async e=>{(void 0===e.row.baseIndex||void 0!==e.row.currentIndex)&&await y(e.row.name)},rowClass:e=>{let n;if(void 0===e.baseIndex)n="row-added";else{if(void 0===e.currentIndex)return"row-removed";n="row-normal"}return void 0!==a&&(n+=" row-selectable"),n}})})]})}),eq=(0,v.forwardRef)(function(e,n){let i,l,{current:o}=e,r=eS(),[s,a]=(0,v.useState)(new Map),{columns:c,rows:u}=(0,v.useMemo)(()=>(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return{columns:[{key:"index",name:"",resizable:!0,minWidth:35,width:35,cellClass:"schema-column schema-column-index"},{key:"name",name:"Name",resizable:!0,renderCell:e=>{var l;let{row:o,column:r}=e;return n?(0,t.jsx)(ez,{model:n,row:o,cllRunning:null!==(l=null==i?void 0:i.get(o.name))&&void 0!==l&&l,singleEnv:!0}):o.name},cellClass:"schema-column"},{key:"type",name:"Type",resizable:!0,cellClass:"schema-column"}],rows:Object.entries(e).map((e,n)=>{let[i,t]=e;return{name:i,index:n+1,type:t.type}})}})(null==o?void 0:o.columns,o,s),[o,s]),{lineageGraph:h}=(0,ef.kJ)();(null==h?void 0:h.catalogMetadata.current)||(i="catalog.json is missing."),o&&void 0===o.columns&&(l="Schema information is missing.");let x=async e=>{(0,_.KB)({action:"view",source:"schema_column"}),a(n=>new Map(n).set(e,!0));let n=null==o?void 0:o.id;n&&await (null==r?void 0:r.showColumnLevelLineage(n,e)),a(n=>new Map(n).set(e,!1))},p=null==r?void 0:r.viewOptions.column_level_lineage,m=p?new Set(["".concat(p.node,"-").concat(p.column)]):new Set;return(0,t.jsxs)(d.k,{direction:"column",children:[i?(0,t.jsxs)(eR.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,t.jsx)(eL.z,{}),i]}):l?(0,t.jsxs)(eR.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,t.jsx)(eL.z,{}),l]}):(0,t.jsx)(t.Fragment,{}),u.length>0&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(eI.o,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:c,rows:u,renderers:{noRowsFallback:(0,t.jsx)(eI.W,{})},className:"rdg-light",enableScreenshot:!1,ref:n,rowKeyGetter:e=>{let n=null==o?void 0:o.id;return"".concat(n,"-").concat(e.name)},selectedRows:m,onSelectedRowsChange:()=>{},onCellClick:async e=>{await x(e.row.name)},rowClass:()=>void 0!==r?"row-normal row-selectable":"row-normal"})})]})});async function eN(e){return(await k.U.post("/api/select",e)).data}var eE=i(730);i(41908);let eF=e=>{let{style:n,children:i,gutterSize:l=5,...o}=e;return(0,t.jsx)(eE.Z,{style:{display:"flex",flexDirection:"row",...n},direction:"horizontal",gutterSize:l,...o,children:i})},eO=e=>{let{style:n,children:i,gutterSize:l=5,...o}=e;return(0,t.jsx)(eE.Z,{style:{display:"flex",flexDirection:"column",...n},gutterSize:l,direction:"vertical",...o,children:i})};var eM=i(80440),eV=i(34702),eA=i(73322);let eH=ex.Nbv,eP=ex.sFB,eJ=ex.UGs;function eW(e){return"added"===e?{color:"#1dce00",backgroundColor:"#e8fce5",icon:eH}:"removed"===e?{color:"#ff4444",backgroundColor:"#ffdbdb",icon:eP}:"modified"===e?{color:"#ffa502",backgroundColor:"#fff2dd",icon:eJ}:{color:"inherit",backgroundColor:"white",icon:void 0}}function eK(e){if("model"===e)return{color:"#c0eafd",icon:eV.Fn3};if("metric"===e)return{color:"#ffe6ee",icon:eA._MV};if("source"===e)return{color:"#a6dda6",icon:eV.i1q};if("exposure"===e)return{color:"#ffe6ee",icon:eA.n8P};if("semantic_model"===e)return{color:"#fb8caf",icon:eA.R1C};if("seed"===e)return{color:"#a6dda6",icon:eV.tWi};if("snapshot"===e)return{color:"#a6dda6",icon:eV.Dmm};else return{color:"inherit",icon:void 0}}function eU(e,n){if(!e||!n)return;let i=Object.keys(e),t=Object.keys(n);if(i.length!==t.length)return!0;for(let e=0;e<i.length;e++)if(i[e]!==t[e])return!0;for(let i of t)if(!e[i]||e[i].type!==n[i].type)return!0;return!1}var eB=i(54106);let eQ=e=>{let n,i,{node:o,selected:s,onSelect:a,schemaChanged:c}=e,{icon:u}=eK(o.resourceType),{base:h,current:x}=o.data;if(c){var p;n=null===(p=(0,eB.N)("schema_diff"))||void 0===p?void 0:p.icon,i=eW("modified").color}else!h&&x?(n=eW("added").icon,i=eW("added").color):h&&!x&&(n=eW("removed").icon,i=eW("removed").color);return(0,t.jsxs)(d.k,{width:"100%",fontSize:"10pt",p:"5px 8px",cursor:"pointer",_hover:{bg:"gray.200"},bg:s?"gray.100":"inherit",onClick:()=>{a(o.id)},alignItems:"center",gap:"5px",children:[(0,t.jsx)(r.J,{as:u}),(0,t.jsx)(l.x,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:o.name}),n&&i&&(0,t.jsx)(r.J,{as:n,color:i})]})},e$=(0,v.forwardRef)(function(e,n){let{check:i}=e,{lineageGraph:l}=(0,ef.kJ)(),o=i.params,r=[...C.V.check(i.check_id),"select"],{isLoading:s,error:a,refetch:c,data:d}=(0,y.a)({queryKey:r,queryFn:async()=>eN({select:o.select,exclude:o.exclude,packages:o.packages,view_mode:o.view_mode}),refetchOnMount:!0,enabled:!o.node_id}),[u,h]=(0,v.useMemo)(()=>{var e,n,i;let t=[],r=[],s=[],a=[];if(o.node_id)for(let e of o.node_id instanceof Array?o.node_id:[o.node_id]){let n=null==l?void 0:l.nodes[e];n&&t.push(n)}else for(let n of null!==(e=null==d?void 0:d.nodes)&&void 0!==e?e:[]){let e=null==l?void 0:l.nodes[n];e&&t.push(e)}let c=t.filter(e=>"model"===e.resourceType||"seed"===e.resourceType||"source"===e.resourceType||"snapshot"===e.resourceType);for(let e of c)eU(null===(n=e.data.base)||void 0===n?void 0:n.columns,null===(i=e.data.current)||void 0===i?void 0:i.columns)?r.push(e.id):!e.data.base&&e.data.current?s.push(e.id):e.data.base&&!e.data.current&&a.push(e.id);function u(e){return r.includes(e.id)?3:s.includes(e.id)?2:a.includes(e.id)?1:0}return c.sort((e,n)=>{let i=u(e),t=u(n);return i!==t?t-i:e.name.localeCompare(n.name)}),[c,r]},[o.node_id,null==d?void 0:d.nodes,l]),[x,p]=(0,v.useState)(0);if(s)return(0,t.jsx)(T.M,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(a)return(0,t.jsxs)(T.M,{bg:"rgb(249,249,249)",height:"100%",children:["Error: ",a.message]});if(0==u.length)return(0,t.jsx)(T.M,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"});if(x<u.length){let e=u[x];return(0,t.jsxs)(eF,{sizes:[80,20],minSize:30,style:{height:"100%"},children:[(0,t.jsx)(eT,{base:e.data.base,current:e.data.current,enableScreenshot:!0,ref:n}),(0,t.jsx)(eM.aV,{overflow:"auto",backgroundColor:"white",children:u.map((e,n)=>(0,t.jsx)(eQ,{node:e,schemaChanged:h.includes(e.id),selected:n===x,onSelect:()=>{p(n)}},n))})]})}return(0,t.jsx)(t.Fragment,{})});var eZ=i(39862),eX=i(11906);function eG(e){let{value:n,onChange:i}=e,{readOnly:l}=(0,ek.$)(),[r,s]=(0,v.useState)(!1),[a,c]=(0,v.useState)(),u=(0,v.useRef)(null),h=()=>{i&&(i(a),s(!1))};return((0,v.useEffect)(()=>{if(r&&u.current){let e=u.current;e.focus(),e.setSelectionRange(e.value.length,e.value.length)}},[r]),r)?(0,t.jsxs)(d.k,{direction:"column",align:"flex-end",height:"100%",className:"no-track-pii-safe",children:[(0,t.jsx)(eX.g,{value:a,onChange:e=>{c(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&s(!1),(e.metaKey||e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),h())},ref:u,flex:1}),(0,t.jsxs)(d.k,{gap:"12px",alignItems:"flex-end",children:[(0,t.jsx)(o.r,{onClick:()=>{setTimeout(()=>{s(!1)},100)},colorScheme:"blue",children:"cancel"}),(0,t.jsx)(B.z,{mt:"8px",size:"sm",colorScheme:"blue",onClick:h,children:"Update"})]})]}):(0,t.jsx)(K.x,{className:"no-track-pii-safe",height:"100%",overflow:"auto",fontSize:"11pt",onClick:l?void 0:()=>{c(null!=n?n:""),s(!0)},whiteSpace:"pre-wrap",wordBreak:"break-word",color:n?"inherit":"lightgray",children:n||"Add description here"})}var eY=i(56303);function e0(){let e=(0,s.p)();return{successToast:function(n){e({description:n,status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})},failToast:function(n,i){e({title:n,description:"".concat(i),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}}}function e1(){let e=(0,E._)(["\n    **SQL**\n    ```sql\n    ","\n    ```\n    "],["\n    **SQL**\n    \\`\\`\\`sql\n    ","\n    \\`\\`\\`\n    "]);return e1=function(){return e},e}function e5(e){return e.description?e.description:"_(no description)_"}var e2=i(78076),e4=i(98826),e6=i(16018),e3=i(45451),e9=i(5436),e8=i(24280),e7=i(64124),ne=i(34091),nn=i(20428),ni=i(98062),nt=i(41201),nl=i(46139),no=i(64903);let nr=e=>(0,t.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,t.jsx)("g",{clipPath:"url(#clip0_1479_25070)",children:(0,t.jsx)("path",{d:"M15.625 0.25H14.759C14.5484 0.25 14.3791 0.423375 14.3841 0.633937L14.4575 3.71441C13.0691 1.62634 10.6955 0.25 8 0.25C4.21291 0.25 1.06041 2.96638 0.38425 6.557C0.340875 6.78728 0.518875 7 0.753219 7H1.64622C1.82353 7 1.97566 6.87556 2.013 6.70222C2.60753 3.9415 5.05991 1.875 8 1.875C10.4858 1.875 12.6232 3.35256 13.5836 5.47819L9.63394 5.38416C9.42341 5.37916 9.25 5.54844 9.25 5.75906V6.625C9.25 6.83209 9.41791 7 9.625 7H15.625C15.8321 7 16 6.83209 16 6.625V0.625C16 0.417906 15.8321 0.25 15.625 0.25ZM15.2468 9H14.3538C14.1765 9 14.0243 9.12444 13.987 9.29778C13.3925 12.0585 10.9401 14.125 8 14.125C5.51419 14.125 3.37681 12.6474 2.41637 10.5218L6.36606 10.6158C6.57659 10.6208 6.75 10.4516 6.75 10.2409V9.375C6.75 9.16791 6.58209 9 6.375 9H0.375C0.167906 9 0 9.16791 0 9.375V15.375C0 15.5821 0.167906 15.75 0.375 15.75H1.24097C1.45156 15.75 1.62088 15.5766 1.61588 15.3661L1.54253 12.2856C2.93087 14.3737 5.3045 15.75 8 15.75C11.7871 15.75 14.9396 13.0336 15.6158 9.443C15.6591 9.21272 15.4811 9 15.2468 9Z",fill:"currentColor"})}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_1479_25070",children:(0,t.jsx)("rect",{width:"16",height:"16",fill:"white"})})})]}),ns=e=>(0,t.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,t.jsx)("g",{clipPath:"url(#clip0_1479_25102)",children:(0,t.jsx)("path",{d:"M-1.88399 8.72062L0.358816 6.46094C0.594752 6.22344 1.00006 6.39031 1.00006 6.725V8.2525H4.00005V4.12438C4.00005 3.7275 4.16161 3.34313 4.44286 3.06219L7.06441 0.440625C7.34566 0.159375 7.72691 0 8.12347 0H14.5003C15.3281 0.003125 16 0.675 16 1.50281V14.5003C16 15.3281 15.3281 16 14.5003 16H5.50223C4.67411 16 4.00005 15.3281 4.00005 14.5003V11.2522H5.50005V14.5003H14.5003V1.50281H9.50128V4.75219C9.50128 5.16781 9.1669 5.50187 8.75128 5.50187H5.50005V8.25219H10.625C10.8322 8.25219 11 8.42 11 8.62719V9.37719C11 9.58438 10.8322 9.75219 10.625 9.75219H1.00006V11.2797C1.00006 11.6144 0.594752 11.7813 0.358816 11.5438L-1.88399 9.28406C-2.03867 9.12813 -2.03867 8.87656 -1.88399 8.72062ZM8.0016 4.00219V1.62469L5.62379 4.00219H8.0016Z",fill:"currentColor"})}),(0,t.jsx)("g",{clipPath:"url(#clip1_1479_25102)",children:(0,t.jsx)("path",{d:"M0.103056 8.72062L2.09667 6.46094C2.30639 6.22344 2.66667 6.39031 2.66667 6.725V8.2525H5.33333V4.12438C5.33333 3.7275 5.47694 3.34313 5.72694 3.06219L8.05722 0.440625C8.30722 0.159375 8.64611 0 8.99861 0H14.6669C15.4028 0.003125 16 0.675 16 1.50281V14.5003C16 15.3281 15.4028 16 14.6669 16H6.66861C5.9325 16 5.33333 15.3281 5.33333 14.5003V11.2522H6.66667V14.5003H14.6669V1.50281H10.2233V4.75219C10.2233 5.16781 9.92611 5.50187 9.55667 5.50187H6.66667V8.25219H11.2222C11.4064 8.25219 11.5556 8.42 11.5556 8.62719V9.37719C11.5556 9.58438 11.4064 9.75219 11.2222 9.75219H2.66667V11.2797C2.66667 11.6144 2.30639 11.7813 2.09667 11.5438L0.103056 9.28406C-0.0344448 9.12813 -0.0344448 8.87656 0.103056 8.72062ZM8.89028 4.00219V1.62469L6.77666 4.00219H8.89028Z",fill:"currentColor"})}),(0,t.jsxs)("defs",{children:[(0,t.jsx)("clipPath",{id:"clip0_1479_25102",children:(0,t.jsx)("rect",{width:"13",height:"16",fill:"white",transform:"matrix(-1 0 0 1 16 0)"})}),(0,t.jsx)("clipPath",{id:"clip1_1479_25102",children:(0,t.jsx)("rect",{width:"3",height:"16",fill:"white"})})]})]}),na=e=>(0,t.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,t.jsx)("g",{clipPath:"url(#clip0_1426_8619)",children:(0,t.jsx)("path",{d:"M15.5572 3.06188L12.9356 0.440625C12.6544 0.159375 12.2731 0 11.8766 0H5.49969C4.67188 0.003125 4 0.675 4 1.50281V8.25219H0.375C0.167812 8.25219 0 8.42 0 8.62719V9.37719C0 9.58438 0.167812 9.75219 0.375 9.75219H9V11.2797C9 11.6144 9.40531 11.7812 9.64125 11.5437L11.8841 9.28406C12.0388 9.12813 12.0388 8.87656 11.8841 8.72062L9.64125 6.46094C9.40531 6.22344 9 6.39031 9 6.725V8.2525H5.49969V1.50281H10.4987V4.75219C10.4987 5.16781 10.8331 5.50187 11.2487 5.50187H14.5V14.5003H5.49969V11.2522H4V14.5003C4 15.3281 4.67188 16 5.49969 16H14.4978C15.3259 16 16 15.3281 16 14.5003V4.12406C16 3.7275 15.8384 3.34313 15.5572 3.06188ZM11.9984 4.00219V1.62469L14.3763 4.00219H11.9984Z",fill:"black"})}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0_1426_8619",children:(0,t.jsx)("rect",{width:"16",height:"16",fill:"white"})})})]}),nc=e=>(0,t.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,t.jsx)("path",{d:"M14.5607 4.06066L11.9393 1.43934C11.658 1.15804 11.2765 1 10.8787 1H2.5C1.67156 1 1 1.67156 1 2.5V13.5C1 14.3284 1.67156 15 2.5 15H13.5C14.3284 15 15 14.3284 15 13.5V5.12131C15 4.72349 14.842 4.34196 14.5607 4.06066ZM9.5 2.5V5H5.5V2.5H9.5ZM13.3125 13.5H2.6875C2.63777 13.5 2.59008 13.4802 2.55492 13.4451C2.51975 13.4099 2.5 13.3622 2.5 13.3125V2.6875C2.5 2.63777 2.51975 2.59008 2.55492 2.55492C2.59008 2.51975 2.63777 2.5 2.6875 2.5H4V5.75C4 6.16422 4.33578 6.5 4.75 6.5H10.25C10.6642 6.5 11 6.16422 11 5.75V2.62131L13.4451 5.06641C13.4625 5.08382 13.4763 5.10449 13.4857 5.12724C13.4952 5.14999 13.5 5.17438 13.5 5.199V13.3125C13.5 13.3622 13.4802 13.4099 13.4451 13.4451C13.4099 13.4802 13.3622 13.5 13.3125 13.5ZM8 7.25C6.48366 7.25 5.25 8.48366 5.25 10C5.25 11.5163 6.48366 12.75 8 12.75C9.51634 12.75 10.75 11.5163 10.75 10C10.75 8.48366 9.51634 7.25 8 7.25ZM8 11.25C7.31075 11.25 6.75 10.6892 6.75 10C6.75 9.31075 7.31075 8.75 8 8.75C8.68925 8.75 9.25 9.31075 9.25 10C9.25 10.6892 8.68925 11.25 8 11.25Z",fill:"currentColor"})}),nd=e=>(0,t.jsx)("svg",{width:"17",height:"16",viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,t.jsx)("path",{d:"M15.9143 1.75812L14.7422 0.585938C14.3515 0.195312 13.8397 0 13.3278 0C12.8159 0 12.304 0.195312 11.9137 0.585625L9.58593 2.91344L8.5 3.99938L0.901592 11.5975L0.504719 15.1669C0.454719 15.6163 0.80878 16 1.24847 16C1.27628 16 1.3044 15.9984 1.33253 15.9953L4.89939 15.6012L12.5006 8L13.5862 6.91437L15.914 4.58656C16.6953 3.80531 16.6953 2.53906 15.9143 1.75812ZM4.21095 14.1684L2.09909 14.4016L2.3344 12.2863L9.56062 5.06L10.53 4.09062L12.4094 5.97L11.44 6.93937L4.21095 14.1684ZM14.8534 3.52562L13.4697 4.90938L11.5906 3.03L12.9744 1.64625C13.1019 1.51875 13.2506 1.49969 13.3278 1.49969C13.405 1.49969 13.554 1.51875 13.6812 1.64625L14.8534 2.81844C15.0484 3.01375 15.0484 3.33094 14.8534 3.52562Z",fill:"currentColor"})}),nu=e=>(0,t.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,t.jsx)("path",{d:"M7.26326 6.5462H8.71794V12.3642H7.26326V6.5462ZM7.9906 3.1102C7.43278 3.1102 6.97888 3.5641 6.97888 4.12192C6.97888 4.67974 7.43278 5.13364 7.9906 5.13364C8.54842 5.13364 9.00232 4.67974 9.00232 4.12192C9.00232 3.5641 8.54842 3.1102 7.9906 3.1102ZM16 8C16 12.411 12.411 16 8 16C3.589 16 0 12.411 0 8C0 3.589 3.589 0 8 0C12.411 0 16 3.589 16 8ZM14.5453 8C14.5453 4.3906 11.6093 1.4546 7.99992 1.4546C4.39052 1.4546 1.45452 4.3914 1.45452 8.0006C1.45452 11.6098 4.39052 14.546 7.99992 14.546C11.6093 14.546 14.5453 11.6092 14.5453 8.0006V8Z",fill:"currentColor"})});var nh=i(29630),nx=i.n(nh);function np(e){let n=(0,nt.D)(e);return(0,nl.WU)(n,"yyyy-MM-dd'T'HH:mm:ss")}function nm(e){let n=(0,nt.D)(e);return(0,no.B)(n,new Date,{addSuffix:!0})}function nf(e){let n=new Set,i=new Set;if(null==e?void 0:e.nodes)for(let o of Object.values(e.nodes)){var t,l;(null===(t=o.data.base)||void 0===t?void 0:t.schema)&&n.add(o.data.base.schema),(null===(l=o.data.current)||void 0===l?void 0:l.schema)&&i.add(o.data.current.schema)}return[n,i]}function ng(e){return Object.values(e).every(e=>null===e)?[(0,t.jsx)(d.k,{ml:"10px",children:"No information"},"no info")]:Object.entries(e).filter(e=>{let[n,i]=e;return"url"!==n&&null!=i}).map(e=>{let[n,i]=e;return(0,t.jsxs)(eM.HC,{ml:"10px",children:[n,": ",i]},n)})}function nj(){var e,n,i,l;let{envInfo:s,reviewMode:a,lineageGraph:c}=(0,ef.kJ)(),{isOpen:u,onOpen:x,onClose:p}=(0,F.q)(),m=null==s?void 0:s.git,f=null==s?void 0:s.pullRequest,g={...m,...f},j=null==s?void 0:null===(e=s.dbt)||void 0===e?void 0:e.base,v=null==s?void 0:null===(n=s.dbt)||void 0===n?void 0:n.current,y=(null==j?void 0:j.generated_at)?np(j.generated_at):"",b=(null==v?void 0:v.generated_at)?np(v.generated_at):"",w="",k="";j&&(w=j.generated_at?nm(j.generated_at):""),v&&(k=v.generated_at?nm(v.generated_at):"");let[C,_]=nf(c);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(M.u,{label:"Environment Info",placement:"bottom-end",children:(0,t.jsxs)("div",{className:"flex items-center hover:cursor-pointer hover:text-black",onClick:x,children:[(0,t.jsxs)("div",{className:"hidden text-sm lg:flex lg:flex-col",children:[(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"no-track-pii-safe",children:Array.from(C).join(", ")})," (",w,")"]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"no-track-pii-safe",children:Array.from(_).join(", ")})," (",k,")"]})]}),(0,t.jsx)(P.h,{size:"sm",variant:"unstyled","aria-label":"Environment Info",icon:(0,t.jsx)(r.J,{verticalAlign:"middle",as:nu,boxSize:"16px"})})]})}),(0,t.jsxs)(Z.u_,{isOpen:u,onClose:p,size:"3xl",children:[(0,t.jsx)(O.Z,{}),(0,t.jsxs)(X.h,{children:[(0,t.jsx)(G.x,{children:"Environment Information"}),(0,t.jsx)(Y.o,{}),(0,t.jsx)(ee.f,{children:(0,t.jsxs)(d.k,{direction:"column",gap:"5px",children:[a?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(d.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,t.jsx)(h.X,{size:"sm",children:"Review Information"}),(0,t.jsxs)(eM.QI,{spacing:1,children:[g.url&&(0,t.jsxs)(eM.HC,{ml:"10px",children:["url:"," ",(0,t.jsx)(o.r,{href:g.url,color:"blue.500",isExternal:!0,children:g.url})]}),!nx()(g)&&ng(g)]})]})}):(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(d.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,t.jsx)(h.X,{size:"sm",children:"Dev Information"}),(0,t.jsx)(eM.QI,{spacing:1,children:m&&ng(m)})]})}),(0,t.jsx)(N.i,{}),(null==s?void 0:s.adapterType)==="dbt"&&(0,t.jsxs)(d.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,t.jsx)(h.X,{size:"sm",children:"DBT"}),(0,t.jsx)(e6.x,{children:(0,t.jsxs)(e3.i,{variant:"simple",children:[(0,t.jsx)(e9.h,{children:(0,t.jsxs)(e8.Tr,{children:[(0,t.jsx)(e7.Th,{}),(0,t.jsx)(e7.Th,{children:"base"}),(0,t.jsx)(e7.Th,{children:"current"})]})}),(0,t.jsxs)(ne.p,{children:[(0,t.jsxs)(e8.Tr,{children:[(0,t.jsx)(nn.Td,{children:"schema"}),(0,t.jsx)(nn.Td,{className:"no-track-pii-safe",children:JSON.stringify(Array.from(C))}),(0,t.jsx)(nn.Td,{className:"no-track-pii-safe",children:JSON.stringify(Array.from(_))})]}),(0,t.jsxs)(e8.Tr,{children:[(0,t.jsx)(nn.Td,{children:"version"}),(0,t.jsx)(nn.Td,{children:null==j?void 0:j.dbt_version}),(0,t.jsx)(nn.Td,{children:null==v?void 0:v.dbt_version})]}),(0,t.jsxs)(e8.Tr,{children:[(0,t.jsx)(nn.Td,{children:"timestamp"}),(0,t.jsx)(nn.Td,{children:y}),(0,t.jsx)(nn.Td,{children:b})]})]})]})})]}),(null==s?void 0:s.adapterType)==="sqlmesh"&&(0,t.jsxs)(d.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,t.jsx)(h.X,{size:"sm",children:"SQLMesh"}),(0,t.jsx)(e6.x,{children:(0,t.jsxs)(e3.i,{variant:"simple",children:[(0,t.jsx)(e9.h,{children:(0,t.jsxs)(e8.Tr,{children:[(0,t.jsx)(e7.Th,{}),(0,t.jsx)(e7.Th,{children:"base"}),(0,t.jsx)(e7.Th,{children:"current"})]})}),(0,t.jsx)(ne.p,{children:(0,t.jsxs)(e8.Tr,{children:[(0,t.jsx)(nn.Td,{children:"Environment"}),(0,t.jsx)(nn.Td,{className:"no-track-pii-safe",children:null===(i=s.sqlmesh)||void 0===i?void 0:i.base_env}),(0,t.jsx)(nn.Td,{className:"no-track-pii-safe",children:null===(l=s.sqlmesh)||void 0===l?void 0:l.current_env})]})})]})})]})]})}),(0,t.jsx)(ni.m,{children:(0,t.jsx)(B.z,{colorScheme:"blue",mr:3,onClick:p,children:"Close"})})]})]})]})}function nv(e){var n;let{value:i,onChange:l,onRun:o,onRunBase:s,onRunDiff:a,label:c,CustomEditor:u,options:h={},manifestData:x,schemas:m,...f}=e,{readOnly:g}=(0,ek.$)(),j="";return x&&(j=x.generated_at?nm(x.generated_at):""),(0,t.jsxs)(t.Fragment,{children:[(null!==(n=null!=c?c:o)&&void 0!==n?n:s)&&(0,t.jsxs)(d.k,{backgroundColor:"#EDF2F880",height:"40px",minH:"40px",fontSize:"14px",align:"center",margin:"0",padding:"0px 16px",flex:"0 0 40px",children:[(0,t.jsx)(K.x,{as:"strong",children:c?c.toUpperCase():""}),x&&(0,t.jsxs)("span",{className:"ml-1",children:["(",m&&(0,t.jsxs)("span",{children:[m,", "]}),(0,t.jsx)("span",{children:j}),")"]}),(0,t.jsx)(p.L,{}),(null!=o?o:s)&&(0,t.jsx)(B.z,{size:"sm",variant:"outline",onClick:null!=o?o:s,backgroundColor:"white",leftIcon:(0,t.jsx)(r.J,{as:eA.gmG}),padding:"6px 12px",isDisabled:g,children:"Run Query"})]}),null!=u?u:(0,t.jsx)(e4.ML,{className:"no-track-pii-safe",language:"sql",theme:"vs",value:i,onChange:e=>{void 0!==e&&l&&l(e)},onMount:(e,n)=>{o&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.Enter,o),s&&e.addCommand(n.KeyMod.Alt|n.KeyCode.Enter,s),a&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.Enter,a)},options:{extraEditorClassName:"no-track-pii-safe",tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent",...h}})]})}function ny(e){var n;let i,l,{value:o,baseValue:r,onChange:s,onChangeBase:a,onRun:c,onRunBase:u,onRunDiff:h,options:x={},labels:p,BaseEnvironmentSetupGuide:m,...f}=e,g=p?p[0]:"Base",j=p?p[1]:"Current",{envInfo:v,lineageGraph:y}=(0,ef.kJ)();(null==v?void 0:null===(n=v.dbt)||void 0===n?void 0:n.base)&&v.dbt.current&&(i=v.dbt.base,l=v.dbt.current);let[b,w]=nf(y);return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(d.k,{height:"100%",gap:0,children:[(0,t.jsx)(e2.K,{height:"100%",width:"50%",gap:0,borderRight:"1px",borderColor:"#D4DBE4",children:(0,t.jsx)(nv,{label:g,value:null!=r?r:"",onChange:a,onRunBase:u,options:x,CustomEditor:m,manifestData:null!=i?i:void 0,schemas:Array.from(b).join(", "),...f})}),(0,t.jsx)(e2.K,{height:"100%",width:"50%",gap:0,children:(0,t.jsx)(nv,{label:j,value:o,onChange:s,onRun:c,options:x,manifestData:null!=l?l:void 0,schemas:Array.from(w).join(", "),...f})})]})})}var nb=i(36528),nw=i(55311),nk=i(78823),nC=i(95275);let n_=(0,nw.G)((e,n)=>{var i,o,r,s,a;let{isRunning:c,isAborting:u,progress:h,error:x,run:p,onCancel:m,viewOptions:f,onViewOptionsChanged:g,RunResultView:j,children:v,onExecuteRun:y}=e,b=null!==(r=null==x?void 0:null===(o=x.response)||void 0===o?void 0:null===(i=o.data)||void 0===i?void 0:i.detail)&&void 0!==r?r:null==p?void 0:p.error;if(b)return(0,t.jsxs)(eR.b,{status:"error",children:[(0,t.jsx)(eL.z,{}),"Error: ",b]});if(null!=c?c:(null==p?void 0:p.status)==="running"){let e="Loading...";return(null==h?void 0:h.message)?e=h.message:(null==p?void 0:null===(s=p.progress)||void 0===s?void 0:s.message)&&(e=p.progress.message),(0,t.jsx)(T.M,{p:"16px",height:"100%",bg:"rgb(249,249,249)",children:(0,t.jsxs)(q.g,{children:[(0,t.jsxs)(d.k,{alignItems:"center",children:[(null==h?void 0:h.percentage)==null?(0,t.jsx)(nk.D,{isIndeterminate:!0,size:"20px",mr:"8px"}):(0,t.jsx)(nk.D,{size:"20px",value:100*h.percentage,mr:"8px"}),u?(0,t.jsx)(t.Fragment,{children:"Aborting..."}):(0,t.jsx)(t.Fragment,{children:e})]}),!u&&(0,t.jsx)(B.z,{onClick:m,colorScheme:"blue",size:"sm",children:"Cancel"})]})})}if(!p)return(0,t.jsx)(T.M,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(v&&j)throw Error("RunView requires either a children or a RunResultView prop, but not both.");if(!v&&!j)throw Error("RunView requires at least one of children or RunResultView prop.");return(0,t.jsxs)(l.x,{h:"100%",style:{contain:"size layout"},overflow:"auto",className:"no-track-pii-safe",children:[j&&(null!==(a=p.error)&&void 0!==a?a:p.result)&&(0,t.jsx)(nC.SV,{children:(0,t.jsx)(j,{ref:n,run:p,viewOptions:f,onViewOptionsChanged:g})}),null==v?void 0:v({run:p,viewOptions:f,onViewOptionsChanged:g})]})});var nS=i(2970),nz=i(56603),nD=i(96706),nR=i(65912),nL=i(98145),nI=i(49053),nT=i(79601);i(8575),i(57958);var nq=i(81794),nN=i(12434),nE=i(95866),nF=i(51482),nO=i(75821),nM=i(18886);function nV(e){let{node:n}=e,{icon:i}=eK(n.resourceType);return(0,t.jsx)(M.u,{hasArrow:!0,label:"Type of resource",children:(0,t.jsxs)(V.Vp,{children:[(0,t.jsx)(V.AD,{as:i}),(0,t.jsx)(V.Sn,{children:n.resourceType})]})})}function nA(e){let{rowCount:n}=e,i=n.base,l=n.curr,o=null===n.base?"N/A":"".concat(n.base," rows"),s=null===n.curr?"N/A":"".concat(n.curr," rows");return null===i&&null===l?(0,t.jsx)(t.Fragment,{children:" Failed to load"}):null===i||null===l?(0,t.jsxs)(x.U,{children:[(0,t.jsx)(K.x,{children:o}),(0,t.jsx)(r.J,{as:nF.Rgz}),(0,t.jsx)(K.x,{children:s})]}):i===l?(0,t.jsxs)(x.U,{children:[(0,t.jsx)(K.x,{children:s}),(0,t.jsx)(r.J,{as:nO.lxc,color:"gray.500"}),(0,t.jsx)(K.x,{color:"gray.500",children:"No Change"})]}):i<l?(0,t.jsxs)(x.U,{children:[(0,t.jsx)(K.x,{children:s}),(0,t.jsx)(r.J,{as:nO.Tvk,color:"green.500"}),(0,t.jsx)(K.x,{color:"green.500",children:(0,nM.T)(i,l)})]}):(0,t.jsxs)(x.U,{children:[(0,t.jsx)(K.x,{children:s}),(0,t.jsx)(r.J,{as:nO.ebp,color:"red.500"}),(0,t.jsx)(K.x,{color:"red.500",children:(0,nM.T)(i,l)})]})}function nH(e){var n,i,l,o;let r,{rowCount:s,node:a,onRefresh:c,isFetching:d}=e,{readOnly:u}=(0,ek.$)(),{runsAggregated:h}=(0,ef.kJ)(),x=null==h?void 0:null===(n=h[a.id])||void 0===n?void 0:n.row_count_diff.result,p=null===(i=(0,eB.N)("row_count_diff"))||void 0===i?void 0:i.icon,m=null!=s?s:x;if(m){let e=null!==(l=m.base)&&void 0!==l?l:"N/A",n=null!==(o=m.curr)&&void 0!==o?o:"N/A";r="".concat(e," -> ").concat(n," rows")}return(0,t.jsx)(M.u,{label:r,children:(0,t.jsxs)(V.Vp,{children:[(0,t.jsx)(V.AD,{as:p}),(0,t.jsx)(V.Sn,{children:m||d?(0,t.jsx)(nE.N,{isLoaded:!d,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:m?(0,t.jsx)(nA,{rowCount:m}):"row count"}):(0,t.jsx)(t.Fragment,{children:"row count"})}),c&&(0,t.jsx)(V.bq,{as:P.h,isLoading:d,"aria-label":"Query Row Count",icon:(0,t.jsx)(eo.n,{}),size:"xs",onClick:c,isDisabled:u})]})})}function nP(e){var n,i,l;let o,{rowCount:r,node:s,onRefresh:a,isFetching:c}=e,{runsAggregated:d,refetchRunsAggregated:u}=(0,ef.kJ)(),h=null==d?void 0:null===(n=d[s.id])||void 0===n?void 0:n.row_count.result,x=null===(i=(0,eB.N)("row_count"))||void 0===i?void 0:i.icon,p=null!=r?r:h;if(p){let e=null!==(l=p.curr)&&void 0!==l?l:"N/A";o="".concat(e," rows")}return(0,t.jsxs)(V.Vp,{children:[(0,t.jsx)(V.AD,{as:x}),(0,t.jsx)(V.Sn,{children:p||c?(0,t.jsx)(nE.N,{isLoaded:!c,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:p?"".concat(o):"row count"}):(0,t.jsx)(t.Fragment,{children:"row count"})}),a&&(0,t.jsx)(V.bq,{as:P.h,isLoading:c,"aria-label":"Query Row Count",icon:(0,t.jsx)(eo.n,{}),size:"xs",onClick:a,disabled:"base"===s.from})]})}let nJ=e=>{let{node:n,action:i}=e,{status:o,skipReason:r,run:s}=i;if("pending"===o)return(0,t.jsx)(nk.D,{size:"20px",value:0});if("skipped"===o)return(0,t.jsx)(V.Vp,{backgroundColor:"gray.100",children:(0,t.jsxs)(d.k,{fontSize:"10pt",color:"gray.500",alignItems:"center",gap:"3px",children:[(0,t.jsx)(l.x,{children:"Skipped"}),r&&(0,t.jsx)(M.u,{label:r,children:(0,t.jsx)(nq.s,{})})]})});if(!s)return(0,t.jsx)(nk.D,{isIndeterminate:!0,size:"20px"});let{error:a,result:c,run_id:u,progress:h}=s;if("running"===o)return(null==h?void 0:h.percentage)===void 0?(0,t.jsx)(nk.D,{isIndeterminate:!0,size:"20px"}):(0,t.jsx)(nk.D,{size:"20px",value:100*h.percentage});if(a)return(0,t.jsxs)(d.k,{fontSize:"10pt",color:"gray",children:[(0,t.jsx)(l.x,{children:"Error"}),r&&(0,t.jsx)(M.u,{label:a,children:(0,t.jsx)(nN.a,{})})]});if("value_diff"===s.type){let e=0;for(let n of c.data.data)n[2]<1&&e++;return(0,t.jsx)(V.Vp,{backgroundColor:e>0?"red.100":"green.100",children:(0,t.jsx)(V.Sn,{children:(0,t.jsx)(d.k,{fontSize:"10pt",color:e>0?"red":"green",alignItems:"center",gap:"3px",children:e>0?"".concat(e," columns mismatched"):"All columns match"})})})}if("row_count_diff"===s.type){let e=s.result;return(0,t.jsx)(nH,{rowCount:e[n.name],node:n})}if("row_count"===s.type){let e=s.result;return(0,t.jsx)(nP,{rowCount:e[n.name],node:n})}return(0,t.jsx)(t.Fragment,{children:u})};function nW(e){var n;let i,l,{rowCount:o}=e,r=o.base,s=o.curr,a=null===o.base?"N/A":"".concat(o.base," Rows"),c=null===o.curr?"N/A":"".concat(o.curr," Rows");return null===r&&null===s?(i="Failed to load",l="gray"):null===r||null===s?(i="".concat(a," -> ").concat(c),l=null===r?"green":"red"):r===s?(i="=",l="gray"):r!==s&&(i="".concat((0,nM.T)(r,s)," Rows"),l=r<s?"green":"red"),(0,t.jsxs)(V.Vp,{colorScheme:l,children:[(0,t.jsx)(V.AD,{as:null===(n=(0,eB.N)("row_count_diff"))||void 0===n?void 0:n.icon}),(0,t.jsx)(V.Sn,{children:i})]})}let nK={breaking:"Breaking",non_breaking:"Non Breaking",partial_breaking:"Partial Breaking",unknown:"Unknown"},nU=e=>{var n;let i,o,{id:s,inverted:a}=e,{lineageGraph:c,runsAggregated:u}=(0,ef.kJ)(),h=null==u?void 0:u[s],x=null==c?void 0:c.nodes[s];if(!h&&!x)return(0,t.jsx)(t.Fragment,{});if((null==x?void 0:x.data.base)&&x.data.current&&(i=eU(x.data.base.columns,x.data.current.columns)),null==h?void 0:h.row_count_diff){let e=h.row_count_diff;o=e.result.curr!==e.result.base}let m=a?"white":eW("modified").color;return(0,t.jsxs)(d.k,{flex:"1",children:[void 0!==i&&(0,t.jsx)(M.u,{label:"Schema (".concat(i?"changed":"no change",")"),openDelay:500,children:(0,t.jsx)(l.x,{height:"16px",children:(0,t.jsx)(r.J,{as:null===(n=(0,eB.N)("schema_diff"))||void 0===n?void 0:n.icon,color:i?m:a?"gray":"lightgray"})})}),(0,t.jsx)(p.L,{}),(null==h?void 0:h.row_count_diff)&&void 0!==o&&(0,t.jsx)(M.u,{label:"Row count (".concat(o?"changed":"=",")"),openDelay:500,children:(0,t.jsx)(l.x,{children:(0,t.jsx)(nW,{rowCount:h.row_count_diff.result})})})]})},nB=e=>{let{checked:n,onClick:i}=e;return(0,t.jsx)(d.k,{onClick:i,alignSelf:"center",alignItems:"center",cursor:"pointer",children:n?(0,t.jsx)(r.J,{boxSize:"20px",as:eV.xik}):(0,t.jsx)(r.J,{boxSize:"20px",as:eV.hGI})})},nQ=e=>{let{name:n,color:i,resourceType:o}=e;return(0,t.jsx)(l.x,{flex:"1",color:i,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:(0,t.jsx)(M.u,{label:"model"===o?n:"".concat(n," (").concat(o,")"),placement:"top",children:n})})};var n$=i(4457),nZ=i(32045),nX=i(25969),nG=i(2446);async function nY(e){return(await k.U.post("/api/checks",{type:"schema_diff",params:e})).data}let n0={add_or_remove:"Unavailable for added or removed resources."};var n1=i(55966);let n5=e=>{var n;let[i,t]=(0,v.useState)(!1),[l,o]=(0,v.useState)(!1),[,r]=(0,ef.P)(),{error:s,data:a}=(0,y.a)({queryKey:C.V.run(null!=e?e:""),queryFn:async()=>(0,nb.Qp)(null!=e?e:"",i?2:0),enabled:!!e,refetchInterval:!!i&&50,retry:!1});(0,v.useEffect)(()=>{(s||(null==a?void 0:a.result)||(null==a?void 0:a.error))&&(i&&t(!1),((null==a?void 0:a.type)==="row_count_diff"||(null==a?void 0:a.type)==="row_count")&&r()),(null==a?void 0:a.status)==="running"&&t(!0)},[a,s,i,r]);let c=(0,v.useCallback)(async()=>{o(!0),e&&await (0,nb.Eg)(e)},[e,o]),d=(null==a?void 0:a.type)?null===(n=(0,eB.N)(a.type))||void 0===n?void 0:n.RunResultView:void 0;return{run:a,isRunning:i,aborting:l,error:s,onCancel:c,RunResultView:d}};var n2=i(22340),n4=i(45828),n6=i(89373),n3=i(21983),n9=i.n(n3),n8=i(31256),n7=i(30180),ie=i.n(n7);let ii="ignore-screenshot";function it(e){let{renderLibrary:n="html2canvas",imageType:i="png",backgroundColor:l=null,boardEffect:o=!0,shadowEffect:r=!1,borderStyle:s="solid 1px #ccc",borderRadius:a="10px",onSuccess:c,onError:h,ignoreElements:x}=e,[p,m]=(0,v.useState)("idle"),f=(0,v.useRef)(null),{onOpen:g,setImgBlob:j,ImageDownloadModal:y}=function(){let{isOpen:e,onOpen:n,onClose:i}=(0,F.q)(),[l,o]=(0,v.useState)();return{onOpen:n,setImgBlob:o,ImageDownloadModal:function(){let[n,o]=(0,v.useState)();return(0,v.useEffect)(()=>{if(!l)return;let e=new FileReader;e.readAsDataURL(l),e.onloadend=e=>{var n;(null===(n=e.target)||void 0===n?void 0:n.result)!=null&&o(e.target.result)}},[o]),(0,t.jsxs)(Z.u_,{size:"3xl",isOpen:e,onClose:i,children:[(0,t.jsx)(O.Z,{}),(0,t.jsxs)(X.h,{children:[(0,t.jsx)(G.x,{children:"Screenshot Preview"}),(0,t.jsx)(Y.o,{}),(0,t.jsxs)(ee.f,{children:[(0,t.jsxs)(d.k,{px:"10px",gap:"10px",direction:"column",children:[(0,t.jsxs)(d.k,{alignItems:"center",gap:"5px",children:[(0,t.jsx)(nq.s,{color:"red.600"}),(0,t.jsx)(K.x,{fontWeight:"500",display:"inline",children:"Copy to the Clipboard"})," ","is not supported in the current browser"]}),(0,t.jsx)(K.x,{children:"Please download it directly"})]}),(0,t.jsx)(u.E,{src:n,alt:"screenshot"})]}),(0,t.jsxs)(ni.m,{children:[(0,t.jsx)(B.z,{mr:3,onClick:i,children:"Close"}),(0,t.jsx)(B.z,{colorScheme:"blue",onClick:()=>{if(!l)return;let e=new Date,n="recce-screenshot-".concat((0,nl.WU)(e,"yyyy-MM-dd-HH-mm-ss"),".png");ie()(l,n),i()},children:"Download"})]})]})]})}}}(),b=async()=>{var e,i;if(!f.current)throw console.error("No node to use for screenshot"),Error("No node to use for screenshot");let t=null!==(e=f.current.element)&&void 0!==e?e:f.current,c=t.style.overflow,d=t.style.border,u=t.style.borderRadius,h=t.style.backgroundColor,p=t.style.height;try{t.style.overflow="hidden",t.style.border=o?s:"",t.style.borderRadius=o?a:"",t.style.backgroundColor=null!=l?l:"",t.style.height="".concat(String(t.offsetHeight),"px");let e=document.createElement("style");document.head.appendChild(e),null===(i=e.sheet)||void 0===i||i.insertRule("body > div:last-child img { display: inline-block; }"),m("loading");let c="html2canvas"===n?await n9()(t,{logging:!1,backgroundColor:null,ignoreElements:x}):await (0,n8.rT)(t,{filter:x?e=>!x(e):void 0});e.remove();let d=r?document.createElement("canvas"):c;if(r){d.width=c.width+80,d.height=c.height+80;let e=d.getContext("2d");if(e)e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=20,e.shadowOffsetX=10,e.shadowOffsetY=10,e.drawImage(c,40,40);else throw console.error("Error getting canvas context"),Error("Error getting canvas context to add shadow effect")}let u=await fetch(d.toDataURL());return await u.blob()}catch(e){throw console.error("Error converting to image",e),e}finally{t.style.overflow=c,t.style.border=d,t.style.borderRadius=u,t.style.backgroundColor=h,t.style.height=p}};return{status:p,isLoading:"loading"===p,isErrored:"error"===p,isSuccess:"success"===p,copyToClipboard:async()=>{try{await navigator.clipboard.write([new ClipboardItem({["image/".concat(i)]:b()})]),m("success"),c&&c()}catch(e){"ClipboardItem is not defined"===e.message?(j(await b()),g(),m("success")):(m("error"),console.error("Error copying to clipboard",e),h&&h(e))}},ImageDownloadModal:y,ref:f}}function il(e){var n;let{successToast:i,failToast:l}=e0(),{isLoading:o,copyToClipboard:r,ImageDownloadModal:s,ref:a}=it({imageType:"png",shadowEffect:!0,backgroundColor:null!==(n=null==e?void 0:e.backgroundColor)&&void 0!==n?n:null,onSuccess:()=>{i("Copied the query result as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),l("Failed to copy image to clipboard",e)}}),c=(0,v.useCallback)(()=>{if(a.current){var e;let n=null!==(e=a.current.element)&&void 0!==e?e:a.current;n.style.boxShadow="rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px",n.style.transition="box-shadow 0.5s ease-in-out"}},[a]),d=(0,v.useCallback)(()=>{if(a.current){var e;(null!==(e=a.current.element)&&void 0!==e?e:a.current).style.boxShadow=""}},[a]),u=(0,v.useCallback)(async()=>{if(a.current){var e;await r(),(null!==(e=a.current.element)&&void 0!==e?e:a.current).style.boxShadow=""}else l("Failed to copy image to clipboard","No content to copy")},[a,r,l]);return{ref:a,CopyToClipboardButton:function(e){let{imageType:n="png",...i}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(B.z,{size:"sm",leftIcon:(0,t.jsx)(ei.T,{}),style:{position:"absolute",bottom:"16px",right:"16px"},isLoading:o,onMouseEnter:c,onMouseLeave:d,onClick:u,children:"Copy to Clipboard"}),(0,t.jsx)(s,{})]})},onMouseEnter:c,onMouseLeave:d,onCopyToClipboard:u}}function io(e){let n=new Date,i=new Date;return(i.setDate(n.getDate()-1),null==e)?null:n.toDateString()===e.toDateString()?"Today, "+(0,nl.WU)(e,"HH:mm"):i.toDateString()===e.toDateString()?"Yesterday, "+(0,nl.WU)(e,"HH:mm"):(0,nl.WU)(e,"MMM d, HH:mm")}let ir=e=>{let{run:n}=e,i="running"===n.status,l=n.status;!l&&(n.result?l="finished":n.error&&(l="failed"));let o="",r="";"successful"===l||"finished"===l?(o="green",r="Finished"):"failed"===l?(o="red",r="Failed"):"cancelled"===l?(o="gray",r="Cancelled"):"running"===l?(o="blue",r="Running"):(o="green",r="Finished");let s=n.run_at?io(new Date(n.run_at)):null;return(0,t.jsxs)(d.k,{justifyContent:"start",fontSize:"11pt",color:"gray.500",gap:"3px",alignItems:"center",overflow:"hidden",children:[i&&(0,t.jsx)(ev.$,{size:"xs",color:"".concat(o,".400")}),(0,t.jsx)(K.x,{fontWeight:500,color:"".concat(o,".400"),children:r}),(0,t.jsx)(K.x,{children:"•"}),(0,t.jsx)(K.x,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:s})]})},is=e=>{var n;return(0,t.jsxs)(d.k,{flex:"1",minH:"48px",m:"4px",px:"16px",py:"12px",bg:"blue.50",border:"1px",borderRadius:"4px",borderColor:"blue.400",align:null!==(n=e.align)&&void 0!==n?n:"center",gap:"12px",children:[(0,t.jsx)(r.J,{as:nF.H33,width:"20px",height:"20px",color:"blue.900"}),e.children,(0,t.jsx)(p.L,{}),(0,t.jsx)(nZ.P,{onClick:e.onClose})]})},ia=()=>(0,t.jsx)(o.r,{href:"https://docs.datarecce.io/get-started/#prepare-dbt-artifacts",isExternal:!0,color:"rgba(49, 130, 206, 1)",fontWeight:"bold",textDecoration:"underline",children:"Learn how"});var ic=i(26727),id=i(85876),iu=i(60146),ih=i(35904),ix=i(81033),ip=i(25690),im={src:"/_next/static/media/reload-image.79aabb7d.svg"};function ig(e){var n;let{handleParentClose:i,ignoreCookie:l=!1}=e,{authed:o}=(0,ek.$)(),{isOpen:r,onOpen:s,onClose:a}=(0,F.q)(),c=null!==(n=iu.Z.get("authState"))&&void 0!==n?n:"pending",[d,h]=(0,v.useState)(l?"pending":c),x=(0,v.useCallback)(()=>{o||r||"pending"!==d?o&&r&&"authenticating"!==d&&(i&&i(),a()):s()},[d,o,i,r,a,s]);function p(){i&&i(),a()}return((0,v.useEffect)(()=>{x()},[x]),"ignored"!==d||l)?(0,t.jsxs)(Z.u_,{size:"lg",isCentered:!0,isOpen:r,onClose:p,children:[(0,t.jsx)(O.Z,{}),(0,t.jsxs)(X.h,{borderRadius:"2xl",children:["authenticating"!==d&&(0,t.jsx)(G.x,{className:"text-center",fontSize:"2xl",children:"Use Recce Cloud for Free"}),"authenticating"===d&&(0,t.jsxs)(G.x,{className:"text-center",children:[(0,t.jsx)(u.E,{className:"mx-auto mb-2",src:im.src}),(0,t.jsx)("div",{children:"Reload to Finish"})]}),"authenticating"!==d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ee.f,{className:"space-y-2 font-light",children:(0,t.jsxs)("ul",{className:"list-inside list-disc",children:[(0,t.jsx)("li",{children:"Share your work with teammates, no setup needed"}),(0,t.jsx)("li",{children:"Reviewers can access it with a link."}),(0,t.jsx)("li",{children:"It’s recommended, but optional."})]})}),(0,t.jsx)(ni.m,{children:(0,t.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,t.jsx)(ix.default,{className:"w-full",href:"".concat(ip.n,"/connect-to-cloud"),target:"_blank",onClick:()=>{h("authenticating")},children:(0,t.jsx)(B.z,{className:"w-full !rounded-lg !font-medium",colorScheme:"brand",rightIcon:(0,t.jsx)(ih.$OI,{}),children:"Use Recce Cloud"})}),(0,t.jsx)(B.z,{className:"!rounded-lg !font-medium",variant:"solid",colorScheme:"gray",size:"sm",onClick:()=>{h("canceled"),p()},children:"Skip"}),(0,t.jsx)(B.z,{className:"!font-medium !text-black",variant:"link",size:"sm",onClick:()=>{p(),iu.Z.set("authState","ignored",{expires:30}),h("ignored")},children:"Snooze for 30 days"})]})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ee.f,{className:"space-y-2 self-center font-light",children:(0,t.jsx)("p",{children:"Reload to complete connection to Recce Cloud"})}),(0,t.jsx)(ni.m,{children:(0,t.jsx)(B.z,{className:"w-full",colorScheme:"brand",onClick:()=>{window.location.reload()},children:"Reload"})})]})]})]}):null}let ij=e=>{let n=n2.ZP.stringify(e,null,2);return(0,t.jsx)(e4.ML,{className:"no-track-pii-safe",height:"100%",language:"yaml",theme:"vs",value:n,options:{extraEditorClassName:"no-track-pii-safe",readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})},iv=e=>{let{runType:n}=e,{isOpen:i,onClose:l}=(0,F.q)({defaultIsOpen:!0});if(!i)return(0,t.jsx)(t.Fragment,{});switch(n){case"row_count":return(0,t.jsx)(is,{onClose:l,children:(0,t.jsxs)(K.x,{children:["Enable row count diffing, and other Recce features, by configuring a base dbt environment to compare against. ",(0,t.jsx)(ia,{})]})});case"profile":return(0,t.jsx)(is,{onClose:l,children:(0,t.jsxs)(K.x,{children:["Enable data-profile diffing, and other Recce features, by configuring a base dbt environment to compare against. ",(0,t.jsx)(ia,{})]})});default:return(0,t.jsx)(t.Fragment,{})}},iy=e=>{let{disableCopyToClipboard:n,onCopyToClipboard:i,onMouseEnter:l,onMouseLeave:o}=e,{authed:r}=(0,ek.$)(),{handleShareClick:s}=(0,id.z)(),[a,c]=(0,v.useState)(!1);return(0,t.jsxs)(A.v,{children:[(0,t.jsx)(H.j,{as:B.z,size:"sm",rightIcon:(0,t.jsx)(n4.v,{}),variant:"outline",children:"Share"}),(0,t.jsxs)(J.q,{minW:"0",children:[(0,t.jsx)(W.s,{fontSize:"14px",icon:(0,t.jsx)(ei.T,{}),onClick:i,onMouseEnter:l,onMouseLeave:o,isDisabled:n,children:"Copy to Clipboard"}),(0,t.jsx)(U.R,{}),r?(0,t.jsx)(W.s,{fontSize:"14px",icon:(0,t.jsx)(ic.eOs,{}),onClick:async()=>{await s(),(0,_.v4)({name:"create"})},children:"Share to Cloud"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(W.s,{fontSize:"14px",icon:(0,t.jsx)(ic.eOs,{}),onClick:()=>{c(!0)},children:"Share"}),a&&(0,t.jsx)(ig,{handleParentClose:()=>{c(!1)},ignoreCookie:!0})]})]})]})},ib=e=>{var n,i,l,o;let{runId:r,onClose:s,isSingleEnvironment:a}=e,{readOnly:c}=(0,ek.$)(),{runAction:u}=(0,ej.$q)(),{error:h,run:j,onCancel:y,isRunning:b}=n5(r),[w,k]=(0,v.useState)(),z=(0,ep.NL)(),[,D]=(0,eZ.TH)(),[R,L]=(0,v.useState)(0),I=(null==j?void 0:j.type)?null===(n=(0,eB.N)(j.type))||void 0===n?void 0:n.RunResultView:void 0,T=(0,v.useCallback)(()=>{var e;u(null!==(e=null==j?void 0:j.type)&&void 0!==e?e:"",null==j?void 0:j.params)},[j,u]),q=null==j?void 0:j.check_id,N=(0,v.useCallback)(()=>{q&&D("/checks/".concat(q))},[q,D]),E=(0,v.useCallback)(async()=>{if(!r)return;let e=await S(r,w);await z.invalidateQueries({queryKey:C.V.checks()}),D("/checks/".concat(e.check_id))},[r,D,z,w]),F=(null==j?void 0:j.type)==="query"||(null==j?void 0:j.type)==="query_diff"||(null==j?void 0:j.type)==="query_base",{ref:O,onCopyToClipboard:M,onMouseEnter:V,onMouseLeave:A}=il(),H=!r||!(null==j?void 0:j.result)||!!h||0!==R;return(0,t.jsxs)(d.k,{direction:"column",children:[a&&(0,t.jsx)(iv,{runType:null==j?void 0:j.type}),(0,t.jsx)(m.m,{tabIndex:R,onChange:L,flexDirection:"column",mb:"1px",children:(0,t.jsxs)(f.t,{height:"50px",children:[(0,t.jsx)(g.O,{children:"Result"}),(0,t.jsx)(g.O,{children:"Params"}),F&&(0,t.jsx)(g.O,{children:"Query"}),(0,t.jsx)(p.L,{}),(0,t.jsxs)(x.U,{overflow:"hidden",children:[j&&(0,t.jsx)(ir,{run:j}),(0,t.jsx)(B.z,{leftIcon:(0,t.jsx)(eo.n,{}),variant:"outline",isDisabled:!r||b||c,size:"sm",onClick:T,children:"Rerun"}),a||c?(0,t.jsx)(B.z,{leftIcon:(0,t.jsx)(ei.T,{}),variant:"outline",isDisabled:!r||!(null==j?void 0:j.result)||!!h||0!==R,onMouseEnter:V,onMouseLeave:A,size:"sm",onClick:M,children:"Copy to Clipboard"}):(0,t.jsx)(iy,{disableCopyToClipboard:H,onCopyToClipboard:async()=>{var e;await M(),(0,_.nO)({type:null!==(e=null==j?void 0:j.type)&&void 0!==e?e:"unknown",from:"run"})},onMouseEnter:V,onMouseLeave:A}),(0,t.jsx)(function(){return a?(0,t.jsx)(t.Fragment,{}):(null==j?void 0:j.check_id)?(0,t.jsx)(B.z,{leftIcon:(0,t.jsx)(n6.n,{}),isDisabled:!r||!j.result||!!h,size:"sm",colorScheme:"blue",onClick:N,children:"Go to Check"}):(0,t.jsx)(B.z,{leftIcon:(0,t.jsx)(n6.n,{}),isDisabled:!r||!(null==j?void 0:j.result)||!!h,size:"sm",colorScheme:"blue",onClick:E,children:"Add to Checklist"})},{}),(0,t.jsx)(nZ.P,{onClick:()=>{s&&s()}})]})]})}),0===R&&(0,t.jsx)(n_,{ref:O,error:h,run:j,onCancel:y,viewOptions:w,onViewOptionsChanged:k,RunResultView:I}),1===R&&j&&(0,t.jsx)(ij,{type:j.type,params:j.params}),2===R&&j&&((null===(i=j.params)||void 0===i?void 0:i.base_sql_template)?(0,t.jsx)(ny,{value:j.params.sql_template,baseValue:j.params.base_sql_template,options:{readOnly:!0}}):(0,t.jsx)(nv,{value:null!==(o=null===(l=j.params)||void 0===l?void 0:l.sql_template)&&void 0!==o?o:"",options:{readOnly:!0}}))]})},iw=e=>{let{onClose:n,isSingleEnvironment:i}=e,{runId:l}=(0,ej.$q)();return(0,t.jsx)(ib,{runId:l,onClose:n,isSingleEnvironment:i})};async function ik(e,n){return await (0,nb.g9)("query",e,n)}async function iC(e,n){return await (0,nb.g9)("query_base",e,n)}async function i_(e,n){return await (0,nb.g9)("query_diff",e,n)}var iS=i(83644),iz=i(82443),iD=i(17401);let iR=e=>{var n;let{defaultValues:i,suggestionList:o,onValuesChange:s,className:a}=e,[c,d]=(0,v.useState)(null!=i?i:[]),[u,h]=(0,v.useState)(""),[x,p]=(0,v.useState)(!1),m=(0,v.useRef)(null),f=e=>{c.includes(e)||(h(""),d([...c,e]),s([...c,e]))},g=null!==(n=null==o?void 0:o.filter(e=>""===u||e.includes(u)).filter(e=>!c.includes(e)))&&void 0!==n?n:[];return(0,t.jsxs)(iS.B,{size:e.size,width:e.width,className:a,children:[(0,t.jsxs)(A.v,{isLazy:!0,closeOnSelect:!1,onOpen:()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.focus()},children:[(0,t.jsxs)(H.j,{width:"100%",children:[(0,t.jsx)(ed.I,{className:"no-track-pii-safe",placeholder:e.placeholder,size:e.size,borderRadius:"4px",value:c.length>1?"".concat(c.length," ").concat(e.unitName,"s selected"):1===c.length?c[0]:"",onChange:()=>{},backgroundColor:"white"}),0===c.length&&(0,t.jsx)(iz.x,{children:(0,t.jsx)(r.J,{as:eA.RiI,color:"blue.500",fontSize:e.size,mt:"1",mr:"6"})})]}),(0,t.jsx)(ey.h,{children:(0,t.jsxs)(J.q,{zIndex:"popover",fontSize:e.size,width:e.width,className:"no-track-pii-safe",children:[(0,t.jsx)(eb.k,{children:(0,t.jsxs)(iD.E,{border:"1px solid #e2e8f0",borderRadius:"4px",width:"calc(100% - 8px)",marginX:"4px",padding:"4px",children:[c.map((n,i)=>(0,t.jsx)(iD.U,{children:(0,t.jsxs)(V.Vp,{size:e.size,children:[(0,t.jsx)(V.Sn,{paddingLeft:"8px",children:n}),(0,t.jsx)(V.SD,{paddingRight:"8px",onClick:()=>{d(c.filter(e=>e!==n)),s(c.filter(e=>e!==n))}})]},n)},"tag-".concat(i))),(0,t.jsx)(iD.U,{width:"100%",children:(0,t.jsx)(ed.I,{ref:m,placeholder:"Filter or add custom keys",variant:"unstyled",size:e.size,value:u,onChange:e=>{h(e.target.value),p(!0)},onKeyDown:e=>{let n=e.currentTarget.value.trim().replace(",","");switch(e.key){case",":case"Enter":f(n),h("");break;case"Backspace":""===e.currentTarget.value&&c.length>0&&(d(c.slice(0,-1)),s(c.slice(0,-1)))}},onBlur:()=>{m.current&&x&&m.current.focus()}})})]})}),(0,t.jsx)(U.R,{}),(0,t.jsxs)(eb.k,{children:[""!==u&&!(null==o?void 0:o.includes(u))&&(0,t.jsxs)(W.s,{onClick:()=>{f(u),p(!1)},children:["Add '",u,"' to the list"]},"custom-value-by-filter"),g.map((e,n)=>(0,t.jsx)(W.s,{onClick:()=>{f(e)},children:e},"option-".concat(n))).slice(0,10),g.length>10&&(0,t.jsx)(M.u,{label:"Please use filter to find more items",placement:"top",children:(0,t.jsxs)(l.x,{px:"12px",color:"gray",fontSize:"8pt",children:["and ",g.length-10," more items..."]})})]})]})})]}),c.length>0&&(0,t.jsx)(iz.x,{children:(0,t.jsx)(B.z,{variant:"link",color:"#3182CE",fontSize:e.size,paddingTop:"4px",paddingRight:"24px",onClick:()=>{h(""),d([]),s([])},children:"Clear"})})]})};var iL=i(7673),iI=i(19835);let iT=e=>{let{defaultPrimaryKeys:n,onPrimaryKeysChange:i,...l}=e,{lineageGraph:o,isActionAvailable:r}=(0,ef.kJ)(),s=(0,v.useMemo)(()=>{if(!o)return[];let e=new Set;for(let t in o.nodes){var n,i;let l=o.nodes[t],r=null===(n=l.data.base)||void 0===n?void 0:n.columns,s=null===(i=l.data.current)||void 0===i?void 0:i.columns;for(let n in r)e.add(n);for(let n in s)e.add(n)}return Array.from(e).sort()},[o]);return(0,t.jsx)(d.k,{...l,children:(0,t.jsxs)(iL.NI,{m:"4px 8px",children:[(0,t.jsxs)(iI.l,{fontSize:"8pt",margin:"0",children:["Diff with Primary Key(s) (suggested)"," ",(0,t.jsx)(M.u,{label:"Provide a primary key to perform query diff in data warehouse and only return changed rows.",placement:"bottom-end",children:(0,t.jsx)(nq.s,{color:"gray.600",boxSize:"3"})})]}),(0,t.jsx)(iR,{className:"no-track-pii-safe",unitName:"key",defaultValues:n,suggestionList:s,onValuesChange:i,size:"xs",width:"240px",placeholder:"Select or type to add keys",isDisabled:!r("query_diff_with_primary_key")})]})})};var iq=i(32934),iN=i(15926);function iE(e){let{description:n,onLike:i,onDislike:l,onClickLink:r,externalLink:s,externalLinkText:a}=e;return(0,t.jsxs)(d.k,{gap:4,justifyContent:"center",alignContent:"center",alignItems:"center",children:[n,(0,t.jsx)(P.h,{"aria-label":"thumbs up",variant:"ghost",icon:(0,t.jsx)(u.E,{src:"/imgs/feedback/thumbs-up.png",alt:"like"}),width:"32px",height:"32px",onClick:i}),(0,t.jsx)(P.h,{"aria-label":"thumbs down",variant:"ghost",icon:(0,t.jsx)(u.E,{src:"/imgs/feedback/thumbs-down.png",alt:"dislike"}),width:"32px",height:"32px",onClick:l}),s&&a&&(0,t.jsx)(o.r,{href:s,isExternal:!0,textDecoration:"underline",onClick:r,children:a})]})}let iF="recce-",iO={bypassSaveOverwrite:"".concat(iF,"-bypass-save-overwrite"),previewChangeFeedbackID:"".concat(iF,"-preview-change-feedback"),prepareEnvGuideID:"".concat(iF,"-prepare-env")};function iM(e){let{current:n,primaryKeys:i,setPrimaryKeys:o,onRunResultOpen:s,runQuery:a,isPending:c}=e;return(0,t.jsxs)(d.k,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,t.jsxs)(l.x,{children:[(0,t.jsxs)(h.X,{as:"h2",size:"md",display:"flex",alignItems:"center",gap:"5px",children:[(0,t.jsx)(r.J,{as:iq.vc4,boxSize:"1.2em"}),"Sandbox"]}),(0,t.jsxs)(K.x,{fontSize:"xs",color:"gray.500",children:["Compare the run results based on the modified SQL code of model ",(0,t.jsx)("b",{children:null==n?void 0:n.name})]})]}),(0,t.jsx)(p.L,{}),(0,t.jsx)(iT,{defaultPrimaryKeys:i,onPrimaryKeysChange:o}),(0,t.jsx)(M.u,{label:"Run diff to see the changes",children:(0,t.jsx)(B.z,{size:"xs",marginTop:"16px",fontSize:"14px",onClick:()=>{s(),a()},colorScheme:"blue",isLoading:c,children:"Run Diff"})})]})}function iV(e){var n,i,l,o;let{currentModelID:r,height:s="32px",flex:a="0 0 auto"}=e,{lineageGraph:c,envInfo:u}=(0,ef.kJ)(),h="0 16px",x=np(null!==(l=null==u?void 0:null===(i=u.dbt)||void 0===i?void 0:null===(n=i.current)||void 0===n?void 0:n.generated_at)&&void 0!==l?l:""),p=(0,nS.Q)(x,{addSuffix:!0}),m="N/A";if(null==c?void 0:c.nodes[r]){let e=c.nodes[r];(null===(o=e.data.current)||void 0===o?void 0:o.schema)&&(m=e.data.current.schema)}return(0,t.jsxs)(d.k,{gap:0,height:s,flex:a,fontSize:"14px",align:"center",margin:"0",backgroundColor:"#EDF2F880",children:[(0,t.jsx)(e2.K,{width:"50%",children:(0,t.jsxs)(K.x,{as:"b",margin:h,children:["ORIGINAL (Schema: ",m,", Last Updated: ",p,")"]})}),(0,t.jsx)(e2.K,{width:"50%",children:(0,t.jsx)(K.x,{as:"b",margin:h,children:"SANDBOX EDITOR"})})]})}function iA(e){var n;let{current:i,onChange:o}=e,r=function(e,n){let i=(0,v.useRef)(null);return(0,v.useEffect)(()=>{i.current&&e!==i.current.getValue()&&i.current.setValue(e)},[e]),{onMount(e){let t=e.getModifiedEditor();i.current=t,t.onDidChangeModelContent(()=>{n(t.getValue())})}}}(null!==(n=null==i?void 0:i.raw_code)&&void 0!==n?n:"",o);return(0,t.jsx)(l.x,{flex:1,overflowY:"auto",children:(0,t.jsx)(e4.SV,{language:"sql",theme:"vs",original:null==i?void 0:i.raw_code,modified:null==i?void 0:i.raw_code,options:{readOnly:!1,fontSize:14,lineNumbers:"on",automaticLayout:!0,renderOverviewRuler:!1,minimap:{enabled:!0}},onMount:r.onMount})})}function iH(e){var n,i;let{isOpen:r,onClose:c,current:p}=e,{isOpen:m,onClose:f,onOpen:g}=(0,F.q)(),[j,y]=(0,v.useState)(null!==(n=null==p?void 0:p.raw_code)&&void 0!==n?n:""),{showRunId:b,clearRunResult:w}=(0,ej.$q)(),{primaryKeys:k,setPrimaryKeys:C}=(0,nX.rV)(),{data:S,isLoading:z}=(0,n1.P)(),D=async()=>{var e;let n={current_model:null!==(e=null==p?void 0:p.name)&&void 0!==e?e:"",primary_keys:k,sql_template:j},{run_id:i}=await i_(n,{nowait:!0});return b(i),await (0,nb.Qp)(i)},{mutate:R,isPending:L}=(0,em.D)({mutationFn:D,onSuccess(e,n){e.error?(0,_.B2)({action:"run",node:null==p?void 0:p.name,status:"failure"}):((0,_.B2)({action:"run",node:null==p?void 0:p.name,status:"success"}),setTimeout(()=>{I()},1e3),!z&&(null==S?void 0:S.single_env_onboarding)&&setTimeout(()=>{q()},2e3))}}),{feedbackToast:I,closeToast:T}=function(e){let n=(0,s.p)(),{feedbackId:i,description:l,onFeedbackSubmit:o,externalLink:r,externalLinkText:a}=e;return{feedbackToast:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=localStorage.getItem(i);!n.isActive(i)&&("true"!==s||e)&&n({id:i,position:"bottom-right",duration:null,render:e=>{let{id:n,onClose:s}=e;return(0,t.jsx)(eR.b,{status:"success",variant:"subtle",zIndex:"toast",borderColor:"gray.200",borderWidth:3,borderRadius:"md",backgroundColor:"white",opacity:1,children:(0,t.jsx)(iN.X,{fontSize:"md",children:(0,t.jsxs)(x.U,{children:[(0,t.jsx)(iE,{description:l,onLike:()=>{o("like"),s(),localStorage.setItem(i,"true")},onDislike:()=>{o("dislike"),s(),localStorage.setItem(i,"true")},externalLink:r,externalLinkText:a,onClickLink:()=>{o("link")}}),(0,t.jsx)(nZ.P,{onClick:()=>{s()}})]})})})}})},closeToast:()=>{n.closeAll()}}}({feedbackId:iO.previewChangeFeedbackID,description:"Enjoy preview change?",onFeedbackSubmit:e=>{switch(e){case"like":(0,_.FF)({feedback:"like",node:null==p?void 0:p.name});break;case"dislike":(0,_.FF)({feedback:"dislike",node:null==p?void 0:p.name});break;case"link":(0,_.FF)({feedback:"form",node:null==p?void 0:p.name});break;default:console.log("Not support feedback type")}},externalLink:"https://docs.google.com/forms/d/e/1FAIpQLSd7Lei7Ijwo7MinWaI0K6rzZi_21gV1BKetmiNEX254kDziDA/viewform?usp=header",externalLinkText:"Give us feedback"}),{guideToast:q,closeGuideToast:N}=function(e){let n=(0,s.p)(),{guideId:i,description:l,externalLink:r,externalLinkText:a,onExternalLinkClick:c}=e;return{guideToast:function(){n.isActive(i)||n({id:i,position:"bottom-right",duration:3e3,description:"some text",render:e=>{let{id:n,onClose:i}=e;return(0,t.jsx)(eR.b,{status:"success",variant:"subtle",zIndex:"toast",borderColor:"gray.200",borderWidth:3,borderRadius:"md",backgroundColor:"white",opacity:1,children:(0,t.jsx)(iN.X,{fontSize:"md",children:(0,t.jsxs)(x.U,{children:[(0,t.jsxs)(K.x,{children:[l," ",(0,t.jsx)(o.r,{textDecor:"underline",isExternal:!0,href:r,onClick:()=>{c&&c(),i()},children:a})]}),(0,t.jsx)(nZ.P,{onClick:()=>{i()}})]})})})}})},closeGuideToast:()=>{n.closeAll()}}}({guideId:iO.prepareEnvGuideID,description:"Want to compare data changes with production data?",externalLink:"https://docs.datarecce.io/get-started/#prepare-dbt-artifacts",externalLinkText:"Learn how.",onExternalLinkClick:()=>{(0,_.BA)({action:"external_link",from:"preview_changes",node:null==p?void 0:p.name})}});return(0,v.useEffect)(()=>{if(r){var e;y(null!==(e=null==p?void 0:p.raw_code)&&void 0!==e?e:"")}},[r,p]),(0,t.jsx)(Z.u_,{isOpen:r,size:"full",onClose:()=>{c(),f(),w(),T(),N(),(0,_.B2)({action:"close",node:null==p?void 0:p.name})},children:(0,t.jsxs)(X.h,{height:"100%",children:[(0,t.jsx)(G.x,{height:"40px",bg:"rgb(77, 209, 176)",px:0,py:4,children:(0,t.jsxs)(d.k,{alignItems:"center",height:"100%",gap:"10px",children:[(0,t.jsx)(u.E,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,t.jsx)(h.X,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,t.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:"Experiment"})]})}),(0,t.jsx)(Y.o,{}),(0,t.jsx)(ee.f,{p:0,children:(0,t.jsxs)(eO,{sizes:m?[50,50]:[100,0],minSize:m?100:0,gutterSize:m?5:0,style:{flex:"1",contain:"size",height:"100%"},children:[(0,t.jsxs)(d.k,{direction:"column",height:"100%",m:0,p:0,children:[(0,t.jsx)(iM,{current:p,primaryKeys:null!=k?k:[],setPrimaryKeys:C,onRunResultOpen:g,runQuery:R,isPending:L}),(0,t.jsx)(iV,{height:"32pxs",flex:"0 0 auto",currentModelID:null!==(i=null==p?void 0:p.id)&&void 0!==i?i:""}),(0,t.jsx)(iA,{current:p,onChange:y})]}),m?(0,t.jsx)(iw,{onClose:f,disableAddToChecklist:!0}):(0,t.jsx)(l.x,{})]})}),(0,t.jsx)(l.x,{position:"fixed",bottom:"4",right:"4",opacity:.5,children:(0,t.jsx)(M.u,{label:"Give us feedback",children:(0,t.jsx)(P.h,{"aria-label":"feedback",icon:(0,t.jsx)(ex.xJq,{}),variant:"ghost",size:"md",onClick:()=>{I(!0)}})})})]})})}let iP=e=>{var n,i,o,r,s,a;let{node:c}=e,{isOpen:d,onOpen:u,onClose:x}=(0,F.q)(),[p,m]=(0,v.useState)(!1),{data:f,isLoading:g}=(0,n1.P)(),j=null==f?void 0:f.single_env_onboarding;if(g)return(0,t.jsx)(t.Fragment,{});if("model"!==c.resourceType&&"snapshot"!==c.resourceType)return"Not available";let y={readOnly:!0,lineNumbers:"on",automaticLayout:!0,renderOverviewRuler:!1,wordWrap:"off",minimap:{enabled:!1}},b={readOnly:!0,lineNumbers:"on",automaticLayout:!0,wordWrap:"off",minimap:{enabled:!1}},w=null===(n=c.data.base)||void 0===n?void 0:n.raw_code,k=null===(i=c.data.current)||void 0===i?void 0:i.raw_code,C=null!==(a=null!==(s=null===(o=c.data.base)||void 0===o?void 0:o.name)&&void 0!==s?s:null===(r=c.data.current)||void 0===r?void 0:r.name)&&void 0!==a?a:"";return(0,t.jsxs)(l.x,{className:"no-track-pii-safe",style:{position:"relative"},height:"100%",onMouseEnter:()=>{m(!0)},onMouseLeave:()=>{m(!1)},children:[j?(0,t.jsx)(nv,{language:"sql",theme:"vs",value:null!=w?w:"",options:b}):(0,t.jsx)(e4.SV,{language:"sql",theme:"vs",original:w,modified:k,options:{...y,renderSideBySide:!1}}),(0,t.jsx)(P.h,{icon:(0,t.jsx)(eV.Tlm,{}),onClick:u,size:"md","aria-label":"",variant:"ghost",style:{position:"absolute",top:"5px",right:"20px",opacity:p?.5:.1,transition:"opacity 0.3s ease-in-out"}}),(0,t.jsxs)(Z.u_,{isOpen:d,onClose:x,size:"6xl",children:[(0,t.jsx)(O.Z,{}),(0,t.jsxs)(X.h,{overflowY:"auto",height:"75%",children:[(0,t.jsx)(G.x,{children:j?(0,t.jsxs)(h.X,{as:"h1",size:"md",children:[(0,t.jsx)("code",{children:C})," Model Code"]}):(0,t.jsxs)(h.X,{as:"h1",size:"md",children:[(0,t.jsx)("code",{children:C})," Model Code Diff"]})}),(0,t.jsx)(Y.o,{}),(0,t.jsx)(ee.f,{children:j?(0,t.jsx)(e4.ML,{language:"sql",theme:"vs",value:null!=w?w:"",options:{...b,fontSize:16}}):(0,t.jsx)(e4.SV,{language:"sql",theme:"vs",original:w,modified:k,options:{...y,fontSize:16}})})]})]})]})};function iJ(e,n){let i=(0,eg._)(e,n);if(0===i.length)return[];if(0===e.length||0===n.length)return i.map((e,n)=>n===i.length-1?e:e+",");let t="";return i.forEach(i=>{e.includes(i)&&n.includes(i)&&(t=i)}),i.map((l,o)=>{let r;return(r=e.includes(l)?n.includes(l)?l:"--- ".concat(l," (Removed)"):"--- ".concat(l," (Added)"),l===t||o===i.length-1)?r:r+","})}function iW(e){var n,i,o,s;let{node:a,onCloseNode:c}=e,[,u]=(0,eZ.TH)(),{setSqlQuery:j,setPrimaryKeys:y}=(0,nX.rV)(),b="model"===a.resourceType||"seed"===a.resourceType||"source"===a.resourceType||"snapshot"===a.resourceType,{isOpen:w,onOpen:k,onClose:C}=(0,F.q)(),{isOpen:S,onClose:z}=(0,F.q)({defaultIsOpen:!0}),{runAction:D}=(0,ej.$q)(),{envInfo:R,isActionAvailable:L}=(0,ef.kJ)(),{primaryKey:I}=(0,nG.ZP)(a.name),T=()=>{D("row_count",{node_names:[a.name]},{showForm:!1,showLast:!1})},q=()=>{D("row_count_diff",{node_names:[a.name]},{showForm:!1,showLast:!1})},{data:N}=(0,n1.P)(),E=null==N?void 0:N.single_env_onboarding,O=(0,v.useCallback)(async()=>{let e=a.id,n=await nY({node_id:e});u("/checks/".concat(n.check_id))},[a,u]),V=(e,n)=>e?n0.add_or_remove:L(n)?"":"This action is not supported yet.",P="added"===a.changeStatus||"removed"===a.changeStatus,Z=Object.keys(null!==(o=null===(n=a.data.base)||void 0===n?void 0:n.columns)&&void 0!==o?o:{}),X=Object.keys(null!==(s=null===(i=a.data.current)||void 0===i?void 0:i.columns)&&void 0!==s?s:{});return(0,t.jsxs)(n$.r,{height:"100%",templateRows:"auto auto 1fr",children:[(0,t.jsxs)(x.U,{children:[(0,t.jsx)(l.x,{flex:"0 1 20%",p:"16px",children:(0,t.jsx)(h.X,{size:"sm",className:"no-track-pii-safe",children:a.name})}),(0,t.jsx)(p.L,{}),E?(0,t.jsx)(function(){var e,n,i;let l=iJ(Z,X),o='select * from {{ ref("'.concat(a.name,'") }}');return(l.length&&(o="select \n  ".concat(l.join("\n  "),'\nfrom {{ ref("').concat(a.name,'") }}')),"model"!==a.resourceType&&"seed"!==a.resourceType&&"snapshot"!==a.resourceType)?(0,t.jsx)(t.Fragment,{}):(0,t.jsxs)(A.v,{children:[(0,t.jsx)(H.j,{as:B.z,size:"xs",variant:"outline",rightIcon:(0,t.jsx)(n4.v,{}),children:"Explore"}),(0,t.jsxs)(J.q,{children:[(0,t.jsx)(W.s,{icon:(0,t.jsx)(r.J,{as:null===(e=(0,eB.N)("query"))||void 0===e?void 0:e.icon}),fontSize:"14px",onClick:()=>{(null==R?void 0:R.adapterType)==="dbt"?j(o):(null==R?void 0:R.adapterType)==="sqlmesh"&&j("select * from ".concat(a.name)),u("/query")},children:"Query"}),(0,t.jsx)(W.s,{icon:(0,t.jsx)(r.J,{as:null===(n=(0,eB.N)("row_count"))||void 0===n?void 0:n.icon}),fontSize:"14px",onClick:()=>{T()},children:"Row Count"}),(0,t.jsx)(M.u,{label:V(P,"profile"),placement:"left",children:(0,t.jsx)(W.s,{icon:(0,t.jsx)(r.J,{as:null===(i=(0,eB.N)("profile"))||void 0===i?void 0:i.icon}),fontSize:"14px",isDisabled:P,onClick:()=>{D("profile",{model:a.name},{showForm:!0,showLast:!1})},children:"Profile"})})]})]})},{}):(0,t.jsx)(function(){var e,n,i,l,o,s,c,d;let h=iJ(Z,X),x='select * from {{ ref("'.concat(a.name,'") }}');h.length&&(x="select \n  ".concat(h.join("\n  "),'\nfrom {{ ref("').concat(a.name,'") }}'));let{readOnly:p}=(0,ek.$)();return"model"!==a.resourceType&&"seed"!==a.resourceType&&"snapshot"!==a.resourceType?(0,t.jsx)(t.Fragment,{}):(0,t.jsxs)(A.v,{children:[(0,t.jsx)(H.j,{as:B.z,size:"xs",variant:"outline",rightIcon:(0,t.jsx)(n4.v,{}),isDisabled:p,children:"Explore"}),(0,t.jsxs)(J.q,{children:[(0,t.jsx)(W.s,{icon:(0,t.jsx)(r.J,{as:null===(e=(0,eB.N)("query_diff"))||void 0===e?void 0:e.icon}),fontSize:"14px",onClick:()=>{(null==R?void 0:R.adapterType)==="dbt"?j(x):(null==R?void 0:R.adapterType)==="sqlmesh"&&j("select * from ".concat(a.name)),L("query_diff_with_primary_key")&&y(void 0!==I?[I]:void 0),u("/query")},children:"Query"}),(0,t.jsx)(W.s,{fontSize:"14px",icon:(0,t.jsx)(r.J,{as:null===(n=(0,eB.N)("sandbox"))||void 0===n?void 0:n.icon}),onClick:()=>{L("query_diff_with_primary_key")&&y(void 0!==I?[I]:void 0),k(),(0,_.B2)({action:"explore",node:a.name})},children:"Sandbox (Experiment)"}),(0,t.jsx)(U.R,{}),(0,t.jsxs)(eb.k,{title:"Diff",m:"0",p:"4px 12px",children:[(0,t.jsx)(W.s,{icon:(0,t.jsx)(r.J,{as:null===(i=(0,eB.N)("row_count_diff"))||void 0===i?void 0:i.icon}),fontSize:"14px",onClick:()=>{q()},children:"Row Count Diff"}),(0,t.jsx)(M.u,{label:V(P,"profile_diff"),placement:"left",children:(0,t.jsx)(W.s,{icon:(0,t.jsx)(r.J,{as:null===(l=(0,eB.N)("profile_diff"))||void 0===l?void 0:l.icon}),fontSize:"14px",isDisabled:P,onClick:()=>{D("profile_diff",{model:a.name},{showForm:!0,showLast:!1})},children:"Profile Diff"})}),(0,t.jsx)(M.u,{label:V(P,"value_diff"),placement:"left",children:(0,t.jsx)(W.s,{icon:(0,t.jsx)(r.J,{as:null===(o=(0,eB.N)("value_diff"))||void 0===o?void 0:o.icon}),fontSize:"14px",isDisabled:P,onClick:()=>{D("value_diff",{model:a.name},{showForm:!0,showLast:!1})},children:"Value Diff"})}),(0,t.jsx)(M.u,{label:V(P,"top_k_diff"),placement:"left",children:(0,t.jsx)(W.s,{icon:(0,t.jsx)(r.J,{as:null===(s=(0,eB.N)("top_k_diff"))||void 0===s?void 0:s.icon}),fontSize:"14px",isDisabled:P,onClick:()=>{D("top_k_diff",{model:a.name,column_name:"",k:50},{showForm:!0})},children:"Top-K Diff"})}),(0,t.jsx)(M.u,{label:V(P,"histogram_diff"),placement:"left",children:(0,t.jsx)(W.s,{icon:(0,t.jsx)(r.J,{as:null===(c=(0,eB.N)("histogram_diff"))||void 0===c?void 0:c.icon}),fontSize:"14px",isDisabled:P,onClick:()=>{D("histogram_diff",{model:a.name,column_name:"",column_type:""},{showForm:!0})},children:"Histogram Diff"})})]}),(0,t.jsx)(U.R,{}),(0,t.jsx)(eb.k,{title:"Add to Checklist",m:"0",p:"4px 12px",children:(0,t.jsx)(W.s,{icon:(0,t.jsx)(r.J,{as:null===(d=(0,eB.N)("schema_diff"))||void 0===d?void 0:d.icon}),fontSize:"14px",onClick:()=>{O()},children:"Schema Diff"})})]})]})},{}),(0,t.jsx)(l.x,{flex:"0 1 1%",children:(0,t.jsx)(nZ.P,{onClick:c})})]}),(0,t.jsx)(l.x,{color:"gray",paddingLeft:"16px",children:(0,t.jsxs)(x.U,{spacing:"8px",children:[(0,t.jsx)(nV,{node:a}),("model"===a.resourceType||"snapshot"===a.resourceType||"seed"===a.resourceType)&&(E?(0,t.jsx)(nP,{node:a,onRefresh:T}):(0,t.jsx)(nH,{node:a,onRefresh:q}))]})}),b&&(0,t.jsxs)(m.m,{overflow:"auto",as:d.k,children:[E&&S&&(0,t.jsx)(l.x,{p:"12px",children:(0,t.jsx)(is,{onClose:z,align:"flex-start",children:(0,t.jsxs)(K.x,{children:["Enable the Recce Checklist and start adding checks for better data validation and review.",(0,t.jsx)("br",{}),(0,t.jsx)(ia,{})]})})}),(0,t.jsxs)(f.t,{children:[(0,t.jsx)(g.O,{children:"Columns"}),(0,t.jsx)(g.O,{children:"Code"})]}),(0,t.jsxs)(Q.n,{overflow:"auto",height:"calc(100% - 42px)",children:[(0,t.jsx)($.x,{p:0,overflowY:"auto",height:"100%",children:E?(0,t.jsx)(eq,{current:a.data.current}):(0,t.jsx)(eT,{base:a.data.base,current:a.data.current})}),(0,t.jsx)($.x,{height:"100%",p:0,children:(0,t.jsx)(iP,{node:a})})]})]}),(0,t.jsx)(iH,{isOpen:w,onClose:C,current:a.data.current})]})}function iK(e){var n,i;let{onClose:o}=e,{cancel:r,actionState:s}=e_();return(0,t.jsx)(l.x,{bg:"white",rounded:"md",shadow:"dark-lg",children:(0,t.jsxs)(x.U,{p:"5px 15px",mt:"4",divider:(0,t.jsx)(nD.c,{borderColor:"gray.200"}),spacing:4,children:[(0,t.jsxs)(l.x,{fontSize:"10pt",children:["Progress: ","per_node"===s.mode?"".concat(s.completed," / ").concat(s.total):(null===(i=s.currentRun)||void 0===i?void 0:null===(n=i.progress)||void 0===n?void 0:n.percentage)?"".concat(100*s.currentRun.progress.percentage,"%"):"completed"===s.status?"100%":"0%"," ","canceled"===s.status?" (canceled)":""]}),"running"===s.status||"canceling"===s.status?(0,t.jsx)(B.z,{size:"xs",variant:"outline",onClick:r,isLoading:"canceling"===s.status,loadingText:"Canceling",children:"Cancel"}):(0,t.jsx)(x.U,{children:(0,t.jsx)(B.z,{size:"xs",variant:"outline",onClick:o,children:"Close"})})]})})}var iU=i(87915),iB=i(71085);let iQ=()=>(0,t.jsxs)(q.g,{align:"start",spacing:0,children:[(0,t.jsx)(K.x,{fontSize:"10pt",color:"gray.500",pb:1,children:"Select nodes by dbt node selector syntax"}),(0,t.jsxs)(K.x,{fontSize:"8pt",children:[(0,t.jsx)(c.E,{fontSize:"8pt",children:"model_name"})," Select a node"]}),(0,t.jsxs)(K.x,{fontSize:"8pt",children:[(0,t.jsx)(c.E,{fontSize:"8pt",children:"model_name+"})," Select downstream nodes"]}),(0,t.jsxs)(K.x,{fontSize:"8pt",children:[(0,t.jsx)(c.E,{fontSize:"8pt",children:"+model_name"})," Select upstream nodes"]}),(0,t.jsxs)(K.x,{fontSize:"8pt",children:[(0,t.jsx)(c.E,{fontSize:"8pt",children:"model*"})," Select by wildcard"]})]}),i$=()=>{let{isHistoryOpen:e,showHistory:n,closeHistory:i}=(0,ej.$q)();return(0,t.jsx)(B.z,{leftIcon:(0,t.jsx)(r.J,{as:ex.M1Q}),size:"xs",variant:"outline",onClick:()=>{e?((0,_.U8)({name:"hide"}),i()):((0,_.U8)({name:"show"}),n())},children:e?"Hide":"Show"})},iZ=e=>{var n;let{isDisabled:i}=e,{viewOptions:l,onViewOptionsChanged:o}=e_(),s=null!==(n=l.view_mode)&&void 0!==n?n:"changed_models",a=e=>{o({...l,view_mode:e})};return(0,t.jsxs)(A.v,{children:[(0,t.jsx)(H.j,{as:B.z,minWidth:"100px",leftIcon:(0,t.jsx)(r.J,{as:eK("model").icon}),size:"xs",variant:"outline",isDisabled:i,rightIcon:(0,t.jsx)(n4.v,{}),children:"changed_models"===s?"Changed Models":"All"}),(0,t.jsxs)(J.q,{title:"packages",children:[(0,t.jsx)(W.s,{as:iU.X,size:"sm",isChecked:"changed_models"===s,onChange:()=>{a("changed_models")},children:"Changed Models"}),(0,t.jsx)(W.s,{as:iU.X,size:"sm",isChecked:"all"===s,onChange:()=>{a("all")},children:"All"})]})]})},iX=e=>{var n,i;let{isDisabled:l}=e,{lineageGraph:o}=(0,ef.kJ)(),{viewOptions:s,onViewOptionsChanged:a}=e_(),c=new Set;for(let e of Object.values(null!==(i=null==o?void 0:o.nodes)&&void 0!==i?i:{}))e.packageName&&c.add(e.packageName);let d=null==o?void 0:null===(n=o.manifestMetadata.current)||void 0===n?void 0:n.project_name,u=s.packages?new Set(s.packages):d?new Set([d]):c,h=u.size===c.size,x=0===u.size,p=1===u.size?Array.from(u)[0]:h?"All Packages":x?"No Package":"".concat(u.size," Packages"),m=e=>{let n=new Set(u);n.has(e)?n.delete(e):n.add(e),a({...s,packages:Array.from(n)})};return(0,t.jsxs)(A.v,{closeOnSelect:!1,children:[(0,t.jsx)(H.j,{as:B.z,minWidth:"100px",leftIcon:(0,t.jsx)(r.J,{as:nF.zFh}),size:"xs",variant:"outline",isDisabled:l,rightIcon:(0,t.jsx)(n4.v,{}),children:p}),(0,t.jsx)(J.q,{title:"packages",children:(0,t.jsxs)(eb.k,{title:"Select Packages",children:[(0,t.jsx)(W.s,{as:iU.X,size:"sm",isIndeterminate:!h&&!x,isChecked:h,onChange:()=>{h?a({...s,packages:[]}):a({...s,packages:Array.from(c)})},children:"Select All"}),(0,t.jsx)(U.R,{}),Array.from(c).map(e=>(0,t.jsx)(W.s,{as:iU.X,size:"sm",isChecked:u.has(e),onChange:()=>{m(e)},children:e},e))]})})]})},iG=e=>{let[n,i]=(0,v.useState)(e.value),{data:l}=(0,n1.P)(),o=(0,v.useRef)(null);return(0,v.useEffect)(()=>{o.current&&(o.current.value=e.value)},[e.value]),(0,t.jsx)(M.u,{width:"300px",padding:2,shadow:"md",borderWidth:1,rounded:"md",styleConfig:{zIndex:"dropdown"},label:e.tooltipComponent,placement:"bottom-start",color:"black",backgroundColor:"white",closeOnClick:!1,isDisabled:!(null==l?void 0:l.single_env_onboarding),children:(0,t.jsx)(ed.I,{ref:o,height:"24px",fontSize:"10pt",placeholder:"with selectors",isDisabled:e.isDisabled,value:n,onChange:e=>{i(e.target.value)},onKeyUp:t=>{"Enter"===t.key?e.onChange(n):"Escape"===t.key&&(t.preventDefault(),i(e.value),o.current&&o.current.blur())},onBlur:()=>{i(e.value)}})})},iY=e=>{var n;let{isDisabled:i}=e,{viewOptions:l,onViewOptionsChanged:o}=e_();return(0,t.jsx)(iG,{isDisabled:i,value:null!==(n=l.select)&&void 0!==n?n:"",onChange:e=>{o({...l,select:e||void 0})},tooltipComponent:(0,t.jsx)(iQ,{})})},i0=e=>{var n;let{isDisabled:i}=e,{viewOptions:l,onViewOptionsChanged:o}=e_();return(0,t.jsx)(iG,{isDisabled:i,value:null!==(n=l.exclude)&&void 0!==n?n:"",onChange:e=>{o({...l,exclude:e||void 0})}})},i1=e=>(0,t.jsxs)(l.x,{style:e.style,maxWidth:"300px",children:[(0,t.jsx)(l.x,{fontSize:"8pt",children:e.label||(0,t.jsx)(t.Fragment,{children:"\xa0"})}),e.children]}),i5=()=>{var e,n,i,l,o;let{deselect:s,focusedNode:a,selectedNodes:c,...d}=e_(),{readOnly:u}=(0,ek.$)(),{data:h}=(0,n1.P)(),m=null==h?void 0:h.single_env_onboarding,f=!!a,g=c.length>0,j=!f&&!g;return(0,t.jsx)(x.U,{width:"100%",padding:"4pt 8pt",children:(0,t.jsxs)(x.U,{flex:"1",children:[(0,t.jsx)(i1,{label:"History",style:{flexShrink:"1"},children:(0,t.jsx)(i$,{})}),(0,t.jsx)(i1,{label:"Mode",style:{flexShrink:"1"},children:(0,t.jsx)(iZ,{isDisabled:g})}),(0,t.jsx)(i1,{label:"Package",style:{flexShrink:"1"},children:(0,t.jsx)(iX,{isDisabled:g})}),(0,t.jsx)(i1,{label:"Select",style:{flex:"100 1 auto"},children:(0,t.jsx)(iY,{isDisabled:g})}),(0,t.jsx)(i1,{label:"Exclude",style:{flex:"100 1 auto"},children:(0,t.jsx)(i0,{isDisabled:g})}),(0,t.jsx)(p.L,{}),g&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i1,{label:"",style:{flexShrink:"0"},children:(0,t.jsx)(K.x,{fontSize:"9pt",color:"gray.500",children:c.length>1?"".concat(c.length," nodes selected"):"".concat(c.length," node selected")})}),(0,t.jsx)(i1,{label:"",children:(0,t.jsx)(B.z,{variant:"outline",size:"xs",fontSize:"9pt",onClick:()=>{s()},children:"Deselect"})}),m&&(0,t.jsx)(i1,{label:"Explore",children:(0,t.jsx)(iB.h,{isAttached:!0,variant:"outline",children:(0,t.jsxs)(A.v,{placement:"bottom-end",children:[(0,t.jsx)(H.j,{as:B.z,size:"xs",rightIcon:(0,t.jsx)(n4.v,{}),children:"Actions"}),(0,t.jsx)(J.q,{children:(0,t.jsx)(W.s,{as:K.x,size:"sm",fontSize:"10pt",isDisabled:!(j||f||g),icon:(0,t.jsx)(r.J,{as:null===(e=(0,eB.N)("row_count_diff"))||void 0===e?void 0:e.icon}),onClick:async()=>{await d.runRowCount()},children:"Row Count"})})]})})})]}),!m&&(0,t.jsx)(i1,{label:"Explore",children:(0,t.jsx)(iB.h,{isAttached:!0,variant:"outline",children:(0,t.jsxs)(A.v,{placement:"bottom-end",children:[(0,t.jsx)(H.j,{as:B.z,size:"xs",rightIcon:(0,t.jsx)(n4.v,{}),isDisabled:u,children:"Actions"}),(0,t.jsxs)(J.q,{children:[(0,t.jsxs)(eb.k,{title:"Diff",m:"0",p:"4px 12px",children:[(0,t.jsx)(W.s,{as:K.x,size:"sm",fontSize:"10pt",isDisabled:!(j||f||g),icon:(0,t.jsx)(r.J,{as:null===(n=(0,eB.N)("row_count_diff"))||void 0===n?void 0:n.icon}),onClick:async()=>{await d.runRowCountDiff()},children:"Row Count Diff"}),(0,t.jsx)(M.u,{placement:"left",children:(0,t.jsx)(W.s,{as:K.x,size:"sm",fontSize:"10pt",isDisabled:!(j||f||g),icon:(0,t.jsx)(r.J,{as:null===(i=(0,eB.N)("value_diff"))||void 0===i?void 0:i.icon}),onClick:async()=>{await d.runValueDiff()},children:"Value Diff"})})]}),(0,t.jsx)(U.R,{}),(0,t.jsxs)(eb.k,{title:"Add to Checklist",m:"0",px:"12px",children:[(0,t.jsx)(W.s,{as:K.x,size:"sm",fontSize:"10pt",isDisabled:!(j||g&&c.length>1),icon:(0,t.jsx)(r.J,{as:null===(l=(0,eB.N)("lineage_diff"))||void 0===l?void 0:l.icon}),onClick:()=>{d.addLineageDiffCheck(d.viewOptions.view_mode)},children:"Lineage Diff"}),(0,t.jsx)(W.s,{as:K.x,size:"sm",fontSize:"10pt",isDisabled:!(j||f||g),icon:(0,t.jsx)(r.J,{as:null===(o=(0,eB.N)("schema_diff"))||void 0===o?void 0:o.icon}),onClick:()=>{d.addSchemaDiffCheck()},children:"Schema Diff"})]})]})]})})})]})})};var i2=i(59787);async function i4(e){return(await k.U.post("/api/checks",{type:"lineage_diff",params:{},view_options:e})).data}function i6(){return(0,t.jsx)(l.x,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[n,[i,l]]=e,{icon:o,color:s}=eW(n);return(0,t.jsx)(M.u,{label:l,placement:"right",children:(0,t.jsxs)(d.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,t.jsx)(r.J,{color:s,as:o})," ",i]})},n)})})}var i3=i(80696);let i9={mode:"per_node",status:"pending",completed:0,total:0,actions:{}},i8=(e,n)=>{let{onActionStarted:i,onActionNodeUpdated:t,onActionCompleted:l}=n,o=(0,v.useRef)({...i9}).current,{showRunId:r}=(0,ej.$q)(),s=async(n,s,a)=>{o.mode="multi_nodes",o.actions={};let c=o.mode,d=o.actions;i(),o.status="running";let u=[];for(let n of e){let e=s(n);e?(d[n.id]={mode:c,status:"skipped",skipReason:e},t(n)):(d[n.id]={mode:c,status:"pending"},u.push(n))}let h=a(u);try{let{run_id:e}=await (0,nb.g9)(n,h,{nowait:!0});for(r(e),o.currentRun={run_id:e},o.total=1;;){let n=await (0,nb.Qp)(e,2);o.currentRun=n;let i=n.error?"failure":n.result?"success":"running";for(let e of u)d[e.id]={mode:c,status:i,run:n},t(e);if(n.error||n.result)break}}catch(e){}if(o.completed=1,"canceling"===o.status){o.status="canceled",l();return}o.status="completed",l()},a=async(n,r)=>{o.mode="per_node",o.actions={};let s=o.mode,a=o.actions;for(let n of(i(),o.status="running",e))a[n.id]={mode:s,status:"pending"},t(n);for(let i of(o.completed=0,o.total=e.length,e)){let{params:e,skipReason:c}=r(i);if(c)a[i.id]={mode:s,status:"skipped",skipReason:c},t(i);else try{let{run_id:l}=await (0,nb.g9)(n,e,{nowait:!0});for(o.currentRun={run_id:l},a[i.id]={mode:s,status:"running"},t(i);;){let e=await (0,nb.Qp)(l,2);o.currentRun=e;let n=e.error?"failure":e.result?"success":"running";if(a[i.id]={mode:s,status:n,run:e},t(i),e.error||e.result)break}}catch(e){}finally{o.currentRun=void 0}if(o.completed++,"canceling"===o.status){o.status="canceled",l();return}}o.status="completed",l()},c=async()=>{let n=[];for(let i of e)"model"!==i.resourceType?(o.actions[i.id]={mode:"multi_nodes",status:"skipped",skipReason:"Not a model"},t(i)):n.push(i.name);await s("row_count",e=>{if("model"!==e.resourceType)return"Not a model"},e=>({node_names:e.map(e=>e.name)}))},d=async()=>{let n=[];for(let i of e)"model"!==i.resourceType?(o.actions[i.id]={mode:"multi_nodes",status:"skipped",skipReason:"Not a model"},t(i)):n.push(i.name);await s("row_count_diff",e=>{if("model"!==e.resourceType)return"Not a model"},e=>({node_names:e.map(e=>e.name)}))},u=async()=>{var e;o.status="canceling",(null===(e=o.currentRun)||void 0===e?void 0:e.run_id)&&await (0,nb.Eg)(o.currentRun.run_id)};return{actionState:o,runRowCount:c,runRowCountDiff:d,runValueDiff:async()=>{await a("value_diff",e=>{var n;let i=null===(n=e.data.current)||void 0===n?void 0:n.primary_key;return i?{params:{model:e.name,primary_key:i}}:{skipReason:"No primary key found. The first unique column is used as primary key."}})},addLineageDiffCheck:async()=>{let n=e.map(e=>e.id);return await i4({node_ids:n})},addSchemaDiffCheck:async()=>{let n;if(1===e.length)n=await nY({node_id:e[0].id});else{let i=e.map(e=>e.id);n=await nY({node_id:i})}return n},cancel:u,reset:()=>{Object.assign(o,i9)}}};var i7=i(74105),te=function(){let{isOpen:e,onOpen:n,onClose:i}=(0,F.q)(),[o,r]=(0,v.useState)(0),[s,a]=(0,v.useState)(),c=(0,v.useRef)(),u=(0,v.useCallback)(e=>(r(e),new Promise(e=>{a(()=>e),n()})),[n]),h=()=>{null==s||s(!1),i()};return{confirm:u,AlertDialog:(0,t.jsx)(i7.aR,{size:"xl",isOpen:e,leastDestructiveRef:c,onClose:h,children:(0,t.jsx)(O.Z,{children:(0,t.jsxs)(i7._T,{children:[(0,t.jsxs)(G.x,{fontSize:"lg",fontWeight:"bold",children:["Value Diff on ",o," nodes"]}),(0,t.jsx)(ee.f,{gap:"20px",as:d.k,direction:"column",children:(0,t.jsxs)(l.x,{children:["Value diff will be executed on ",o," nodes in the Lineage, which can add extra costs to your bill."]})}),(0,t.jsxs)(ni.m,{children:[(0,t.jsx)(B.z,{ref:c,onClick:h,children:"Cancel"}),(0,t.jsx)(B.z,{colorScheme:"blue",onClick:()=>{null==s||s(!0),i()},ml:3,children:"Execute"})]})]})})})}},tn=i(6238),ti=i(14915);let tt="recce",tl={recommendationIgnored:"".concat(tt,"-recommendation-ignored"),recommendationShowed:"".concat(tt,"-recommendation-showed"),prevRefreshTimeStamp:"".concat(tt,"-prev-refresh-timestamp"),lineageNotificationDismissed:"".concat(tt,"-lineage-notification-dismissed")},to=()=>{var e;let n=(0,y.a)({queryKey:C.V.checks(),queryFn:z}),i=(0,v.useMemo)(()=>{if("success"===n.status&&n.data.length>0){let e=n.data.filter(e=>e.is_preset).findLast(e=>"row_count_diff"===e.type);if(e)return e}},[n]),t=(0,y.a)({queryKey:(null==i?void 0:i.check_id)?C.V.check(i.check_id):[],queryFn:async()=>{if(null==i?void 0:i.check_id)return D(i.check_id)},enabled:!!(null==i?void 0:i.check_id)}),l=(0,y.a)({queryKey:(null==i?void 0:i.check_id)?[...C.V.check(i.check_id),"select"]:[],queryFn:async()=>{var e,n;return eN({select:null==i?void 0:null===(e=i.params)||void 0===e?void 0:e.select,exclude:null==i?void 0:null===(n=i.params)||void 0===n?void 0:n.exclude})},enabled:!!(null==i?void 0:null===(e=i.params)||void 0===e?void 0:e.select)}),o=(0,v.useMemo)(()=>{if(i){var e,n;if(null===(e=i.params)||void 0===e?void 0:e.node_names)return i.params.node_names;if(null===(n=i.params)||void 0===n?void 0:n.node_ids)return i.params.node_ids}if("success"===l.status&&l.data)return l.data.nodes},[i,l]);return{recommendedCheck:t.data,selectedNodes:o}},tr=()=>{let{readOnly:e}=(0,ek.$)(),{lineageGraph:n,envInfo:i}=(0,ef.kJ)(),{showRunId:l}=(0,ej.$q)(),{data:o}=(0,n1.P)(),r=(0,ep.NL)(),{recommendedCheck:s,selectedNodes:a}=to(),[c,u]=(0,v.useState)(),[h,m]=(0,v.useState)(!1),[f,g]=(0,v.useState)(!1),[j,y]=(0,v.useState)(!1),{isOpen:b,onOpen:w,onClose:k}=(0,F.q)(),S=tl.recommendationIgnored,z=tl.recommendationShowed,D=tl.prevRefreshTimeStamp;(0,v.useEffect)(()=>{sessionStorage.getItem(S)&&g(!0)},[S]),(0,v.useEffect)(()=>{var e,t,l,o,r,c,d,h,x,p;if(!s||!a)return;if(null===(e=s.last_run)||void 0===e?void 0:e.run_id){let e=new Date(s.last_run.run_at).getTime(),n=null==i?void 0:i.dbt,t=Math.max((null==n?void 0:null===(o=n.current)||void 0===o?void 0:o.generated_at)?new Date(n.current.generated_at).getTime():0,(null==n?void 0:null===(r=n.base)||void 0===r?void 0:r.generated_at)?new Date(n.base.generated_at).getTime():0);if(e>=t){m(!0);return}m(!1),y(!0);let l=sessionStorage.getItem(D);(null===l||parseInt(l)!==t)&&(sessionStorage.setItem(D,t.toString()),sessionStorage.removeItem(S),sessionStorage.removeItem(z),g(!1))}let f=e=>e.map(e=>{var i;return null==n?void 0:null===(i=n.nodes[e])||void 0===i?void 0:i.name}).join(", ");if(a.length>0&&a.length<=3){if(null===(c=s.params)||void 0===c?void 0:c.node_names){let e=null===(h=s.params)||void 0===h?void 0:h.node_names.join(", ");u("'".concat(e,"'"))}else if(null===(d=s.params)||void 0===d?void 0:d.node_ids){let e=f(null===(x=s.params)||void 0===x?void 0:x.node_ids);u("'".concat(e,"'"))}else if(a){let e=f(a);u("'".concat(e,"'"))}}else(null==n?void 0:n.modifiedSet.length)===a.length?u("modified and potentially impacted models"):(null===(t=s.params)||void 0===t?void 0:t.select)&&!(null===(l=s.params)||void 0===l?void 0:l.exclude)?u("'".concat(null===(p=s.params)||void 0===p?void 0:p.select,"'")):u("".concat(a.length," models"));if(!sessionStorage.getItem(z)){let e=sessionStorage.getItem(D);sessionStorage.setItem(z,"true"),(0,_.P6)({action:"recommend",from:null===e?"initial":"rerun"})}},[s,a,n,S,z,D,i]);let R=(0,v.useCallback)(async()=>{s&&(l((await (0,nb.rf)(s.check_id,{nowait:!0})).run_id),await r.invalidateQueries({queryKey:C.V.check(s.check_id)}))},[s,l,r]);if(!s||!a||(null==o?void 0:o.single_env_onboarding))return(0,t.jsx)(t.Fragment,{});let L=a.length;return!f&&!h&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.U,{width:"100%",padding:"2pt 8pt",backgroundColor:"blue.50",children:(0,t.jsxs)(x.U,{flex:"1",fontSize:"10pt",color:"blue.600",children:[j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ti.i,{}),(0,t.jsx)(K.x,{children:"New dbt build detected - Re-run row count checks to maintain result accuracy"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(tn.h,{}),(0,t.jsxs)(K.x,{children:["First Check: Perform a row count diff of ",c," for basic impact assessment"]})]}),(0,t.jsx)(p.L,{}),(0,t.jsx)(B.z,{size:"xs",onClick:()=>{g(!0),sessionStorage.setItem(S,"true"),(0,_.P6)({action:"ignore",from:j?"rerun":"initial",nodes:L})},children:"Ignore"}),(0,t.jsx)(B.z,{colorScheme:"blue",size:"xs",onClick:()=>{w(),(0,_.P6)({action:"perform",from:j?"rerun":"initial",nodes:L})},isDisabled:e,children:"Perform"})]})}),(0,t.jsxs)(Z.u_,{isOpen:b,onClose:()=>{k(),(0,_.P6)({action:"close",from:j?"rerun":"initial",nodes:L})},isCentered:!0,children:[(0,t.jsx)(O.Z,{}),(0,t.jsxs)(X.h,{children:[(0,t.jsx)(G.x,{children:"Row Count Check"}),(0,t.jsx)(ee.f,{children:(0,t.jsxs)(e2.K,{spacing:"4",children:[(0,t.jsxs)(K.x,{children:["Perform a row count check of the ",L," node(s) displayed in the lineage diff DAG."]}),(0,t.jsxs)(d.k,{bg:"blue.100",color:"blue.700",children:[(0,t.jsx)(tn.h,{mt:"10px",ml:"5px"}),(0,t.jsx)(K.x,{margin:"5px",paddingX:"3px",children:"This is a recommended first check based on the preset checks defined in your recce.yml file."})]})]})}),(0,t.jsxs)(ni.m,{gap:"5px",children:[(0,t.jsx)(B.z,{onClick:()=>{k(),(0,_.P6)({action:"close",from:j?"rerun":"initial",nodes:L})},children:"Cancel"}),(0,t.jsxs)(B.z,{colorScheme:"blue",onClick:()=>{k(),R(),m(!0),(0,_.P6)({action:"execute",from:j?"rerun":"initial",nodes:L})},children:["Execute on ",L," models"]})]})]})]})]})};var ts=i(68079),ta=i(51293),tc=i(96959),td=i(75214),tu=i(82752);let th=e=>{let{enabled:n,onChanged:i}=e,l=(0,n1.P)();return!l.data||l.data.single_env_onboarding?(0,t.jsx)(t.Fragment,{}):(0,t.jsxs)(d.k,{direction:"row",alignItems:"center",gap:"5px",p:"5px 10px",borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:"white",alignSelf:"flex-start",children:[(0,t.jsx)(ts.r,{isChecked:n,onChange:e=>{i(e.target.checked)},alignItems:"center"}),(0,t.jsx)(d.k,{alignItems:"center",children:(0,t.jsx)(K.x,{fontSize:"10pt",lineHeight:"1",children:"Breaking Change Analysis"})}),(0,t.jsxs)(ta.J,{trigger:"hover",placement:"top-start",children:[(0,t.jsx)(tc.x,{children:(0,t.jsx)(r.J,{boxSize:"10px",as:tn.h,color:"gray.500",cursor:"pointer"})}),(0,t.jsx)(td.y,{bg:"black",color:"white",children:(0,t.jsxs)(tu.b,{fontSize:"sm",children:["Breaking changes are determined by analyzing SQL for changes that may impact downstream models."," ",(0,t.jsx)(o.r,{href:"https://docs.datarecce.io/features/breaking-change-analysis/",target:"_blank",textDecoration:"underline",children:"Learn more"}),"."]})})]})]})},tx=e=>{let{transformationType:n,legend:i}=e,l="U",o="red";return"passthrough"===n?(l="P",o="gray"):"renamed"===n?(l="R",o="orange"):"derived"===n?(l="D",o="orange"):"source"===n?(l="S",o="blue"):(l="U",o="red"),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(V.Vp,{fontSize:"8pt",size:"xs",colorScheme:o,borderRadius:"full",paddingX:"4px",children:(0,t.jsx)(V.Sn,{children:l})})})};var tp=i(72603);let tm=e=>{let{node:n,column:i,reset:l}=e,{lineageGraph:s}=(0,ef.kJ)();if(!s)return(0,t.jsx)(t.Fragment,{});let a=s.nodes[n].name;return(0,t.jsxs)(d.k,{direction:"row",alignItems:"center",gap:"5px",p:"5px 10px",borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:"white",fontSize:"10pt",children:[(0,t.jsx)(K.x,{children:"Column Lineage for"}),(0,t.jsxs)(c.E,{children:[a,".",i]}),(0,t.jsxs)(ta.J,{trigger:"hover",placement:"top-start",children:[(0,t.jsx)(tc.x,{children:(0,t.jsx)(r.J,{boxSize:"10px",as:tn.h,color:"gray.500",cursor:"pointer"})}),(0,t.jsx)(td.y,{bg:"black",color:"white",children:(0,t.jsxs)(tu.b,{fontSize:"sm",children:["Column-Level Lineage provides visibility into the upstream and downstream relationships of a column."," ",(0,t.jsx)(o.r,{href:"https://docs.datarecce.io/features/column-level-lineage/",target:"_blank",textDecoration:"underline",children:"Learn more"}),"."]})})]}),l&&(0,t.jsx)(P.h,{icon:(0,t.jsx)(tp.T,{}),"aria-label":"",onClick:l,size:"xs"})]})};function tf(){return(0,t.jsx)(l.x,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({passthrough:["Pass Through","The column is directly selected from the upstream table."],renamed:["Renamed","The column is selected from the upstream table but with a different name."],derived:["Derived","The column is created through transformations applied to upstream columns, such as calculations, conditions, functions, or aggregations."],source:["Source","The column is not derived from any upstream data. It may originate from a seed/source node, literal value, or data generation function."],unknown:["Unknown","We have no information about the transformation type. This could be due to a parse error, or other unknown reason."]}).map(e=>{let[n,[i,l]]=e;return(0,t.jsx)(M.u,{label:l,placement:"right",children:(0,t.jsxs)(d.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,t.jsx)(tx,{legend:!0,transformationType:n})," ",i]})},n)})})}function tg(e){let{notification:n,type:i}=e,l=tl.lineageNotificationDismissed,[o,r]=(0,v.useState)(!0);return((0,v.useEffect)(()=>{"true"===sessionStorage.getItem(l)&&r(!1)},[l]),null!==n&&o)?(0,t.jsxs)(d.k,{w:"100%",direction:"row",p:"5px 10px",gap:"5px",alignItems:"flex-start",borderRadius:"md",boxShadow:"md",border:"1px solid",borderColor:"gray.200",bg:{info:"blue.50",success:"green.50",warning:"yellow.50",error:"red.50"}[i],children:[n,(0,t.jsx)(p.L,{}),(0,t.jsx)(nZ.P,{onClick:()=>{sessionStorage.setItem(l,"true"),r(!1)}})]}):null}function tj(){return(0,t.jsx)(d.k,{flex:"1",h:"100%",minH:0,m:"2",p:"4",bg:"blue.50",borderRadius:"lg",boxShadow:"md",justifyContent:"center",children:(0,t.jsxs)(d.k,{w:"80%",direction:"column",overflowY:"auto",gap:6,px:8,pb:8,children:[(0,t.jsxs)(d.k,{direction:"column",alignItems:"center",gap:4,children:[(0,t.jsx)(d.k,{p:2,bg:"white",borderRadius:"full",alignItems:"center",justifyContent:"center",boxShadow:"md",children:(0,t.jsx)(r.J,{as:nO.NJc,boxSize:7,color:"blue.500"})}),(0,t.jsx)(h.X,{mt:"4",size:"lg",children:"Wait, there's more!"}),(0,t.jsxs)(K.x,{fontSize:"md",textAlign:"center",children:["Recce is currently running in"," ",(0,t.jsx)(K.x,{fontWeight:"bold",as:"span",children:"limited functionality mode"})," ","so you can run queries but"," ",(0,t.jsx)(K.x,{fontWeight:"bold",as:"span",children:"can't diff the results yet!"})]})]}),(0,t.jsxs)(d.k,{direction:"column",gap:2,children:[(0,t.jsx)(K.x,{fontSize:"md",children:"To unlock the full power of Recce, set up a base environment of dbt artifacts for comparison."}),(0,t.jsx)(K.x,{children:"Once configured, you'll be able to:"}),(0,t.jsxs)(eM.QI,{children:[(0,t.jsx)(eM.HC,{children:(0,t.jsx)(K.x,{children:"Run statistical data diffs"})}),(0,t.jsx)(eM.HC,{children:(0,t.jsx)(K.x,{children:"Run query diffs"})}),(0,t.jsx)(eM.HC,{children:(0,t.jsx)(K.x,{children:"Save checks to your Recce Checklist"})}),(0,t.jsx)(eM.HC,{children:(0,t.jsx)(K.x,{children:"...and more!"})})]}),(0,t.jsx)(K.x,{fontSize:"md",children:"Take the next step toward better data impact assessment."})]}),(0,t.jsx)(d.k,{w:"100%",direction:"column",mt:6,children:(0,t.jsx)(B.z,{colorScheme:"blue",size:"lg",onClick:()=>{window.open("https://docs.datarecce.io/get-started/#prepare-dbt-artifacts","_blank")},children:"Start Now"})})]})})}function tv(){return(0,t.jsxs)(d.k,{direction:"row",gap:"10px",alignItems:"flex-start",children:[(0,t.jsx)(r.J,{as:nO.LyC,color:"blue.500",boxSize:"5"}),(0,t.jsxs)(d.k,{direction:"column",gap:"5px",children:[(0,t.jsxs)(K.x,{fontWeight:"bold",children:["Single Environment Mode"," ",(0,t.jsx)(K.x,{color:"red",as:"span",children:"Limited Functionality"})]}),(0,t.jsx)(K.x,{fontSize:"sm",children:"Single Environment Mode allows you to explore your dbt project but won't show data comparisons between environments."}),(0,t.jsx)(K.x,{fontSize:"sm",children:"To set up full environment comparison:"}),(0,t.jsxs)(eM.QI,{children:[(0,t.jsx)(eM.HC,{children:(0,t.jsx)(K.x,{fontSize:"sm",children:"Run `recce debug` for setup assistance"})}),(0,t.jsx)(eM.HC,{children:(0,t.jsxs)(K.x,{fontSize:"sm",children:["Visit"," ",(0,t.jsxs)(o.r,{color:"blue.500",fontSize:"sm",fontWeight:"medium",isExternal:!0,href:"https://docs.datarecce.io/configure-diff/",children:["docs"," "]}),"for configuration details"]})})]})]})]})}async function ty(e,n){return(await k.U.post("/api/cll",{params:{node_id:e,column:n}})).data}var tb=i(94716);let tw=e=>{let{menuItems:n,isOpen:i,onClose:l,x:o,y:r}=e;return(0,t.jsx)(A.v,{isOpen:i,onClose:l,children:(0,t.jsx)(J.q,{fontSize:"10pt",position:"absolute",width:"250px",style:{left:"".concat(o,"px"),top:"".concat(r,"px")},children:0===n.length?(0,t.jsx)(W.s,{isDisabled:!0,children:"No action available"},"no action"):n.map(e=>e.isSeparator?(0,t.jsx)(U.R,{},e.label):(0,t.jsx)(W.s,{icon:e.icon,isDisabled:e.isDisabled,onClick:()=>{e.action&&e.action(),l()},children:e.label},e.label))})})},tk=e=>{var n,i,l,o,s,a,c,d,u,h,x;let{isOpen:p,onClose:m,x:f,y:g,node:j}=e,v=[],{selectParentNodes:y,selectChildNodes:b,getNodeColumnSet:w,selectMode:k,viewOptions:C}=e_(),{runAction:_}=(0,ej.$q)(),{isActionAvailable:S}=(0,ef.kJ)(),{data:z}=(0,n1.P)(),D=null!==(i=null==z?void 0:z.single_env_onboarding)&&void 0!==i&&i,{primaryKey:R}=(0,nG.ZP)(null==j?void 0:null===(n=j.data)||void 0===n?void 0:n.name),{setSqlQuery:L,setPrimaryKeys:I}=(0,nX.rV)(),[,T]=(0,eZ.TH)();if(!(null==j?void 0:j.data))return(0,t.jsx)(t.Fragment,{});let q=j.data,N=q.resourceType,E=Array.from(w(j.id)),F={source:"lineage_model_node"};if(!k&&N&&["model","seed","snapshot"].includes(N)){let e=(0,eB.N)(D?"query":"query_diff"),n=iJ(Object.keys(null!==(s=null===(l=q.data.base)||void 0===l?void 0:l.columns)&&void 0!==s?s:{}),Object.keys(null!==(a=null===(o=q.data.current)||void 0===o?void 0:o.columns)&&void 0!==a?a:{})),i='select * from {{ ref("'.concat(q.name,'") }}');if(n.length&&(i="select \n  ".concat(n.join("\n  "),'\nfrom {{ ref("').concat(q.name,'") }}')),v.push({label:"Query",icon:(0,t.jsx)(r.J,{as:null==e?void 0:e.icon}),action:()=>{L(i),S("query_diff_with_primary_key")&&I(void 0!==R?[R]:void 0),T("/query")}}),E.length>0){if(void 0!==C.column_level_lineage){let n=new Set;R&&n.add(R),E.forEach(e=>{n.add(e)}),v.push({label:"Query Related Columns",icon:(0,t.jsx)(r.J,{as:null==e?void 0:e.icon}),action:()=>{L("select \n  ".concat(Array.from(n).join(",\n  "),'\nfrom {{ ref("').concat(q.name,'") }}')),S("query_diff_with_primary_key")&&I(void 0!==R?[R]:void 0),T("/query")}})}else{let n=Object.entries(null!==(d=null===(c=q.change)||void 0===c?void 0:c.columns)&&void 0!==d?d:{}).filter(e=>{let[,n]=e;return"modified"===n}).map(e=>{let[n]=e;return n});if(n.length>0){let i=new Set;R&&i.add(R),n.forEach(e=>{i.add(e)}),v.push({label:"Query Modified Columns",icon:(0,t.jsx)(r.J,{as:null==e?void 0:e.icon}),action:()=>{L("select \n  ".concat(Array.from(i).join(",\n  "),'\nfrom {{ ref("').concat(q.name,'") }}')),S("query_diff_with_primary_key")&&I(void 0!==R?[R]:void 0),T("/query")}})}}}e=(0,eB.N)(D?"row_count":"row_count_diff"),v.push({label:null!==(u=null==e?void 0:e.title)&&void 0!==u?u:"Row count",icon:(0,t.jsx)(r.J,{as:null==e?void 0:e.icon}),action:()=>{_(D?"row_count":"row_count_diff",{node_names:[q.name]},{showForm:!1,trackProps:F})}}),e=(0,eB.N)(D?"profile":"profile_diff"),v.push({label:null!==(h=null==e?void 0:e.title)&&void 0!==h?h:"Profile",icon:(0,t.jsx)(r.J,{as:null==e?void 0:e.icon}),action:()=>{let e=Array.from(w(j.id));_(D?"profile":"profile_diff",{model:q.name,columns:e},{showForm:!0,trackProps:F})}}),D||(e=(0,eB.N)("value_diff"),v.push({label:null!==(x=null==e?void 0:e.title)&&void 0!==x?x:"Value Diff",icon:(0,t.jsx)(r.J,{as:null==e?void 0:e.icon}),action:()=>{let e=Array.from(w(j.id));_("value_diff",{model:q.name,columns:e},{showForm:!0,trackProps:F})}}))}return D||(v.length>0&&v.push({label:"select group",isSeparator:!0}),v.push({label:"Select Parent Nodes",icon:(0,t.jsx)(tb.Cv2,{}),action:()=>{y(j.id,1)}}),v.push({label:"Select Child Nodes",icon:(0,t.jsx)(tb.IMj,{}),action:()=>{b(j.id,1)}}),v.push({label:"Select All Upstream Nodes",icon:(0,t.jsx)(tb.Cv2,{}),action:()=>{y(j.id)}}),v.push({label:"Select All Downstream Nodes",icon:(0,t.jsx)(tb.IMj,{}),action:()=>{b(j.id)}})),(0,t.jsx)(tw,{x:f,y:g,menuItems:v,isOpen:p,onClose:m})},tC=e=>{var n,i,l,o,s,a,c,d;let{isOpen:u,onClose:h,x,y:p,node:m}=e,f=[],{runAction:g}=(0,ej.$q)(),{isActionAvailable:j}=(0,ef.kJ)(),{data:v}=(0,n1.P)(),y=null!==(s=null==v?void 0:v.single_env_onboarding)&&void 0!==s&&s;if((null==m?void 0:m.data)===void 0)return(0,t.jsx)(t.Fragment,{});let b=m.data,w=b.node,k=b.column,C=b.type,_={source:"lineage_column_node"},S=(null===(i=w.data.base)||void 0===i?void 0:null===(n=i.columns)||void 0===n?void 0:n[k])===void 0||(null===(o=w.data.current)||void 0===o?void 0:null===(l=o.columns)||void 0===l?void 0:l[k])===void 0,z=(0,eB.N)(y?"profile":"profile_diff");return f.push({label:null!==(a=null==z?void 0:z.title)&&void 0!==a?a:"Profile",icon:(0,t.jsx)(r.J,{as:null==z?void 0:z.icon}),action:()=>{g("profile_diff",{model:w.name,columns:[k]},{showForm:!1,trackProps:_})},isDisabled:S||!j("profile_diff")}),y||(z=(0,eB.N)("histogram_diff"),f.push({label:null!==(c=null==z?void 0:z.title)&&void 0!==c?c:"Histogram Diff",icon:(0,t.jsx)(r.J,{as:null==z?void 0:z.icon}),action:()=>{g("histogram_diff",{model:w.name,column_name:k,column_type:C},{showForm:!1,trackProps:_})},isDisabled:S||!C||!(0,ew.d)(C)}),z=(0,eB.N)("top_k_diff"),f.push({label:null!==(d=null==z?void 0:z.title)&&void 0!==d?d:"Top-K Diff",icon:(0,t.jsx)(r.J,{as:null==z?void 0:z.icon}),action:()=>{g("top_k_diff",{model:w.name,column_name:k,k:50},{showForm:!1,trackProps:_})},isDisabled:S})),(0,t.jsx)(tw,{x:x,y:p,menuItems:f,isOpen:u,onClose:h})},t_=e=>{let{isOpen:n,onClose:i,x:l,y:o,node:r}=e,{readOnly:s}=(0,ek.$)();if(s);else if((null==r?void 0:r.type)==="customNode")return(0,t.jsx)(tk,{x:l,y:o,isOpen:n,onClose:i,node:r});else if((null==r?void 0:r.type)==="customColumnNode")return(0,t.jsx)(tC,{x:l,y:o,isOpen:n,onClose:i,node:r})},tS=()=>{let{isOpen:e,onClose:n,onOpen:i}=(0,F.q)(),[t,l]=(0,v.useState)({x:0,y:0}),[o,r]=(0,v.useState)();return{props:{x:t.x,y:t.y,node:o,isOpen:e,onClose:n},showContextMenu:(e,n,t)=>{l({x:e,y:n}),r(t),i()},closeContextMenu:()=>{l({x:0,y:0}),r(void 0),n()}}},tz={customNode:function(e){var n,i;let{data:o}=e,{id:s,resourceType:a,changeStatus:c,change:u}=o,h=null==u?void 0:u.category,m=(0,nR.oR)(e=>e.transform[2]>.3),{icon:f}=eK(a),[g,j]=(0,v.useState)(!1),{interactive:y,selectNode:b,selectMode:w,focusedNode:k,breakingChangeEnabled:C,getNodeAction:_,getNodeColumnSet:S,isNodeHighlighted:z,isNodeSelected:D,showContextMenu:R}=e_(),{lineageGraph:L}=(0,ef.kJ)(),I=C&&"modified"===c&&(null==L?void 0:L.nonBreakingSet.has(s)),T=z(s),q=D(s),N=(null==k?void 0:k.id)===s,{icon:E,color:F,backgroundColor:O}=c?eW(c):{icon:void 0,color:"gray.400",backgroundColor:"gray.100"},M=I?"dashed":"solid",V=o.name,A=S(o.id),H=A.size>0,P="action_result"===w?_(o.id):void 0,J=m?"selecting"===w?q?F:"white":"action_result"!==w?N||q||g?O:"white":P?N||q||g?O:F:"white":N||q||g?F:O,W="selecting"===w?q?"white":"inherit":"action_result"===w&&P&&!q?"white":"inherit",K="selecting"===w?q?"white":"inherit":"action_result"===w&&P&&!q?"white":"inherit",U="selecting"===w?q?"white":F:"action_result"===w?P&&!q?"white":"inherit":F;return(0,t.jsxs)(d.k,{cursor:"selecting"===w?"pointer":"inherit",direction:"column",width:"300px",transition:"box-shadow 0.2s ease-in-out",padding:0,filter:"action_result"===w?P?"none":"opacity(0.2) grayscale(50%)":T||N||q||g?"none":"opacity(0.2) grayscale(50%)",onMouseEnter:()=>{j(!0)},onMouseLeave:()=>{j(!1)},children:[(0,t.jsxs)(d.k,{borderColor:F,borderWidth:"2px",borderStyle:M,borderTopRadius:8,borderBottomRadius:H?0:8,backgroundColor:J,height:"60px",children:[(0,t.jsx)(d.k,{bg:F,padding:y?"8px":"2px",borderRightWidth:"2px",borderColor:"selecting"===w?"#00000020":F,borderStyle:M,alignItems:"top",visibility:m?"inherit":"hidden",children:y&&(0,t.jsx)(nB,{checked:"selecting"===w&&q||"action_result"===w&&!!P,onClick:e=>{"action_result"!==w&&(e.stopPropagation(),b(o.id))}})}),(0,t.jsxs)(d.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:[(0,t.jsxs)(d.k,{width:"100%",textAlign:"left",fontWeight:"600",flex:"1",p:1,gap:"5px",alignItems:"center",visibility:m?"inherit":"hidden",children:[(0,t.jsx)(nQ,{name:V,color:W,resourceType:a}),g?(0,t.jsx)(r.J,{as:ex.D_A,color:"gray",cursor:"pointer",_hover:{color:"black"},onClick:n=>{n.preventDefault(),n.stopPropagation(),R(n,e)}}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.J,{boxSize:"16px",color:K,as:f}),c&&(0,t.jsx)(r.J,{color:U,as:E})]})]}),(0,t.jsx)(d.k,{flex:"1 0 auto",mx:"1",direction:"column",paddingBottom:"1",visibility:m?"inherit":"hidden",children:(0,t.jsxs)(x.U,{spacing:"8px",children:[C&&"modified"===c?(0,t.jsx)(l.x,{height:"20px",color:"gray",fontSize:"9pt",margin:0,fontWeight:600,children:h?nK[h]:""}):"action_result"!==w&&"model"===o.resourceType?(0,t.jsx)(nU,{id:o.id,inverted:"selecting"===w&&!!q}):(0,t.jsx)(t.Fragment,{}),P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.L,{}),(0,t.jsx)(nJ,{node:o,action:P})]}):(0,t.jsx)(t.Fragment,{})]})})]})]}),H&&(0,t.jsx)(l.x,{p:"10px 10px",borderColor:F,borderWidth:"2px",borderTopWidth:0,borderStyle:M,borderBottomRadius:8,children:(0,t.jsx)(l.x,{height:"".concat(A.size*nz.O$,"px"),overflow:"auto"})}),Object.keys(null!==(n=o.parents)&&void 0!==n?n:{}).length>0&&(0,t.jsx)(nR.HH,{type:"target",position:nR.Ly.Left,isConnectable:!1}),Object.keys(null!==(i=o.children)&&void 0!==i?i:{}).length>0&&(0,t.jsx)(nR.HH,{type:"source",position:nR.Ly.Right,isConnectable:!1})]})},customColumnNode:function(e){var n,i;let{id:o,data:s}=e,{id:a}=s.node,{column:c,type:u,transformationType:h,changeStatus:x}=s,m=(0,nR.oR)(e=>e.transform[2]>.3),{viewOptions:f,showContextMenu:g,isNodeHighlighted:j}=e_(),y=null===(n=f.column_level_lineage)||void 0===n?void 0:n.node,b=c===(null===(i=f.column_level_lineage)||void 0===i?void 0:i.column)&&a===y,{color:w,icon:k}=eW(x),[C,_]=v.useState(!1),S=j(o);return m?(0,t.jsxs)(d.k,{width:"280px",padding:"0px 10px",border:"1px solid gray",backgroundColor:b?"#f0f0f0":"inherit",_hover:{backgroundColor:"#f0f0f0"},onMouseEnter:()=>{_(!0)},onMouseLeave:()=>{_(!1)},filter:S?"none":"opacity(0.2) grayscale(50%)",children:[(0,t.jsxs)(d.k,{fontSize:"11px",color:"black",width:"100%",gap:"3px",alignItems:"center",height:"".concat(nz.O$-1,"px"),children:[x&&(0,t.jsx)(r.J,{boxSize:"14px",display:"inline-flex",color:w,as:k}),h&&(0,t.jsx)(tx,{transformationType:h}),(0,t.jsx)(l.x,{height:"".concat(nz.O$+1," px"),children:c}),(0,t.jsx)(p.L,{}),C?(0,t.jsx)(r.J,{as:ex.D_A,boxSize:"14px",display:"inline-flex",cursor:"pointer",_hover:{color:"black"},onClick:n=>{n.preventDefault(),n.stopPropagation(),g(n,e)}}):(0,t.jsx)(l.x,{height:"".concat(nz.O$+1," px"),children:u})]}),(0,t.jsx)(nR.HH,{type:"target",position:nR.Ly.Left,isConnectable:!1,style:{left:0,visibility:"hidden"}}),(0,t.jsx)(nR.HH,{type:"source",position:nR.Ly.Right,isConnectable:!1,style:{right:0,visibility:"hidden"}})]}):(0,t.jsx)(t.Fragment,{})}},tD=[],tR={customEdge:function(e){let{source:n,target:i,sourceX:l,sourceY:o,targetX:r,targetY:s,sourcePosition:a,targetPosition:c,style:d={},markerEnd:u,data:h}=e,x={...d},{isEdgeHighlighted:p}=e_();(null==h?void 0:h.changeStatus)&&(x.stroke=eW(h.changeStatus).color,x.strokeDasharray="5"),p(n,i)||(x.filter="opacity(0.2) grayscale(50%)");let[m]=(0,nR.OQ)({sourceX:l,sourceY:o,sourcePosition:a,targetX:r,targetY:s,targetPosition:c});return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(nR.u5,{path:m,markerEnd:u,style:{...x,...d}})})}},tL=e=>e.data.changeStatus?eW(e.data.changeStatus).color:"lightgray",tI=(e,n)=>{let i=e.current,t=(0,v.useRef)({width:0,height:0});(0,v.useEffect)(()=>{let e=new ResizeObserver(e=>{for(let i of e){let e=i.contentRect.width,l=i.contentRect.height;(Math.abs(l-t.current.height)>10||Math.abs(e-t.current.width)>10)&&t.current.height>0&&l>0&&t.current.width>0&&e>0&&n(),t.current={width:e,height:l}}});return i&&e.observe(i),()=>{i&&e.unobserve(i)}},[i,t,n])},tT=()=>{let[,e]=(0,eZ.TH)();return(0,v.useCallback)(n=>{n.check_id&&e("/checks/".concat(n.check_id))},[e])},tq=(0,v.forwardRef)(function(e,n){var i,o;let{interactive:a=!1,...c}=e,u=(0,nR._K)(),h=(0,v.useRef)(null),{successToast:x,failToast:p}=e0(),{copyToClipboard:m,ImageDownloadModal:f,ref:g}=it({renderLibrary:"html-to-image",imageType:"png",shadowEffect:!0,backgroundColor:"white",ignoreElements:e=>{let n=e.className;return!!("string"==typeof n&&n.includes(ii))},onSuccess:()=>{x("Copied the Lineage View as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),p("Failed to copy image to clipboard",e)}}),[j,y,b]=(0,nR.Rr)(tD),[w,k,C]=(0,nR.ll)([]),{lineageGraph:S,retchLineageGraph:z,isLoading:D,error:R,refetchRunsAggregated:L}=(0,ef.kJ)(),{data:I}=(0,n1.P)(),{runId:N,showRunId:E,closeRunResult:F,runAction:O,isRunResultOpen:M}=(0,ej.$q)(),{run:V}=n5(N),[A,H]=(0,v.useState)({...c.viewOptions}),P=e=>j.find(n=>n.data.name===e);(0,v.useImperativeHandle)(n,()=>({copyToClipboard:m}));let J=(0,v.useMemo)(()=>!!S&&S.modifiedSet.length>0,[S]),W=null!==(i=A.view_mode)&&void 0!==i?i:"changed_models",U=(0,v.useMemo)(()=>j.filter(e=>"customNode"===e.type).map(e=>e.id),[j]),Q=(0,v.useMemo)(()=>S?U.map(e=>S.nodes[e]):[],[S,U]),[$,Z]=(0,v.useState)(),X=$?null==S?void 0:S.nodes[$]:void 0,[G,Y]=(0,v.useState)(),[ee,en]=(0,v.useState)(new Set),ei=(0,v.useMemo)(()=>S?Array.from(ee).map(e=>S.nodes[e]):[],[S,ee]),et=i8(ei.length>0?ei:Q,{onActionStarted:()=>{Y("action_result")},onActionNodeUpdated:e=>{y(n=>n.map(n=>n.id===e.id?{...n}:n))},onActionCompleted:()=>{}}),el=null!==(o=A.breaking_change_enabled)&&void 0!==o&&o,[eo,er]=(0,v.useState)(),[es,ea]=(0,v.useState)(),ec=(0,v.useMemo)(()=>{if(!S)return new Set;if(A.column_level_lineage)return null!=es?es:new Set;let e=new Set,n=new Set(e="action_result"===G?new Set(Object.keys(et.actionState.actions)):X?(0,i2.G0)((0,nz.cr)(S,[X.id]),(0,nz._e)(S,[X.id])):J?el?S.impactedSet:(0,nz._e)(S,S.modifiedSet):new Set(U));return eo&&Object.entries(eo).forEach(i=>{let[t,l]=i;e.has(t)&&l.forEach(e=>{n.add("".concat(t,"_").concat(e))})}),n},[S,A.column_level_lineage,G,X,J,eo,es,et.actionState.actions,el,U]),ed=tS(),eu=(0,s.p)();(0,v.useLayoutEffect)(()=>{(async()=>{let e;if(!S)return;if(A.node_ids)e=A.node_ids;else{var n,i;let t=null===(n=S.manifestMetadata.current)||void 0===n?void 0:n.project_name,l={view_mode:null!==(i=A.view_mode)&&void 0!==i?i:J?"changed_models":"all",packages:t?[t]:void 0,...c.viewOptions};try{e=(await eN({select:l.select,exclude:l.exclude,packages:l.packages,view_mode:l.view_mode})).nodes}catch(n){l.view_mode="all",e=(await eN({select:l.select,exclude:l.exclude,packages:l.packages,view_mode:l.view_mode})).nodes}H(l),er(void 0)}let[t,l,o]=(0,nz.mF)(S,{selectedNodes:e,breakingChangeEnabled:el});(0,nz.bK)(t,l),y(t),k(l),er(o)})()},[S]);let eh=()=>{Z(void 0)},ex=e=>{if(e.width&&e.height){let n=e.position.x+e.width/2,i=e.position.y+e.height/2,t=u.getZoom();u.setCenter(n,i,{zoom:t,duration:200})}},ep=tT();tI(h,()=>{if("selecting"!==G){let e=j.find(e=>e.id===$);e?ex(e):u.fitView({nodes:j,duration:200})}});let em=(e,n)=>{G||(A.column_level_lineage?(0,_.KB)({action:"view",source:"cll_column"}):(0,_.KB)({action:"view",source:"changed_column"}),$&&Z(n.parentId),eb({...A,column_level_lineage:{node:n.data.node.id,column:n.data.column}},!1))},eg=(e,n)=>{if(a&&S){if("customColumnNode"===n.type){em(e,n);return}if(e_(),G){if("action_result"===G){var i;let e=et.actionState.actions[n.id];(null===(i=e.run)||void 0===i?void 0:i.run_id)&&E(e.run.run_id),Z(n.id)}else{let e=new Set(ee);ee.has(n.id)?e.delete(n.id):e.add(n.id),en(e),0===e.size&&Y(void 0)}}else Z(n.id)}},ey=async e=>{var n,i,t,l,o;let r,s;let{viewOptions:a=A,fitView:c}=e;if(!S)return;if(A.select!==a.select||A.exclude!==a.exclude||A.packages!==a.packages||A.view_mode!==a.view_mode){try{let e=await eN({select:a.select,exclude:a.exclude,packages:a.packages,view_mode:a.view_mode});a.column_level_lineage=void 0,s=e.nodes}catch(e){e instanceof i3.d7&&eu({title:"Select node error",description:null!==(t=null===(i=e.response)||void 0===i?void 0:i.data.detail)&&void 0!==t?t:e.message,status:"error",isClosable:!0,position:"bottom-right"});return}Z(void 0)}else s=j.map(e=>e.id);if(a.column_level_lineage)try{r=await ty(a.column_level_lineage.node,a.column_level_lineage.column)}catch(e){if(e instanceof i3.d7){eu({title:"Column Level Lineage error",description:null!==(o=null===(l=e.response)||void 0===l?void 0:l.data.detail)&&void 0!==o?o:e.message,status:"error",isClosable:!0,position:"bottom-right"});return}}let[d,h,x]=(0,nz.mF)(S,{selectedNodes:s,columnLevelLineage:a.column_level_lineage,cll:r,breakingChangeEnabled:a.breaking_change_enabled});void 0!=a.column_level_lineage&&void 0!=r&&ea((0,nz.Te)(r.current.nodes,a.column_level_lineage.node,a.column_level_lineage.column)),y(d),k(h),er(x),(null==V?void 0:null===(n=V.params)||void 0===n?void 0:n.model)&&!P(V.params.model)&&F(),c&&(await new Promise(e=>setTimeout(e,1)),u.fitView({nodes:d,duration:200}))},eb=async function(e){let n=!(arguments.length>1)||void 0===arguments[1]||arguments[1];H(e),await ey({viewOptions:e,fitView:n})},ew=async e=>{let n={...A,breaking_change_enabled:e};H(n),await ey({viewOptions:n}),(0,_.Je)({enabled:e})},ek=te();(0,v.useEffect)(()=>{let e=null==V?void 0:V.type;if(!(!a||!M||!e||["query_diff","query","row_count"].includes(e))&&!G){var n;let e=null===(n=V.params)||void 0===n?void 0:n.model,i=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});if(e){let n=P(e);n?X!==n.data&&eg(i,n):eb({...A,view_mode:"all"})}else eh()}},[V,A,M,G]);let e_=()=>{ed.closeContextMenu()},eS=(e,n)=>{if(!a||"action_result"===G)return;e.preventDefault();let i=g.current,t=i.getBoundingClientRect(),l=e.clientX-t.left,o=e.clientY-t.top+i.offsetTop;ed.showContextMenu(l,o,n)},ez=()=>{Y(void 0),en(new Set),Z(void 0),F(),null==L||L()},eD={interactive:a,nodes:j,focusedNode:X,selectedNodes:ei,viewOptions:A,showContextMenu:eS,onViewOptionsChanged:eb,selectMode:G,selectNode:e=>{if(G){if("selecting"===G){let n=new Set(ee);ee.has(e)?n.delete(e):n.add(e),en(n),0===n.size&&Y(void 0)}}else{if(!S)return;en(new Set([e])),Y("selecting"),Z(void 0),A.column_level_lineage&&eb({...A,column_level_lineage:void 0}),et.reset()}},selectParentNodes:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if("action_result"===G||void 0===S)return;!G&&(Y("selecting"),et.reset(),A.column_level_lineage&&eb({...A,column_level_lineage:void 0}));let i=(0,nz.cr)(S,[e],n);en((0,i2.G0)(ee,i))},selectChildNodes:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if("action_result"===G||void 0===S)return;!G&&(Y("selecting"),et.reset(),A.column_level_lineage&&eb({...A,column_level_lineage:void 0}));let i=(0,nz._e)(S,[e],n);en((0,i2.G0)(ee,i))},deselect:ez,breakingChangeEnabled:el,isNodeHighlighted:e=>ec.has(e),isNodeSelected:e=>ee.has(e),isEdgeHighlighted:(e,n)=>A.column_level_lineage?!!es&&es.has(e)&&es.has(n):ec.has(e)&&ec.has(n),getNodeAction:e=>et.actionState.actions[e],getNodeColumnSet:e=>{var n;return eo&&null!==(n=eo[e])&&void 0!==n?n:new Set},runRowCount:async()=>{"selecting"===G?(await et.runRowCount(),(0,_.oq)({type:"row_count",selected:"multi"})):X?(O("row_count",{node_names:[X.name]},{showForm:!1,showLast:!1}),(0,_.oq)({type:"row_count",selected:"single"})):(O("row_count",{select:A.select,exclude:A.exclude,packages:A.packages,view_mode:A.view_mode}),(0,_.oq)({type:"row_count",selected:"none"}))},runRowCountDiff:async()=>{"selecting"===G?(await et.runRowCountDiff(),(0,_.oq)({type:"row_count_diff",selected:"multi"})):X?(O("row_count_diff",{node_names:[X.name]},{showForm:!1,showLast:!1}),(0,_.oq)({type:"row_count_diff",selected:"single"})):(O("row_count_diff",{select:A.select,exclude:A.exclude,packages:A.packages,view_mode:A.view_mode}),(0,_.oq)({type:"row_count_diff",selected:"none"}))},runValueDiff:async()=>{if(X)O("value_diff",{model:X.name},{showForm:!0,showLast:!1}),(0,_.oq)({type:"value_diff",selected:"single"});else{let e="selecting"===G?ei.length:U.length;await ek.confirm(e)&&(await et.runValueDiff(),(0,_.oq)({type:"value_diff",selected:"selecting"===G?"multi":"none"}))}},addLineageDiffCheck:async()=>{let e;"selecting"===G?(e=await et.addLineageDiffCheck(),ez(),(0,_.oq)({type:"lineage_diff",selected:"multi"})):X||(e=await i4(A),(0,_.oq)({type:"lineage_diff",selected:"none"})),e&&ep(e)},addSchemaDiffCheck:async()=>{let e;"selecting"===G?ei.length>0&&(e=await et.addSchemaDiffCheck(),ez(),(0,_.oq)({type:"schema_diff",selected:"multi"})):X?(e=await nY({node_id:X.id}),(0,_.oq)({type:"schema_diff",selected:"single"})):(e=await nY({select:A.select,exclude:A.exclude,packages:A.packages,view_mode:A.view_mode}),(0,_.oq)({type:"schema_diff",selected:"none"})),e&&ep(e)},cancel:et.cancel,actionState:et.actionState,showColumnLevelLineage:async(e,n)=>{await eb({...A,column_level_lineage:{node:e,column:n}},!1),Z(e)},resetColumnLevelLineage:()=>{Z(void 0),eb({...A,column_level_lineage:void 0},!1)}};return D?(0,t.jsx)(d.k,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:(0,t.jsx)(ev.$,{size:"xl"})}):R?(0,t.jsx)(T.M,{h:"100%",children:(0,t.jsxs)(q.g,{children:[(0,t.jsx)(l.x,{children:"Failed to load lineage data. This could be because the server has been terminated or there is a network error."}),(0,t.jsxs)(l.x,{children:["[Reason: ",R,"]"]}),(0,t.jsx)(B.z,{colorScheme:"blue",onClick:()=>{z&&z()},children:"Retry"})]})}):S&&j!=tD?"changed_models"!==W||S.modifiedSet.length?(0,t.jsxs)(eC.Provider,{value:eD,children:[(0,t.jsxs)(eF,{sizes:X?[70,30]:[100,0],minSize:X?400:0,gutterSize:X?5:0,style:{height:"100%",width:"100%"},children:[(0,t.jsxs)(q.g,{ref:h,divider:(0,t.jsx)(nD.c,{borderColor:"gray.200"}),spacing:0,style:{contain:"strict"},position:"relative",children:[a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i5,{}),(0,t.jsx)(tr,{})]}),(0,t.jsxs)(nR.x$,{proOptions:{hideAttribution:!0},nodeTypes:tz,edgeTypes:tR,nodes:j,edges:w,onNodesChange:b,onEdgesChange:C,onNodeClick:eg,onNodeContextMenu:eS,onClick:e_,onInit:()=>{if(J)u.fitView();else{let e=(0,nR.RX)(j);u.setCenter(e.x+e.width/2,e.y+e.height/2,{zoom:1})}},maxZoom:1,minZoom:.1,nodesDraggable:a,ref:g,children:[(0,t.jsx)(nL.A,{color:"#ccc"}),(0,t.jsx)(nI.Z,{showInteractive:!1,position:"top-right",className:ii,children:(0,t.jsx)(nI.B,{title:"copy image",onClick:async()=>{await m(),(0,_.nO)({type:W,from:"lineage_view"})},children:(0,t.jsx)(r.J,{as:nF.C3L})})}),(0,t.jsx)(f,{}),(0,t.jsx)(nR.s_,{position:"bottom-left",children:(0,t.jsxs)(d.k,{direction:"column",gap:"5px",children:[J&&(0,t.jsx)(i6,{}),A.column_level_lineage&&(0,t.jsx)(tf,{})]})}),(0,t.jsx)(nR.s_,{position:"top-center",children:(0,t.jsx)(tg,{notification:(null==I?void 0:I.single_env_onboarding)?(0,t.jsx)(tv,{}):null,type:"info"})}),(0,t.jsx)(nR.s_,{position:"top-left",children:(0,t.jsxs)(d.k,{direction:"column",gap:"5px",children:[(0,t.jsx)(th,{enabled:el,onChanged:ew}),A.column_level_lineage&&(0,t.jsx)(tm,{node:A.column_level_lineage.node,column:A.column_level_lineage.column,reset:a?()=>{Z(void 0),eb({...A,column_level_lineage:void 0})}:void 0}),0==j.length&&(0,t.jsx)(K.x,{fontSize:"xl",color:"grey",opacity:.5,children:"No nodes"})]})}),(0,t.jsx)(nT.a,{nodeColor:tL,nodeStrokeWidth:3,zoomable:!0,pannable:!0}),"action_result"===G&&(0,t.jsx)(nR.s_,{position:"bottom-center",className:ii,children:(0,t.jsx)(iK,{onClose:()=>{ez()}})})]}),(0,t.jsx)(t_,{...ed.props})]}),X?(0,t.jsx)(l.x,{borderLeft:"solid 1px lightgray",height:"100%",children:(0,t.jsx)(iW,{node:X,onCloseNode:eh})}):(0,t.jsx)(l.x,{})]}),ek.AlertDialog]}):(0,t.jsx)(T.M,{h:"100%",children:(0,t.jsxs)(q.g,{children:[(0,t.jsx)(t.Fragment,{children:"No change detected"}),(0,t.jsx)(B.z,{colorScheme:"blue",onClick:async()=>{await eb({...A,view_mode:"all"})},children:"Show all nodes"})]})}):(0,t.jsx)(t.Fragment,{})}),tN=(0,v.forwardRef)(function(e,n){let{check:i}=e,l={...i.params,...i.view_options};return(0,t.jsx)(d.k,{direction:"column",height:"100%",children:(0,t.jsx)(nR.tV,{children:(0,t.jsx)(tq,{viewOptions:l,interactive:!1,ref:n})})})});function tE(e){let{yamlTemplate:n}=e;return(0,t.jsx)(e4.ML,{height:"300px",language:"yaml",theme:"vs",value:n,options:{readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})}function tF(){let e=(0,s.p)();return{markedAsApprovedToast:function(){e({title:"Marked as approved",position:"bottom-right",status:"success",containerStyle:{fontSize:"sm"},duration:2e3})}}}function tO(){let e=(0,E._)(["\n  <details><summary>","</summary>\n\n  ","\n\n  </details>"]);return tO=function(){return e},e}let tM=(e,n)=>"schema_diff"!==e&&"lineage_diff"!==e&&(!(null==n?void 0:n.result)||!!n.error),tV=e=>{var n,i,o,s,a,c,u,j,b,w,k,S,z;let{checkId:I,refreshCheckList:N}=e,{readOnly:E}=(0,ek.$)(),ea=(0,ep.NL)(),[,ec]=(0,eZ.TH)(),{successToast:ed,failToast:eu}=e0(),{markedAsApprovedToast:ef}=tF(),[eg,ej]=(0,v.useState)(),[ev,ey]=(0,v.useState)(),[eb,ew]=(0,v.useState)(!1),[eC,e_]=(0,v.useState)(""),{isOpen:eS,onOpen:ez,onClose:eD}=(0,F.q)(),eR=()=>(0,t.jsx)(O.Z,{bg:"blackAlpha.300",backdropFilter:"blur(10px) "}),[eL,eI]=(0,v.useState)((0,t.jsx)(eR,{})),{isLoading:eT,error:eq,data:eN}=(0,y.a)({queryKey:C.V.check(I),queryFn:async()=>D(I),refetchOnMount:!0}),eE=null!=eg?eg:null==eN?void 0:null===(n=eN.last_run)||void 0===n?void 0:n.run_id,{run:eF,error:eM}=n5(eE),eV=eg?!eF||"running"===eF.status:(null==eF?void 0:eF.status)==="running",eA=(null==eN?void 0:eN.type)?(0,eB.N)(eN.type):void 0,eH=null!==(c=null==eN?void 0:eN.is_preset)&&void 0!==c&&c,eP=(0,v.useRef)(null),{mutate:eJ}=(0,em.D)({mutationFn:e=>R(I,e),onSuccess:async()=>{await ea.invalidateQueries({queryKey:C.V.check(I)}),await ea.invalidateQueries({queryKey:C.V.checks()})}}),{mutate:eW}=(0,em.D)({mutationFn:()=>L(I),onSuccess:async()=>{await ea.invalidateQueries({queryKey:C.V.checks()}),ec("/checks")}}),eK=(0,v.useCallback)(async()=>{(null==eN?void 0:eN.type)&&(ej((await (0,nb.rf)(I,{nowait:!0})).run_id),await ea.invalidateQueries({queryKey:C.V.check(I)}),N&&N())},[eN,I,ej,ea,N]),eU=(0,v.useCallback)(async()=>{if(ew(!0),eE)return await (0,nb.Eg)(eE)},[eE]),eQ=async()=>{var e;if(!eN)return;let n=(e=eN,(0,eY.RI)(tO(),"".concat(e.is_checked?"✅ ":"").concat(e.name),function(e){if("query"===e.type||"query_diff"===e.type){var n;return"".concat(e5(e),"\n\n").concat((0,eY.Pn)(e1(),null===(n=e.params)||void 0===n?void 0:n.sql_template))}return e5(e)}(e)));if(!window.isSecureContext){eu("Failed to copy the check to clipboard",Error("Copy to clipboard is available only in secure contexts (HTTPS)"));return}try{await navigator.clipboard.writeText(n),ed("Copied the check to the clipboard")}catch(e){eu("Failed to copy the check to clipboard",e)}},eX=(0,v.useCallback)(()=>{let e=null==eN?void 0:eN.is_checked;eJ({is_checked:!e}),e||ef()},[null==eN?void 0:eN.is_checked,eJ,ef]),[e2,e4]=(0,v.useState)(0),{ref:e6,onCopyToClipboard:e3,onMouseEnter:e9,onMouseLeave:e8}=il();if((0,v.useEffect)(()=>{var e,n,i;e_(function(e){let{name:n,description:i,type:t,params:l,viewOptions:o}=e,r={name:n,description:i,type:t,params:l};return o&&(r.view_options=o),n2.ZP.stringify({checks:[r]})}({name:null!==(e=null==eN?void 0:eN.name)&&void 0!==e?e:"",description:null!==(n=null==eN?void 0:eN.description)&&void 0!==n?n:"",type:null!==(i=null==eN?void 0:eN.type)&&void 0!==i?i:"",params:null==eN?void 0:eN.params,viewOptions:null==eN?void 0:eN.view_options}))},[eN]),eT)return(0,t.jsx)(T.M,{h:"100%",children:"Loading"});if(eq)return(0,t.jsxs)(T.M,{h:"100%",children:["Error: ",eq.message]});let e7=(null==eF?void 0:eF.run_at)?(0,nS.Q)(new Date(eF.run_at),{addSuffix:!0}):null;return(0,t.jsxs)(eO,{minSize:100,sizes:[30,70],style:{height:"100%",width:"100%",maxHeight:"100%"},children:[(0,t.jsxs)(l.x,{style:{contain:"strict"},display:"flex",flexDirection:"column",children:[(0,t.jsxs)(d.k,{p:"0px 16px",alignItems:"center",h:"40px",children:[(0,t.jsx)(eh,{name:null!==(u=null==eN?void 0:eN.name)&&void 0!==u?u:"",setName:e=>{eJ({name:e})}}),eH&&(0,t.jsx)(M.u,{label:"Preset Check defined in recce config",children:(0,t.jsxs)(V.Vp,{size:"sm",flex:"0 0 auto",ml:"2",children:[(0,t.jsx)(V.AD,{boxSize:"14px",as:er.bX4}),"Preset"]})}),(0,t.jsx)(p.L,{}),(0,t.jsxs)(x.U,{mr:"10px",children:[e7&&(0,t.jsx)(l.x,{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontSize:"10pt",children:e7}),(0,t.jsxs)(A.v,{children:[(0,t.jsx)(H.j,{isRound:!0,as:P.h,icon:(0,t.jsx)(r.J,{as:ex.D_A}),variant:"ghost",size:"sm"}),(0,t.jsxs)(J.q,{children:[(0,t.jsx)(W.s,{as:K.x,fontSize:"10pt",icon:(0,t.jsx)(es.ovA,{}),onClick:()=>{eI((0,t.jsx)(eR,{})),ez()},children:"Get Preset Check Template"}),(0,t.jsx)(W.s,{as:K.x,fontSize:"10pt",icon:(0,t.jsx)(ei.T,{}),onClick:()=>eQ(),children:"Copy Markdown"}),(0,t.jsx)(U.R,{}),(0,t.jsx)(W.s,{as:K.x,fontSize:"10pt",icon:(0,t.jsx)(et.p,{}),color:"red",onClick:()=>{eW()},isDisabled:E,children:"Delete"})]})]}),(0,t.jsx)(M.u,{label:tM(null!==(j=null==eN?void 0:eN.type)&&void 0!==j?j:"",eF)?"Run the check first":(null==eN?void 0:eN.is_checked)?"Mark as Pending":"Mark as Approved",placement:"bottom-end",children:(0,t.jsx)(B.z,{flex:"0 0 auto",size:"sm",colorScheme:(null==eN?void 0:eN.is_checked)?"green":"gray",variant:(null==eN?void 0:eN.is_checked)?"solid":"outline",leftIcon:(null==eN?void 0:eN.is_checked)?(0,t.jsx)(el.r,{}):(0,t.jsx)(r.J,{as:ex.Rbx,color:"lightgray"}),onClick:()=>{eX()},isDisabled:tM(null!==(b=null==eN?void 0:eN.type)&&void 0!==b?b:"",eF)||E,children:(null==eN?void 0:eN.is_checked)?"Approved":"Mark as Approved"})})]})]}),(0,t.jsx)(l.x,{flex:"1",p:"8px 16px",minHeight:"100px",children:(0,t.jsx)(eG,{value:null==eN?void 0:eN.description,onChange:e=>{eJ({description:e})}},null==eN?void 0:eN.check_id)})]}),(0,t.jsx)(l.x,{style:{contain:"strict"},children:(0,t.jsxs)(m.m,{height:"100%",display:"flex",flexDirection:"column",tabIndex:e2,onChange:e4,children:[(0,t.jsxs)(f.t,{height:"50px",children:[(0,t.jsx)(g.O,{fontSize:"10pt",children:"Result"}),((null==eN?void 0:eN.type)==="query"||(null==eN?void 0:eN.type)==="query_diff")&&(0,t.jsx)(g.O,{fontSize:"10pt",children:"Query"}),(0,t.jsx)(p.L,{}),(0,t.jsxs)(x.U,{mr:"10px",children:[(null==eA?void 0:eA.RunResultView)&&(0,t.jsx)(M.u,{label:"Rerun",children:(0,t.jsx)(B.z,{leftIcon:(0,t.jsx)(eo.n,{}),variant:"outline",isLoading:eV,size:"sm",onClick:()=>eK(),isDisabled:E,children:"Rerun"})}),(0,t.jsx)(B.z,{leftIcon:(0,t.jsx)(ei.T,{}),variant:"outline",isDisabled:tM(null!==(w=null==eN?void 0:eN.type)&&void 0!==w?w:"",eF)||0!==e2,onMouseEnter:e9,onMouseLeave:e8,size:"sm",onClick:async()=>{var e,n;(null==eN?void 0:eN.type)==="lineage_diff"?null===(e=eP.current)||void 0===e||e.copyToClipboard():await e3(),(0,_.nO)({type:null!==(n=null==eN?void 0:eN.type)&&void 0!==n?n:"unknown",from:"check"})},children:"Copy to Clipboard"})]})]}),(0,t.jsxs)(Q.n,{height:"100%",flex:"1",style:{contain:"strict"},children:[(0,t.jsxs)($.x,{p:0,width:"100%",height:"100%",children:[(null==eA?void 0:eA.RunResultView)&&((null==eN?void 0:eN.last_run)||eE?(0,t.jsx)(n_,{ref:e6,isRunning:eV,isAborting:eb,run:eE?eF:null==eN?void 0:eN.last_run,error:eM,progress:ev,RunResultView:eA.RunResultView,viewOptions:null==eN?void 0:eN.view_options,onViewOptionsChanged:e=>{eJ({view_options:e})},onCancel:eU,onExecuteRun:eK}):(0,t.jsx)(T.M,{bg:"rgb(249,249,249)",height:"100%",children:(0,t.jsxs)(q.g,{spacing:4,children:[(0,t.jsx)(l.x,{children:"This action is part of the initial preset and has not been performed yet. Once performed, the result will be shown here."}),(0,t.jsx)(B.z,{onClick:eK,colorScheme:"blue",size:"sm",isDisabled:E,children:"Run Query"})]})})),eN&&"schema_diff"===eN.type&&(0,t.jsx)(e$,{check:eN,ref:e6}),eN&&"lineage_diff"===eN.type&&(0,t.jsx)(tN,{check:eN,ref:eP})]}),((null==eN?void 0:eN.type)==="query"||(null==eN?void 0:eN.type)==="query_diff"||(null==eN?void 0:eN.type)==="query_base")&&(0,t.jsx)($.x,{p:0,height:"100%",width:"100%",children:(null===(i=eN.params)||void 0===i?void 0:i.base_sql_template)?(0,t.jsx)(ny,{value:null!==(k=null===(o=eN.params)||void 0===o?void 0:o.sql_template)&&void 0!==k?k:"",baseValue:null!==(S=null===(s=eN.params)||void 0===s?void 0:s.base_sql_template)&&void 0!==S?S:"",options:{readOnly:!0}}):(0,t.jsx)(nv,{value:null!==(z=null===(a=eN.params)||void 0===a?void 0:a.sql_template)&&void 0!==z?z:"",options:{readOnly:!0}})})]})]})}),(0,t.jsxs)(Z.u_,{isOpen:eS,onClose:eD,isCentered:!0,size:"6xl",children:[eL,(0,t.jsxs)(X.h,{overflowY:"auto",height:"40%",width:"60%",children:[(0,t.jsx)(G.x,{children:"Preset Check Template"}),(0,t.jsx)(Y.o,{}),(0,t.jsxs)(ee.f,{children:[(0,t.jsxs)(h.X,{size:"sm",fontWeight:"bold",children:["Please"," ",(0,t.jsx)(K.x,{as:"span",cursor:"pointer",_hover:{textDecoration:"underline"},color:"blue.500",onClick:async()=>{await navigator.clipboard.writeText(eC),ed("Copied the template to the clipboard")},children:"copy"})," ","the following template and paste it into the"," ",(0,t.jsx)(en.y,{query:"recce.yml",styles:{px:"1",py:"0",bg:"red.100"},children:"recce.yml"})," ","file."]}),(0,t.jsx)("br",{}),(0,t.jsx)(tE,{yamlTemplate:eC})]})]})]})]})};var tA=i(81485);let tH=e=>{var n,i,o,s,a;let{check:c,selected:u,onSelect:h,onMarkAsApproved:x}=e,{readOnly:p}=(0,ek.$)(),m=(0,ep.NL)(),f=c.check_id,{mutate:g}=(0,em.D)({mutationFn:e=>R(f,e),onSuccess:async()=>{await m.invalidateQueries({queryKey:C.V.check(f)}),await m.invalidateQueries({queryKey:C.V.checks()})}}),{run:j}=n5(null===(n=c.last_run)||void 0===n?void 0:n.run_id),v=null!==(o=null===(i=(0,eB.N)(c.type))||void 0===i?void 0:i.icon)&&void 0!==o?o:ic.WzH,y=tM(null!==(s=c.type)&&void 0!==s?s:"",j)||p,b=tM(null!==(a=c.type)&&void 0!==a?a:"",j);return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(d.k,{width:"100%",p:"10px 20px",cursor:"pointer",_hover:{bg:"Cornsilk"},bg:u?"Floralwhite":"inherit",borderBlockEndWidth:"1px",borderLeftWidth:"3px",borderLeftColor:u?"orange":"transparent",onClick:()=>{h(c.check_id)},alignItems:"center",gap:"5px",children:[(0,t.jsx)(r.J,{as:v}),(0,t.jsx)(l.x,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:c.name}),(0,t.jsx)(M.u,{label:b?"Run the check first":"Click to mark as approved",placement:"top",hasArrow:!0,children:(0,t.jsx)(d.k,{children:(0,t.jsx)(iU.X,{isChecked:c.is_checked,variant:"circular",colorScheme:"green",size:"xs",onChange:e=>{let n=e.target.checked;n?x():g({is_checked:n})},disabled:y})})})]})})},tP=e=>{let{checks:n,selectedItem:i,onCheckSelected:o,onChecksReordered:r}=e,[s,a]=(0,v.useState)(!1),c=(0,ep.NL)(),{mutate:u}=(0,em.D)({mutationFn:e=>R(e,{is_checked:!0}),onSuccess:async(e,n)=>{await c.invalidateQueries({queryKey:C.V.check(n)}),await c.invalidateQueries({queryKey:C.V.checks()})}}),{isOpen:h,onOpen:x,onClose:p}=(0,F.q)(),{markedAsApprovedToast:m}=tF(),f=()=>{"true"===localStorage.getItem("bypassMarkAsApprovedWarning")?(u(i),m()):x()};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(tA.Z5,{onDragEnd:e=>{e.destination&&r(e.source.index,e.destination.index)},children:(0,t.jsx)(tA.bK,{droppableId:"checklist",children:e=>(0,t.jsxs)(q.g,{...e.droppableProps,ref:e.innerRef,className:"no-track-pii-safe",w:"full",spacing:"0",flex:"1",overflow:"auto",children:[n.map((e,n)=>(0,t.jsx)(tA._l,{draggableId:e.check_id,index:n,children:(n,l)=>{if(l.isDragging){let e=n.draggableProps;if(null!=e.style&&"left"in e.style){let n={x:0,y:80},i=e.style.left-n.x,t=e.style.top-n.y;e.style.left=i,e.style.top=t}}return(0,t.jsx)(d.k,{ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,w:"full",children:(0,t.jsx)(tH,{check:e,selected:e.check_id===i,onSelect:o,onMarkAsApproved:f},e.check_id)})}},e.check_id)),e.placeholder]})})}),(0,t.jsxs)(Z.u_,{isOpen:h,onClose:p,isCentered:!0,children:[(0,t.jsx)(O.Z,{}),(0,t.jsxs)(X.h,{width:"400px",children:[(0,t.jsx)(G.x,{children:"Mark as Approved?"}),(0,t.jsx)(Y.o,{}),(0,t.jsx)(N.i,{}),(0,t.jsxs)(l.x,{p:"16px",fontSize:"sm",gap:"16px",children:[(0,t.jsx)("p",{children:"Please ensure you have reviewed the contents of this check before marking it as approved."}),(0,t.jsx)(iU.X,{isChecked:s,onChange:e=>{a(e.target.checked)},fontWeight:"bold",size:"sm",pt:"8px",children:"Don't show this again"})]}),(0,t.jsx)(N.i,{}),(0,t.jsxs)(ni.m,{children:[(0,t.jsx)(B.z,{variant:"outline",size:"xs",mr:2,onClick:p,children:"Cancel"}),(0,t.jsx)(B.z,{colorScheme:"blue",size:"xs",onClick:()=>{u(i),s&&localStorage.setItem("bypassMarkAsApprovedWarning","true"),m(),p()},children:"Mark as approved"})]})]})]})]})};var tJ=i(4413);function tW(e){let{checksOnly:n=!0}=e,{readOnly:i}=(0,ek.$)(),l=(0,s.p)(),o=(0,ep.NL)(),a=(0,v.useRef)(null),c=(0,v.useRef)(null),[u,h]=(0,v.useState)(null),{isOpen:x,onOpen:p,onClose:m}=(0,F.q)(),[f,g]=(0,eZ.TH)(),[,j]=(0,ef.P)(),y=(0,v.useCallback)(async()=>{if(u){try{let{runs:e,checks:i}=await (0,tJ.V5)(u,n);j(),await o.invalidateQueries({queryKey:C.V.checks()}),await o.invalidateQueries({queryKey:C.V.runs()}),f.includes("/checks")&&g("/checks");let t=n?"".concat(i," checks imported successfully"):"".concat(e," runs and ").concat(i," checks imported successfully");l({description:t,status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}catch(e){console.error("Import failed",e),l({title:"Import failed",description:String(e),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}m()}},[o,u,l,m,f,g,j,n]),b=()=>{a.current&&a.current.click()},w=n?"checks":"runs and checks",{isDemoSite:k}=(0,ef.kJ)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(M.u,{label:"Import Checklist from State File"+(k?" (Disabled in the demo site)":""),children:(0,t.jsx)(P.h,{pt:"6px",variant:"unstyled","aria-label":"Import state",onClick:()=>{b(),(0,_.lH)({name:"import"})},icon:(0,t.jsx)(r.J,{as:na}),isDisabled:i||k})}),(0,t.jsx)("input",{type:"file",style:{display:"none"},ref:a,onChange:e=>{var n;(null===(n=e.target.files)||void 0===n?void 0:n.length)===1&&(h(e.target.files[0]),p()),a.current&&(a.current.value="")}}),(0,t.jsx)(i7.aR,{isOpen:x,leastDestructiveRef:c,onClose:m,size:"xl",children:(0,t.jsx)(O.Z,{children:(0,t.jsxs)(i7._T,{children:[(0,t.jsx)(G.x,{fontSize:"lg",fontWeight:"bold",children:"Import state"}),(0,t.jsx)(ee.f,{children:(0,t.jsxs)(d.k,{px:"5px",gap:"5px",rounded:"md",direction:"column",children:[(0,t.jsxs)(d.k,{alignItems:"center",gap:"5px",children:[(0,t.jsx)(nq.s,{color:"red.600"}),(0,t.jsx)(K.x,{as:"span",fontWeight:"500",color:"red.600",children:"Caution!"})]}),(0,t.jsx)(d.k,{children:(0,t.jsxs)(K.x,{children:["The current ",w," will be"," ",(0,t.jsx)(K.x,{as:"span",fontWeight:"600",children:"merged"})," ","with the imported state"]})})]})}),(0,t.jsxs)(ni.m,{children:[(0,t.jsx)(B.z,{ref:c,onClick:m,children:"Cancel"}),(0,t.jsx)(B.z,{colorScheme:"blue",onClick:y,ml:"5px",children:"Import"})]})]})})})]})}var tK=i(95958);let tU=()=>{let[,e]=(0,eZ.TH)(),[,n]=(0,eZ.yj)("/checks/:checkId"),{latestSelectedCheckId:i,setLatestSelectedCheckId:o}=(0,tK.p)(),r=(0,ep.NL)(),s=null==n?void 0:n.checkId;s&&o(s);let{isLoading:a,error:c,data:u,status:h,refetch:x}=(0,y.a)({queryKey:C.V.checks(),queryFn:z,refetchOnMount:!0}),p=(0,v.useCallback)(n=>{e("/checks/".concat(n))},[e]),[m,f]=(0,v.useState)(null!=u?u:[]),{mutate:g}=(0,em.D)({mutationFn:e=>I(e),onSuccess:async()=>{await r.invalidateQueries({queryKey:C.V.checks()})}}),j=(0,v.useCallback)((e,n)=>{let i=[...m],[t]=i.splice(e,1);i.splice(n,0,t),g({source:e,destination:n}),f(i)},[m,f,g]);return((0,v.useEffect)(()=>{"success"===h&&(!s&&u.length>0&&(i?e("/checks/".concat(i)):e("/checks/".concat(u[0].check_id))),f(u))},[h,s,u,f,e,i]),a)?(0,t.jsx)(t.Fragment,{}):c?(0,t.jsxs)(t.Fragment,{children:["Error: ",c.message]}):(null==u?void 0:u.length)?(0,t.jsxs)(eF,{style:{height:"100%"},minSize:50,sizes:[20,80],children:[(0,t.jsx)(l.x,{borderRight:"lightgray solid 1px",height:"100%",style:{contain:"size"},children:(0,t.jsxs)(q.g,{spacing:0,h:"100%",style:{contain:"strict"},alignItems:"stretch",children:[(0,t.jsx)(d.k,{justifyContent:"right",padding:"0px 10px",children:(0,t.jsx)(tW,{checksOnly:!0})}),(0,t.jsx)(N.i,{}),(0,t.jsx)(tP,{checks:m,selectedItem:s,onCheckSelected:p,onChecksReordered:j})]})}),(0,t.jsx)(l.x,{height:"100%",children:(0,t.jsx)(eZ.rs,{children:(0,t.jsx)(eZ.AW,{path:"/checks/:checkId",children:e=>(0,t.jsx)(tV,{checkId:e.checkId,refreshCheckList:x},e.checkId)})})})]}):(0,t.jsx)(T.M,{h:"100%",children:(0,t.jsx)(l.x,{children:"No checks"})})},tB=()=>{let{isHistoryOpen:e,showHistory:n,closeHistory:i}=(0,ej.$q)();return(0,t.jsxs)(l.x,{children:[(0,t.jsx)(l.x,{fontSize:"8pt",children:"History"}),(0,t.jsx)(B.z,{leftIcon:(0,t.jsx)(r.J,{as:ex.M1Q}),size:"xs",variant:"outline",onClick:()=>{e?((0,_.U8)({name:"hide"}),i()):((0,_.U8)({name:"show"}),n())},children:e?"Hide":"Show"})]})},tQ=()=>{let{isCustomQueries:e,setCustomQueries:n,sqlQuery:i,setBaseSqlQuery:o}=(0,nX.rV)();return(0,t.jsxs)(l.x,{children:[(0,t.jsxs)(l.x,{fontSize:"8pt",children:["Custom Queries"," ",(0,t.jsx)(M.u,{label:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,t.jsx)(nq.s,{color:"gray.600",boxSize:"3"})})]}),(0,t.jsx)(ts.r,{size:"sm",isChecked:e,onChange:()=>{!e&&o&&o(i),n(!e)}})]})},t$=()=>{let{sqlQuery:e,baseSqlQuery:n,setSqlQuery:i,setBaseSqlQuery:o,primaryKeys:r,setPrimaryKeys:s,isCustomQueries:a}=(0,nX.rV)(),{lineageGraph:c,envInfo:u}=(0,ef.kJ)(),{readOnly:h}=(0,ek.$)(),{data:x}=(0,n1.P)(),m=e;(null==u?void 0:u.adapterType)==="sqlmesh"&&e===nX.nw&&(m="select * from db.mymodel"),h&&(m="--- Would like to do query here? Book a demo with us at https://datarecce.io/\n".concat(m));let{showRunId:f}=(0,ej.$q)(),g=async e=>{let i="query_base"===e?null!=n?n:"":m,t=function(e){switch(e){case"query":return ik;case"query_base":return iC;case"query_diff":return i_;default:throw Error("Unknown query type: ".concat(e))}}(e),l={sql_template:i};"query_diff"===e&&(l.primary_keys=r,a&&(l.base_sql_template=n));let{run_id:o}=await t(l,{nowait:!0});return f(o),await (0,nb.Qp)(o)},{mutate:j,isPending:y}=(0,em.D)({mutationFn:g}),b=(0,v.useMemo)(()=>{let e={};for(let i in null==c?void 0:c.nodes){var n;let t=null===(n=c.nodes[i].data.current)||void 0===n?void 0:n.schema;t&&(e[t]=(e[t]||0)+1)}return Object.keys(e).reduce((n,i)=>e[i]>(e[n]||0)?i:n,"N/A")},[null==c?void 0:c.nodes]);return(null==x?void 0:x.single_env_onboarding)?(0,t.jsxs)(d.k,{direction:"column",height:"100%",children:[(0,t.jsxs)(d.k,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",children:[(0,t.jsx)(tB,{}),(0,t.jsx)(p.L,{}),(0,t.jsx)(M.u,{label:"Please configure the base environment before running the diff",placement:"left",children:(0,t.jsx)(B.z,{colorScheme:"blue",isDisabled:!0,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})})]}),(0,t.jsx)(ny,{value:m,onChange:i,onRun:()=>{j("query")},labels:["base (production)","current (".concat(b,")")],BaseEnvironmentSetupGuide:(0,t.jsx)(tj,{})})]}):(0,t.jsxs)(d.k,{direction:"column",height:"100%",children:[(0,t.jsxs)(d.k,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,t.jsx)(tB,{}),(0,t.jsx)(tQ,{}),(0,t.jsx)(p.L,{}),(0,t.jsx)(iT,{defaultPrimaryKeys:r,onPrimaryKeysChange:s}),(0,t.jsx)(B.z,{colorScheme:"blue",onClick:()=>{j("query_diff")},isDisabled:y||h,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})]}),(0,t.jsx)(l.x,{width:"100%",flex:"1",children:a?(0,t.jsx)(ny,{value:m,baseValue:n,onChange:i,onChangeBase:o,onRun:()=>{j("query")},onRunBase:()=>{j("query_base")},onRunDiff:()=>{j("query_diff")}}):(0,t.jsx)(nv,{value:m,onChange:i,onRun:()=>{j("query")},onRunDiff:()=>{j("query_diff")}})})]})},tZ=e=>{var n;let{runId:i}=e,{isPending:l,error:o,data:r}=(0,y.a)({queryKey:C.V.run(i),queryFn:async()=>(0,nb.Qp)(i)}),s=(null==r?void 0:r.type)?null===(n=(0,eB.N)(r.type))||void 0===n?void 0:n.RunResultView:void 0;return(0,t.jsx)(n_,{isPending:l,error:o,run:r,RunResultView:s})},tX=e=>{let{error:n,resetError:i}=e;return(0,t.jsx)(T.M,{height:"100%",backgroundColor:"gray.50",children:(0,t.jsxs)(d.k,{p:4,direction:"column",justifyContent:"flex-start",backgroundColor:"white",border:"solid lightgray 1px",minHeight:"200px",children:[(0,t.jsx)(h.X,{width:"800px",size:"md",children:"You have encountered an error"}),(0,t.jsx)(l.x,{flex:"1",fontSize:"10pt",children:n.toString()}),(0,t.jsx)(B.z,{justifySelf:"center",alignSelf:"center",mt:"20px",colorScheme:"blue",size:"sm",onClick:()=>{i()},children:"Reset"})]})})},tG=e=>{let{children:n}=e;return(0,t.jsx)(nC.SV,{fallback:tX,children:n})};function tY(){let{readOnly:e}=(0,ek.$)(),n=(0,s.p)(),i=async()=>{try{let e=await (0,tJ.xq)(),n=JSON.stringify(e,null,2),i=new Blob([n],{type:"application/json"}),t=new Date,l="recce-state-".concat((0,nl.WU)(t,"yyyy-MM-dd-HH-mm-ss"),".json");ie()(i,l)}catch(e){console.error("Export failed",e),n({title:"Export failed",description:String(e),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}};return(0,t.jsx)(M.u,{label:"Export",children:(0,t.jsx)(P.h,{size:"sm",variant:"unstyled","aria-label":"Export state",onClick:async()=>{await i(),(0,_.lH)({name:"export"})},icon:(0,t.jsx)(r.J,{as:ns,verticalAlign:"middle",boxSize:"16px"}),isDisabled:e})})}function t0(){return(0,t.jsx)(nR.tV,{children:(0,t.jsx)(tq,{interactive:!0})})}i(68994);var t1=i(7992);i(80009);let t5=e=>{var n,i;let{run:o,isSelected:s,onSelectRun:a,onAddToChecklist:c,onGoToCheck:u}=e,{readOnly:h,singleEnv:x}=(0,ek.$)(),{data:p}=(0,y.a)({queryKey:C.V.run(o.run_id),queryFn:async()=>await (0,nb.Qp)(o.run_id),enabled:"running"===o.status,retry:!1}),m=null!==(i=null===(n=(0,eB.N)(o.type))||void 0===n?void 0:n.icon)&&void 0!==i?i:ic.WzH,f=o.check_id;return(0,t.jsxs)(d.k,{minWidth:"200px",direction:"column",width:"100%",p:"5px 20px",cursor:"pointer",borderBottom:"solid 1px lightgray",borderLeft:"4px",borderLeftColor:s?"orange.400":"transparent",backgroundColor:s?"orange.50":"transparent",onClick:()=>{a(o.run_id)},_hover:{bg:s?"orange.50":"gray.200"},children:[(0,t.jsxs)(d.k,{onClick:()=>{},alignItems:"center",gap:"12px",children:[(0,t.jsx)(r.J,{as:m}),(0,t.jsx)(l.x,{className:"no-track-pii-safe",flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",color:o.name?"inherit":"gray.500",fontSize:"11pt",fontWeight:"500",children:o.name||"<no name>"}),f?(0,t.jsx)(M.u,{label:"Go to Check","aria-label":"Go to Check",children:(0,t.jsx)(K.x,{onClick:e=>{e.preventDefault(),e.stopPropagation(),u(f)},children:(0,t.jsx)(r.J,{color:"green",as:eV.FJM})})}):h||x?null:(0,t.jsx)(M.u,{label:"Add to Checklist","aria-label":"Add to Checklist",children:(0,t.jsx)(K.x,{onClick:e=>{e.preventDefault(),e.stopPropagation(),(0,_.U8)({name:"add_to_checklist"}),c(o.run_id)},children:(0,t.jsx)(r.J,{as:eV.wO})})})]}),(0,t.jsx)(d.k,{justifyContent:"start",fontSize:"11pt",color:"gray.500",gap:"3px",alignItems:"center",children:(0,t.jsx)(ir,{run:null!=p?p:o})})]})},t2=e=>{let{runAt:n}=e,i=n?function(e){let n=new Date,i=new Date;return(i.setDate(n.getDate()-1),null==e)?null:n.toDateString()===e.toDateString()?"Today":i.toDateString()===e.toDateString()?"Yesterday":(0,nl.WU)(e,"MMM d")}(new Date(n)):null;return(0,t.jsx)(d.k,{minWidth:"200px",width:"100%",p:"5px 20px",borderBottom:"solid 1px lightgray",color:"gray.500",fontSize:"11pt",children:i})},t4=()=>{let{data:e,isLoading:n,isFetching:i,error:o,refetch:r}=(0,y.a)({queryKey:C.V.runs(),queryFn:async()=>await (0,nb.sw)(),retry:!1}),{showRunId:s,runId:a}=(0,ej.$q)(),c=e=>{(0,_.U8)({name:"click_run"}),s(e,!1)},[,u]=(0,eZ.TH)(),m=(0,ep.NL)(),f=(0,v.useCallback)(async()=>{if(!a)return;let e=await S(a);await m.invalidateQueries({queryKey:C.V.checks()}),u("/checks/".concat(e.check_id))},[a,u,m]),g=(0,v.useCallback)(e=>{(0,_.U8)({name:"go_to_check"}),u("/checks/".concat(e))},[u]),j=null;return(0,t.jsxs)(d.k,{direction:"column",height:"100%",children:[(0,t.jsxs)(x.U,{width:"100%",flex:"0 0 54px",paddingInline:"24px 8px",borderBottom:"solid 1px lightgray",children:[(0,t.jsx)(h.X,{size:"md",children:"History"}),(0,t.jsx)(p.L,{}),(0,t.jsx)(P.h,{variant:"unstyled",icon:(0,t.jsx)(eo.n,{}),"aria-label":"Search database",onClick:async()=>{await r()}})]}),(0,t.jsx)(l.x,{flex:"1 1 auto",children:n?"Loading...":(null==e?void 0:e.length)===0?(0,t.jsx)(T.M,{height:"100%",color:"gray.400",children:"No runs"}):(0,t.jsx)(t1.Z,{style:{minHeight:"100%",height:0},children:(null!=e?e:[]).map((e,n)=>{let i=new Date(e.run_at).toDateString(),l=null!=j&&j!==i;return j=i,(0,t.jsxs)(t.Fragment,{children:[l&&(0,t.jsx)(t2,{runAt:e.run_at},i),(0,t.jsx)(t5,{run:e,isSelected:e.run_id===a,onSelectRun:c,onGoToCheck:g,onAddToChecklist:f},e.run_id)]})})})})]})};var t6=i(18494);let t3=()=>{let e=(0,s.p)();return{toastSuccess:n=>{e({description:n,status:"success",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0})},toastError:(n,i)=>{let t=n;if(null!=i){if(i instanceof i3.d7){var l,o;t="".concat(n,". ").concat(String(null===(o=i.response)||void 0===o?void 0:null===(l=o.data)||void 0===l?void 0:l.detail))}else t="".concat(n,". ").concat(i)}e({description:t,status:"error",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0})}}},t9=e=>{(0,v.useEffect)(()=>{let n=e=>{e.preventDefault()};return e&&window.addEventListener("beforeunload",n),()=>{e&&window.removeEventListener("beforeunload",n)}},[e])},t8=()=>{var e,n;let i;let{readOnly:o}=(0,ek.$)(),{fileName:s,cloudMode:a,isDemoSite:c,envInfo:u}=(0,ef.kJ)(),h=(0,F.q)(),x=(0,F.q)(),p=!s&&!a&&!c,{data:m}=(0,y.a)({queryKey:C.V.checks(),queryFn:z,enabled:p}),f=void 0!=m&&m.filter(e=>!e.is_preset).length>0;t9(p&&f);let[{newFileName:g,errorMessage:j,modified:b,overwriteWithMethod:w,bypass:k},_]=(0,v.useState)({newFileName:null!=s?s:"recce_state.json"}),S=(0,v.useRef)(null),{toastSuccess:D,toastError:R}=t3(),L=(0,ep.NL)(),I=async(e,n)=>{if(!g)return;let i="true"===localStorage.getItem(iO.bypassSaveOverwrite);try{"save"===e?await (0,tJ.po)({filename:g,overwrite:null!=n?n:i}):await (0,tJ.PQ)({filename:g,overwrite:null!=n?n:i}),D("save"===e?"Save file successfully":"Rename file successfully"),await L.invalidateQueries({queryKey:C.V.lineage()}),k&&localStorage.setItem(iO.bypassSaveOverwrite,"true")}catch(n){if(n instanceof i3.d7){var t;if((null===(t=n.response)||void 0===t?void 0:t.status)===409){_(n=>({...n,overwriteWithMethod:e})),x.onOpen();return}}R("save"===e?"Save file failed":"Rename file failed",n)}finally{h.onClose()}};if(a||c)return(0,t.jsx)(t.Fragment,{});if(o&&s){let n=null==u?void 0:null===(e=u.stateMetadata)||void 0===e?void 0:e.generated_at,t=n?io(new Date(n)):null;i=t?"".concat(s," (").concat(t,")"):null}return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(d.k,{justifyContent:"center",alignItems:"center",children:[(0,t.jsx)(l.x,{fontWeight:"600",children:null!==(n=null!=i?i:s)&&void 0!==n?n:"New Instance"+(f?" (unsaved)":"")}),!o&&(0,t.jsx)(M.u,{label:s?"Change Filename":"Save",openDelay:1e3,children:(0,t.jsx)(P.h,{onClick:()=>{_({newFileName:null!=s?s:"recce_state.json",modified:!s}),h.onOpen()},"aria-label":"",variant:"unstyled",size:"sm",children:(0,t.jsx)(r.J,{as:s?nd:nc,boxSize:"16px",verticalAlign:"middle"})})})]}),(0,t.jsxs)(Z.u_,{isOpen:h.isOpen,onClose:h.onClose,isCentered:!0,children:[(0,t.jsx)(O.Z,{}),(0,t.jsxs)(X.h,{children:[(0,t.jsx)(G.x,{children:s?"Change Filename":"Save File"}),(0,t.jsx)(Y.o,{}),(0,t.jsx)(ee.f,{onKeyDown:e=>{e.stopPropagation()},children:(0,t.jsxs)(iL.NI,{isInvalid:!!j,children:[(0,t.jsx)(iI.l,{children:"File name:"}),(0,t.jsx)(ed.I,{ref:S,value:g,placeholder:"Enter filename",onChange:e=>{let n;let i=e.target.value;i?i.endsWith(".json")?/^[a-zA-Z0-9 _-]+\.json$/.test(i)?s&&i===s&&(n="Filename is the same as the current one."):n="Invalid filename. Only alphanumeric, space, _ and - are allowed.":n="Filename must end with .json.":n="Filename cannot be empty.",_(e=>({...e,modified:!0,newFileName:i,errorMessage:n}))},onKeyDown:e=>{"Enter"===e.key?j||(s?I("rename"):I("save")):"Escape"===e.key&&h.onClose()}}),(0,t.jsx)(t6.J1,{children:j})]})}),(0,t.jsxs)(ni.m,{gap:"5px",children:[(0,t.jsx)(B.z,{size:"sm",colorScheme:s?void 0:"blue",onClick:async()=>{await I("save")},isDisabled:!g||!!j||!b,children:s?"Save as New File":"Confirm"}),s&&(0,t.jsx)(B.z,{size:"sm",colorScheme:"blue",onClick:async()=>{await I("rename")},isDisabled:!g||!!j||!b,children:"Rename"})]})]})]}),(0,t.jsxs)(Z.u_,{isOpen:x.isOpen,onClose:x.onClose,initialFocusRef:S,isCentered:!0,children:[(0,t.jsx)(O.Z,{}),(0,t.jsxs)(X.h,{children:[(0,t.jsx)(G.x,{children:"Overwrite File?"}),(0,t.jsx)(Y.o,{}),(0,t.jsxs)(ee.f,{borderTop:"solid 1px lightgray",borderBottom:"solid 1px lightgray",onKeyDown:e=>{e.stopPropagation()},children:[(0,t.jsx)(l.x,{fontSize:"12pt",children:"save"===w?"Saving a file with this name will overwrite the existing file. Are you sure you wish to continue?":"Renaming the file with this name will overwrite the existing file. Are you sure you wish to continue?"}),(0,t.jsx)(iU.X,{isChecked:k,onChange:e=>{_(n=>({...n,bypass:e.target.checked}))},fontWeight:"bold",size:"sm",pt:"8px",children:"Don't show this again"})]}),(0,t.jsxs)(ni.m,{gap:"5px",children:[(0,t.jsx)(B.z,{variant:"outline",onClick:()=>{x.onClose(),h.onOpen(),_(e=>({...e,overwriteWithMethod:void 0}))},size:"sm",children:"Back"}),(0,t.jsx)(B.z,{size:"sm",colorScheme:"blue",onClick:()=>{w&&(I(w,!0),x.onClose())},children:"Overwrite"})]})]})]})]})};var t7=i(4799),le=i(39734);function ln(){return(0,t.jsx)(M.u,{label:"Syncing",children:(0,t.jsx)(B.z,{pt:"6px",variant:"unstyled",boxSize:"1em",children:(0,t.jsx)(ev.$,{})})})}function li(){let[e,n]=(0,v.useState)(!1),i=(0,ep.NL)(),[o,a]=(0,eZ.TH)(),{isOpen:c,onOpen:d,onClose:u}=(0,F.q)(),[h,x]=(0,v.useState)(""),p=(0,s.p)(),m=(0,v.useCallback)(async e=>{if(u(),n(!0),"conflict"===(await (0,tJ.mB)(e)).status){d(),n(!1);return}for(;await (0,tJ.tw)();)await new Promise(e=>setTimeout(e,1e3));p({description:"Sync Completed",status:"success",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0}),n(!1),x(""),await i.invalidateQueries({queryKey:C.V.lineage()}),await i.invalidateQueries({queryKey:C.V.checks()}),await i.invalidateQueries({queryKey:C.V.runs()}),/^\/checks\/([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/.test(o)&&a("/checks")},[i,o,a,p,d,u]);return e?(0,t.jsx)(ln,{}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(M.u,{label:"Sync with Cloud",children:(0,t.jsx)(P.h,{size:"sm",variant:"unstyled","aria-label":"Sync state",onClick:()=>m({}),icon:(0,t.jsx)(r.J,{as:nr,verticalAlign:"middle",boxSize:"16px"})})}),(0,t.jsxs)(Z.u_,{isOpen:c,onClose:u,children:[(0,t.jsx)(O.Z,{}),(0,t.jsxs)(X.h,{children:[(0,t.jsx)(G.x,{fontSize:"lg",fontWeight:"bold",children:"Sync with Cloud"}),(0,t.jsxs)(ee.f,{children:[(0,t.jsx)(l.x,{children:"New changes have been detected in the cloud. Please choose a method to sync your state"}),(0,t.jsx)(l.x,{mt:"5px",children:(0,t.jsx)(t7.E,{onChange:x,value:h,children:(0,t.jsxs)(e2.K,{direction:"column",children:[(0,t.jsxs)(le.Y,{value:"merge",children:["Merge",(0,t.jsx)(M.u,{label:"This will merge the local and remote states.",children:(0,t.jsx)("span",{children:(0,t.jsx)(r.J,{as:tn.h,ml:2,cursor:"pointer"})})})]}),(0,t.jsxs)(le.Y,{value:"overwrite",children:["Overwrite",(0,t.jsx)(M.u,{label:"This will overwrite the remote state file with the local state.",children:(0,t.jsx)("span",{children:(0,t.jsx)(r.J,{as:tn.h,ml:2,cursor:"pointer"})})})]}),(0,t.jsxs)(le.Y,{value:"revert",children:["Revert",(0,t.jsx)(M.u,{label:"This will discard local changes and revert to the cloud state.",children:(0,t.jsx)("span",{children:(0,t.jsx)(r.J,{as:tn.h,ml:2,cursor:"pointer"})})})]})]})})})]}),(0,t.jsxs)(ni.m,{children:[(0,t.jsx)(B.z,{onClick:u,mr:3,children:"Cancel"}),(0,t.jsx)(B.z,{colorScheme:"blue",onClick:()=>m({method:h}),isDisabled:!h,children:"Sync"})]})]})]})]})}var lt=i(33416);function ll(){let{successToast:e,failToast:n}=e0(),{onCopy:i}=(0,lt.V)(""),{authed:l}=(0,ek.$)(),{shareUrl:o,isLoading:r,error:s,handleShareClick:a}=(0,id.z)(),[c,u]=(0,v.useState)(!1),h=()=>{try{i(o),e("Copied the link to clipboard")}catch(e){n("Failed to copy the link",e)}};return l?(0,t.jsxs)(d.k,{flex:"1",alignItems:"center",gap:"5px",children:[(0,t.jsx)(B.z,{size:"sm",variant:"outline",onClick:async()=>{await a(),(0,_.v4)({name:"create"})},leftIcon:(0,t.jsx)(ic.eOs,{}),rightIcon:o?(0,t.jsx)(el.r,{color:"green"}):void 0,isLoading:r,children:"Share"}),(0,t.jsxs)(d.k,{gap:"5px",alignItems:"center",children:[o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.k,{overflowX:"auto",whiteSpace:"nowrap",maxWidth:"350px",children:(0,t.jsx)(K.x,{fontSize:"14",children:o})}),(0,t.jsx)(P.h,{size:"xs","aria-label":"Copy the share URL",icon:(0,t.jsx)(ei.T,{}),onClick:()=>{h(),(0,_.v4)({name:"copy"})}})]}),s&&(0,t.jsx)(K.x,{fontSize:"14",color:"red.500",children:s})]})]}):(0,t.jsxs)(d.k,{flex:"1",alignItems:"center",children:[(0,t.jsx)(B.z,{size:"sm",variant:"outline",leftIcon:(0,t.jsx)(ic.eOs,{}),onClick:()=>{u(!0)},children:"Share"}),c&&(0,t.jsx)(ig,{handleParentClose:()=>{u(!1)},ignoreCookie:!0})]})}let lo={TOAST_ID:"lifetime-countdown",WARNING_THRESHOLD:60,UPDATE_INTERVAL:1e3,MESSAGE:e=>"The server will be closed in ".concat(e," seconds."),STYLE:{fontFamily:"monospace"}},lr=e=>{let{children:n,path:i}=e,[o]=(0,eZ.yj)(i);return(0,t.jsx)(l.x,{display:o?"block":"none",height:"100%",children:n})};function ls(e){let{icon:n,href:i,...l}=e;return(0,t.jsx)(o.r,{height:"20px",color:"white",href:i,isExternal:!0,...l,children:(0,t.jsx)(r.J,{color:"white",boxSize:"20px",as:n})})}function la(){let{version:e,latestVersion:n}=function(){let[e,n]=(0,v.useState)(""),[i,t]=(0,v.useState)("");return(0,v.useEffect)(()=>{(async function(){try{let{version:e,latestVersion:i}=(await k.U.get("/api/version")).data;n(e),t(i)}catch(e){console.error("Error fetching version number:",e)}})()},[]),{version:e,latestVersion:i}}(),i=(0,s.p)(),l="recce-update-available";return RegExp("^\\d+\\.\\d+\\.\\d+$").test(e)?(e===n||i.isActive(l)||i({id:l,title:"Update available",position:"top-right",description:(0,t.jsxs)("span",{children:["A new version of Recce (v",n,") is available.",(0,t.jsx)("br",{}),"Please run ",(0,t.jsx)(c.E,{children:"pip install --upgrade recce"})," to update Recce.",(0,t.jsx)("br",{}),(0,t.jsx)(o.r,{color:"rgb(255, 215, 0)",fontWeight:"bold",href:"https://github.com/DataRecce/recce/releases/tag/v".concat(n),isExternal:!0,_hover:{textDecoration:"underline"},target:"_blank",children:"Click here to view the detail of latest release"})]}),containerStyle:{background:"rgba(20, 20, 20, 0.6)",color:"white",backdropFilter:"blur(10px)",borderRadius:"8px"},variant:"unstyled",isClosable:!0}),(0,t.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:(0,t.jsx)(o.r,{href:"https://github.com/DataRecce/recce/releases/tag/v".concat(e),isExternal:!0,_hover:{textDecoration:"none"},children:e})})):(0,t.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:e})}function lc(){var e;let{reviewMode:n,isDemoSite:i,envInfo:c,cloudMode:m}=(0,ef.kJ)(),{readOnly:f,lifetimeExpiredAt:g}=(0,ek.$)(),{url:j,id:y}=null!==(e=null==c?void 0:c.pullRequest)&&void 0!==e?e:{},b=j?j.split("/").pop():null;return!function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,s.p)(),t=(0,v.useRef)(),l=(0,v.useRef)(),o=(0,v.useMemo)(()=>{var e,i,t;return{position:null!==(e=n.position)&&void 0!==e?e:"bottom-right",variant:null!==(i=n.variant)&&void 0!==i?i:"left-accent",status:null!==(t=n.status)&&void 0!==t?t:"warning",duration:null,isClosable:!0,containerStyle:lo.STYLE}},[n.position,n.variant,n.status]),r=(0,v.useCallback)(()=>{if(!e)return 0;let n=new Date;return Math.max(0,Math.floor((e.getTime()-n.getTime())/1e3))},[e]),a=(0,v.useCallback)(()=>{t.current&&(i.close(t.current),t.current=void 0),l.current&&(clearInterval(l.current),l.current=void 0)},[i]),c=(0,v.useCallback)(()=>{if(!t.current)return;let e=r();if(e<=0){a();return}i.update(t.current,{...o,description:lo.MESSAGE(e)})},[i,o,r,a]),d=(0,v.useCallback)(()=>{if(!e)return;a();let n=r();n<=0||(t.current=i({id:lo.TOAST_ID,description:lo.MESSAGE(n),...o}),l.current=setInterval(c,lo.UPDATE_INTERVAL))},[e,i,r,o,c,a]);(0,v.useEffect)(()=>{if(!e)return;let n=r();if(n-lo.WARNING_THRESHOLD<0)d();else{let e=setTimeout(d,(n-lo.WARNING_THRESHOLD)*1e3);return()=>{clearTimeout(e),a()}}return a},[e,r,d,a])}(g),(0,t.jsxs)(d.k,{gap:"10px",minHeight:"40px",alignItems:"center",bg:"rgb(255, 110, 66)",children:[(0,t.jsx)(u.E,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,t.jsx)(h.X,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,t.jsx)(la,{}),(f||n)&&(0,t.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:f?"read only":"review mode"}),m&&y&&(0,t.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:(0,t.jsxs)(x.U,{children:[(0,t.jsx)(l.x,{children:"cloud mode"}),(0,t.jsx)(l.x,{borderLeft:"1px",borderLeftColor:"whiteAlpha.500",paddingLeft:"8px",children:(0,t.jsxs)(o.r,{href:j,_hover:{textDecoration:"none"},isExternal:!0,children:[(0,t.jsx)(r.J,{as:ex.X9P,boxSize:"3",fontWeight:"extrabold",strokeWidth:"1"})," #".concat(String(y))]})})]})}),i&&j&&b&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(a.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:(0,t.jsxs)(x.U,{children:[(0,t.jsx)(l.x,{children:"demo mode"}),(0,t.jsx)(l.x,{borderLeft:"1px",borderLeftColor:"whiteAlpha.500",paddingLeft:"8px",children:(0,t.jsxs)(o.r,{href:j,_hover:{textDecoration:"none"},isExternal:!0,children:[(0,t.jsx)(r.J,{as:ex.X9P,boxSize:"3",fontWeight:"extrabold",strokeWidth:"1"})," #".concat(b)]})})]})})}),(0,t.jsx)(p.L,{}),(0,t.jsx)(ls,{icon:eV.hJX,href:"https://github.com/DataRecce/recce"}),(0,t.jsx)(ls,{icon:eV.w5k,href:"https://getdbt.slack.com/archives/C05C28V7CPP"}),(0,t.jsx)(ls,{mr:"18px",icon:eV.MXt,href:"https://docs.datarecce.io"})]})}function ld(e){let{queryKey:n,fetchCallback:i,selectCallback:o}=e,{data:r,isLoading:s,error:a}=(0,y.a)({queryKey:n,queryFn:i,select:o});return s||a||0===r?(0,t.jsx)(t.Fragment,{}):(0,t.jsx)(l.x,{ml:"2px",maxH:"20px",height:"80%",aspectRatio:1,borderRadius:"full",bg:"tomato",alignContent:"center",color:"white",fontSize:"xs",children:r})}function lu(){let{isDemoSite:e,cloudMode:n,isLoading:i}=(0,ef.kJ)(),{readOnly:o}=(0,ek.$)(),[r,s]=(0,eZ.TH)(),{data:a,isLoading:c}=(0,n1.P)(),u=[{name:"Lineage",href:"/lineage"},{name:"Query",href:"/query"},{name:"Checklist",href:"/checks",badge:(0,t.jsx)(ld,{queryKey:C.V.checks(),fetchCallback:z,selectCallback:e=>e.filter(e=>!e.is_checked).length}),disable:(null==a?void 0:a.single_env_onboarding)===!0}],h=w().findIndex(u,e=>{let{href:n}=e;return r.startsWith(n)});return(0,t.jsx)(m.m,{index:h,children:(0,t.jsxs)(f.t,{children:[(0,t.jsx)(l.x,{flex:"1",display:"flex",children:u.map(e=>{let{name:n,href:l,badge:o,disable:r}=e;return(0,t.jsxs)(g.O,{onClick:()=>{s(l)},isDisabled:!!i||c||r,hidden:r,children:[n,o]},n)})}),(0,t.jsx)(d.k,{flex:"3",justifyContent:"right",alignItems:"center",children:!i&&!e&&(0,t.jsx)(t8,{})}),(0,t.jsx)(d.k,{flex:"3",justifyContent:"left",alignItems:"center",children:!i&&!e&&!(null==a?void 0:a.single_env_onboarding)&&!o&&(0,t.jsx)(ll,{})}),!i&&(0,t.jsxs)(d.k,{flex:"3",justifyContent:"right",alignItems:"center",mr:"8px",children:[(0,t.jsx)(nj,{}),n&&(0,t.jsx)(li,{}),(0,t.jsx)(tY,{})]})]})})}function lh(){let{isRunResultOpen:e,isHistoryOpen:n,closeRunResult:i}=(0,ej.$q)(),{data:o}=(0,n1.P)(),[r]=(0,eZ.TH)(),s=n&&!r.startsWith("/checks");return(0,t.jsxs)(eF,{sizes:[0,100],minSize:s?300:0,gutterSize:s?5:0,style:{height:"100%"},children:[(0,t.jsx)(l.x,{style:{contain:"size"},children:s&&(0,t.jsx)(t4,{})}),(0,t.jsxs)(eO,{sizes:e?[50,50]:[100,0],minSize:e?100:0,gutterSize:e?5:0,style:{flex:"1",contain:"size"},children:[(0,t.jsx)(l.x,{p:0,style:{contain:"content"},children:(0,t.jsxs)(tG,{children:[(0,t.jsx)(lr,{path:"/lineage",children:(0,t.jsx)(t0,{})}),(0,t.jsxs)(eZ.rs,{children:[(0,t.jsx)(eZ.AW,{path:"/query",children:(0,t.jsx)(t$,{})}),(0,t.jsx)(eZ.AW,{path:"/checks/:slug*",children:(0,t.jsx)(tU,{})}),(0,t.jsx)(eZ.AW,{path:"/runs/:runId",children:e=>{let{runId:n}=e;return(0,t.jsx)(tZ,{runId:n})}}),(0,t.jsx)(eZ.AW,{path:"/ssr",children:(0,t.jsx)(j.E,{size:"xs",isIndeterminate:!0})}),(0,t.jsx)(eZ.AW,{children:(0,t.jsx)(eZ.l_,{to:"/lineage"})})]})]})}),e?(0,t.jsx)(iw,{onClose:i,isSingleEnvironment:!!(null==o?void 0:o.single_env_onboarding)}):(0,t.jsx)(l.x,{})]})]})}function lx(e){let{children:n}=e;return(0,t.jsx)(d.k,{direction:"column",height:"100vh",overflow:"hidden",children:n})}function lp(){let{isDemoSite:e,isLoading:n}=(0,ef.kJ)(),{readOnly:i}=(0,ek.$)();return(0,v.useEffect)(()=>{(0,_.JY)()},[]),(0,t.jsxs)(lx,{children:[(0,t.jsx)(lc,{}),(0,t.jsx)(lu,{}),(0,t.jsx)(lh,{}),!n&&!e&&!i&&(0,t.jsx)(ig,{})]})}},57958:function(){},87450:function(){},41908:function(){}},function(e){e.O(0,[574,836,62,509,989,147,495,376,678,20,413,648,995,739,283,303,22,25,355,599,63,627,33,249,598,42,744],function(){return e(e.s=95883)}),_N_E=e.O()}]);