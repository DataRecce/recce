(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{27709:function(e,n,t){Promise.resolve().then(t.bind(t,4326))},4326:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return rU}});var i=t(95766),r=t(88117),l=t(78390),s=t(51742),o=t(58396),a=t(49989),c=t(41042),d=t(15370),u=t(68825),h=t(26138),x=t(78939),m=t(63993),p=t(83246),f=t(50068),g=t(630),v=t(27470),j=t(66518),y=t(57489),b=t(39944),k=t(55465);let w='select * from {{ ref("mymodel") }}',C=(0,j.createContext)({sqlQuery:w,setSqlQuery:()=>{},primaryKeys:void 0,setPrimaryKeys:()=>{},isCustomQueries:!1,setCustomQueries:()=>{},baseSqlQuery:w,setBaseSqlQuery:()=>{}});function _(e){let{children:n}=e,[t,r]=j.useState(w),[l,s]=j.useState(w),[o,a]=j.useState(!1),[c,d]=j.useState();return(0,i.jsx)(C.Provider,{value:{setSqlQuery:r,sqlQuery:t,setPrimaryKeys:d,primaryKeys:c,isCustomQueries:o,setCustomQueries:a,baseSqlQuery:l,setBaseSqlQuery:s},children:n})}let S=()=>(0,j.useContext)(C),z=(0,j.createContext)({isNodesFetching:[],setIsNodesFetching:()=>{}});function R(e){let{children:n}=e,[t,r]=j.useState([]);return(0,i.jsx)(z.Provider,{value:{isNodesFetching:t,setIsNodesFetching:r},children:n})}var T=t(48510);function E(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=new Set,r={},l=(e,t)=>{if(!(t<0)&&(void 0===r[e]||!(r[e]>=t))){for(let i of(r[e]=t,n(e)))l(i,t-1);i.add(e)}};for(let n of e)l(n,t);return i}var D=t(28482),I=t.n(D);function O(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return E(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].parents),t)}function M(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return E(n,n=>void 0===e.nodes[n]?[]:Object.keys(e.nodes[n].children),t)}function L(e,n){let t=[],i=[];function r(e){return"base"===e?0:"current"===e?2:1}function l(e,n){let t=r(e.from),i=r(n.from);return t<i?-1:t>i?1:0}let s=null!=n?new Set(n):void 0;for(let n of Object.values(e.nodes).sort(l))(!s||s.has(n.id))&&t.push({id:n.id,position:{x:0,y:0},data:n,type:"customNode",targetPosition:T.Ly.Left,sourcePosition:T.Ly.Right});for(let n of Object.values(e.edges).sort(l))(!s||s.has(n.parent.id)&&s.has(n.child.id))&&i.push({id:n.id,type:"customEdge",source:n.parent.id,target:n.child.id,data:n});return A(t,i),N(Array.from(M(e,e.modifiedSet)),t,i)}let A=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR",i=new(I()).graphlib.Graph;i.setDefaultEdgeLabel(()=>({})),i.setGraph({rankdir:t}),e.forEach(e=>{i.setNode(e.id,{width:300,height:36})}),n.forEach(e=>{i.setEdge(e.source,e.target)}),I().layout(i),e.forEach(e=>{let n=i.node(e.id);return e.position={x:n.x-150,y:n.y-18},e})};function N(e,n,t){let i=new Set(e),r=new Set(t.filter(e=>i.has(e.source)&&i.has(e.target)).map(e=>e.id));return[n.map(e=>({...e,data:{...e.data,isHighlighted:i.has(e.id)}})),t.map(e=>({...e,data:{...e.data,isHighlighted:r.has(e.id)}}))]}function q(e,n){return n.map(n=>{let t=n.id===e;return{...n,data:{...n.data,isSelected:t}}})}function F(e,n){return n.map(n=>{let t=n.id===e;return{...n,data:{...n.data,isSelected:n.data.isSelected!==t}}})}function P(e,n){return n.map(n=>{let t=e.includes(n.id);return{...n,data:{...n.data,isSelected:n.data.isSelected||t}}})}function W(e,n){return e.map(e=>({...e,data:{...e.data,isSelected:!1,isActionMode:n,action:void 0}}))}let H={rowCount:e=>["row_count",e],lineage:()=>["lineage"],checks:()=>["checks","list"],check:e=>["checks",e],runs:()=>["runs"],run:e=>["runs",e],runsAggregated:()=>["runs_aggregated"]};var V=t(62330),K=t(39588);let J=K.env.NEXT_PUBLIC_API_URL?K.env.NEXT_PUBLIC_API_URL:window.location.origin;var B=t(94614);let U=V.default.create({baseURL:J}),Q=new B.S;async function X(){return(await U.get("/api/info")).data}async function Z(e){return(await U.get("/api/model/".concat(e))).data}var G=t(99873),Y=t(85929),$=t.n(Y);async function ee(e,n,t){return(await U.post("/api/runs",{type:e,params:n,nowait:null==t?void 0:t.nowait})).data}async function en(e,n){return(await U.get("/api/runs/".concat(e,"/wait"),{params:{timeout:n}})).data}async function et(e){return await U.post("/api/runs/".concat(e,"/cancel"))}async function ei(e,n){return(await U.post("/api/checks/".concat(e,"/run"),{nowait:null==n?void 0:n.nowait})).data}async function er(e,n,t){return(await U.post("/api/runs/search",{type:e,params:n,limit:t})).data}async function el(){return(await U.get("/api/runs")).data}async function es(){return(await U.post("/api/runs/aggregate",{})).data}let eo=(0,j.createContext)({});function ea(e){let{refetch:n}=e,t=(0,G.p)(),[r,l]=(0,j.useState)(),s=(0,k.NL)();return(0,j.useEffect)(()=>{let e=new WebSocket("".concat(J.replace(/(http)(s)?\:\/\//,"ws$2://"),"/api/ws"));return l(e),e.onopen=()=>{e.send("ping")},e.onmessage=e=>{if("pong"!==e.data)try{let n=JSON.parse(e.data);if("refresh"===n.command){let{eventType:e,srcPath:i}=n.event,[r,l]=i.split("/").slice(-2),o=$().parse(l).name;t({description:"Detected ".concat(r," ").concat(o," ").concat(e),status:"info",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0}),s.invalidateQueries({queryKey:H.lineage()})}}catch(e){console.error(e)}},()=>{e&&e.close()}},[t,s]),(0,i.jsx)(i.Fragment,{})}function ec(e){var n,t;let{children:r}=e,{data:l,isLoading:s,error:o,refetch:a}=(0,b.a)({queryKey:H.lineage(),queryFn:X}),{data:c,refetch:d}=(0,b.a)({queryKey:H.runsAggregated(),queryFn:es}),u=(0,j.useMemo)(()=>{let e=null==l?void 0:l.lineage;if(e&&e.base&&e.current)return function(e,n){let t={},i={},r=(e,n)=>({id:e,name:e,data:{},from:n,parents:{},children:{},isSelected:!1});for(let[n,i]of Object.entries(e.nodes))t[n]=r(n,"base"),i&&(t[n].data.base=i,t[n].name=null==i?void 0:i.name,t[n].resourceType=null==i?void 0:i.resource_type,t[n].packageName=null==i?void 0:i.package_name);for(let[e,i]of Object.entries(n.nodes))t[e]?t[e].from="both":t[e]=r(e,"current"),i&&(t[e].data.current=n.nodes&&n.nodes[e],t[e].name=null==i?void 0:i.name,t[e].resourceType=null==i?void 0:i.resource_type,t[e].packageName=null==i?void 0:i.package_name);for(let[n,r]of Object.entries(e.parent_map))for(let e of r){let r=t[n],l=t[e],s="".concat(e,"_").concat(n);if(!r||!l)continue;i[s]={id:s,from:"base",parent:l,child:r};let o=i[s];r.parents[e]=o,l.children[n]=o}for(let[e,r]of Object.entries(n.parent_map))for(let n of r){let r=t[e],l=t[n],s="".concat(n,"_").concat(e);if(!r||!l)continue;i[s]?i[s].from="both":i[s]={id:s,from:"current",parent:l,child:r};let o=i[s];r.parents[n]=o,l.children[e]=o}let l=[];for(let[e,n]of Object.entries(t))if("base"===n.from)n.changeStatus="removed",l.push(n.id);else if("current"===n.from)n.changeStatus="added",l.push(n.id);else{var s,o,a,c,d,u;let e=null==n?void 0:null===(a=n.data)||void 0===a?void 0:null===(o=a.base)||void 0===o?void 0:null===(s=o.checksum)||void 0===s?void 0:s.checksum,t=null==n?void 0:null===(u=n.data)||void 0===u?void 0:null===(d=u.current)||void 0===d?void 0:null===(c=d.checksum)||void 0===c?void 0:c.checksum;e&&t&&e!==t&&(n.changeStatus="modified",l.push(n.id))}for(let[e,n]of Object.entries(i))"base"===n.from?n.changeStatus="removed":"current"===n.from&&(n.changeStatus="added");return{nodes:t,edges:i,modifiedSet:l,manifestMetadata:{base:e.manifest_metadata||void 0,current:n.manifest_metadata||void 0},catalogMetadata:{base:e.catalog_metadata||void 0,current:n.catalog_metadata||void 0}}}(e.base,e.current)},[l]),h=null==o?void 0:o.message,x=null==l?void 0:l.lineage,m=null==l?void 0:l.demo,p=null==l?void 0:l.review_mode,f=null==l?void 0:l.cloud_mode,g=null==l?void 0:l.file_mode,v=null==l?void 0:l.adapter_type,y=null==l?void 0:l.git,k={adapterType:v,git:y,pullRequest:null==l?void 0:l.pull_request,dbt:{base:null==x?void 0:null===(n=x.base)||void 0===n?void 0:n.manifest_metadata,current:null==x?void 0:null===(t=x.current)||void 0===t?void 0:t.manifest_metadata},sqlmesh:null==l?void 0:l.sqlmesh};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ea,{refetch:a}),(0,i.jsx)(eo.Provider,{value:{lineageGraph:u,retchLineageGraph:()=>{a()},envInfo:k,reviewMode:p,cloudMode:f,fileMode:g,isDemoSite:m,error:h,isLoading:s,runsAggregated:c,refetchRunsAggregated:()=>{d()}},children:r})]})}let ed=()=>(0,j.useContext)(eo),eu=()=>{let{runsAggregated:e,refetchRunsAggregated:n}=ed();return[e,n]};var eh=t(17695),ex=t(62628),em=t(6533),ep=t(96985),ef=t(69384),eg=t(7797),ev=t(13844),ej=t(64653);let ey=e=>{let{isOpen:n,onClose:t,onExecute:l,type:s,title:a,params:c,RunForm:d}=e,[u,h]=(0,j.useState)(c),[x,m]=(0,j.useState)(!1);return(0,i.jsxs)(eh.u_,{isOpen:n,onClose:t,size:"6xl",scrollBehavior:"inside",children:[(0,i.jsx)(ex.Z,{}),(0,i.jsxs)(em.h,{overflowY:"auto",height:"75%",children:[(0,i.jsx)(ep.x,{children:a}),(0,i.jsx)(ef.o,{}),(0,i.jsx)(eg.f,{p:"0px",h:"100%",overflow:"auto",borderY:"1px solid lightgray",children:(0,i.jsx)(r.xu,{style:{contain:"layout"},children:d&&(0,i.jsx)(d,{params:u,onParamsChanged:h,setIsReadyToExecute:m})})}),(0,i.jsx)(ev.m,{children:(0,i.jsx)(o.k,{gap:"10px",children:(0,i.jsx)(ej.z,{isDisabled:!x,colorScheme:"blue",onClick:()=>{l(s,u)},children:"Execute"})})})]})]})};var eb=t(25612),ek=t(76330),ew=t(53152),eC=t(18222),e_=t(30678),eS=t(2838),ez=t(13156),eR=t.n(ez);function eT(e,n){let t=[];return e.forEach(e=>{t.some(n=>n.name===e.name)||t.push(e)}),n.forEach(e=>{t.some(n=>n.name===e.name)||t.push(e)}),t}var eE=e=>{var n;let{lineageGraph:t}=ed(),[i,r]=(0,j.useState)([]),[l,s]=(0,j.useState)(),[o,a]=(0,j.useState)(!0),[c,d]=(0,j.useState)(null),u=eR().find(null==t?void 0:t.nodes,{name:e}),h=(0,j.useMemo)(()=>u?function(e){function n(e){return e&&e.columns?Object.values(e.columns):[]}return eT(n(e.data.base),n(e.data.current))}(u):[],[u]),x=u?null===(n=u.data.current)||void 0===n?void 0:n.primary_key:void 0;return(0,j.useEffect)(()=>{let e=async()=>{try{let e=(await Z(null==u?void 0:u.id)).model;if(!e||!e.base.columns||!e.current.columns){r([]);return}s(e.current.primary_key);let n=Object.values(e.base.columns),t=Object.values(e.current.columns);r(eT(n,t))}catch(e){d(e)}};h.length>0?(r(h),s(x)):(null==u?void 0:u.id)===void 0?r([]):e(),a(!1)},[null==u?void 0:u.id,h,x]),{columns:i,primaryKey:l,isLoading:o,error:c}};function eD(e){return["CHAR","VARCHAR","TINYTEXT","TEXT","MEDIUMTEXT","LONGTEXT","NCHAR","NVARCHAR","VARCHAR2","NVARCHAR2","CLOB","NCLOB","VARCHAR(MAX)","XML","JSON","BOOLEAN","TINYINT(1)","BIT","NUMBER(1)","BOOL"].includes(e.toUpperCase())}function eI(e){return["DATE","DATETIME","TIMESTAMP","TIME","YEAR","DATETIME2","SMALLDATETIME","DATETIMEOFFSET","INTERVAL","TIMESTAMPTZ","TIMETZ","TIMESTAMP WITH TIME ZONE","TIMESTAMP WITH LOCAL TIME ZONE","TIMESTAMP_LTZ","TIMESTAMP_NTZ","TIMESTAMP_TZ"].includes(e.toUpperCase())}var eO=t(85813),eM=t(81945),eL=t(14827);function eA(e){let n=e>0&&e<=.001,t=e<1&&e>=.999,i=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US",t=arguments.length>2?arguments[2]:void 0;return"number"!=typeof e?e:new Intl.NumberFormat(n,t).format(e)}(n,"en-US",{style:"percent",minimumFractionDigits:1})};if(n){let e=i(.001);return"<".concat(e)}if(t){let e=i(.999);return">".concat(e)}return i()}function eN(e){if("number"!=typeof e)return e;{let n=Math.abs(e),t=n>=.01,i=n>=1e6,r=n>=1e9,l=n>=1e15;if(l||n>=1e12)return new Intl.NumberFormat("en-US",{style:"unit",unit:"liter",unitDisplay:"narrow",maximumFractionDigits:l?0:2}).format(e/1e12).replace("L","T");if(r||i||n>=1e3){let n={base:r?1e9:i?1e6:1e3,unit:r?"B":i?"M":"K"};return new Intl.NumberFormat("en-US",{style:"unit",unit:"liter",unitDisplay:"narrow",maximumFractionDigits:1}).format(e/n.base).replace("L",n.unit)}return n>=1?new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(e):new Intl.NumberFormat("en-US",{maximumFractionDigits:t?3:2,notation:t||0===n?"standard":"scientific"}).format(e)}}let eq="#63B3ED",eF="#F6AD55",eP="".concat(eq,"A5"),eW="".concat(eF,"A5");function eH(e){let{color:n}=e;return(0,i.jsx)(r.xu,{display:"inline-block",w:"10px",h:"10px",bgColor:n,mr:"2",borderRadius:"sm"})}function eV(e){let{data:n,hideAxis:t=!1,animation:r=!1}=e;eM.kL.register(eM.ZL,eM.RM,eM.f$,eM.uw,eM.Dx,eM.De,eM.u);let l=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{...t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{title:i,datasets:r,type:l,samples:s=0,binEdges:o}=e,[a,c]=r,d="datetime"===l;return{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:i,font:{size:20}},tooltip:{mode:"index",intersect:!1,callbacks:{title(e){let[{dataIndex:n,datasetIndex:t}]=e,i=eJ(o,n);return"".concat(d?"Date Range":"string"===l?"Text Length":"Value Range","\n").concat(i)},label(e){let{datasetIndex:n,dataIndex:t,dataset:{label:i}}=e,r=0===n?c.counts:a.counts,l=eA(r[t]/s),o=r[t];return"".concat(i,": ").concat(o," (").concat(l,")")}}}},scales:function(e){let{datasets:n,min:t=0,max:i=0,type:r,binEdges:l}=e,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],[o,a]=n,c=Math.max(...a.counts,...o.counts),d=l.map((e,n)=>eJ(l,n)).slice(0,-1);return{x:"datetime"===r?{display:!s,type:"timeseries",min:t,max:i,adapters:{date:{}},time:{minUnit:"day"},grid:{display:!1},ticks:{minRotation:30,maxRotation:30,maxTicksLimit:8}}:{display:!s,type:"category",grid:{display:!1},ticks:{callback:(e,n)=>d[n]},stacked:!0},y:{display:!s,type:"linear",max:c,border:{dash:[2,2]},grid:{color:"lightgray"},ticks:{maxTicksLimit:8,callback:function(e,n){return eN(e)}},beginAtZero:!0}}}(e,n),...t}}(n,t,{animation:r}),s=function(e){let{datasets:n,type:t,binEdges:i}=e,[r,l]=n,s=eK(t,i,"Current",eP,l),o=eK(t,i,"Base",eW,r);return{labels:i.map((e,n)=>eJ(i,n)).slice(0,-1),datasets:[s,o]}}(n);return(0,i.jsx)(eL.kL,{type:"bar",options:l,data:s,plugins:[]})}function eK(e,n,t,i,r){let{counts:l=[]}=r;return{label:t,data:"datetime"===e?l.map((e,t)=>({x:n[t],y:e})):l,backgroundColor:i,borderColor:i,hoverBackgroundColor:i,borderWidth:0,categoryPercentage:1,barPercentage:1,xAxisID:"x"}}function eJ(e,n){let t=e[n],i=e[n+1],r=eN(t),l=eN(i);return"".concat(r," - ").concat(l)}let eB=(0,eO.G)((e,n)=>{let{backgroundColor:t="white",blockSize:l,children:s,...o}=e;return(0,i.jsx)(r.xu,{ref:n,...o,overflowY:"auto",overflowX:"hidden",children:(0,i.jsx)(r.xu,{backgroundColor:t,height:"100%",blockSize:l,children:s})})}),eU=(0,eO.G)(function(e,n){var t,l,s,a,c,d;let{run:x}=e,m=x.params,p=null===(t=x.result)||void 0===t?void 0:t.base,f=null===(l=x.result)||void 0===l?void 0:l.current,g=null===(s=x.result)||void 0===s?void 0:s.min,v=null===(a=x.result)||void 0===a?void 0:a.max,j=null===(c=x.result)||void 0===c?void 0:c.bin_edges;return p&&f?(0,i.jsx)(o.k,{direction:"column",height:"100%",children:(0,i.jsx)(eB,{ref:n,height:"100%",children:(0,i.jsxs)(u.U,{children:[(0,i.jsx)(h.L,{}),(0,i.jsx)(r.xu,{w:"80%",h:"35vh",m:"4",children:(0,i.jsx)(eV,{data:{title:"Model ".concat(m.model,".").concat(m.column_name),type:(null===(d=x.params)||void 0===d?void 0:d.column_type)||"",datasets:[f,p],min:g,max:v,samples:p.total,binEdges:j}})}),(0,i.jsx)(h.L,{})]})})}):(0,i.jsx)("div",{children:"Loading..."})});var eQ=t(24112);t(63156);var eX=t(22204),eZ=t(79481);let eG=(0,eO.G)((e,n)=>{let{...t}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(eX.ZP,{ref:n,...t})})});function eY(){return(0,i.jsx)(o.k,{h:"35px",alignItems:"center",justifyContent:"center",bg:"gray.100",style:{textAlign:"center",gridColumn:"1/-1"},children:(0,i.jsx)(eZ.x,{fontWeight:"600",children:" No rows"})})}t(87679);var e$=t(52091);function e0(e,n){let t=function(e,n){let t=[...e],i=[...n],r=[];for(;t.length>0&&i.length>0;)if(r.includes(t[0]))t.shift();else if(r.includes(i[0]))i.shift();else if(t[0]===i[0])r.push(t[0]),t.shift(),i.shift();else if(i.includes(t[0])){let e=i.indexOf(t[0]);for(let n=0;n<e;n++)r.includes(i[n])||r.push(i[n]);r.push(t[0]),t.shift(),i.splice(0,e+1)}else r.push(t[0]),t.shift();return t.forEach(e=>{r.includes(e)||r.push(e)}),i.forEach(e=>{r.includes(e)||r.push(e)}),r}(e,n),i={};for(let r of t)e.includes(r)?n.includes(r)?i[r]=void 0:i[r]="removed":i[r]="added";let r={};e.forEach((e,n)=>{r[e]=n});let l=-1;for(let e of t){let n=r[e];void 0!==n&&(n>l?l=n:i[e]="reordered")}return i}function e1(e,n){let t=[];for(let i of n){let n=e.findIndex(e=>e.name===i);if(n<0)throw Error("Column ".concat(i," not found"));t.push(n)}return t}function e2(e,n,t){let i={};if(0===n.length)return JSON.stringify({_index:t._index});for(let r of n)i[e[r].name]=t[r];return JSON.stringify(i)}function e5(e){let{name:n,columnStatus:t,onPrimaryKeyChange:l,onPinnedColumnsChange:a,...c}=e,d=c.primaryKeys||[],u=c.pinnedColumns||[],h=d.includes(n),x=u.includes(n);return"index"===n?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(o.k,{alignItems:"center",gap:"10px",className:"grid-header",children:[(0,i.jsx)(r.xu,{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:n}),"added"!==t&&"removed"!==t&&l&&(0,i.jsx)(s.J,{className:h?"close-icon":"key-icon",display:h?"block":"none",cursor:"pointer",as:h?e$.ven:e$.MhP,onClick:h?()=>{let e=d.filter(e=>e!==n);l&&l(e)}:()=>{let e=[...d.filter(e=>"index"!==e),n];l&&l(e)}}),!h&&a&&(0,i.jsx)(s.J,{className:x?"unpin-icon":"pin-icon",display:x?"block":"none",cursor:"pointer",as:x?e$.$kI:e$.oJP,onClick:x?()=>{let e=u.filter(e=>e!==n);a&&a(e)}:()=>{let e=[...u,n];a&&a(e)}})]})}let e4=e=>{let n;let t=!1;return"boolean"==typeof e?n=e.toString():""===e?(n="(empty)",t=!0):null==e?(n="(null)",t=!0):n=e,[n,t]},e3=e=>{let{row:n,column:t}=e;if(!n.hasOwnProperty(t.key))return(0,i.jsx)(eZ.x,{style:{color:"gray"},children:"-"});let[r,l]=e4(n[t.key]);return(0,i.jsx)(eZ.x,{style:{color:l?"gray":"inherit"},children:r})};function e9(e,n,t){let r=e||{columns:[],data:[]},l=n||{columns:[],data:[]},s=(null==t?void 0:t.primaryKeys)||[],o=(null==t?void 0:t.pinnedColumns)||[],a=(null==t?void 0:t.changedOnly)||!1,c=[],d=function(e,n){let t={};return Object.entries(e0(e.columns.map(e=>e.name),n.columns.map(e=>e.name))).map(i=>{let[r,l]=i;t[r]={status:l,baseColumnIndex:e.columns.findIndex(e=>e.name===r),currentColumnIndex:n.columns.findIndex(e=>e.name===r)}}),t}(r,l),u={},h={},x=!1,m=!1;if(0===s.length)r.data.forEach((e,n)=>{e._index=n+1,u[JSON.stringify({_index:n+1})]=e}),l.data.forEach((e,n)=>{e._index=n+1,h[JSON.stringify({_index:n+1})]=e});else{let e=e1(r.columns,s);r.data.forEach((n,t)=>{let i=e2(r.columns,e,n);i in u&&(x=!0),u[i]=n}),e=e1(l.columns,s),l.data.forEach((n,t)=>{let i=e2(l.columns,e,n);i in h&&(m=!0),h[i]=n})}let p=e0(Object.keys(u),Object.keys(h)),f={added:0,removed:0,modified:0},g=Object.entries(p).map(e=>{let[n,t]=e,i=u[n],o=h[n],a=JSON.parse(n);if(i&&r.columns.forEach((e,n)=>{s.includes(e.name)||(a["base__".concat(e.name)]=i[n])}),o&&l.columns.forEach((e,n)=>{s.includes(e.name)||(a["current__".concat(e.name)]=o[n])}),i){if(o){for(let[e,n]of Object.entries(d))"index"===e||s.includes(e)||n.baseColumnIndex<0||n.currentColumnIndex<0||eR().isEqual(i[n.baseColumnIndex],o[n.currentColumnIndex])||(a.__status="modified",n.status="modified");"modified"===a.__status&&f.modified++}else a.__status="removed",f.removed++}else a.__status="added",f.added++;return a});a&&(g=g.filter(e=>"added"===e.__status||"removed"===e.__status||"modified"===e.__status));let v=(e,n)=>{let r="added"===n?"diff-header-added":"removed"===n?"diff-header-removed":void 0,l=t=>{let i=t.__status;if("removed"===i)return"diff-cell-removed";if("added"===i)return"diff-cell-added";if("added"===n);else if("removed"===n);else if(!eR().isEqual(t["base__".concat(e)],t["current__".concat(e)]))return"diff-cell-modified"};return{headerCellClass:r,name:(0,i.jsx)(e5,{name:e,columnStatus:n,...t}),children:[{key:"base__".concat(e),name:"Base",renderEditCell:eX.Ug,headerCellClass:r,cellClass:l,renderCell:e3,size:"auto"},{key:"current__".concat(e),name:"Current",renderEditCell:eX.Ug,headerCellClass:r,cellClass:l,renderCell:e3,size:"auto"}]}};return 0===s.length?c.push({key:"_index",width:50,maxWidth:100,name:"",cellClass:"index-column"}):s.forEach(e=>{let n=d[e].status||"";c.push({key:"".concat(e),name:(0,i.jsx)(e5,{name:e,columnStatus:n,...t}),frozen:!0,cellClass:e=>{if(e.__status)return"diff-header-".concat(e.__status)},renderCell:e3})}),o.forEach(e=>{let n=d[e].status||"";"index"===e||s.includes(e)||c.push(v(e,n))}),Object.entries(d).forEach(e=>{let[n,t]=e,i=t.status||"";"index"===n||s.includes(n)||o.includes(n)||a&&f.modified>0&&"added"!==i&&"removed"!==i&&"modified"!==i||c.push(v(n,i))}),{columns:c,rows:g,invalidPKeyBase:x,invalidPKeyCurrent:m}}let e6=(0,eO.G)((e,n)=>{var t;let{run:r,viewOptions:l,onViewOptionsChanged:s}=e,o=r.result;r.params;let a=(0,j.useMemo)(()=>(null==l?void 0:l.pinned_columns)||[],[l]),c=((null==o?void 0:null===(t=o.current)||void 0===t?void 0:t.columns)||[]).find(e=>"column_name"===e.name.toLowerCase()),d=(null==c?void 0:c.name)||"column_name",u=(0,j.useMemo)(()=>e9(null==o?void 0:o.base,null==o?void 0:o.current,{primaryKeys:[d],pinnedColumns:a,onPinnedColumnsChange:e=>{s&&s({...l,pinned_columns:e})}}),[o,d,a,l,s]);return 0===u.columns.length?(0,i.jsx)(eQ.M,{height:"100%",children:"No data"}):(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(eG,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:u.columns,rows:u.rows,defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})})});function e8(e){let{name:n,columnStatus:t,onPrimaryKeyChange:l,onPinnedColumnsChange:a,...c}=e,d=c.primaryKeys||[],u=c.pinnedColumns||[],h=d.includes(n),x=u.includes(n);return"index"===n?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(o.k,{alignItems:"center",gap:"10px",className:"grid-header",children:[(0,i.jsx)(r.xu,{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:n}),!h&&a&&(0,i.jsx)(s.J,{className:x?"unpin-icon":"pin-icon",display:x?"block":"none",cursor:"pointer",as:x?e$.$kI:e$.oJP,onClick:x?()=>{let e=u.filter(e=>e!==n);a&&a(e)}:()=>{let e=[...u,n];a&&a(e)}})]})}function e7(e,n,t){let r=(null==t?void 0:t.pinnedColumns)||[],l=(null==t?void 0:t.changedOnly)||!1,s=[],o=function(e){let n={};return e.columns.map((e,t)=>{n[e.name]={index:t}}),n}(e),a={},c={};if(0===n.length)throw Error("Primary keys are required");let d=function(e,n){let t=[];for(let i of n){let n=e.findIndex(e=>e.name===i);if(n<0)throw Error("Column ".concat(i," not found"));t.push(n)}return t}(e.columns,n),u=(o.in_a||o.IN_A).index,h=(o.in_b||o.IN_B).index;e.data.forEach((n,t)=>{let i=function(e,n,t){let i={};if(0===n.length)return JSON.stringify({_index:t._index});for(let r of n)i[e[r].name]=t[r];return JSON.stringify(i)}(e.columns,d,n);n[u]&&(a[i]=n),n[h]&&(c[i]=n)});let x=e0(Object.keys(a),Object.keys(c)),m={added:0,removed:0,modified:0},p=Object.entries(x).map(t=>{let[i,r]=t,l=a[i],s=c[i],d=JSON.parse(i);if(l&&e.columns.forEach((e,t)=>{n.includes(e.name)||(d["base__".concat(e.name)]=l[t])}),s&&e.columns.forEach((e,t)=>{n.includes(e.name)||(d["current__".concat(e.name)]=s[t])}),l){if(s)for(let[e,t]of Object.entries(o))!("index"===e||n.includes(e))&&(eR().isEqual(l[t.index],s[t.index])||(d.__status="modified",t.status="modified"));else d.__status="removed",m.removed++}else d.__status="added",m.added++;return"modified"===d.__status&&m.modified++,d});l&&(p=p.filter(e=>"added"===e.__status||"removed"===e.__status||"modified"===e.__status));let f=(e,n)=>{let r="added"===n?"diff-header-added":"removed"===n?"diff-header-removed":void 0,l=t=>{let i=t.__status;if("removed"===i)return"diff-cell-removed";if("added"===i)return"diff-cell-added";if("added"===n);else if("removed"===n);else if(!eR().isEqual(t["base__".concat(e)],t["current__".concat(e)]))return"diff-cell-modified"};return{headerCellClass:r,name:(0,i.jsx)(e8,{name:e,columnStatus:n,...t}),children:[{key:"base__".concat(e),name:"Base",renderEditCell:eX.Ug,headerCellClass:r,cellClass:l,renderCell:e3,size:"auto"},{key:"current__".concat(e),name:"Current",renderEditCell:eX.Ug,headerCellClass:r,cellClass:l,renderCell:e3,size:"auto"}]}};return n.forEach(e=>{let n=o[e].status||"";s.push({key:"".concat(e),name:(0,i.jsx)(e8,{name:e,columnStatus:n,...t}),frozen:!0,cellClass:e=>{if(e.__status)return"diff-header-".concat(e.__status)},renderCell:e3})}),r.forEach(e=>{let t=o[e].status||"";n.includes(e)||s.push(f(e,t))}),Object.entries(o).forEach(e=>{let[t,i]=e,o=i.status||"";"in_a"===t||"in_b"===t||n.includes(t)||r.includes(t)||l&&m.modified>0&&"added"!==o&&"removed"!==o&&"modified"!==o||s.push(f(t,o))}),{columns:s,rows:p}}var ne=t(93998),nn=t(25773),nt=t(63352);let ni=e=>{let{run:n,warnings:t,viewOptions:l,onAddToChecklist:s,onViewOptionsChanged:a}=e;return(0,i.jsxs)(o.k,{borderBottom:"1px solid lightgray",justifyContent:"flex-end",gap:"5px",alignItems:"center",px:"10px",bg:t&&t.length>0?"orange.100":"inherit",children:[(0,i.jsx)(nn.g,{alignItems:"flex-start",spacing:0,children:t&&t.map((e,n)=>(0,i.jsxs)(r.xu,{children:[(0,i.jsx)(ne.a,{color:"orange.600"})," ",e]},n))}),(0,i.jsx)(h.L,{minHeight:"32px"}),(0,i.jsx)(nt.X,{isChecked:null==l?void 0:l.changed_only,onChange:()=>{let e=!(null==l?void 0:l.changed_only);a&&a({...l,changed_only:e})},children:"Changed only"}),s&&(0,i.jsx)(ej.z,{marginBlock:"5px",size:"sm",colorScheme:"blue",onClick:()=>s(n),children:"Add to Checklist"})]})},nr=(e,n)=>{var t,r,l,s,a,c;let{run:d,onAddToChecklist:u,viewOptions:h,onViewOptionsChanged:x}=e,m=(0,j.useMemo)(()=>(null==h?void 0:h.primary_keys)||[],[h]),p=(0,j.useMemo)(()=>(null==h?void 0:h.changed_only)||!1,[h]),f=(0,j.useMemo)(()=>(null==h?void 0:h.pinned_columns)||[],[h]),g=(0,j.useMemo)(()=>{var e,n;return e9(null==d?void 0:null===(e=d.result)||void 0===e?void 0:e.base,null==d?void 0:null===(n=d.result)||void 0===n?void 0:n.current,{changedOnly:p,primaryKeys:m,onPrimaryKeyChange:e=>{x&&x({...h,primary_keys:e})},pinnedColumns:f,onPinnedColumnsChange:e=>{x&&x({...h,pinned_columns:e})}})},[d,h,p,m,f,x]),v=(0,j.useMemo)(()=>{let e=m.join(", ");return g.invalidPKeyBase&&g.invalidPKeyCurrent?"Warning: The primary key '".concat(e,"' is not unique in the base and current environments"):g.invalidPKeyBase?"Warning: The primary key '".concat(e,"' is not unique in the base environment"):g.invalidPKeyCurrent?"Warning: The primary key '".concat(e,"' is not unique in the current environment"):void 0},[g.invalidPKeyBase,g.invalidPKeyCurrent,m]),y=(null===(r=d.result)||void 0===r?void 0:null===(t=r.current)||void 0===t?void 0:t.limit)||0,b=y>0&&((null==d?void 0:null===(s=d.result)||void 0===s?void 0:null===(l=s.current)||void 0===l?void 0:l.more)||(null==d?void 0:null===(c=d.result)||void 0===c?void 0:null===(a=c.base)||void 0===a?void 0:a.more))?"Warning: Displayed results are limited to ".concat(y.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,k=[];return(v&&k.push(v),b&&k.push(b),0===g.columns.length)?(0,i.jsx)(eQ.M,{height:"100%",children:"No data"}):p&&0===g.rows.length?(0,i.jsxs)(o.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ni,{run:d,viewOptions:h,onAddToChecklist:u,onViewOptionsChanged:x,warnings:k}),(0,i.jsx)(eQ.M,{height:"100%",children:"No change"}),";"]}):(0,i.jsxs)(o.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ni,{run:d,viewOptions:h,onAddToChecklist:u,onViewOptionsChanged:x,warnings:k}),(0,i.jsx)(eG,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:g.columns,rows:g.rows,renderers:{noRowsFallback:(0,i.jsx)(eY,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})},nl=(e,n)=>{var t,r,l,s;let{run:a,onAddToChecklist:c,viewOptions:d,onViewOptionsChanged:u}=e,h=(0,j.useMemo)(()=>(null==d?void 0:d.changed_only)||!1,[d]),x=(0,j.useMemo)(()=>(null==d?void 0:d.pinned_columns)||[],[d]),m=(0,j.useMemo)(()=>{var e,n;if(!(null===(e=a.result)||void 0===e?void 0:e.diff)||!(null==a?void 0:null===(n=a.params)||void 0===n?void 0:n.primary_keys))return{columns:[],rows:[]};let t=a.params.primary_keys;return e7(null==a?void 0:a.result.diff,t,{changedOnly:h,pinnedColumns:x,onPinnedColumnsChange:e=>{u&&u({...d,pinned_columns:e})}})},[a,d,h,x,u]),p=(null===(r=a.result)||void 0===r?void 0:null===(t=r.diff)||void 0===t?void 0:t.limit)||0,f=p>0&&(null==a?void 0:null===(s=a.result)||void 0===s?void 0:null===(l=s.diff)||void 0===l?void 0:l.more)?"Warning: Displayed results are limited to ".concat(p.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,g=[];return(f&&g.push(f),0===m.columns.length)?(0,i.jsx)(eQ.M,{height:"100%",children:"No data"}):h&&0===m.rows.length?(0,i.jsxs)(o.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ni,{run:a,viewOptions:d,onAddToChecklist:c,onViewOptionsChanged:u,warnings:g}),(0,i.jsx)(eQ.M,{height:"100%",children:"No change"})]}):(0,i.jsxs)(o.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ni,{run:a,viewOptions:d,onAddToChecklist:c,onViewOptionsChanged:u,warnings:g}),(0,i.jsx)(eG,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:m.columns,rows:m.rows,renderers:{noRowsFallback:(0,i.jsx)(eY,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})},ns=(0,eO.G)((e,n)=>{var t;if((null===(t=e.run)||void 0===t?void 0:t.result)!==void 0&&null!==e.run.result.diff&&void 0!==e.run.result.diff){let t=(0,eO.G)(nl);return(0,i.jsx)(t,{...e,ref:n})}{let t=(0,eO.G)(nr);return(0,i.jsx)(t,{...e,ref:n})}});function no(e){let{name:n,pinnedColumns:t=[],onPinnedColumnsChange:l=()=>{}}=e,a=t.includes(n);return(0,i.jsxs)(o.k,{className:"grid-header",alignItems:"center",children:[(0,i.jsx)(r.xu,{flex:1,children:n}),(0,i.jsx)(s.J,{className:a?"unpin-icon":"pin-icon",display:a?"block":"none",cursor:"pointer",as:a?e$.$kI:e$.oJP,onClick:a?()=>{l(t.filter(e=>e!==n))}:()=>{l([...t,n])}})]})}let na=(0,eO.G)((e,n)=>{let{run:t,viewOptions:l,onViewOptionsChanged:s,onAddToChecklist:a}=e,c=(0,j.useMemo)(()=>(null==l?void 0:l.pinned_columns)||[],[l]),d=null==t?void 0:t.result,u=(0,j.useMemo)(()=>d?function(e,n){let t=[],r=n.pinnedColumns||[],l=(e,t)=>({key:String(e),name:(0,i.jsx)(no,{name:t,...n}),width:"auto",renderCell:e3});return t.push({key:"_index",name:"",width:50,cellClass:"index-column"}),r.forEach(n=>{let i=eR().findIndex(e.columns,e=>e.name===n);i<0||t.push(l(i,n))}),e.columns.forEach((e,n)=>{r.includes(e.name)||t.push(l(n,e.name))}),e.data.forEach((e,n)=>{e._index=n+1}),{columns:t,rows:e.data}}(d,{pinnedColumns:c,onPinnedColumnsChange:e=>{s&&s({...l,pinned_columns:e})}}):{rows:[],columns:[]},[d,c,l,s]);if(0===u.columns.length)return(0,i.jsx)(eQ.M,{height:"100%",children:"No data"});let x=(null==d?void 0:d.limit)||0,m=x>0&&(null==d?void 0:d.more)?"Warning: Displayed results are limited to ".concat(x.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,p=a||m;return(0,i.jsxs)(o.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[p&&(0,i.jsxs)(o.k,{borderBottom:"1px solid lightgray",alignItems:"center",gap:"5px",px:"10px",bg:m?"orange.100":"inherit",children:[m&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ne.a,{color:"orange.600",alignSelf:"center"})," ",(0,i.jsx)(r.xu,{children:m})]}),(0,i.jsx)(h.L,{minHeight:"32px"}),a&&(0,i.jsx)(ej.z,{marginBlock:"5px",size:"sm",colorScheme:"blue",onClick:()=>a(t),children:"Add to Checklist"})]}),(0,i.jsx)(eG,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:u.columns,rows:u.rows,renderers:{noRowsFallback:(0,i.jsx)(eY,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})});function nc(e,n){if(e<n){let t=(n-e)/e*100;return"+".concat(t>=.1?t.toFixed(1):" <0.1 ","%")}if(!(e>n))return"0 %";{let t=(e-n)/e*100;return"-".concat(t>=.1?t.toFixed(1):" <0.1 ","%")}}var nd=t(68844),nu=t.n(nd);let nh=(0,eO.G)(function(e,n){let{run:t}=e;function r(e){if(e.base===e.current);else if(e.base<e.current||"N/A"===e.base)return"column-body-added";else if(e.base>e.current||"N/A"===e.current)return"column-body-removed";return"column-body-normal"}let l=t.result||{},s=Object.keys(t.result||{}).map(e=>{let n=l[e],t=nu()(null==n?void 0:n.base)?null==n?void 0:n.base:null,i=nu()(null==n?void 0:n.curr)?null==n?void 0:n.curr:null,r="No Change";return null!==t&&null!==i?r=t!==i?nc(t,i):"No Change":t===i?r="N/A":null===t?r="Added":null===i&&(r="Removed"),{name:e,base:null===t?"N/A":Number(t),current:null===i?"N/A":Number(i),delta:r}});return 0===s.length?(0,i.jsx)(eQ.M,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"}):(0,i.jsx)(o.k,{direction:"column",children:Object.keys(l).length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(eG,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:[{key:"name",name:"Name",cellClass:r},{key:"base",name:"Base Rows",cellClass:r},{key:"current",name:"Current Rows",cellClass:r},{key:"delta",name:"Delta",cellClass:r}],rows:s,renderers:{noRowsFallback:(0,i.jsx)(eY,{})},className:"rdg-light",enableScreenshot:!0})})})});var nx=t(32088),nm=t(96124);let np="#63B3ED";function nf(e,n){let t=n?10:e.counts.length,i=e.counts.slice(0,t),r=e.valids-i.reduce((e,n)=>e+n,0);return e.values.slice(0,t).concat([r]).map((n,t)=>{let l;let s=t===i.length,o=s?r:i[t],a=!1;return s?(l="(others)",a=!0):null==n?(l="(null)",a=!0):"string"==typeof n&&0===n.length?(l="(empty)",a=!0):l=String(n),{isLastItemOthers:s,isSpecialLabel:a,label:l,count:o,displayCount:eN(o),displayRatio:eA(o/e.valids)||"N/A"}})}function ng(e){let{base:n,current:t,children:l}=e;return(0,i.jsx)(nx.u,{label:(0,i.jsxs)(r.xu,{children:[(0,i.jsxs)(eZ.x,{children:[(0,i.jsx)(eH,{color:eq}),"Current: ",t.count," (",t.displayRatio,")"]}),(0,i.jsxs)(eZ.x,{children:[(0,i.jsx)(eH,{color:eF}),"Base: ",n.count," (",n.displayRatio,")"]})]}),placement:"auto",hasArrow:!0,children:l})}function nv(e){let{topKDiff:n,isDisplayTopTen:t}=e,l=nf(n.current,t),s=nf(n.base,t);return(0,i.jsxs)(r.xu,{w:"100%",px:20,py:4,children:[(0,i.jsxs)(o.k,{alignItems:"center",direction:"row",children:[(0,i.jsx)(h.L,{}),(0,i.jsxs)(eZ.x,{as:"h3",size:"sm",p:"2",color:"gray",children:[(0,i.jsx)(eH,{color:eF})," Base"]}),(0,i.jsxs)(eZ.x,{as:"h3",size:"sm",p:"2",color:"gray",children:[(0,i.jsx)(eH,{color:eq})," Current"]}),(0,i.jsx)(h.L,{})]}),l.map((e,t)=>{let r=s[t];return e.isLastItemOthers&&0===e.count&&0===r.count?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)(j.Fragment,{children:[(0,i.jsx)(ng,{base:r,current:e,children:(0,i.jsxs)(o.k,{alignItems:"center",width:"100%",_hover:{bg:"blackAlpha.300"},px:4,children:[(0,i.jsx)(eZ.x,{noOfLines:1,width:"10em",fontSize:"sm",color:e.isSpecialLabel?"gray.400":"inherit",children:e.label}),(0,i.jsxs)(o.k,{width:"70%",direction:"column",children:[(0,i.jsxs)(o.k,{height:"1em",children:[(0,i.jsx)(nj,{topkCount:e.count,topkLabel:e.label,valids:n.current.valids,color:eq}),(0,i.jsx)(eZ.x,{ml:5,mr:2,fontSize:"sm",width:"6em",children:e.displayCount}),(0,i.jsx)(eZ.x,{color:"gray.400",fontSize:"sm",width:"4em",children:e.displayRatio})]}),(0,i.jsxs)(o.k,{height:"1em",children:[(0,i.jsx)(nj,{topkCount:r.count,topkLabel:r.label,valids:n.base.valids,color:eF}),(0,i.jsx)(eZ.x,{ml:5,mr:2,fontSize:"sm",width:"6em",children:r.displayCount}),(0,i.jsx)(eZ.x,{color:"gray.400",fontSize:"sm",width:"4em",children:r.displayRatio})]})]})]})}),(0,i.jsx)(nm.i,{})]},t)})]})}function nj(e){let{topkCount:n,topkLabel:t,valids:r,animation:l=!1,color:s=np}=e;eM.kL.register(eM.uw,eM.ZL,eM.f$);let o=function(e,n){let{...t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",scales:{x:{display:!1,max:n,grid:{display:!1}},y:{display:!1}},plugins:{tooltip:{enabled:!1}},...t}}(n,r,{animation:l}),a=function(e){let{topkLabel:n,topkCount:t,color:i=np}=e;return{labels:[n],datasets:[{indexAxis:"y",data:[t],backgroundColor:i,hoverBackgroundColor:i,borderWidth:0,borderColor:i,barPercentage:1,categoryPercentage:.6}]}}({topkCount:n,topkLabel:t,color:s});return(0,i.jsx)(eL.$Q,{data:a,options:o,plugins:[]})}let ny=(0,eO.G)((e,n)=>{let{run:t}=e,[r,s]=(0,j.useState)(!0),a=t.result,d=t.params,x=a.base,m=a.current;return(0,i.jsxs)(o.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(eB,{ref:n,blockSize:"auto",children:[(0,i.jsxs)(c.X,{as:"h1",size:"md",paddingTop:4,textAlign:"center",color:"gray.600",children:["Model ",d.model,".",d.column_name]}),(0,i.jsxs)(u.U,{children:[(0,i.jsx)(h.L,{}),(0,i.jsx)(nv,{topKDiff:a,valids:m.valids||0,isDisplayTopTen:r}),(0,i.jsx)(h.L,{})]})]}),(0,i.jsx)(h.L,{}),(x.values.length>10||m.values.length>10)&&(0,i.jsx)(o.k,{p:5,justify:"start",children:(0,i.jsx)(l.r,{onClick:()=>s(e=>!e),textColor:"blue.500",children:r?"View More Items":"View Only Top-10"})})]})}),nb=(0,eO.G)((e,n)=>{var t,r;let{run:l,onAddToChecklist:s,viewOptions:a,onViewOptionsChanged:c}=e,d=(0,j.useMemo)(()=>(null==a?void 0:a.changed_only)||!1,[a]),u=(0,j.useMemo)(()=>(null==a?void 0:a.pinned_columns)||[],[a]),h=(0,j.useMemo)(()=>{var e;if(!l.result||!(null==l?void 0:null===(e=l.params)||void 0===e?void 0:e.primary_key))return{columns:[],rows:[]};let n=l.params.primary_key,t=Array.isArray(n)?n:[n];return e7(null==l?void 0:l.result,t,{changedOnly:d,pinnedColumns:u,onPinnedColumnsChange:e=>{c&&c({...a,pinned_columns:e})}})},[l,a,d,u,c]),x=(null===(t=l.result)||void 0===t?void 0:t.limit)||0,m=x>0&&(null==l?void 0:null===(r=l.result)||void 0===r?void 0:r.more)?"Warning: Displayed results are limited to ".concat(x.toLocaleString()," records. To ensure complete data retrieval, consider applying a LIMIT or WHERE clause to constrain the result set."):null,p=[];return(m&&p.push(m),0===h.columns.length)?(0,i.jsx)(eQ.M,{height:"100%",children:"No data"}):d&&0===h.rows.length?(0,i.jsxs)(o.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ni,{run:l,viewOptions:a,onAddToChecklist:s,onViewOptionsChanged:c,warnings:p}),(0,i.jsx)(eQ.M,{height:"100%",children:"No change"}),";"]}):(0,i.jsxs)(o.k,{direction:"column",backgroundColor:"rgb(249, 249, 249)",height:"100%",children:[(0,i.jsx)(ni,{run:l,viewOptions:a,onAddToChecklist:s,onViewOptionsChanged:c,warnings:p}),(0,i.jsx)(eG,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto"},columns:h.columns,rows:h.rows,renderers:{noRowsFallback:(0,i.jsx)(eY,{})},defaultColumnOptions:{resizable:!0,maxWidth:800,minWidth:35},className:"rdg-light",enableScreenshot:!0})]})});var nk=t(93960),nw=t(66011);function nC(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:l}=e,[s,o]=(0,j.useState)(!n.columns||0===n.columns.length),a=null==n?void 0:n.model,c=null==n?void 0:n.primary_key,{columns:d,primaryKey:u,isLoading:h,error:x}=eE(n.model);(0,j.useEffect)(()=>{!c&&u&&t({...n,primary_key:u})},[c,u,n,t]),(0,j.useEffect)(()=>{l(!!c&&!!a)},[c,a,l]);let m=d.map(e=>e.name),p=Array.isArray(c)?c:c?[c]:void 0;return h?(0,i.jsx)(r.xu,{children:"Loading..."}):0===m.length||x?(0,i.jsx)(r.xu,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsxs)(nn.g,{gap:5,m:"8px 24px",paddingBottom:"200px",children:[(0,i.jsxs)(eC.NI,{children:[(0,i.jsx)(e_.l,{children:"Model"}),(0,i.jsx)(nk.I,{isReadOnly:!0,value:null==n?void 0:n.model})]}),(0,i.jsxs)(eC.NI,{children:[(0,i.jsx)(e_.l,{children:"Primary key"}),(0,i.jsx)(nw.Z,{placeholder:"Select primary key",isMulti:!0,closeMenuOnSelect:!1,options:(m||[]).map(e=>({label:e,value:e})),value:(p||[]).map(e=>({label:e,value:e})),onChange:e=>{t({...n,primary_key:1==e.length?e[0].value:e.map(e=>e.value)})}})]}),(0,i.jsxs)(eC.NI,{children:[(0,i.jsx)(e_.l,{children:"Columns"}),(0,i.jsx)(nt.X,{marginBottom:"10px",isChecked:s,onChange:e=>{o(e.target.checked),t({...n,columns:void 0})},children:"All columns"}),!s&&(0,i.jsx)(nw.Z,{isMulti:!0,closeMenuOnSelect:!1,options:(m||[]).map(e=>({label:e,value:e})),value:(n.columns||[]).map(e=>({label:e,value:e})),onChange:e=>{t({...n,columns:(e||[]).map(e=>e.value)})}})]})]})}var n_=t(49801),nS=t(50104),nz=t(39171),nR=t(39226),nT=t(70949),nE=t(34510);function nD(e){let{params:n,column:t}=e,{runAction:l}=nP(),a=(e,t)=>{l("value_diff_detail",{...n,...e},t)};return(0,i.jsxs)(o.k,{children:[(0,i.jsx)(r.xu,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t}),(0,i.jsx)(h.L,{}),(0,i.jsx)(n_.v,{isLazy:!0,children:e=>{let{isOpen:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nS.j,{className:"row-context-menu",visibility:n?"visible":"hidden",width:n?"auto":"0px",minWidth:n?"auto":"0px",as:nz.h,icon:(0,i.jsx)(s.J,{as:e$.D_A}),variant:"unstyled",size:"sm"}),(0,i.jsx)(nR.q,{lineHeight:"20px",children:(0,i.jsxs)(nT.k,{title:"Action",as:r.xu,fontSize:"8pt",children:[(0,i.jsx)(nE.s,{fontSize:"10pt",onClick:()=>a({},{showForm:!0}),children:"Show mismatched values..."}),(0,i.jsxs)(nE.s,{fontSize:"10pt",onClick:()=>a({columns:[t]},{showForm:!1}),children:["Show mismatched values for '",t,"'"]})]})})]})}})]})}let nI=(0,eO.G)(function(e,n){let{run:t}=e,l=t.result,a=t.params,c=e=>{let n=e[2];return null!=n&&n<1?"diff-cell-modified":""},d=Array.isArray(a.primary_key)?a.primary_key:[a.primary_key],u=[{key:"__is_pk__",name:"",width:30,maxWidth:30,renderCell:e=>{let{row:n}=e;return(0,i.jsx)(eQ.M,{height:"100%",children:d.includes(n[0])&&(0,i.jsx)(s.J,{as:e$.MhP})})}},{key:"0",name:"Column",resizable:!0,renderCell:e=>{let{row:n,column:t}=e;return(0,i.jsx)(nD,{column:n[t.key],params:a})},cellClass:"cell-show-context-menu"},{key:"1",name:"Matched",resizable:!0,cellClass:c},{key:"2",name:"Matched %",resizable:!0,renderCell:e=>{let{column:n,row:t}=e,l=t[n.key];return(0,i.jsx)(r.xu,{textAlign:"end",children:void 0!=l&&null!==l?"".concat((100*l).toFixed(2)," %"):"N/A"})},cellClass:c}];return(0,i.jsxs)(o.k,{direction:"column",gap:"5px",pt:"5px",height:"100%",children:[(0,i.jsxs)(r.xu,{px:"16px",children:["Model: ",a.model,", ",l.summary.total," total (",l.summary.total-l.summary.added-l.summary.removed," ","common, ",l.summary.added," added, ",l.summary.removed," removed)"]}),(0,i.jsx)(eG,{ref:n,style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",borderBlock:"1px solid lightgray"},columns:u,rows:l.data.data,renderers:{noRowsFallback:(0,i.jsx)(eY,{})},defaultColumnOptions:{resizable:!0},className:"rdg-light",enableScreenshot:!0})]})});var nO=t(18502),nM=t(63594);let nL={lineage_diff:{title:"Lineage Diff",icon:ew.Ks7},schema_diff:{title:"Schema Diff",icon:nM.C8A},query:{title:"Query",icon:ew.r2i,RunResultView:na},query_base:{title:"Query Base",icon:ew.r2i,RunResultView:na},query_diff:{title:"Query Diff",icon:ew.r2i,RunResultView:ns},row_count_diff:{title:"Row Count Diff",icon:nM.QUK,RunResultView:nh},profile_diff:{title:"Profile Diff",icon:ew.KA6,RunResultView:e6},value_diff:{title:"Value Diff",icon:ew.pRi,RunResultView:nI,RunForm:nC},value_diff_detail:{title:"Value Diff Detail",icon:ew.pRi,RunResultView:nb,RunForm:nC},top_k_diff:{title:"Top-K Diff",icon:nO.Pkc,RunResultView:ny,RunForm:function(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:l}=e,{columns:s,isLoading:o,error:a}=eE(n.model),c=s.map(e=>e.name);return((0,j.useEffect)(()=>{l(!!n.column_name)},[n,l]),o)?(0,i.jsx)(r.xu,{children:"Loading..."}):0===c.length||a?(0,i.jsx)(r.xu,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsx)(r.xu,{m:"16px",children:(0,i.jsxs)(eC.NI,{children:[(0,i.jsx)(e_.l,{children:"Pick a column to show top-k"}),(0,i.jsx)(eS.P,{placeholder:"Select column",value:null==n?void 0:n.column_name,onChange:e=>{let i=e.target.value;t({...n,column_name:i})},children:c.map(e=>(0,i.jsx)("option",{value:e,children:e},e))})]})})}},histogram_diff:{title:"Histogram Diff",icon:ew.dku,RunResultView:eU,RunForm:function(e){let{params:n,onParamsChanged:t,setIsReadyToExecute:l}=e,{columns:s,isLoading:o,error:a}=eE(n.model),c=s.filter(e=>!eD(e.type)&&!eI(e.type));return o?(0,i.jsx)(r.xu,{children:"Loading..."}):0===s.length||a?(0,i.jsx)(r.xu,{children:"Error: Please provide the 'catalog.json' to list column candidates"}):(0,i.jsx)(r.xu,{m:"16px",children:(0,i.jsxs)(eC.NI,{children:[(0,i.jsx)(e_.l,{children:"Pick a column to show Histogram Diff"}),(0,i.jsx)(eS.P,{placeholder:0!==c.length?"Select column":"No numeric column is available",isDisabled:0===c.length,value:null==n?void 0:n.column_name,onChange:e=>{var i;let r=e.target.value;l(!!r);let s=(null===(i=c.find(e=>e.name===r))||void 0===i?void 0:i.type)||"";t({...n,column_name:r,column_type:s})},children:c.map(e=>(0,i.jsxs)("option",{value:e.name,children:[e.name," : ",e.type]},e.name))})]})})}}},nA=e=>nL[e],nN=(0,j.createContext)({runAction:()=>{},showRunId:e=>{},isRunResultOpen:!1,closeRunResult:()=>{},isHistoryOpen:!1,closeHistory:()=>{},showHistory:()=>{}}),nq=e=>{let[n]=(0,ek.TH)();(0,j.useEffect)(()=>{e()},[e,n])};function nF(e){var n;let{children:t}=e,[r,l]=(0,j.useState)(),{isOpen:s,onOpen:o,onClose:a}=(0,eb.q)(),{isOpen:c,onOpen:d,onClose:u}=(0,eb.q)(),{isOpen:h,onOpen:x,onClose:m}=(0,eb.q)(),p=(0,G.p)(),[f,g]=(0,j.useState)(),[v,y]=(0,ek.TH)(),b=(0,k.NL)(),w=(0,j.useCallback)((e,n)=>{g(e),d(),!1!==n&&b.invalidateQueries({queryKey:H.runs()})},[g,d,b]),C=(0,j.useCallback)(async(e,n,t)=>{try{let i;let r=new Date().getTime().toString();if(null==t?void 0:t.showLast){let t=await er(e,n,1);1===t.length&&(i=t[0])}let s=nA(e);if(void 0===s)throw Error("Unknown run type: ".concat(e));let{title:a,RunResultView:c,RunForm:d}=s;if(void 0===c)throw Error("Run type ".concat(e," does not have a result view"));if(void 0!==d&&(null==t?void 0:t.showForm))l({session:r,title:a,type:e,params:n,lastRun:i,options:t,RunForm:d}),o();else{let{run_id:t}=await ee(e,n,{nowait:!0});w(t),b.invalidateQueries({queryKey:H.runs()}),v.startsWith("/lineage")&&y("/lineage")}}catch(e){p({title:"Failed to submit a run",description:null==e?void 0:e.message,position:"bottom-right",status:"error",duration:5e3,isClosable:!0})}},[l,o,w,p,v,y,b]);nq(a);let _=async(e,n)=>{try{a();let{run_id:t}=await ee(e,n,{nowait:!0});w(t)}catch(e){p({title:"Failed to submit a run",description:null==e?void 0:e.message,position:"bottom-right",status:"error",duration:5e3,isClosable:!0})}};return(0,j.useEffect)(()=>{f&&v.startsWith("/checks")&&y("/lineage")},[f]),(0,i.jsxs)(nN.Provider,{value:{runAction:C,runId:f,showRunId:w,isRunResultOpen:c,closeRunResult:u,isHistoryOpen:h,closeHistory:m,showHistory:x},children:[r&&(0,i.jsx)(ey,{isOpen:s,onClose:a,onExecute:_,title:r.title,type:r.type,params:r.params,initialRun:r.lastRun,RunForm:(null===(n=r.options)||void 0===n?void 0:n.showForm)&&r.RunForm?r.RunForm:void 0},r.session),t]})}let nP=()=>(0,j.useContext)(nN);function nW(e){let{children:n}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(_,{children:(0,i.jsx)(ec,{children:(0,i.jsx)(R,{children:(0,i.jsx)(nF,{children:n})})})})})}var nH=t(81600);async function nV(){return(await U.post("/api/checks",{type:"simple"})).data}async function nK(e,n){return(await U.post("/api/checks",{run_id:e,view_options:n})).data}async function nJ(){return(await U.get("/api/checks")).data}async function nB(e){return(await U.get("/api/checks/".concat(e))).data}async function nU(e,n){return(await U.patch("/api/checks/".concat(e),n)).data}async function nQ(e){return(await U.delete("/api/checks/".concat(e))).data}async function nX(e){return await U.post("/api/checks/reorder",e)}var nZ=t(94734),nG=t(71738),nY=t(38414),n$=t(29598),n0=t(62216),n1=t(42675),n2=t(20074),n5=t(54097),n4=t(95862),n3=t(82960),n9=t(69879),n6=t(618),n8=t(77153);function n7(e){let{name:n,setName:t}=e,[l,s]=(0,j.useState)(!1),[o,a]=(0,j.useState)(n),c=(0,j.useRef)(null),d=(0,j.useCallback)(()=>{t(o),s(!1)},[t,s,o]);return(0,j.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&d()};return l&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[l,c,d]),(0,i.jsxs)(n9.a,{flex:"0 1",fontSize:"12pt",fontWeight:"500",separator:(0,i.jsx)(n8.X,{color:"gray.500"}),children:[(0,i.jsx)(n6.g,{children:(0,i.jsx)(r.xu,{children:"Checklist"})}),(0,i.jsx)(n6.g,{flex:"0 1",cursor:"pointer",children:l?(0,i.jsx)(nk.I,{ref:c,value:o,onChange:e=>{a(e.target.value)},onKeyDown:e=>{"Enter"===e.key?(t(o),s(!1)):"Escape"===e.key&&(a(n),s(!1))},size:"sm",w:"auto",minW:"200px",maxW:"600px"}):(0,i.jsx)(r.xu,{onClick:()=>{a(n),s(!0)},textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:n})})]})}var te=t(94019);t(81974);var tn=t(78439);function tt(e){let{model:n,name:t,baseType:l,currentType:a}=e,{runAction:c}=nP(),d=a||l,u=()=>{c("histogram_diff",{model:n,column_name:t,column_type:d},{showForm:!1})},x=()=>{c("top_k_diff",{model:n,column_name:t,k:50},{showForm:!1})},m=!l||!a;return(0,i.jsxs)(o.k,{children:[(0,i.jsx)(r.xu,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t}),(0,i.jsx)(h.L,{}),(0,i.jsx)(n_.v,{children:e=>{let{isOpen:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nS.j,{className:"row-context-menu",visibility:n?"visible":"hidden",width:n?"auto":"0px",minWidth:n?"auto":"0px",as:nz.h,icon:(0,i.jsx)(s.J,{as:e$.D_A}),variant:"unstyled",size:"sm"}),(0,i.jsx)(tn.h,{children:(0,i.jsx)(nR.q,{lineHeight:"20px",children:(0,i.jsxs)(nT.k,{title:"Diff",m:"0",p:"4px 12px",children:[(0,i.jsx)(nE.s,{fontSize:"10pt",onClick:u,isDisabled:m||!d||!(!eD(d)&&!eI(d)),children:"Histogram Diff"}),(0,i.jsx)(nE.s,{fontSize:"10pt",onClick:x,isDisabled:m,children:"Top-k Diff"})]})})})]})}})]})}function ti(e,n){function t(e){return void 0===e.baseIndex?"column-index-added":void 0===e.currentIndex?"column-index-removed":!0===e.reordered?"column-index-reordered":"column-index-normal"}function r(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":e.baseType!==e.currentType?"column-body-type-changed":!0===e.reordered?"column-body-reordered":"column-body-normal"}return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:t},{key:"currentIndex",name:"",resizable:!0,minWidth:35,width:35,cellClass:t},{key:"name",name:"Name",resizable:!0,renderCell:e=>{let{row:t,column:r}=e;return n?(0,i.jsx)(tt,{model:n,name:t.name,baseType:t.baseType,currentType:t.currentType}):t.name},cellClass:function(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":!0===e.reordered?"column-body-reordered":"column-body-normal"}},{key:"baseType",name:"Base Type",resizable:!0,cellClass:r},{key:"currentType",name:"Current Type",resizable:!0,cellClass:r}],rows:Object.values(e)}}var tr=t(89725),tl=t(13965);let ts=(0,j.forwardRef)(function(e,n){let t,r,{base:l,current:s,enableScreenshot:a=!1}=e,{columns:c,rows:d}=(0,j.useMemo)(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={};return Object.entries(e0(Object.keys(e),Object.keys(n))).forEach(e=>{let[n,i]=e;t[n]={name:n,reordered:"reordered"===i}}),Object.entries(e).map((e,n)=>{let[i,r]=e;t[i].baseIndex=n+1,t[i].baseType=r.type}),Object.entries(n).map((e,n)=>{let[i,r]=e;t[i].currentIndex=n+1,t[i].currentType=r.type}),t}(null==l?void 0:l.columns,null==s?void 0:s.columns),n=(null==s?void 0:s.resource_type)||(null==l?void 0:l.resource_type);return n&&["model","seed","snapshot"].includes(n)?ti(e,(null==s?void 0:s.name)||(null==l?void 0:l.name)):ti(e)},[l,s]),{lineageGraph:u}=ed(),h=!(null==u?void 0:u.catalogMetadata.base),x=!(null==u?void 0:u.catalogMetadata.current);h&&x?t="catalog.json is missing on both current and base environments.":h?t="catalog.json is missing on base environment.":x&&(t="catalog.json is missing on current environment.");let m=l&&void 0===l.columns,p=s&&void 0===s.columns;return m&&p?r="Schema information is missing on both current and base environments.":m?r="Schema information is missing on base environment.":p&&(r="Schema information is missing on current environment."),(0,i.jsxs)(o.k,{direction:"column",children:[t?(0,i.jsxs)(tr.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(tl.z,{}),t]}):r?(0,i.jsxs)(tr.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,i.jsx)(tl.z,{}),r]}):(0,i.jsx)(i.Fragment,{}),d.length>0&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(eG,{style:{blockSize:"auto",maxHeight:"100%",overflow:"auto",fontSize:"10pt",borderWidth:1},columns:c,rows:d,renderers:{noRowsFallback:(0,i.jsx)(eY,{})},className:"rdg-light",enableScreenshot:a,ref:n})})]})});async function to(e){return(await U.post("/api/select",e)).data}var ta=t(12282);t(15080);let tc=e=>{let{style:n,children:t,gutterSize:r=5,...l}=e;return(0,i.jsx)(ta.Z,{style:{display:"flex",flexDirection:"row",...n},direction:"horizontal",gutterSize:r,...l,children:t})},td=e=>{let{style:n,children:t,gutterSize:r=5,...l}=e;return(0,i.jsx)(ta.Z,{style:{display:"flex",flexDirection:"column",...n},gutterSize:r,direction:"vertical",...l,children:t})};var tu=t(79898),th=t(68630),tx=t(91363);let tm=e$.Nbv,tp=e$.sFB,tf=e$.UGs;function tg(e){return"added"===e?{color:"#1dce00",icon:tm}:"removed"===e?{color:"#ff4444",icon:tp}:"modified"===e?{color:"#ffa502",icon:tf}:{color:"inherit",icon:void 0}}function tv(e){if("model"===e)return{color:"#c0eafd",icon:th.Fn3};if("metric"===e)return{color:"#ffe6ee",icon:tx._MV};if("source"===e)return{color:"#a6dda6",icon:th.i1q};if("exposure"===e)return{color:"#ffe6ee",icon:tx.n8P};if("semantic_model"===e)return{color:"#fb8caf",icon:tx.R1C};if("seed"===e)return{color:"#a6dda6",icon:th.tWi};if("snapshot"===e)return{color:"#a6dda6",icon:th.Dmm};else return{color:"inherit",icon:void 0}}function tj(e,n){if(!e||!n)return;let t=Object.keys(e),i=Object.keys(n);if(t.length!==i.length)return!0;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!0;for(let t of i)if(!e[t]||e[t].type!==n[t].type)return!0;return!1}let ty=e=>{let n,t,{node:l,selected:a,onSelect:c,schemaChanged:d}=e,{icon:u}=tv(l.resourceType),{base:h,current:x}=l.data;if(d){var m;n=null===(m=nA("schema_diff"))||void 0===m?void 0:m.icon,t=tg("modified").color}else!h&&x?(n=tg("added").icon,t=tg("added").color):h&&!x&&(n=tg("removed").icon,t=tg("removed").color);return(0,i.jsxs)(o.k,{width:"100%",fontSize:"10pt",p:"5px 8px",cursor:"pointer",_hover:{bg:"gray.200"},bg:a?"gray.100":"inherit",onClick:()=>c(l.id),alignItems:"center",gap:"5px",children:[(0,i.jsx)(s.J,{as:u}),(0,i.jsx)(r.xu,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:l.name}),n&&t&&(0,i.jsx)(s.J,{as:n,color:t})]})},tb=(0,j.forwardRef)(function(e,n){let{check:t}=e,{lineageGraph:r}=ed(),l=t.params,s=[...H.check(t.check_id),"select"],{isLoading:o,error:a,refetch:c,data:d}=(0,b.a)({queryKey:s,queryFn:async()=>to({select:null==l?void 0:l.select,exclude:null==l?void 0:l.exclude,packages:null==l?void 0:l.packages,view_mode:null==l?void 0:l.view_mode}),refetchOnMount:!0,enabled:!(null==l?void 0:l.node_id)}),[u,h]=(0,j.useMemo)(()=>{let e=[],n=[],t=[],i=[];if(null==l?void 0:l.node_id)for(let n of l.node_id instanceof Array?l.node_id:[l.node_id]){let t=null==r?void 0:r.nodes[n];t&&e.push(t)}else for(let n of(null==d?void 0:d.nodes)||[]){let t=null==r?void 0:r.nodes[n];t&&e.push(t)}let s=e.filter(e=>"model"===e.resourceType||"seed"===e.resourceType||"source"===e.resourceType||"snapshot"===e.resourceType);for(let e of s){var o,a;tj(null===(o=e.data.base)||void 0===o?void 0:o.columns,null===(a=e.data.current)||void 0===a?void 0:a.columns)?n.push(e.id):!e.data.base&&e.data.current?t.push(e.id):e.data.base&&!e.data.current&&i.push(e.id)}function c(e){return n.includes(e.id)?3:t.includes(e.id)?2:i.includes(e.id)?1:0}return s.sort((e,n)=>{let t=c(e),i=c(n);return t!==i?i-t:e.name.localeCompare(n.name)}),[s,n]},[null==l?void 0:l.node_id,null==d?void 0:d.nodes,r]),[x,m]=(0,j.useState)(0);if(o)return(0,i.jsx)(eQ.M,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(a)return(0,i.jsxs)(eQ.M,{bg:"rgb(249,249,249)",height:"100%",children:["Error: ",null==a?void 0:a.message]});if(0==u.length)return(0,i.jsx)(eQ.M,{bg:"rgb(249,249,249)",height:"100%",children:"No nodes matched"});if(x<u.length){let e=u[x];return(0,i.jsxs)(tc,{sizes:[80,20],minSize:30,style:{height:"100%"},children:[(0,i.jsx)(ts,{base:e.data.base,current:e.data.current,enableScreenshot:!0,ref:n}),(0,i.jsx)(tu.aV,{overflow:"auto",backgroundColor:"white",children:u.map((e,n)=>(0,i.jsx)(ty,{node:e,schemaChanged:h.includes(e.id),selected:n===x,onSelect:()=>{m(n)}},n))})]})}return(0,i.jsx)(i.Fragment,{})});var tk=t(51643);function tw(e){let{value:n,onChange:t}=e,[r,s]=(0,j.useState)(!1),[a,c]=(0,j.useState)(),d=(0,j.useRef)(null);return((0,j.useEffect)(()=>{if(r&&d.current){let e=d.current;e.focus(),e.setSelectionRange(e.value.length,e.value.length)}},[r]),r)?(0,i.jsxs)(o.k,{direction:"column",align:"flex-end",height:"100%",children:[(0,i.jsx)(tk.g,{value:a,onChange:e=>{c(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&s(!1)},ref:d,flex:1}),(0,i.jsxs)(o.k,{gap:"12px",alignItems:"flex-end",children:[(0,i.jsx)(l.r,{onClick:()=>{setTimeout(()=>{s(!1)},100)},colorScheme:"blue",children:"cancel"}),(0,i.jsx)(ej.z,{mt:"8px",size:"sm",colorScheme:"blue",onClick:()=>{t&&(t(a),s(!1))},children:"Update"})]})]}):(0,i.jsx)(eZ.x,{overflow:"auto",fontSize:"11pt",onClick:()=>{c(n||""),s(!0)},whiteSpace:"pre",color:n?"inherit":"lightgray",children:n||"Add description here"})}var tC=t(40902);function t_(){let e=(0,G.p)();return{successToast:function(n){e({description:n,status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})},failToast:function(n,t){e({title:n,description:"".concat(t),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}}}function tS(){let e=(0,nH._)(["\n    **SQL**\n    ```sql\n    ","\n    ```\n    "],["\n    **SQL**\n    \\`\\`\\`sql\n    ","\n    \\`\\`\\`\n    "]);return tS=function(){return e},e}function tz(e){return"".concat(e.is_checked?" ":"").concat(e.name)}function tR(e){return e.description?e.description:"_(no description)_"}var tT=t(23256),tE=t(31265);let tD=e=>{let{value:n,onChange:t,onRun:r,onRunBase:l,onRunDiff:a,label:c,options:d={},...u}=e;return(0,i.jsxs)(i.Fragment,{children:[(c||r||l)&&(0,i.jsxs)(o.k,{backgroundColor:"#EDF2F880",height:"40px",fontSize:"14px",align:"center",margin:"0",padding:"0px 16px",children:[(0,i.jsx)(eZ.x,{as:"b",children:c?c.toUpperCase():""}),(0,i.jsx)(h.L,{}),(r||l)&&(0,i.jsx)(ej.z,{size:"sm",variant:"outline",onClick:r||l,backgroundColor:"white",leftIcon:(0,i.jsx)(s.J,{as:tx.gmG}),padding:"6px 12px",children:"Run Query"})]}),(0,i.jsx)(tE.ML,{language:"sql",theme:"vs",value:n,onChange:e=>{void 0!==e&&t&&t(e)},onMount:(e,n)=>{r&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.Enter,r),l&&e.addCommand(n.KeyMod.Alt|n.KeyCode.Enter,l),a&&e.addCommand(n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.Enter,a)},options:{tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent",...d}})]})},tI=e=>{let{value:n,baseValue:t,onChange:r,onChangeBase:l,onRun:s,onRunBase:a,onRunDiff:c,options:d={},...u}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(o.k,{height:"100%",gap:0,children:[(0,i.jsx)(tT.K,{height:"100%",width:"50%",gap:0,borderRight:"1px",borderColor:"#D4DBE4",children:(0,i.jsx)(tD,{label:"Base",value:t||"",onChange:l,onRunBase:a,options:d,...u})}),(0,i.jsx)(tT.K,{height:"100%",width:"50%",gap:0,children:(0,i.jsx)(tD,{label:"Current",value:n,onChange:r,onRun:s,options:d,...u})})]})})};var tO=t(23567),tM=t(20085);let tL=(0,eO.G)((e,n)=>{var t,l,s,a;let{isRunning:c,isAborting:d,progress:u,error:h,run:x,onCancel:m,viewOptions:p,onViewOptionsChanged:f,RunResultView:g,children:v,onExecuteRun:j}=e,y=(null==h?void 0:null===(l=h.response)||void 0===l?void 0:null===(t=l.data)||void 0===t?void 0:t.detail)||(null==x?void 0:x.error);if(y)return(0,i.jsxs)(tr.b,{status:"error",children:[(0,i.jsx)(tl.z,{}),"Error: ",y]});if(void 0!==c?c:(null==x?void 0:x.status)==="running"){let e=(null==u?void 0:u.message)?null==u?void 0:u.message:(null==x?void 0:null===(s=x.progress)||void 0===s?void 0:s.message)?null==x?void 0:null===(a=x.progress)||void 0===a?void 0:a.message:"Loading...";return(0,i.jsx)(eQ.M,{p:"16px",height:"100%",bg:"rgb(249,249,249)",children:(0,i.jsxs)(nn.g,{children:[(0,i.jsxs)(o.k,{alignItems:"center",children:[(null==u?void 0:u.percentage)===void 0||(null==u?void 0:u.percentage)===null?(0,i.jsx)(tO.D,{isIndeterminate:!0,size:"20px",mr:"8px"}):(0,i.jsx)(tO.D,{size:"20px",value:100*u.percentage,mr:"8px"}),d?(0,i.jsx)(i.Fragment,{children:"Aborting..."}):(0,i.jsx)(i.Fragment,{children:e})]}),!d&&(0,i.jsx)(ej.z,{onClick:m,colorScheme:"blue",size:"sm",children:"Cancel"})]})})}if(!x)return(0,i.jsx)(eQ.M,{bg:"rgb(249,249,249)",height:"100%",children:"Loading..."});if(v&&g)throw Error("RunView requires either a children or a RunResultView prop, but not both.");if(!v&&!g)throw Error("RunView requires at least one of children or RunResultView prop.");return(0,i.jsxs)(r.xu,{h:"100%",style:{contain:"size layout"},overflow:"auto",children:[g&&(x.error||x.result)&&(0,i.jsx)(tM.SV,{children:(0,i.jsx)(g,{ref:n,run:x,viewOptions:p,onViewOptionsChanged:f})}),v&&v({run:x,viewOptions:p,onViewOptionsChanged:f})]})});var tA=t(65674),tN=t(29012),tq=t(25783),tF=t(49110),tP=t(55415),tW=t(24432);t(90548),t(91074);var tH=t(48289),tV=t(66633),tK=t(83143),tJ=t(29937);function tB(e){let{node:n}=e,{icon:t}=tv(n.resourceType);return(0,i.jsx)(nx.u,{hasArrow:!0,label:"Type of resource",children:(0,i.jsxs)(nZ.Vp,{children:[(0,i.jsx)(nZ.AD,{as:t}),(0,i.jsx)(nZ.Sn,{children:n.resourceType})]})})}function tU(e){let{rowCount:n}=e,t=n.base,r=n.curr,l=null===n.base?"N/A":"".concat(n.base," rows"),o=null===n.curr?"N/A":"".concat(n.curr," rows");return null===t&&null===r?(0,i.jsx)(i.Fragment,{children:" Failed to load"}):null===t||null===r?(0,i.jsxs)(u.U,{children:[(0,i.jsx)(eZ.x,{children:l}),(0,i.jsx)(s.J,{as:tK.Rgz}),(0,i.jsx)(eZ.x,{children:o})]}):t===r?(0,i.jsxs)(u.U,{children:[(0,i.jsx)(eZ.x,{children:o}),(0,i.jsx)(s.J,{as:tJ.lxc,color:"gray.500"}),(0,i.jsx)(eZ.x,{color:"gray.500",children:"No Change"})]}):t<r?(0,i.jsxs)(u.U,{children:[(0,i.jsx)(eZ.x,{children:o}),(0,i.jsx)(s.J,{as:tJ.Tvk,color:"green.500"}),(0,i.jsx)(eZ.x,{color:"green.500",children:nc(t,r)})]}):(0,i.jsxs)(u.U,{children:[(0,i.jsx)(eZ.x,{children:o}),(0,i.jsx)(s.J,{as:tJ.ebp,color:"red.500"}),(0,i.jsx)(eZ.x,{color:"red.500",children:nc(t,r)})]})}function tQ(e){var n,t,r;let l,{rowCount:s,node:o,onRefresh:a,isFetching:c}=e,{runsAggregated:d,refetchRunsAggregated:u}=ed(),h=null==d?void 0:null===(t=d[o.id])||void 0===t?void 0:null===(n=t.row_count_diff)||void 0===n?void 0:n.result,x=null===(r=nA("row_count_diff"))||void 0===r?void 0:r.icon,m=s||h;if(m){let e=(null==m?void 0:m.base)===null?"N/A":null==m?void 0:m.base,n=(null==m?void 0:m.curr)===null?"N/A":null==m?void 0:m.curr;l="".concat(e," -> ").concat(n," rows")}return(0,i.jsx)(nx.u,{label:l,children:(0,i.jsxs)(nZ.Vp,{children:[(0,i.jsx)(nZ.AD,{as:x}),(0,i.jsx)(nZ.Sn,{children:m||c?(0,i.jsx)(tV.N,{isLoaded:!c,noOfLines:1,skeletonHeight:2,minWidth:"30px",children:m?(0,i.jsx)(tU,{rowCount:m}):"row count"}):(0,i.jsx)(i.Fragment,{children:"row count"})}),a&&(0,i.jsx)(nZ.bq,{as:nz.h,isLoading:c,"aria-label":"Query Row Count",icon:(0,i.jsx)(n1.n,{}),size:"xs",onClick:a})]})})}let tX=e=>{let{node:n,action:t}=e,{status:l,skipReason:s,run:a}=t;if("pending"===l)return(0,i.jsx)(tO.D,{size:"20px",value:0});if("skipped"===l)return(0,i.jsxs)(o.k,{fontSize:"10pt",color:"gray",children:[(0,i.jsx)(r.xu,{children:"Skipped"}),s&&(0,i.jsx)(nx.u,{label:s,children:(0,i.jsx)(tH.s,{})})]});if(!a)return(0,i.jsx)(tO.D,{isIndeterminate:!0,size:"20px"});let{error:c,result:d,run_id:u,progress:h}=a;if("running"===l)return(null==h?void 0:h.percentage)===void 0?(0,i.jsx)(tO.D,{isIndeterminate:!0,size:"20px"}):(0,i.jsx)(tO.D,{size:"20px",value:(null==h?void 0:h.percentage)*100});if(c)return(0,i.jsxs)(o.k,{fontSize:"10pt",color:"gray",children:[(0,i.jsx)(r.xu,{children:"Error"}),s&&(0,i.jsx)(nx.u,{label:c,children:(0,i.jsx)(ne.a,{})})]});if("value_diff"===a.type){let e=0;for(let n of d.data.data)n[2]<1&&e++;return(0,i.jsx)(nZ.Vp,{children:(0,i.jsx)(nZ.Sn,{children:(0,i.jsx)(o.k,{fontSize:"10pt",color:e>0?"red":"green",alignItems:"center",gap:"3px",children:e>0?"".concat(e," columns mismatched"):"All columns match"})})})}if("row_count_diff"===a.type){let e=a.result;return(0,i.jsx)(tQ,{rowCount:e[n.name],node:n})}return(0,i.jsx)(i.Fragment,{children:u})},tZ=(0,j.createContext)(void 0),tG=()=>{let e=(0,j.useContext)(tZ);if(!e)throw Error("useLineageViewContext must be used within a LineageViewProvider");return e},tY=e=>{var n,t,l,a;let c,d,{id:u}=e,{lineageGraph:h,runsAggregated:x}=ed(),m=null==x?void 0:x[u],p=null==h?void 0:h.nodes[u];if(!m&&!p)return(0,i.jsx)(i.Fragment,{});if((null==p?void 0:p.data.base)&&(null==p?void 0:p.data.current)&&(c=tj(null===(l=p.data.base)||void 0===l?void 0:l.columns,null===(a=p.data.current)||void 0===a?void 0:a.columns)),m&&m.row_count_diff){let e=m.row_count_diff;d=e.result.curr!==e.result.base}return(0,i.jsxs)(o.k,{gap:"5px",children:[void 0!==c&&(0,i.jsx)(nx.u,{label:"Schema (".concat(c?"changed":"no change",")"),openDelay:500,children:(0,i.jsx)(r.xu,{height:"16px",children:(0,i.jsx)(s.J,{as:null===(n=nA("schema_diff"))||void 0===n?void 0:n.icon,color:c?tg("modified").color:"lightgray"})})}),void 0!==d&&(0,i.jsx)(nx.u,{label:"Row count (".concat(d?"changed":"no change",")"),openDelay:500,children:(0,i.jsx)(r.xu,{height:"16px",children:(0,i.jsx)(s.J,{as:null===(t=nA("row_count_diff"))||void 0===t?void 0:t.icon,color:d?tg("modified").color:"lightgray"})})})]})};var t$=t(13358),t0=t(15196),t1=t(28023),t2=t(84963);function t5(e){let{base:n,current:t}=e;return(0,i.jsx)(tE.SV,{height:"100%",language:"sql",theme:"vs",original:null==n?void 0:n.raw_code,modified:null==t?void 0:t.raw_code,options:{readOnly:!0,fontSize:14,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same"}})}async function t4(e){return(await U.post("/api/checks",{type:"schema_diff",params:e})).data}function t3(e){var n,t,l,a,d,f,g;let{node:v,onCloseNode:y}=e,[,b]=(0,ek.TH)(),{setSqlQuery:k,setPrimaryKeys:w}=S(),C="model"===v.resourceType||"seed"===v.resourceType||"source"===v.resourceType||"snapshot"===v.resourceType,{isOpen:_,onOpen:z,onClose:R}=(0,eb.q)(),{runAction:T}=nP(),{envInfo:E}=ed(),{primaryKey:D}=eE(v.name),I=()=>{T("row_count_diff",{node_names:[v.name]},{showForm:!1,showLast:!1})},O=(0,j.useCallback)(async()=>{let e=v.id,n=await t4({node_id:e});b("/checks/".concat(n.check_id))},[v,b]),M="added"===v.changeStatus||"removed"===v.changeStatus;return(0,i.jsxs)(t0.r,{height:"100%",templateRows:"auto auto 1fr",children:[(0,i.jsxs)(u.U,{children:[(0,i.jsx)(r.xu,{flex:"0 1 20%",p:"16px",children:(0,i.jsx)(c.X,{size:"sm",children:v.name})}),(0,i.jsx)(h.L,{}),("model"===v.resourceType||"seed"===v.resourceType||"snapshot"===v.resourceType)&&(0,i.jsxs)(n_.v,{children:[(0,i.jsx)(nS.j,{as:ej.z,size:"sm",colorScheme:"blue",children:"Explore Change"}),(0,i.jsxs)(nR.q,{children:[(0,i.jsx)(nE.s,{icon:(0,i.jsx)(s.J,{as:null===(n=nA("query_diff"))||void 0===n?void 0:n.icon}),fontSize:"14px",onClick:()=>{(null==E?void 0:E.adapterType)==="dbt"?k('select * from {{ ref("'.concat(v.name,'") }}')):(null==E?void 0:E.adapterType)==="sqlmesh"&&k("select * from ".concat(v.name)),w(void 0!==D?[D]:void 0),b("/query")},children:"Query"}),(0,i.jsx)(t1.R,{}),(0,i.jsxs)(nT.k,{title:"Diff",m:"0",p:"4px 12px",children:[("model"===v.resourceType||"snapshot"===v.resourceType)&&(0,i.jsx)(nE.s,{onClick:z,icon:(0,i.jsx)(th.tvD,{}),fontSize:"14px",children:"Code Diff"}),(0,i.jsx)(nE.s,{icon:(0,i.jsx)(s.J,{as:null===(t=nA("row_count_diff"))||void 0===t?void 0:t.icon}),fontSize:"14px",onClick:()=>I(),children:"Row Count Diff"}),(0,i.jsx)(nE.s,{icon:(0,i.jsx)(s.J,{as:null===(l=nA("profile_diff"))||void 0===l?void 0:l.icon}),fontSize:"14px",isDisabled:M,onClick:()=>{T("profile_diff",{model:v.name},{showForm:!1,showLast:!1})},children:"Profile Diff"}),(0,i.jsx)(nE.s,{icon:(0,i.jsx)(s.J,{as:null===(a=nA("value_diff"))||void 0===a?void 0:a.icon}),fontSize:"14px",isDisabled:M,onClick:()=>{T("value_diff",{model:v.name},{showForm:!0,showLast:!1})},children:"Value Diff"}),(0,i.jsx)(nE.s,{icon:(0,i.jsx)(s.J,{as:null===(d=nA("top_k_diff"))||void 0===d?void 0:d.icon}),fontSize:"14px",isDisabled:M,onClick:()=>{T("top_k_diff",{model:v.name,column_name:"",k:50},{showForm:!0})},children:"Top-K Diff"}),(0,i.jsx)(nE.s,{icon:(0,i.jsx)(s.J,{as:null===(f=nA("histogram_diff"))||void 0===f?void 0:f.icon}),fontSize:"14px",isDisabled:M,onClick:()=>{T("histogram_diff",{model:v.name,column_name:"",column_type:""},{showForm:!0})},children:"Histogram Diff"})]}),(0,i.jsx)(t1.R,{}),(0,i.jsx)(nT.k,{title:"Add to Checklist",m:"0",p:"4px 12px",children:(0,i.jsx)(nE.s,{icon:(0,i.jsx)(s.J,{as:null===(g=nA("schema_diff"))||void 0===g?void 0:g.icon}),fontSize:"14px",onClick:O,children:"Schema Diff"})})]})]}),(0,i.jsx)(r.xu,{flex:"0 1 1%",children:(0,i.jsx)(t2.P,{onClick:y})})]}),(0,i.jsx)(r.xu,{color:"gray",paddingLeft:"16px",children:(0,i.jsxs)(u.U,{spacing:"8px",children:[(0,i.jsx)(tB,{node:v}),("model"===v.resourceType||"snapshot"===v.resourceType||"seed"===v.resourceType)&&(0,i.jsx)(tQ,{node:v,onRefresh:I})]})}),C&&(0,i.jsxs)(x.m,{overflow:"auto",as:o.k,children:[(0,i.jsx)(m.t,{children:(0,i.jsx)(p.O,{children:"Columns"})}),(0,i.jsx)(nG.n,{overflow:"auto",height:"calc(100% - 42px)",children:(0,i.jsx)(nY.x,{p:0,overflowY:"auto",height:"100%",children:(0,i.jsx)(ts,{base:v.data.base,current:v.data.current})})})]}),(0,i.jsxs)(eh.u_,{isOpen:_,onClose:R,size:"6xl",children:[(0,i.jsx)(ex.Z,{}),(0,i.jsxs)(em.h,{overflowY:"auto",height:"75%",children:[(0,i.jsx)(ep.x,{children:"Model Raw Code Diff"}),(0,i.jsx)(ef.o,{}),(0,i.jsx)(eg.f,{children:(0,i.jsx)(t5,{base:v.data.base,current:v.data.current})})]})]})]})}function t9(e){var n,t;let{onClose:l}=e,{cancel:s,actionState:o}=tG();return(0,i.jsx)(r.xu,{bg:"white",rounded:"md",shadow:"dark-lg",children:(0,i.jsxs)(u.U,{p:"5px 15px",mt:"4",divider:(0,i.jsx)(tq.c,{borderColor:"gray.200"}),spacing:4,children:[(0,i.jsxs)(r.xu,{fontSize:"10pt",children:["Progress: ","per_node"===o.mode?"".concat(o.completed," / ").concat(o.total):(null===(t=o.currentRun)||void 0===t?void 0:null===(n=t.progress)||void 0===n?void 0:n.percentage)?"".concat(100*o.currentRun.progress.percentage,"%"):"completed"===o.status?"100%":"0%"," ","canceled"===o.status?" (canceled)":""]}),"running"===o.status||"canceling"===o.status?(0,i.jsx)(ej.z,{size:"xs",variant:"outline",onClick:s,isLoading:"canceling"===o.status,loadingText:"Canceling",children:"Cancel"}):(0,i.jsx)(u.U,{children:(0,i.jsx)(ej.z,{size:"xs",variant:"outline",onClick:l,children:"Close"})})]})})}var t6=t(27547);let t8=()=>{let{isHistoryOpen:e,showHistory:n,closeHistory:t}=nP();return(0,i.jsx)(ej.z,{leftIcon:(0,i.jsx)(s.J,{as:e$.M1Q}),size:"xs",variant:"outline",onClick:e?t:n,children:e?"Hide":"Show"})},t7=e=>{let{isDisabled:n}=e,{viewOptions:t,onViewOptionsChanged:r,selectMode:l}=tG(),o=t.view_mode||"changed_models",a=e=>{r({...t,view_mode:e})};return(0,i.jsxs)(n_.v,{children:[(0,i.jsx)(nS.j,{as:ej.z,minWidth:"100px",leftIcon:(0,i.jsx)(s.J,{as:tv("model").icon}),size:"xs",variant:"outline",isDisabled:n,children:"changed_models"===o?"Changed Models":"All"}),(0,i.jsxs)(nR.q,{title:"packages",children:[(0,i.jsx)(nE.s,{as:nt.X,size:"sm",isChecked:"changed_models"===o,onChange:()=>a("changed_models"),children:"Changed Models"}),(0,i.jsx)(nE.s,{as:nt.X,size:"sm",isChecked:"all"===o,onChange:()=>a("all"),children:"All"})]})]})},ie=e=>{var n,t;let{isDisabled:r}=e,{lineageGraph:l}=ed(),{viewOptions:o,onViewOptionsChanged:a}=tG(),c=new Set;for(let e of Object.values((null==l?void 0:l.nodes)||{}))e.packageName&&c.add(e.packageName);let d=null==l?void 0:null===(t=l.manifestMetadata)||void 0===t?void 0:null===(n=t.current)||void 0===n?void 0:n.project_name,u=o.packages?new Set(o.packages):d?new Set([d]):c,h=u.size===c.size,x=0===u.size,m=1===u.size?Array.from(u)[0]:h?"All Packages":x?"No Package":"".concat(u.size," Packages"),p=e=>{let n=new Set(u);n.has(e)?n.delete(e):n.add(e),a({...o,packages:Array.from(n)})};return(0,i.jsxs)(n_.v,{closeOnSelect:!1,children:[(0,i.jsx)(nS.j,{as:ej.z,minWidth:"100px",leftIcon:(0,i.jsx)(s.J,{as:tK.zFh}),size:"xs",variant:"outline",isDisabled:r,children:m}),(0,i.jsx)(nR.q,{title:"packages",children:(0,i.jsxs)(nT.k,{title:"Select Packages",children:[(0,i.jsx)(nE.s,{as:nt.X,size:"sm",isIndeterminate:!h&&!x,isChecked:h,onChange:()=>{h?a({...o,packages:[]}):a({...o,packages:Array.from(c)})},children:"Select All"}),(0,i.jsx)(t1.R,{}),Array.from(c).map(e=>(0,i.jsx)(nE.s,{as:nt.X,size:"sm",isChecked:u.has(e),onChange:()=>{p(e)},children:e},e))]})})]})},it=e=>{let[n,t]=(0,j.useState)(e.value),r=(0,j.useRef)(null);return(0,j.useEffect)(()=>{r.current&&(r.current.value=e.value)},[e.value]),(0,i.jsx)(nk.I,{ref:r,height:"24px",fontSize:"10pt",placeholder:"<selection>",isDisabled:e.isDisabled,value:n,onChange:e=>{t(e.target.value)},onKeyUp:i=>{"Enter"===i.key?e.onChange(n):"Escape"===i.key&&(i.preventDefault(),t(e.value),r.current&&r.current.blur())},onBlur:()=>t(e.value)})},ii=e=>{let{isDisabled:n}=e,{viewOptions:t,onViewOptionsChanged:r}=tG();return(0,i.jsx)(it,{isDisabled:n,value:t.select||"",onChange:e=>{r({...t,select:e||void 0})}})},ir=e=>{let{isDisabled:n}=e,{viewOptions:t,onViewOptionsChanged:r}=tG();return(0,i.jsx)(it,{isDisabled:n,value:t.exclude||"",onChange:e=>{r({...t,exclude:e||void 0})}})},il=e=>(0,i.jsxs)(r.xu,{style:e.style,maxWidth:"300px",children:[(0,i.jsx)(r.xu,{fontSize:"8pt",children:(null==e?void 0:e.label)||(0,i.jsx)(i.Fragment,{children:"\xa0"})}),e.children]}),is=()=>{var e,n,t,r;let{nodes:l,deselect:o,selectMode:a,...c}=tG(),d=(0,j.useMemo)(()=>l.filter(e=>e.data.isSelected),[l]),x="single"===a&&1===d.length,m="multi"===a&&d.length>=1,p="single"===a&&0===d.length,f="single"!==a;return(0,i.jsx)(u.U,{width:"100%",padding:"4pt 8pt",children:(0,i.jsxs)(u.U,{flex:"1",children:[(0,i.jsx)(il,{label:"History",style:{flexShrink:"1"},children:(0,i.jsx)(t8,{})}),(0,i.jsx)(il,{label:"Mode",style:{flexShrink:"1"},children:(0,i.jsx)(t7,{isDisabled:f})}),(0,i.jsx)(il,{label:"Package",style:{flexShrink:"1"},children:(0,i.jsx)(ie,{isDisabled:f})}),(0,i.jsx)(il,{label:"Select",style:{flex:"100 1 auto"},children:(0,i.jsx)(ii,{isDisabled:f})}),(0,i.jsx)(il,{label:"Exclude",style:{flex:"100 1 auto"},children:(0,i.jsx)(ir,{isDisabled:f})}),(0,i.jsx)(h.L,{}),"multi"===a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(il,{label:"",style:{flexShrink:"0"},children:(0,i.jsx)(eZ.x,{fontSize:"9pt",color:"gray.500",children:d.length>1?"".concat(d.length," nodes selected"):"".concat(d.length," node selected")})}),(0,i.jsx)(il,{label:"",children:(0,i.jsx)(ej.z,{variant:"outline",size:"xs",fontSize:"9pt",isDisabled:"multi"!==a,onClick:()=>{o()},children:"Deselect"})})]}),(0,i.jsx)(il,{label:"Explore",children:(0,i.jsx)(t6.h,{isAttached:!0,variant:"outline",children:(0,i.jsxs)(n_.v,{placement:"bottom-end",children:[(0,i.jsx)(nS.j,{as:ej.z,size:"xs",children:"Actions"}),(0,i.jsxs)(nR.q,{children:[(0,i.jsxs)(nT.k,{title:"Diff",m:"0",p:"4px 12px",children:[(0,i.jsx)(nE.s,{as:eZ.x,size:"sm",fontSize:"10pt",isDisabled:!(p||x||m),icon:(0,i.jsx)(s.J,{as:null===(e=nA("row_count_diff"))||void 0===e?void 0:e.icon}),onClick:()=>{c.runRowCountDiff()},children:"Row Count Diff"}),(0,i.jsx)(nE.s,{as:eZ.x,size:"sm",fontSize:"10pt",isDisabled:!(x||m),icon:(0,i.jsx)(s.J,{as:null===(n=nA("value_diff"))||void 0===n?void 0:n.icon}),onClick:()=>{c.runValueDiff()},children:"Value Diff"})]}),(0,i.jsx)(t1.R,{}),(0,i.jsxs)(nT.k,{title:"Add to Checklist",m:"0",px:"12px",children:[(0,i.jsx)(nE.s,{as:eZ.x,size:"sm",fontSize:"10pt",isDisabled:!(p||m&&d.length>1),icon:(0,i.jsx)(s.J,{as:null===(t=nA("lineage_diff"))||void 0===t?void 0:t.icon}),onClick:()=>{c.addLineageDiffCheck(c.viewOptions.view_mode)},children:"Lineage Diff"}),(0,i.jsx)(nE.s,{as:eZ.x,size:"sm",fontSize:"10pt",isDisabled:!(p||x||m),icon:(0,i.jsx)(s.J,{as:null===(r=nA("schema_diff"))||void 0===r?void 0:r.icon}),onClick:()=>{c.addSchemaDiffCheck()},children:"Schema Diff"})]})]})]})})})]})})};var io=t(81737),ia=t.n(io),ic=t(77249),id=t(50228),iu=t(67605),ih=t.n(iu);let ix="ignore-screenshot";function im(e){let{renderLibrary:n="html2canvas",imageType:t="png",backgroundColor:r=null,boardEffect:l=!0,shadowEffect:s=!1,borderStyle:c="solid 1px #ccc",borderRadius:d="10px",onSuccess:u,onError:h,ignoreElements:x}=e,[m,p]=(0,j.useState)("idle"),f=(0,j.useRef)(null),{onOpen:g,setImgBlob:v,ImageDownloadModal:y}=function(){let{isOpen:e,onOpen:n,onClose:t}=(0,eb.q)(),[r,l]=(0,j.useState)();return{onOpen:n,setImgBlob:l,ImageDownloadModal:function(){let[n,l]=(0,j.useState)();return(0,j.useEffect)(()=>{if(!r)return;let e=new FileReader;e.readAsDataURL(r),e.onloadend=e=>{var n,t;(null===(n=e.target)||void 0===n?void 0:n.result)&&(null===(t=e.target)||void 0===t?void 0:t.result)!==null&&l(e.target.result)}},[l]),(0,i.jsxs)(eh.u_,{size:"3xl",isOpen:e,onClose:t,children:[(0,i.jsx)(ex.Z,{}),(0,i.jsxs)(em.h,{children:[(0,i.jsx)(ep.x,{children:"Screenshot Preview"}),(0,i.jsx)(ef.o,{}),(0,i.jsxs)(eg.f,{children:[(0,i.jsxs)(o.k,{px:"10px",gap:"10px",direction:"column",children:[(0,i.jsxs)(o.k,{alignItems:"center",gap:"5px",children:[(0,i.jsx)(tH.s,{color:"red.600"}),(0,i.jsx)(eZ.x,{fontWeight:"500",display:"inline",children:"Copy to the Clipboard"})," ","is not supported in the current browser"]}),(0,i.jsx)(eZ.x,{children:"Please download it directly"})]}),(0,i.jsx)(a.E,{src:n,alt:"screenshot"})]}),(0,i.jsxs)(ev.m,{children:[(0,i.jsx)(ej.z,{mr:3,onClick:t,children:"Close"}),(0,i.jsx)(ej.z,{colorScheme:"blue",onClick:()=>{if(!r)return;let e=new Date,n="recce-screenshot-".concat((0,id.WU)(e,"yyyy-MM-dd-HH-mm-ss"),".png");ih()(r,n),t()},children:"Download"})]})]})]})}}}(),b=async()=>{if(!f.current)throw console.error("No node to use for screenshot"),Error("No node to use for screenshot");let e=f.current.element||f.current,t=e.style.overflow,i=e.style.border,o=e.style.borderRadius,a=e.style.backgroundColor,u=e.style.height;try{var h;e.style.overflow="hidden",e.style.border=l?c:"",e.style.borderRadius=l?d:"",e.style.backgroundColor=r||"",e.style.height=e.offsetHeight+"px";let t=document.createElement("style");document.head.appendChild(t),null===(h=t.sheet)||void 0===h||h.insertRule("body > div:last-child img { display: inline-block; }"),p("loading");let i="html2canvas"===n?await ia()(e,{logging:!1,backgroundColor:null,ignoreElements:x}):await (0,ic.rT)(e,{filter:x?e=>!x(e):void 0});t.remove();let o=s?document.createElement("canvas"):i;if(s){o.width=i.width+80,o.height=i.height+80;let e=o.getContext("2d");if(e)e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=20,e.shadowOffsetX=10,e.shadowOffsetY=10,e.drawImage(i,40,40);else throw console.error("Error getting canvas context"),Error("Error getting canvas context to add shadow effect")}let a=await fetch(o.toDataURL());return await a.blob()}catch(e){throw console.error("Error converting to image",e),e}finally{e.style.overflow=t,e.style.border=i,e.style.borderRadius=o,e.style.backgroundColor=a,e.style.height=u}};return{status:m,isLoading:"loading"===m,isErrored:"error"===m,isSuccess:"success"===m,copyToClipboard:async()=>{try{await navigator.clipboard.write([new ClipboardItem({["image/".concat(t)]:b()})]),p("success"),u&&u()}catch(e){"ClipboardItem is not defined"===e.message?(v(await b()),g(),p("success")):(p("error"),console.error("Error copying to clipboard",e),h&&h(e))}},ImageDownloadModal:y,ref:f}}function ip(e){let{successToast:n,failToast:t}=t_(),{isLoading:r,copyToClipboard:l,ImageDownloadModal:s,ref:o}=im({imageType:"png",shadowEffect:!0,backgroundColor:(null==e?void 0:e.backgroundColor)||null,onSuccess:()=>{n("Copied the query result as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),t("Failed to copy image to clipboard",e)}}),a=(0,j.useCallback)(()=>{if(o.current){let e=o.current.element||o.current;e.style.boxShadow="rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px",e.style.transition="box-shadow 0.5s ease-in-out"}},[o]),c=(0,j.useCallback)(()=>{o.current&&((o.current.element||o.current).style.boxShadow="")},[o]),d=(0,j.useCallback)(async()=>{o.current&&(await l(),(o.current.element||o.current).style.boxShadow="")},[o,l]);return{ref:o,CopyToClipboardButton:function(e){let{imageType:n="png",...t}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ej.z,{size:"sm",leftIcon:(0,i.jsx)(n2.T,{}),style:{position:"absolute",bottom:"16px",right:"16px"},isLoading:r,onMouseEnter:a,onMouseLeave:c,onClick:d,children:"Copy to Clipboard"}),(0,i.jsx)(s,{})]})},onMouseEnter:a,onMouseLeave:c,onCopyToClipboard:d}}async function ig(e){return(await U.post("/api/checks",{type:"lineage_diff",params:{},view_options:e})).data}function iv(){return(0,i.jsx)(r.xu,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[n,[t,r]]=e,{icon:l,color:a}=tg(n);return(0,i.jsx)(nx.u,{label:r,children:(0,i.jsxs)(o.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,i.jsx)(s.J,{color:a,as:l})," ",t]})},n)})})}var ij=t(11978);let iy={mode:"per_node",status:"pending",completed:0,total:0},ib=(e,n)=>{let{onActionStarted:t,onActionNodeUpdated:i,onActionCompleted:r}=n,l=(0,j.useRef)({...iy}).current,{showRunId:s}=nP(),o=async(n,o,a)=>{let c="multi_nodes";l.mode=c,t(),l.status="running";let d=[];for(let n of e){let e=o(n);e?(n.action={mode:c,status:"skipped",skipReason:e},i(n)):(n.action={mode:c,status:"pending"},d.push(n))}let u=a(d);try{let{run_id:e}=await ee(n,u,{nowait:!0});for(s(e),l.currentRun={run_id:e},l.total=1;;){let n=await en(e,2);l.currentRun=n;let t=n.error?"failure":n.result?"success":"running";for(let e of d)e.action={mode:c,status:t,run:n},i(e);if(n.error||n.result)break}}catch(e){}if(l.completed=1,"canceling"===l.status){l.status="canceled",r();return}l.status="completed",r()},a=async(n,s)=>{let o="per_node";for(let n of(l.mode=o,t(),l.status="running",e))n.action={mode:o,status:"pending"},i(n);for(let t of(l.completed=0,l.total=e.length,e)){let{params:e,skipReason:a}=s(t);if(a)t.action={mode:o,status:"skipped",skipReason:a},i(t);else try{let{run_id:r}=await ee(n,e,{nowait:!0});for(l.currentRun={run_id:r},t.action={mode:o,status:"running"},i(t);;){let e=await en(r,2);l.currentRun=e;let n=e.error?"failure":e.result?"success":"running";if(t.action={mode:o,status:n,run:e},i(t),e.error||e.result)break}}catch(e){}finally{l.currentRun=void 0}if(l.completed++,"canceling"===l.status){l.status="canceled",r();return}}l.status="completed",r()},c=async()=>{var e;l.status="canceling",(null===(e=l.currentRun)||void 0===e?void 0:e.run_id)&&await et(l.currentRun.run_id)};return{actionState:l,runRowCountDiff:async()=>{let n=[];for(let t of e)"model"!==t.resourceType?(t.action={mode:"multi_nodes",status:"skipped",skipReason:"Not a model"},i(t)):n.push(t.name);await o("row_count_diff",e=>{if("model"!==e.resourceType)return"Not a model"},e=>({node_names:e.map(e=>e.name)}))},runValueDiff:async()=>{a("value_diff",e=>{var n,t;let i=null===(t=e.data)||void 0===t?void 0:null===(n=t.current)||void 0===n?void 0:n.primary_key;return i?{params:{model:e.name,primary_key:i}}:{skipReason:"No primary key found. The first unique column is used as primary key."}})},addLineageDiffCheck:async n=>{let t=e.map(e=>e.id);return await ig({view_mode:n,node_ids:t})},addSchemaDiffCheck:async()=>{let n;if(1===e.length)n=await t4({node_id:e[0].id});else{let t=e.map(e=>e.id);n=await t4({node_id:t})}return n},cancel:c,reset:()=>{Object.assign(l,iy)}}},ik={customNode:function(e){var n,t;let l,{data:a}=e,{isHighlighted:c,isSelected:d,resourceType:x,changeStatus:m}=a,p=(0,T.oR)(e=>e.transform[2]>.3),{icon:f}=tv(x),[g,v]=(0,j.useState)(!1),{selectNodeMulti:y,selectMode:b}=tG(),k="gray.400",w="solid";m&&(l=tg(m).icon,k=tg(m).color);let C=k,_=a.isSelected?"rgba(3, 102, 214, 0.5) 5px 5px 10px 3px":"unset",S=null==a?void 0:a.name;return(0,i.jsx)(nx.u,{label:"model"===x?S:"".concat(S," (").concat(x,")"),placement:"top",children:(0,i.jsxs)(o.k,{width:"300px",_hover:{backgroundColor:p?"gray.100":k},borderColor:C,borderWidth:1,borderStyle:w,backgroundColor:p?"white":k,borderRadius:3,boxShadow:_,transition:"box-shadow 0.2s ease-in-out",padding:0,className:!0===c?"node-highlight":!0===d?"node-highlight":!1===c?"node-unhighlight":void 0,onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),children:[(0,i.jsx)(o.k,{backgroundColor:k,padding:2,borderRightWidth:1,borderColor:C,borderStyle:w,alignItems:"top",visibility:p?"inherit":"hidden",children:"single"==b&&g||"multi"===b?(0,i.jsx)("input",{checked:d&&"multi"===b,type:"checkbox",onChange:()=>{},onClick:e=>{e.stopPropagation(),y(a.id)}}):(0,i.jsx)(s.J,{as:f})}),(0,i.jsxs)(o.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:[(0,i.jsxs)(o.k,{width:"100%",textAlign:"left",flex:"1",p:1,alignItems:"center",visibility:p?"inherit":"hidden",children:[(0,i.jsx)(r.xu,{flex:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:S}),l&&(0,i.jsx)(o.k,{children:(0,i.jsx)(s.J,{color:k,as:l,flex:"0 0 20px"})})]}),(0,i.jsx)(o.k,{flex:"1 0 auto",mx:"1",direction:"column",paddingBottom:"1",visibility:p?"inherit":"hidden",children:(0,i.jsxs)(u.U,{spacing:"8px",children:[(0,i.jsx)(h.L,{}),a.isActionMode?a.action?(0,i.jsx)(tX,{node:a,action:a.action}):(0,i.jsx)(i.Fragment,{}):"model"===a.resourceType?(0,i.jsx)(tY,{id:a.id}):(0,i.jsx)(i.Fragment,{})]})})]}),Object.keys(null!==(n=null==a?void 0:a.parents)&&void 0!==n?n:{}).length>0&&(0,i.jsx)(T.HH,{type:"target",position:T.Ly.Left,isConnectable:!1}),Object.keys(null!==(t=null==a?void 0:a.children)&&void 0!==t?t:{}).length>0&&(0,i.jsx)(T.HH,{type:"source",position:T.Ly.Right,isConnectable:!1})]})})}},iw={customEdge:function(e){let{sourceX:n,sourceY:t,targetX:r,targetY:l,sourcePosition:s,targetPosition:o,style:a={},markerEnd:c,data:d}=e,u={...a};(null==d?void 0:d.changeStatus)&&(u.stroke=tg(null==d?void 0:d.changeStatus).color,u.strokeDasharray="5"),(null==d?void 0:d.isHighlighted)===!1&&(u.filter="opacity(0.2) grayscale(50%)");let[h]=(0,T.OQ)({sourceX:n,sourceY:t,sourcePosition:s,targetX:r,targetY:l,targetPosition:o});return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(T.u5,{path:h,markerEnd:c,style:{...u,...a}})})}},iC=e=>{var n,t;return(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.changeStatus)?tg(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.changeStatus).color:"lightgray"},i_=(e,n)=>{let t=null==e?void 0:e.current,i=(0,j.useRef)({width:0,height:0});(0,j.useEffect)(()=>{let e=new ResizeObserver(e=>{for(let t of e){let e=t.contentRect.width,r=t.contentRect.height;(Math.abs(r-i.current.height)>10||Math.abs(e-i.current.width)>10)&&i.current.height>0&&r>0&&i.current.width>0&&e>0&&n(),i.current={width:e,height:r}}});return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[t,i,n])},iS=()=>{let[,e]=(0,ek.TH)();return(0,j.useCallback)(n=>{n.check_id&&e("/checks/".concat(n.check_id))},[e])},iz=(0,j.forwardRef)(function(e,n){var t;let{...l}=e,a=(0,T._K)(),c=(0,j.useRef)(null),{successToast:d,failToast:h}=t_(),{copyToClipboard:x,ImageDownloadModal:m,ref:p}=im({renderLibrary:"html-to-image",imageType:"png",shadowEffect:!0,backgroundColor:"white",ignoreElements:e=>{let n=e.className;return!!("string"==typeof n&&n.includes(ix))},onSuccess:()=>{d("Copied the Lineage View as an image to clipboard")},onError:e=>{console.error("Error taking screenshot",e),h("Failed to copy image to clipboard",e)}}),[f,g,v]=(0,T.Rr)([]),[y,b,k]=(0,T.ll)([]),[w,C]=(0,j.useState)({view_mode:"changed_models",...l.viewOptions}),{lineageGraph:_,retchLineageGraph:S,isLoading:z,error:R,refetchRunsAggregated:E}=ed(),{showRunId:D,closeRunResult:I,runAction:H}=nP();(0,j.useImperativeHandle)(n,()=>({copyToClipboard:x}));let V=w.view_mode||l.viewMode||"changed_models",[K,J]=(0,j.useState)("single"),B=(0,j.useMemo)(()=>{var e;if("single"===K)return null===(e=f.find(e=>e.data.isSelected))||void 0===e?void 0:e.data},[K,f]),U=(0,j.useMemo)(()=>f.filter(e=>e.data.isSelected).map(e=>e.data),[f]),[Q,X]=(0,j.useState)(!1),[Z,Y]=(0,j.useState)({x:0,y:0}),$=(0,G.p)();(0,j.useLayoutEffect)(()=>{(async()=>{var e;if(!_)return;let n=null===(e=_.manifestMetadata.current)||void 0===e?void 0:e.project_name,t={view_mode:w.view_mode,packages:n?[n]:void 0,...l.viewOptions};C(t);let[i,r]=L(_,(await to({select:t.select,exclude:t.exclude,packages:t.packages,view_mode:t.view_mode})).nodes);A(i,r),g(i),b(r)})()},[_]);let ee=async e=>{if(e.width&&e.height){let n=e.position.x+e.width/2,t=e.position.y+e.height/2,i=a.getZoom();a.setCenter(n,t,{zoom:i,duration:200})}},en=iS();i_(c,async()=>{if("single"===K||"action_result"===K){let e=f.find(e=>e.data.isSelected);e?ee(e):a.fitView({nodes:f,duration:200})}});let et=(0,j.useCallback)(e=>{g(n=>n.map(n=>n.id===e.id?{...n,data:e}:n))},[g]),ei=async e=>{let n;if(!_)return;try{n=(await to({select:e.select,exclude:e.exclude,packages:e.packages,view_mode:e.view_mode})).nodes}catch(e){if(e instanceof ij.d7){var t,i;$({title:"Select node error",description:(null===(i=e.response)||void 0===i?void 0:null===(t=i.data)||void 0===t?void 0:t.detail)||e.message,status:"error",isClosable:!0,position:"bottom-right"})}return}let[r,l]=L(_,n);A(r,l),g(r),b(l),C(e),await new Promise(e=>setTimeout(e,1)),await (async()=>{a.fitView({nodes:r,duration:200})})()},er=ib(U,{onActionStarted:()=>{J("action_result")},onActionNodeUpdated:et,onActionCompleted:()=>{}});if(z)return(0,i.jsx)(o.k,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:(0,i.jsx)(tN.$,{size:"xl"})});let el=()=>{X(!1),Y({x:0,y:0})};if(R)return(0,i.jsx)(eQ.M,{h:"100%",children:(0,i.jsxs)(nn.g,{children:[(0,i.jsx)(r.xu,{children:"Failed to load lineage data. This could be because the server has been terminated or there is a network error."}),(0,i.jsxs)(r.xu,{children:["[Reason: ",R,"]"]}),(0,i.jsx)(ej.z,{colorScheme:"blue",onClick:()=>{S&&S()},children:"Retry"})]})});if("changed_models"===V&&!(null==_?void 0:null===(t=_.modifiedSet)||void 0===t?void 0:t.length))return(0,i.jsx)(eQ.M,{h:"100%",children:(0,i.jsxs)(nn.g,{children:[(0,i.jsx)(i.Fragment,{children:"No change detected"}),(0,i.jsx)(ej.z,{colorScheme:"blue",onClick:()=>{ei({...w,view_mode:"all"})},children:"Show all nodes"})]})});let es=()=>{J("single"),g(W(f)),I(),null==E||E()},eo={selectMode:K,nodes:f,viewOptions:w,onViewOptionsChanged:ei,selectNodeMulti:e=>{if("multi"!==K){if(!_)return;let[n,t]=N(Array.from(M(_,_.modifiedSet)),f,y);g(n=q(e,n=W(n,!0))),b(t),J("multi"),er.reset()}else g(F(e,f))},deselect:es,runRowCountDiff:async()=>{"multi"===K?await er.runRowCountDiff():B?await H("row_count_diff",{node_names:[B.name]},{showForm:!1,showLast:!1}):await H("row_count_diff",{select:w.select,exclude:w.exclude,packages:w.packages,view_mode:w.view_mode})},runValueDiff:async()=>{"multi"===K?await er.runValueDiff():B&&await H("value_diff",{model:B.name},{showForm:!0,showLast:!1})},addLineageDiffCheck:async()=>{let e;"multi"===K?(e=await er.addLineageDiffCheck(w.view_mode||"all"),es()):e=await ig(w),e&&en(e)},addSchemaDiffCheck:async()=>{let e;U.length>0?(e=await er.addSchemaDiffCheck(),es()):e=await t4({select:w.select,exclude:w.exclude,packages:w.packages,view_mode:w.view_mode}),e&&en(e)},cancel:er.cancel,actionState:er.actionState};return(0,i.jsxs)(tZ.Provider,{value:eo,children:[(0,i.jsxs)(tc,{sizes:B?[70,30]:[100,0],minSize:B?400:0,gutterSize:B?5:0,style:{height:"100%",width:"100%"},children:[(0,i.jsxs)(nn.g,{ref:c,divider:(0,i.jsx)(tq.c,{borderColor:"gray.200"}),spacing:0,style:{contain:"strict"},children:[l.interactive&&(0,i.jsx)(is,{}),(0,i.jsxs)(T.x$,{nodeTypes:ik,edgeTypes:iw,nodes:f,edges:y,onNodesChange:v,onEdgesChange:k,onNodeClick:(e,n)=>{if(!1!==l.interactive){if(el(),"single"===K)B||ee(n),g(q(n.id,f));else if("action_result"===K){var t,i,r,s;(null===(i=n.data.action)||void 0===i?void 0:null===(t=i.run)||void 0===t?void 0:t.run_id)&&D(null===(s=n.data.action)||void 0===s?void 0:null===(r=s.run)||void 0===r?void 0:r.run_id),ee(n),g(q(n.id,f))}else g(F(n.id,f))}},onNodeMouseEnter:(e,n)=>{if(!_||"single"!==K)return;let[t,i]=N(Array.from(function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];let i=new Set;return n.forEach(e=>{e.forEach(e=>{i.add(e)})}),i}(O(_,[n.id]),M(_,[n.id]))),f,y);g(t),b(i)},onNodeMouseLeave:(e,n)=>{if(!_)return;let[t,i]=N(Array.from(M(_,_.modifiedSet)),f,y);g(t),b(i)},onNodeContextMenu:(e,n)=>{"multi"===K&&(e.preventDefault(),Y({x:e.clientX,y:e.clientY,selectedNode:n}),X(!0))},onClick:el,maxZoom:1,minZoom:.1,fitView:!0,nodesDraggable:l.interactive,ref:p,children:[(0,i.jsx)(tF.A,{color:"#ccc"}),(0,i.jsx)(tP.Z,{showInteractive:!1,position:"top-right",className:ix,children:(0,i.jsx)(tP.B,{title:"copy image",onClick:async()=>{x()},children:(0,i.jsx)(s.J,{as:tK.C3L})})}),(0,i.jsx)(m,{}),(0,i.jsx)(T.s_,{position:"bottom-left",children:(0,i.jsx)(u.U,{children:(0,i.jsx)(iv,{})})}),(0,i.jsx)(T.s_,{position:"top-left",children:(0,i.jsx)(eZ.x,{fontSize:"xl",color:"grey",opacity:.5,children:f.length>0?"":"No nodes"})}),(0,i.jsx)(tW.a,{nodeColor:iC,nodeStrokeWidth:3,zoomable:!0,pannable:!0}),"action_result"===K&&(0,i.jsx)(T.s_,{position:"bottom-center",className:ix,children:(0,i.jsx)(t9,{onClose:()=>{es()}})})]})]}),"single"===K&&B?(0,i.jsx)(r.xu,{borderLeft:"solid 1px lightgray",height:"100%",children:(0,i.jsx)(t3,{node:B,onCloseNode:()=>{g(W(f))}})}):(0,i.jsx)(r.xu,{})]}),Q&&(0,i.jsx)(n_.v,{isOpen:!0,onClose:el,children:(0,i.jsxs)(nR.q,{style:{position:"absolute",left:"".concat(Z.x,"px"),top:"".concat(Z.y,"px")},children:[(0,i.jsx)(nE.s,{icon:(0,i.jsx)(t$.Cv2,{}),onClick:()=>{let e=Z.selectedNode;"multi"===K&&void 0!==e&&void 0!==_&&g(P([...O(_,[e.id])],f))},children:"Select parent nodes"}),(0,i.jsx)(nE.s,{icon:(0,i.jsx)(t$.IMj,{}),onClick:()=>{let e=Z.selectedNode;"multi"===K&&void 0!==e&&void 0!==_&&g(P([...M(_,[e.id])],f))},children:"Select child nodes"})]})})]})}),iR=(0,j.forwardRef)(function(e,n){let{check:t}=e,r={...t.params,...t.view_options};return(0,i.jsx)(o.k,{direction:"column",height:"100%",children:(0,i.jsx)(T.tV,{children:(0,i.jsx)(iz,{viewOptions:r,interactive:!1,ref:n})})})});var iT=t(19339);function iE(e){let{name:n,description:t,type:r,params:l,viewOptions:s}=e,o={name:n,description:t,type:r,params:l};s&&(o.view_options=s);let a=iT.ZP.stringify({checks:[o]});return(0,i.jsx)(tE.ML,{height:"300px",language:"yaml",theme:"vs",value:a,options:{readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})}let iD=e=>{var n;let[t,i]=(0,j.useState)(!1),[r,l]=(0,j.useState)(!1),[,s]=eu(),{error:o,data:a}=(0,b.a)({queryKey:H.run(e||""),queryFn:async()=>en(e||"",t?2:0),enabled:!!e,refetchInterval:!!t&&50,retry:!1});(0,j.useEffect)(()=>{(o||(null==a?void 0:a.result)||(null==a?void 0:a.error))&&(t&&i(!1),(null==a?void 0:a.type)==="row_count_diff"&&s()),(null==a?void 0:a.status)==="running"&&i(!0)},[a,o,t,s]);let c=(0,j.useCallback)(async()=>{if(l(!0),e)return await et(e)},[e,l]),d=(null==a?void 0:a.type)?null===(n=nA(a.type))||void 0===n?void 0:n.RunResultView:void 0;return{run:a,isRunning:t,aborting:r,error:o,onCancel:c,RunResultView:d}};function iI(){let e=(0,G.p)();return{markedAsCheckedToast:function(){e({title:"Marked as checked",position:"bottom-right",status:"success",containerStyle:{fontSize:"sm"},duration:2e3})}}}function iO(){let e=(0,nH._)(["\n  <details><summary>","</summary>\n\n  ","\n\n  </details>"]);return iO=function(){return e},e}let iM=e=>{var n,t,l,a,d,f,g;let{checkId:v}=e,y=(0,k.NL)(),[,w]=(0,ek.TH)(),{successToast:C,failToast:_}=t_(),{markedAsCheckedToast:S}=iI(),[z,R]=(0,j.useState)(),[T,E]=(0,j.useState)(),[D,I]=(0,j.useState)(!1),{isOpen:O,onOpen:M,onClose:L}=(0,eb.q)(),A=()=>(0,i.jsx)(ex.Z,{bg:"blackAlpha.300",backdropFilter:"blur(10px) "}),[N,q]=(0,j.useState)((0,i.jsx)(A,{})),{isLoading:F,error:P,data:W}=(0,b.a)({queryKey:H.check(v),queryFn:async()=>nB(v),refetchOnMount:!0}),V=z||(null==W?void 0:null===(n=W.last_run)||void 0===n?void 0:n.run_id),{run:K,error:J}=iD(V),B=z?!K||"running"===K.status:(null==K?void 0:K.status)==="running",U=(null==W?void 0:W.type)?nA(null==W?void 0:W.type):void 0,Q=(null==W?void 0:W.is_preset)||!1,X=(0,j.useRef)(null),{mutate:Z}=(0,te.D)({mutationFn:e=>nU(v,e),onSuccess:()=>{y.invalidateQueries({queryKey:H.check(v)}),y.invalidateQueries({queryKey:H.checks()})}}),{mutate:G}=(0,te.D)({mutationFn:()=>nQ(v),onSuccess:()=>{y.invalidateQueries({queryKey:H.checks()}),w("/checks")}}),Y=(0,j.useCallback)(async()=>{(null==W?void 0:W.type)&&R((await ei(v,{nowait:!0})).run_id)},[W,v,R]),$=(0,j.useCallback)(async()=>{if(I(!0),V)return await et(V)},[V]),ee=async()=>{if(!W)return;let e=(0,tC.RI)(iO(),tz(W),function(e){if("query"===e.type||"query_diff"===e.type){var n;return"".concat(tR(e),"\n\n").concat((0,tC.Pn)(tS(),null===(n=e.params)||void 0===n?void 0:n.sql_template))}return tR(e)}(W));if(!navigator.clipboard){_("Failed to copy the check to clipboard",Error("Copy to clipboard is available only in secure contexts (HTTPS)"));return}try{await navigator.clipboard.writeText(e),C("Copied the check to the clipboard")}catch(e){_("Failed to copy the check to clipboard",e)}},en=(0,j.useCallback)(()=>{let e=null==W?void 0:W.is_checked;Z({is_checked:!e}),!0==!e&&S()},[null==W?void 0:W.is_checked,Z,S]),{ref:er,onCopyToClipboard:el,onMouseEnter:es,onMouseLeave:eo}=ip();if(F)return(0,i.jsx)(eQ.M,{h:"100%",children:"Loading"});if(P)return(0,i.jsxs)(eQ.M,{h:"100%",children:["Error: ",P.message]});let ea=(null==K?void 0:K.run_at)?(0,tA.Q)(new Date(K.run_at),{addSuffix:!0}):null;return(0,i.jsxs)(td,{minSize:100,sizes:[30,70],style:{height:"100%",width:"100%",maxHeight:"100%"},children:[(0,i.jsxs)(r.xu,{style:{contain:"strict"},display:"flex",flexDirection:"column",overflow:"auto",children:[(0,i.jsxs)(o.k,{p:"0px 16px",alignItems:"center",children:[(0,i.jsx)(n7,{name:(null==W?void 0:W.name)||"",setName:e=>{Z({name:e})}}),(0,i.jsx)(h.L,{}),Q&&(0,i.jsx)(nx.u,{label:"Preset Check defined in recce config",children:(0,i.jsxs)(nZ.Vp,{size:"sm",children:[(0,i.jsx)(nZ.AD,{boxSize:"14px",as:n4.bX4}),"Preset"]})}),(0,i.jsxs)(n_.v,{children:[(0,i.jsx)(nS.j,{isRound:!0,as:nz.h,icon:(0,i.jsx)(s.J,{as:e$.D_A}),variant:"ghost"}),(0,i.jsxs)(nR.q,{children:[(0,i.jsx)(nE.s,{icon:(0,i.jsx)(n3.ovA,{}),onClick:()=>{q((0,i.jsx)(A,{})),M()},children:"Get Preset Check Template"}),(0,i.jsx)(nE.s,{icon:(0,i.jsx)(n0.p,{}),onClick:()=>G(),children:"Delete"})]})]}),ea&&(0,i.jsx)(r.xu,{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontSize:"10pt",children:ea}),(null==U?void 0:U.RunResultView)&&(0,i.jsx)(nx.u,{label:"Rerun",children:(0,i.jsx)(nz.h,{isRound:!0,isLoading:B,variant:"ghost","aria-label":"Rerun",icon:(0,i.jsx)(n1.n,{}),onClick:()=>Y()})}),(0,i.jsx)(nx.u,{label:"Copy markdown",children:(0,i.jsx)(nz.h,{isRound:!0,variant:"ghost","aria-label":"Copy markdown",icon:(0,i.jsx)(n2.T,{}),onClick:()=>ee()})}),(0,i.jsx)(nx.u,{label:(null==W?void 0:W.is_checked)?"Mark as pending":"Mark as approved",placement:"bottom-end",children:(0,i.jsx)(ej.z,{size:"sm",colorScheme:(null==W?void 0:W.is_checked)?"green":"gray",variant:(null==W?void 0:W.is_checked)?"solid":"outline",leftIcon:(0,i.jsx)(n5.r,{color:(null==W?void 0:W.is_checked)?"inherit":"green"}),onClick:()=>en(),children:(null==W?void 0:W.is_checked)?"Checked":"Mark as Checked"})})]}),(0,i.jsx)(r.xu,{flex:"1",p:"8px 16px",minHeight:"100px",children:(0,i.jsx)(tw,{value:null==W?void 0:W.description,onChange:e=>{Z({description:e})}},null==W?void 0:W.check_id)})]}),(0,i.jsx)(r.xu,{style:{contain:"strict"},children:(0,i.jsxs)(x.m,{height:"100%",display:"flex",flexDirection:"column",children:[(0,i.jsxs)(m.t,{height:"50px",children:[(0,i.jsx)(p.O,{fontSize:"10pt",children:"Result"}),((null==W?void 0:W.type)==="query"||(null==W?void 0:W.type)==="query_diff")&&(0,i.jsx)(p.O,{fontSize:"10pt",children:"Query"}),(0,i.jsx)(h.L,{}),(0,i.jsx)(u.U,{mr:"10px",children:(0,i.jsx)(ej.z,{leftIcon:(0,i.jsx)(n2.T,{}),variant:"outline",isDisabled:"schema_diff"!==(g=null!==(f=null==W?void 0:W.type)&&void 0!==f?f:"")&&"lineage_diff"!==g&&(!(null==K?void 0:K.result)||!!(null==K?void 0:K.error)),onMouseEnter:es,onMouseLeave:eo,size:"sm",onClick:()=>{if((null==W?void 0:W.type)==="lineage_diff"){var e;null===(e=X.current)||void 0===e||e.copyToClipboard()}else el()},children:"Copy to Clipboard"})})]}),(0,i.jsxs)(nG.n,{height:"100%",flex:"1",style:{contain:"strict"},children:[(0,i.jsxs)(nY.x,{p:0,width:"100%",height:"100%",children:[(null==U?void 0:U.RunResultView)&&((null==W?void 0:W.last_run)||V?(0,i.jsx)(tL,{ref:er,isRunning:B,isAborting:D,run:V?K:null==W?void 0:W.last_run,error:J,progress:T,RunResultView:U.RunResultView,viewOptions:null==W?void 0:W.view_options,onViewOptionsChanged:e=>{Z({view_options:e})},onCancel:$,onExecuteRun:Y}):(0,i.jsx)(eQ.M,{bg:"rgb(249,249,249)",height:"100%",children:(0,i.jsx)(ej.z,{onClick:Y,colorScheme:"blue",size:"sm",children:"Run Query"})})),W&&"schema_diff"===W.type&&(0,i.jsx)(tb,{check:W,ref:er}),W&&"lineage_diff"===W.type&&(0,i.jsx)(iR,{check:W,ref:X})]}),((null==W?void 0:W.type)==="query"||(null==W?void 0:W.type)==="query_diff"||(null==W?void 0:W.type)==="query_base")&&(0,i.jsx)(nY.x,{p:0,height:"100%",width:"100%",children:(null===(t=W.params)||void 0===t?void 0:t.base_sql_template)?(0,i.jsx)(tI,{value:(null==W?void 0:null===(l=W.params)||void 0===l?void 0:l.sql_template)||"",baseValue:(null==W?void 0:null===(a=W.params)||void 0===a?void 0:a.base_sql_template)||"",options:{readOnly:!0}}):(0,i.jsx)(tD,{value:(null==W?void 0:null===(d=W.params)||void 0===d?void 0:d.sql_template)||"",options:{readOnly:!0}})})]})]})}),(0,i.jsxs)(eh.u_,{isOpen:O,onClose:L,isCentered:!0,size:"6xl",children:[N,(0,i.jsxs)(em.h,{overflowY:"auto",height:"40%",width:"60%",children:[(0,i.jsx)(ep.x,{children:"Preset Check Template"}),(0,i.jsx)(ef.o,{}),(0,i.jsxs)(eg.f,{children:[(0,i.jsx)(c.X,{size:"sm",fontWeight:"bold",children:(0,i.jsx)(n$.y$,{query:"recce.yml",styles:{px:"1",py:"0",bg:"red.100"},children:"Please copy the following template and paste it into the recce.yml file."})}),(0,i.jsx)("br",{}),(0,i.jsx)(iE,{name:(null==W?void 0:W.name)||"",description:(null==W?void 0:W.description)||"",type:(null==W?void 0:W.type)||"",params:null==W?void 0:W.params,viewOptions:null==W?void 0:W.view_options})]})]})]})]})};var iL=t(53924);let iA=e=>{var n;let{check:t,selected:l,onSelect:a,onMarkAsChecked:c}=e,d=(0,k.NL)(),u=t.check_id,{mutate:h}=(0,te.D)({mutationFn:e=>nU(u,e),onSuccess:()=>{d.invalidateQueries({queryKey:H.check(u)}),d.invalidateQueries({queryKey:H.checks()})}}),x=(null===(n=nA(t.type))||void 0===n?void 0:n.icon)||ew.WzH;return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(o.k,{width:"100%",p:"10px 20px",cursor:"pointer",_hover:{bg:"Cornsilk"},bg:l?"Floralwhite":"inherit",borderBlockEndWidth:"1px",borderLeftWidth:"3px",borderLeftColor:l?"orange":"transparent",onClick:()=>a(t.check_id),alignItems:"center",gap:"5px",children:[(0,i.jsx)(s.J,{as:x}),(0,i.jsx)(r.xu,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",children:t.name}),(0,i.jsx)(nx.u,{label:"Click to mark as checked",placement:"top",hasArrow:!0,children:(0,i.jsx)(o.k,{children:(0,i.jsx)(nt.X,{isChecked:t.is_checked,variant:"circular",colorScheme:"green",size:"xs",onChange:e=>{let n=e.target.checked;!1===n?h({is_checked:n}):c()}})})})]})})},iN=e=>{let{checks:n,selectedItem:t,onCheckSelected:l,onChecksReordered:s}=e,[a,c]=(0,j.useState)(!1),d=(0,k.NL)(),{mutate:u}=(0,te.D)({mutationFn:e=>nU(e,{is_checked:!0}),onSuccess:(e,n)=>{d.invalidateQueries({queryKey:H.check(n)}),d.invalidateQueries({queryKey:H.checks()})}}),{isOpen:h,onOpen:x,onClose:m}=(0,eb.q)(),{markedAsCheckedToast:p}=iI(),f=()=>{"true"===localStorage.getItem("bypassMarkAsCheckedWarning")?(u(t),p()):x()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(iL.Z5,{onDragEnd:e=>{e.destination&&s(e.source.index,e.destination.index)},children:(0,i.jsx)(iL.bK,{droppableId:"checklist",children:e=>(0,i.jsxs)(nn.g,{...e.droppableProps,ref:e.innerRef,w:"full",spacing:"0",flex:"1",overflow:"auto",children:[n.map((e,n)=>(0,i.jsx)(iL._l,{draggableId:e.check_id,index:n,children:(n,r)=>{if(r.isDragging){let e=n.draggableProps,t={x:0,y:80},i=e.style.left-t.x,r=e.style.top-t.y;e.style.left=i,e.style.top=r}return(0,i.jsx)(o.k,{ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,w:"full",children:(0,i.jsx)(iA,{check:e,selected:e.check_id===t,onSelect:l,onMarkAsChecked:f},e.check_id)})}},e.check_id)),e.placeholder]})})}),(0,i.jsxs)(eh.u_,{isOpen:h,onClose:m,isCentered:!0,children:[(0,i.jsx)(ex.Z,{}),(0,i.jsxs)(em.h,{width:"400px",children:[(0,i.jsx)(ep.x,{children:"Mark as checked?"}),(0,i.jsx)(ef.o,{}),(0,i.jsx)(nm.i,{}),(0,i.jsxs)(r.xu,{p:"16px",fontSize:"sm",gap:"16px",children:[(0,i.jsx)("p",{children:"Marking an item which's contents your haven't seen could result in unwanted results being passwd on as ok."}),(0,i.jsx)(nt.X,{isChecked:a,onChange:e=>c(e.target.checked),fontWeight:"bold",size:"sm",pt:"8px",children:"Don't show this again"})]}),(0,i.jsx)(nm.i,{}),(0,i.jsxs)(ev.m,{children:[(0,i.jsx)(ej.z,{variant:"outline",size:"xs",mr:2,onClick:m,children:"Cancel"}),(0,i.jsx)(ej.z,{colorScheme:"blue",size:"xs",onClick:()=>{u(t),!0===a&&localStorage.setItem("bypassMarkAsCheckedWarning","true"),m()},children:"Mark as checked"})]})]})]})]})};function iq(){let e=(0,nH._)(["\n    <details><summary>","</summary>\n\n    ","\n\n    </details>"]);return iq=function(){return e},e}let iF=()=>{let[,e]=(0,ek.TH)(),[,n]=(0,ek.yj)("/checks/:checkId"),t=(0,k.NL)(),{successToast:l,failToast:s}=t_(),o=null==n?void 0:n.checkId,{isLoading:a,error:c,data:d,status:u}=(0,b.a)({queryKey:H.checks(),queryFn:nJ,refetchOnMount:!0}),h=(0,j.useCallback)(n=>{e("/checks/".concat(n))},[e]),[x,m]=(0,j.useState)(d||[]),{mutate:p}=(0,te.D)({mutationFn:e=>nX(e),onSuccess:()=>{t.invalidateQueries({queryKey:H.checks()})}}),f=(0,j.useCallback)((e,n)=>{let t=[...x],[i]=t.splice(e,1);t.splice(n,0,i),p({source:e,destination:n}),m(t)},[x,m,p]);return((0,j.useCallback)(async()=>{let e=await nV();t.invalidateQueries({queryKey:H.checks()}),h(e.check_id)},[t,h]),(0,j.useEffect)(()=>{"success"===u&&(!o&&d.length>0&&e("/checks/".concat(d[0].check_id)),m(d))},[u,o,d,m,e]),a)?(0,i.jsx)(i.Fragment,{}):c?(0,i.jsxs)(i.Fragment,{children:["Error: ",c.message]}):(null==d?void 0:d.length)?(0,i.jsxs)(tc,{style:{height:"100%"},minSize:50,sizes:[20,80],children:[(0,i.jsx)(r.xu,{borderRight:"lightgray solid 1px",height:"100%",style:{contain:"size"},children:(0,i.jsxs)(nn.g,{spacing:0,align:"flex-end",h:"100%",style:{contain:"strict"},children:[(0,i.jsx)(nx.u,{label:"Copy checklist to the clipboard",children:(0,i.jsx)(nz.h,{mr:"10px",variant:"unstyled","aria-label":"Copy checklist to the clipboard",onClick:async()=>{let e=d.map(e=>(0,tC.RI)(iq(),tz(e),tR(e))).join("\n\n");if(!navigator.clipboard){s("Failed to copy checklist to clipboard",Error("Copy to clipboard is available only in secure contexts (HTTPS)"));return}try{await navigator.clipboard.writeText(e),l("Copied ".concat(d.length," checks to the clipboard"))}catch(e){s("Failed to copy checklist to clipboard",e)}},icon:(0,i.jsx)(n2.T,{})})}),(0,i.jsx)(nm.i,{}),(0,i.jsx)(iN,{checks:x,selectedItem:o,onCheckSelected:h,onChecksReordered:f})]})}),(0,i.jsx)(r.xu,{height:"100%",children:(0,i.jsx)(ek.rs,{children:(0,i.jsx)(ek.AW,{path:"/checks/:checkId",children:e=>(0,i.jsx)(iM,{checkId:e.checkId},e.checkId)})})})]}):(0,i.jsx)(eQ.M,{h:"100%",children:(0,i.jsx)(r.xu,{children:"No checks"})})};var iP=t(25356);async function iW(e,n){return await ee("query",e,n)}async function iH(e,n){return await ee("query_base",e,n)}async function iV(e,n){return await ee("query_diff",e,n)}var iK=t(67619),iJ=t(58565),iB=t(49468);let iU=e=>{var n;let{defaultValues:t,suggestionList:r,onValuesChange:l}=e,[s,o]=(0,j.useState)(t||[]),[a,c]=(0,j.useState)(""),[d,u]=(0,j.useState)(!1),h=(0,j.useRef)(null),x=e=>{s.includes(e)||(c(""),o([...s,e]),l([...s,e]))};return(0,i.jsxs)(iK.B,{size:e.size,width:e.width,children:[(0,i.jsxs)(n_.v,{isLazy:!0,closeOnSelect:!1,children:[(0,i.jsx)(nS.j,{width:"100%",children:(0,i.jsx)(nk.I,{placeholder:e.placeholder,size:e.size,borderRadius:"4px",value:s.length>1?"".concat(s.length," ").concat(e.unitName,"s selected"):1===s.length?"".concat(s[0]):""})}),(0,i.jsx)(tn.h,{children:(0,i.jsxs)(nR.q,{zIndex:"dropdown",fontSize:e.size,width:e.width,children:[(0,i.jsx)(nT.k,{children:(0,i.jsxs)(iJ.E,{border:"1px solid #e2e8f0",borderRadius:"4px",width:"calc(100% - 8px)",marginX:"4px",padding:"4px",children:[s.map((n,t)=>(0,i.jsx)(iJ.U,{children:(0,i.jsxs)(nZ.Vp,{size:e.size,children:[(0,i.jsx)(nZ.Sn,{paddingLeft:"8px",children:n}),(0,i.jsx)(nZ.SD,{paddingRight:"8px",onClick:()=>{o(s.filter(e=>e!==n)),l(s.filter(e=>e!==n))}})]},n)},"tag-".concat(t))),(0,i.jsx)(iJ.U,{width:"100%",children:(0,i.jsx)(nk.I,{ref:h,placeholder:"Filter keys or add custom",variant:"unstyled",size:e.size,value:a,onChange:e=>{c(e.target.value),u(!0)},onKeyDown:e=>{let n=e.currentTarget.value.trim().replace(",","");switch(e.key){case",":case"Enter":x(n),c("");break;case"Backspace":""===e.currentTarget.value&&s.length>0&&(o(s.slice(0,-1)),l(s.slice(0,-1)))}},onBlur:()=>{var e;h&&d&&(null==h||null===(e=h.current)||void 0===e||e.focus())}})})]})}),(0,i.jsx)(t1.R,{}),(0,i.jsxs)(nT.k,{children:[""!==a&&!(null==r?void 0:r.includes(a))&&(0,i.jsxs)(nE.s,{onClick:()=>{x(a),u(!1)},children:["Add '",a,"' to the list"]},"custom-value-by-filter"),null==r?void 0:null===(n=r.filter(e=>""===a||e.includes(a)).filter(e=>!s.includes(e)))||void 0===n?void 0:n.map((e,n)=>(0,i.jsx)(nE.s,{onClick:()=>x(e),children:e},"option-".concat(n)))]})]})})]}),(0,i.jsx)(iB.x,{children:(0,i.jsx)(ej.z,{variant:"link",color:"#3182CE",fontSize:e.size,paddingTop:"4px",paddingRight:"24px",hidden:0===s.length,onClick:()=>{c(""),o([]),l([])},children:"Clear"})})]})},iQ=e=>{let{defaultPrimaryKeys:n,onPrimaryKeysChange:t,...r}=e,{lineageGraph:l}=ed(),s=(0,j.useMemo)(()=>{if(!l)return[];let e=new Set;for(let i in l.nodes){var n,t;let r=l.nodes[i],s=null===(n=r.data.base)||void 0===n?void 0:n.columns,o=null===(t=r.data.current)||void 0===t?void 0:t.columns;for(let n in s)e.add(n);for(let n in o)e.add(n)}return Array.from(e).sort()},[l]);return(0,i.jsx)(o.k,{...r,children:(0,i.jsxs)(eC.NI,{m:"4px 8px",children:[(0,i.jsxs)(e_.l,{fontSize:"8pt",margin:"0",children:["Diff with Primary Key(s) (suggested)"," ",(0,i.jsx)(nx.u,{label:"Provide a primary key to perform query diff in data warehouse and only return changed rows.",children:(0,i.jsx)(tH.s,{color:"gray.600",boxSize:"3"})})]}),(0,i.jsx)(iU,{unitName:"key",defaultValues:n,suggestionList:s,onValuesChange:t,size:"xs",width:"240px",placeholder:"Start by typing key name..."})]})})},iX=()=>{let{isHistoryOpen:e,showHistory:n,closeHistory:t}=nP();return(0,i.jsxs)(r.xu,{children:[(0,i.jsx)(r.xu,{fontSize:"8pt",children:"History"}),(0,i.jsx)(ej.z,{leftIcon:(0,i.jsx)(s.J,{as:e$.M1Q}),size:"xs",variant:"outline",onClick:e?t:n,children:e?"Hide":"Show"})]})},iZ=()=>{let{isCustomQueries:e,setCustomQueries:n,sqlQuery:t,setBaseSqlQuery:l}=S();return(0,i.jsxs)(r.xu,{children:[(0,i.jsxs)(r.xu,{fontSize:"8pt",children:["Custom Queries ","",(0,i.jsx)(nx.u,{label:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,i.jsx)(tH.s,{color:"gray.600",boxSize:"3"})})]}),(0,i.jsx)(iP.r,{size:"sm",isChecked:e,onChange:()=>{!1===e&&l&&l(t),n(!e)}})]})},iG=()=>{let{sqlQuery:e,baseSqlQuery:n,setSqlQuery:t,setBaseSqlQuery:l,primaryKeys:s,setPrimaryKeys:a,isCustomQueries:c}=S(),{envInfo:d}=ed(),u=e;(null==d?void 0:d.adapterType)==="sqlmesh"&&e===w&&(u="select * from db.mymodel");let{showRunId:x}=nP(),m=async e=>{let t="query_base"===e?n||"":u,i=function(e){switch(e){case"query":return iW;case"query_base":return iH;case"query_diff":return iV;default:throw Error("Unknown query type: ".concat(e))}}(e),r={sql_template:t};"query_diff"===e&&(r.primary_keys=s,c&&(r.base_sql_template=n));let{run_id:l}=await i(r,{nowait:!0});return x(l),await en(l)},{mutate:p,isPending:f}=(0,te.D)({mutationFn:m});return(0,i.jsxs)(o.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(o.k,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,i.jsx)(iX,{}),(0,i.jsx)(iZ,{}),(0,i.jsx)(h.L,{}),(0,i.jsx)(iQ,{defaultPrimaryKeys:s,onPrimaryKeysChange:a}),(0,i.jsx)(ej.z,{colorScheme:"blue",onClick:()=>p("query_diff"),isDisabled:f,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})]}),(0,i.jsx)(r.xu,{width:"100%",flex:"1",children:c?(0,i.jsx)(tI,{value:u,baseValue:n,onChange:t,onChangeBase:l,onRun:()=>p("query"),onRunBase:()=>p("query_base"),onRunDiff:()=>p("query_diff")}):(0,i.jsx)(tD,{value:u,onChange:t,onRun:()=>p("query"),onRunDiff:()=>p("query_diff")})})]})};var iY=t(30148);let i$=e=>(0,iY.c4)("#!"+e),i0=()=>[(0,iY.LD)(()=>window.location.hash.replace(/^#!/,"")||"/",()=>"/ssr"),i$];var i1=t(24681),i2=t(62843);let i5=e=>{var n;let{runId:t}=e,{isPending:r,error:l,data:s}=(0,b.a)({queryKey:H.run(t),queryFn:async()=>en(t)}),o=(null==s?void 0:s.type)?null===(n=nA(s.type))||void 0===n?void 0:n.RunResultView:void 0;return(0,i.jsx)(tL,{isPending:r,error:l,run:s,RunResultView:o})},i4=e=>{let{error:n,resetError:t}=e;return(0,i.jsx)(eQ.M,{height:"100%",backgroundColor:"gray.50",children:(0,i.jsxs)(o.k,{p:4,direction:"column",justifyContent:"flex-start",backgroundColor:"white",border:"solid lightgray 1px",minHeight:"200px",children:[(0,i.jsx)(c.X,{width:"800px",size:"md",children:"You have encountered an error"}),(0,i.jsx)(r.xu,{flex:"1",fontSize:"10pt",children:n.toString()}),(0,i.jsx)(ej.z,{justifySelf:"center",alignSelf:"center",mt:"20px",colorScheme:"blue",size:"sm",onClick:()=>{t()},children:"Reset"})]})})},i3=e=>{let{children:n}=e;return(0,i.jsx)(tM.SV,{fallback:i4,children:n})};async function i9(){return(await U.post("/api/export")).data}async function i6(e,n){let t=new FormData;return t.append("file",e),t.append("checks_only",(!!n).toString()),(await U.post("/api/import",t)).data}async function i8(){return 208===(await U.get("/api/sync")).status}async function i7(e){try{let n=await U.post("/api/sync",e);if(202===n.status)return{status:"accepted"};if(208===n.status)return{status:"syncing"}}catch(e){if((0,ij.IZ)(e)&&e.response&&409===e.response.status)return{status:"conflict"}}throw Error("Failed to sync state")}var re=t(16021);function rn(){let e=(0,G.p)(),n=async()=>{try{let e=await i9(),n=JSON.stringify(e,null,2),t=new Blob([n],{type:"application/json"}),i=new Date,r="recce-state-".concat((0,id.WU)(i,"yyyy-MM-dd-HH-mm-ss"),".json");ih()(t,r)}catch(n){console.error("Export failed",n),e({title:"Export failed",description:"".concat(n),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}};return(0,i.jsx)(nx.u,{label:"Export",children:(0,i.jsx)(nz.h,{pt:"6px",variant:"unstyled","aria-label":"Export state",onClick:n,icon:(0,i.jsx)(s.J,{as:re.tRY,boxSize:"1.2em"})})})}var rt=t(65475);function ri(e){let{checksOnly:n}=e,t=(0,G.p)(),r=(0,k.NL)(),l=(0,j.useRef)(null),a=(0,j.useRef)(null),[c,d]=(0,j.useState)(null),{isOpen:u,onOpen:h,onClose:x}=(0,eb.q)(),[m,p]=(0,ek.TH)(),[,f]=eu(),g=(0,j.useCallback)(async()=>{if(c){try{let{runs:e,checks:i}=await i6(c,n);f(),await r.invalidateQueries({queryKey:H.checks()}),await r.invalidateQueries({queryKey:H.runs()}),m.includes("/checks")&&p("/checks");let l=n?"".concat(i," checks imported successfully"):"".concat(e," runs and ").concat(i," checks imported successfully");t({description:l,status:"info",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}catch(e){console.error("Import failed",e),t({title:"Import failed",description:"".concat(e),status:"error",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0})}x()}},[r,c,t,x,m,p,f,n]),v=n?"checks":"runs and checks";return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nx.u,{label:"Import",children:(0,i.jsx)(nz.h,{pt:"6px",variant:"unstyled","aria-label":"Import state",onClick:()=>{l.current&&l.current.click()},icon:(0,i.jsx)(s.J,{as:re.wQf,boxSize:"1.2em"})})}),(0,i.jsx)("input",{type:"file",style:{display:"none"},ref:l,onChange:e=>{var n;(null===(n=e.target.files)||void 0===n?void 0:n.length)===1&&(d(e.target.files[0]),h()),l.current&&(l.current.value="")}}),(0,i.jsx)(rt.a,{isOpen:u,leastDestructiveRef:a,onClose:x,size:"xl",children:(0,i.jsx)(ex.Z,{children:(0,i.jsxs)(rt._,{children:[(0,i.jsx)(ep.x,{fontSize:"lg",fontWeight:"bold",children:"Import state"}),(0,i.jsx)(eg.f,{children:(0,i.jsxs)(o.k,{px:"5px",gap:"5px",rounded:"md",direction:"column",children:[(0,i.jsxs)(o.k,{alignItems:"center",gap:"5px",children:[(0,i.jsx)(tH.s,{color:"red.600"}),(0,i.jsx)(eZ.x,{as:"span",fontWeight:"500",color:"red.600",children:"Caution!"})]}),(0,i.jsx)(o.k,{children:(0,i.jsxs)(eZ.x,{children:["The current ",v," will be"," ",(0,i.jsx)(eZ.x,{as:"span",fontWeight:"600",children:"merged"})," ","with the imported state"]})})]})}),(0,i.jsxs)(ev.m,{children:[(0,i.jsx)(ej.z,{ref:a,onClick:x,children:"Cancel"}),(0,i.jsx)(ej.z,{colorScheme:"blue",onClick:g,ml:"5px",children:"Import"})]})]})})})]})}t(97770);var rr=t(93126),rl=t(1026),rs=t(13154),ro=t(99434),ra=t(20143),rc=t(89830),rd=t(13276),ru=t(31610);function rh(e){let n=(0,ru.D)(e);return(0,id.WU)(n,"yyyy-MM-dd'T'HH:mm:ss")}function rx(e){return Object.values(e).every(e=>null===e)?[(0,i.jsx)(o.k,{ml:"10px",children:"No information"},"no info")]:Object.entries(e).filter(e=>{let[n,t]=e;return"url"!==n&&null!=t}).map(e=>{let[n,t]=e;return(0,i.jsxs)(tu.HC,{ml:"10px",children:[n,": ",t]},n)})}function rm(){var e,n,t,r,a,d;let{envInfo:u,reviewMode:h,lineageGraph:x}=ed(),{isOpen:m,onOpen:p,onClose:f}=(0,eb.q)(),g=null==u?void 0:u.git,v=null==u?void 0:u.pullRequest,j={...g,...v},y=null==u?void 0:null===(e=u.dbt)||void 0===e?void 0:e.base,b=null==u?void 0:null===(n=u.dbt)||void 0===n?void 0:n.current,k=(null==y?void 0:y.generated_at)?rh(null==y?void 0:y.generated_at):"",w=(null==b?void 0:b.generated_at)?rh(null==b?void 0:b.generated_at):"",C=new Set,_=new Set;if(null==x?void 0:x.nodes)for(let e of Object.values(null==x?void 0:x.nodes))(null===(a=e.data.base)||void 0===a?void 0:a.schema)&&C.add(e.data.base.schema),(null===(d=e.data.current)||void 0===d?void 0:d.schema)&&_.add(e.data.current.schema);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nx.u,{label:"Environment Info",children:(0,i.jsx)(nz.h,{pt:"6px",variant:"unstyled","aria-label":"Export state",onClick:p,icon:(0,i.jsx)(s.J,{as:n3.lS4,boxSize:"1.5em",color:"gray.500"})})}),(0,i.jsxs)(eh.u_,{isOpen:m,onClose:f,size:"3xl",children:[(0,i.jsx)(ex.Z,{}),(0,i.jsxs)(em.h,{children:[(0,i.jsx)(ep.x,{children:"Environment Information"}),(0,i.jsx)(ef.o,{}),(0,i.jsx)(eg.f,{children:(0,i.jsxs)(o.k,{direction:"column",gap:"5px",children:[h?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(o.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(c.X,{size:"sm",children:"Review Information"}),(0,i.jsxs)(tu.QI,{spacing:1,children:[(null==j?void 0:j.url)&&(0,i.jsxs)(tu.HC,{ml:"10px",children:["url:"," ",(0,i.jsx)(l.r,{href:j.url,color:"blue.500",isExternal:!0,children:j.url})]}),j&&rx(j)]})]})}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(o.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(c.X,{size:"sm",children:"Dev Information"}),(0,i.jsx)(tu.QI,{spacing:1,children:g&&rx(g)})]})}),(0,i.jsx)(nm.i,{}),(null==u?void 0:u.adapterType)==="dbt"&&(0,i.jsxs)(o.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(c.X,{size:"sm",children:"DBT"}),(0,i.jsx)(rr.x,{children:(0,i.jsxs)(rl.i,{variant:"simple",children:[(0,i.jsx)(rs.h,{children:(0,i.jsxs)(ro.Tr,{children:[(0,i.jsx)(ra.Th,{}),(0,i.jsx)(ra.Th,{children:"base"}),(0,i.jsx)(ra.Th,{children:"current"})]})}),(0,i.jsxs)(rc.p,{children:[(0,i.jsxs)(ro.Tr,{children:[(0,i.jsx)(rd.Td,{children:"schema"}),(0,i.jsx)(rd.Td,{children:JSON.stringify(Array.from(C))}),(0,i.jsx)(rd.Td,{children:JSON.stringify(Array.from(_))})]}),(0,i.jsxs)(ro.Tr,{children:[(0,i.jsx)(rd.Td,{children:"version"}),(0,i.jsx)(rd.Td,{children:null==y?void 0:y.dbt_version}),(0,i.jsx)(rd.Td,{children:null==b?void 0:b.dbt_version})]}),(0,i.jsxs)(ro.Tr,{children:[(0,i.jsx)(rd.Td,{children:"timestamp"}),(0,i.jsx)(rd.Td,{children:k}),(0,i.jsx)(rd.Td,{children:w})]})]})]})})]}),(null==u?void 0:u.adapterType)==="sqlmesh"&&(0,i.jsxs)(o.k,{justifyContent:"left",gap:"5px",direction:"column",children:[(0,i.jsx)(c.X,{size:"sm",children:"SQLMesh"}),(0,i.jsx)(rr.x,{children:(0,i.jsxs)(rl.i,{variant:"simple",children:[(0,i.jsx)(rs.h,{children:(0,i.jsxs)(ro.Tr,{children:[(0,i.jsx)(ra.Th,{}),(0,i.jsx)(ra.Th,{children:"base"}),(0,i.jsx)(ra.Th,{children:"current"})]})}),(0,i.jsx)(rc.p,{children:(0,i.jsxs)(ro.Tr,{children:[(0,i.jsx)(rd.Td,{children:"Environment"}),(0,i.jsx)(rd.Td,{children:null==u?void 0:null===(t=u.sqlmesh)||void 0===t?void 0:t.base_env}),(0,i.jsx)(rd.Td,{children:null==u?void 0:null===(r=u.sqlmesh)||void 0===r?void 0:r.current_env})]})})]})})]})]})}),(0,i.jsx)(ev.m,{children:(0,i.jsx)(ej.z,{colorScheme:"blue",mr:3,onClick:f,children:"Close"})})]})]})]})}var rp=t(21166),rf=t(43399),rg=t(60057);function rv(){return(0,i.jsx)(nx.u,{label:"Syncing",children:(0,i.jsx)(ej.z,{pt:"6px",variant:"unstyled",boxSize:"1.2em",children:(0,i.jsx)(tN.$,{})})})}function rj(){let[e,n]=(0,j.useState)(!1),t=(0,k.NL)(),[l,o]=(0,ek.TH)(),{isOpen:a,onOpen:c,onClose:d}=(0,eb.q)(),[u,h]=(0,j.useState)(""),x=(0,G.p)(),m=(0,j.useCallback)(async e=>{if(d(),n(!0),"conflict"===(await i7(e)).status){c(),n(!1);return}for(;await i8();)await new Promise(e=>setTimeout(e,1e3));x({description:"Sync Completed",status:"success",variant:"left-accent",position:"bottom",duration:5e3,isClosable:!0}),n(!1),h(""),t.invalidateQueries({queryKey:H.lineage()}),t.invalidateQueries({queryKey:H.checks()}),t.invalidateQueries({queryKey:H.runs()}),/^\/checks\/([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/.test(l)&&o("/checks")},[t,l,o,x,c,d]);return e?(0,i.jsx)(rv,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(nx.u,{label:"Sync with Cloud",children:(0,i.jsx)(nz.h,{pt:"6px",variant:"unstyled","aria-label":"Sync state",onClick:()=>m({}),icon:(0,i.jsx)(s.J,{as:re.jq8,boxSize:"1.2em"})})}),(0,i.jsxs)(eh.u_,{isOpen:a,onClose:d,children:[(0,i.jsx)(ex.Z,{}),(0,i.jsxs)(em.h,{children:[(0,i.jsx)(ep.x,{fontSize:"lg",fontWeight:"bold",children:"Sync with Cloud"}),(0,i.jsxs)(eg.f,{children:[(0,i.jsx)(r.xu,{children:"New changes have been detected in the cloud. Please choose a method to sync your state"}),(0,i.jsx)(r.xu,{mt:"5px",children:(0,i.jsx)(rp.E,{onChange:h,value:u,children:(0,i.jsxs)(tT.K,{direction:"column",children:[(0,i.jsxs)(rf.Y,{value:"merge",children:["Merge",(0,i.jsx)(nx.u,{label:"This will merge the local and remote states.",children:(0,i.jsx)("span",{children:(0,i.jsx)(s.J,{as:rg.h,ml:2,cursor:"pointer"})})})]}),(0,i.jsxs)(rf.Y,{value:"overwrite",children:["Overwrite",(0,i.jsx)(nx.u,{label:"This will overwrite the remote state file with the local state.",children:(0,i.jsx)("span",{children:(0,i.jsx)(s.J,{as:rg.h,ml:2,cursor:"pointer"})})})]}),(0,i.jsxs)(rf.Y,{value:"revert",children:["Revert",(0,i.jsx)(nx.u,{label:"This will discard local changes and revert to the cloud state.",children:(0,i.jsx)("span",{children:(0,i.jsx)(s.J,{as:rg.h,ml:2,cursor:"pointer"})})})]})]})})})]}),(0,i.jsxs)(ev.m,{children:[(0,i.jsx)(ej.z,{onClick:d,mr:3,children:"Cancel"}),(0,i.jsx)(ej.z,{colorScheme:"blue",onClick:()=>m({method:u}),isDisabled:!u,children:"Sync"})]})]})]})]})}function ry(){return(0,i.jsx)(T.tV,{children:(0,i.jsx)(iz,{viewMode:"changed_models",interactive:!0})})}async function rb(){return(await U.get("/api/flag")).data}async function rk(){try{await U.post("/api/onboarding/completed")}catch(e){}}var rw=()=>{let[e,n]=(0,j.useState)(!1);(0,j.useEffect)(()=>{rb().then(e=>{let t=e.show_onboarding_guide;!localStorage.getItem("hasVisited")&&t&&(n(!0),localStorage.setItem("hasVisited","true"))})},[]);let t=()=>{n(!1),rk()};return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(eh.u_,{isOpen:e,onClose:t,scrollBehavior:"inside",children:[(0,i.jsx)(ex.Z,{}),(0,i.jsxs)(em.h,{maxW:"80vw",h:"80vh",children:[(0,i.jsx)(ep.x,{children:"Welcome to Recce: 3 Steps to Begin"}),(0,i.jsx)(ef.o,{}),(0,i.jsx)(eg.f,{children:(0,i.jsxs)(tT.K,{spacing:4,children:[(0,i.jsxs)(tu.aV,{spacing:2,children:[(0,i.jsx)(tu.HC,{children:"Step 1: Click the model you want to check"}),(0,i.jsx)(tu.HC,{children:'Step 2: Click "Explore Change"'}),(0,i.jsx)(tu.HC,{children:'Step 3: Click "Add to Checklist"'})]}),(0,i.jsx)(nm.i,{}),(0,i.jsx)(a.E,{src:"https://datarecce.io/assets/images/onboarding/material.svg",alt:"placeholder"})]})}),(0,i.jsx)(ev.m,{children:(0,i.jsx)(ej.z,{colorScheme:"blue",onClick:t,children:"Got it!"})})]})]})})},rC=t(1873);let r_=e=>{let{run:n}=e,t=(null==n?void 0:n.status)==="running",r=null==n?void 0:n.status;!r&&(n.result?r="finished":n.error&&(r="failed"));let l="",s="";"successful"===r||"finished"===r?(l="green",s="Finished"):"failed"===r?(l="red",s="Failed"):"cancelled"===r?(l="gray",s="Cancelled"):"running"===r?(l="blue",s="Running"):(l="green",s="Finished");let a=(null==n?void 0:n.run_at)?function(e){let n=new Date,t=new Date;return(t.setDate(n.getDate()-1),null==e)?null:n.toDateString()===e.toDateString()?"Today, "+(0,id.WU)(e,"HH:mm"):t.toDateString()===e.toDateString()?"Yesterday, "+(0,id.WU)(e,"HH:mm"):(0,id.WU)(e,"MMM d, HH:mm")}(new Date(n.run_at)):null;return(0,i.jsxs)(o.k,{justifyContent:"start",fontSize:"11pt",color:"gray.500",gap:"3px",alignItems:"center",overflow:"hidden",children:[t&&(0,i.jsx)(tN.$,{size:"xs",color:"".concat(l,".400")}),(0,i.jsx)(eZ.x,{fontWeight:500,color:"".concat(l,".400"),children:s}),(0,i.jsx)(eZ.x,{children:""}),(0,i.jsx)(eZ.x,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:a})]})},rS=e=>{let n=iT.ZP.stringify(e,null,2);return(0,i.jsx)(tE.ML,{height:"100%",language:"yaml",theme:"vs",value:n,options:{readOnly:!0,fontSize:14,lineNumbers:"off",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same",scrollBeyondLastLine:!1}})},rz=e=>{var n,t,r;let{runId:l,onClose:s}=e,{runAction:a}=nP(),{error:c,run:d,onCancel:f,isRunning:g}=iD(l),[v,y]=(0,j.useState)(),b=(0,k.NL)(),[,w]=(0,ek.TH)(),[C,_]=(0,j.useState)(0),S=(null==d?void 0:d.type)?null===(n=nA(d.type))||void 0===n?void 0:n.RunResultView:void 0,z=(0,j.useCallback)(()=>{a((null==d?void 0:d.type)||"",null==d?void 0:d.params)},[d,a]),R=null==d?void 0:d.check_id,T=(0,j.useCallback)(async()=>{R&&w("/checks/".concat(R))},[R,w]),E=(0,j.useCallback)(async()=>{if(!l)return;let e=await nK(l,v);b.invalidateQueries({queryKey:H.checks()}),w("/checks/".concat(e.check_id))},[l,w,b,v]),D=(null==d?void 0:d.type)==="query"||(null==d?void 0:d.type)==="query_diff"||(null==d?void 0:d.type)==="query_base",{ref:I,onCopyToClipboard:O,onMouseEnter:M,onMouseLeave:L}=ip();return(0,i.jsxs)(o.k,{direction:"column",children:[(0,i.jsx)(x.m,{tabIndex:C,onChange:_,flexDirection:"column",mb:"1px",children:(0,i.jsxs)(m.t,{height:"50px",children:[(0,i.jsx)(p.O,{children:"Result"}),(0,i.jsx)(p.O,{children:"Params"}),D&&(0,i.jsx)(p.O,{children:"Query"}),(0,i.jsx)(h.L,{}),(0,i.jsxs)(u.U,{overflow:"hidden",children:[d&&(0,i.jsx)(r_,{run:d}),(0,i.jsx)(ej.z,{leftIcon:(0,i.jsx)(n1.n,{}),variant:"outline",isDisabled:!l||g,size:"sm",onClick:z,children:"Rerun"}),(0,i.jsx)(ej.z,{leftIcon:(0,i.jsx)(n2.T,{}),variant:"outline",isDisabled:!l||!(null==d?void 0:d.result)||!!c,onMouseEnter:M,onMouseLeave:L,size:"sm",onClick:O,children:"Copy to Clipboard"}),(null==d?void 0:d.check_id)?(0,i.jsx)(ej.z,{leftIcon:(0,i.jsx)(rC.n,{}),isDisabled:!l||!(null==d?void 0:d.result)||!!c,size:"sm",colorScheme:"blue",onClick:T,children:"Go to Check"}):(0,i.jsx)(ej.z,{leftIcon:(0,i.jsx)(rC.n,{}),isDisabled:!l||!(null==d?void 0:d.result)||!!c,size:"sm",colorScheme:"blue",onClick:E,children:"Add to Checklist"}),(0,i.jsx)(t2.P,{onClick:()=>{s&&s()}})]})]})}),0===C&&(0,i.jsx)(tL,{ref:I,error:c,run:d,onCancel:f,viewOptions:v,onViewOptionsChanged:y,RunResultView:S}),1===C&&d&&(0,i.jsx)(rS,{type:d.type,params:d.params}),2===C&&d&&((null===(t=d.params)||void 0===t?void 0:t.base_sql_template)?(0,i.jsx)(tI,{value:d.params.sql_template,baseValue:d.params.base_sql_template,options:{readOnly:!0}}):(0,i.jsx)(tD,{value:(null==d?void 0:null===(r=d.params)||void 0===r?void 0:r.sql_template)||"",options:{readOnly:!0}}))]})},rR=e=>{let{onClose:n}=e,{runId:t}=nP();return(0,i.jsx)(rz,{runId:t,onClose:n})};var rT=t(22661);t(86777);let rE=e=>{var n;let{run:t,isSelected:l,onSelectRun:a,onAddToChecklist:c,onGoToCheck:d}=e,{data:u}=(0,b.a)({queryKey:H.run(t.run_id),queryFn:async()=>await en(t.run_id),enabled:(null==t?void 0:t.status)==="running",retry:!1}),h=(null===(n=nA(t.type))||void 0===n?void 0:n.icon)||ew.WzH,x=t.check_id;return(0,i.jsxs)(o.k,{minWidth:"200px",direction:"column",width:"100%",p:"5px 20px",cursor:"pointer",borderBottom:"solid 1px lightgray",borderLeft:"4px",borderLeftColor:l?"orange.400":"transparent",backgroundColor:l?"orange.50":"transparent",onClick:()=>{a(t.run_id)},_hover:{bg:l?"orange.50":"gray.200"},children:[(0,i.jsxs)(o.k,{onClick:()=>{},alignItems:"center",gap:"12px",children:[(0,i.jsx)(s.J,{as:h}),(0,i.jsx)(r.xu,{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",color:t.name?"inherit":"gray.500",fontSize:"11pt",fontWeight:"500",children:t.name||"<no name>"}),x?(0,i.jsx)(nx.u,{label:"Go to Check","aria-label":"Go to Check",children:(0,i.jsx)(eZ.x,{onClick:e=>{e.preventDefault(),e.stopPropagation(),d(x)},children:(0,i.jsx)(s.J,{color:"green",as:th.FJM})})}):(0,i.jsx)(nx.u,{label:"Add to Checklist","aria-label":"Add to Checklist",children:(0,i.jsx)(eZ.x,{onClick:e=>{e.preventDefault(),e.stopPropagation(),c(t.run_id)},children:(0,i.jsx)(s.J,{as:th.wO})})})]}),(0,i.jsx)(o.k,{justifyContent:"start",fontSize:"11pt",color:"gray.500",gap:"3px",alignItems:"center",children:(0,i.jsx)(r_,{run:u||t})})]})},rD=e=>{let{runAt:n}=e,t=n?function(e){let n=new Date,t=new Date;return(t.setDate(n.getDate()-1),null==e)?null:n.toDateString()===e.toDateString()?"Today":t.toDateString()===e.toDateString()?"Yesterday":(0,id.WU)(e,"MMM d")}(new Date(n)):null;return(0,i.jsx)(o.k,{minWidth:"200px",width:"100%",p:"5px 20px",borderBottom:"solid 1px lightgray",color:"gray.500",fontSize:"11pt",children:t})},rI=()=>{let{data:e,isLoading:n,isFetching:t,error:l,refetch:s}=(0,b.a)({queryKey:H.runs(),queryFn:async()=>await el(),retry:!1}),{showRunId:a,runId:d}=nP(),x=e=>{a(e,!1)},[,m]=(0,ek.TH)(),p=(0,k.NL)(),f=(0,j.useCallback)(async()=>{if(!d)return;let e=await nK(d);p.invalidateQueries({queryKey:H.checks()}),m("/checks/".concat(e.check_id))},[d,m,p]),g=(0,j.useCallback)(e=>{m("/checks/".concat(e))},[m]),v=null;return(0,i.jsxs)(o.k,{direction:"column",height:"100%",children:[(0,i.jsxs)(u.U,{width:"100%",flex:"0 0 54px",paddingInline:"24px 8px",borderBottom:"solid 1px lightgray",children:[(0,i.jsx)(c.X,{size:"md",children:"History"}),(0,i.jsx)(h.L,{}),(0,i.jsx)(nz.h,{variant:"unstyled",icon:(0,i.jsx)(n1.n,{}),"aria-label":"Search database",onClick:()=>{s()}})]}),(0,i.jsx)(r.xu,{flex:"1 1 auto",children:n?"Loading...":(null==e?void 0:e.length)===0?(0,i.jsx)(eQ.M,{height:"100%",color:"gray.400",children:"No runs"}):(0,i.jsx)(rT.Z,{style:{minHeight:"100%",height:0},children:(e||[]).map((e,n)=>{let t=new Date(e.run_at).toDateString(),r=null!=v&&v!==t;return v=t,(0,i.jsxs)(i.Fragment,{children:[r&&(0,i.jsx)(rD,{runAt:e.run_at},t),(0,i.jsx)(rE,{run:e,isSelected:e.run_id===d,onSelectRun:x,onGoToCheck:g,onAddToChecklist:f},e.run_id)]})})})})]})};var rO=t(65627),rM=t(78032);let{definePartsStyle:rL,defineMultiStyleConfig:rA}=(0,rM.D)(rO.TB.keys),rN=rA({variants:{circular:rL({control:(0,rM.k0)({rounded:"full"})})},sizes:{xs:rL({icon:(0,rM.k0)({fontSize:"8px"}),control:(0,rM.k0)({boxSize:"16px",padding:"4px"}),label:(0,rM.k0)({fontSize:"xs"})})}}),rq=(0,t(62821).fj)({baseStyle:{borderRadius:"4px"}});var rF=t(39588);let rP=e=>{let{children:n,path:t}=e,[l]=(0,ek.yj)(t);return(0,i.jsx)(r.xu,{display:l?"block":"none",height:"100%",children:n})};function rW(e){let{icon:n,href:t,...r}=e;return(0,i.jsx)(l.r,{height:"20px",color:"white",href:t,isExternal:!0,...r,children:(0,i.jsx)(s.J,{color:"white",boxSize:"20px",as:n})})}function rH(){let{reviewMode:e,isDemoSite:n,envInfo:t,cloudMode:x,isLoading:m}=ed(),p=function(){let[e,n]=(0,j.useState)("");return(0,j.useEffect)(()=>{(async function(){try{let e=await U.get("/api/version");n(e.data)}catch(e){console.error("Error fetching version number:",e)}})()},[]),e}(),{url:f,id:g}=(null==t?void 0:t.pullRequest)||{},v=f?f.split("/").pop():null;return(0,i.jsxs)(o.k,{gap:"10px",minHeight:"40px",alignItems:"center",bg:"rgb(255, 110, 66)",children:[(0,i.jsx)(a.E,{boxSize:"20px",ml:"18px",src:"/logo/recce-logo-white.png",alt:"recce-logo-white"}),(0,i.jsx)(c.X,{as:"h1",fontFamily:'"Montserrat", sans-serif',fontSize:"lg",color:"white",children:"RECCE"}),(0,i.jsx)(d.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:p}),e&&(0,i.jsx)(d.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:"review mode"}),x&&(0,i.jsx)(d.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:(0,i.jsxs)(u.U,{children:[(0,i.jsx)(r.xu,{children:"cloud mode"}),(0,i.jsx)(r.xu,{borderLeft:"1px",borderLeftColor:"whiteAlpha.500",paddingLeft:"8px",children:(0,i.jsxs)(l.r,{href:f,_hover:{textDecoration:"none"},isExternal:!0,children:[(0,i.jsx)(s.J,{as:e$.X9P,boxSize:"3",fontWeight:"extrabold",strokeWidth:"1"})," #".concat(g)]})})]})}),n&&f&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(d.C,{fontSize:"sm",color:"white",colorScheme:"whiteAlpha",variant:"outline",children:(0,i.jsxs)(u.U,{children:[(0,i.jsx)(r.xu,{children:"demo mode"}),(0,i.jsx)(r.xu,{borderLeft:"1px",borderLeftColor:"whiteAlpha.500",paddingLeft:"8px",children:(0,i.jsxs)(l.r,{href:f,_hover:{textDecoration:"none"},isExternal:!0,children:[(0,i.jsx)(s.J,{as:e$.X9P,boxSize:"3",fontWeight:"extrabold",strokeWidth:"1"})," #".concat(v)]})})]})})}),(0,i.jsx)(h.L,{}),(0,i.jsx)(rW,{icon:th.hJX,href:"https://github.com/DataRecce/recce"}),(0,i.jsx)(rW,{icon:th.w5k,href:"https://getdbt.slack.com/archives/C05C28V7CPP"}),(0,i.jsx)(rW,{mr:"18px",icon:th.MXt,href:"https://datarecce.io/docs"})]})}function rV(e){let{queryKey:n,fetchCallback:t,selectCallback:l}=e,{data:s,isLoading:o,error:a}=(0,b.a)({queryKey:n,queryFn:t,select:l});return o||a||0===s?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(r.xu,{ml:"2px",height:"80%",aspectRatio:1,borderRadius:"full",bg:"tomato",alignContent:"center",color:"white",fontSize:"xs",children:s})}function rK(){let{isDemoSite:e,reviewMode:n,cloudMode:t,isLoading:r}=ed(),[l,s]=(0,ek.TH)(),o=[{name:"Lineage",href:"/lineage"},{name:"Query",href:"/query"},{name:"Checklist",href:"/checks",badge:(0,i.jsx)(rV,{queryKey:H.checks(),fetchCallback:nJ,selectCallback:e=>e.filter(e=>!e.is_checked).length})}],a=eR().findIndex(o,e=>{let{href:n}=e;return l.startsWith(n)});return(0,i.jsx)(x.m,{index:a,children:(0,i.jsxs)(m.t,{children:[o.map(e=>{let{name:n,href:t,badge:r}=e;return(0,i.jsxs)(p.O,{onClick:()=>{s(t)},children:[n,r]},n)}),(0,i.jsx)(h.L,{}),!r&&(0,i.jsxs)(i.Fragment,{children:[t&&(0,i.jsx)(rj,{}),!e&&!t&&(0,i.jsx)(ri,{}),!e&&t&&n&&(0,i.jsx)(ri,{checksOnly:!0}),(0,i.jsx)(rn,{})]}),(0,i.jsx)(rm,{})]})})}function rJ(){let{isRunResultOpen:e,isHistoryOpen:n,closeRunResult:t}=nP(),[l]=(0,ek.TH)(),s=e&&!l.startsWith("/checks"),o=n&&!l.startsWith("/checks");return(0,i.jsxs)(tc,{sizes:[0,100],minSize:o?300:0,gutterSize:o?5:0,style:{height:"100%"},children:[(0,i.jsx)(r.xu,{style:{contain:"size"},children:o&&(0,i.jsx)(rI,{})}),(0,i.jsxs)(td,{sizes:s?[50,50]:[100,0],minSize:s?100:0,gutterSize:s?5:0,style:{flex:"1",contain:"size"},children:[(0,i.jsx)(r.xu,{p:0,style:{contain:"content"},children:(0,i.jsxs)(i3,{children:[(0,i.jsx)(rP,{path:"/lineage",children:(0,i.jsx)(ry,{})}),(0,i.jsxs)(ek.rs,{children:[(0,i.jsx)(ek.AW,{path:"/query",children:(0,i.jsx)(iG,{})}),(0,i.jsx)(ek.AW,{path:"/checks/:slug*",children:(0,i.jsx)(iF,{})}),(0,i.jsx)(ek.AW,{path:"/runs/:runId",children:e=>{let{runId:n}=e;return(0,i.jsx)(i5,{runId:n})}}),(0,i.jsx)(ek.AW,{path:"/ssr",children:(0,i.jsx)(f.E,{size:"xs",isIndeterminate:!0})}),(0,i.jsx)(ek.AW,{children:(0,i.jsx)(ek.l_,{to:"/lineage"})})]})]})}),s?(0,i.jsx)(rR,{onClose:t}):(0,i.jsx)(r.xu,{})]})]})}let rB=(0,g.B1)({components:{Checkbox:rN,Tooltip:rq}});function rU(){(0,j.useLayoutEffect)(()=>{var e;let n=(e=document.cookie.match("(^|;)\\s*recce_user_id\\s*=\\s*([^;]+)"))?e.pop():"";if(n&&rF.env.AMPLITUDE_API_KEY)try{y.S1(rF.env.AMPLITUDE_API_KEY,n,{defaultTracking:!0})}catch(e){console.error(e)}},[]);let e=(0,i1.Z)({components:{MuiTooltip:{styleOverrides:{tooltip:{zIndex:1500}}}}});return(0,i.jsx)(i2.Z,{theme:e,children:(0,i.jsx)(v.x,{theme:rB,children:(0,i.jsx)(k.aH,{client:Q,children:(0,i.jsx)(ek.F0,{hook:i0,children:(0,i.jsx)(nW,{children:(0,i.jsxs)(o.k,{direction:"column",height:"100vh",overflow:"hidden",children:[(0,i.jsx)(rH,{}),(0,i.jsx)(rK,{}),(0,i.jsx)(rw,{}),(0,i.jsx)(rJ,{})]})})})})})})}},91074:function(){},87679:function(){},81974:function(){},15080:function(){}},function(e){e.O(0,[634,145,170,591,521,462,531,498,43,987,182,710,615,971,495,599,512,70,132,584,744],function(){return e(e.s=27709)}),_N_E=e.O()}]);