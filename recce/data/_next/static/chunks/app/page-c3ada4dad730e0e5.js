(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{99178:function(e,t,n){Promise.resolve().then(n.bind(n,51645))},51645:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var r=n(757);n(91702);var o=n(27726),a=n(52116),l=n(99691),i=n(83978),s=n.n(i);n(7866);var c=n(55528),d=n(10126),u=n(29330),h=n(11180);function _getPrimaryKeyValue(e,t){let n={};for(let r of t)n[r]=e[r];return JSON.stringify(n)}function DataFrameColumnGroupHeader(e){let{name:t,primaryKeys:n,onPrimaryKeyChange:o}=e;return"index"===t?(0,r.jsx)(r.Fragment,{}):n.includes(t)?(0,r.jsxs)(c.k,{alignItems:"center",children:[(0,r.jsx)(d.xu,{flex:1,children:t}),(0,r.jsx)(u.J,{cursor:"pointer",as:h.ven,onClick:()=>{let e=n.filter(e=>e!==t);o&&o(e)}})]}):(0,r.jsxs)(c.k,{alignItems:"center",children:[(0,r.jsx)(d.xu,{flex:1,children:t}),(0,r.jsx)(u.J,{cursor:"pointer",as:h.MhP,onClick:()=>{let e=[...n.filter(e=>"index"!==e),t];o&&o(e)}})]})}function toDataGrid(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0,l={schema:{fields:[],primaryKey:[]},data:[]};if(!e&&t)e=l,0===n.length&&(n=t.schema.primaryKey);else if(!t&&e)t=l,0===n.length&&(n=e.schema.primaryKey);else{if(!e||!t)return{rows:[],columns:[]};if(!s().isEqual(e.schema.primaryKey,t.schema.primaryKey))throw Error("primary key mismatch! ".concat(e.schema.primaryKey," != ").concat(t.schema.primaryKey));0===n.length&&(n=e.schema.primaryKey)}let i=[],c=[],d={},u={};t.schema.fields.forEach(e=>{d[e.name]={},d[e.name].current=e}),e.schema.fields.forEach(e=>{d[e.name]||(d[e.name]={}),d[e.name].base=e}),Object.entries(d).forEach(e=>{let[t,{base:l,current:d}]=e;if(n.includes(t))c.push({key:"".concat(t),name:(0,r.jsx)(DataFrameColumnGroupHeader,{name:t,primaryKeys:n,onPrimaryKeyChange:o}),frozen:!0});else{if("index"===t)return;let cellClass=e=>{if(!s().isEqual(e["base__".concat(t)],e["current__".concat(t)]))return"diff-cell"};i.push({name:(0,r.jsx)(DataFrameColumnGroupHeader,{name:t,primaryKeys:n,onPrimaryKeyChange:o}),children:[{key:"base__".concat(t),name:"Base",renderEditCell:a.Ug,cellClass},{key:"current__".concat(t),name:"Current",renderEditCell:a.Ug,cellClass}]})}}),t.data.forEach(e=>{let t=_getPrimaryKeyValue(e,n);u[t]={},u[t].current=e}),e.data.forEach(e=>{let t=_getPrimaryKeyValue(e,n);u[t]||(u[t]={}),u[t].base=e});let h=Object.entries(u).map(e=>{let[t,{base:r,current:o}]=e,a=JSON.parse(t);return r&&Object.keys(r).forEach(e=>{n.includes(e)||(a["base__".concat(e)]=r[e])}),o&&Object.keys(o).forEach(e=>{n.includes(e)||(a["current__".concat(e)]=o[e])}),a});return{columns:[...c,...i],rows:h}}var m=n(76920),f=n(46543),g=n(93683),p=n(7873),x=n(62130),y=n(29357),query_SqlEditor=e=>{let{value:t,onChange:n,onRun:a,...l}=e;return(0,o.useRef)(null),(0,r.jsx)(y.ZP,{language:l.language||"sql",theme:l.theme||"vs",value:t,onChange:e=>{void 0!==e&&n(e)},onMount:(e,t)=>{e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.Enter,a)},options:{tabSize:2,fontSize:16,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent"}})},v=n(71790),j=n(10929),b=n(12218);let C=b.env.NEXT_PUBLIC_API_URL?b.env.NEXT_PUBLIC_API_URL:window.location.origin;var w=n(13164);let S=j.default.create({baseURL:C}),k=new w.S;async function runQuery(e){let t=await S.post("/api/query",e);return t.data}function useRunQuery(e){return(0,v.a)({queryKey:["query",e.base],queryFn:()=>runQuery(e),retry:!1,enabled:!1})}let E='select * from {{ ref("mymodel") }}',_=(0,o.createContext)({sqlQuery:E,setSqlQuery:()=>{}});function RecceQueryContextProvider(e){let{children:t}=e,[n,a]=o.useState(E);return(0,r.jsx)(_.Provider,{value:{setSqlQuery:a,sqlQuery:n},children:t})}let useRecceQueryContext=()=>(0,o.useContext)(_),QueryViewDataGrid=e=>{let{loading:t,baseError:n,currentError:o,columns:i,rows:s}=e,d=n&&!o||!n&&o,getErrorMessage=e=>{if(!(e instanceof l.d7))return null==e?void 0:e.message;{var t,n;let r=null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.detail;return r||(null==e?void 0:e.message)}};return t?(0,r.jsxs)(m.M,{p:"16px",height:"100%",children:[(0,r.jsx)(f.$,{size:"sm",mr:"8px"}),"Loading..."]}):n&&o?(0,r.jsxs)(g.b,{status:"error",children:[(0,r.jsx)(p.z,{}),"Error: ",getErrorMessage(o)]}):0===i.length?(0,r.jsx)(m.M,{height:"100%",children:"No data"}):(0,r.jsxs)(c.k,{direction:"column",height:"100%",overflow:"auto",children:[d&&(0,r.jsxs)(g.b,{status:"error",children:[(0,r.jsx)(p.z,{}),n&&"Error[Base]: ".concat(getErrorMessage(n)),o&&"Error[Current]: ".concat(getErrorMessage(o))]}),(0,r.jsx)(a.ZP,{style:{height:"100%"},columns:i,rows:s,defaultColumnOptions:{resizable:!0,maxWidth:800,width:100},className:"rdg-light"})]})};var query_QueryView=()=>{let{sqlQuery:e,setSqlQuery:t}=useRecceQueryContext(),{data:n,refetch:a,...l}=useRunQuery({sql_template:e,base:!0}),{data:i,refetch:s,...u}=useRunQuery({sql_template:e,base:!1}),[h,m]=(0,o.useState)([]),f=(0,o.useCallback)(()=>{m([]),a(),s()},[a,s]),g=l.isFetching||u.isFetching,p=(0,o.useMemo)(()=>g?{rows:[],columns:[]}:toDataGrid(n,i,h,e=>{m(e)}),[n,i,g,h]);return(0,r.jsxs)(c.k,{direction:"column",height:"calc(100vh - 42px)",children:[(0,r.jsx)(c.k,{justifyContent:"right",padding:"5px",children:(0,r.jsx)(x.z,{colorScheme:"blue",onClick:f,isDisabled:g,size:"sm",children:"Run"})}),(0,r.jsx)(d.xu,{flex:"1",border:"1px solid #CBD5E0",height:"200px",width:"100%",children:(0,r.jsx)(query_SqlEditor,{language:"sql",theme:"vs",value:e,onChange:e=>t(e),onRun:()=>f()})}),(0,r.jsx)(d.xu,{backgroundColor:"gray.100",height:"50vh",children:(0,r.jsx)(QueryViewDataGrid,{loading:g,baseError:l.error,currentError:u.error,rows:p.rows,columns:p.columns})})]})},N=n(27869);function getNeighborSet(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=new Set,o={},dfs=(e,n)=>{if(n<0||void 0!==o[e]&&o[e]>=n)return;o[e]=n;let a=t(e);for(let e of a)dfs(e,n-1);r.add(e)};for(let t of e)dfs(t,n);return r}function buildDefaultLineageGraphSets(e,t){function buildAllLineageGraph(e,t){let n={},r={},buildNode=(e,t)=>({id:e,name:e,data:{},from:t,parents:{},children:{}});for(let[t,r]of Object.entries(e.parent_map)){n[t]=buildNode(t,"base");let r=e.nodes&&e.nodes[t];r&&(n[t].data.base=r,n[t].name=null==r?void 0:r.name,n[t].resourceType=null==r?void 0:r.resource_type,n[t].packageName=null==r?void 0:r.package_name)}for(let[e,r]of Object.entries(t.parent_map)){n[e]?n[e].from="both":n[e]=buildNode(e,"current");let r=t.nodes&&t.nodes[e];r&&(n[e].data.current=t.nodes&&t.nodes[e],n[e].name=null==r?void 0:r.name,n[e].resourceType=null==r?void 0:r.resource_type,n[e].packageName=null==r?void 0:r.package_name)}for(let[t,o]of Object.entries(e.parent_map))for(let e of o){let o=n[t],a=n[e],l="".concat(e,"_").concat(t);r[l]={id:l,from:"base",parent:a,child:o};let i=r[l];o.parents[e]=i,a.children[t]=i}for(let[e,o]of Object.entries(t.parent_map))for(let t of o){let o=n[e],a=n[t],l="".concat(t,"_").concat(e);r[l]?r[l].from="both":r[l]={id:l,from:"current",parent:a,child:o};let i=r[l];o.parents[t]=i,a.children[e]=i}return{edges:r,nodes:n}}function buildChangedOnlyLineageGraph(e,t){let n={},r={};function union(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=new Set;return t.forEach(e=>{e.forEach(e=>{r.add(e)})}),r}let o=selectDownstream(e,t),a=selectUpstream(e,t,1),l=union(o,a);return Object.entries(e.nodes).forEach(e=>{let[t,r]=e;l.has(t)&&(n[t]=r)}),Object.entries(e.edges).forEach(e=>{let[t,n]=e;l.has(n.parent.id)&&l.has(n.child.id)&&(r[t]=n)}),{nodes:n,edges:r}}let{nodes:n,edges:r}=buildAllLineageGraph(e,t),o=[];for(let[e,t]of Object.entries(n))if("base"===t.from)t.changeStatus="removed",o.push(t.id);else if("current"===t.from)t.changeStatus="added",o.push(t.id);else{var a,l,i,s,c,d;let e=null==t?void 0:null===(i=t.data)||void 0===i?void 0:null===(l=i.base)||void 0===l?void 0:null===(a=l.checksum)||void 0===a?void 0:a.checksum,n=null==t?void 0:null===(d=t.data)||void 0===d?void 0:null===(c=d.current)||void 0===c?void 0:null===(s=c.checksum)||void 0===s?void 0:s.checksum;e&&n&&e!==n&&(t.changeStatus="modified",o.push(t.id))}for(let[e,t]of Object.entries(r))"base"===t.from?t.changeStatus="removed":"current"===t.from&&(t.changeStatus="added");return{all:{nodes:n,edges:r},changed:buildChangedOnlyLineageGraph({nodes:n,edges:r},o),modifiedSet:o}}function selectUpstream(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(t,t=>void 0===e.nodes[t]?[]:Object.keys(e.nodes[t].parents),n)}function selectDownstream(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return getNeighborSet(t,t=>void 0===e.nodes[t]?[]:Object.keys(e.nodes[t].children),n)}function toReactflow(e,t){let n=[],r=[];for(let[t,r]of Object.entries(e.nodes))n.push({id:r.id,position:{x:0,y:0},data:r,type:"customNode",targetPosition:N.Ly.Left,sourcePosition:N.Ly.Right});for(let[t,n]of Object.entries(e.edges))r.push({id:n.id,type:"customEdge",source:n.parent.id,target:n.child.id,data:n});return highlightPath(e,t,n,r,null)}function highlightPath(e,t,n,r,o){function union(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=new Set;return t.forEach(e=>{e.forEach(e=>{r.add(e)})}),r}let a=null!==o?union(selectUpstream(e,[o]),selectDownstream(e,[o])):getNeighborSet(t,t=>void 0===e.nodes[t]?[]:Object.keys(e.nodes[t].children)),l=new Set(r.filter(e=>a.has(e.source)&&a.has(e.target)).map(e=>e.id)),i=n.map(e=>({...e,data:{...e.data,isHighlighted:a.has(e.id)}})),s=r.map(e=>({...e,data:{...e.data,isHighlighted:l.has(e.id)}}));return[i,s]}var O=n(7185),L=n(15550),I=n(43093),z=n(26187),P=n(23704),T=n(33710),R=n(93864),q=n.n(R);n(94570);var M=n(63240),D=n(54057);let K=h.Nbv,V=h.sFB,F=h.UGs;function getIconForChangeStatus(e){return"added"===e?{color:"#1dce00",icon:K}:"removed"===e?{color:"#ff4444",icon:V}:"modified"===e?{color:"#ffa502",icon:F}:{color:"inherit",icon:void 0}}function getIconForResourceType(e){return"model"===e?{color:"#c0eafd",icon:M.Fn3}:"metric"===e?{color:"#ffe6ee",icon:D._MV}:"source"===e?{color:"#a6dda6",icon:M.i1q}:"exposure"===e?{color:"#ffe6ee",icon:D.n8P}:"semantic_model"===e?{color:"#fb8caf",icon:D.R1C}:"seed"===e?{color:"#a6dda6",icon:M.tWi}:{color:"inherit",icon:void 0}}function GraphNode(e){var t,n;let o,{data:a}=e,{isHighlighted:l,resourceType:i,changeStatus:s}=a,h=(0,N.oR)(e=>e.transform[2]>.3),{icon:m}=getIconForResourceType(i),f="gray.400",g="solid";s&&(o=getIconForChangeStatus(s).icon,f=getIconForChangeStatus(s).color);let p=f,x=null==a?void 0:a.name;return(0,r.jsx)(O.u,{label:"model"===i?x:"".concat(x," (").concat(i,")"),placement:"top",children:(0,r.jsxs)(c.k,{width:"300px",_hover:{backgroundColor:h?"gray.100":f},borderColor:p,borderWidth:1,borderStyle:g,backgroundColor:h?"white":f,borderRadius:3,boxShadow:"unset",padding:0,className:!0===l?"node-highlight":!1===l?"node-unhighlight":void 0,children:[(0,r.jsx)(c.k,{backgroundColor:f,padding:2,borderRightWidth:1,borderColor:p,borderStyle:g,alignItems:"top",visibility:h?"inherit":"hidden",children:(0,r.jsx)(u.J,{as:m})}),(0,r.jsx)(c.k,{flex:"1 0 auto",mx:"1",width:"100px",direction:"column",children:(0,r.jsxs)(c.k,{width:"100%",textAlign:"left",flex:"1",p:1,alignItems:"center",visibility:h?"inherit":"hidden",children:[(0,r.jsx)(d.xu,{flex:"1",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:x}),o&&(0,r.jsx)(c.k,{children:(0,r.jsx)(u.J,{color:f,as:o,flex:"0 0 20px"})})]})}),Object.keys(null!==(t=null==a?void 0:a.parents)&&void 0!==t?t:{}).length>0&&(0,r.jsx)(N.HH,{type:"target",position:N.Ly.Left,isConnectable:!1}),Object.keys(null!==(n=null==a?void 0:a.children)&&void 0!==n?n:{}).length>0&&(0,r.jsx)(N.HH,{type:"source",position:N.Ly.Right,isConnectable:!1})]})})}function GraphEdge(e){let{sourceX:t,sourceY:n,targetX:o,targetY:a,sourcePosition:l,targetPosition:i,style:s={},markerEnd:c,data:d}=e,u={...s};(null==d?void 0:d.changeStatus)&&(u.stroke=getIconForChangeStatus(null==d?void 0:d.changeStatus).color,u.strokeDasharray="5"),(null==d?void 0:d.isHighlighted)===!1&&(u.filter="opacity(0.2) grayscale(50%)");let[h]=(0,N.OQ)({sourceX:t,sourceY:n,sourcePosition:l,targetX:o,targetY:a,targetPosition:i});return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(N.u5,{path:h,markerEnd:c,style:{...u,...s}})})}n(88727);var G=n(89042),H=n(17714),Q=n(74796),U=n(28478),A=n(79315),W=n(90593),B=n(7752),J=n(94410),Z=n(64920),Y=n(58909),$=n(29985),X=n(42524),ee=n(2593),et=n(55344),en=n(1726),er=n(83622),eo=n(21801),ea=n(29731),el=n(49981);function mergeKeys(e,t){let n=[...e],r=[...t],o=[];for(;n.length>0&&r.length>0;)if(o.includes(n[0]))n.shift();else if(o.includes(r[0]))r.shift();else if(n[0]===r[0])o.push(n[0]),n.shift(),r.shift();else if(r.includes(n[0])){let e=r.indexOf(n[0]);for(let t=0;t<e;t++)o.includes(r[t])||o.push(r[t]);o.push(n[0]),n.shift(),r.splice(0,e+1)}else o.push(n[0]),n.shift();return n.forEach(e=>{o.includes(e)||o.push(e)}),r.forEach(e=>{o.includes(e)||o.push(e)}),o}function mergeKeysWithStatus(e,t){let n=mergeKeys(e,t),r={};for(let o of n)e.includes(o)?t.includes(o)?r[o]=void 0:r[o]="removed":r[o]="added";let o={};e.forEach((e,t)=>{o[e]=t});let a=-1;for(let e of n){let t=o[e];void 0!==t&&(t>a?a=t:r[e]="reordered")}return r}function mergeColumns(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},r=mergeKeysWithStatus(Object.keys(e),Object.keys(t));return Object.entries(r).forEach(e=>{let[t,r]=e;n[t]={name:t,reordered:"reordered"===r}}),Object.entries(e).map((e,t)=>{let[r,o]=e;n[r].baseIndex=t+1,n[r].baseType=o.type}),Object.entries(t).map((e,t)=>{let[r,o]=e;n[r].currentIndex=t+1,n[r].currentType=o.type}),n}function schema_toDataGrid(e){function columnIndexCellClass(e){return void 0===e.baseIndex?"column-index-added":void 0===e.currentIndex?"column-index-removed":!0===e.reordered?"column-index-reordered":"column-index-normal"}function columnNameCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":!0===e.reordered?"column-body-reordered":"column-body-normal"}function columnTypeCellClass(e){return void 0===e.baseIndex?"column-body-added":void 0===e.currentIndex?"column-body-removed":e.baseType!==e.currentType?"column-body-type-changed":!0===e.reordered?"column-body-reordered":"column-body-normal"}let t=Object.values(e);return{columns:[{key:"baseIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"currentIndex",name:"",resizable:!0,minWidth:35,cellClass:columnIndexCellClass},{key:"name",name:"Name",resizable:!0,cellClass:columnNameCellClass},{key:"baseType",name:"Base Type",resizable:!0,cellClass:columnTypeCellClass},{key:"currentType",name:"Current Type",resizable:!0,cellClass:columnTypeCellClass}],rows:t}}function SchemaView(e){let t,{base:n,current:l}=e,{columns:i,rows:s}=(0,o.useMemo)(()=>schema_toDataGrid(mergeColumns(null==n?void 0:n.columns,null==l?void 0:l.columns)),[n,l]),d=n&&void 0===n.columns,u=l&&void 0===l.columns;return d&&u?t="catalog.json is missing on both current and base environments.":d?t="catalog.json is missing on base environment.":u&&(t="catalog.json is missing on current environment."),(0,r.jsxs)(c.k,{direction:"column",children:[t&&(0,r.jsxs)(g.b,{status:"warning",fontSize:"12px",p:"8px",children:[(0,r.jsx)(p.z,{}),t]}),s.length>0&&(0,r.jsx)(a.ZP,{style:{height:"100%",fontSize:"10pt",borderWidth:1,overflowY:"auto"},columns:i,rows:s,className:"rdg-light"})]})}function SqlDiffView(e){let{base:t,current:n}=e;return(0,r.jsx)(y.SV,{height:"500px",language:"sql",theme:"vs",original:null==t?void 0:t.raw_code,modified:null==n?void 0:n.raw_code,options:{readOnly:!0,fontSize:14,lineNumbers:"on",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same"}})}n(75165);var ei=n(90068),es=n(41171),ec=n(53930),ed=n(93398),eu=n(17180),eh=n(84680);function extractColumnNames(e){function getNames(e){return e.columns?Object.values(e.columns).map(e=>e.name):[]}let t=getNames(e.data.base),n=getNames(e.data.current),r=[];return t.forEach(e=>{r.includes(e)||r.push(e)}),n.forEach(e=>{r.includes(e)||r.push(e)}),r}async function fetchColumnValuesComparison(e,t){try{let n=await S.post("/api/columns_value_mismatched_summary",{model:e,primary_key:t});return n.data}catch(e){console.error("Error fetching column values comparison:",e)}}var MismatchSummary=function(){let{isOpen:e,onOpen:t,onClose:n}=(0,H.q)(),[l,i]=(0,o.useState)(!1),[s,c]=(0,o.useState)(null);return{MismatchSummaryModal:u=>{let{node:h}=u,m="model"===h.resourceType||"seed"===h.resourceType||"source"===h.resourceType,f=extractColumnNames(h),[g,p]=(0,o.useState)(""),handleExecute=async()=>{if(!l&&""!==g){i(!0);try{let e=await fetchColumnValuesComparison(h.name,g),t=e.data.schema.fields.map(e=>({name:e.name,key:e.name}));c({columns:t,data:e.data.data,summary:e.summary,model:h.name})}catch(e){console.error("Error fetching column values comparison:",e)}finally{i(!1)}}};return((0,o.useEffect)(()=>{(null==s?void 0:s.model)!=h.name&&c(null)},[h.name]),m)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(B.u_,{isOpen:e,onClose:n,size:"6xl",children:[(0,r.jsx)(J.Z,{}),(0,r.jsxs)(Z.h,{overflowY:"auto",height:"75%",children:[(0,r.jsx)(Y.x,{children:"Mismatched Summary"}),(0,r.jsx)($.o,{}),(0,r.jsx)(X.f,{children:l?(0,r.jsx)(ei.E,{size:"xs",isIndeterminate:!0}):s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(d.xu,{mb:1,children:[s.summary.total," rows (",s.summary.added," added, ",s.summary.removed," removed)"]}),(0,r.jsx)(eu.i,{mb:1,mt:1}),(0,r.jsx)(a.ZP,{style:{height:"100%",width:"100%"},columns:s.columns.map(e=>({...e,width:void 0,resizable:!0,flexGrow:1})),rows:s.data,defaultColumnOptions:{resizable:!0},className:"rdg-light"})]}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(es.NI,{children:[(0,r.jsx)(ec.l,{children:"Pick a primary key"}),(0,r.jsx)(ed.P,{placeholder:"Select primary key",value:g,onChange:e=>p(e.target.value),children:f.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]})})}),(0,r.jsxs)(eh.m,{children:[s&&(0,r.jsx)(x.z,{mr:3,colorScheme:"blue",onClick:()=>{c(null)},children:"Clear"}),(0,r.jsx)(x.z,{colorScheme:"blue",onClick:handleExecute,children:"Execute"})]})]})]}),(0,r.jsx)(x.z,{colorScheme:"blue",size:"sm",onClick:t,children:"Mismatch Summary"})]}):(0,r.jsx)(r.Fragment,{})}}};function NodeView(e){let{node:t,onCloseNode:n}=e,o=(0,el.useRouter)(),{setSqlQuery:a}=useRecceQueryContext(),l="model"===t.resourceType||"seed"===t.resourceType||"source"===t.resourceType,{isOpen:i,onOpen:s,onClose:u}=(0,H.q)(),{MismatchSummaryModal:h}=MismatchSummary();return(0,r.jsxs)(Q.r,{height:"100%",templateRows:"auto 1fr",children:[(0,r.jsxs)(U.U,{children:[(0,r.jsxs)(d.xu,{flex:"0 1 20%",p:"16px",children:[(0,r.jsx)(A.X,{size:"sm",children:t.name}),(0,r.jsx)(d.xu,{color:"gray",children:t.resourceType})]}),(0,r.jsx)(W.L,{}),"modified"===t.changeStatus&&(0,r.jsxs)(d.xu,{children:[(0,r.jsx)(x.z,{onClick:s,leftIcon:(0,r.jsx)(M.tvD,{}),colorScheme:"orange",variant:"solid",children:"Diff"}),(0,r.jsxs)(B.u_,{isOpen:i,onClose:u,size:"6xl",children:[(0,r.jsx)(J.Z,{}),(0,r.jsxs)(Z.h,{overflowY:"auto",height:"75%",children:[(0,r.jsx)(Y.x,{children:"Model Raw Code Diff"}),(0,r.jsx)($.o,{}),(0,r.jsx)(X.f,{children:(0,r.jsx)(SqlDiffView,{base:t.data.base,current:t.data.current})})]})]})]}),(0,r.jsx)(d.xu,{flex:"0 1 1%",p:"16px",children:(0,r.jsx)(ee.P,{onClick:n})})]}),l&&(0,r.jsxs)(et.m,{overflow:"auto",as:c.k,children:[(0,r.jsx)(en.t,{children:(0,r.jsx)(er.O,{children:"Columns"})}),(0,r.jsx)(eo.n,{overflow:"auto",height:"calc(100% - 42px)",children:(0,r.jsx)(ea.x,{p:0,overflowY:"auto",height:"100%",children:(0,r.jsx)(SchemaView,{base:t.data.base,current:t.data.current})})})]}),"model"===t.resourceType&&(0,r.jsxs)(U.U,{p:"16px",children:[(0,r.jsx)(W.L,{}),(0,r.jsx)(h,{node:t}),(0,r.jsx)(x.z,{colorScheme:"blue",size:"sm",onClick:()=>{a('select * from {{ ref("'.concat(t.name,'") }}')),o.push("/#query")},children:"Query"})]})]})}var em=n(43898),ef=n(21123),eg=n.n(ef);let layout=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR",r=new(q()).graphlib.Graph;r.setDefaultEdgeLabel(()=>({})),r.setGraph({rankdir:n}),e.forEach(e=>{r.setNode(e.id,{width:300,height:36})}),t.forEach(e=>{r.setEdge(e.source,e.target)}),q().layout(r),e.forEach(e=>{let t=r.node(e.id);return e.position={x:t.x-150,y:t.y-18},e})},ep={customNode:GraphNode},ex={customEdge:GraphEdge},nodeColor=e=>{var t,n;return(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.changeStatus)?getIconForChangeStatus(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.changeStatus).color:"lightgray"},ey={all:"All",changed_models:"Changed Models"};function ChangeStatusLegend(){return(0,r.jsx)(d.xu,{bg:"white",padding:"12px",borderWidth:"1px",borderColor:"gray.200",fontSize:"sm",children:Object.entries({added:["Added","Added resource"],removed:["Removed","Removed resource"],modified:["Modified","Modified resource"]}).map(e=>{let[t,[n,o]]=e,{icon:a,color:l}=getIconForChangeStatus(t);return(0,r.jsx)(O.u,{label:o,children:(0,r.jsxs)(c.k,{alignItems:"center",gap:"6px",marginBottom:"2px",children:[(0,r.jsx)(u.J,{color:l,as:a})," ",n]})},t)})})}function _LineageView(){let[e,t]=(0,o.useState)(),[n,a,i]=(0,N.Rr)([]),[s,h,m]=(0,N.ll)([]),[g,p]=(0,o.useState)(),[x,y]=(0,o.useState)(),[v,b]=(0,o.useState)(!1),[w,S]=(0,o.useState)(),[k,E]=(0,o.useState)(),[_,O]=(0,o.useState)(),[R,q]=(0,o.useState)("changed_models"),{getViewport:M}=(0,N._K)(),D=(0,L.p)(),K=(0,o.useCallback)(async()=>{let e="current";try{b(!0);let t=await j.default.get("".concat(C,"/api/lineage?base=0"));if(200!==t.status)throw Error("error");e="base";let n=await j.default.get("".concat(C,"/api/lineage?base=1"));if(200!==n.status)throw Error("error");let r=buildDefaultLineageGraphSets(n.data,t.data),o="changed_models"===R?r.changed:r.all,l=r.modifiedSet,[i,s]=toReactflow(o,r.modifiedSet);layout(i,s),p(o),y(l),a(i),h(s),S(void 0),E(void 0)}catch(r){if(r instanceof l.d7){var t,n;let e=null==r?void 0:null===(n=r.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.detail;e?S(e):S(null==r?void 0:r.message)}else S(null==r?void 0:r.message);E(e)}finally{b(!1)}},[a,h,R]);return((0,o.useEffect)(()=>{K()},[K]),(0,o.useEffect)(()=>{function httpUrlToWebSocketUrl(e){return e.replace(/(http)(s)?\:\/\//,"ws$2://")}let e=new WebSocket("".concat(httpUrlToWebSocketUrl(C),"/api/ws"));return t(e),e.onopen=()=>{e.send("ping")},e.onmessage=e=>{if("pong"!==e.data)try{let t=JSON.parse(e.data);if("refresh"===t.command){let{eventType:e,srcPath:n}=t.event,[r,o]=n.split("/").slice(-2),a=eg().parse(o).name;D({description:"Detected ".concat(r," ").concat(a," ").concat(e),status:"info",variant:"left-accent",position:"bottom-right",duration:5e3,isClosable:!0}),K()}}catch(e){console.error(e)}},()=>{e&&e.close()}},[D,K]),v)?(0,r.jsx)(c.k,{width:"100%",height:"calc(100vh - 42px)",alignItems:"center",justifyContent:"center",children:(0,r.jsx)(f.$,{size:"xl"})}):w?(0,r.jsxs)(r.Fragment,{children:["Fail to load lineage data: ",w]}):(0,r.jsxs)(c.k,{width:"100%",height:"calc(100vh - 42px)",children:[(0,r.jsx)(d.xu,{flex:"1 0 0px",children:(0,r.jsxs)(N.x$,{nodeTypes:ep,edgeTypes:ex,nodes:n,edges:s,onNodesChange:i,onEdgesChange:m,onNodeClick:(e,t)=>{O(t.id)},onNodeMouseEnter:(e,t)=>{if(g&&void 0!==x){let[e,r]=highlightPath(g,x,n,s,t.id);a(e),h(r)}},onNodeMouseLeave:(e,t)=>{if(g&&void 0!==x){let[e,t]=highlightPath(g,x,n,s,null);a(e),h(t)}},maxZoom:1,minZoom:.1,fitView:!0,children:[(0,r.jsx)(z.A,{color:"#ccc"}),(0,r.jsxs)(P.Z,{showInteractive:!1,position:"top-right",children:[(0,r.jsx)(P.B,{title:"switch mode",onClick:()=>{q("all"===R?"changed_models":"all")},children:(0,r.jsx)(u.J,{as:G.Bw1})}),(0,r.jsx)(P.B,{title:"download image",onClick:()=>{let e=document.querySelector(".react-flow__viewport");(null==e?void 0:e.parentElement)&&(0,em.YM)(null==e?void 0:e.parentElement,{backgroundColor:"#ffffff00",width:null==e?void 0:e.parentElement.clientWidth,height:null==e?void 0:e.parentElement.clientHeight,style:{width:"".concat(null==e?void 0:e.parentElement.clientWidth),height:"".concat(null==e?void 0:e.parentElement.clientHeight)}}).then(e=>{let t=document.createElement("a");t.setAttribute("download","recce-lineage.png"),t.setAttribute("target","_blank"),t.setAttribute("href",e),t.click()})},children:(0,r.jsx)(u.J,{as:G.wzc})})]}),(0,r.jsx)(N.s_,{position:"bottom-left",children:(0,r.jsx)(ChangeStatusLegend,{})}),(0,r.jsx)(N.s_,{position:"top-left",children:(0,r.jsx)(I.x,{fontSize:"xl",color:"grey",opacity:.5,children:ey[R]})}),(0,r.jsx)(T.a,{nodeColor:nodeColor,nodeStrokeWidth:3})]})}),_&&(null==g?void 0:g.nodes[_])&&(0,r.jsx)(d.xu,{flex:"0 0 500px",borderLeft:"solid 1px lightgray",height:"100%",children:(0,r.jsx)(NodeView,{node:null==g?void 0:g.nodes[_],onCloseNode:()=>{O(void 0)}})})]})}function LineageView(){return(0,r.jsx)(N.tV,{children:(0,r.jsx)(_LineageView,{})})}var ev=n(58573),ej=n(98786),eb=n(35537);function useVersionNumber(){let[e,t]=(0,o.useState)("");return(0,o.useEffect)(()=>{(async function(){try{let e=await S.get("/api/version");t(e.data)}catch(e){console.error("Error fetching version number:",e)}})()},[]),e}function getLocationHash(){return window.location.hash.replace("#","")}function setLocationHash(e){window.location.hash=e}var eC=n(12218);function getCookie(e){var t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t?t.pop():""}function Home(){let e=useVersionNumber(),t=(0,el.useParams)(),[n,a]=(0,o.useState)(getLocationHash()),[l,i]=(0,o.useState)(0);return(0,o.useLayoutEffect)(()=>{let e=getCookie("recce_user_id");if(e&&eC.env.AMPLITUDE_API_KEY)try{ej.S1(eC.env.AMPLITUDE_API_KEY,e,{defaultTracking:!0})}catch(e){console.error(e)}},[]),(0,o.useEffect)(()=>{let e=getLocationHash();a(e),e===n&&("query"===e?i(1):i(0))},[t,n]),(0,r.jsx)(ev.x,{children:(0,r.jsx)(RecceQueryContextProvider,{children:(0,r.jsx)(eb.aH,{client:k,children:(0,r.jsxs)(et.m,{index:l,onChange:e=>{0===e?setLocationHash("lineage"):1===e&&setLocationHash("query"),i(e)},children:[(0,r.jsxs)(en.t,{children:[(0,r.jsx)(er.O,{children:"Lineage"}),(0,r.jsx)(er.O,{children:"Query"}),(0,r.jsx)(d.xu,{position:"absolute",right:"0",top:"0",p:"2",color:"gray.500",children:e})]}),(0,r.jsxs)(eo.n,{children:[(0,r.jsx)(ea.x,{p:0,children:(0,r.jsx)(LineageView,{})}),(0,r.jsx)(ea.x,{p:0,children:(0,r.jsx)(query_QueryView,{})})]})]})})})})}},88727:function(){},7866:function(){},75165:function(){}},function(e){e.O(0,[145,170,182,710,495,618,297,62,744],function(){return e(e.s=99178)}),_N_E=e.O()}]);