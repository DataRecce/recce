(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,884916,e=>{"use strict";var t=e.i(19483),n=e.i(324066),i=e.i(76130),a=e.i(336277),s=e.i(672193),l=e.i(427938),r=e.i(130209),o=e.i(187725),u=e.i(388797),d=e.i(913369),c=e.i(2936);e.i(134115);var f=e.i(940999),x=e.i(180806),h=e.i(507524),m=e.i(461566),y=e.i(916955),p=e.i(29134),j=e.i(912007),g=e.i(475119),b=e.i(783586),q=e.i(182809),w=e.i(333207),C=e.i(42409),R=e.i(407101),v=e.i(109624),S=e.i(373921);function _(){let{data:e}=(0,w.useQuery)({queryKey:R.cacheKeys.instanceInfo(),queryFn:v.getRecceInstanceInfo});return(0,t.jsx)("div",{className:"flex flex-1 h-full min-h-0 m-2 p-4 bg-blue-50 rounded-lg shadow-md justify-center",children:(0,t.jsxs)("div",{className:"w-4/5 flex flex-col overflow-y-auto gap-6 px-8 pb-8",children:[(0,t.jsxs)(a.default,{alignItems:"center",spacing:2,children:[(0,t.jsx)(n.default,{sx:{p:1,bgcolor:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:2},children:(0,t.jsx)(n.default,{component:C.RiTerminalBoxLine,sx:{fontSize:28,color:"iochmara.500"}})}),(0,t.jsx)(l.default,{variant:"h5",sx:{mt:2},children:"Wait, there's more!"}),(0,t.jsxs)(l.default,{sx:{fontSize:"1rem",textAlign:"center"},children:["Query functions disabled without a"," ",(0,t.jsx)(l.default,{component:"span",sx:{fontWeight:"bold"},children:"data warehouse connection"})]})]}),(0,t.jsx)(a.default,{sx:{width:"50%",mt:3,mx:"auto"},children:(0,t.jsx)(i.default,{color:"iochmara",variant:"contained",size:"large",onClick:()=>{window.open((0,S.getSettingsUrl)(e),"_blank")},children:"Connect to Data Warehouse"})})]})})}var D=e.i(138848);let Q=()=>{let{isCustomQueries:e,setCustomQueries:i,sqlQuery:r,setBaseSqlQuery:o}=(0,g.useRecceQueryContext)();return(0,t.jsxs)(n.default,{children:[(0,t.jsxs)(a.default,{direction:"row",spacing:.5,alignItems:"center",fontSize:"0.75rem",children:[(0,t.jsx)(l.default,{variant:"body2",sx:{fontSize:"0.75rem"},children:"Custom Queries"}),(0,t.jsx)(f.Tooltip,{content:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,t.jsx)(n.default,{component:"span",sx:{display:"flex",color:"grey.600"},children:(0,t.jsx)(u.PiInfoFill,{fontSize:"1rem"})})})]}),(0,t.jsx)(s.default,{size:"small",checked:e,onChange:()=>{!e&&o&&o(r),i(!e)},color:"primary"})]})},z=()=>{let{sqlQuery:e,baseSqlQuery:a,setSqlQuery:s,setBaseSqlQuery:l,primaryKeys:u,setPrimaryKeys:w,isCustomQueries:C}=(0,g.useRecceQueryContext)(),{lineageGraph:R,envInfo:v}=(0,y.useLineageGraphContext)(),{featureToggles:S,singleEnv:z}=(0,j.useRecceInstanceContext)(),B=e;v?.adapterType==="sqlmesh"&&e===g.defaultSqlQuery&&(B="select * from db.mymodel"),"read only"===S.mode&&(B=`--- Would like to do query here? Book a demo with us at ${x.RECCE_SUPPORT_CALENDAR_URL}
${B}`);let{showRunId:I}=(0,p.useRecceActionContext)(),k=async e=>{let t="query_base"===e?a??"":B,n=function(e){switch(e){case"query":return h.submitQuery;case"query_base":return h.submitQueryBase;case"query_diff":return h.submitQueryDiff;default:throw Error(`Unknown query type: ${e}`)}}(e),i={sql_template:t};"query_diff"===e&&(i.primary_keys=u,C&&(i.base_sql_template=a));let{run_id:s}=await n(i,{nowait:!0});return I(s),await (0,m.waitRun)(s)},{mutate:T,isPending:A}=(0,r.useMutation)({mutationFn:k}),P=(0,o.useMemo)(()=>{let e={};if(!R)return"N/A";for(let t in R.nodes){let n=R.nodes[t].data.data.current?.schema;n&&(e[n]=(e[n]||0)+1)}return Object.keys(e).reduce((t,n)=>e[n]>(e[t]||0)?n:t,"N/A")},[R]);return z||"metadata only"===S.mode?(0,t.jsxs)(n.default,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,t.jsxs)(n.default,{sx:{display:"flex",justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray"},children:[(0,t.jsx)(c.default,{}),(0,t.jsx)(n.default,{sx:{flexGrow:1}}),z?(0,t.jsx)(f.Tooltip,{content:"Please configure the base environment before running the diff",positioning:{placement:"left"},children:(0,t.jsx)(i.default,{variant:"contained",disabled:!0,size:"small",sx:{fontSize:"14px",mt:"16px"},children:"Run Diff"})}):(0,t.jsx)(d.default,{display:"metadata only"===S.mode,children:(0,t.jsx)(i.default,{variant:"contained",disabled:!0,size:"small",sx:{fontSize:"14px",mt:"16px"},children:"Run Diff"})})]}),(0,t.jsx)(D.DualSqlEditor,{value:B,onChange:s,onRun:()=>{T("query")},labels:["base (production)",`current (${P})`],SetupGuide:"metadata only"===S.mode?(0,t.jsx)(_,{}):(0,t.jsx)(b.BaseEnvironmentSetupGuide,{})})]}):(0,t.jsxs)(n.default,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,t.jsxs)(n.default,{sx:{display:"flex",justifyContent:"right",alignItems:"flex-end",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px"},children:[(0,t.jsx)(c.default,{}),(0,t.jsx)(Q,{}),(0,t.jsx)(n.default,{sx:{flexGrow:1}}),(0,t.jsx)(q.QueryForm,{defaultPrimaryKeys:u,onPrimaryKeysChange:w}),(0,t.jsx)(i.default,{variant:"contained",onClick:()=>{T("query_diff")},disabled:A||S.disableDatabaseQuery,size:"small",children:"Run Diff"})]}),(0,t.jsx)(n.default,{sx:{width:"100%",flex:1},children:C?(0,t.jsx)(D.DualSqlEditor,{value:B,baseValue:a,onChange:s,onChangeBase:l,onRun:()=>{T("query")},onRunBase:()=>{T("query_base")},onRunDiff:()=>{T("query_diff")}}):(0,t.jsx)(D.default,{value:B,onChange:s,onRun:()=>{T("query")},onRunDiff:()=>{T("query_diff")}})})]})};function B(){return(0,t.jsx)(z,{})}e.s(["default",()=>B],884916)}]);