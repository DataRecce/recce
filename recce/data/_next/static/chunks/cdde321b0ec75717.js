(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,884916,e=>{"use strict";var t=e.i(19483),a=e.i(324066),i=e.i(76130),r=e.i(336277);e.i(316575);var n=e.i(187725),o=e.i(7284),s=e.i(778024),l=e.i(578509),d=e.i(860223),u=e.i(605679),c=e.i(446547),h=e.i(73205),f=e.i(519273),p=e.i(435983),m=e.i(446519);function x(e){return(0,m.default)("MuiSwitch",e)}let y=(0,p.default)("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]);var g=e.i(577950);let b=(0,c.styled)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.root,a.edge&&t[`edge${(0,l.default)(a.edge)}`],t[`size${(0,l.default)(a.size)}`]]}})({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${y.thumb}`]:{width:16,height:16},[`& .${y.switchBase}`]:{padding:4,[`&.${y.checked}`]:{transform:"translateX(16px)"}}}}]}),w=(0,c.styled)(u.default,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.switchBase,{[`& .${y.input}`]:t.input},"default"!==a.color&&t[`color${(0,l.default)(a.color)}`]]}})((0,h.default)(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${"light"===e.palette.mode?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${y.checked}`]:{transform:"translateX(20px)"},[`&.${y.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${"light"===e.palette.mode?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${y.checked} + .${y.track}`]:{opacity:.5},[`&.${y.disabled} + .${y.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${"light"===e.palette.mode?.12:.2}`},[`& .${y.input}`]:{left:"-100%",width:"300%"}})),(0,h.default)(({theme:e})=>({"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(e.palette).filter((0,d.default)(["light"])).map(([t])=>({props:{color:t},style:{[`&.${y.checked}`]:{color:(e.vars||e).palette[t].main,"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${y.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t}DisabledColor`]:`${"light"===e.palette.mode?e.lighten(e.palette[t].main,.62):e.darken(e.palette[t].main,.55)}`}},[`&.${y.checked} + .${y.track}`]:{backgroundColor:(e.vars||e).palette[t].main}}}))]}))),v=(0,c.styled)("span",{name:"MuiSwitch",slot:"Track"})((0,h.default)(({theme:e})=>({height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${"light"===e.palette.mode?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${"light"===e.palette.mode?.38:.3}`}))),j=(0,c.styled)("span",{name:"MuiSwitch",slot:"Thumb"})((0,h.default)(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}))),k=n.forwardRef(function(e,a){let i=(0,f.useDefaultProps)({props:e,name:"MuiSwitch"}),{className:r,color:n="primary",edge:d=!1,size:u="medium",sx:c,slots:h={},slotProps:p={},...m}=i,y={...i,color:n,edge:d,size:u},k=(e=>{let{classes:t,edge:a,size:i,color:r,checked:n,disabled:o}=e,d={root:["root",a&&`edge${(0,l.default)(a)}`,`size${(0,l.default)(i)}`],switchBase:["switchBase",`color${(0,l.default)(r)}`,n&&"checked",o&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},u=(0,s.default)(d,x,t);return{...t,...u}})(y),C={slots:h,slotProps:p},[S,$]=(0,g.default)("root",{className:(0,o.default)(k.root,r),elementType:b,externalForwardedProps:C,ownerState:y,additionalProps:{sx:c}}),[R,q]=(0,g.default)("thumb",{className:k.thumb,elementType:j,externalForwardedProps:C,ownerState:y}),B=(0,t.jsx)(R,{...q}),[z,D]=(0,g.default)("track",{className:k.track,elementType:v,externalForwardedProps:C,ownerState:y});return(0,t.jsxs)(S,{...$,children:[(0,t.jsx)(w,{type:"checkbox",icon:B,checkedIcon:B,ref:a,ownerState:y,...m,classes:{...k,root:k.switchBase},slots:{...h.switchBase&&{root:h.switchBase},...h.input&&{input:h.input}},slotProps:{...p.switchBase&&{root:"function"==typeof p.switchBase?p.switchBase(y):p.switchBase},input:{role:"switch"},...p.input&&{input:"function"==typeof p.input?p.input(y):p.input}}}),(0,t.jsx)(z,{...D})]})});var C=e.i(197068),S=e.i(427938),$=e.i(130209),R=e.i(388797),q=e.i(913369),B=e.i(2936),z=e.i(180806),D=e.i(507524),_=e.i(461566),I=e.i(916955),T=e.i(29134),Q=e.i(912007),P=e.i(475119),A=e.i(783586),M=e.i(182809),E=e.i(333207),N=e.i(42409),O=e.i(407101),K=e.i(109624),L=e.i(373921);function U(){let{data:e}=(0,E.useQuery)({queryKey:O.cacheKeys.instanceInfo(),queryFn:K.getRecceInstanceInfo});return(0,t.jsx)("div",{className:"flex flex-1 h-full min-h-0 m-2 p-4 bg-blue-50 rounded-lg shadow-md justify-center",children:(0,t.jsxs)("div",{className:"w-4/5 flex flex-col overflow-y-auto gap-6 px-8 pb-8",children:[(0,t.jsxs)(r.default,{alignItems:"center",spacing:2,children:[(0,t.jsx)(a.default,{sx:{p:1,bgcolor:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:2},children:(0,t.jsx)(a.default,{component:N.RiTerminalBoxLine,sx:{fontSize:28,color:"iochmara.500"}})}),(0,t.jsx)(S.default,{variant:"h5",sx:{mt:2},children:"Wait, there's more!"}),(0,t.jsxs)(S.default,{sx:{fontSize:"1rem",textAlign:"center"},children:["Query functions disabled without a"," ",(0,t.jsx)(S.default,{component:"span",sx:{fontWeight:"bold"},children:"data warehouse connection"})]})]}),(0,t.jsx)(r.default,{sx:{width:"50%",mt:3,mx:"auto"},children:(0,t.jsx)(i.default,{color:"iochmara",variant:"contained",size:"large",onClick:()=>{window.open((0,L.getSettingsUrl)(e),"_blank")},children:"Connect to Data Warehouse"})})]})})}var G=e.i(138848);let F=()=>{let{isCustomQueries:e,setCustomQueries:i,sqlQuery:n,setBaseSqlQuery:o}=(0,P.useRecceQueryContext)();return(0,t.jsxs)(a.default,{children:[(0,t.jsxs)(r.default,{direction:"row",spacing:.5,alignItems:"center",fontSize:"0.75rem",children:[(0,t.jsx)(S.default,{variant:"body2",sx:{fontSize:"0.75rem"},children:"Custom Queries"}),(0,t.jsx)(C.default,{title:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,t.jsx)(a.default,{component:"span",sx:{display:"flex",color:"grey.600"},children:(0,t.jsx)(R.PiInfoFill,{fontSize:"1rem"})})})]}),(0,t.jsx)(k,{size:"small",checked:e,onChange:()=>{!e&&o&&o(n),i(!e)},color:"primary"})]})},W=()=>{let{sqlQuery:e,baseSqlQuery:r,setSqlQuery:o,setBaseSqlQuery:s,primaryKeys:l,setPrimaryKeys:d,isCustomQueries:u}=(0,P.useRecceQueryContext)(),{lineageGraph:c,envInfo:h}=(0,I.useLineageGraphContext)(),{featureToggles:f,singleEnv:p}=(0,Q.useRecceInstanceContext)(),m=e;h?.adapterType==="sqlmesh"&&e===P.defaultSqlQuery&&(m="select * from db.mymodel"),"read only"===f.mode&&(m=`--- Would like to do query here? Book a demo with us at ${z.RECCE_SUPPORT_CALENDAR_URL}
${m}`);let{showRunId:x}=(0,T.useRecceActionContext)(),y=async e=>{let t="query_base"===e?r??"":m,a=function(e){switch(e){case"query":return D.submitQuery;case"query_base":return D.submitQueryBase;case"query_diff":return D.submitQueryDiff;default:throw Error(`Unknown query type: ${e}`)}}(e),i={sql_template:t};"query_diff"===e&&(i.primary_keys=l,u&&(i.base_sql_template=r));let{run_id:n}=await a(i,{nowait:!0});return x(n),await (0,_.waitRun)(n)},{mutate:g,isPending:b}=(0,$.useMutation)({mutationFn:y}),w=(0,n.useMemo)(()=>{let e={};if(!c)return"N/A";for(let t in c.nodes){let a=c.nodes[t].data.data.current?.schema;a&&(e[a]=(e[a]||0)+1)}return Object.keys(e).reduce((t,a)=>e[a]>(e[t]||0)?a:t,"N/A")},[c]);return p||"metadata only"===f.mode?(0,t.jsxs)(a.default,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,t.jsxs)(a.default,{sx:{display:"flex",justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray"},children:[(0,t.jsx)(B.default,{}),(0,t.jsx)(a.default,{sx:{flexGrow:1}}),p?(0,t.jsx)(C.default,{title:"Please configure the base environment before running the diff",placement:"left",children:(0,t.jsx)("span",{children:(0,t.jsx)(i.default,{variant:"contained",disabled:!0,size:"small",sx:{fontSize:"14px",mt:"16px"},children:"Run Diff"})})}):(0,t.jsx)(q.default,{display:"metadata only"===f.mode,children:(0,t.jsx)(i.default,{variant:"contained",disabled:!0,size:"small",sx:{fontSize:"14px",mt:"16px"},children:"Run Diff"})})]}),(0,t.jsx)(G.DualSqlEditor,{value:m,onChange:o,onRun:()=>{g("query")},labels:["base (production)",`current (${w})`],SetupGuide:"metadata only"===f.mode?(0,t.jsx)(U,{}):(0,t.jsx)(A.BaseEnvironmentSetupGuide,{})})]}):(0,t.jsxs)(a.default,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,t.jsxs)(a.default,{sx:{display:"flex",justifyContent:"right",alignItems:"flex-end",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px"},children:[(0,t.jsx)(B.default,{}),(0,t.jsx)(F,{}),(0,t.jsx)(a.default,{sx:{flexGrow:1}}),(0,t.jsx)(M.QueryForm,{defaultPrimaryKeys:l,onPrimaryKeysChange:d}),(0,t.jsx)(i.default,{variant:"contained",onClick:()=>{g("query_diff")},disabled:b||f.disableDatabaseQuery,size:"small",children:"Run Diff"})]}),(0,t.jsx)(a.default,{sx:{width:"100%",flex:1},children:u?(0,t.jsx)(G.DualSqlEditor,{value:m,baseValue:r,onChange:o,onChangeBase:s,onRun:()=>{g("query")},onRunBase:()=>{g("query_base")},onRunDiff:()=>{g("query_diff")}}):(0,t.jsx)(G.default,{value:m,onChange:o,onRun:()=>{g("query")},onRunDiff:()=>{g("query_diff")}})})]})};function X(){return(0,t.jsx)(W,{})}e.s(["default",()=>X],884916)}]);