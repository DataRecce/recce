(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,884916,e=>{"use strict";var t=e.i(19483),i=e.i(130209),n=e.i(187725),o=e.i(388797),r=e.i(913369),s=e.i(2936);e.i(715841);var a=e.i(667828),l=e.i(415790),u=e.i(625961),c=e.i(56606),d=e.i(498180);e.i(134115);var x=e.i(940999),h=e.i(180806),f=e.i(507524),m=e.i(461566),y=e.i(916955),p=e.i(29134),g=e.i(912007),j=e.i(475119),b=e.i(783586),w=e.i(182809),q=e.i(333207),C=e.i(42409),R=e.i(218031),S=e.i(731645),v=e.i(255677),B=e.i(407101),_=e.i(109624),P=e.i(373921);function Q(){let{data:e}=(0,q.useQuery)({queryKey:B.cacheKeys.instanceInfo(),queryFn:_.getRecceInstanceInfo});return(0,t.jsx)("div",{className:"flex flex-1 h-full min-h-0 m-2 p-4 bg-blue-50 rounded-lg shadow-md justify-center",children:(0,t.jsxs)("div",{className:"w-4/5 flex flex-col overflow-y-auto gap-6 px-8 pb-8",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"p-2 bg-white rounded-full flex items-center justify-center shadow-md",children:(0,t.jsx)(S.Icon,{as:C.RiTerminalBoxLine,boxSize:7,color:"iochmara.500"})}),(0,t.jsx)(R.Heading,{mt:"4",size:"lg",children:"Wait, there's more!"}),(0,t.jsxs)(v.Text,{fontSize:"md",textAlign:"center",children:["Query functions disabled without a"," ",(0,t.jsx)(v.Text,{fontWeight:"bold",as:"span",children:"data warehouse connection"})]})]}),(0,t.jsx)("div",{className:"w-1/2 flex flex-col mt-6 mx-auto",children:(0,t.jsx)(l.Button,{colorPalette:"iochmara",size:"lg",onClick:()=>{window.open((0,P.getSettingsUrl)(e),"_blank")},children:"Connect to Data Warehouse"})})]})})}var T=e.i(138848);let z=()=>{let{isCustomQueries:e,setCustomQueries:i,sqlQuery:n,setBaseSqlQuery:r}=(0,j.useRecceQueryContext)();return(0,t.jsxs)(a.Box,{children:[(0,t.jsxs)(u.Flex,{fontSize:"0.75rem",gap:1,alignItems:"center",children:["Custom Queries"," ",(0,t.jsx)(x.Tooltip,{content:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,t.jsx)(o.PiInfoFill,{color:"gray.600",fontSize:"1rem"})})]}),(0,t.jsxs)(d.Switch.Root,{size:"sm",colorPalette:"iochmara",checked:e,onCheckedChange:()=>{!e&&r&&r(n),i(!e)},children:[(0,t.jsx)(d.Switch.HiddenInput,{}),(0,t.jsx)(d.Switch.Control,{}),(0,t.jsx)(d.Switch.Label,{})]})]})},D=()=>{let{sqlQuery:e,baseSqlQuery:o,setSqlQuery:d,setBaseSqlQuery:q,primaryKeys:C,setPrimaryKeys:R,isCustomQueries:S}=(0,j.useRecceQueryContext)(),{lineageGraph:v,envInfo:B}=(0,y.useLineageGraphContext)(),{featureToggles:_,singleEnv:P}=(0,g.useRecceInstanceContext)(),D=e;B?.adapterType==="sqlmesh"&&e===j.defaultSqlQuery&&(D="select * from db.mymodel"),"read only"===_.mode&&(D=`--- Would like to do query here? Book a demo with us at ${h.RECCE_SUPPORT_CALENDAR_URL}
${D}`);let{showRunId:k}=(0,p.useRecceActionContext)(),I=async e=>{let t="query_base"===e?o??"":D,i=function(e){switch(e){case"query":return f.submitQuery;case"query_base":return f.submitQueryBase;case"query_diff":return f.submitQueryDiff;default:throw Error(`Unknown query type: ${e}`)}}(e),n={sql_template:t};"query_diff"===e&&(n.primary_keys=C,S&&(n.base_sql_template=o));let{run_id:r}=await i(n,{nowait:!0});return k(r),await (0,m.waitRun)(r)},{mutate:F,isPending:A}=(0,i.useMutation)({mutationFn:I}),N=(0,n.useMemo)(()=>{let e={};if(!v)return"N/A";for(let t in v.nodes){let i=v.nodes[t].data.data.current?.schema;i&&(e[i]=(e[i]||0)+1)}return Object.keys(e).reduce((t,i)=>e[i]>(e[t]||0)?i:t,"N/A")},[v]);return P||"metadata only"===_.mode?(0,t.jsxs)(u.Flex,{direction:"column",height:"100%",children:[(0,t.jsxs)(u.Flex,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",children:[(0,t.jsx)(s.default,{}),(0,t.jsx)(c.Spacer,{}),P?(0,t.jsx)(x.Tooltip,{content:"Please configure the base environment before running the diff",positioning:{placement:"left"},children:(0,t.jsx)(l.Button,{colorPalette:"iochmara",disabled:!0,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})}):(0,t.jsx)(r.default,{display:"metadata only"===_.mode,children:(0,t.jsx)(l.Button,{colorPalette:"iochmara",disabled:!0,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})})]}),(0,t.jsx)(T.DualSqlEditor,{value:D,onChange:d,onRun:()=>{F("query")},labels:["base (production)",`current (${N})`],SetupGuide:"metadata only"===_.mode?(0,t.jsx)(Q,{}):(0,t.jsx)(b.BaseEnvironmentSetupGuide,{})})]}):(0,t.jsxs)(u.Flex,{direction:"column",height:"100%",children:[(0,t.jsxs)(u.Flex,{justifyContent:"right",alignItems:"flex-end",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,t.jsx)(s.default,{}),(0,t.jsx)(z,{}),(0,t.jsx)(c.Spacer,{}),(0,t.jsx)(w.QueryForm,{defaultPrimaryKeys:C,onPrimaryKeysChange:R}),(0,t.jsx)(l.Button,{colorPalette:"iochmara",onClick:()=>{F("query_diff")},disabled:A||_.disableDatabaseQuery,size:"2xs",children:"Run Diff"})]}),(0,t.jsx)(a.Box,{width:"100%",flex:"1",children:S?(0,t.jsx)(T.DualSqlEditor,{value:D,baseValue:o,onChange:d,onChangeBase:q,onRun:()=>{F("query")},onRunBase:()=>{F("query_base")},onRunDiff:()=>{F("query_diff")}}):(0,t.jsx)(T.default,{value:D,onChange:d,onRun:()=>{F("query")},onRunDiff:()=>{F("query_diff")}})})]})};function k(){return(0,t.jsx)(D,{})}e.s(["default",()=>k],884916)}]);