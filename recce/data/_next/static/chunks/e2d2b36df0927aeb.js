(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,884916,e=>{"use strict";var t=e.i(19483),r=e.i(382875),i=e.i(671746),n=e.i(415570),o=e.i(302856);e.s([],365821),e.i(365821),e.s([],960896),e.i(960896);let[a,l]=(0,e.i(483591).createContext)({name:"SwitchContext",hookName:"useSwitchContext",providerName:"<SwitchProvider />"}),s=e=>e.children(l());var d=e.i(861903),u=e.i(187725),c=e.i(173614);let h=(0,u.forwardRef)((e,r)=>{let i=l(),n=(0,d.mergeProps)(i.getControlProps(),e);return(0,t.jsx)(c.ark.span,{...n,ref:r})});h.displayName="SwitchControl";var x=e.i(416574);let f=(0,u.forwardRef)((e,r)=>{let i=l(),n=(0,d.mergeProps)(i.getHiddenInputProps(),e),o=(0,x.useFieldContext)();return(0,t.jsx)(c.ark.input,{"aria-describedby":o?.ariaDescribedby,...n,ref:r})});f.displayName="SwitchHiddenInput";let m=(0,u.forwardRef)((e,r)=>{let i=l(),n=(0,d.mergeProps)(i.getLabelProps(),e);return(0,t.jsx)(c.ark.span,{...n,ref:r})});m.displayName="SwitchLabel";var p=e.i(341061),y=e.i(501829),b=e.i(727618),g=e.i(520036),j=e.i(904849);let C=(0,p.createSplitProps)(),w=(0,u.forwardRef)((e,r)=>{let[i,n]=C(e,["checked","defaultChecked","disabled","form","id","ids","invalid","label","name","onCheckedChange","readOnly","required","value"]),o=(e=>{let t=(0,u.useId)(),{getRootNode:r}=(0,g.useEnvironmentContext)(),{dir:i}=(0,j.useLocaleContext)(),n=(0,x.useFieldContext)(),o={id:t,ids:{label:n?.ids.label,hiddenInput:n?.ids.control},dir:i,disabled:n?.disabled,readOnly:n?.readOnly,invalid:n?.invalid,required:n?.required,getRootNode:r,...e},a=(0,y.useMachine)(b.machine,o);return b.connect(a,y.normalizeProps)})(i),l=(0,d.mergeProps)(o.getRootProps(),n);return(0,t.jsx)(a,{value:o,children:(0,t.jsx)(c.ark.label,{...l,ref:r})})});w.displayName="SwitchRoot";let R=(0,p.createSplitProps)(),v=(0,u.forwardRef)((e,r)=>{let[{value:i},n]=R(e,["value"]),o=(0,d.mergeProps)(i.getRootProps(),n);return(0,t.jsx)(a,{value:i,children:(0,t.jsx)(c.ark.label,{...o,ref:r})})});v.displayName="SwitchRootProvider";let P=(0,u.forwardRef)((e,r)=>{let i=l(),n=(0,d.mergeProps)(i.getThumbProps(),e);return(0,t.jsx)(c.ark.span,{...n,ref:r})});P.displayName="SwitchThumb",e.s(["Context",()=>s,"Control",()=>h,"HiddenInput",()=>f,"Label",()=>m,"Root",()=>w,"RootProvider",()=>v,"Thumb",()=>P],402905);var S=e.i(402905),S=S,k=e.i(822672),q=e.i(271906),I=e.i(829662);let{withProvider:T,withContext:B,useStyles:N,PropsProvider:_}=(0,k.createSlotRecipeContext)({key:"switch"}),A=T(S.RootProvider,"root",{forwardAsChild:!0}),z=T(S.Root,"root",{forwardAsChild:!0}),Q=B(S.Label,"label",{forwardAsChild:!0}),D=B(S.Thumb,"thumb",{forwardAsChild:!0}),L=B(S.Control,"control",{forwardAsChild:!0,defaultProps:{children:(0,t.jsx)(D,{})}}),F=(0,u.forwardRef)(function(e,r){let i=l(),n=N(),{fallback:o,children:a,unstyled:s,...d}=e;return(0,t.jsx)(q.chakra.span,{ref:r,"data-checked":(0,I.dataAttr)(i.checked),...d,css:[s?void 0:n.indicator,e.css],children:i.checked?a:o})}),E=(0,u.forwardRef)(function(e,r){let i=l(),{fallback:n,children:o,...a}=e;return(0,t.jsx)(q.chakra.span,{ref:r,"data-checked":(0,I.dataAttr)(i.checked),...a,children:i.checked?o:n})}),H=S.Context,O=S.HiddenInput;e.s(["Context",()=>H,"Control",()=>L,"HiddenInput",()=>O,"Indicator",()=>F,"Label",()=>Q,"PropsProvider",()=>_,"Root",()=>z,"RootProvider",()=>A,"Thumb",()=>D,"ThumbIndicator",()=>E],613665);var K=e.i(613665),K=K,U=e.i(130209),W=e.i(388797),$=e.i(913369),G=e.i(2936),M=e.i(746798),V=e.i(180806),J=e.i(507524),X=e.i(461566),Y=e.i(916955),Z=e.i(29134),ee=e.i(912007),et=e.i(475119),er=e.i(783586),ei=e.i(182809),en=e.i(518550),eo=e.i(325129),ea=e.i(950123),el=e.i(333207),es=e.i(42409),ed=e.i(407101),eu=e.i(109624),ec=e.i(373921);function eh(){let{data:e}=(0,el.useQuery)({queryKey:ed.cacheKeys.instanceInfo(),queryFn:eu.getRecceInstanceInfo});return(0,t.jsx)("div",{className:"flex flex-1 h-full min-h-0 m-2 p-4 bg-blue-50 rounded-lg shadow-md justify-center",children:(0,t.jsxs)("div",{className:"w-4/5 flex flex-col overflow-y-auto gap-6 px-8 pb-8",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"p-2 bg-white rounded-full flex items-center justify-center shadow-md",children:(0,t.jsx)(eo.Icon,{as:es.RiTerminalBoxLine,boxSize:7,color:"blue.500"})}),(0,t.jsx)(en.Heading,{mt:"4",size:"lg",children:"Wait, there's more!"}),(0,t.jsxs)(ea.Text,{fontSize:"md",textAlign:"center",children:["Query functions disabled without a"," ",(0,t.jsx)(ea.Text,{fontWeight:"bold",as:"span",children:"data warehouse connection"})]})]}),(0,t.jsx)("div",{className:"w-1/2 flex flex-col mt-6 mx-auto",children:(0,t.jsx)(i.Button,{colorPalette:"blue",size:"lg",onClick:()=>{window.open((0,ec.getSettingsUrl)(e),"_blank")},children:"Connect to Data Warehouse"})})]})})}var ex=e.i(138848);let ef=()=>{let{isCustomQueries:e,setCustomQueries:i,sqlQuery:o,setBaseSqlQuery:a}=(0,et.useRecceQueryContext)();return(0,t.jsxs)(r.Box,{children:[(0,t.jsxs)(n.Flex,{fontSize:"0.75rem",gap:1,alignItems:"center",children:["Custom Queries"," ",(0,t.jsx)(M.Tooltip,{content:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,t.jsx)(W.PiInfoFill,{color:"gray.600",fontSize:"1rem"})})]}),(0,t.jsxs)(K.Root,{size:"sm",colorPalette:"iochmara",checked:e,onCheckedChange:()=>{!e&&a&&a(o),i(!e)},children:[(0,t.jsx)(K.HiddenInput,{}),(0,t.jsx)(K.Control,{}),(0,t.jsx)(K.Label,{})]})]})},em=()=>{let{sqlQuery:e,baseSqlQuery:a,setSqlQuery:l,setBaseSqlQuery:s,primaryKeys:d,setPrimaryKeys:c,isCustomQueries:h}=(0,et.useRecceQueryContext)(),{lineageGraph:x,envInfo:f}=(0,Y.useLineageGraphContext)(),{featureToggles:m,singleEnv:p}=(0,ee.useRecceInstanceContext)(),y=e;f?.adapterType==="sqlmesh"&&e===et.defaultSqlQuery&&(y="select * from db.mymodel"),"read only"===m.mode&&(y=`--- Would like to do query here? Book a demo with us at ${V.RECCE_SUPPORT_CALENDAR_URL}
${y}`);let{showRunId:b}=(0,Z.useRecceActionContext)(),g=async e=>{let t="query_base"===e?a??"":y,r=function(e){switch(e){case"query":return J.submitQuery;case"query_base":return J.submitQueryBase;case"query_diff":return J.submitQueryDiff;default:throw Error(`Unknown query type: ${e}`)}}(e),i={sql_template:t};"query_diff"===e&&(i.primary_keys=d,h&&(i.base_sql_template=a));let{run_id:n}=await r(i,{nowait:!0});return b(n),await (0,X.waitRun)(n)},{mutate:j,isPending:C}=(0,U.useMutation)({mutationFn:g}),w=(0,u.useMemo)(()=>{let e={};if(!x)return"N/A";for(let t in x.nodes){let r=x.nodes[t].data.data.current?.schema;r&&(e[r]=(e[r]||0)+1)}return Object.keys(e).reduce((t,r)=>e[r]>(e[t]||0)?r:t,"N/A")},[x]);return p||"metadata only"===m.mode?(0,t.jsxs)(n.Flex,{direction:"column",height:"100%",children:[(0,t.jsxs)(n.Flex,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",children:[(0,t.jsx)(G.default,{}),(0,t.jsx)(o.Spacer,{}),p?(0,t.jsx)(M.Tooltip,{content:"Please configure the base environment before running the diff",positioning:{placement:"left"},children:(0,t.jsx)(i.Button,{colorPalette:"iochmara",disabled:!0,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})}):(0,t.jsx)($.default,{display:"metadata only"===m.mode,children:(0,t.jsx)(i.Button,{colorPalette:"iochmara",disabled:!0,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})})]}),(0,t.jsx)(ex.DualSqlEditor,{value:y,onChange:l,onRun:()=>{j("query")},labels:["base (production)",`current (${w})`],SetupGuide:"metadata only"===m.mode?(0,t.jsx)(eh,{}):(0,t.jsx)(er.BaseEnvironmentSetupGuide,{})})]}):(0,t.jsxs)(n.Flex,{direction:"column",height:"100%",children:[(0,t.jsxs)(n.Flex,{justifyContent:"right",alignItems:"flex-end",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,t.jsx)(G.default,{}),(0,t.jsx)(ef,{}),(0,t.jsx)(o.Spacer,{}),(0,t.jsx)(ei.QueryForm,{defaultPrimaryKeys:d,onPrimaryKeysChange:c}),(0,t.jsx)(i.Button,{colorPalette:"iochmara",onClick:()=>{j("query_diff")},disabled:C||m.disableDatabaseQuery,size:"2xs",children:"Run Diff"})]}),(0,t.jsx)(r.Box,{width:"100%",flex:"1",children:h?(0,t.jsx)(ex.DualSqlEditor,{value:y,baseValue:a,onChange:l,onChangeBase:s,onRun:()=>{j("query")},onRunBase:()=>{j("query_base")},onRunDiff:()=>{j("query_diff")}}):(0,t.jsx)(ex.default,{value:y,onChange:l,onRun:()=>{j("query")},onRunDiff:()=>{j("query_diff")}})})]})};function ep(){return(0,t.jsx)(em,{})}e.s(["default",()=>ep],884916)}]);