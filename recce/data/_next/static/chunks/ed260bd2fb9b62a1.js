(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,884916,e=>{"use strict";var t=e.i(464596),r=e.i(396574),i=e.i(913067),n=e.i(627307),o=e.i(412301);e.s([],969238),e.i(969238),e.s([],740617),e.i(740617);let[a,l]=(0,e.i(239414).createContext)({name:"SwitchContext",hookName:"useSwitchContext",providerName:"<SwitchProvider />"}),s=e=>e.children(l());var d=e.i(352713),u=e.i(716550),c=e.i(863761);let h=(0,u.forwardRef)((e,r)=>{let i=l(),n=(0,d.mergeProps)(i.getControlProps(),e);return(0,t.jsx)(c.ark.span,{...n,ref:r})});h.displayName="SwitchControl";var x=e.i(640292);let f=(0,u.forwardRef)((e,r)=>{let i=l(),n=(0,d.mergeProps)(i.getHiddenInputProps(),e),o=(0,x.useFieldContext)();return(0,t.jsx)(c.ark.input,{"aria-describedby":o?.ariaDescribedby,...n,ref:r})});f.displayName="SwitchHiddenInput";let m=(0,u.forwardRef)((e,r)=>{let i=l(),n=(0,d.mergeProps)(i.getLabelProps(),e);return(0,t.jsx)(c.ark.span,{...n,ref:r})});m.displayName="SwitchLabel";var p=e.i(46067),y=e.i(561697),b=e.i(93424),g=e.i(521173),j=e.i(864614);let C=(0,u.forwardRef)((e,r)=>{let[i,n]=(0,p.createSplitProps)()(e,["checked","defaultChecked","disabled","form","id","ids","invalid","label","name","onCheckedChange","readOnly","required","value"]),o=(e=>{let t=(0,u.useId)(),{getRootNode:r}=(0,g.useEnvironmentContext)(),{dir:i}=(0,j.useLocaleContext)(),n=(0,x.useFieldContext)(),o={id:t,ids:{label:n?.ids.label,hiddenInput:n?.ids.control},dir:i,disabled:n?.disabled,readOnly:n?.readOnly,invalid:n?.invalid,required:n?.required,getRootNode:r,...e},a=(0,y.useMachine)(b.machine,o);return b.connect(a,y.normalizeProps)})(i),l=(0,d.mergeProps)(o.getRootProps(),n);return(0,t.jsx)(a,{value:o,children:(0,t.jsx)(c.ark.label,{...l,ref:r})})});C.displayName="SwitchRoot";let w=(0,u.forwardRef)((e,r)=>{let[{value:i},n]=(0,p.createSplitProps)()(e,["value"]),o=(0,d.mergeProps)(i.getRootProps(),n);return(0,t.jsx)(a,{value:i,children:(0,t.jsx)(c.ark.label,{...o,ref:r})})});w.displayName="SwitchRootProvider";let R=(0,u.forwardRef)((e,r)=>{let i=l(),n=(0,d.mergeProps)(i.getThumbProps(),e);return(0,t.jsx)(c.ark.span,{...n,ref:r})});R.displayName="SwitchThumb",e.s(["Context",()=>s,"Control",()=>h,"HiddenInput",()=>f,"Label",()=>m,"Root",()=>C,"RootProvider",()=>w,"Thumb",()=>R],744056);var v=e.i(744056),v=v,P=e.i(920019),S=e.i(475387),k=e.i(914243);let{withProvider:q,withContext:I,useStyles:T,PropsProvider:B}=(0,P.createSlotRecipeContext)({key:"switch"}),N=q(v.RootProvider,"root",{forwardAsChild:!0}),_=q(v.Root,"root",{forwardAsChild:!0}),A=I(v.Label,"label",{forwardAsChild:!0}),z=I(v.Thumb,"thumb",{forwardAsChild:!0}),Q=I(v.Control,"control",{forwardAsChild:!0,defaultProps:{children:(0,t.jsx)(z,{})}}),D=(0,u.forwardRef)(function(e,r){let i=l(),n=T(),{fallback:o,children:a,unstyled:s,...d}=e;return(0,t.jsx)(S.chakra.span,{ref:r,"data-checked":(0,k.dataAttr)(i.checked),...d,css:[s?void 0:n.indicator,e.css],children:i.checked?a:o})}),L=(0,u.forwardRef)(function(e,r){let i=l(),{fallback:n,children:o,...a}=e;return(0,t.jsx)(S.chakra.span,{ref:r,"data-checked":(0,k.dataAttr)(i.checked),...a,children:i.checked?o:n})}),F=v.Context,E=v.HiddenInput;e.s(["Context",()=>F,"Control",()=>Q,"HiddenInput",()=>E,"Indicator",()=>D,"Label",()=>A,"PropsProvider",()=>B,"Root",()=>_,"RootProvider",()=>N,"Thumb",()=>z,"ThumbIndicator",()=>L],220548);var H=e.i(220548),H=H,O=e.i(410747),K=e.i(600328),U=e.i(913369),W=e.i(2936),$=e.i(746798),G=e.i(180806),M=e.i(507524),V=e.i(461566),J=e.i(916955),X=e.i(29134),Y=e.i(912007),Z=e.i(475119),ee=e.i(783586),et=e.i(182809),er=e.i(359603),ei=e.i(480953),en=e.i(926039),eo=e.i(854833),ea=e.i(127500),el=e.i(407101),es=e.i(109624),ed=e.i(373921);function eu(){let{data:e}=(0,eo.useQuery)({queryKey:el.cacheKeys.instanceInfo(),queryFn:es.getRecceInstanceInfo});return(0,t.jsx)("div",{className:"flex flex-1 h-full min-h-0 m-2 p-4 bg-blue-50 rounded-lg shadow-md justify-center",children:(0,t.jsxs)("div",{className:"w-4/5 flex flex-col overflow-y-auto gap-6 px-8 pb-8",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"p-2 bg-white rounded-full flex items-center justify-center shadow-md",children:(0,t.jsx)(ei.Icon,{as:ea.RiTerminalBoxLine,boxSize:7,color:"blue.500"})}),(0,t.jsx)(er.Heading,{mt:"4",size:"lg",children:"Wait, there's more!"}),(0,t.jsxs)(en.Text,{fontSize:"md",textAlign:"center",children:["Query functions disabled without a"," ",(0,t.jsx)(en.Text,{fontWeight:"bold",as:"span",children:"data warehouse connection"})]})]}),(0,t.jsx)("div",{className:"w-1/2 flex flex-col mt-6 mx-auto",children:(0,t.jsx)(i.Button,{colorPalette:"blue",size:"lg",onClick:()=>{window.open((0,ed.getSettingsUrl)(e),"_blank")},children:"Connect to Data Warehouse"})})]})})}var ec=e.i(138848);let eh=()=>{let{isCustomQueries:e,setCustomQueries:i,sqlQuery:o,setBaseSqlQuery:a}=(0,Z.useRecceQueryContext)();return(0,t.jsxs)(r.Box,{children:[(0,t.jsxs)(n.Flex,{fontSize:"0.75rem",gap:1,alignItems:"center",children:["Custom Queries"," ",(0,t.jsx)($.Tooltip,{content:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,t.jsx)(K.PiInfoFill,{color:"gray.600",fontSize:"1rem"})})]}),(0,t.jsxs)(H.Root,{size:"sm",colorPalette:"iochmara",checked:e,onCheckedChange:()=>{!e&&a&&a(o),i(!e)},children:[(0,t.jsx)(H.HiddenInput,{}),(0,t.jsx)(H.Control,{}),(0,t.jsx)(H.Label,{})]})]})},ex=()=>{let{sqlQuery:e,baseSqlQuery:a,setSqlQuery:l,setBaseSqlQuery:s,primaryKeys:d,setPrimaryKeys:c,isCustomQueries:h}=(0,Z.useRecceQueryContext)(),{lineageGraph:x,envInfo:f}=(0,J.useLineageGraphContext)(),{featureToggles:m,singleEnv:p}=(0,Y.useRecceInstanceContext)(),y=e;f?.adapterType==="sqlmesh"&&e===Z.defaultSqlQuery&&(y="select * from db.mymodel"),"read only"===m.mode&&(y=`--- Would like to do query here? Book a demo with us at ${G.RECCE_SUPPORT_CALENDAR_URL}
${y}`);let{showRunId:b}=(0,X.useRecceActionContext)(),g=async e=>{let t="query_base"===e?a??"":y,r=function(e){switch(e){case"query":return M.submitQuery;case"query_base":return M.submitQueryBase;case"query_diff":return M.submitQueryDiff;default:throw Error(`Unknown query type: ${e}`)}}(e),i={sql_template:t};"query_diff"===e&&(i.primary_keys=d,h&&(i.base_sql_template=a));let{run_id:n}=await r(i,{nowait:!0});return b(n),await (0,V.waitRun)(n)},{mutate:j,isPending:C}=(0,O.useMutation)({mutationFn:g}),w=(0,u.useMemo)(()=>{let e={};if(!x)return"N/A";for(let t in x.nodes){let r=x.nodes[t].data.data.current?.schema;r&&(e[r]=(e[r]||0)+1)}return Object.keys(e).reduce((t,r)=>e[r]>(e[t]||0)?r:t,"N/A")},[x]);return p||"metadata only"===m.mode?(0,t.jsxs)(n.Flex,{direction:"column",height:"100%",children:[(0,t.jsxs)(n.Flex,{justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",children:[(0,t.jsx)(W.default,{}),(0,t.jsx)(o.Spacer,{}),p?(0,t.jsx)($.Tooltip,{content:"Please configure the base environment before running the diff",positioning:{placement:"left"},children:(0,t.jsx)(i.Button,{colorPalette:"iochmara",disabled:!0,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})}):(0,t.jsx)(U.default,{display:"metadata only"===m.mode,children:(0,t.jsx)(i.Button,{colorPalette:"iochmara",disabled:!0,size:"xs",fontSize:"14px",marginTop:"16px",children:"Run Diff"})})]}),(0,t.jsx)(ec.DualSqlEditor,{value:y,onChange:l,onRun:()=>{j("query")},labels:["base (production)",`current (${w})`],SetupGuide:"metadata only"===m.mode?(0,t.jsx)(eu,{}):(0,t.jsx)(ee.BaseEnvironmentSetupGuide,{})})]}):(0,t.jsxs)(n.Flex,{direction:"column",height:"100%",children:[(0,t.jsxs)(n.Flex,{justifyContent:"right",alignItems:"flex-end",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid lightgray",flex:"0 0 54px",children:[(0,t.jsx)(W.default,{}),(0,t.jsx)(eh,{}),(0,t.jsx)(o.Spacer,{}),(0,t.jsx)(et.QueryForm,{defaultPrimaryKeys:d,onPrimaryKeysChange:c}),(0,t.jsx)(i.Button,{colorPalette:"iochmara",onClick:()=>{j("query_diff")},disabled:C||m.disableDatabaseQuery,size:"2xs",children:"Run Diff"})]}),(0,t.jsx)(r.Box,{width:"100%",flex:"1",children:h?(0,t.jsx)(ec.DualSqlEditor,{value:y,baseValue:a,onChange:l,onChangeBase:s,onRun:()=>{j("query")},onRunBase:()=>{j("query_base")},onRunDiff:()=>{j("query_diff")}}):(0,t.jsx)(ec.default,{value:y,onChange:l,onRun:()=>{j("query")},onRunDiff:()=>{j("query_diff")}})})]})};function ef(){return(0,t.jsx)(ex,{})}e.s(["default",()=>ef],884916)}]);