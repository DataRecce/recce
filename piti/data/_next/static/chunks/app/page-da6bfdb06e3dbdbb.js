(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8695:function(e,r,t){Promise.resolve().then(t.bind(t,109))},109:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return Home}});var a=t(757);t(1702);var n=t(7726),c=t(2116),s=t(929),l=t(3978),o=t.n(l);function _getPrimaryKeyValue(e,r){let t={};for(let a of r)t[a]=e[a];return JSON.stringify(t)}function queryDiff(e,r){let t=[],a=[],n={},c={};if(!o().isEqual(e.schema.primaryKey,r.schema.primaryKey))throw Error("primary key mismatch! ".concat(e.schema.primaryKey," != ").concat(r.schema.primaryKey));let s=e.schema.primaryKey;r.schema.fields.forEach(e=>{n[e.name]={},n[e.name].current=e}),e.schema.fields.forEach(e=>{n[e.name]||(n[e.name]={}),n[e.name].base=e}),Object.entries(n).forEach(e=>{let[r,{base:n,current:c}]=e;s.includes(r)?a.push({key:"".concat(r),name:r}):t.push({name:r,children:[{key:"base__".concat(r),name:"Base"},{key:"current__".concat(r),name:"Current"}]})}),r.data.forEach(e=>{let r=_getPrimaryKeyValue(e,s);c[r]={},c[r].current=e}),e.data.forEach(e=>{let r=_getPrimaryKeyValue(e,s);c[r]||(c[r]={}),c[r].base=e});let l=Object.entries(c).map(e=>{let[r,{base:t,current:a}]=e,n=JSON.parse(r);return t&&Object.keys(t).forEach(e=>{s.includes(e)||(n["base__".concat(e)]=t[e])}),a&&Object.keys(a).forEach(e=>{s.includes(e)||(n["current__".concat(e)]=a[e])}),n});return{columns:[...a,...t],rows:l}}var i=t(2218);let u=i.env.NEXT_PUBLIC_API_URL||"",healthCheck=async()=>{try{let e=await s.Z.get("".concat(u,"/api/health"));return e.data}catch(e){return console.error("Error fetching data:",e),null}};var components_DiffView=()=>{let[e,r]=(0,n.useState)('select * from {{ ref("kpi") }} order by 1 desc limit 20'),[t,l]=(0,n.useState)(!1),[o,i]=(0,n.useState)(null),[h,m]=(0,n.useState)({columns:[],rows:[]}),f=(0,n.useCallback)(async()=>{try{l(!0);let r=await s.Z.post("".concat(u,"/api/query"),{sql_template:e});if(200!==r.status)throw Error("error");let t=await s.Z.post("".concat(u,"/api/query"),{sql_template:e,base:!0});if(200!==t.status)throw Error("error");let a=queryDiff(r.data,t.data);m(a)}catch(e){i(null==e?void 0:e.message)}finally{l(!1)}},[e]);return(0,n.useEffect)(()=>{healthCheck()},[]),(0,a.jsxs)("div",{children:[(0,a.jsx)("textarea",{value:e,onChange:e=>r(e.target.value),placeholder:"Enter your SQL query here",rows:20,style:{width:"100%"}}),(0,a.jsx)("br",{}),(0,a.jsx)("button",{onClick:f,disabled:t,children:"Execute Query"}),t&&(0,a.jsx)("p",{children:"Loading..."}),o&&(0,a.jsxs)("p",{children:["Error: ",o]}),(0,a.jsx)(c.ZP,{columns:h.columns,rows:h.rows,className:"fill-grid",defaultColumnOptions:{resizable:!0}})]})};function Home(){return(0,a.jsx)(components_DiffView,{})}}},function(e){e.O(0,[495,968,297,62,744],function(){return e(e.s=8695)}),_N_E=e.O()}]);